<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>U7&#39;s BlogğŸ‹</title>
  
  
  <link href="https://u7u7.top/atom.xml" rel="self"/>
  
  <link href="https://u7u7.top/"/>
  <updated>2025-08-25T06:28:14.795Z</updated>
  <id>https://u7u7.top/</id>
  
  <author>
    <name>U7&#39;s BlogğŸ‹</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>ESéšå¿ƒè®°</title>
    <link href="https://u7u7.top/posts/ESByMyself.html"/>
    <id>https://u7u7.top/posts/ESByMyself.html</id>
    <published>2025-08-25T03:00:25.000Z</published>
    <updated>2025-08-25T06:28:14.795Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ESç†è§£">ESç†è§£</h1><p>ESå°±æ˜¯ä¸€å¥—æœç´¢å¼•æ“æŠ€æœ¯ï¼Œå®ƒæ˜¯elasticæŠ€æœ¯æ ˆä¸­çš„ä¸€éƒ¨åˆ†ã€‚å®Œæ•´çš„æŠ€æœ¯æ ˆåŒ…æ‹¬ï¼š</p><ul><li>Elasticsearchï¼šç”¨äºæ•°æ®å­˜å‚¨ã€è®¡ç®—å’Œæœç´¢</li><li>Logstash/Beatsï¼šç”¨äºæ•°æ®æ”¶é›†</li><li>Kibanaï¼šç”¨äºæ•°æ®å¯è§†åŒ–</li></ul><p>ESä¸ºä»€ä¹ˆå¿«ï¼Ÿä»–çš„æœç´¢é€»è¾‘æ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆä¸ç”¨mysqlæœç´¢ï¼Ÿ</p><p>å¦‚æœä½¿ç”¨mysqlè¿›è¡Œæœç´¢ï¼Œæ¯”å¦‚æˆ‘è¦æŸ¥è¯¢â€œæ‰‹æœºâ€è¿™ä¸ªå…³é”®å­—ï¼Œé€šå¸¸ä¼šä½¿ç”¨like %æ‰‹æœº%ï¼Œè¿™ä¸ªæ“ä½œä¼šå¯¼è‡´mysqlç´¢å¼•å¤±æ•ˆ(%å‰ç¼€ç´¢å¼•å¤±æ•ˆ)ï¼Œå°±ä¼šè¿›è¡Œå…¨è¡¨æ‰«æï¼Œé€æ¡æœç´¢åˆ¤æ–­ã€‚ESæ˜¯æ€ä¹ˆåšçš„å‘¢ï¼Œä»–æ˜¯ä½¿ç”¨å€’æ’ç´¢å¼•æŠ€æœ¯ï¼Œä»–å†…ç½®æœ‰ä¸€ä¸ªåˆ†è¯ç®—æ³•ï¼Œä¼šå°†æ•°æ®è¿›è¡Œåˆ†è¯ç®¡ç†ï¼Œæ¯”å¦‚æœ‰ä¸€ä¸ªå­—æ®µä¸ºâ€œä¸­å›½åä¸ºæ‰‹æœºç‰›â€ï¼Œå°±ä¼šåˆ†æˆ&quot;ä¸­å›½&quot;â€œåä¸ºâ€â€œæ‰‹æœºâ€â€œç‰›â€ï¼Œç„¶åå°†åˆ†è¯ä»¥åçš„è¯æ¡å½“åšç´¢å¼•ï¼Œå†åˆ›å»ºæ–‡æ¡£idåˆ—ï¼Œè¿™æ ·æœç´¢æŸä¸ªå…³é”®è¯å°±ä¼šå»æ–‡æ¡£IDæ‰¾ï¼Œå› ä¸ºè¯æ¡æœ‰ç´¢å¼•ï¼Œæ‰€ä»¥å¾ˆå¿«ï¼Œå†é€šè¿‡æ–‡æ¡£idï¼ŒæŸ¥è¯¢æ–‡æ¡£ã€‚è¿™æ ·å› ä¸ºéƒ½ä½¿ç”¨åˆ°äº†ç´¢å¼•æ‰€ä»¥éå¸¸å¿«ã€‚</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/image-20250815100244629.png" alt="image-20250815100244629"></p><h1 id="åˆ†è¯å™¨">åˆ†è¯å™¨</h1><p>é€šå¸¸ä½¿ç”¨ikåˆ†è¯å™¨ï¼Œæ”¯æŒè‡ªå®šä¹‰åˆ†è¯å’Œåœæ­¢è¯ã€‚è¿™é‡Œæˆ‘ä½¿ç”¨çš„æ—¶å€™å‡ºç°äº†ç‚¹å°é—®é¢˜ï¼Œæˆ‘æ˜¯åœ¨çº¿å®‰è£…çš„ï¼ŒæŸ¥çœ‹æ—¥å¿—docker logs es | grep -i &quot;dictionary&quot;å‘ç°æˆ‘çš„å­—å…¸åŠ è½½ä½ç½®å’Œæ–‡æ¡£ä¸ä¸€æ ·ã€‚/usr/share/elasticsearch/config/analysis-ik/IKAnalyzer.cfg.xmlæˆ‘çš„é…ç½®ç±»åœ¨è¿™é‡Œï¼Œæ‰€ä»¥è¦ä¿®æ”¹è¿™é‡Œçš„é…ç½®æ–‡ä»¶å¹¶æ·»åŠ ext.dicã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">properties</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;http://java.sun.com/dtd/properties.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">comment</span>&gt;</span>IK Analyzer æ‰©å±•é…ç½®<span class="tag">&lt;/<span class="name">comment</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--ç”¨æˆ·å¯ä»¥åœ¨è¿™é‡Œé…ç½®è‡ªå·±çš„æ‰©å±•å­—å…¸ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;ext_dict&quot;</span>&gt;</span>ext.dic<span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line"> <span class="comment">&lt;!--ç”¨æˆ·å¯ä»¥åœ¨è¿™é‡Œé…ç½®è‡ªå·±çš„æ‰©å±•åœæ­¢è¯å­—å…¸--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;ext_stopwords&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--ç”¨æˆ·å¯ä»¥åœ¨è¿™é‡Œé…ç½®è¿œç¨‹æ‰©å±•å­—å…¸ --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- &lt;entry key=&quot;remote_ext_dict&quot;&gt;words_location&lt;/entry&gt; --&gt;</span></span><br><span class="line"><span class="comment">&lt;!--ç”¨æˆ·å¯ä»¥åœ¨è¿™é‡Œé…ç½®è¿œç¨‹æ‰©å±•åœæ­¢è¯å­—å…¸--&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- &lt;entry key=&quot;remote_ext_stopwords&quot;&gt;words_location&lt;/entry&gt; --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br></pre></td></tr></table></figure><h1 id="AOPé€šè¿‡MQå¼‚æ­¥åŒæ­¥æ•°æ®">AOPé€šè¿‡MQå¼‚æ­¥åŒæ­¥æ•°æ®</h1><p>å½“æˆ‘ä»¬é€šè¿‡RESTæ¥å£å¯¹å•†å“æ•°æ®è¿›è¡Œå¢ä¿®åˆ çš„æ—¶å€™è¦ä¿è¯ESåŒæ­¥æ›´æ–°ï¼Œå°±å’Œredisä¿æŒä¸€è‡´æ€§ä¸€æ ·çš„é“ç†ï¼Œè¿™é‡Œå› ä¸ºæˆ‘ä»¬ä¹‹å‰ä»£ç éƒ½å¼€å‘å¥½äº†ï¼Œæ‰€ä»¥æƒ³åˆ°äº†AOPè¿›è¡Œä¸šåŠ¡è§£è€¦ï¼Œä½¿ç”¨AOPç›‘æ§Controllerå±‚ï¼Œä¼ å‚æƒ…å†µå°±ä¸¤ç§raw(json)æ•°æ®å’Œè·¯å¾„ä¼ å‚ã€‚jsonåœ¨javaä¸­å·²ç»æŒ‰ç…§dtoå°è£…å¥½äº†ï¼Œè·¯å¾„ä¼ å‚ä¹Ÿéƒ½ä¼šæœ‰itemIdï¼Œé‚£æˆ‘è¦åšçš„äº‹æƒ…å°±æ˜¯æ‹¿åˆ°å•†å“idå°±å¥½äº†ï¼Œæˆ‘ä½¿ç”¨@AfterReturningåç½®è¿”å›é€šçŸ¥ï¼Œè¿™æ ·ä¼šåœ¨controllerå±‚æ‰§è¡Œå®Œä»¥åå†æ‰§è¡Œæ‹¦æˆªç±»çš„ä»£ç ã€‚è¿™æ ·æ•°æ®éƒ½å·²ç»åˆ°æ•°æ®åº“äº†ï¼Œç„¶åå¯ä»¥å‘itemIdåˆ°MQï¼Œå½“MQç›‘å¬åˆ°ä½¿ç”¨äº†å“ªäº›æ–¹æ³•ä»¥åï¼Œæ¶ˆè´¹è€…è¿›è¡Œå¤„ç†ï¼Œå¯ä»¥é€šè¿‡idæ‹¿æ–°çš„æ•°æ®å¢åŠ åˆ°esï¼Œä¿®æ”¹æˆ–è€…åˆ é™¤å°±ä¸å¤šè¯´äº†ã€‚çœ‹å®ç°é€»è¾‘å§ã€‚</p><p>å…ˆè‡ªå®šä¹‰æ³¨è§£ã€‚æ ‡è®°éœ€è¦å‘é€æ¶ˆæ¯çš„æ–¹æ³•ï¼Œæ ‡è¯†é‚£äº›æ‰§è¡Œåéœ€è¦å‘æ¶ˆæ¯é˜Ÿåˆ—å‘é€æ¶ˆæ¯çš„ä¸šåŠ¡æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(ElementType.METHOD)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> SeedMessageToMq &#123;</span><br><span class="line">    String <span class="title function_">exchange</span><span class="params">()</span>; <span class="comment">//å‘é€äº¤æ¢æœº</span></span><br><span class="line">    String <span class="title function_">routingKey</span><span class="params">()</span>; <span class="comment">//å‘é€è·¯ç”±é”®</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘å†™äº†ä¸€ä¸ªå‘½åç±»ï¼Œæ¯”è¾ƒä¼˜é›…ã€‚ï¼ˆå‰æœŸï¼‰å°†esç´¢å¼•åº“åå’ŒMQæ”¶åˆ°çš„å·¥å‚å’Œé˜Ÿåˆ—ä»¥åŠRouting keyè¿›è¡Œå‘½å</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MqConstants</span> &#123;</span><br><span class="line">    <span class="comment">//es ç´¢å¼•åº“å</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">SEARCH_ITEM_INDEX</span> <span class="operator">=</span> <span class="string">&quot;search_item_index&quot;</span>;</span><br><span class="line">    <span class="comment">//MQå·¥å‚</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">SEARCH_ITEM_DIRCT_EXCHANGE</span> <span class="operator">=</span> <span class="string">&quot;search-item-dirct-exchange&quot;</span>;</span><br><span class="line">    <span class="comment">//routingKey &amp;&amp; queue</span></span><br><span class="line">    <span class="comment">//å¢</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">SEARCH_ITEM_INSERT_KEY</span> <span class="operator">=</span> <span class="string">&quot;search-item-insert-key&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">SEARCH_ITEM_INSERT_QUEUE</span> <span class="operator">=</span> <span class="string">&quot;search-item-insert-queue&quot;</span>;</span><br><span class="line">    <span class="comment">//åˆ </span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">SEARCH_ITEM_DELETE_KEY</span> <span class="operator">=</span> <span class="string">&quot;search-item-delete-key&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">SEARCH_ITEM_DELETE_QUEUE</span> <span class="operator">=</span> <span class="string">&quot;search-item-delete-queue&quot;</span>;</span><br><span class="line">    <span class="comment">//æ”¹</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">SEARCH_ITEM_UPDATE_KEY</span> <span class="operator">=</span> <span class="string">&quot;search-item-update-key&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">SEARCH_ITEM_UPDATE_QUEUE</span> <span class="operator">=</span> <span class="string">&quot;search-item-update-queue&quot;</span>;</span><br><span class="line">    <span class="comment">//æ”¹çŠ¶æ€</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">SEARCH_ITEM_UPDATE_STATUS_KEY</span> <span class="operator">=</span> <span class="string">&quot;search-item-update-status-key&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">SEARCH_ITEM_UPDATE_STATUS_QUEUE</span> <span class="operator">=</span> <span class="string">&quot;search-item-update-status-queue&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯¹controllerå±‚éœ€è¦çš„ä»£ç è¿›è¡Œæ‹¦æˆª</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SeedMessageToMq(exchange = SEARCH_ITEM_DIRCT_EXCHANGE, routingKey = SEARCH_ITEM_INSERT_KEY)</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;æ–°å¢å•†å“&quot;)</span></span><br><span class="line"><span class="meta">@PostMapping</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveItem</span><span class="params">(<span class="meta">@RequestBody</span> ItemDTO item)</span> &#123;</span><br><span class="line">    <span class="comment">// æ–°å¢</span></span><br><span class="line">    itemService.save(BeanUtils.copyBean(item,Item.class));</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@SeedMessageToMq(exchange = SEARCH_ITEM_DIRCT_EXCHANGE, routingKey = SEARCH_ITEM_UPDATE_STATUS_KEY)</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;æ›´æ–°å•†å“çŠ¶æ€&quot;)</span></span><br><span class="line"><span class="meta">@PutMapping(&quot;/status/&#123;id&#125;/&#123;status&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateItemStatus</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id, <span class="meta">@PathVariable(&quot;status&quot;)</span> Integer status)</span>&#123;</span><br><span class="line">    <span class="type">Item</span> <span class="variable">item</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Item</span>();</span><br><span class="line">    item.setId(id);</span><br><span class="line">    item.setStatus(status);</span><br><span class="line">    itemService.updateById(item);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@SeedMessageToMq(exchange = SEARCH_ITEM_DIRCT_EXCHANGE, routingKey = SEARCH_ITEM_UPDATE_KEY)</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;æ›´æ–°å•†å“&quot;)</span></span><br><span class="line"><span class="meta">@PutMapping</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateItem</span><span class="params">(<span class="meta">@RequestBody</span> ItemDTO item)</span> &#123;</span><br><span class="line">    <span class="comment">// ä¸å…è®¸ä¿®æ”¹å•†å“çŠ¶æ€ï¼Œæ‰€ä»¥å¼ºåˆ¶è®¾ç½®ä¸ºnullï¼Œæ›´æ–°æ—¶ï¼Œå°±ä¼šå¿½ç•¥è¯¥å­—æ®µ</span></span><br><span class="line">    item.setStatus(<span class="literal">null</span>);</span><br><span class="line">    <span class="comment">// æ›´æ–°</span></span><br><span class="line">    itemService.updateById(BeanUtils.copyBean(item, Item.class));</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@SeedMessageToMq(exchange = SEARCH_ITEM_DIRCT_EXCHANGE, routingKey = SEARCH_ITEM_DELETE_KEY)</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;æ ¹æ®idåˆ é™¤å•†å“&quot;)</span></span><br><span class="line"><span class="meta">@DeleteMapping(&quot;&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteItemById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span> &#123;</span><br><span class="line">    itemService.removeById(id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åå®šä¹‰åˆ‡é¢å’Œæ‹¦æˆªåæ‰§è¡Œçš„æ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RabbitMessageAOP</span> &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RabbitMqHelper rabbitMqHelper;</span><br><span class="line">    <span class="comment">//å®šä¹‰åˆ‡é¢</span></span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(* com.hmall.item.controller.ItemController.*(..)) &amp;&amp; @annotation(com.hmall.item.annotation.SeedMessageToMq)&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">seedMessageToMqPointcut</span><span class="params">()</span> &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åç½®è¿”å›é€šçŸ¥ï¼šåœ¨ç›®æ ‡æ–¹æ³•æˆåŠŸæ‰§è¡Œåè§¦å‘</span></span><br><span class="line">    <span class="meta">@AfterReturning(pointcut = &quot;seedMessageToMqPointcut()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">seedMessage</span><span class="params">(JoinPoint joinPoint)</span> &#123;</span><br><span class="line">        <span class="comment">//è·å–ç›®æ ‡æ–¹æ³•çš„ç­¾å</span></span><br><span class="line">        <span class="type">MethodSignature</span> <span class="variable">signature</span> <span class="operator">=</span> (MethodSignature) joinPoint.getSignature();</span><br><span class="line">        <span class="comment">//è·å–ç›®æ ‡æ–¹æ³•å¯¹è±¡</span></span><br><span class="line">        <span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> signature.getMethod();</span><br><span class="line">        <span class="comment">//è·å–æ–¹æ³•ä¸Šçš„@SeedMessageToMqæ³¨è§£</span></span><br><span class="line">        <span class="type">SeedMessageToMq</span> <span class="variable">annotation</span> <span class="operator">=</span> method.getAnnotation(SeedMessageToMq.class);</span><br><span class="line">        <span class="comment">//ä»æ³¨è§£ä¸­è·å–é…ç½®ä¿¡æ¯</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">exchange</span> <span class="operator">=</span> annotation.exchange();</span><br><span class="line">        <span class="type">String</span> <span class="variable">routingKey</span> <span class="operator">=</span> annotation.routingKey();</span><br><span class="line">        <span class="comment">//è·å–æ–¹æ³•å‚æ•°ï¼ˆå¦‚æœéœ€è¦å‘é€å‚æ•°ä½œä¸ºæ¶ˆæ¯å†…å®¹ï¼‰</span></span><br><span class="line">        Object[] args = joinPoint.getArgs();</span><br><span class="line">        System.out.println(<span class="string">&quot;å‚æ•°åˆ—è¡¨ï¼š&quot;</span>+ Arrays.toString(args));</span><br><span class="line">        <span class="keyword">if</span> (args.length == <span class="number">0</span>)&#123;</span><br><span class="line">            log.info(<span class="string">&quot;æ²¡æ”¶åˆ°ä»»ä½•æ¶ˆæ¯&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//ä½¿ç”¨rabbitTemplateå‘é€æ¶ˆæ¯åˆ°æŒ‡å®šçš„exchangeå’ŒroutingKey</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">itemId</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">ObjectMapper</span> <span class="variable">objectMapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line">        <span class="keyword">if</span> (routingKey.equals(SEARCH_ITEM_INSERT_KEY) || routingKey.equals(SEARCH_ITEM_UPDATE_KEY))&#123;</span><br><span class="line">            <span class="type">ItemDTO</span> <span class="variable">itemDTO</span> <span class="operator">=</span> objectMapper.convertValue(args[<span class="number">0</span>], ItemDTO.class);</span><br><span class="line">            itemId = itemDTO.getId();</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span> (routingKey.equals(SEARCH_ITEM_UPDATE_STATUS_KEY) || routingKey.equals(SEARCH_ITEM_DELETE_KEY))&#123;</span><br><span class="line">            <span class="comment">//æ›´æ–°å•†å“çŠ¶æ€</span></span><br><span class="line">            itemId = objectMapper.convertValue(args[<span class="number">0</span>], Long.class);</span><br><span class="line">        &#125;</span><br><span class="line">        log.info(<span class="string">&quot;&#123;&#125;å•†å“â€”â€”â€”â€”å‡†å¤‡å‘é€å•†å“IDï¼š&#123;&#125;åˆ°MQ&quot;</span>, routingKey, itemId);</span><br><span class="line">        rabbitMqHelper.sendMessage(exchange,routingKey,itemId);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢å·²ç»å¯¹MQå‘é€äº†æ¶ˆæ¯ï¼Œç°åœ¨è¿›è¡Œç›‘å¬å¹¶å¤„ç†ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="comment">//ç›‘å¬å•†å“å˜åŒ–çš„æ¶ˆæ¯ å¹¶ä¿®æ”¹å¯¹åº”çš„es -&gt; æ•°æ®åŒæ­¥</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ListenerItemMqToEs</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> IItemService itemService;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">RestHighLevelClient</span> <span class="variable">client</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RestHighLevelClient</span>(RestClient.builder(</span><br><span class="line">            HttpHost.create(<span class="string">&quot;http://192.168.219.128:9200&quot;</span>)</span><br><span class="line">    ));</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RabbitListener(bindings = @QueueBinding(</span></span><br><span class="line"><span class="meta">            value = @Queue(value = SEARCH_ITEM_INSERT_QUEUE, durable = &quot;true&quot;),</span></span><br><span class="line"><span class="meta">            exchange = @Exchange(value = SEARCH_ITEM_DIRCT_EXCHANGE),</span></span><br><span class="line"><span class="meta">            key = SEARCH_ITEM_INSERT_KEY)</span></span><br><span class="line"><span class="meta">    )</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenerInsertItem</span><span class="params">(Long itemId)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;æ”¶åˆ°å•†å“ID&#123;&#125;,å‡†å¤‡æ·»åŠ &quot;</span>, itemId);</span><br><span class="line">        <span class="comment">//è·å–å•†å“ä¿¡æ¯</span></span><br><span class="line">        <span class="type">Item</span> <span class="variable">item</span> <span class="operator">=</span> itemService.getById(itemId);</span><br><span class="line">        <span class="comment">//è½¬æˆesæ‰€éœ€json</span></span><br><span class="line">        <span class="type">ItemDoc</span> <span class="variable">itemDoc</span> <span class="operator">=</span> BeanUtils.copyBean(item, ItemDoc.class);</span><br><span class="line">        <span class="type">String</span> <span class="variable">doc</span> <span class="operator">=</span> JSONUtil.toJsonStr(itemDoc);</span><br><span class="line">        <span class="comment">//å‡†å¤‡requestå¯¹è±¡å‘é€es</span></span><br><span class="line">        <span class="type">IndexRequest</span> <span class="variable">indexRequest</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IndexRequest</span>(SEARCH_ITEM_INDEX).id(itemDoc.getId()).source(doc, XContentType.JSON);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            client.index(indexRequest, RequestOptions.DEFAULT);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RabbitListener(bindings = @QueueBinding(</span></span><br><span class="line"><span class="meta">            value = @Queue(value = SEARCH_ITEM_DELETE_QUEUE, durable = &quot;true&quot;),</span></span><br><span class="line"><span class="meta">            exchange = @Exchange(value = SEARCH_ITEM_DIRCT_EXCHANGE),</span></span><br><span class="line"><span class="meta">            key = SEARCH_ITEM_DELETE_KEY)</span></span><br><span class="line"><span class="meta">    )</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenerDeleteItem</span><span class="params">(Long itemId)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;æ”¶åˆ°å•†å“ID&#123;&#125;,å‡†å¤‡åˆ é™¤&quot;</span>, itemId);</span><br><span class="line">        <span class="comment">//è·å–å•†å“ä¿¡æ¯</span></span><br><span class="line">        <span class="type">DeleteRequest</span> <span class="variable">deleteRequest</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DeleteRequest</span>(SEARCH_ITEM_INDEX).id(String.valueOf(itemId));</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            client.delete(deleteRequest, RequestOptions.DEFAULT);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RabbitListener(bindings = @QueueBinding(</span></span><br><span class="line"><span class="meta">            value = @Queue(value = SEARCH_ITEM_UPDATE_STATUS_QUEUE, durable = &quot;true&quot;),</span></span><br><span class="line"><span class="meta">            exchange = @Exchange(value = SEARCH_ITEM_DIRCT_EXCHANGE),</span></span><br><span class="line"><span class="meta">            key = SEARCH_ITEM_UPDATE_STATUS_KEY)</span></span><br><span class="line"><span class="meta">    )</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenerUpdateStatusItem</span><span class="params">(Long itemId)</span> &#123;</span><br><span class="line">        <span class="comment">//è·å–å•†å“ä¿¡æ¯</span></span><br><span class="line">        <span class="type">Item</span> <span class="variable">item</span> <span class="operator">=</span> itemService.getById(itemId);</span><br><span class="line">        <span class="comment">//çŠ¶æ€æ˜¯3çš„åˆ é™¤</span></span><br><span class="line">        <span class="keyword">if</span> (item.getStatus() == <span class="number">3</span>) &#123;</span><br><span class="line">            log.info(<span class="string">&quot;æ”¶åˆ°å•†å“çŠ¶æ€ä¸º3ï¼šID&#123;&#125;,å‡†å¤‡åˆ é™¤&quot;</span>, itemId);</span><br><span class="line">            listenerDeleteItem(itemId);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        log.info(<span class="string">&quot;æ”¶åˆ°å•†å“ID&#123;&#125;,å‡†å¤‡æ›´æ–°çŠ¶æ€&quot;</span>, itemId);</span><br><span class="line">        <span class="comment">//å‡†å¤‡requestå¯¹è±¡å‘é€es</span></span><br><span class="line">        <span class="type">UpdateRequest</span> <span class="variable">updateRequest</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UpdateRequest</span>(SEARCH_ITEM_INDEX, String.valueOf(itemId));</span><br><span class="line">        updateRequest.doc(<span class="string">&quot;status&quot;</span>, item.getStatus());</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            client.update(updateRequest, RequestOptions.DEFAULT);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RabbitListener(bindings = @QueueBinding(</span></span><br><span class="line"><span class="meta">            value = @Queue(value = SEARCH_ITEM_UPDATE_QUEUE, durable = &quot;true&quot;),</span></span><br><span class="line"><span class="meta">            exchange = @Exchange(value = SEARCH_ITEM_DIRCT_EXCHANGE),</span></span><br><span class="line"><span class="meta">            key = SEARCH_ITEM_UPDATE_KEY)</span></span><br><span class="line"><span class="meta">    )</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenerUpdateItem</span><span class="params">(Long itemId)</span> &#123;</span><br><span class="line">        <span class="comment">//è·å–å•†å“ä¿¡æ¯</span></span><br><span class="line">        <span class="type">Item</span> <span class="variable">item</span> <span class="operator">=</span> itemService.getById(itemId);</span><br><span class="line">        log.info(<span class="string">&quot;æ”¶åˆ°å•†å“ID&#123;&#125;,å‡†å¤‡æ›´æ–°&quot;</span>, itemId);</span><br><span class="line">        <span class="comment">//è½¬æˆesæ‰€éœ€json</span></span><br><span class="line">        <span class="type">ItemDoc</span> <span class="variable">itemDoc</span> <span class="operator">=</span> BeanUtils.copyBean(item, ItemDoc.class);</span><br><span class="line">        <span class="type">String</span> <span class="variable">doc</span> <span class="operator">=</span> JSONUtil.toJsonStr(itemDoc);</span><br><span class="line">        <span class="comment">//å‡†å¤‡requestå¯¹è±¡å‘é€es</span></span><br><span class="line">        <span class="type">UpdateRequest</span> <span class="variable">updateRequest</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UpdateRequest</span>(SEARCH_ITEM_INDEX, String.valueOf(itemId));</span><br><span class="line">        updateRequest.upsert(doc, XContentType.JSON);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            client.update(updateRequest, RequestOptions.DEFAULT);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="RestClientæŸ¥è¯¢">RestClientæŸ¥è¯¢</h1><p>è¿™é‡Œæˆ‘ç›´æ¥ç”¨eså¤„ç†é¡¹ç›®ä¸­æœç´¢æ¡†æ¥å£äº†ï¼Œesæ•°æ®æå‰åšå¥½äº†é¢„çƒ­</p><p>/search/list</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(&quot;æœç´¢å•†å“&quot;)</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/list&quot;)</span></span><br><span class="line"><span class="keyword">public</span> PageDTO&lt;ItemDTO&gt; <span class="title function_">search</span><span class="params">(ItemPageQuery query)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> searchService.searchItemFilterEs(query);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®ç°å±‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> PageDTO&lt;ItemDTO&gt; <span class="title function_">searchItemFilterEs</span><span class="params">(ItemPageQuery query)</span> &#123;</span><br><span class="line">    <span class="type">SearchRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SearchRequest</span>(<span class="string">&quot;items_new&quot;</span>);</span><br><span class="line">    <span class="type">SearchSourceBuilder</span> <span class="variable">source</span> <span class="operator">=</span> buildSearchRequest(request,query);</span><br><span class="line">    <span class="type">Integer</span> <span class="variable">pageNo</span> <span class="operator">=</span> query.getPageNo();</span><br><span class="line">    <span class="type">Integer</span> <span class="variable">pageSize</span> <span class="operator">=</span> query.getPageSize();</span><br><span class="line">    <span class="comment">//åˆ†é¡µå‚æ•°</span></span><br><span class="line">    source.from((pageNo - <span class="number">1</span>) * pageSize).size(pageSize);</span><br><span class="line">    SearchResponse response;</span><br><span class="line">    <span class="comment">// 3.å‘é€è¯·æ±‚</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        response = client.search(request, RequestOptions.DEFAULT);</span><br><span class="line">    &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> handleResponse(response);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//ç»„ç»‡queryå‚æ•°</span></span><br><span class="line"><span class="keyword">private</span> SearchSourceBuilder <span class="title function_">buildSearchRequest</span><span class="params">(SearchRequest request,ItemPageQuery query)</span> &#123;</span><br><span class="line">    <span class="comment">//æœç´¢æ¡ä»¶å‚æ•°</span></span><br><span class="line">    <span class="type">BoolQueryBuilder</span> <span class="variable">bool</span> <span class="operator">=</span> QueryBuilders.boolQuery();</span><br><span class="line">    <span class="keyword">if</span> (StrUtil.isNotEmpty(query.getKey()))&#123;</span><br><span class="line">        bool.must(QueryBuilders.matchQuery(<span class="string">&quot;name&quot;</span>, query.getKey()));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (StrUtil.isNotEmpty(query.getCategory()))&#123;</span><br><span class="line">        bool.filter(QueryBuilders.termQuery(<span class="string">&quot;category.keyword&quot;</span>, query.getCategory()));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (StrUtil.isNotEmpty(query.getBrand()))&#123;</span><br><span class="line">        bool.filter(QueryBuilders.termQuery(<span class="string">&quot;brand.keyword&quot;</span>, query.getBrand()));</span><br><span class="line">    &#125;</span><br><span class="line">    bool.filter(QueryBuilders.rangeQuery(<span class="string">&quot;price&quot;</span>).gt(query.getMinPrice()).lt(query.getMaxPrice()));</span><br><span class="line">    <span class="type">SearchSourceBuilder</span> <span class="variable">source</span> <span class="operator">=</span> request.source();</span><br><span class="line">    source.query(bool);</span><br><span class="line">    <span class="comment">//æ’åº</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">sortBy</span> <span class="operator">=</span> query.getSortBy();</span><br><span class="line">    <span class="keyword">if</span> (StrUtil.isNotEmpty(sortBy)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (query.getIsAsc()) source.sort(sortBy, SortOrder.ASC);</span><br><span class="line">        <span class="keyword">else</span> source.sort(sortBy, SortOrder.DESC);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//é«˜äº®</span></span><br><span class="line">    source.highlighter(</span><br><span class="line">        SearchSourceBuilder.highlight()</span><br><span class="line">        .field(<span class="string">&quot;name&quot;</span>)</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">return</span> source;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å¤„ç†SearchResponseè½¬PageDTO</span></span><br><span class="line"><span class="keyword">private</span> PageDTO&lt;ItemDTO&gt; <span class="title function_">handleResponse</span><span class="params">(SearchResponse search)</span> &#123;</span><br><span class="line">    Page&lt;ItemDTO&gt; page = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;();</span><br><span class="line">    <span class="type">SearchHits</span> <span class="variable">searchHits</span> <span class="operator">=</span> search.getHits();</span><br><span class="line">    <span class="keyword">assert</span> searchHits.getTotalHits() != <span class="literal">null</span>;</span><br><span class="line">    <span class="type">long</span> <span class="variable">total</span> <span class="operator">=</span> searchHits.getTotalHits().value;</span><br><span class="line">    page.setTotal(total);</span><br><span class="line">    SearchHit[] hits = searchHits.getHits();</span><br><span class="line">    List&lt;ItemDTO&gt; records = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (SearchHit hit : hits)&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">source</span> <span class="operator">=</span> hit.getSourceAsString();</span><br><span class="line">        <span class="type">ItemDTO</span> <span class="variable">itemDTO</span> <span class="operator">=</span> JSONUtil.toBean(source, ItemDTO.class);</span><br><span class="line">        records.add(itemDTO);</span><br><span class="line">        <span class="comment">// 5.è·å–é«˜äº®ç»“æœ</span></span><br><span class="line">        Map&lt;String, HighlightField&gt; hfs = hit.getHighlightFields();</span><br><span class="line">        <span class="keyword">if</span> (CollUtils.isNotEmpty(hfs)) &#123;</span><br><span class="line">            <span class="comment">// 5.1.æœ‰é«˜äº®ç»“æœï¼Œè·å–nameçš„é«˜äº®ç»“æœ</span></span><br><span class="line">            <span class="type">HighlightField</span> <span class="variable">hf</span> <span class="operator">=</span> hfs.get(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span> (hf != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="comment">//è·å–ç¬¬ä¸€ä¸ªé«˜äº®ç»“æœç‰‡æ®µï¼Œå°±æ˜¯å•†å“åç§°çš„é«˜äº®å€¼</span></span><br><span class="line">                <span class="type">String</span> <span class="variable">hfName</span> <span class="operator">=</span>  hf.getFragments()[<span class="number">0</span>].toString();</span><br><span class="line">                itemDTO.setName(hfName);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    page.setRecords(records);</span><br><span class="line">    page.setSize(pageSize);</span><br><span class="line">    <span class="keyword">return</span> PageDTO.of(page);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="æ•°æ®èšåˆ">æ•°æ®èšåˆ</h1><p>è¿™é‡Œä¸»è¦æ˜¯ä¸€ä¸ªåŠ¨æ€çš„è¿‡æ»¤æ¡ä»¶æœç´¢ã€‚ç›®å‰æœç´¢çš„å•†å“æœ‰ä»€ä¹ˆè¿‡æ»¤æ¡ä»¶å°±æœ‰å•¥ã€‚æ¯”å¦‚é€‰äº†å“ç‰Œæ˜¯å°ç±³ï¼Œç”Ÿæ•ˆçš„åˆ†ç±»å°±åªæœ‰æ‰‹æœº æ‹‰æ†ç®± å’Œ ç”µè§†</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/image-20250821140415010-17561032746692.png" alt="image-20250821140415010"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="comment">//èšåˆå‚æ•°</span></span><br><span class="line"><span class="keyword">public</span> JSONObject <span class="title function_">filter</span><span class="params">(ItemPageQuery query)</span> &#123;</span><br><span class="line">    <span class="type">SearchRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SearchRequest</span>(<span class="string">&quot;items_new&quot;</span>);</span><br><span class="line">    <span class="type">SearchSourceBuilder</span> <span class="variable">source</span> <span class="operator">=</span> buildSearchRequest(request,query);</span><br><span class="line">    source.size(<span class="number">0</span>);</span><br><span class="line">    source.aggregation(AggregationBuilders.terms(<span class="string">&quot;brand_agg&quot;</span>).field(<span class="string">&quot;brand.keyword&quot;</span>).size(<span class="number">20</span>))</span><br><span class="line">        .aggregation(AggregationBuilders.terms(<span class="string">&quot;category_agg&quot;</span>).field(<span class="string">&quot;category.keyword&quot;</span>).size(<span class="number">20</span>));</span><br><span class="line">    <span class="comment">//å‘é€è¯·æ±‚</span></span><br><span class="line">    SearchResponse response;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        response = client.search(request, RequestOptions.DEFAULT);</span><br><span class="line">    &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//è§£æèšåˆç»“æœ</span></span><br><span class="line">    <span class="type">Aggregations</span> <span class="variable">aggregations</span> <span class="operator">=</span> response.getAggregations();</span><br><span class="line">    <span class="keyword">if</span> (aggregations == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JSONObject</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">ParsedTerms</span> <span class="variable">brandAgg</span> <span class="operator">=</span> aggregations.get(<span class="string">&quot;brand_agg&quot;</span>);</span><br><span class="line">    <span class="type">ParsedTerms</span> <span class="variable">categoryAgg</span> <span class="operator">=</span> aggregations.get(<span class="string">&quot;category_agg&quot;</span>);</span><br><span class="line">    <span class="type">JSONObject</span> <span class="variable">result</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONObject</span>();</span><br><span class="line">    result.putByPath(<span class="string">&quot;brand&quot;</span>, getBuckets(brandAgg));</span><br><span class="line">    result.putByPath(<span class="string">&quot;category&quot;</span>,getBuckets(categoryAgg));</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//ParsedTermsè½¬é›†åˆ</span></span><br><span class="line"><span class="keyword">private</span> List&lt;String&gt; <span class="title function_">getBuckets</span><span class="params">(ParsedTerms terms)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (terms == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line">    List&lt;String&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (Terms.Bucket bucket : terms.getBuckets()) &#123;</span><br><span class="line">        list.add(bucket.getKeyAsString());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> list;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">ESä¸ªäººç†è§£å’Œæ­£å¸¸ä½¿ç”¨</summary>
    
    
    
    <category term="å­¦ä¹ ç¬”è®°" scheme="https://u7u7.top/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    
    <category term="å¾®æœåŠ¡" scheme="https://u7u7.top/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"/>
    
    <category term="Java" scheme="https://u7u7.top/tags/Java/"/>
    
    <category term="ES" scheme="https://u7u7.top/tags/ES/"/>
    
    <category term="ä¸ªäººç†è§£" scheme="https://u7u7.top/tags/%E4%B8%AA%E4%BA%BA%E7%90%86%E8%A7%A3/"/>
    
  </entry>
  
  <entry>
    <title>MQä¸ªäººç†è§£</title>
    <link href="https://u7u7.top/posts/MQByMyself.html"/>
    <id>https://u7u7.top/posts/MQByMyself.html</id>
    <published>2025-08-25T01:00:25.000Z</published>
    <updated>2025-08-25T01:41:16.973Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å£è¿°MQ">å£è¿°MQ</h1><p>ä¸ªäººå£è¿°ï¼šMQ æ˜¯Message Queueï¼Œæ¶ˆæ¯é˜Ÿåˆ—ã€‚å®ƒåœ¨æˆ‘ç›®å‰çš„ç†è§£å°±æ˜¯ä¸€ä¸ªä¸­é—´ä»¶ï¼Œæ ¸å¿ƒå¥½å¤„ï¼š<strong>åº”ç”¨è§£è€¦</strong>ã€<strong>å¼‚æ­¥æé€Ÿ</strong>ã€<strong>å‰Šå³°å¡«è°·</strong>ã€‚</p><p>é¦–å…ˆè®²ä¸€ä¸‹<strong>åº”ç”¨è§£è€¦</strong>ï¼Œæˆ‘æ‹¿12306ä¹°ç¥¨è¿™ä¸ªåœºæ™¯ä¸¾ä¾‹å­ã€‚æ­£å¸¸è®¾è®¡ä¸šåŠ¡ä¼šç”¨æˆ·ä¸‹å•ï¼Œä¸‹å•ä»¥å<strong>æ‰£é™¤åº“å­˜</strong>ï¼Œ<strong>å‘é€é‚®ä»¶</strong>ï¼Œ<strong>å‘é€çŸ­ä¿¡</strong>ï¼Œ<strong>é€šçŸ¥ç¬¬ä¸‰æ–¹</strong>ã€‚å‡è®¾æ²¡æœ‰MQè¿›è¡Œåº”ç”¨è§£è€¦ä¼šå‡ºç°çš„é—®é¢˜ã€‚1ã€äº§å“ç»ç†åŠ åŠŸèƒ½äº†ï¼Œè¯´ç”¨æˆ·ä¸‹è®¢å•ä»¥åéœ€è¦é€šçŸ¥å¾®ä¿¡å°ç¨‹åºï¼Œé‚£ä½ å°±è¦å»è®¢å•ç³»ç»Ÿä¸­æ”¹ä»£ç ï¼Œå¦‚æœåˆå¤šäº†å¾ˆå¤šä¸‹å•ä»¥åçš„åŠŸèƒ½å‘¢ï¼Ÿéå¸¸ä¸åˆç†ï¼Œè¦é¢‘ç¹æ›´æ–°ä»£ç ï¼Œä¹Ÿå¾ˆæœ‰å¯èƒ½å°†æ— bugçš„ä»£ç ï¼Œå¢åŠ åŠŸèƒ½å¢åŠ å‡ºbugæ¥ã€‚2ã€å¦‚æœæœ‰ä¸€å¤©çŸ­ä¿¡ç³»ç»ŸæŒ‚äº†ï¼Œç”¨æˆ·ä¸‹å•äº†ä»¥åçŸ­ä¿¡æœåŠ¡æŒ‚äº†ï¼Œç”¨æˆ·æ”¶ä¸åˆ°çŸ­ä¿¡ï¼Œä¹Ÿæ²¡æœ‰æ‰£é™¤åº“å­˜ï¼Œä¹Ÿæ²¡æœ‰æ”¶åˆ°é‚®ä»¶ã€‚é‚®ä»¶ç³»ç»Ÿå¥½å¥½çš„ï¼Œå› ä¸ºçŸ­ä¿¡ç³»ç»Ÿçš„é—®é¢˜å½±å“äº†ï¼Œè¿™ä¹Ÿä¸åˆç†ã€‚ä¸Šé¢çš„ä¸¤ä¸ªåŸå› éƒ½æ˜¯å› ä¸ºç³»ç»Ÿä¹‹é—´è€¦åˆåº¦å¤ªé«˜äº†ï¼Œé€šè¿‡MQå¯ä»¥æ€ä¹ˆåšï¼Œé¦–å…ˆä¸Šé¢çš„å„ç§ç³»ç»Ÿï¼Œå…¶å®å°±æ˜¯åœ¨è®¢å•äº§ç”Ÿæ•°æ®ä»¥åæ‰æœ‰çš„ï¼Œé‚£æˆ‘ä»¬å¯ä»¥å½“ç”¨æˆ·ä¸‹å•ä»¥åï¼Œé€šçŸ¥ç»™MQï¼Œå‘Šè¯‰å®ƒç”¨æˆ·ä¸‹å•äº†ï¼ŒMQå†å»é€šçŸ¥å…¶ä»–çš„æœåŠ¡ï¼Œå¯ä»¥æ‰£å‡åº“å­˜äº†ï¼Œå¯ä»¥å‘é€çŸ­ä¿¡äº†ã€‚</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/image-20250824141616276.png" alt="image-20250824141616276"></p><p>ç¬¬äºŒä¸ª<strong>å¼‚æ­¥æé€Ÿ</strong>ï¼Œå‡è®¾æˆ‘ä»¬ä¸ç”¨MQï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„ä»£ç å¿…ç„¶è€¦åˆåœ¨ä¸€èµ·ï¼Œä¸‹å•æˆåŠŸåï¼Œä¾æ¬¡è°ƒç”¨è¿™å‡ ä¸ªç³»ç»Ÿï¼Œç„¶ååŒæ­¥ç­‰åˆ°ä»–ä»¬çš„å“åº”æ‰èƒ½è¿”å›ç»™ç”¨æˆ·æ˜¯å¦æˆåŠŸçš„ç»“æœã€‚å‡è®¾æ¯ä¸ªç³»ç»Ÿè€—æ—¶200msï¼Œé‚£ä¹ˆå°±å¾—èŠ±è´¹800msï¼Œå†åŠ ä¸Šä¸‹å•çš„è€—æ—¶å°±éå¸¸çš„æ…¢ï¼Œç”¨æˆ·ä½“éªŒä¸ä½³ã€‚è¯´å†ç›´ç™½ç‚¹å°±æ˜¯å› ä¸ºæ˜¯åŒæ­¥æœ‰ç‚¹åƒä¸²è¡ŒåŒ–æ‰§è¡Œã€‚ä½†æ˜¯å…¶å®åœ¨åº”ç”¨è§£è€¦çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±å‘ç°äº†ï¼Œå½“ä¸‹å•ä»¥åé€šçŸ¥MQï¼Œå…¶ä»–ç³»ç»Ÿè®¢é˜…åˆ°MQä¸‹å•çš„æ¶ˆæ¯ï¼Œå¼€å§‹æ‰§è¡Œï¼Œå…¶ä»–ç³»ç»Ÿæ˜¯æœ‰ç‚¹åƒç±»å¹¶è¡Œçš„ã€‚åƒä¸‹å•çš„åœºæ™¯ï¼Œç”¨æˆ·æœ€å…³å¿ƒçš„æ˜¯ç”¨æˆ·æœ‰æ²¡æœ‰ä¸‹å•æˆåŠŸï¼Œæœ‰æ²¡æœ‰ä¹°åˆ°ç¥¨ï¼Œé€šçŸ¥ä»€ä¹ˆçš„æ˜¯æ¬¡è¦çš„ï¼Œé‚£æˆ‘ä»¬å°±å¯ä»¥å½“ä¸‹å•æˆåŠŸä»¥åå°†æ¶ˆæ¯å‘ç»™MQï¼Œå¹¶ç›´æ¥è¿”å›ç»™ç”¨æˆ·ä¸‹å•æˆåŠŸäº†ã€‚å…¶ä»–æ¨¡å—å†æ”¶åˆ°æ¶ˆæ¯ï¼Œæ‰§è¡Œä»–ä»¬è¯¥æ‰§è¡Œçš„ä»»åŠ¡ã€‚è¿™æ ·å¤§å¤§ç¼©çŸ­äº†æ•´ä½“ä¸šåŠ¡çš„è€—æ—¶ï¼Œå¯¹ç”¨æˆ·æ¥è¯´å…¶å®åªæ¶ˆè€—äº†ä¸‹å•æˆåŠŸçš„æ—¶é—´ï¼Œé€šçŸ¥çš„æ—¶é—´ç”¨æˆ·å¹¶ä¸æ˜¯æœ€åœ¨ä¹çš„ã€‚å†æ‹¿æ•°æ®æ¥è¯´ç”¨æˆ·ä¸‹å•èŠ±è´¹200msï¼Œç”¨æˆ·ç›´æ¥æ”¶åˆ°äº†ä¸‹å•æˆåŠŸçš„æ¶ˆæ¯ã€‚MQå†é€šçŸ¥å…¶ä»–ç³»ç»Ÿï¼Œå…¶ä»–ç³»ç»Ÿè€—æ—¶éƒ½æ˜¯200msã€‚é‚£ä¹ˆæ•´ä½“è€—æ—¶ä¹Ÿå°±åœ¨400mså·¦å³ã€‚å› ä¸ºMQæ€§èƒ½å¾ˆå¥½ï¼Œé€šçŸ¥å’Œæ¶ˆè´¹æ¶ˆæ¯è€—æ—¶éå¸¸çŸ­ã€‚</p><p>ç¬¬ä¸‰ä¸ª<strong>å‰Šå³°å¡«è°·</strong>ï¼Œè¿™ä¸ªå­—é¢æ²¡æœ‰é‚£ä¹ˆå¥½ç†è§£ï¼Œæˆ‘ä»¬è¿˜æ˜¯æ‹¿å–ç¥¨è¿™ä¸ªåœºæ™¯è§£é‡Šï¼Œå¹³å¸¸è®¢ç¥¨çš„æ—¶å€™QPSå¯èƒ½æ¯”è¾ƒä½ï¼Œå¦‚æœæ²¡æœ‰MQï¼Œå•é è®¢å•ç³»ç»Ÿä¹Ÿèƒ½å¤„ç†ï¼Œå¦‚æœåœ¨å›½åº†å’Œå‡æœŸæ—ºå­£ï¼ŒæŠ¢ç¥¨çš„äººéå¸¸å¤šï¼Œå¹¶å‘é‡ä¼šé«˜å¾ˆå¤šï¼Œè®¢å•ç³»ç»Ÿå°±æ‰›ä¸ä½äº†ã€‚å¦‚æœä¸ç”¨MQï¼Œæˆ‘ä»¬å¯èƒ½ä¼šè®¾ç½®é›†ç¾¤ä¿è¯é«˜å¯ç”¨ã€‚ä½†æ˜¯å¦‚æœæœ‰MQï¼Œå› ä¸ºMQçš„ååèƒ½åŠ›éå¸¸å¼ºï¼Œæˆ‘ä»¬å¯ä»¥è®¾è®¡é«˜å¯ç”¨çš„MQï¼Œæˆ‘ä»¬å¯ä»¥æŠŠè®¢å•æ¶ˆæ¯å…ˆæ”¾MQç¼“å­˜èµ·æ¥ï¼ŒæŠŠæµé‡é«˜å³°<strong>å‰Šå¼±</strong>(å‰Šå³°)ï¼Œè¿™æ ·è®¢å•ç³»ç»Ÿå°±é¿å…äº†é«˜å¹¶å‘çš„è¯·ï¼Œå†è®©è®¢å•ç³»ç»Ÿå»MQæ…¢æ…¢æ‹‰æ¶ˆæ¯ï¼Œå¤„ç†è¯·æ±‚ã€‚è¿™æ ·ä¸€æ¥ï¼Œé«˜å³°æœŸç§¯å‹çš„æ¶ˆæ¯ä¹Ÿç»ˆå°†è¢«æ¶ˆè´¹å®Œï¼Œå¯ä»¥å«åš<strong>å¡«è°·</strong>ã€‚</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/image-20250824143822481.png" alt="image-20250824143822481"></p><h1 id="å£è¿°RabbitMQ">å£è¿°RabbitMQ</h1><p>ä¸ªäººå£è¿°ï¼šRabbit MQæ˜¯MQçš„ä¸€ç§ï¼Œä¹Ÿæ˜¯å½“å‰æ¯”è¾ƒä¸»æµçš„MQï¼Œä¼˜ç‚¹æ˜¯æ—¶æ•ˆæ€§ï¼Œå¯é æ€§å¥½ã€‚é¦–å…ˆMQä¸Šé¢ä¹Ÿè¯´äº†ï¼Œæ˜¯å¯ä»¥æ¥å—æ¶ˆæ¯ï¼Œå¹¶å¹¿æ’­å‘å‡ºå»ã€‚é‚£è‚¯å®šéœ€è¦æŠŠæ¶ˆæ¯è¿›è¡Œå­˜å‚¨ï¼ŒRabbitMQçš„æ ¸å¿ƒä¹‹ä¸€Queueã€‚æ¶ˆæ¯é˜Ÿåˆ—æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªç±»ä¼¼äºé“¾è¡¨çš„ç‹¬ç«‹è¿›ç¨‹ï¼Œé“¾è¡¨é‡Œçš„æ¯ä¸ªèŠ‚ç‚¹å°±æ˜¯ä¸€ä¸ªæ¶ˆæ¯ã€‚å®ƒåœ¨ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ä¹‹é—´ï¼Œåœ¨æµé‡é«˜å³°çš„æ—¶å€™æš‚å­˜æ•°æ®ï¼Œå†æ…¢æ…¢æ¶ˆè´¹æ•°æ®å°±æ˜¯ä¹‹å‰è¯´çš„å‰Šå³°å¡«è°·ã€‚Queueå°±æ˜¯åˆšåˆšè¯´çš„ç±»ä¼¼é“¾è¡¨çš„è¿›ç¨‹ï¼Œæ¶ˆæ¯ä¹Ÿåˆ†äº†å¾ˆå¤šç§ç±»ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„Queueä¹Ÿå¯ä»¥ç»™ä»–ä¸åŒçš„å‘½åç”¨æ¥å­˜æ”¾ä¸åŒçš„æ¶ˆæ¯ã€‚æ¯ä¸ªQueueåˆæ˜¯ç‹¬ç«‹çš„è¿›ç¨‹ï¼ŒæŸä¸ªè¿›ç¨‹æŒ‚äº†äº’ç›¸ä¸å½±å“ã€‚æœ‰çš„æ—¶å€™æˆ‘ä»¬ä¸€ä¸ªæ¶ˆæ¯å¯èƒ½è¦å‘ç»™å¤šä¸ªQueueï¼Œè¿™ä¸ªæ—¶å€™Exchangeå°±å‡ºç°äº†ï¼Œå®ƒå°±ç›¸å½“äºä¸€ä¸ªäº¤æ¢æœºå¯ä»¥å®šåˆ¶æ¶ˆæ¯è·¯ç”±åˆ†å‘ç­–ç•¥æ¥å°†æ¶ˆæ¯åˆ†å‘ç»™ä¸åŒçš„Queueï¼Œç”Ÿäº§è€…ä¼šæºå¸¦RoutingKeyç»™Exchangeï¼Œå®ƒä¼šé€šè¿‡RoutingKeyå’ŒbindingKeyæŠ•æ”¾ç»™å¯¹åº”çš„Queueã€‚åˆšåˆšè¯´çš„è·¯ç”±æ–¹å¼å’Œç»‘å®šå…³ç³»ï¼Œæˆ‘ä»¬ç§°ä¸ºå…ƒæ•°æ®ã€‚</p><p>RabbitMQæœ‰å“ªäº›åŠŸèƒ½ï¼Œæ­»ä¿¡é˜Ÿåˆ—ï¼Œå»¶æ—¶é˜Ÿåˆ—ï¼Œä¼˜å…ˆçº§é˜Ÿåˆ—ã€‚</p><p>ç¬¬ä¸€ä¸ªæ­»ä¿¡é˜Ÿåˆ—ï¼Œæ­»ä¿¡é˜Ÿåˆ—æ˜¯ç”¨æ¥å­˜æ”¾ä¸€äº›å› ä¸ºæŸäº›åŸå› æ²¡æœ‰æ­£å¸¸è¢«æ¶ˆè´¹çš„æ¶ˆæ¯çš„é˜Ÿåˆ—ã€‚å®ƒçš„æ ¸å¿ƒçš„é¿å…æ•°æ®çš„ä¸¢å¤±ï¼Œå¹¶ä¸ºå¼‚å¸¸æ¶ˆæ¯æä¾›ä¸“é—¨çš„å¤„ç†é€šé“ï¼Œä¿è¯æ¶ˆæ¯çš„å¯é æ€§ã€‚æ¶ˆæ¯æˆä¸ºæ­»ä¿¡çš„æ¡ä»¶ã€‚æœ‰æ¶ˆæ¯è¿‡æœŸäº†ï¼Œé˜Ÿåˆ—æ»¡äº†ï¼Œæ¶ˆæ¯è¢«æ‹’ç»äº†å¹¶ä¸”requeueè®¾ç½®falseä¸é‡æ–°å…¥é˜Ÿï¼Œè¯¥é˜Ÿåˆ—æˆä¸ºæ­»ä¿¡ï¼Œåˆé€šè¿‡**<code>dead-letter-exchange</code>**ç»‘å®šäº†ä¸€ä¸ªäº¤æ¢æœºï¼Œè¯¥äº¤æ¢æœºå°±ç§°ä¸ºæ­»ä¿¡äº¤æ¢æœºï¼Œé‚£æ­»ä¿¡äº¤æ¢æœºçš„ä½œç”¨å°±æ˜¯å­˜æ”¾æ­»ä¿¡é˜Ÿåˆ—çš„ã€‚</p><p>ç¬¬äºŒä¸ªå»¶æ—¶é˜Ÿåˆ—ã€‚RabbitMQ çš„å»¶æ—¶é˜Ÿåˆ—æ˜¯ä¸€ç§ç‰¹æ®Šçš„æ¶ˆæ¯é˜Ÿåˆ—ï¼Œç”¨äºå®ç° â€œæ¶ˆæ¯å‘é€åï¼Œä¸ç«‹å³è¢«æ¶ˆè´¹ï¼Œè€Œæ˜¯åœ¨æŒ‡å®šæ—¶é—´åæ‰è¢«å¤„ç†â€ çš„éœ€æ±‚ã€‚ç”¨æˆ·ä¸‹å•åè‹¥åœ¨ 30 åˆ†é’Ÿå†…æœªæ”¯ä»˜ï¼Œéœ€è¦è‡ªåŠ¨å–æ¶ˆè®¢å•å¹¶é‡Šæ”¾åº“å­˜ã€‚æ­¤æ—¶å¯å°†è®¢å•ä¿¡æ¯å‘é€åˆ°å»¶æ—¶ï¼Œ30 åˆ†é’Ÿåæ¶ˆè´¹æ¶ˆæ¯æ‰§è¡Œå–æ¶ˆé€»è¾‘ã€‚é‚£æˆ‘ä»¬MQæ€ä¹ˆå®ç°å»¶æ—¶é˜Ÿåˆ—ï¼ŒMQæœ¬èº«æ˜¯æ²¡æœ‰å»¶è¿Ÿé˜Ÿåˆ—çš„ï¼Œä½†æ˜¯æˆ‘ä»¬èƒ½é€šè¿‡æ­»ä¿¡é˜Ÿåˆ—å’Œæ­»ä¿¡äº¤æ¢æœºå®ç°å»¶è¿Ÿæ¶ˆæ¯çš„å‘é€ã€‚<strong>å¦‚ä¸‹å›¾</strong>ï¼Œpublisheræ˜¯ç”Ÿäº§è€…ï¼Œå‘é€ä¸€ä¸ªæ¶ˆæ¯è®¾ç½®è¿‡æœŸæ—¶é—´5sï¼ŒRoutingKeyä¸ºblueï¼ŒExchangeä¸ºfanoutç±»å‹ï¼Œæ­¤æ—¶æ¶ˆæ¯å…ˆå‘é€åˆ°ttl.fanoutï¼Œåˆè½¬å‘ç»™ttl.queueã€‚ttl.queueç»‘å®šäº†æ­»ä¿¡äº¤æ¢æœºhmall.directï¼Œhmall.directäº‹å…ˆé€šè¿‡BindingKey=â€˜blueâ€™å’Œdirect.queue1ç»‘å®šäº†ã€‚æ­¤æ—¶5såˆ°äº†ï¼Œæ¶ˆæ¯è¿‡æœŸäº†ï¼Œttl.queueæºå¸¦RoutingKeyå‘é€ç»™hmall.direct,hmall.directå‘ç°ttl.queueçš„RoutingKeyå’Œdirect.queue1çš„BindingKeyåŒ¹é…ï¼Œäºæ˜¯æ¶ˆè´¹è€…æ”¶åˆ°æ¶ˆæ¯ï¼Œæ­¤æ—¶ç¦»ç”Ÿäº§è€…å‘é€æ¶ˆæ¯é‚£ä¸€åˆ»è¿‡å»äº†5ç§’ã€‚ä¸€èˆ¬ä¼šä½¿ç”¨DelayExchangeæ’ä»¶æ­é…springAMQPä½¿ç”¨ã€‚</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/image-20250824162239072.png" alt="image-20250824162239072"></p><p>ç¬¬ä¸‰ä¸ªä¼˜å…ˆçº§é˜Ÿåˆ—ï¼Œåº”ç”¨åœºæ™¯åœ¨æ¯”å¦‚æ™®é€šç”¨æˆ·å’Œä¼šå‘˜ç”¨æˆ·åŒæ—¶å‘èµ·è¯·æ±‚ç»™AæœåŠ¡ï¼ŒAæœåŠ¡ä¼šè½¬å‘ç»™BæœåŠ¡ï¼ŒBæœåŠ¡æ˜¯ç®—æ³•æœåŠ¡ï¼Œæˆ‘ä»¬æƒ³ä¼˜å…ˆå¤„ç†ä¼šå‘˜ç”¨æˆ·çš„è¯·æ±‚ã€‚MQå¦‚ä½•å®ç°çš„ï¼Œé˜Ÿåˆ—å£°æ˜çš„æ—¶å€™è¦å…ˆé€šè¿‡<code>x-max-priority</code>å‚æ•°è®¾ç½®æœ€å¤§ä¼˜å…ˆçº§åˆ«&lt;=10,ç”Ÿäº§è€…å‘é€æ¶ˆæ¯çš„æ—¶å€™ï¼Œåœ¨æ¶ˆæ¯å±æ€§ä¸­æ·»åŠ <code>priority</code>å­—æ®µï¼ŒæŒ‡å®šå…·ä½“ä¼˜å…ˆçº§éœ€è¦å°äºç­‰äºé˜Ÿåˆ—æœ€å¤§ä¼˜å…ˆçº§åˆ«ã€‚æ¶ˆè´¹è€…ç›‘å¬ä¼˜å…ˆçº§é˜Ÿåˆ—ï¼Œé˜Ÿåˆ—ä¼šè‡ªåŠ¨å°†é«˜ä¼˜å…ˆçº§æ¶ˆæ¯æ’åœ¨é˜Ÿå¤´ï¼Œæ¶ˆè´¹è€…ä¼šä¼˜å…ˆè·å–å¹¶å¤„ç†é«˜ä¼˜å…ˆçº§æ¶ˆæ¯ã€‚è¿™æ ·åœ¨æ¶ˆæ¯å †ç§¯çš„æ—¶å€™å°±ä¼šä¼˜å…ˆå¤„ç†é«˜ä¼˜å…ˆçº§çš„æ¶ˆæ¯ã€‚</p><h1 id="å£è¿°å¯é æ€§">å£è¿°å¯é æ€§</h1><p>ä¸ªäººå£è¿°:æ¶ˆæ¯ä»ç”Ÿäº§è€…åˆ°æ¶ˆè´¹è€…çš„æ¯ä¸€æ­¥éƒ½å¯èƒ½å¯¼è‡´æ¶ˆæ¯ä¸¢å¤±ï¼š</p><ul><li>å‘é€æ¶ˆæ¯æ—¶ä¸¢å¤±ï¼š<ul><li>ç”Ÿäº§è€…å‘é€æ¶ˆæ¯æ—¶è¿æ¥MQå¤±è´¥</li><li>ç”Ÿäº§è€…å‘é€æ¶ˆæ¯åˆ°è¾¾MQåæœªæ‰¾åˆ°Exchange</li><li>ç”Ÿäº§è€…å‘é€æ¶ˆæ¯åˆ°è¾¾MQçš„Exchangeåï¼Œæœªæ‰¾åˆ°åˆé€‚çš„Queue</li><li>æ¶ˆæ¯åˆ°è¾¾MQåï¼Œå¤„ç†æ¶ˆæ¯çš„è¿›ç¨‹å‘ç”Ÿå¼‚å¸¸</li></ul></li><li>MQå¯¼è‡´æ¶ˆæ¯ä¸¢å¤±ï¼š<ul><li>æ¶ˆæ¯åˆ°è¾¾MQï¼Œä¿å­˜åˆ°é˜Ÿåˆ—åï¼Œå°šæœªæ¶ˆè´¹å°±çªç„¶å®•æœº</li></ul></li><li>æ¶ˆè´¹è€…å¤„ç†æ¶ˆæ¯æ—¶ï¼š<ul><li>æ¶ˆæ¯æ¥æ”¶åå°šæœªå¤„ç†çªç„¶å®•æœº</li><li>æ¶ˆæ¯æ¥æ”¶åå¤„ç†è¿‡ç¨‹ä¸­æŠ›å‡ºå¼‚å¸¸</li></ul></li></ul><ol><li><p><strong>é¦–å…ˆ</strong>ã€è¯´ä¸€ä¸‹ç”Ÿäº§è€…æ€ä¹ˆä¸€å®šèƒ½æŠŠæ¶ˆæ¯å‘é€åˆ°MQï¼Œå½“ç”Ÿäº§è€…å‘é€æ¶ˆæ¯çš„æ—¶å€™ï¼Œå‡ºç°ç½‘ç»œæ•…éšœï¼Œå¯¼è‡´å’Œmqè¿æ¥ä¸­æ–­ã€‚springamqpå¼•å…¥äº†é‡è¯•æœºåˆ¶ï¼Œå½“rabbitTemplateå’Œmqè¿æ¥è¶…æ—¶çš„æ—¶å€™ï¼Œä¿®æ”¹é…ç½®æ–‡ä»¶å¯ä»¥é…ç½®é‡è¯•æ¬¡æ•°å’Œé‡è¯•é—´éš”æ—¶é—´ã€‚é™¤äº†ç½‘ç»œé—®é¢˜ï¼Œè¿˜æœ‰å‘é€æ¶ˆæ¯ä¸¢å¤±çš„å…¶ä»–æƒ…å†µï¼Œrabbitmqå¼•å…¥äº†ç”Ÿäº§è€…ç¡®è®¤æœºåˆ¶ï¼ŒåŒ…æ‹¬Publisher Confirmå’ŒPublisher Returnï¼Œç¡®è®¤æ¶ˆæ¯æ˜¯å¦åˆ°è¾¾äº†è·¯ç”±ï¼Œæ˜¯å¦ä»è·¯ç”±åˆ°äº†é˜Ÿåˆ—ã€‚confirmæœºåˆ¶åŒ…æ‹¬ackå’Œnackï¼Œå®ƒæ¯æ¬¡å‘é€æ¶ˆæ¯éƒ½è¦æ·»åŠ ï¼Œå› ä¸ºä¸åŒçš„æ¶ˆæ¯å¤„ç†é€»è¾‘ä¸ä¸€æ ·ï¼Œreturnæœºåˆ¶åŒ…æ‹¬returnåªç”¨å…¨å±€é…ç½®ä¸€æ¬¡ã€‚ä½†æ˜¯ä¸€èˆ¬ä¸ä½¿ç”¨mqç”Ÿäº§è€…ç¡®è®¤æœºåˆ¶æ¯”è¾ƒæ¶ˆè€—æ€§èƒ½ã€‚åªè¦ç¼–ç¨‹äººå‘˜é˜Ÿåˆ—åå’Œè·¯ç”±åä¸å¡«é”™ï¼Œè¿æ¥æ²¡é—®é¢˜ï¼Œä¸€èˆ¬ä¸ä¼šæœ‰é—®é¢˜ã€‚MQå†…éƒ¨æ•…éšœï¼šè¿™ç§éœ€è¦å¤„ç†ï¼Œä½†æ¦‚ç‡å¾€å¾€è¾ƒä½ã€‚å› æ­¤åªæœ‰å¯¹æ¶ˆæ¯å¯é æ€§è¦æ±‚éå¸¸é«˜çš„ä¸šåŠ¡æ‰éœ€è¦å¼€å¯ï¼Œè€Œä¸”ä»…ä»…éœ€è¦å¼€å¯ConfirmCallbackå¤„ç†nackå°±å¯ä»¥äº†ã€‚</p></li><li><p><strong>ç¬¬äºŒ</strong>ã€MQçš„å¯é æ€§ï¼Œæ¶ˆæ¯å¦‚æœåˆ°è¾¾mqä»¥åæ²¡æœ‰åŠæ—¶ä¿å­˜ï¼Œä¹Ÿä¼šå¯¼è‡´æ¶ˆæ¯ä¸¢å¤±ã€‚é»˜è®¤mqæ•°æ®æ˜¯å†…å­˜å­˜å‚¨çš„ä¸´æ—¶æ•°æ®ï¼Œé‡å¯ä»¥åæ•°æ®å°±ä¸¢å¤±äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦ç»™rabbitmqçš„æ•°æ®é…ç½®æŒä¹…åŒ–ï¼Œäº¤æ¢æœºã€é˜Ÿåˆ—ã€æ¶ˆæ¯éƒ½è¦é…ç½®æŒä¹…åŒ–ã€‚â—å¦‚æœåŒæ—¶å¼€å¯äº†ç”Ÿäº§è€…ç¡®è®¤æœºåˆ¶å’ŒæŒä¹…åŒ–ï¼Œmqä¼šåœ¨æŒä¹…åŒ–ä»¥åè¿”å›ackå›æ‰§ã€‚ä¸ºäº†å‡å°‘IOæ¬¡æ•°ï¼Œmqå¹¶ä¸æ˜¯é€æ¡æŒä¹…åŒ–åˆ°æ•°æ®åº“ï¼Œè€Œæ˜¯æ¯éš”ä¸€æ®µæ—¶é—´æ‰¹é‡æŠŠæ•°æ®æŒä¹…åŒ–åˆ°erlangçš„mnesiaæ•°æ®åº“ã€‚</p></li><li><p>ç¬¬ä¸‰ã€<strong>lazyqueue</strong>ï¼ŒRabbitMQä¼šå°†æ¥æ”¶åˆ°çš„ä¿¡æ¯ä¿å­˜åœ¨å†…å­˜ä¸­ä»¥é™ä½æ¶ˆæ¯æ”¶å‘çš„å»¶è¿Ÿã€‚ä½†åœ¨æŸäº›ç‰¹æ®Šæƒ…å†µä¸‹ï¼Œè¿™ä¼šå¯¼è‡´æ¶ˆæ¯ç§¯å‹ï¼Œæ¯”å¦‚ï¼š<br>æ¶ˆè´¹è€…å®•æœºæˆ–å‡ºç°ç½‘ç»œæ•…éšœ<br>æ¶ˆæ¯å‘é€é‡æ¿€å¢ï¼Œè¶…è¿‡äº†æ¶ˆè´¹è€…å¤„ç†é€Ÿåº¦<br>æ¶ˆè´¹è€…å¤„ç†ä¸šåŠ¡å‘ç”Ÿé˜»å¡<br>ä¸€æ—¦å‡ºç°æ¶ˆæ¯å †ç§¯é—®é¢˜ï¼ŒRabbitMQçš„å†…å­˜å ç”¨å°±ä¼šè¶Šæ¥è¶Šé«˜ï¼Œç›´åˆ°è§¦å‘å†…å­˜é¢„è­¦ä¸Šé™ã€‚æ­¤æ—¶RabbitMQä¼šå°†å†…å­˜æ¶ˆæ¯åˆ·åˆ°ç£ç›˜ä¸Šï¼Œè¿™ä¸ªè¡Œä¸ºæˆä¸ºPageOut. PageOutä¼šè€—è´¹ä¸€æ®µæ—¶é—´ï¼Œå¹¶ä¸”ä¼šé˜»å¡é˜Ÿåˆ—è¿›ç¨‹ã€‚å› æ­¤åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­RabbitMQä¸ä¼šå†å¤„ç†æ–°çš„æ¶ˆæ¯ï¼Œç”Ÿäº§è€…çš„æ‰€æœ‰è¯·æ±‚éƒ½ä¼šè¢«é˜»å¡ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä»RabbitMQçš„3.6.0ç‰ˆæœ¬å¼€å§‹ï¼Œå°±å¢åŠ äº†Lazy Queuesçš„æ¨¡å¼ï¼Œä¹Ÿå°±æ˜¯æƒ°æ€§é˜Ÿåˆ—ã€‚æƒ°æ€§é˜Ÿåˆ—çš„ç‰¹å¾å¦‚ä¸‹ï¼š<br>æ¥æ”¶åˆ°æ¶ˆæ¯åç›´æ¥å­˜å…¥ç£ç›˜è€Œéå†…å­˜<br>æ¶ˆè´¹è€…è¦æ¶ˆè´¹æ¶ˆæ¯æ—¶æ‰ä¼šä»ç£ç›˜ä¸­è¯»å–å¹¶åŠ è½½åˆ°å†…å­˜ï¼ˆä¹Ÿå°±æ˜¯æ‡’åŠ è½½ï¼‰<br>æ”¯æŒæ•°ç™¾ä¸‡æ¡çš„æ¶ˆæ¯å­˜å‚¨</p></li><li><p>æ¶ˆè´¹è€…å¯é æ€§ï¼Œmqæä¾›äº†æ¶ˆè´¹è€…ç¡®è®¤æœºåˆ¶ï¼Œå½“æ¶ˆè´¹è€…å¤„ç†æ¶ˆæ¯ç»“æŸåï¼Œåº”è¯¥å‘mqå‘é€ä¸€ä¸ªå›æ‰§å‘Šè¯‰mqæ¶ˆæ¯å¤„ç†çŠ¶æ€ï¼Œæœ‰ä¸‰ç§å¯é€‰å€¼ackï¼ŒæˆåŠŸå¤„ç†ï¼Œåˆ é™¤æ¶ˆæ¯ nackå¤„ç†å¤±è´¥ å†æ¬¡æŠ•é€’æ¶ˆæ¯  rejectå¤„ç†å¤±è´¥å¹¶æ‹’ç»æ¶ˆæ¯ åˆ é™¤æ¶ˆæ¯ã€‚springamqpé€šè¿‡é…ç½®æ–‡ä»¶è®¾ç½®äº†ackå¤„ç†æ–¹å¼ï¼Œå¦‚æœä¸šåŠ¡å¼‚å¸¸è¿”å›nackï¼Œæ¶ˆæ¯å¤„ç†æˆ–ç±»å‹æ£€éªŒå¼‚å¸¸ï¼Œè¿”å›rejectã€‚å½“æ¶ˆè´¹è€…å‡ºç°ä¸€åœºåæ¶ˆæ¯ä¼šä¸æ–­ä»å…¥é˜Ÿå†é‡æ–°å‘é€ç»™æ¶ˆè´¹è€…ï¼Œå¦‚æœä¾ç„¶å‡ºé”™ä¼šå†æ¬¡å…¥é˜Ÿï¼Œç›´åˆ°å¤„ç†æˆåŠŸä¸ºæ­¢ã€‚æç«¯æƒ…å†µä¼šä¸€ç›´æ— æ³•æ‰§è¡ŒæˆåŠŸæ¶ˆæ¯å°±ä¼šä¸€ç›´å¾ªç¯ï¼Œspringæä¾›äº†æ¶ˆè´¹è€…å¤±è´¥é‡è¯•æœºåˆ¶ï¼Œå¯ä»¥è®¾ç½®å¤±è´¥é‡è¯•æ¬¡æ•°ã€‚å½“ä»äº‹è¾¾åˆ°æœ€å¤§æ¬¡æ•°çš„æ—¶å€™springä¼šè¿”å›rejectæ¶ˆæ¯ä¼šè¢«ä¸¢å¼ƒã€‚ä½†æ˜¯è¿™å¯¹äºæ¶ˆæ¯å¯é æ€§è¦æ±‚è¾ƒé«˜çš„ä¸šåŠ¡åœºæ™¯ä¸å¤ªå¥½ï¼Œå› æ­¤springå…è®¸æˆ‘ä»¬è‡ªå®šä¹‰é‡è¯•æ¬¡æ•°è€—å°½åçš„æ¶ˆæ¯å¤„ç†ç­–ç•¥ï¼Œé€šè¿‡messageRecoveryæ¥å£å®šä¹‰ï¼Œæœ‰ä¸‰ä¸ªå®ç°ï¼Œåˆ†åˆ«æ˜¯ç›´æ¥rejectï¼Œè¿”å›nacké‡æ–°å…¥é˜Ÿï¼Œå°†å¤±è´¥æ¶ˆæ¯æŠ•é€’åˆ°æŒ‡å®šäº¤æ¢æœºï¼Œæ˜¾ç„¶ç¬¬ä¸‰ç§æ¯”è¾ƒå¥½ï¼Œåç»­å¯ä»¥äººå·¥ä¸“é—¨å¤„ç†è¯¥é˜Ÿåˆ—ä¸­å­˜æ”¾çš„å¤±è´¥æ¶ˆæ¯ã€‚<br><strong>ä¸šåŠ¡çš„å¹‚ç­‰æ€§</strong>ï¼Œä¸šåŠ¡çš„å¹‚ç­‰æ€§æ˜¯æŒ‡åŒä¸€ä¸ªä¸šåŠ¡æ‰§è¡Œå¤šæ¬¡å’Œæ‰§è¡Œä¸€æ¬¡ç»™ä¸šåŠ¡çŠ¶æ€å½±å“æ˜¯ä¸€è‡´çš„ã€‚ä½†æ˜¯åƒæ•°æ®æ›´æ–°å¾€å¾€ä¸æ˜¯å¹‚ç­‰æ€§çš„ï¼Œé‡å¤æ‰§è¡Œä¼šæœ‰ä¸ä¸€æ ·çš„ç»“æœã€‚ä»£å…¥æˆ‘ä»¬mqä¸­ï¼Œå…¶å®å°±æ˜¯æ¶ˆæ¯å› ä¸ºæŸç§åŸå› è¢«æ¶ˆè´¹è€…é‡å¤æ¶ˆè´¹äº†å¯¼è‡´å‡ºç°äº†é—®é¢˜ã€‚æ¯”å¦‚è¿™ä¸ªåœºæ™¯ï¼Œç”Ÿäº§è€…å‘é€æ”¯ä»˜è®¢å•æ¶ˆæ¯ï¼Œæ­¤æ—¶ä¿®æ”¹äº†è®¢å•çŠ¶æ€ä¸ºå·²æ”¯ä»˜å¹¶æ‰£å‡åº“å­˜ï¼Œä½†æ˜¯å› ä¸ºç½‘ç»œæ•…éšœç”Ÿäº§è€…æ²¡æœ‰æ”¶åˆ°å¾—åˆ°ç¡®è®¤ï¼Œç”Ÿäº§è€…å°±ä¼šéš”ä¸€æ®µæ—¶é—´å†å‘é€ä¸€æ¬¡è¯·æ±‚ï¼Œä½†æ˜¯åœ¨è¯·æ±‚å‘é€ä¹‹å‰ï¼Œç”¨æˆ·é€€æ¬¾äº†ï¼Œè®¢å•ä¿®æ”¹æˆå·²é€€æ¬¾ï¼Œæ­¤æ—¶æ¶ˆæ¯å‘è¿‡æ¥åˆæ”¹æˆå·²æ”¯ä»˜å°±å‡ºç°é—®é¢˜äº†ã€‚è§£å†³æ–¹å¼åˆ†ä¸¤ç§ï¼Œç¬¬ä¸€ç§æºå¸¦ä¸šåŠ¡idï¼Œç”Ÿäº§è€…ç»™æ¶ˆæ¯æºå¸¦idï¼Œå½“æ¶ˆè´¹è€…æ”¶åˆ°æ¶ˆæ¯æŠŠidå­˜å…¥æ•°æ®åº“ä¸­ï¼Œç”Ÿäº§è€…å†å‘é€æ¶ˆæ¯è¿‡æ¥ï¼Œåˆ¤æ–­æ•°æ®åº“ä¸­æ˜¯å¦æœ‰è¯¥idï¼Œæœ‰çš„è¯å°±æ˜¯åˆ¤æ–­é‡å¤æ¶ˆè´¹ã€‚ç¬¬äºŒç§æ˜¯ä¸šåŠ¡åˆ¤æ–­ï¼Œæ ¹æ®ä¸šåŠ¡æœ¬èº«çš„é€»è¾‘æˆ–çŠ¶æ€åˆ¤æ–­æ˜¯å¦æ˜¯é‡å¤çš„è¯·æ±‚æˆ–æ¶ˆæ¯1ï¼Œæ¯”å¦‚ä¿®æ”¹è®¢å•çš„æ—¶å€™åˆ¤æ–­è®¢å•idçŠ¶æ€æ˜¯å¦æ˜¯å·²æ”¯ä»˜ï¼Œåº“å­˜æ˜¯å¦å·²ç»æ‰£å‡è¿‡ã€‚æœ€åå°±æ˜¯<strong>å…œåº•æ–¹æ¡ˆ</strong>ï¼ŒåŠ å‡å¦‚MQçœŸçš„æ¶ˆæ¯é€šçŸ¥å¤±è´¥äº†ï¼Œæˆ‘ä»¬è¦è®¾ç½®å…œåº•æ–¹æ¡ˆï¼Œæ¯”å¦‚MQé€šçŸ¥ä¸ä¸€å®šå‘é€åˆ°äº¤æ˜“æœåŠ¡ï¼Œé‚£äº¤æ˜“æœåŠ¡å°±å¯ä»¥ä¸»åŠ¨å»æŸ¥æ”¯ä»˜çŠ¶æ€ï¼Œè¿™é‡Œå¯ä»¥è®¾ç½®spring taskå®šæ—¶ä»»åŠ¡å®šæœŸæŸ¥è¯¢ã€‚</p></li></ol>]]></content>
    
    
    <summary type="html">MQä¸ªäººç†è§£å£è¿°ã€åŒ…æ‹¬MQã€RabbitMQã€å¦‚ä½•ä¿è¯å¯é æ€§ç­‰ç­‰</summary>
    
    
    
    <category term="å­¦ä¹ ç¬”è®°" scheme="https://u7u7.top/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    
    <category term="å¾®æœåŠ¡" scheme="https://u7u7.top/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"/>
    
    <category term="Java" scheme="https://u7u7.top/tags/Java/"/>
    
    <category term="ä¸ªäººç†è§£" scheme="https://u7u7.top/tags/%E4%B8%AA%E4%BA%BA%E7%90%86%E8%A7%A3/"/>
    
    <category term="MQ" scheme="https://u7u7.top/tags/MQ/"/>
    
  </entry>
  
  <entry>
    <title>MQé«˜çº§</title>
    <link href="https://u7u7.top/posts/MQHigh.html"/>
    <id>https://u7u7.top/posts/MQHigh.html</id>
    <published>2025-08-24T04:00:25.000Z</published>
    <updated>2025-08-25T01:40:49.965Z</updated>
    
    <content type="html"><![CDATA[<h1 id="1-å‘é€è€…çš„å¯é æ€§">1.å‘é€è€…çš„å¯é æ€§</h1><p>é¦–å…ˆï¼Œæˆ‘ä»¬ä¸€èµ·åˆ†æä¸€ä¸‹æ¶ˆæ¯ä¸¢å¤±çš„å¯èƒ½æ€§æœ‰å“ªäº›ã€‚</p><p>æ¶ˆæ¯ä»å‘é€è€…å‘é€æ¶ˆæ¯ï¼Œåˆ°æ¶ˆè´¹è€…å¤„ç†æ¶ˆæ¯ï¼Œéœ€è¦ç»è¿‡çš„æµç¨‹æ˜¯è¿™æ ·çš„ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/diagram.png" alt=""></p><p>æ¶ˆæ¯ä»ç”Ÿäº§è€…åˆ°æ¶ˆè´¹è€…çš„æ¯ä¸€æ­¥éƒ½å¯èƒ½å¯¼è‡´æ¶ˆæ¯ä¸¢å¤±ï¼š</p><ul><li><p>å‘é€æ¶ˆæ¯æ—¶ä¸¢å¤±ï¼š</p><ul><li><p>ç”Ÿäº§è€…å‘é€æ¶ˆæ¯æ—¶è¿æ¥MQå¤±è´¥</p></li><li><p>ç”Ÿäº§è€…å‘é€æ¶ˆæ¯åˆ°è¾¾MQåæœªæ‰¾åˆ°<code>Exchange</code></p></li><li><p>ç”Ÿäº§è€…å‘é€æ¶ˆæ¯åˆ°è¾¾MQçš„<code>Exchange</code>åï¼Œæœªæ‰¾åˆ°åˆé€‚çš„<code>Queue</code></p></li><li><p>æ¶ˆæ¯åˆ°è¾¾MQåï¼Œå¤„ç†æ¶ˆæ¯çš„è¿›ç¨‹å‘ç”Ÿå¼‚å¸¸</p></li></ul></li><li><p>MQå¯¼è‡´æ¶ˆæ¯ä¸¢å¤±ï¼š</p><ul><li>æ¶ˆæ¯åˆ°è¾¾MQï¼Œä¿å­˜åˆ°é˜Ÿåˆ—åï¼Œå°šæœªæ¶ˆè´¹å°±çªç„¶å®•æœº</li></ul></li><li><p>æ¶ˆè´¹è€…å¤„ç†æ¶ˆæ¯æ—¶ï¼š</p><ul><li><p>æ¶ˆæ¯æ¥æ”¶åå°šæœªå¤„ç†çªç„¶å®•æœº</p></li><li><p>æ¶ˆæ¯æ¥æ”¶åå¤„ç†è¿‡ç¨‹ä¸­æŠ›å‡ºå¼‚å¸¸</p></li></ul></li></ul><p>ç»¼ä¸Šï¼Œæˆ‘ä»¬è¦è§£å†³æ¶ˆæ¯ä¸¢å¤±é—®é¢˜ï¼Œä¿è¯MQçš„å¯é æ€§ï¼Œå°±å¿…é¡»ä»3ä¸ªæ–¹é¢å…¥æ‰‹ï¼š</p><ul><li><p>ç¡®ä¿ç”Ÿäº§è€…ä¸€å®šæŠŠæ¶ˆæ¯å‘é€åˆ°MQ</p></li><li><p>ç¡®ä¿MQä¸ä¼šå°†æ¶ˆæ¯å¼„ä¸¢</p></li><li><p>ç¡®ä¿æ¶ˆè´¹è€…ä¸€å®šè¦å¤„ç†æ¶ˆæ¯</p></li></ul><p>è¿™ä¸€ç« æˆ‘ä»¬å…ˆæ¥çœ‹å¦‚ä½•ç¡®ä¿ç”Ÿäº§è€…ä¸€å®šèƒ½æŠŠæ¶ˆæ¯å‘é€åˆ°MQã€‚</p><h2 id="1-1-ç”Ÿäº§è€…é‡è¯•æœºåˆ¶">1.1.ç”Ÿäº§è€…é‡è¯•æœºåˆ¶</h2><p>é¦–å…ˆç¬¬ä¸€ç§æƒ…å†µï¼Œå°±æ˜¯ç”Ÿäº§è€…å‘é€æ¶ˆæ¯æ—¶ï¼Œå‡ºç°äº†ç½‘ç»œæ•…éšœï¼Œå¯¼è‡´ä¸MQçš„è¿æ¥ä¸­æ–­ã€‚</p><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒSpringAMQPæä¾›çš„æ¶ˆæ¯å‘é€æ—¶çš„é‡è¯•æœºåˆ¶ã€‚å³ï¼šå½“<code>RabbitTemplate</code>ä¸MQè¿æ¥è¶…æ—¶åï¼Œå¤šæ¬¡é‡è¯•ã€‚</p><p>ä¿®æ”¹<code>publisher</code>æ¨¡å—çš„<code>application.yaml</code>æ–‡ä»¶ï¼Œæ·»åŠ ä¸‹é¢çš„å†…å®¹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">rabbitmq:</span></span><br><span class="line">    <span class="attr">connection-timeout:</span> <span class="string">1s</span> <span class="comment"># è®¾ç½®MQçš„è¿æ¥è¶…æ—¶æ—¶é—´</span></span><br><span class="line">    <span class="attr">template:</span></span><br><span class="line">      <span class="attr">retry:</span></span><br><span class="line">        <span class="attr">enabled:</span> <span class="literal">true</span> <span class="comment"># å¼€å¯è¶…æ—¶é‡è¯•æœºåˆ¶</span></span><br><span class="line">        <span class="attr">initial-interval:</span> <span class="string">1000ms</span> <span class="comment"># å¤±è´¥åçš„åˆå§‹ç­‰å¾…æ—¶é—´</span></span><br><span class="line">        <span class="attr">multiplier:</span> <span class="number">1</span> <span class="comment"># å¤±è´¥åä¸‹æ¬¡çš„ç­‰å¾…æ—¶é•¿å€æ•°ï¼Œä¸‹æ¬¡ç­‰å¾…æ—¶é•¿ = initial-interval * multiplier</span></span><br><span class="line">        <span class="attr">max-attempts:</span> <span class="number">3</span> <span class="comment"># æœ€å¤§é‡è¯•æ¬¡æ•°</span></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬åˆ©ç”¨å‘½ä»¤åœæ‰RabbitMQæœåŠ¡ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker stop mq</span><br></pre></td></tr></table></figure><p>ç„¶åæµ‹è¯•å‘é€ä¸€æ¡æ¶ˆæ¯ï¼Œä¼šå‘ç°ä¼šæ¯éš”1ç§’é‡è¯•1æ¬¡ï¼Œæ€»å…±é‡è¯•äº†3æ¬¡ã€‚æ¶ˆæ¯å‘é€çš„è¶…æ—¶é‡è¯•æœºåˆ¶é…ç½®æˆåŠŸäº†ï¼</p><p><strong>æ³¨æ„</strong>ï¼šå½“ç½‘ç»œä¸ç¨³å®šçš„æ—¶å€™ï¼Œåˆ©ç”¨é‡è¯•æœºåˆ¶å¯ä»¥æœ‰æ•ˆæé«˜æ¶ˆæ¯å‘é€çš„æˆåŠŸç‡ã€‚ä¸è¿‡SpringAMQPæä¾›çš„é‡è¯•æœºåˆ¶æ˜¯<strong>é˜»å¡å¼</strong>çš„é‡è¯•ï¼Œä¹Ÿå°±æ˜¯è¯´å¤šæ¬¡é‡è¯•ç­‰å¾…çš„è¿‡ç¨‹ä¸­ï¼Œå½“å‰çº¿ç¨‹æ˜¯è¢«é˜»å¡çš„ã€‚</p><p>å¦‚æœå¯¹äºä¸šåŠ¡æ€§èƒ½æœ‰è¦æ±‚ï¼Œå»ºè®®ç¦ç”¨é‡è¯•æœºåˆ¶ã€‚å¦‚æœä¸€å®šè¦ä½¿ç”¨ï¼Œè¯·åˆç†é…ç½®ç­‰å¾…æ—¶é•¿å’Œé‡è¯•æ¬¡æ•°ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥è€ƒè™‘ä½¿ç”¨å¼‚æ­¥çº¿ç¨‹æ¥æ‰§è¡Œå‘é€æ¶ˆæ¯çš„ä»£ç ã€‚</p><h2 id="1-2-ç”Ÿäº§è€…ç¡®è®¤æœºåˆ¶">1.2.ç”Ÿäº§è€…ç¡®è®¤æœºåˆ¶</h2><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œåªè¦ç”Ÿäº§è€…ä¸MQä¹‹é—´çš„ç½‘è·¯è¿æ¥é¡ºç•…ï¼ŒåŸºæœ¬ä¸ä¼šå‡ºç°å‘é€æ¶ˆæ¯ä¸¢å¤±çš„æƒ…å†µï¼Œå› æ­¤å¤§å¤šæ•°æƒ…å†µä¸‹æˆ‘ä»¬æ— éœ€è€ƒè™‘è¿™ç§é—®é¢˜ã€‚</p><p>ä¸è¿‡ï¼Œåœ¨å°‘æ•°æƒ…å†µä¸‹ï¼Œä¹Ÿä¼šå‡ºç°æ¶ˆæ¯å‘é€åˆ°MQä¹‹åä¸¢å¤±çš„ç°è±¡ï¼Œæ¯”å¦‚ï¼š</p><ul><li><p>MQå†…éƒ¨å¤„ç†æ¶ˆæ¯çš„è¿›ç¨‹å‘ç”Ÿäº†å¼‚å¸¸</p></li><li><p>ç”Ÿäº§è€…å‘é€æ¶ˆæ¯åˆ°è¾¾MQåæœªæ‰¾åˆ°<code>Exchange</code></p></li><li><p>ç”Ÿäº§è€…å‘é€æ¶ˆæ¯åˆ°è¾¾MQçš„<code>Exchange</code>åï¼Œæœªæ‰¾åˆ°åˆé€‚çš„<code>Queue</code>ï¼Œå› æ­¤æ— æ³•è·¯ç”±</p></li></ul><p>é’ˆå¯¹ä¸Šè¿°æƒ…å†µï¼ŒRabbitMQæä¾›äº†ç”Ÿäº§è€…æ¶ˆæ¯ç¡®è®¤æœºåˆ¶ï¼ŒåŒ…æ‹¬<code>Publisher Confirm</code>å’Œ<code>Publisher Return</code>ä¸¤ç§ã€‚åœ¨å¼€å¯ç¡®è®¤æœºåˆ¶çš„æƒ…å†µä¸‹ï¼Œå½“ç”Ÿäº§è€…å‘é€æ¶ˆæ¯ç»™MQåï¼ŒMQä¼šæ ¹æ®æ¶ˆæ¯å¤„ç†çš„æƒ…å†µè¿”å›ä¸åŒçš„<strong>å›æ‰§</strong>ã€‚</p><p>å…·ä½“å¦‚å›¾æ‰€ç¤ºï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/VohQbYwSlo8R6AxfinGcLNq6nld.png" alt=""></p><p>æ€»ç»“å¦‚ä¸‹ï¼š</p><ul><li><p>å½“æ¶ˆæ¯æŠ•é€’åˆ°MQï¼Œä½†æ˜¯è·¯ç”±å¤±è´¥æ—¶ï¼Œé€šè¿‡<strong>Publisher Return</strong>è¿”å›å¼‚å¸¸ä¿¡æ¯ï¼ŒåŒæ—¶è¿”å›ackçš„ç¡®è®¤ä¿¡æ¯ï¼Œä»£è¡¨æŠ•é€’æˆåŠŸ</p></li><li><p>ä¸´æ—¶æ¶ˆæ¯æŠ•é€’åˆ°äº†MQï¼Œå¹¶ä¸”å…¥é˜ŸæˆåŠŸï¼Œè¿”å›ACKï¼Œå‘ŠçŸ¥æŠ•é€’æˆåŠŸ</p></li><li><p>æŒä¹…æ¶ˆæ¯æŠ•é€’åˆ°äº†MQï¼Œå¹¶ä¸”å…¥é˜Ÿå®ŒæˆæŒä¹…åŒ–ï¼Œè¿”å›ACK ï¼Œå‘ŠçŸ¥æŠ•é€’æˆåŠŸ</p></li><li><p>å…¶å®ƒæƒ…å†µéƒ½ä¼šè¿”å›NACKï¼Œå‘ŠçŸ¥æŠ•é€’å¤±è´¥</p></li></ul><p>å…¶ä¸­<code>ack</code>å’Œ<code>nack</code>å±äº<strong>Publisher Confirm</strong>æœºåˆ¶ï¼Œ<code>ack</code>æ˜¯æŠ•é€’æˆåŠŸï¼›<code>nack</code>æ˜¯æŠ•é€’å¤±è´¥ã€‚è€Œ<code>return</code>åˆ™å±äº<strong>Publisher Return</strong>æœºåˆ¶ã€‚</p><p>é»˜è®¤ä¸¤ç§æœºåˆ¶éƒ½æ˜¯å…³é—­çŠ¶æ€ï¼Œéœ€è¦é€šè¿‡é…ç½®æ–‡ä»¶æ¥å¼€å¯ã€‚</p><h2 id="1-3-å®ç°ç”Ÿäº§è€…ç¡®è®¤">1.3.å®ç°ç”Ÿäº§è€…ç¡®è®¤</h2><h3 id="1-3-1-å¼€å¯ç”Ÿäº§è€…ç¡®è®¤">1.3.1.å¼€å¯ç”Ÿäº§è€…ç¡®è®¤</h3><p>åœ¨publisheræ¨¡å—çš„<code>application.yaml</code>ä¸­æ·»åŠ é…ç½®ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">rabbitmq:</span></span><br><span class="line">    <span class="attr">publisher-confirm-type:</span> <span class="string">correlated</span> <span class="comment"># å¼€å¯publisher confirmæœºåˆ¶ï¼Œå¹¶è®¾ç½®confirmç±»å‹</span></span><br><span class="line">    <span class="attr">publisher-returns:</span> <span class="literal">true</span> <span class="comment"># å¼€å¯publisher returnæœºåˆ¶</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œ<code>publisher-confirm-type</code>æœ‰ä¸‰ç§æ¨¡å¼å¯é€‰ï¼š</p><ul><li><p><code>none</code>ï¼šå…³é—­confirmæœºåˆ¶</p></li><li><p><code>simple</code>ï¼šåŒæ­¥é˜»å¡ç­‰å¾…MQçš„å›æ‰§</p></li><li><p><code>correlated</code>ï¼šMQå¼‚æ­¥å›è°ƒè¿”å›å›æ‰§</p></li></ul><p>ä¸€èˆ¬æˆ‘ä»¬æ¨èä½¿ç”¨<code>correlated</code>ï¼Œå›è°ƒæœºåˆ¶ã€‚</p><h3 id="1-3-2-å®šä¹‰ReturnCallback">1.3.2.å®šä¹‰ReturnCallback</h3><p>æ¯ä¸ª<code>RabbitTemplate</code>åªèƒ½é…ç½®ä¸€ä¸ª<code>ReturnCallback</code>ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥åœ¨é…ç½®ç±»ä¸­ç»Ÿä¸€è®¾ç½®ã€‚æˆ‘ä»¬åœ¨publisheræ¨¡å—å®šä¹‰ä¸€ä¸ªé…ç½®ç±»ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/VtLLb0dSFo6XOdx1EEiczVvbnvc.png" alt=""></p><p>å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.publisher.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.core.ReturnedMessage;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.rabbit.core.RabbitTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.PostConstruct;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MqConfig</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> RabbitTemplate rabbitTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span>&#123;</span><br><span class="line">        rabbitTemplate.setReturnsCallback(<span class="keyword">new</span> <span class="title class_">RabbitTemplate</span>.ReturnsCallback() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">returnedMessage</span><span class="params">(ReturnedMessage returned)</span> &#123;</span><br><span class="line">                log.error(<span class="string">&quot;è§¦å‘return callback,&quot;</span>);</span><br><span class="line">                log.debug(<span class="string">&quot;exchange: &#123;&#125;&quot;</span>, returned.getExchange());</span><br><span class="line">                log.debug(<span class="string">&quot;routingKey: &#123;&#125;&quot;</span>, returned.getRoutingKey());</span><br><span class="line">                log.debug(<span class="string">&quot;message: &#123;&#125;&quot;</span>, returned.getMessage());</span><br><span class="line">                log.debug(<span class="string">&quot;replyCode: &#123;&#125;&quot;</span>, returned.getReplyCode());</span><br><span class="line">                log.debug(<span class="string">&quot;replyText: &#123;&#125;&quot;</span>, returned.getReplyText());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1-3-3-å®šä¹‰ConfirmCallback">1.3.3.å®šä¹‰ConfirmCallback</h3><p>ç”±äºæ¯ä¸ªæ¶ˆæ¯å‘é€æ—¶çš„å¤„ç†é€»è¾‘ä¸ä¸€å®šç›¸åŒï¼Œå› æ­¤ConfirmCallbackéœ€è¦åœ¨æ¯æ¬¡å‘æ¶ˆæ¯æ—¶å®šä¹‰ã€‚å…·ä½“æ¥è¯´ï¼Œæ˜¯åœ¨è°ƒç”¨RabbitTemplateä¸­çš„convertAndSendæ–¹æ³•æ—¶ï¼Œå¤šä¼ é€’ä¸€ä¸ªå‚æ•°ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/E2IcbQ9bQoCDTVx8m8GciifXnKe.png" alt=""></p><p>è¿™é‡Œçš„CorrelationDataä¸­åŒ…å«ä¸¤ä¸ªæ ¸å¿ƒçš„ä¸œè¥¿ï¼š</p><ul><li><p><code>id</code>ï¼šæ¶ˆæ¯çš„å”¯ä¸€æ ‡ç¤ºï¼ŒMQå¯¹ä¸åŒçš„æ¶ˆæ¯çš„å›æ‰§ä»¥æ­¤åšåˆ¤æ–­ï¼Œé¿å…æ··æ·†</p></li><li><p><code>SettableListenableFuture</code>ï¼šå›æ‰§ç»“æœçš„Futureå¯¹è±¡</p></li></ul><p>å°†æ¥MQçš„å›æ‰§å°±ä¼šé€šè¿‡è¿™ä¸ª<code>Future</code>æ¥è¿”å›ï¼Œæˆ‘ä»¬å¯ä»¥æå‰ç»™<code>CorrelationData</code>ä¸­çš„<code>Future</code>æ·»åŠ å›è°ƒå‡½æ•°æ¥å¤„ç†æ¶ˆæ¯å›æ‰§ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/TR81bF8E3ocm72xkaqHcuN9Nnph.png" alt=""></p><p>æˆ‘ä»¬æ–°å»ºä¸€ä¸ªæµ‹è¯•ï¼Œå‘ç³»ç»Ÿè‡ªå¸¦çš„äº¤æ¢æœºå‘é€æ¶ˆæ¯ï¼Œå¹¶ä¸”æ·»åŠ <code>ConfirmCallback</code>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testPublisherConfirm</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// 1.åˆ›å»ºCorrelationData</span></span><br><span class="line">    <span class="type">CorrelationData</span> <span class="variable">cd</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CorrelationData</span>();</span><br><span class="line">    <span class="comment">// 2.ç»™Futureæ·»åŠ ConfirmCallback</span></span><br><span class="line">    cd.getFuture().addCallback(<span class="keyword">new</span> <span class="title class_">ListenableFutureCallback</span>&lt;CorrelationData.Confirm&gt;() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onFailure</span><span class="params">(Throwable ex)</span> &#123;</span><br><span class="line">            <span class="comment">// 2.1.Futureå‘ç”Ÿå¼‚å¸¸æ—¶çš„å¤„ç†é€»è¾‘ï¼ŒåŸºæœ¬ä¸ä¼šè§¦å‘</span></span><br><span class="line">            log.error(<span class="string">&quot;send message fail&quot;</span>, ex);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onSuccess</span><span class="params">(CorrelationData.Confirm result)</span> &#123;</span><br><span class="line">            <span class="comment">// 2.2.Futureæ¥æ”¶åˆ°å›æ‰§çš„å¤„ç†é€»è¾‘ï¼Œå‚æ•°ä¸­çš„resultå°±æ˜¯å›æ‰§å†…å®¹</span></span><br><span class="line">            <span class="keyword">if</span>(result.isAck())&#123; <span class="comment">// result.isAck()ï¼Œbooleanç±»å‹ï¼Œtrueä»£è¡¨ackå›æ‰§ï¼Œfalse ä»£è¡¨ nackå›æ‰§</span></span><br><span class="line">                log.debug(<span class="string">&quot;å‘é€æ¶ˆæ¯æˆåŠŸï¼Œæ”¶åˆ° ack!&quot;</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123; <span class="comment">// result.getReason()ï¼ŒStringç±»å‹ï¼Œè¿”å›nackæ—¶çš„å¼‚å¸¸æè¿°</span></span><br><span class="line">                log.error(<span class="string">&quot;å‘é€æ¶ˆæ¯å¤±è´¥ï¼Œæ”¶åˆ° nack, reason : &#123;&#125;&quot;</span>, result.getReason());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// 3.å‘é€æ¶ˆæ¯</span></span><br><span class="line">    rabbitTemplate.convertAndSend(<span class="string">&quot;hmall.direct&quot;</span>, <span class="string">&quot;q&quot;</span>, <span class="string">&quot;hello&quot;</span>, cd);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/YmF2bo8C8ot7CexZXopcsIyTnYc.png" alt=""></p><p>å¯ä»¥çœ‹åˆ°ï¼Œç”±äºä¼ é€’çš„<code>RoutingKey</code>æ˜¯é”™è¯¯çš„ï¼Œè·¯ç”±å¤±è´¥åï¼Œè§¦å‘äº†<code>return callback</code>ï¼ŒåŒæ—¶ä¹Ÿæ”¶åˆ°äº†ackã€‚</p><p>å½“æˆ‘ä»¬ä¿®æ”¹ä¸ºæ­£ç¡®çš„<code>RoutingKey</code>ä»¥åï¼Œå°±ä¸ä¼šè§¦å‘<code>return callback</code>äº†ï¼Œåªæ”¶åˆ°ackã€‚</p><p>è€Œå¦‚æœè¿äº¤æ¢æœºéƒ½æ˜¯é”™è¯¯çš„ï¼Œåˆ™åªä¼šæ”¶åˆ°nackã€‚</p><blockquote><p><strong>æ³¨æ„</strong>ï¼š</p><p>å¼€å¯ç”Ÿäº§è€…ç¡®è®¤æ¯”è¾ƒæ¶ˆè€—MQæ€§èƒ½ï¼Œä¸€èˆ¬ä¸å»ºè®®å¼€å¯ã€‚è€Œä¸”å¤§å®¶æ€è€ƒä¸€ä¸‹è§¦å‘ç¡®è®¤çš„å‡ ç§æƒ…å†µï¼š</p><ul><li><p>è·¯ç”±å¤±è´¥ï¼šä¸€èˆ¬æ˜¯å› ä¸ºRoutingKeyé”™è¯¯å¯¼è‡´ï¼Œå¾€å¾€æ˜¯ç¼–ç¨‹å¯¼è‡´</p></li><li><p>äº¤æ¢æœºåç§°é”™è¯¯ï¼šåŒæ ·æ˜¯ç¼–ç¨‹é”™è¯¯å¯¼è‡´</p></li><li><p>MQå†…éƒ¨æ•…éšœï¼šè¿™ç§éœ€è¦å¤„ç†ï¼Œä½†æ¦‚ç‡å¾€å¾€è¾ƒä½ã€‚å› æ­¤åªæœ‰å¯¹æ¶ˆæ¯å¯é æ€§è¦æ±‚éå¸¸é«˜çš„ä¸šåŠ¡æ‰éœ€è¦å¼€å¯ï¼Œè€Œä¸”ä»…ä»…éœ€è¦å¼€å¯ConfirmCallbackå¤„ç†nackå°±å¯ä»¥äº†ã€‚</p></li></ul></blockquote><h1 id="2-MQçš„å¯é æ€§">2.MQçš„å¯é æ€§</h1><p>æ¶ˆæ¯åˆ°è¾¾MQä»¥åï¼Œå¦‚æœMQä¸èƒ½åŠæ—¶ä¿å­˜ï¼Œä¹Ÿä¼šå¯¼è‡´æ¶ˆæ¯ä¸¢å¤±ï¼Œæ‰€ä»¥MQçš„å¯é æ€§ä¹Ÿéå¸¸é‡è¦ã€‚</p><h2 id="2-1-æ•°æ®æŒä¹…åŒ–">2.1.æ•°æ®æŒä¹…åŒ–</h2><p>ä¸ºäº†æå‡æ€§èƒ½ï¼Œé»˜è®¤æƒ…å†µä¸‹MQçš„æ•°æ®éƒ½æ˜¯åœ¨å†…å­˜å­˜å‚¨çš„ä¸´æ—¶æ•°æ®ï¼Œé‡å¯åå°±ä¼šæ¶ˆå¤±ã€‚ä¸ºäº†ä¿è¯æ•°æ®çš„å¯é æ€§ï¼Œå¿…é¡»é…ç½®æ•°æ®æŒä¹…åŒ–ï¼ŒåŒ…æ‹¬ï¼š</p><ul><li><p>äº¤æ¢æœºæŒä¹…åŒ–</p></li><li><p>é˜Ÿåˆ—æŒä¹…åŒ–</p></li><li><p>æ¶ˆæ¯æŒä¹…åŒ–</p></li></ul><p>æˆ‘ä»¬ä»¥æ§åˆ¶å°ç•Œé¢ä¸ºä¾‹æ¥è¯´æ˜ã€‚</p><h3 id="2-1-1-äº¤æ¢æœºæŒä¹…åŒ–">2.1.1.äº¤æ¢æœºæŒä¹…åŒ–</h3><p>åœ¨æ§åˆ¶å°çš„<code>Exchanges</code>é¡µé¢ï¼Œæ·»åŠ äº¤æ¢æœºæ—¶å¯ä»¥é…ç½®äº¤æ¢æœºçš„<code>Durability</code>å‚æ•°ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/NPr8bcUqkoNVgIxP7ePct6thn4g.png" alt=""></p><p>è®¾ç½®ä¸º<code>Durable</code>å°±æ˜¯æŒä¹…åŒ–æ¨¡å¼ï¼Œ<code>Transient</code>å°±æ˜¯ä¸´æ—¶æ¨¡å¼ã€‚</p><h3 id="2-1-2-é˜Ÿåˆ—æŒä¹…åŒ–">2.1.2.é˜Ÿåˆ—æŒä¹…åŒ–</h3><p>åœ¨æ§åˆ¶å°çš„Queuesé¡µé¢ï¼Œæ·»åŠ é˜Ÿåˆ—æ—¶ï¼ŒåŒæ ·å¯ä»¥é…ç½®é˜Ÿåˆ—çš„<code>Durability</code>å‚æ•°ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/CxrxbP3awotxmkxSndlcE7iKnvd.png" alt=""></p><p>é™¤äº†æŒä¹…åŒ–ä»¥å¤–ï¼Œä½ å¯ä»¥çœ‹åˆ°é˜Ÿåˆ—è¿˜æœ‰å¾ˆå¤šå…¶å®ƒå‚æ•°ï¼Œæœ‰ä¸€äº›æˆ‘ä»¬ä¼šåœ¨åæœŸå­¦ä¹ ã€‚</p><h3 id="2-1-3-æ¶ˆæ¯æŒä¹…åŒ–">2.1.3.æ¶ˆæ¯æŒä¹…åŒ–</h3><p>åœ¨æ§åˆ¶å°å‘é€æ¶ˆæ¯çš„æ—¶å€™ï¼Œå¯ä»¥æ·»åŠ å¾ˆå¤šå‚æ•°ï¼Œè€Œæ¶ˆæ¯çš„æŒä¹…åŒ–æ˜¯è¦é…ç½®ä¸€ä¸ª<code>properties</code>ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/image.png" alt=""></p><blockquote><p><strong>è¯´æ˜</strong>ï¼šåœ¨å¼€å¯æŒä¹…åŒ–æœºåˆ¶ä»¥åï¼Œå¦‚æœåŒæ—¶è¿˜å¼€å¯äº†ç”Ÿäº§è€…ç¡®è®¤ï¼Œé‚£ä¹ˆMQä¼šåœ¨æ¶ˆæ¯æŒä¹…åŒ–ä»¥åæ‰å‘é€ACKå›æ‰§ï¼Œè¿›ä¸€æ­¥ç¡®ä¿æ¶ˆæ¯çš„å¯é æ€§ã€‚</p><p>ä¸è¿‡å‡ºäºæ€§èƒ½è€ƒè™‘ï¼Œä¸ºäº†å‡å°‘IOæ¬¡æ•°ï¼Œå‘é€åˆ°MQçš„æ¶ˆæ¯å¹¶ä¸æ˜¯é€æ¡æŒä¹…åŒ–åˆ°æ•°æ®åº“çš„ï¼Œè€Œæ˜¯æ¯éš”ä¸€æ®µæ—¶é—´æ‰¹é‡æŒä¹…åŒ–ã€‚ä¸€èˆ¬é—´éš”åœ¨100æ¯«ç§’å·¦å³ï¼Œè¿™å°±ä¼šå¯¼è‡´ACKæœ‰ä¸€å®šçš„å»¶è¿Ÿï¼Œå› æ­¤å»ºè®®ç”Ÿäº§è€…ç¡®è®¤å…¨éƒ¨é‡‡ç”¨å¼‚æ­¥æ–¹å¼ã€‚</p></blockquote><h2 id="2-2-LazyQueue">2.2.LazyQueue</h2><p>åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼ŒRabbitMQä¼šå°†æ¥æ”¶åˆ°çš„ä¿¡æ¯ä¿å­˜åœ¨å†…å­˜ä¸­ä»¥é™ä½æ¶ˆæ¯æ”¶å‘çš„å»¶è¿Ÿã€‚ä½†åœ¨æŸäº›ç‰¹æ®Šæƒ…å†µä¸‹ï¼Œè¿™ä¼šå¯¼è‡´æ¶ˆæ¯ç§¯å‹ï¼Œæ¯”å¦‚ï¼š</p><ul><li><p>æ¶ˆè´¹è€…å®•æœºæˆ–å‡ºç°ç½‘ç»œæ•…éšœ</p></li><li><p>æ¶ˆæ¯å‘é€é‡æ¿€å¢ï¼Œè¶…è¿‡äº†æ¶ˆè´¹è€…å¤„ç†é€Ÿåº¦</p></li><li><p>æ¶ˆè´¹è€…å¤„ç†ä¸šåŠ¡å‘ç”Ÿé˜»å¡</p></li></ul><p>ä¸€æ—¦å‡ºç°æ¶ˆæ¯å †ç§¯é—®é¢˜ï¼ŒRabbitMQçš„å†…å­˜å ç”¨å°±ä¼šè¶Šæ¥è¶Šé«˜ï¼Œç›´åˆ°è§¦å‘å†…å­˜é¢„è­¦ä¸Šé™ã€‚æ­¤æ—¶RabbitMQä¼šå°†å†…å­˜æ¶ˆæ¯åˆ·åˆ°ç£ç›˜ä¸Šï¼Œè¿™ä¸ªè¡Œä¸ºæˆä¸º<code>PageOut</code>. <code>PageOut</code>ä¼šè€—è´¹ä¸€æ®µæ—¶é—´ï¼Œå¹¶ä¸”ä¼šé˜»å¡é˜Ÿåˆ—è¿›ç¨‹ã€‚å› æ­¤åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­RabbitMQä¸ä¼šå†å¤„ç†æ–°çš„æ¶ˆæ¯ï¼Œç”Ÿäº§è€…çš„æ‰€æœ‰è¯·æ±‚éƒ½ä¼šè¢«é˜»å¡ã€‚</p><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä»RabbitMQçš„3.6.0ç‰ˆæœ¬å¼€å§‹ï¼Œå°±å¢åŠ äº†Lazy Queuesçš„æ¨¡å¼ï¼Œä¹Ÿå°±æ˜¯æƒ°æ€§é˜Ÿåˆ—ã€‚æƒ°æ€§é˜Ÿåˆ—çš„ç‰¹å¾å¦‚ä¸‹ï¼š</p><ul><li><p>æ¥æ”¶åˆ°æ¶ˆæ¯åç›´æ¥å­˜å…¥ç£ç›˜è€Œéå†…å­˜</p></li><li><p>æ¶ˆè´¹è€…è¦æ¶ˆè´¹æ¶ˆæ¯æ—¶æ‰ä¼šä»ç£ç›˜ä¸­è¯»å–å¹¶åŠ è½½åˆ°å†…å­˜ï¼ˆä¹Ÿå°±æ˜¯æ‡’åŠ è½½ï¼‰</p></li><li><p>æ”¯æŒæ•°ç™¾ä¸‡æ¡çš„æ¶ˆæ¯å­˜å‚¨</p></li></ul><p>è€Œåœ¨3.12ç‰ˆæœ¬ä¹‹åï¼ŒLazyQueueå·²ç»æˆä¸ºæ‰€æœ‰é˜Ÿåˆ—çš„é»˜è®¤æ ¼å¼ã€‚å› æ­¤å®˜æ–¹æ¨èå‡çº§MQä¸º3.12ç‰ˆæœ¬æˆ–è€…æ‰€æœ‰é˜Ÿåˆ—éƒ½è®¾ç½®ä¸ºLazyQueueæ¨¡å¼ã€‚</p><h3 id="2-2-1-æ§åˆ¶å°é…ç½®Lazyæ¨¡å¼">2.2.1.æ§åˆ¶å°é…ç½®Lazyæ¨¡å¼</h3><p>åœ¨æ·»åŠ é˜Ÿåˆ—çš„æ—¶å€™ï¼Œæ·»åŠ <code>x-queue-mod=lazy</code>å‚æ•°å³å¯è®¾ç½®é˜Ÿåˆ—ä¸ºLazyæ¨¡å¼ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/D7mmbzVySoa0VzxTQ6Ucbpl2nKb.png" alt=""></p><h3 id="2-2-2-ä»£ç é…ç½®Lazyæ¨¡å¼">2.2.2.ä»£ç é…ç½®Lazyæ¨¡å¼</h3><p>åœ¨åˆ©ç”¨SpringAMQPå£°æ˜é˜Ÿåˆ—çš„æ—¶å€™ï¼Œæ·»åŠ <code>x-queue-mod=lazy</code>å‚æ•°ä¹Ÿå¯è®¾ç½®é˜Ÿåˆ—ä¸ºLazyæ¨¡å¼ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> Queue <span class="title function_">lazyQueue</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> QueueBuilder</span><br><span class="line">            .durable(<span class="string">&quot;lazy.queue&quot;</span>)</span><br><span class="line">            .lazy() <span class="comment">// å¼€å¯Lazyæ¨¡å¼</span></span><br><span class="line">            .build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæ˜¯é€šè¿‡<code>QueueBuilder</code>çš„<code>lazy()</code>å‡½æ•°é…ç½®Lazyæ¨¡å¼ï¼Œåº•å±‚æºç å¦‚ä¸‹ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/EBkmbWPYIo1x2KxnEXUcWHcHn0U.png" alt=""></p><p>å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åŸºäºæ³¨è§£æ¥å£°æ˜é˜Ÿåˆ—å¹¶è®¾ç½®ä¸ºLazyæ¨¡å¼ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RabbitListener(queuesToDeclare = @Queue(</span></span><br><span class="line"><span class="meta">        name = &quot;lazy.queue&quot;,</span></span><br><span class="line"><span class="meta">        durable = &quot;true&quot;,</span></span><br><span class="line"><span class="meta">        arguments = @Argument(name = &quot;x-queue-mode&quot;, value = &quot;lazy&quot;)</span></span><br><span class="line"><span class="meta">))</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenLazyQueue</span><span class="params">(String msg)</span>&#123;</span><br><span class="line">    log.info(<span class="string">&quot;æ¥æ”¶åˆ° lazy.queueçš„æ¶ˆæ¯ï¼š&#123;&#125;&quot;</span>, msg);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-2-3-æ›´æ–°å·²æœ‰é˜Ÿåˆ—ä¸ºlazyæ¨¡å¼">2.2.3.æ›´æ–°å·²æœ‰é˜Ÿåˆ—ä¸ºlazyæ¨¡å¼</h3><p>å¯¹äºå·²ç»å­˜åœ¨çš„é˜Ÿåˆ—ï¼Œä¹Ÿå¯ä»¥é…ç½®ä¸ºlazyæ¨¡å¼ï¼Œä½†æ˜¯è¦é€šè¿‡è®¾ç½®policyå®ç°ã€‚</p><p>å¯ä»¥åŸºäºå‘½ä»¤è¡Œè®¾ç½®policyï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rabbitmqctl set_policy Lazy &quot;^lazy-queue$&quot; &#x27;&#123;&quot;queue-mode&quot;:&quot;lazy&quot;&#125;&#x27; --apply-to queues  </span><br></pre></td></tr></table></figure><p>å‘½ä»¤è§£è¯»ï¼š</p><ul><li><p><code>rabbitmqctl</code> ï¼šRabbitMQçš„å‘½ä»¤è¡Œå·¥å…·</p></li><li><p><code>set_policy</code> ï¼šæ·»åŠ ä¸€ä¸ªç­–ç•¥</p></li><li><p><code>Lazy</code> ï¼šç­–ç•¥åç§°ï¼Œå¯ä»¥è‡ªå®šä¹‰</p></li><li><p><code>&quot;^lazy-queue$&quot;</code> ï¼šç”¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…é˜Ÿåˆ—çš„åå­—</p></li><li><p><code>'&#123;&quot;queue-mode&quot;:&quot;lazy&quot;&#125;'</code> ï¼šè®¾ç½®é˜Ÿåˆ—æ¨¡å¼ä¸ºlazyæ¨¡å¼</p></li><li><p><code>--apply-to queues</code>ï¼šç­–ç•¥çš„ä½œç”¨å¯¹è±¡ï¼Œæ˜¯æ‰€æœ‰çš„é˜Ÿåˆ—</p></li></ul><p>å½“ç„¶ï¼Œä¹Ÿå¯ä»¥åœ¨æ§åˆ¶å°é…ç½®policyï¼Œè¿›å…¥åœ¨æ§åˆ¶å°çš„<code>Admin</code>é¡µé¢ï¼Œç‚¹å‡»<code>Policies</code>ï¼Œå³å¯æ·»åŠ é…ç½®ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/AFUlbn4sMoqeX6xbldFcQPbYnXc.png" alt=""></p><h1 id="3-æ¶ˆè´¹è€…çš„å¯é æ€§">3.æ¶ˆè´¹è€…çš„å¯é æ€§</h1><p>å½“RabbitMQå‘æ¶ˆè´¹è€…æŠ•é€’æ¶ˆæ¯ä»¥åï¼Œéœ€è¦çŸ¥é“æ¶ˆè´¹è€…çš„å¤„ç†çŠ¶æ€å¦‚ä½•ã€‚å› ä¸ºæ¶ˆæ¯æŠ•é€’ç»™æ¶ˆè´¹è€…å¹¶ä¸ä»£è¡¨å°±ä¸€å®šè¢«æ­£ç¡®æ¶ˆè´¹äº†ï¼Œå¯èƒ½å‡ºç°çš„æ•…éšœæœ‰å¾ˆå¤šï¼Œæ¯”å¦‚ï¼š</p><ul><li><p>æ¶ˆæ¯æŠ•é€’çš„è¿‡ç¨‹ä¸­å‡ºç°äº†ç½‘ç»œæ•…éšœ</p></li><li><p>æ¶ˆè´¹è€…æ¥æ”¶åˆ°æ¶ˆæ¯åçªç„¶å®•æœº</p></li><li><p>æ¶ˆè´¹è€…æ¥æ”¶åˆ°æ¶ˆæ¯åï¼Œå› å¤„ç†ä¸å½“å¯¼è‡´å¼‚å¸¸</p></li><li><p>â€¦</p></li></ul><p>ä¸€æ—¦å‘ç”Ÿä¸Šè¿°æƒ…å†µï¼Œæ¶ˆæ¯ä¹Ÿä¼šä¸¢å¤±ã€‚å› æ­¤ï¼ŒRabbitMQå¿…é¡»çŸ¥é“æ¶ˆè´¹è€…çš„å¤„ç†çŠ¶æ€ï¼Œä¸€æ—¦æ¶ˆæ¯å¤„ç†å¤±è´¥æ‰èƒ½é‡æ–°æŠ•é€’æ¶ˆæ¯ã€‚</p><p>ä½†é—®é¢˜æ¥äº†ï¼šRabbitMQå¦‚ä½•å¾—çŸ¥æ¶ˆè´¹è€…çš„å¤„ç†çŠ¶æ€å‘¢ï¼Ÿ</p><p>æœ¬ç« æˆ‘ä»¬å°±ä¸€èµ·ç ”ç©¶ä¸€ä¸‹æ¶ˆè´¹è€…å¤„ç†æ¶ˆæ¯æ—¶çš„å¯é æ€§è§£å†³æ–¹æ¡ˆã€‚</p><h2 id="3-1-æ¶ˆè´¹è€…ç¡®è®¤æœºåˆ¶">3.1.æ¶ˆè´¹è€…ç¡®è®¤æœºåˆ¶</h2><p>ä¸ºäº†ç¡®è®¤æ¶ˆè´¹è€…æ˜¯å¦æˆåŠŸå¤„ç†æ¶ˆæ¯ï¼ŒRabbitMQæä¾›äº†æ¶ˆè´¹è€…ç¡®è®¤æœºåˆ¶ï¼ˆ<strong>Consumer Acknowledgement</strong>ï¼‰ã€‚å³ï¼šå½“æ¶ˆè´¹è€…å¤„ç†æ¶ˆæ¯ç»“æŸåï¼Œåº”è¯¥å‘RabbitMQå‘é€ä¸€ä¸ªå›æ‰§ï¼Œå‘ŠçŸ¥RabbitMQè‡ªå·±æ¶ˆæ¯å¤„ç†çŠ¶æ€ã€‚å›æ‰§æœ‰ä¸‰ç§å¯é€‰å€¼ï¼š</p><ul><li><p>ackï¼šæˆåŠŸå¤„ç†æ¶ˆæ¯ï¼ŒRabbitMQä»é˜Ÿåˆ—ä¸­åˆ é™¤è¯¥æ¶ˆæ¯</p></li><li><p>nackï¼šæ¶ˆæ¯å¤„ç†å¤±è´¥ï¼ŒRabbitMQéœ€è¦å†æ¬¡æŠ•é€’æ¶ˆæ¯</p></li><li><p>rejectï¼šæ¶ˆæ¯å¤„ç†å¤±è´¥å¹¶æ‹’ç»è¯¥æ¶ˆæ¯ï¼ŒRabbitMQä»é˜Ÿåˆ—ä¸­åˆ é™¤è¯¥æ¶ˆæ¯</p></li></ul><p>ä¸€èˆ¬rejectæ–¹å¼ç”¨çš„è¾ƒå°‘ï¼Œé™¤éæ˜¯æ¶ˆæ¯æ ¼å¼æœ‰é—®é¢˜ï¼Œé‚£å°±æ˜¯å¼€å‘é—®é¢˜äº†ã€‚å› æ­¤å¤§å¤šæ•°æƒ…å†µä¸‹æˆ‘ä»¬éœ€è¦å°†æ¶ˆæ¯å¤„ç†çš„ä»£ç é€šè¿‡<code>try catch</code>æœºåˆ¶æ•è·ï¼Œæ¶ˆæ¯å¤„ç†æˆåŠŸæ—¶è¿”å›ackï¼Œå¤„ç†å¤±è´¥æ—¶è¿”å›nack.</p><p>ç”±äºæ¶ˆæ¯å›æ‰§çš„å¤„ç†ä»£ç æ¯”è¾ƒç»Ÿä¸€ï¼Œå› æ­¤SpringAMQPå¸®æˆ‘ä»¬å®ç°äº†æ¶ˆæ¯ç¡®è®¤ã€‚å¹¶å…è®¸æˆ‘ä»¬é€šè¿‡é…ç½®æ–‡ä»¶è®¾ç½®ACKå¤„ç†æ–¹å¼ï¼Œæœ‰ä¸‰ç§æ¨¡å¼ï¼š</p><ul><li><p><strong><code>none</code></strong>ï¼šä¸å¤„ç†ã€‚å³æ¶ˆæ¯æŠ•é€’ç»™æ¶ˆè´¹è€…åç«‹åˆ»ackï¼Œæ¶ˆæ¯ä¼šç«‹åˆ»ä»MQåˆ é™¤ã€‚éå¸¸ä¸å®‰å…¨ï¼Œä¸å»ºè®®ä½¿ç”¨</p></li><li><p><strong><code>manual</code></strong>ï¼šæ‰‹åŠ¨æ¨¡å¼ã€‚éœ€è¦è‡ªå·±åœ¨ä¸šåŠ¡ä»£ç ä¸­è°ƒç”¨apiï¼Œå‘é€<code>ack</code>æˆ–<code>reject</code>ï¼Œå­˜åœ¨ä¸šåŠ¡å…¥ä¾µï¼Œä½†æ›´çµæ´»</p></li><li><p><strong><code>auto</code></strong>ï¼šè‡ªåŠ¨æ¨¡å¼ã€‚SpringAMQPåˆ©ç”¨AOPå¯¹æˆ‘ä»¬çš„æ¶ˆæ¯å¤„ç†é€»è¾‘åšäº†ç¯ç»•å¢å¼ºï¼Œå½“ä¸šåŠ¡æ­£å¸¸æ‰§è¡Œæ—¶åˆ™è‡ªåŠ¨è¿”å›<code>ack</code>.  å½“ä¸šåŠ¡å‡ºç°å¼‚å¸¸æ—¶ï¼Œæ ¹æ®å¼‚å¸¸åˆ¤æ–­è¿”å›ä¸åŒç»“æœï¼š</p><ul><li><p>å¦‚æœæ˜¯<strong>ä¸šåŠ¡å¼‚å¸¸</strong>ï¼Œä¼šè‡ªåŠ¨è¿”å›<code>nack</code>ï¼›</p></li><li><p>å¦‚æœæ˜¯<strong>æ¶ˆæ¯å¤„ç†æˆ–æ ¡éªŒå¼‚å¸¸</strong>ï¼Œè‡ªåŠ¨è¿”å›<code>reject</code>;</p></li></ul></li></ul><p>è¿”å›Rejectçš„å¸¸è§å¼‚å¸¸æœ‰ï¼š</p><blockquote><p>Starting with version 1.3.2, the default ErrorHandler is now a ConditionalRejectingErrorHandler that rejects (and does not requeue) messages that fail with an irrecoverable error. Specifically, it rejects messages that fail with the following errors:</p><ul><li><p>o.s.amqpâ€¦MessageConversionException: Can be thrown when converting the incoming message payload using a MessageConverter.</p></li><li><p>o.s.messagingâ€¦MessageConversionException: Can be thrown by the conversion service if additional conversion is required when mapping to a @RabbitListener method.</p></li><li><p>o.s.messagingâ€¦MethodArgumentNotValidException: Can be thrown if validation (for example, @Valid) is used in the listener and the validation fails.</p></li><li><p>o.s.messagingâ€¦MethodArgumentTypeMismatchException: Can be thrown if the inbound message was converted to a type that is not correct for the target method. For example, the parameter is declared as Message&lt;Foo&gt; but Message&lt;Bar&gt; is received.</p></li><li><p>java.lang.NoSuchMethodException: Added in version 1.6.3.</p></li><li><p>java.lang.ClassCastException: Added in version 1.6.3.</p></li></ul></blockquote><p>é€šè¿‡ä¸‹é¢çš„é…ç½®å¯ä»¥ä¿®æ”¹SpringAMQPçš„ACKå¤„ç†æ–¹å¼ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">rabbitmq:</span></span><br><span class="line">    <span class="attr">listener:</span></span><br><span class="line">      <span class="attr">simple:</span></span><br><span class="line">        <span class="attr">acknowledge-mode:</span> <span class="string">none</span> <span class="comment"># ä¸åšå¤„ç†</span></span><br></pre></td></tr></table></figure><p>ä¿®æ”¹consumeræœåŠ¡çš„SpringRabbitListenerç±»ä¸­çš„æ–¹æ³•ï¼Œæ¨¡æ‹Ÿä¸€ä¸ªæ¶ˆæ¯å¤„ç†çš„å¼‚å¸¸ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RabbitListener(queues = &quot;simple.queue&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenSimpleQueueMessage</span><span class="params">(String msg)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    log.info(<span class="string">&quot;spring æ¶ˆè´¹è€…æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€&quot;</span> + msg + <span class="string">&quot;ã€‘&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">MessageConversionException</span>(<span class="string">&quot;æ•…æ„çš„&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    log.info(<span class="string">&quot;æ¶ˆæ¯å¤„ç†å®Œæˆ&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•å¯ä»¥å‘ç°ï¼šå½“æ¶ˆæ¯å¤„ç†å‘ç”Ÿå¼‚å¸¸æ—¶ï¼Œæ¶ˆæ¯ä¾ç„¶è¢«RabbitMQåˆ é™¤äº†ã€‚</p><p>æˆ‘ä»¬å†æ¬¡æŠŠç¡®è®¤æœºåˆ¶ä¿®æ”¹ä¸ºautoï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">rabbitmq:</span></span><br><span class="line">    <span class="attr">listener:</span></span><br><span class="line">      <span class="attr">simple:</span></span><br><span class="line">        <span class="attr">acknowledge-mode:</span> <span class="string">auto</span> <span class="comment"># è‡ªåŠ¨ack</span></span><br></pre></td></tr></table></figure><p>åœ¨å¼‚å¸¸ä½ç½®æ‰“æ–­ç‚¹ï¼Œå†æ¬¡å‘é€æ¶ˆæ¯ï¼Œç¨‹åºå¡åœ¨æ–­ç‚¹æ—¶ï¼Œå¯ä»¥å‘ç°æ­¤æ—¶æ¶ˆæ¯çŠ¶æ€ä¸º<code>unacked</code>ï¼ˆæœªç¡®å®šçŠ¶æ€ï¼‰ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/MaLabMxNNoh4gMxwHDxc4MxTnoh.png" alt=""></p><p>æ”¾è¡Œä»¥åï¼Œç”±äºæŠ›å‡ºçš„æ˜¯<strong>æ¶ˆæ¯è½¬æ¢å¼‚å¸¸</strong>ï¼Œå› æ­¤Springä¼šè‡ªåŠ¨è¿”å›<code>reject</code>ï¼Œæ‰€ä»¥æ¶ˆæ¯ä¾ç„¶ä¼šè¢«åˆ é™¤ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/OuJLbuT9eowqpaxI7TNcimyinZc.png" alt=""></p><p>æˆ‘ä»¬å°†å¼‚å¸¸æ”¹ä¸ºRuntimeExceptionç±»å‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RabbitListener(queues = &quot;simple.queue&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenSimpleQueueMessage</span><span class="params">(String msg)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    log.info(<span class="string">&quot;spring æ¶ˆè´¹è€…æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€&quot;</span> + msg + <span class="string">&quot;ã€‘&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;æ•…æ„çš„&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    log.info(<span class="string">&quot;æ¶ˆæ¯å¤„ç†å®Œæˆ&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨å¼‚å¸¸ä½ç½®æ‰“æ–­ç‚¹ï¼Œç„¶åå†æ¬¡å‘é€æ¶ˆæ¯æµ‹è¯•ï¼Œç¨‹åºå¡åœ¨æ–­ç‚¹æ—¶ï¼Œå¯ä»¥å‘ç°æ­¤æ—¶æ¶ˆæ¯çŠ¶æ€ä¸º<code>unacked</code>ï¼ˆæœªç¡®å®šçŠ¶æ€ï¼‰ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/UkKwbmXVpoyeUyxxxxncpY5NnMg.png" alt=""></p><p>æ”¾è¡Œä»¥åï¼Œç”±äºæŠ›å‡ºçš„æ˜¯ä¸šåŠ¡å¼‚å¸¸ï¼Œæ‰€ä»¥Springè¿”å›<code>ack</code>ï¼Œæœ€ç»ˆæ¶ˆæ¯æ¢å¤è‡³<code>Ready</code>çŠ¶æ€ï¼Œå¹¶ä¸”æ²¡æœ‰è¢«RabbitMQåˆ é™¤ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/K8qRb41Uso5Riyx95aLcGAYQnCe.png" alt=""></p><p>å½“æˆ‘ä»¬æŠŠé…ç½®æ”¹ä¸º<code>auto</code>æ—¶ï¼Œæ¶ˆæ¯å¤„ç†å¤±è´¥åï¼Œä¼šå›åˆ°RabbitMQï¼Œå¹¶é‡æ–°æŠ•é€’åˆ°æ¶ˆè´¹è€…ã€‚</p><h2 id="3-2-å¤±è´¥é‡è¯•æœºåˆ¶">3.2.å¤±è´¥é‡è¯•æœºåˆ¶</h2><p>å½“æ¶ˆè´¹è€…å‡ºç°å¼‚å¸¸åï¼Œæ¶ˆæ¯ä¼šä¸æ–­requeueï¼ˆé‡å…¥é˜Ÿï¼‰åˆ°é˜Ÿåˆ—ï¼Œå†é‡æ–°å‘é€ç»™æ¶ˆè´¹è€…ã€‚å¦‚æœæ¶ˆè´¹è€…å†æ¬¡æ‰§è¡Œä¾ç„¶å‡ºé”™ï¼Œæ¶ˆæ¯ä¼šå†æ¬¡requeueåˆ°é˜Ÿåˆ—ï¼Œå†æ¬¡æŠ•é€’ï¼Œç›´åˆ°æ¶ˆæ¯å¤„ç†æˆåŠŸä¸ºæ­¢ã€‚</p><p>æç«¯æƒ…å†µå°±æ˜¯æ¶ˆè´¹è€…ä¸€ç›´æ— æ³•æ‰§è¡ŒæˆåŠŸï¼Œé‚£ä¹ˆæ¶ˆæ¯requeueå°±ä¼šæ— é™å¾ªç¯ï¼Œå¯¼è‡´mqçš„æ¶ˆæ¯å¤„ç†é£™å‡ï¼Œå¸¦æ¥ä¸å¿…è¦çš„å‹åŠ›ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/B2SpbJ5Rxo78AQxuyXQcauXsn4b.png" alt=""></p><p>å½“ç„¶ï¼Œä¸Šè¿°æç«¯æƒ…å†µå‘ç”Ÿçš„æ¦‚ç‡è¿˜æ˜¯éå¸¸ä½çš„ï¼Œä¸è¿‡ä¸æ€•ä¸€ä¸‡å°±æ€•ä¸‡ä¸€ã€‚ä¸ºäº†åº”å¯¹ä¸Šè¿°æƒ…å†µSpringåˆæä¾›äº†æ¶ˆè´¹è€…å¤±è´¥é‡è¯•æœºåˆ¶ï¼šåœ¨æ¶ˆè´¹è€…å‡ºç°å¼‚å¸¸æ—¶åˆ©ç”¨æœ¬åœ°é‡è¯•ï¼Œè€Œä¸æ˜¯æ— é™åˆ¶çš„requeueåˆ°mqé˜Ÿåˆ—ã€‚</p><p>ä¿®æ”¹consumeræœåŠ¡çš„application.ymlæ–‡ä»¶ï¼Œæ·»åŠ å†…å®¹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">rabbitmq:</span></span><br><span class="line">    <span class="attr">listener:</span></span><br><span class="line">      <span class="attr">simple:</span></span><br><span class="line">        <span class="attr">retry:</span></span><br><span class="line">          <span class="attr">enabled:</span> <span class="literal">true</span> <span class="comment"># å¼€å¯æ¶ˆè´¹è€…å¤±è´¥é‡è¯•</span></span><br><span class="line">          <span class="attr">initial-interval:</span> <span class="string">1000ms</span> <span class="comment"># åˆè¯†çš„å¤±è´¥ç­‰å¾…æ—¶é•¿ä¸º1ç§’</span></span><br><span class="line">          <span class="attr">multiplier:</span> <span class="number">1</span> <span class="comment"># å¤±è´¥çš„ç­‰å¾…æ—¶é•¿å€æ•°ï¼Œä¸‹æ¬¡ç­‰å¾…æ—¶é•¿ = multiplier * last-interval</span></span><br><span class="line">          <span class="attr">max-attempts:</span> <span class="number">3</span> <span class="comment"># æœ€å¤§é‡è¯•æ¬¡æ•°</span></span><br><span class="line">          <span class="attr">stateless:</span> <span class="literal">true</span> <span class="comment"># trueæ— çŠ¶æ€ï¼›falseæœ‰çŠ¶æ€ã€‚å¦‚æœä¸šåŠ¡ä¸­åŒ…å«äº‹åŠ¡ï¼Œè¿™é‡Œæ”¹ä¸ºfalse</span></span><br></pre></td></tr></table></figure><p>é‡å¯consumeræœåŠ¡ï¼Œé‡å¤ä¹‹å‰çš„æµ‹è¯•ã€‚å¯ä»¥å‘ç°ï¼š</p><ul><li><p>æ¶ˆè´¹è€…åœ¨å¤±è´¥åæ¶ˆæ¯æ²¡æœ‰é‡æ–°å›åˆ°MQæ— é™é‡æ–°æŠ•é€’ï¼Œè€Œæ˜¯åœ¨æœ¬åœ°é‡è¯•äº†3æ¬¡</p></li><li><p>æœ¬åœ°é‡è¯•3æ¬¡ä»¥åï¼ŒæŠ›å‡ºäº†<code>AmqpRejectAndDontRequeueException</code>å¼‚å¸¸ã€‚æŸ¥çœ‹RabbitMQæ§åˆ¶å°ï¼Œå‘ç°æ¶ˆæ¯è¢«åˆ é™¤äº†ï¼Œè¯´æ˜æœ€åSpringAMQPè¿”å›çš„æ˜¯<code>reject</code></p></li></ul><p>ç»“è®ºï¼š</p><ul><li><p>å¼€å¯æœ¬åœ°é‡è¯•æ—¶ï¼Œæ¶ˆæ¯å¤„ç†è¿‡ç¨‹ä¸­æŠ›å‡ºå¼‚å¸¸ï¼Œä¸ä¼šrequeueåˆ°é˜Ÿåˆ—ï¼Œè€Œæ˜¯åœ¨æ¶ˆè´¹è€…æœ¬åœ°é‡è¯•</p></li><li><p>é‡è¯•è¾¾åˆ°æœ€å¤§æ¬¡æ•°åï¼ŒSpringä¼šè¿”å›rejectï¼Œæ¶ˆæ¯ä¼šè¢«ä¸¢å¼ƒ</p></li></ul><h2 id="3-3-å¤±è´¥å¤„ç†ç­–ç•¥">3.3.å¤±è´¥å¤„ç†ç­–ç•¥</h2><p>åœ¨ä¹‹å‰çš„æµ‹è¯•ä¸­ï¼Œæœ¬åœ°æµ‹è¯•è¾¾åˆ°æœ€å¤§é‡è¯•æ¬¡æ•°åï¼Œæ¶ˆæ¯ä¼šè¢«ä¸¢å¼ƒã€‚è¿™åœ¨æŸäº›å¯¹äºæ¶ˆæ¯å¯é æ€§è¦æ±‚è¾ƒé«˜çš„ä¸šåŠ¡åœºæ™¯ä¸‹ï¼Œæ˜¾ç„¶ä¸å¤ªåˆé€‚äº†ã€‚</p><p>å› æ­¤Springå…è®¸æˆ‘ä»¬è‡ªå®šä¹‰é‡è¯•æ¬¡æ•°è€—å°½åçš„æ¶ˆæ¯å¤„ç†ç­–ç•¥ï¼Œè¿™ä¸ªç­–ç•¥æ˜¯ç”±<code>MessageRecovery</code>æ¥å£æ¥å®šä¹‰çš„ï¼Œå®ƒæœ‰3ä¸ªä¸åŒå®ç°ï¼š</p><ul><li><p> <code>RejectAndDontRequeueRecoverer</code>ï¼šé‡è¯•è€—å°½åï¼Œç›´æ¥<code>reject</code>ï¼Œä¸¢å¼ƒæ¶ˆæ¯ã€‚é»˜è®¤å°±æ˜¯è¿™ç§æ–¹å¼ </p></li><li><p> <code>ImmediateRequeueMessageRecoverer</code>ï¼šé‡è¯•è€—å°½åï¼Œè¿”å›<code>nack</code>ï¼Œæ¶ˆæ¯é‡æ–°å…¥é˜Ÿ </p></li><li><p> <code>RepublishMessageRecoverer</code>ï¼šé‡è¯•è€—å°½åï¼Œå°†å¤±è´¥æ¶ˆæ¯æŠ•é€’åˆ°æŒ‡å®šçš„äº¤æ¢æœº </p></li></ul><p>æ¯”è¾ƒä¼˜é›…çš„ä¸€ç§å¤„ç†æ–¹æ¡ˆæ˜¯<code>RepublishMessageRecoverer</code>ï¼Œå¤±è´¥åå°†æ¶ˆæ¯æŠ•é€’åˆ°ä¸€ä¸ªæŒ‡å®šçš„ï¼Œä¸“é—¨å­˜æ”¾å¼‚å¸¸æ¶ˆæ¯çš„é˜Ÿåˆ—ï¼Œåç»­ç”±äººå·¥é›†ä¸­å¤„ç†ã€‚</p><p>1ï¼‰åœ¨consumeræœåŠ¡ä¸­å®šä¹‰å¤„ç†å¤±è´¥æ¶ˆæ¯çš„äº¤æ¢æœºå’Œé˜Ÿåˆ—</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> DirectExchange <span class="title function_">errorMessageExchange</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DirectExchange</span>(<span class="string">&quot;error.direct&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> Queue <span class="title function_">errorQueue</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Queue</span>(<span class="string">&quot;error.queue&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> Binding <span class="title function_">errorBinding</span><span class="params">(Queue errorQueue, DirectExchange errorMessageExchange)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> BindingBuilder.bind(errorQueue).to(errorMessageExchange).with(<span class="string">&quot;error&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2ï¼‰å®šä¹‰ä¸€ä¸ªRepublishMessageRecovererï¼Œå…³è”é˜Ÿåˆ—å’Œäº¤æ¢æœº</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> MessageRecoverer <span class="title function_">republishMessageRecoverer</span><span class="params">(RabbitTemplate rabbitTemplate)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RepublishMessageRecoverer</span>(rabbitTemplate, <span class="string">&quot;error.direct&quot;</span>, <span class="string">&quot;error&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.consumer.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.core.Binding;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.core.BindingBuilder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.core.DirectExchange;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.core.Queue;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.rabbit.core.RabbitTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.rabbit.retry.MessageRecoverer;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.rabbit.retry.RepublishMessageRecoverer;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConditionalOnProperty(name = &quot;spring.rabbitmq.listener.simple.retry.enabled&quot;, havingValue = &quot;true&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ErrorMessageConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> DirectExchange <span class="title function_">errorMessageExchange</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DirectExchange</span>(<span class="string">&quot;error.direct&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Queue <span class="title function_">errorQueue</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Queue</span>(<span class="string">&quot;error.queue&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Binding <span class="title function_">errorBinding</span><span class="params">(Queue errorQueue, DirectExchange errorMessageExchange)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(errorQueue).to(errorMessageExchange).with(<span class="string">&quot;error&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> MessageRecoverer <span class="title function_">republishMessageRecoverer</span><span class="params">(RabbitTemplate rabbitTemplate)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RepublishMessageRecoverer</span>(rabbitTemplate, <span class="string">&quot;error.direct&quot;</span>, <span class="string">&quot;error&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-4-ä¸šåŠ¡å¹‚ç­‰æ€§">3.4.ä¸šåŠ¡å¹‚ç­‰æ€§</h2><p>ä½•ä¸ºå¹‚ç­‰æ€§ï¼Ÿ</p><p><strong>å¹‚ç­‰</strong>æ˜¯ä¸€ä¸ªæ•°å­¦æ¦‚å¿µï¼Œç”¨å‡½æ•°è¡¨è¾¾å¼æ¥æè¿°æ˜¯è¿™æ ·çš„ï¼š<code>f(x) = f(f(x))</code>ï¼Œä¾‹å¦‚æ±‚ç»å¯¹å€¼å‡½æ•°ã€‚</p><p>åœ¨ç¨‹åºå¼€å‘ä¸­ï¼Œåˆ™æ˜¯æŒ‡åŒä¸€ä¸ªä¸šåŠ¡ï¼Œæ‰§è¡Œä¸€æ¬¡æˆ–å¤šæ¬¡å¯¹ä¸šåŠ¡çŠ¶æ€çš„å½±å“æ˜¯ä¸€è‡´çš„ã€‚ä¾‹å¦‚ï¼š</p><ul><li><p>æ ¹æ®idåˆ é™¤æ•°æ®</p></li><li><p>æŸ¥è¯¢æ•°æ®</p></li><li><p>æ–°å¢æ•°æ®</p></li></ul><p>ä½†æ•°æ®çš„æ›´æ–°å¾€å¾€ä¸æ˜¯å¹‚ç­‰çš„ï¼Œå¦‚æœé‡å¤æ‰§è¡Œå¯èƒ½é€ æˆä¸ä¸€æ ·çš„åæœã€‚æ¯”å¦‚ï¼š</p><ul><li><p>å–æ¶ˆè®¢å•ï¼Œæ¢å¤åº“å­˜çš„ä¸šåŠ¡ã€‚å¦‚æœå¤šæ¬¡æ¢å¤å°±ä¼šå‡ºç°åº“å­˜é‡å¤å¢åŠ çš„æƒ…å†µ</p></li><li><p>é€€æ¬¾ä¸šåŠ¡ã€‚é‡å¤é€€æ¬¾å¯¹å•†å®¶è€Œè¨€ä¼šæœ‰ç»æµæŸå¤±ã€‚</p></li></ul><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬è¦å°½å¯èƒ½é¿å…ä¸šåŠ¡è¢«é‡å¤æ‰§è¡Œã€‚</p><p>ç„¶è€Œåœ¨å®é™…ä¸šåŠ¡åœºæ™¯ä¸­ï¼Œç”±äºæ„å¤–ç»å¸¸ä¼šå‡ºç°ä¸šåŠ¡è¢«é‡å¤æ‰§è¡Œçš„æƒ…å†µï¼Œä¾‹å¦‚ï¼š</p><ul><li><p>é¡µé¢å¡é¡¿æ—¶é¢‘ç¹åˆ·æ–°å¯¼è‡´è¡¨å•é‡å¤æäº¤</p></li><li><p>æœåŠ¡é—´è°ƒç”¨çš„é‡è¯•</p></li><li><p>MQæ¶ˆæ¯çš„é‡å¤æŠ•é€’</p></li></ul><p>æˆ‘ä»¬åœ¨ç”¨æˆ·æ”¯ä»˜æˆåŠŸåä¼šå‘é€MQæ¶ˆæ¯åˆ°äº¤æ˜“æœåŠ¡ï¼Œä¿®æ”¹è®¢å•çŠ¶æ€ä¸ºå·²æ”¯ä»˜ï¼Œå°±å¯èƒ½å‡ºç°æ¶ˆæ¯é‡å¤æŠ•é€’çš„æƒ…å†µã€‚å¦‚æœæ¶ˆè´¹è€…ä¸åšåˆ¤æ–­ï¼Œå¾ˆæœ‰å¯èƒ½å¯¼è‡´æ¶ˆæ¯è¢«æ¶ˆè´¹å¤šæ¬¡ï¼Œå‡ºç°ä¸šåŠ¡æ•…éšœã€‚</p><p>ä¸¾ä¾‹ï¼š</p><ol><li><p>å‡å¦‚ç”¨æˆ·åˆšåˆšæ”¯ä»˜å®Œæˆï¼Œå¹¶ä¸”æŠ•é€’æ¶ˆæ¯åˆ°äº¤æ˜“æœåŠ¡ï¼Œäº¤æ˜“æœåŠ¡æ›´æ”¹è®¢å•ä¸º<strong>å·²æ”¯ä»˜</strong>çŠ¶æ€ã€‚</p></li><li><p>ç”±äºæŸç§åŸå› ï¼Œä¾‹å¦‚ç½‘ç»œæ•…éšœå¯¼è‡´ç”Ÿäº§è€…æ²¡æœ‰å¾—åˆ°ç¡®è®¤ï¼Œéš”äº†ä¸€æ®µæ—¶é—´å<strong>é‡æ–°æŠ•é€’</strong>ç»™äº¤æ˜“æœåŠ¡ã€‚</p></li><li><p>ä½†æ˜¯ï¼Œåœ¨æ–°æŠ•é€’çš„æ¶ˆæ¯è¢«æ¶ˆè´¹ä¹‹å‰ï¼Œç”¨æˆ·é€‰æ‹©äº†é€€æ¬¾ï¼Œå°†è®¢å•çŠ¶æ€æ”¹ä¸ºäº†<strong>å·²é€€æ¬¾</strong>çŠ¶æ€ã€‚</p></li><li><p>é€€æ¬¾å®Œæˆåï¼Œæ–°æŠ•é€’çš„æ¶ˆæ¯æ‰è¢«æ¶ˆè´¹ï¼Œé‚£ä¹ˆè®¢å•çŠ¶æ€ä¼šè¢«å†æ¬¡æ”¹ä¸º<strong>å·²æ”¯ä»˜</strong>ã€‚ä¸šåŠ¡å¼‚å¸¸ã€‚</p></li></ol><p>å› æ­¤ï¼Œæˆ‘ä»¬å¿…é¡»æƒ³åŠæ³•ä¿è¯æ¶ˆæ¯å¤„ç†çš„å¹‚ç­‰æ€§ã€‚è¿™é‡Œç»™å‡ºä¸¤ç§æ–¹æ¡ˆï¼š</p><ul><li><p>å”¯ä¸€æ¶ˆæ¯ID</p></li><li><p>ä¸šåŠ¡çŠ¶æ€åˆ¤æ–­</p></li></ul><h3 id="3-4-1-å”¯ä¸€æ¶ˆæ¯ID">3.4.1.å”¯ä¸€æ¶ˆæ¯ID</h3><p>è¿™ä¸ªæ€è·¯éå¸¸ç®€å•ï¼š</p><ol><li><p>æ¯ä¸€æ¡æ¶ˆæ¯éƒ½ç”Ÿæˆä¸€ä¸ªå”¯ä¸€çš„idï¼Œä¸æ¶ˆæ¯ä¸€èµ·æŠ•é€’ç»™æ¶ˆè´¹è€…ã€‚</p></li><li><p>æ¶ˆè´¹è€…æ¥æ”¶åˆ°æ¶ˆæ¯åå¤„ç†è‡ªå·±çš„ä¸šåŠ¡ï¼Œä¸šåŠ¡å¤„ç†æˆåŠŸåå°†æ¶ˆæ¯IDä¿å­˜åˆ°æ•°æ®åº“</p></li><li><p>å¦‚æœä¸‹æ¬¡åˆæ”¶åˆ°ç›¸åŒæ¶ˆæ¯ï¼Œå»æ•°æ®åº“æŸ¥è¯¢åˆ¤æ–­æ˜¯å¦å­˜åœ¨ï¼Œå­˜åœ¨åˆ™ä¸ºé‡å¤æ¶ˆæ¯æ”¾å¼ƒå¤„ç†ã€‚</p></li></ol><p>æˆ‘ä»¬è¯¥å¦‚ä½•ç»™æ¶ˆæ¯æ·»åŠ å”¯ä¸€IDå‘¢ï¼Ÿ</p><p>å…¶å®å¾ˆç®€å•ï¼ŒSpringAMQPçš„MessageConverterè‡ªå¸¦äº†MessageIDçš„åŠŸèƒ½ï¼Œæˆ‘ä»¬åªè¦å¼€å¯è¿™ä¸ªåŠŸèƒ½å³å¯ã€‚</p><p>ä»¥Jacksonçš„æ¶ˆæ¯è½¬æ¢å™¨ä¸ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> MessageConverter <span class="title function_">messageConverter</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">// 1.å®šä¹‰æ¶ˆæ¯è½¬æ¢å™¨</span></span><br><span class="line">    <span class="type">Jackson2JsonMessageConverter</span> <span class="variable">jjmc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Jackson2JsonMessageConverter</span>();</span><br><span class="line">    <span class="comment">// 2.é…ç½®è‡ªåŠ¨åˆ›å»ºæ¶ˆæ¯idï¼Œç”¨äºè¯†åˆ«ä¸åŒæ¶ˆæ¯ï¼Œä¹Ÿå¯ä»¥åœ¨ä¸šåŠ¡ä¸­åŸºäºIDåˆ¤æ–­æ˜¯å¦æ˜¯é‡å¤æ¶ˆæ¯</span></span><br><span class="line">    jjmc.setCreateMessageIds(<span class="literal">true</span>);</span><br><span class="line">    <span class="keyword">return</span> jjmc;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-4-2-ä¸šåŠ¡åˆ¤æ–­">3.4.2.ä¸šåŠ¡åˆ¤æ–­</h3><p>ä¸šåŠ¡åˆ¤æ–­å°±æ˜¯åŸºäºä¸šåŠ¡æœ¬èº«çš„é€»è¾‘æˆ–çŠ¶æ€æ¥åˆ¤æ–­æ˜¯å¦æ˜¯é‡å¤çš„è¯·æ±‚æˆ–æ¶ˆæ¯ï¼Œä¸åŒçš„ä¸šåŠ¡åœºæ™¯åˆ¤æ–­çš„æ€è·¯ä¹Ÿä¸ä¸€æ ·ã€‚</p><p>ä¾‹å¦‚æˆ‘ä»¬å½“å‰æ¡ˆä¾‹ä¸­ï¼Œå¤„ç†æ¶ˆæ¯çš„ä¸šåŠ¡é€»è¾‘æ˜¯æŠŠè®¢å•çŠ¶æ€ä»æœªæ”¯ä»˜ä¿®æ”¹ä¸ºå·²æ”¯ä»˜ã€‚å› æ­¤æˆ‘ä»¬å°±å¯ä»¥åœ¨æ‰§è¡Œä¸šåŠ¡æ—¶åˆ¤æ–­è®¢å•çŠ¶æ€æ˜¯å¦æ˜¯æœªæ”¯ä»˜ï¼Œå¦‚æœä¸æ˜¯åˆ™è¯æ˜è®¢å•å·²ç»è¢«å¤„ç†è¿‡ï¼Œæ— éœ€é‡å¤å¤„ç†ã€‚</p><p>ç›¸æ¯”è¾ƒè€Œè¨€ï¼Œæ¶ˆæ¯IDçš„æ–¹æ¡ˆéœ€è¦æ”¹é€ åŸæœ‰çš„æ•°æ®åº“ï¼Œæ‰€ä»¥æˆ‘æ›´æ¨èä½¿ç”¨ä¸šåŠ¡åˆ¤æ–­çš„æ–¹æ¡ˆã€‚</p><p>ä»¥æ”¯ä»˜ä¿®æ”¹è®¢å•çš„ä¸šåŠ¡ä¸ºä¾‹ï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹<code>OrderServiceImpl</code>ä¸­çš„<code>markOrderPaySuccess</code>æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">markOrderPaySuccess</span><span class="params">(Long orderId)</span> &#123;</span><br><span class="line">    <span class="comment">// 1.æŸ¥è¯¢è®¢å•</span></span><br><span class="line">    <span class="type">Order</span> <span class="variable">old</span> <span class="operator">=</span> getById(orderId);</span><br><span class="line">    <span class="comment">// 2.åˆ¤æ–­è®¢å•çŠ¶æ€</span></span><br><span class="line">    <span class="keyword">if</span> (old == <span class="literal">null</span> || old.getStatus() != <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="comment">// è®¢å•ä¸å­˜åœ¨æˆ–è€…è®¢å•çŠ¶æ€ä¸æ˜¯1ï¼Œæ”¾å¼ƒå¤„ç†</span></span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 3.å°è¯•æ›´æ–°è®¢å•</span></span><br><span class="line">    <span class="type">Order</span> <span class="variable">order</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Order</span>();</span><br><span class="line">    order.setId(orderId);</span><br><span class="line">    order.setStatus(<span class="number">2</span>);</span><br><span class="line">    order.setPayTime(LocalDateTime.now());</span><br><span class="line">    updateById(order);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç é€»è¾‘ä¸Šç¬¦åˆäº†å¹‚ç­‰åˆ¤æ–­çš„éœ€æ±‚ï¼Œä½†æ˜¯ç”±äºåˆ¤æ–­å’Œæ›´æ–°æ˜¯ä¸¤æ­¥åŠ¨ä½œï¼Œå› æ­¤åœ¨æå°æ¦‚ç‡ä¸‹å¯èƒ½å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚</p><p>æˆ‘ä»¬å¯ä»¥åˆå¹¶ä¸Šè¿°æ“ä½œä¸ºè¿™æ ·ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">markOrderPaySuccess</span><span class="params">(Long orderId)</span> &#123;</span><br><span class="line">    <span class="comment">// UPDATE `order` SET status = ? , pay_time = ? WHERE id = ? AND status = 1</span></span><br><span class="line">    lambdaUpdate()</span><br><span class="line">            .set(Order::getStatus, <span class="number">2</span>)</span><br><span class="line">            .set(Order::getPayTime, LocalDateTime.now())</span><br><span class="line">            .eq(Order::getId, orderId)</span><br><span class="line">            .eq(Order::getStatus, <span class="number">1</span>)</span><br><span class="line">            .update();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„çœ‹ï¼Œä¸Šè¿°ä»£ç ç­‰åŒäºè¿™æ ·çš„SQLè¯­å¥ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> `<span class="keyword">order</span>` <span class="keyword">SET</span> status <span class="operator">=</span> ? , pay_time <span class="operator">=</span> ? <span class="keyword">WHERE</span> id <span class="operator">=</span> ? <span class="keyword">AND</span> status <span class="operator">=</span> <span class="number">1</span></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬åœ¨whereæ¡ä»¶ä¸­é™¤äº†åˆ¤æ–­idä»¥å¤–ï¼Œè¿˜åŠ ä¸Šäº†statuså¿…é¡»ä¸º1çš„æ¡ä»¶ã€‚å¦‚æœæ¡ä»¶ä¸ç¬¦ï¼ˆè¯´æ˜è®¢å•å·²æ”¯ä»˜ï¼‰ï¼Œåˆ™SQLåŒ¹é…ä¸åˆ°æ•°æ®ï¼Œæ ¹æœ¬ä¸ä¼šæ‰§è¡Œã€‚</p><h2 id="3-5-å…œåº•æ–¹æ¡ˆ">3.5.å…œåº•æ–¹æ¡ˆ</h2><p>è™½ç„¶æˆ‘ä»¬åˆ©ç”¨å„ç§æœºåˆ¶å°½å¯èƒ½å¢åŠ äº†æ¶ˆæ¯çš„å¯é æ€§ï¼Œä½†ä¹Ÿä¸å¥½è¯´èƒ½ä¿è¯æ¶ˆæ¯100%çš„å¯é ã€‚ä¸‡ä¸€çœŸçš„MQé€šçŸ¥å¤±è´¥è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ</p><p>æœ‰æ²¡æœ‰å…¶å®ƒå…œåº•æ–¹æ¡ˆï¼Œèƒ½å¤Ÿç¡®ä¿è®¢å•çš„æ”¯ä»˜çŠ¶æ€ä¸€è‡´å‘¢ï¼Ÿ</p><p>å…¶å®æ€æƒ³å¾ˆç®€å•ï¼šæ—¢ç„¶MQé€šçŸ¥ä¸ä¸€å®šå‘é€åˆ°äº¤æ˜“æœåŠ¡ï¼Œé‚£ä¹ˆäº¤æ˜“æœåŠ¡å°±å¿…é¡»è‡ªå·±<strong>ä¸»åŠ¨å»æŸ¥è¯¢</strong>æ”¯ä»˜çŠ¶æ€ã€‚è¿™æ ·å³ä¾¿æ”¯ä»˜æœåŠ¡çš„MQé€šçŸ¥å¤±è´¥ï¼Œæˆ‘ä»¬ä¾ç„¶èƒ½é€šè¿‡ä¸»åŠ¨æŸ¥è¯¢æ¥ä¿è¯è®¢å•çŠ¶æ€çš„ä¸€è‡´ã€‚</p><p>æµç¨‹å¦‚ä¸‹ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/diagram-1.png" alt=""></p><p>å›¾ä¸­é»„è‰²çº¿åœˆèµ·æ¥çš„éƒ¨åˆ†å°±æ˜¯MQé€šçŸ¥å¤±è´¥åçš„å…œåº•å¤„ç†æ–¹æ¡ˆï¼Œç”±äº¤æ˜“æœåŠ¡è‡ªå·±ä¸»åŠ¨å»æŸ¥è¯¢æ”¯ä»˜çŠ¶æ€ã€‚</p><p>ä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œäº¤æ˜“æœåŠ¡å¹¶ä¸çŸ¥é“ç”¨æˆ·ä¼šåœ¨ä»€ä¹ˆæ—¶å€™æ”¯ä»˜ï¼Œå¦‚æœæŸ¥è¯¢çš„æ—¶æœºä¸æ­£ç¡®ï¼ˆæ¯”å¦‚æŸ¥è¯¢çš„æ—¶å€™ç”¨æˆ·æ­£åœ¨æ”¯ä»˜ä¸­ï¼‰ï¼Œå¯èƒ½æŸ¥è¯¢åˆ°çš„æ”¯ä»˜çŠ¶æ€ä¹Ÿä¸æ­£ç¡®ã€‚</p><p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œæˆ‘ä»¬åˆ°åº•è¯¥åœ¨ä»€ä¹ˆæ—¶é—´ä¸»åŠ¨æŸ¥è¯¢æ”¯ä»˜çŠ¶æ€å‘¢ï¼Ÿ</p><p>è¿™ä¸ªæ—¶é—´æ˜¯æ— æ³•ç¡®å®šçš„ï¼Œå› æ­¤ï¼Œé€šå¸¸æˆ‘ä»¬é‡‡å–çš„æªæ–½å°±æ˜¯åˆ©ç”¨<strong>å®šæ—¶ä»»åŠ¡</strong>å®šæœŸæŸ¥è¯¢ï¼Œä¾‹å¦‚æ¯éš”20ç§’å°±æŸ¥è¯¢ä¸€æ¬¡ï¼Œå¹¶åˆ¤æ–­æ”¯ä»˜çŠ¶æ€ã€‚å¦‚æœå‘ç°è®¢å•å·²ç»æ”¯ä»˜ï¼Œåˆ™ç«‹åˆ»æ›´æ–°è®¢å•çŠ¶æ€ä¸ºå·²æ”¯ä»˜å³å¯ã€‚</p><p>å®šæ—¶ä»»åŠ¡å¤§å®¶ä¹‹å‰å­¦ä¹ è¿‡ï¼Œå…·ä½“çš„å®ç°è¿™é‡Œå°±ä¸å†èµ˜è¿°äº†ã€‚</p><p>è‡³æ­¤ï¼Œæ¶ˆæ¯å¯é æ€§çš„é—®é¢˜å·²ç»è§£å†³äº†ã€‚</p><p>ç»¼ä¸Šï¼Œæ”¯ä»˜æœåŠ¡ä¸äº¤æ˜“æœåŠ¡ä¹‹é—´çš„è®¢å•çŠ¶æ€ä¸€è‡´æ€§æ˜¯å¦‚ä½•ä¿è¯çš„ï¼Ÿ</p><ul><li><p>é¦–å…ˆï¼Œæ”¯ä»˜æœåŠ¡ä¼šæ­£åœ¨ç”¨æˆ·æ”¯ä»˜æˆåŠŸä»¥ååˆ©ç”¨MQæ¶ˆæ¯é€šçŸ¥äº¤æ˜“æœåŠ¡ï¼Œå®Œæˆè®¢å•çŠ¶æ€åŒæ­¥ã€‚</p></li><li><p>å…¶æ¬¡ï¼Œä¸ºäº†ä¿è¯MQæ¶ˆæ¯çš„å¯é æ€§ï¼Œæˆ‘ä»¬é‡‡ç”¨äº†ç”Ÿäº§è€…ç¡®è®¤æœºåˆ¶ã€æ¶ˆè´¹è€…ç¡®è®¤ã€æ¶ˆè´¹è€…å¤±è´¥é‡è¯•ç­‰ç­–ç•¥ï¼Œç¡®ä¿æ¶ˆæ¯æŠ•é€’çš„å¯é æ€§</p></li><li><p>æœ€åï¼Œæˆ‘ä»¬è¿˜åœ¨äº¤æ˜“æœåŠ¡è®¾ç½®äº†å®šæ—¶ä»»åŠ¡ï¼Œå®šæœŸæŸ¥è¯¢è®¢å•æ”¯ä»˜çŠ¶æ€ã€‚è¿™æ ·å³ä¾¿MQé€šçŸ¥å¤±è´¥ï¼Œè¿˜å¯ä»¥åˆ©ç”¨å®šæ—¶ä»»åŠ¡ä½œä¸ºå…œåº•æ–¹æ¡ˆï¼Œç¡®ä¿è®¢å•æ”¯ä»˜çŠ¶æ€çš„æœ€ç»ˆä¸€è‡´æ€§ã€‚</p></li></ul><h1 id="4-å»¶è¿Ÿæ¶ˆæ¯">4.å»¶è¿Ÿæ¶ˆæ¯</h1><p>åœ¨ç”µå•†çš„æ”¯ä»˜ä¸šåŠ¡ä¸­ï¼Œå¯¹äºä¸€äº›åº“å­˜æœ‰é™çš„å•†å“ï¼Œä¸ºäº†æ›´å¥½çš„ç”¨æˆ·ä½“éªŒï¼Œé€šå¸¸éƒ½ä¼šåœ¨ç”¨æˆ·ä¸‹å•æ—¶ç«‹åˆ»æ‰£å‡å•†å“åº“å­˜ã€‚ä¾‹å¦‚ç”µå½±é™¢è´­ç¥¨ã€é«˜é“è´­ç¥¨ï¼Œä¸‹å•åå°±ä¼šé”å®šåº§ä½èµ„æºï¼Œå…¶ä»–äººæ— æ³•é‡å¤è´­ä¹°ã€‚</p><p>ä½†æ˜¯è¿™æ ·å°±å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œå‡å¦‚ç”¨æˆ·ä¸‹å•åä¸€ç›´ä¸ä»˜æ¬¾ï¼Œå°±ä¼šä¸€ç›´å æœ‰åº“å­˜èµ„æºï¼Œå¯¼è‡´å…¶ä»–å®¢æˆ·æ— æ³•æ­£å¸¸äº¤æ˜“ï¼Œæœ€ç»ˆå¯¼è‡´å•†æˆ·åˆ©ç›Šå—æŸï¼</p><p>å› æ­¤ï¼Œç”µå•†ä¸­é€šå¸¸çš„åšæ³•å°±æ˜¯ï¼š<strong>å¯¹äºè¶…è¿‡ä¸€å®šæ—¶é—´æœªæ”¯ä»˜çš„è®¢å•ï¼Œåº”è¯¥ç«‹åˆ»å–æ¶ˆè®¢å•å¹¶é‡Šæ”¾å ç”¨çš„åº“å­˜</strong>ã€‚</p><p>ä¾‹å¦‚ï¼Œè®¢å•æ”¯ä»˜è¶…æ—¶æ—¶é—´ä¸º30åˆ†é’Ÿï¼Œåˆ™æˆ‘ä»¬åº”è¯¥åœ¨ç”¨æˆ·ä¸‹å•åçš„ç¬¬30åˆ†é’Ÿæ£€æŸ¥è®¢å•æ”¯ä»˜çŠ¶æ€ï¼Œå¦‚æœå‘ç°æœªæ”¯ä»˜ï¼Œåº”è¯¥ç«‹åˆ»å–æ¶ˆè®¢å•ï¼Œé‡Šæ”¾åº“å­˜ã€‚</p><p>ä½†é—®é¢˜æ¥äº†ï¼šå¦‚ä½•æ‰èƒ½å‡†ç¡®çš„å®ç°åœ¨ä¸‹å•åç¬¬30åˆ†é’Ÿå»æ£€æŸ¥æ”¯ä»˜çŠ¶æ€å‘¢ï¼Ÿ</p><p>åƒè¿™ç§åœ¨ä¸€æ®µæ—¶é—´ä»¥åæ‰æ‰§è¡Œçš„ä»»åŠ¡ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸º<strong>å»¶è¿Ÿä»»åŠ¡</strong>ï¼Œè€Œè¦å®ç°å»¶è¿Ÿä»»åŠ¡ï¼Œæœ€ç®€å•çš„æ–¹æ¡ˆå°±æ˜¯åˆ©ç”¨MQçš„å»¶è¿Ÿæ¶ˆæ¯äº†ã€‚</p><p>åœ¨RabbitMQä¸­å®ç°å»¶è¿Ÿæ¶ˆæ¯ä¹Ÿæœ‰ä¸¤ç§æ–¹æ¡ˆï¼š</p><ul><li><p>æ­»ä¿¡äº¤æ¢æœº+TTL</p></li><li><p>å»¶è¿Ÿæ¶ˆæ¯æ’ä»¶</p></li></ul><p>è¿™ä¸€ç« æˆ‘ä»¬å°±ä¸€èµ·ç ”ç©¶ä¸‹è¿™ä¸¤ç§æ–¹æ¡ˆçš„å®ç°æ–¹å¼ï¼Œä»¥åŠä¼˜ç¼ºç‚¹ã€‚</p><h2 id="4-1-æ­»ä¿¡äº¤æ¢æœºå’Œå»¶è¿Ÿæ¶ˆæ¯">4.1.æ­»ä¿¡äº¤æ¢æœºå’Œå»¶è¿Ÿæ¶ˆæ¯</h2><p>é¦–å…ˆæˆ‘ä»¬æ¥å­¦ä¹ ä¸€ä¸‹åŸºäºæ­»ä¿¡äº¤æ¢æœºçš„å»¶è¿Ÿæ¶ˆæ¯æ–¹æ¡ˆã€‚</p><h3 id="4-1-1-æ­»ä¿¡äº¤æ¢æœº">4.1.1.æ­»ä¿¡äº¤æ¢æœº</h3><p>ä»€ä¹ˆæ˜¯æ­»ä¿¡ï¼Ÿ</p><p>å½“ä¸€ä¸ªé˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯æ»¡è¶³ä¸‹åˆ—æƒ…å†µä¹‹ä¸€æ—¶ï¼Œå¯ä»¥æˆä¸ºæ­»ä¿¡ï¼ˆdead letterï¼‰ï¼š</p><ul><li><p>æ¶ˆè´¹è€…ä½¿ç”¨<code>basic.reject</code>æˆ– <code>basic.nack</code>å£°æ˜æ¶ˆè´¹å¤±è´¥ï¼Œå¹¶ä¸”æ¶ˆæ¯çš„<code>requeue</code>å‚æ•°è®¾ç½®ä¸ºfalse</p></li><li><p>æ¶ˆæ¯æ˜¯ä¸€ä¸ªè¿‡æœŸæ¶ˆæ¯ï¼Œè¶…æ—¶æ— äººæ¶ˆè´¹</p></li><li><p>è¦æŠ•é€’çš„é˜Ÿåˆ—æ¶ˆæ¯æ»¡äº†ï¼Œæ— æ³•æŠ•é€’</p></li></ul><p>å¦‚æœä¸€ä¸ªé˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯å·²ç»æˆä¸ºæ­»ä¿¡ï¼Œå¹¶ä¸”è¿™ä¸ªé˜Ÿåˆ—é€šè¿‡<strong><code>dead-letter-exchange</code></strong>å±æ€§æŒ‡å®šäº†ä¸€ä¸ªäº¤æ¢æœºï¼Œé‚£ä¹ˆé˜Ÿåˆ—ä¸­çš„æ­»ä¿¡å°±ä¼šæŠ•é€’åˆ°è¿™ä¸ªäº¤æ¢æœºä¸­ï¼Œè€Œè¿™ä¸ªäº¤æ¢æœºå°±ç§°ä¸º<strong>æ­»ä¿¡äº¤æ¢æœº</strong>ï¼ˆDead Letter Exchangeï¼‰ã€‚è€Œæ­¤æ—¶åŠ å…¥æœ‰é˜Ÿåˆ—ä¸æ­»ä¿¡äº¤æ¢æœºç»‘å®šï¼Œåˆ™æœ€ç»ˆæ­»ä¿¡å°±ä¼šè¢«æŠ•é€’åˆ°è¿™ä¸ªé˜Ÿåˆ—ä¸­ã€‚</p><p>æ­»ä¿¡äº¤æ¢æœºæœ‰ä»€ä¹ˆä½œç”¨å‘¢ï¼Ÿ</p><ol><li><p>æ”¶é›†é‚£äº›å› å¤„ç†å¤±è´¥è€Œè¢«æ‹’ç»çš„æ¶ˆæ¯</p></li><li><p>æ”¶é›†é‚£äº›å› é˜Ÿåˆ—æ»¡äº†è€Œè¢«æ‹’ç»çš„æ¶ˆæ¯</p></li><li><p>æ”¶é›†å› TTLï¼ˆæœ‰æ•ˆæœŸï¼‰åˆ°æœŸçš„æ¶ˆæ¯</p></li></ol><h3 id="4-1-2-å»¶è¿Ÿæ¶ˆæ¯">4.1.2.å»¶è¿Ÿæ¶ˆæ¯</h3><p>å‰é¢ä¸¤ç§ä½œç”¨åœºæ™¯å¯ä»¥çœ‹åšæ˜¯æŠŠæ­»ä¿¡äº¤æ¢æœºå½“åšä¸€ç§æ¶ˆæ¯å¤„ç†çš„æœ€ç»ˆå…œåº•æ–¹æ¡ˆï¼Œä¸æ¶ˆè´¹è€…é‡è¯•æ—¶è®²çš„<code>RepublishMessageRecoverer</code>ä½œç”¨ç±»ä¼¼ã€‚</p><p>è€Œæœ€åä¸€ç§åœºæ™¯ï¼Œå¤§å®¶è®¾æƒ³ä¸€ä¸‹è¿™æ ·çš„åœºæ™¯ï¼š</p><p>å¦‚å›¾ï¼Œæœ‰ä¸€ç»„ç»‘å®šçš„äº¤æ¢æœºï¼ˆ<code>ttl.fanout</code>ï¼‰å’Œé˜Ÿåˆ—ï¼ˆ<code>ttl.queue</code>ï¼‰ã€‚ä½†æ˜¯<code>ttl.queue</code>æ²¡æœ‰æ¶ˆè´¹è€…ç›‘å¬ï¼Œè€Œæ˜¯è®¾å®šäº†æ­»ä¿¡äº¤æ¢æœº<code>hmall.direct</code>ï¼Œè€Œé˜Ÿåˆ—<code>direct.queue1</code>åˆ™ä¸æ­»ä¿¡äº¤æ¢æœºç»‘å®šï¼ŒRoutingKeyæ˜¯blueï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/DU6Bbv9ELogXMVxjEYZcS4C4nae.png" alt=""></p><p>å‡å¦‚æˆ‘ä»¬ç°åœ¨å‘é€ä¸€æ¡æ¶ˆæ¯åˆ°<code>ttl.fanout</code>ï¼ŒRoutingKeyä¸ºblueï¼Œå¹¶è®¾ç½®æ¶ˆæ¯çš„<strong>æœ‰æ•ˆæœŸ</strong>ä¸º5000æ¯«ç§’ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/IGCWbzpEKo3loaxCJWkcQukZnme.png" alt=""></p><blockquote><p><strong>æ³¨æ„</strong>ï¼šå°½ç®¡è¿™é‡Œçš„<code>ttl.fanout</code>ä¸éœ€è¦RoutingKeyï¼Œä½†æ˜¯å½“æ¶ˆæ¯å˜ä¸ºæ­»ä¿¡å¹¶æŠ•é€’åˆ°æ­»ä¿¡äº¤æ¢æœºæ—¶ï¼Œä¼šæ²¿ç”¨ä¹‹å‰çš„RoutingKeyï¼Œè¿™æ ·<code>hmall.direct</code>æ‰èƒ½æ­£ç¡®è·¯ç”±æ¶ˆæ¯ã€‚</p></blockquote><p>æ¶ˆæ¯è‚¯å®šä¼šè¢«æŠ•é€’åˆ°<code>ttl.queue</code>ä¹‹åï¼Œç”±äºæ²¡æœ‰æ¶ˆè´¹è€…ï¼Œå› æ­¤æ¶ˆæ¯æ— äººæ¶ˆè´¹ã€‚5ç§’ä¹‹åï¼Œæ¶ˆæ¯çš„æœ‰æ•ˆæœŸåˆ°æœŸï¼Œæˆä¸ºæ­»ä¿¡ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/JLSsbX5RyoZCKTxCxhGcksRynFb.png" alt=""></p><p>æ­»ä¿¡è¢«å†æ¬¡æŠ•é€’åˆ°æ­»ä¿¡äº¤æ¢æœº<code>hmall.direct</code>ï¼Œå¹¶æ²¿ç”¨ä¹‹å‰çš„RoutingKeyï¼Œä¹Ÿå°±æ˜¯<code>blue</code>ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/RVgSbj8otoQtKYxsd4jc2OdFnOb.png" alt=""></p><p>ç”±äº<code>direct.queue1</code>ä¸<code>hmall.direct</code>ç»‘å®šçš„keyæ˜¯blueï¼Œå› æ­¤æœ€ç»ˆæ¶ˆæ¯è¢«æˆåŠŸè·¯ç”±åˆ°<code>direct.queue1</code>ï¼Œå¦‚æœæ­¤æ—¶æœ‰æ¶ˆè´¹è€…ä¸<code>direct.queue1</code>ç»‘å®šï¼Œ ä¹Ÿå°±èƒ½æˆåŠŸæ¶ˆè´¹æ¶ˆæ¯äº†ã€‚ä½†æ­¤æ—¶å·²ç»æ˜¯5ç§’é’Ÿä»¥åäº†ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/KZx0bBSh7ofh4jxA0lTcTlL1nic.png" alt=""></p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œpublisherå‘é€äº†ä¸€æ¡æ¶ˆæ¯ï¼Œä½†æœ€ç»ˆconsumeråœ¨5ç§’åæ‰æ”¶åˆ°æ¶ˆæ¯ã€‚æˆ‘ä»¬æˆåŠŸå®ç°äº†<strong>å»¶è¿Ÿæ¶ˆæ¯</strong>ã€‚</p><h3 id="4-1-3-æ€»ç»“">4.1.3.æ€»ç»“</h3><blockquote><p><strong>æ³¨æ„ï¼š</strong></p><p>RabbitMQçš„æ¶ˆæ¯è¿‡æœŸæ˜¯åŸºäºè¿½æº¯æ–¹å¼æ¥å®ç°çš„ï¼Œä¹Ÿå°±æ˜¯è¯´å½“ä¸€ä¸ªæ¶ˆæ¯çš„TTLåˆ°æœŸä»¥åä¸ä¸€å®šä¼šè¢«ç§»é™¤æˆ–æŠ•é€’åˆ°æ­»ä¿¡äº¤æ¢æœºï¼Œè€Œæ˜¯åœ¨æ¶ˆæ¯æ°å¥½å¤„äºé˜Ÿé¦–æ—¶æ‰ä¼šè¢«å¤„ç†ã€‚</p><p>å½“é˜Ÿåˆ—ä¸­æ¶ˆæ¯å †ç§¯å¾ˆå¤šçš„æ—¶å€™ï¼Œè¿‡æœŸæ¶ˆæ¯å¯èƒ½ä¸ä¼šè¢«æŒ‰æ—¶å¤„ç†ï¼Œå› æ­¤ä½ è®¾ç½®çš„TTLæ—¶é—´ä¸ä¸€å®šå‡†ç¡®ã€‚</p></blockquote><h2 id="4-2-DelayExchangeæ’ä»¶">4.2.DelayExchangeæ’ä»¶</h2><p>åŸºäºæ­»ä¿¡é˜Ÿåˆ—è™½ç„¶å¯ä»¥å®ç°å»¶è¿Ÿæ¶ˆæ¯ï¼Œä½†æ˜¯å¤ªéº»çƒ¦äº†ã€‚å› æ­¤RabbitMQç¤¾åŒºæä¾›äº†ä¸€ä¸ªå»¶è¿Ÿæ¶ˆæ¯æ’ä»¶æ¥å®ç°ç›¸åŒçš„æ•ˆæœã€‚</p><p>å®˜æ–¹æ–‡æ¡£è¯´æ˜ï¼š</p><h3 id="4-2-1-ä¸‹è½½">4.2.1.ä¸‹è½½</h3><p>æ’ä»¶ä¸‹è½½åœ°å€ï¼š</p><p>ç”±äºæˆ‘ä»¬å®‰è£…çš„MQæ˜¯<code>3.8</code>ç‰ˆæœ¬ï¼Œå› æ­¤è¿™é‡Œä¸‹è½½<code>3.8.17</code>ç‰ˆæœ¬ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/KqSKbHiB5oHaCPxSVG5cBt00nac.png" alt=""></p><p>å½“ç„¶ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨è¯¾å‰èµ„æ–™æä¾›å¥½çš„æ’ä»¶ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/U7x4bEQwcosUk2xNHdGc098znec.png" alt=""></p><h3 id="4-2-2-å®‰è£…">4.2.2.å®‰è£…</h3><p>å› ä¸ºæˆ‘ä»¬æ˜¯åŸºäºDockerå®‰è£…ï¼Œæ‰€ä»¥éœ€è¦å…ˆæŸ¥çœ‹RabbitMQçš„æ’ä»¶ç›®å½•å¯¹åº”çš„æ•°æ®å·ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker volume inspect mq-plugins</span><br></pre></td></tr></table></figure><p>ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;CreatedAt&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2024-06-19T09:22:59+08:00&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;Driver&quot;</span><span class="punctuation">:</span> <span class="string">&quot;local&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;Labels&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;Mountpoint&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/var/lib/docker/volumes/mq-plugins/_data&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;Name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;mq-plugins&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;Options&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;Scope&quot;</span><span class="punctuation">:</span> <span class="string">&quot;local&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span></span><br></pre></td></tr></table></figure><p>æ’ä»¶ç›®å½•è¢«æŒ‚è½½åˆ°äº†<code>/var/lib/docker/volumes/mq-plugins/_data</code>è¿™ä¸ªç›®å½•ï¼Œæˆ‘ä»¬ä¸Šä¼ æ’ä»¶åˆ°è¯¥ç›®å½•ä¸‹ã€‚</p><p>æ¥ä¸‹æ¥æ‰§è¡Œå‘½ä»¤ï¼Œå®‰è£…æ’ä»¶ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it mq rabbitmq-plugins enable rabbitmq_delayed_message_exchange</span><br></pre></td></tr></table></figure><p>è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/TZdFbdnG8oJ9aSxedA9cjII6n0f.png" alt=""></p><h3 id="4-2-3-å£°æ˜å»¶è¿Ÿäº¤æ¢æœº">4.2.3.å£°æ˜å»¶è¿Ÿäº¤æ¢æœº</h3><p>åŸºäºæ³¨è§£æ–¹å¼ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RabbitListener(bindings = @QueueBinding(</span></span><br><span class="line"><span class="meta">        value = @Queue(name = &quot;delay.queue&quot;, durable = &quot;true&quot;),</span></span><br><span class="line"><span class="meta">        exchange = @Exchange(name = &quot;delay.direct&quot;, delayed = &quot;true&quot;),</span></span><br><span class="line"><span class="meta">        key = &quot;delay&quot;</span></span><br><span class="line"><span class="meta">))</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenDelayMessage</span><span class="params">(String msg)</span>&#123;</span><br><span class="line">    log.info(<span class="string">&quot;æ¥æ”¶åˆ°delay.queueçš„å»¶è¿Ÿæ¶ˆæ¯ï¼š&#123;&#125;&quot;</span>, msg);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŸºäº<code>@Bean</code>çš„æ–¹å¼ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.consumer.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.core.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DelayExchangeConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> DirectExchange <span class="title function_">delayExchange</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ExchangeBuilder</span><br><span class="line">                .directExchange(<span class="string">&quot;delay.direct&quot;</span>) <span class="comment">// æŒ‡å®šäº¤æ¢æœºç±»å‹å’Œåç§°</span></span><br><span class="line">                .delayed() <span class="comment">// è®¾ç½®delayçš„å±æ€§ä¸ºtrue</span></span><br><span class="line">                .durable(<span class="literal">true</span>) <span class="comment">// æŒä¹…åŒ–</span></span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Queue <span class="title function_">delayedQueue</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Queue</span>(<span class="string">&quot;delay.queue&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Binding <span class="title function_">delayQueueBinding</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(delayedQueue()).to(delayExchange()).with(<span class="string">&quot;delay&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-2-4-å‘é€å»¶è¿Ÿæ¶ˆæ¯">4.2.4.å‘é€å»¶è¿Ÿæ¶ˆæ¯</h3><p>å‘é€æ¶ˆæ¯æ—¶ï¼Œå¿…é¡»é€šè¿‡x-delayå±æ€§è®¾å®šå»¶è¿Ÿæ—¶é—´ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testPublisherDelayMessage</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// 1.åˆ›å»ºæ¶ˆæ¯</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">&quot;hello, delayed message&quot;</span>;</span><br><span class="line">    <span class="comment">// 2.å‘é€æ¶ˆæ¯ï¼Œåˆ©ç”¨æ¶ˆæ¯åç½®å¤„ç†å™¨æ·»åŠ æ¶ˆæ¯å¤´</span></span><br><span class="line">    rabbitTemplate.convertAndSend(<span class="string">&quot;delay.direct&quot;</span>, <span class="string">&quot;delay&quot;</span>, message, <span class="keyword">new</span> <span class="title class_">MessagePostProcessor</span>() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> Message <span class="title function_">postProcessMessage</span><span class="params">(Message message)</span> <span class="keyword">throws</span> AmqpException &#123;</span><br><span class="line">            <span class="comment">// æ·»åŠ å»¶è¿Ÿæ¶ˆæ¯å±æ€§</span></span><br><span class="line">            message.getMessageProperties().setDelay(<span class="number">5000</span>);</span><br><span class="line">            <span class="keyword">return</span> message;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><strong>æ³¨æ„ï¼š</strong></p><p>å»¶è¿Ÿæ¶ˆæ¯æ’ä»¶å†…éƒ¨ä¼šç»´æŠ¤ä¸€ä¸ªæœ¬åœ°æ•°æ®åº“è¡¨ï¼ŒåŒæ—¶ä½¿ç”¨Elang TimersåŠŸèƒ½å®ç°è®¡æ—¶ã€‚å¦‚æœæ¶ˆæ¯çš„å»¶è¿Ÿæ—¶é—´è®¾ç½®è¾ƒé•¿ï¼Œå¯èƒ½ä¼šå¯¼è‡´å †ç§¯çš„å»¶è¿Ÿæ¶ˆæ¯éå¸¸å¤šï¼Œä¼šå¸¦æ¥è¾ƒå¤§çš„CPUå¼€é”€ï¼ŒåŒæ—¶å»¶è¿Ÿæ¶ˆæ¯çš„æ—¶é—´ä¼šå­˜åœ¨è¯¯å·®ã€‚</p><p>å› æ­¤ï¼Œ<strong>ä¸å»ºè®®è®¾ç½®å»¶è¿Ÿæ—¶é—´è¿‡é•¿çš„å»¶è¿Ÿæ¶ˆæ¯</strong>ã€‚</p></blockquote><h2 id="4-3-è¶…æ—¶è®¢å•é—®é¢˜">4.3.è¶…æ—¶è®¢å•é—®é¢˜</h2><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±åœ¨äº¤æ˜“æœåŠ¡ä¸­åˆ©ç”¨å»¶è¿Ÿæ¶ˆæ¯å®ç°è®¢å•è¶…æ—¶å–æ¶ˆåŠŸèƒ½ã€‚å…¶å¤§æ¦‚æ€è·¯å¦‚ä¸‹ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/MIOhbsy7KomGNMxnXXIc4Tu4nXW.jpg" alt=""></p><p>å‡å¦‚è®¢å•è¶…æ—¶æ”¯ä»˜æ—¶é—´ä¸º30åˆ†é’Ÿï¼Œç†è®ºä¸Šè¯´æˆ‘ä»¬åº”è¯¥åœ¨ä¸‹å•æ—¶å‘é€ä¸€æ¡å»¶è¿Ÿæ¶ˆæ¯ï¼Œå»¶è¿Ÿæ—¶é—´ä¸º30åˆ†é’Ÿã€‚è¿™æ ·å°±å¯ä»¥åœ¨æ¥æ”¶åˆ°æ¶ˆæ¯æ—¶æ£€éªŒè®¢å•æ”¯ä»˜çŠ¶æ€ï¼Œå…³é—­æœªæ”¯ä»˜è®¢å•ã€‚</p><h3 id="4-3-1-å®šä¹‰å¸¸é‡">4.3.1.å®šä¹‰å¸¸é‡</h3><p>æ— è®ºæ˜¯æ¶ˆæ¯å‘é€è¿˜æ˜¯æ¥æ”¶éƒ½æ˜¯åœ¨äº¤æ˜“æœåŠ¡å®Œæˆï¼Œå› æ­¤æˆ‘ä»¬åœ¨<code>trade-service</code>ä¸­å®šä¹‰ä¸€ä¸ªå¸¸é‡ç±»ï¼Œç”¨äºè®°å½•äº¤æ¢æœºã€é˜Ÿåˆ—ã€RoutingKeyç­‰å¸¸é‡ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/GHBGbT2WLoreOwxwyT5cPu1anOf.png" alt=""></p><p>å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hmall.trade.constants;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">MQConstants</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">DELAY_EXCHANGE_NAME</span> <span class="operator">=</span> <span class="string">&quot;trade.delay.direct&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">DELAY_ORDER_QUEUE_NAME</span> <span class="operator">=</span> <span class="string">&quot;trade.delay.order.queue&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">DELAY_ORDER_KEY</span> <span class="operator">=</span> <span class="string">&quot;delay.order.query&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-3-2-é…ç½®MQ">4.3.2.é…ç½®MQ</h3><p>åœ¨<code>trade-service</code>æ¨¡å—çš„<code>pom.xml</code>ä¸­å¼•å…¥amqpçš„ä¾èµ–ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--amqp--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-amqp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>åœ¨<code>trade-service</code>çš„<code>application.yaml</code>ä¸­æ·»åŠ MQçš„é…ç½®ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">rabbitmq:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="number">192.168</span><span class="number">.150</span><span class="number">.101</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">5672</span></span><br><span class="line">    <span class="attr">virtual-host:</span> <span class="string">/hmall</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">hmall</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123</span></span><br></pre></td></tr></table></figure><h3 id="4-3-3-æ”¹é€ ä¸‹å•ä¸šåŠ¡ï¼Œå‘é€å»¶è¿Ÿæ¶ˆæ¯">4.3.3.æ”¹é€ ä¸‹å•ä¸šåŠ¡ï¼Œå‘é€å»¶è¿Ÿæ¶ˆæ¯</h3><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ”¹é€ ä¸‹å•ä¸šåŠ¡ï¼Œåœ¨ä¸‹å•å®Œæˆåï¼Œå‘é€å»¶è¿Ÿæ¶ˆæ¯ï¼ŒæŸ¥è¯¢æ”¯ä»˜çŠ¶æ€ã€‚</p><p>ä¿®æ”¹<code>trade-service</code>æ¨¡å—çš„<code>com.hmall.trade.service.impl.OrderServiceImpl</code>ç±»çš„<code>createOrder</code>æ–¹æ³•ï¼Œæ·»åŠ æ¶ˆæ¯å‘é€çš„ä»£ç ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/image-1.png" alt=""></p><p>è¿™é‡Œå»¶è¿Ÿæ¶ˆæ¯çš„æ—¶é—´åº”è¯¥æ˜¯15åˆ†é’Ÿï¼Œä¸è¿‡æˆ‘ä»¬ä¸ºäº†æµ‹è¯•æ–¹ä¾¿ï¼Œæ”¹æˆ10ç§’ã€‚</p><h3 id="4-3-4-ç¼–å†™æŸ¥è¯¢æ”¯ä»˜çŠ¶æ€æ¥å£">4.3.4.ç¼–å†™æŸ¥è¯¢æ”¯ä»˜çŠ¶æ€æ¥å£</h3><p>ç”±äºMQæ¶ˆæ¯å¤„ç†æ—¶éœ€è¦æŸ¥è¯¢æ”¯ä»˜çŠ¶æ€ï¼Œå› æ­¤æˆ‘ä»¬è¦åœ¨<code>pay-service</code>æ¨¡å—å®šä¹‰ä¸€ä¸ªè¿™æ ·çš„æ¥å£ï¼Œå¹¶æä¾›å¯¹åº”çš„<code>FeignClient</code>.</p><p>é¦–å…ˆï¼Œåœ¨<code>hm-api</code>æ¨¡å—å®šä¹‰ä¸‰ä¸ªç±»ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/U4aPbhArAovCXyxs3iRcH6IUnAc.png" alt=""></p><p>è¯´æ˜ï¼š</p><ul><li><p>PayOrderDTOï¼šæ”¯ä»˜å•çš„æ•°æ®ä¼ è¾“å®ä½“</p></li><li><p>PayClientï¼šæ”¯ä»˜ç³»ç»Ÿçš„Feignå®¢æˆ·ç«¯</p></li><li><p>PayClientFallbackï¼šæ”¯ä»˜ç³»ç»Ÿçš„fallbacké€»è¾‘</p></li></ul><p><code>PayOrderDTO</code>ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hmall.api.dto;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiModel;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiModelProperty;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * æ”¯ä»˜è®¢å•</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@ApiModel(description = &quot;æ”¯ä»˜å•æ•°æ®ä¼ è¾“å®ä½“&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PayOrderDTO</span> &#123;</span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;id&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;ä¸šåŠ¡è®¢å•å·&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long bizOrderNo;</span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;æ”¯ä»˜å•å·&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long payOrderNo;</span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;æ”¯ä»˜ç”¨æˆ·id&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long bizUserId;</span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;æ”¯ä»˜æ¸ é“ç¼–ç &quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String payChannelCode;</span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;æ”¯ä»˜é‡‘é¢ï¼Œå•ä½åˆ†&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer amount;</span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;ä»˜ç±»å‹ï¼Œ1ï¼šh5,2:å°ç¨‹åºï¼Œ3ï¼šå…¬ä¼—å·ï¼Œ4ï¼šæ‰«ç ï¼Œ5ï¼šä½™é¢æ”¯ä»˜&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer payType;</span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;ä»˜çŠ¶æ€ï¼Œ0ï¼šå¾…æäº¤ï¼Œ1:å¾…æ”¯ä»˜ï¼Œ2ï¼šæ”¯ä»˜è¶…æ—¶æˆ–å–æ¶ˆï¼Œ3ï¼šæ”¯ä»˜æˆåŠŸ&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer status;</span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;æ‹“å±•å­—æ®µï¼Œç”¨äºä¼ é€’ä¸åŒæ¸ é“å•ç‹¬å¤„ç†çš„å­—æ®µ&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String expandJson;</span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;ç¬¬ä¸‰æ–¹è¿”å›ä¸šåŠ¡ç &quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String resultCode;</span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;ç¬¬ä¸‰æ–¹è¿”å›æç¤ºä¿¡æ¯&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String resultMsg;</span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;æ”¯ä»˜æˆåŠŸæ—¶é—´&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime paySuccessTime;</span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;æ”¯ä»˜è¶…æ—¶æ—¶é—´&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime payOverTime;</span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;æ”¯ä»˜äºŒç»´ç é“¾æ¥&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String qrCodeUrl;</span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;åˆ›å»ºæ—¶é—´&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime createTime;</span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;æ›´æ–°æ—¶é—´&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime updateTime;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>PayClient</code>ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hmall.api.client;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.hmall.api.client.fallback.PayClientFallback;</span><br><span class="line"><span class="keyword">import</span> com.hmall.api.dto.PayOrderDTO;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.openfeign.FeignClient;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"></span><br><span class="line"><span class="meta">@FeignClient(value = &quot;pay-service&quot;, fallbackFactory = PayClientFallback.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">PayClient</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®äº¤æ˜“è®¢å•idæŸ¥è¯¢æ”¯ä»˜å•</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id ä¸šåŠ¡è®¢å•id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> æ”¯ä»˜å•ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/pay-orders/biz/&#123;id&#125;&quot;)</span></span><br><span class="line">    PayOrderDTO <span class="title function_">queryPayOrderByBizOrderNo</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>PayClientFallback</code>ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hmall.api.client.fallback;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.hmall.api.client.PayClient;</span><br><span class="line"><span class="keyword">import</span> com.hmall.api.dto.PayOrderDTO;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.openfeign.FallbackFactory;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PayClientFallback</span> <span class="keyword">implements</span> <span class="title class_">FallbackFactory</span>&lt;PayClient&gt; &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> PayClient <span class="title function_">create</span><span class="params">(Throwable cause)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PayClient</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> PayOrderDTO <span class="title function_">queryPayOrderByBizOrderNo</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€åï¼Œåœ¨<code>pay-service</code>æ¨¡å—çš„<code>PayController</code>ä¸­å®ç°è¯¥æ¥å£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(&quot;æ ¹æ®idæŸ¥è¯¢æ”¯ä»˜å•&quot;)</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/biz/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> PayOrderDTO <span class="title function_">queryPayOrderByBizOrderNo</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span>&#123;</span><br><span class="line">    <span class="type">PayOrder</span> <span class="variable">payOrder</span> <span class="operator">=</span> payOrderService.lambdaQuery().eq(PayOrder::getBizOrderNo, id).one();</span><br><span class="line">    <span class="keyword">return</span> BeanUtils.copyBean(payOrder, PayOrderDTO.class);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-3-5-ç›‘å¬æ¶ˆæ¯ï¼ŒæŸ¥è¯¢æ”¯ä»˜çŠ¶æ€">4.3.5.ç›‘å¬æ¶ˆæ¯ï¼ŒæŸ¥è¯¢æ”¯ä»˜çŠ¶æ€</h3><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åœ¨<code>trader-service</code>ç¼–å†™ä¸€ä¸ªç›‘å¬å™¨ï¼Œç›‘å¬å»¶è¿Ÿæ¶ˆæ¯ï¼ŒæŸ¥è¯¢è®¢å•æ”¯ä»˜çŠ¶æ€ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/image-2.png" alt=""></p><p>ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hmall.trade.listener;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.hmall.api.client.PayClient;</span><br><span class="line"><span class="keyword">import</span> com.hmall.api.dto.PayOrderDTO;</span><br><span class="line"><span class="keyword">import</span> com.hmall.trade.constants.MQConstants;</span><br><span class="line"><span class="keyword">import</span> com.hmall.trade.domain.po.Order;</span><br><span class="line"><span class="keyword">import</span> com.hmall.trade.service.IOrderService;</span><br><span class="line"><span class="keyword">import</span> lombok.RequiredArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.rabbit.annotation.Exchange;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.rabbit.annotation.Queue;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.rabbit.annotation.QueueBinding;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.rabbit.annotation.RabbitListener;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderDelayMessageListener</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> IOrderService orderService;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> PayClient payClient;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RabbitListener(bindings = @QueueBinding(</span></span><br><span class="line"><span class="meta">            value = @Queue(name = MQConstants.DELAY_ORDER_QUEUE_NAME),</span></span><br><span class="line"><span class="meta">            exchange = @Exchange(name = MQConstants.DELAY_EXCHANGE_NAME, delayed = &quot;true&quot;),</span></span><br><span class="line"><span class="meta">            key = MQConstants.DELAY_ORDER_KEY</span></span><br><span class="line"><span class="meta">    ))</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenOrderDelayMessage</span><span class="params">(Long orderId)</span>&#123;</span><br><span class="line">        <span class="comment">// 1.æŸ¥è¯¢è®¢å•</span></span><br><span class="line">        <span class="type">Order</span> <span class="variable">order</span> <span class="operator">=</span> orderService.getById(orderId);</span><br><span class="line">        <span class="comment">// 2.æ£€æµ‹è®¢å•çŠ¶æ€ï¼Œåˆ¤æ–­æ˜¯å¦å·²æ”¯ä»˜</span></span><br><span class="line">        <span class="keyword">if</span>(order == <span class="literal">null</span> || order.getStatus() != <span class="number">1</span>)&#123;</span><br><span class="line">            <span class="comment">// è®¢å•ä¸å­˜åœ¨æˆ–è€…å·²ç»æ”¯ä»˜</span></span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 3.æœªæ”¯ä»˜ï¼Œéœ€è¦æŸ¥è¯¢æ”¯ä»˜æµæ°´çŠ¶æ€</span></span><br><span class="line">        <span class="type">PayOrderDTO</span> <span class="variable">payOrder</span> <span class="operator">=</span> payClient.queryPayOrderByBizOrderNo(orderId);</span><br><span class="line">        <span class="comment">// 4.åˆ¤æ–­æ˜¯å¦æ”¯ä»˜</span></span><br><span class="line">        <span class="keyword">if</span>(payOrder != <span class="literal">null</span> &amp;&amp; payOrder.getStatus() == <span class="number">3</span>)&#123;</span><br><span class="line">            <span class="comment">// 4.1.å·²æ”¯ä»˜ï¼Œæ ‡è®°è®¢å•çŠ¶æ€ä¸ºå·²æ”¯ä»˜</span></span><br><span class="line">            orderService.markOrderPaySuccess(orderId);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">// TODO 4.2.æœªæ”¯ä»˜ï¼Œå–æ¶ˆè®¢å•ï¼Œå›å¤åº“å­˜</span></span><br><span class="line">            orderService.cancelOrder(orderId);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œè¿™é‡Œè¦åœ¨OrderServiceImplä¸­å®ç°cancelOrderæ–¹æ³•ï¼Œç•™ä½œä½œä¸šå¤§å®¶è‡ªè¡Œå®ç°ã€‚</p><h1 id="5-ä½œä¸š">5.ä½œä¸š</h1><h2 id="5-1-å–æ¶ˆè®¢å•">5.1.å–æ¶ˆè®¢å•</h2><p>åœ¨å¤„ç†è¶…æ—¶æœªæ”¯ä»˜è®¢å•æ—¶ï¼Œå¦‚æœå‘ç°è®¢å•ç¡®å®è¶…æ—¶æœªæ”¯ä»˜ï¼Œæœ€ç»ˆéœ€è¦å…³é—­è¯¥è®¢å•ã€‚</p><p>å…³é—­è®¢å•éœ€è¦å®Œæˆä¸¤ä»¶äº‹æƒ…ï¼š</p><ul><li><p>å°†è®¢å•çŠ¶æ€ä¿®æ”¹ä¸ºå·²å…³é—­</p></li><li><p>æ¢å¤è®¢å•ä¸­å·²ç»æ‰£é™¤çš„åº“å­˜</p></li></ul><p>è¿™éƒ¨åˆ†åŠŸèƒ½å°šæœªå®ç°ã€‚</p><p>å¤§å®¶è¦åœ¨<code>IOrderService</code>æ¥å£ä¸­å®šä¹‰<code>cancelOrder</code>æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">cancelOrder</span><span class="params">(Long orderId)</span>;</span><br></pre></td></tr></table></figure><p>å¹¶ä¸”åœ¨<code>OrderServiceImpl</code>ä¸­å®ç°è¯¥æ–¹æ³•ã€‚å®ç°è¿‡ç¨‹ä¸­è¦æ³¨æ„ä¸šåŠ¡å¹‚ç­‰æ€§åˆ¤æ–­ã€‚</p><h2 id="5-2-æŠ½å–MQå·¥å…·">5.2.æŠ½å–MQå·¥å…·</h2><p>MQåœ¨ä¼ä¸šå¼€å‘ä¸­çš„å¸¸è§åº”ç”¨æˆ‘ä»¬å°±å­¦ä¹ å®Œæ¯•äº†ï¼Œé™¤äº†æ”¶å‘æ¶ˆæ¯ä»¥å¤–ï¼Œæ¶ˆæ¯å¯é æ€§çš„å¤„ç†ã€ç”Ÿäº§è€…ç¡®è®¤ã€æ¶ˆè´¹è€…ç¡®è®¤ã€å»¶è¿Ÿæ¶ˆæ¯ç­‰ç­‰ç¼–ç è¿˜æ˜¯ç›¸å¯¹æ¯”è¾ƒå¤æ‚çš„ã€‚</p><p>å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦å°†è¿™äº›å¸¸ç”¨çš„æ“ä½œå°è£…ä¸ºå·¥å…·ï¼Œæ–¹ä¾¿åœ¨é¡¹ç›®ä¸­ä½¿ç”¨ã€‚è¦æ±‚å¦‚ä¸‹ï¼š</p><ul><li><p>å°†RabbitMQçš„yamlé…ç½®æŠ½å–åˆ°nacosä¸­ï¼Œä½œä¸ºå…±äº«é…ç½®ï¼Œæ›¿æ¢æ‰€æœ‰å¾®æœåŠ¡ä¸­çš„è‡ªå®šä¹‰MQé…ç½®</p></li><li><p>åœ¨<code>hm-commom</code>æ¨¡å—ä¸‹ç¼–å†™å‘é€æ¶ˆæ¯çš„å·¥å…·ç±»<code>RabbitMqHelper</code></p></li><li><p>å®šä¹‰ä¸€ä¸ªè‡ªåŠ¨é…ç½®ç±»<code>MqConsumeErrorAutoConfiguration</code>ï¼Œå†…å®¹åŒ…æ‹¬ï¼š</p><ul><li><p>å£°æ˜ä¸€ä¸ªäº¤æ¢æœºï¼Œåä¸º<code>error.direct</code>ï¼Œç±»å‹ä¸º<code>direct</code></p></li><li><p>å£°æ˜ä¸€ä¸ªé˜Ÿåˆ—ï¼Œåä¸ºï¼š<code>å¾®æœåŠ¡å + error.queue</code>ï¼Œä¹Ÿå°±æ˜¯è¯´è¦åŠ¨æ€è·å–</p></li><li><p>å°†é˜Ÿåˆ—ä¸äº¤æ¢æœºç»‘å®šï¼Œç»‘å®šæ—¶çš„<code>RoutingKey</code>å°±æ˜¯<code>å¾®æœåŠ¡å</code></p></li><li><p>å£°æ˜<code>RepublishMessageRecoverer</code>ï¼Œæ¶ˆè´¹å¤±è´¥æ¶ˆæ¯æŠ•é€’åˆ°ä¸Šè¿°äº¤æ¢æœº</p></li><li><p>ç»™é…ç½®ç±»æ·»åŠ æ¡ä»¶ï¼Œå½“<code>spring.rabbitmq.listener.simple.retry.enabled</code>ä¸º<code>true</code>æ—¶è§¦å‘</p></li></ul></li></ul><p>RabbitMqHelperçš„ç»“æ„å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RabbitMqHelper</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> RabbitTemplate rabbitTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendMessage</span><span class="params">(String exchange, String routingKey, Object msg)</span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendDelayMessage</span><span class="params">(String exchange, String routingKey, Object msg, <span class="type">int</span> delay)</span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendMessageWithConfirm</span><span class="params">(String exchange, String routingKey, Object msg, <span class="type">int</span> maxRetries)</span>&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="5-3-æ”¹é€ ä¸šåŠ¡">5.3.æ”¹é€ ä¸šåŠ¡</h2><p>åˆ©ç”¨ä½ ç¼–å†™çš„å·¥å…·ï¼Œæ”¹é€ æ”¯ä»˜æœåŠ¡ã€è´­ç‰©è½¦æœåŠ¡ã€äº¤æ˜“æœåŠ¡ä¸­æ¶ˆæ¯å‘é€åŠŸèƒ½ï¼Œå¹¶ä¸”æ·»åŠ æ¶ˆæ¯ç¡®è®¤æˆ–æ¶ˆè´¹è€…é‡è¯•æœºåˆ¶ï¼Œç¡®ä¿æ¶ˆæ¯çš„å¯é æ€§ã€‚</p>]]></content>
    
    
    <summary type="html">MQé«˜çº§çš„å­¦ä¹ è·¯çº¿ï¼ŒåŒ…æ‹¬MQçš„æ¦‚å¿µã€MQçš„åˆ†ç±»ã€MQçš„ä½¿ç”¨åœºæ™¯ã€MQçš„ä½¿ç”¨æ–¹å¼ç­‰ã€‚</summary>
    
    
    
    <category term="å­¦ä¹ ç¬”è®°" scheme="https://u7u7.top/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    
    <category term="å¾®æœåŠ¡" scheme="https://u7u7.top/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"/>
    
    <category term="Java" scheme="https://u7u7.top/tags/Java/"/>
    
    <category term="MQ" scheme="https://u7u7.top/tags/MQ/"/>
    
  </entry>
  
  <entry>
    <title>MQåŸºç¡€</title>
    <link href="https://u7u7.top/posts/MQLow.html"/>
    <id>https://u7u7.top/posts/MQLow.html</id>
    <published>2025-08-24T03:00:25.000Z</published>
    <updated>2025-08-25T01:40:57.515Z</updated>
    
    <content type="html"><![CDATA[<p>å¯¹åº”Bç«™è§†é¢‘ï¼š</p><iframe src="https://player.bilibili.com/player.html?bvid=1S142197x7&p=85&vd_source=1ff0c1b434581723cf696ccc2f59ceaa" sandbox="allow-scripts allow-same-origin allow-presentation allow-forms allow-popups allow-downloads" allowfullscreen allow="encrypted-media; fullscreen; autoplay" referrerpolicy="strict-origin-when-cross-origin" frameborder="0" style="width: 100%; min-height: 292px; border-radius: 8px;"></iframe><p>å¾®æœåŠ¡ä¸€æ—¦æ‹†åˆ†ï¼Œå¿…ç„¶æ¶‰åŠåˆ°æœåŠ¡ä¹‹é—´çš„ç›¸äº’è°ƒç”¨ï¼Œç›®å‰æˆ‘ä»¬æœåŠ¡ä¹‹é—´è°ƒç”¨é‡‡ç”¨çš„éƒ½æ˜¯åŸºäºOpenFeignçš„è°ƒç”¨ã€‚è¿™ç§è°ƒç”¨ä¸­ï¼Œè°ƒç”¨è€…å‘èµ·è¯·æ±‚åéœ€è¦<strong>ç­‰å¾…</strong>æœåŠ¡æä¾›è€…æ‰§è¡Œä¸šåŠ¡è¿”å›ç»“æœåï¼Œæ‰èƒ½ç»§ç»­æ‰§è¡Œåé¢çš„ä¸šåŠ¡ã€‚ä¹Ÿå°±æ˜¯è¯´è°ƒç”¨è€…åœ¨è°ƒç”¨è¿‡ç¨‹ä¸­å¤„äºé˜»å¡çŠ¶æ€ï¼Œå› æ­¤æˆ‘ä»¬ç§°è¿™ç§è°ƒç”¨æ–¹å¼ä¸º<strong>åŒæ­¥è°ƒç”¨</strong>ï¼Œä¹Ÿå¯ä»¥å«<strong>åŒæ­¥é€šè®¯</strong>ã€‚ä½†åœ¨å¾ˆå¤šåœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦é‡‡ç”¨<strong>å¼‚æ­¥é€šè®¯</strong>çš„æ–¹å¼ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p><p>æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ä»€ä¹ˆæ˜¯åŒæ­¥é€šè®¯å’Œå¼‚æ­¥é€šè®¯ã€‚å¦‚å›¾ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/B82Sbxk3DoAsVTx7KV1cXjz3nsg-175603011396879.png" alt=""></p><p>è§£è¯»ï¼š</p><ul><li><p>åŒæ­¥é€šè®¯ï¼šå°±å¦‚åŒæ‰“è§†é¢‘ç”µè¯ï¼ŒåŒæ–¹çš„äº¤äº’éƒ½æ˜¯å®æ—¶çš„ã€‚å› æ­¤åŒä¸€æ—¶åˆ»ä½ åªèƒ½è·Ÿä¸€ä¸ªäººæ‰“è§†é¢‘ç”µè¯ã€‚</p></li><li><p>å¼‚æ­¥é€šè®¯ï¼šå°±å¦‚åŒå‘å¾®ä¿¡èŠå¤©ï¼ŒåŒæ–¹çš„äº¤äº’ä¸æ˜¯å®æ—¶çš„ï¼Œä½ ä¸éœ€è¦ç«‹åˆ»ç»™å¯¹æ–¹å›åº”ã€‚å› æ­¤ä½ å¯ä»¥å¤šçº¿æ“ä½œï¼ŒåŒæ—¶è·Ÿå¤šäººèŠå¤©ã€‚</p></li></ul><p>ä¸¤ç§æ–¹å¼å„æœ‰ä¼˜åŠ£ï¼Œæ‰“ç”µè¯å¯ä»¥ç«‹å³å¾—åˆ°å“åº”ï¼Œä½†æ˜¯ä½ å´ä¸èƒ½è·Ÿå¤šä¸ªäººåŒæ—¶é€šè¯ã€‚å‘å¾®ä¿¡å¯ä»¥åŒæ—¶ä¸å¤šä¸ªäººæ”¶å‘å¾®ä¿¡ï¼Œä½†æ˜¯å¾€å¾€å“åº”ä¼šæœ‰å»¶è¿Ÿã€‚</p><p>æ‰€ä»¥ï¼Œå¦‚æœæˆ‘ä»¬çš„ä¸šåŠ¡éœ€è¦å®æ—¶å¾—åˆ°æœåŠ¡æä¾›æ–¹çš„å“åº”ï¼Œåˆ™åº”è¯¥é€‰æ‹©åŒæ­¥é€šè®¯ï¼ˆåŒæ­¥è°ƒç”¨ï¼‰ã€‚è€Œå¦‚æœæˆ‘ä»¬è¿½æ±‚æ›´é«˜çš„æ•ˆç‡ï¼Œå¹¶ä¸”ä¸éœ€è¦å®æ—¶å“åº”ï¼Œåˆ™åº”è¯¥é€‰æ‹©å¼‚æ­¥é€šè®¯ï¼ˆå¼‚æ­¥è°ƒç”¨ï¼‰ã€‚<br> </p><p>åŒæ­¥è°ƒç”¨çš„æ–¹å¼æˆ‘ä»¬å·²ç»å­¦è¿‡äº†ï¼Œä¹‹å‰çš„OpenFeignè°ƒç”¨å°±æ˜¯ã€‚ä½†æ˜¯ï¼š</p><ul><li><p>å¼‚æ­¥è°ƒç”¨åˆè¯¥å¦‚ä½•å®ç°ï¼Ÿ</p></li><li><p>å“ªäº›ä¸šåŠ¡é€‚åˆç”¨å¼‚æ­¥è°ƒç”¨æ¥å®ç°å‘¢ï¼Ÿ</p></li></ul><p>é€šè¿‡ä»Šå¤©çš„å­¦ä¹ ä½ å°±èƒ½æ˜ç™½è¿™äº›é—®é¢˜äº†ã€‚</p><h1 id="1-åˆè¯†MQ">1.åˆè¯†MQ</h1><h2 id="1-1-åŒæ­¥è°ƒç”¨">1.1.åŒæ­¥è°ƒç”¨</h2><p>ä¹‹å‰è¯´è¿‡ï¼Œæˆ‘ä»¬ç°åœ¨åŸºäºOpenFeignçš„è°ƒç”¨éƒ½å±äºæ˜¯åŒæ­¥è°ƒç”¨ï¼Œé‚£ä¹ˆè¿™ç§æ–¹å¼å­˜åœ¨å“ªäº›é—®é¢˜å‘¢ï¼Ÿ</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬ä»¥æ˜¨å¤©ç•™ç»™å¤§å®¶ä½œä¸ºä½œä¸šçš„<strong>ä½™é¢æ”¯ä»˜åŠŸèƒ½</strong>ä¸ºä¾‹æ¥åˆ†æï¼Œé¦–å…ˆçœ‹ä¸‹æ•´ä¸ªæµç¨‹ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/diagram.png" alt=""></p><p>ç›®å‰æˆ‘ä»¬é‡‡ç”¨çš„æ˜¯åŸºäºOpenFeignçš„åŒæ­¥è°ƒç”¨ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸šåŠ¡æ‰§è¡Œæµç¨‹æ˜¯è¿™æ ·çš„ï¼š</p><ul><li><p>æ”¯ä»˜æœåŠ¡éœ€è¦å…ˆè°ƒç”¨ç”¨æˆ·æœåŠ¡å®Œæˆä½™é¢æ‰£å‡</p></li><li><p>ç„¶åæ”¯ä»˜æœåŠ¡è‡ªå·±è¦æ›´æ–°æ”¯ä»˜æµæ°´å•çš„çŠ¶æ€</p></li><li><p>ç„¶åæ”¯ä»˜æœåŠ¡è°ƒç”¨äº¤æ˜“æœåŠ¡ï¼Œæ›´æ–°ä¸šåŠ¡è®¢å•çŠ¶æ€ä¸ºå·²æ”¯ä»˜</p></li></ul><p>ä¸‰ä¸ªæ­¥éª¤ä¾æ¬¡æ‰§è¡Œã€‚</p><p>è¿™å…¶ä¸­å°±å­˜åœ¨3ä¸ªé—®é¢˜ï¼š</p><p><strong>ç¬¬ä¸€</strong>ï¼Œ<strong>æ‹“å±•æ€§å·®</strong></p><p>æˆ‘ä»¬ç›®å‰çš„ä¸šåŠ¡ç›¸å¯¹ç®€å•ï¼Œä½†æ˜¯éšç€ä¸šåŠ¡è§„æ¨¡æ‰©å¤§ï¼Œäº§å“çš„åŠŸèƒ½ä¹Ÿåœ¨ä¸æ–­å®Œå–„ã€‚</p><p>åœ¨å¤§å¤šæ•°ç”µå•†ä¸šåŠ¡ä¸­ï¼Œç”¨æˆ·æ”¯ä»˜æˆåŠŸåéƒ½ä¼šä»¥çŸ­ä¿¡æˆ–è€…å…¶å®ƒæ–¹å¼é€šçŸ¥ç”¨æˆ·ï¼Œå‘ŠçŸ¥æ”¯ä»˜æˆåŠŸã€‚å‡å¦‚åæœŸäº§å“ç»ç†æå‡ºè¿™æ ·æ–°çš„éœ€æ±‚ï¼Œä½ æ€ä¹ˆåŠï¼Ÿæ˜¯ä¸æ˜¯è¦åœ¨ä¸Šè¿°ä¸šåŠ¡ä¸­å†åŠ å…¥é€šçŸ¥ç”¨æˆ·çš„ä¸šåŠ¡ï¼Ÿ</p><p>æŸäº›ç”µå•†é¡¹ç›®ä¸­ï¼Œè¿˜ä¼šæœ‰ç§¯åˆ†æˆ–é‡‘å¸çš„æ¦‚å¿µã€‚å‡å¦‚äº§å“ç»ç†æå‡ºéœ€æ±‚ï¼Œç”¨æˆ·æ”¯ä»˜æˆåŠŸåï¼Œç»™ç”¨æˆ·ä»¥ç§¯åˆ†å¥–åŠ±æˆ–è€…è¿”è¿˜é‡‘å¸ï¼Œä½ æ€ä¹ˆåŠï¼Ÿæ˜¯ä¸æ˜¯è¦åœ¨ä¸Šè¿°ä¸šåŠ¡ä¸­å†åŠ å…¥ç§¯åˆ†ä¸šåŠ¡ã€è¿”è¿˜é‡‘å¸ä¸šåŠ¡ï¼Ÿ</p><p>ã€‚ã€‚ã€‚</p><p>æœ€ç»ˆä½ çš„æ”¯ä»˜ä¸šåŠ¡ä¼šè¶Šæ¥è¶Šè‡ƒè‚¿ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/diagram-1.png" alt=""></p><p>ä¹Ÿå°±æ˜¯è¯´æ¯æ¬¡æœ‰æ–°çš„éœ€æ±‚ï¼Œç°æœ‰æ”¯ä»˜é€»è¾‘éƒ½è¦è·Ÿç€å˜åŒ–ï¼Œä»£ç ç»å¸¸å˜åŠ¨ï¼Œä¸ç¬¦åˆå¼€é—­åŸåˆ™ï¼Œæ‹“å±•æ€§ä¸å¥½ã€‚</p><p><strong>ç¬¬äºŒ</strong>ï¼Œ<strong>æ€§èƒ½ä¸‹é™</strong></p><p>ç”±äºæˆ‘ä»¬é‡‡ç”¨äº†åŒæ­¥è°ƒç”¨ï¼Œè°ƒç”¨è€…éœ€è¦ç­‰å¾…æœåŠ¡æä¾›è€…æ‰§è¡Œå®Œè¿”å›ç»“æœåï¼Œæ‰èƒ½ç»§ç»­å‘ä¸‹æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯è¯´æ¯æ¬¡è¿œç¨‹è°ƒç”¨ï¼Œè°ƒç”¨è€…éƒ½æ˜¯é˜»å¡ç­‰å¾…çŠ¶æ€ã€‚æœ€ç»ˆæ•´ä¸ªä¸šåŠ¡çš„å“åº”æ—¶é•¿å°±æ˜¯æ¯æ¬¡è¿œç¨‹è°ƒç”¨çš„æ‰§è¡Œæ—¶é•¿ä¹‹å’Œï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/diagram-2.png" alt=""></p><p>å‡å¦‚æ¯ä¸ªå¾®æœåŠ¡çš„æ‰§è¡Œæ—¶é•¿éƒ½æ˜¯50msï¼Œåˆ™æœ€ç»ˆæ•´ä¸ªä¸šåŠ¡çš„è€—æ—¶å¯èƒ½é«˜è¾¾300msï¼Œæ€§èƒ½å¤ªå·®äº†ã€‚</p><p><strong>ç¬¬ä¸‰ï¼Œçº§è”å¤±è´¥</strong></p><p>ç”±äºæˆ‘ä»¬æ˜¯åŸºäºOpenFeignè°ƒç”¨äº¤æ˜“æœåŠ¡ã€é€šçŸ¥æœåŠ¡ã€‚å½“äº¤æ˜“æœåŠ¡ã€é€šçŸ¥æœåŠ¡å‡ºç°æ•…éšœæ—¶ï¼Œæ•´ä¸ªäº‹åŠ¡éƒ½ä¼šå›æ»šï¼Œäº¤æ˜“å¤±è´¥ã€‚</p><p>è¿™å…¶å®å°±æ˜¯åŒæ­¥è°ƒç”¨çš„<strong>çº§è”å¤±è´¥</strong>é—®é¢˜ã€‚</p><p>ä½†æ˜¯å¤§å®¶æ€è€ƒä¸€ä¸‹ï¼Œæˆ‘ä»¬å‡è®¾ç”¨æˆ·ä½™é¢å……è¶³ï¼Œæ‰£æ¬¾å·²ç»æˆåŠŸï¼Œæ­¤æ—¶æˆ‘ä»¬åº”è¯¥ç¡®ä¿æ”¯ä»˜æµæ°´å•æ›´æ–°ä¸ºå·²æ”¯ä»˜ï¼Œç¡®ä¿äº¤æ˜“æˆåŠŸã€‚æ¯•ç«Ÿæ”¶åˆ°æ‰‹é‡Œçš„é’±æ²¡é“ç†å†é€€å›å»å§ã€‚</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/CSCWbPDPvo6OVux4ZKecjLVFnsd.png" alt=""></p><p>å› æ­¤ï¼Œè¿™é‡Œä¸èƒ½å› ä¸ºçŸ­ä¿¡é€šçŸ¥ã€æ›´æ–°è®¢å•çŠ¶æ€å¤±è´¥è€Œå›æ»šæ•´ä¸ªäº‹åŠ¡ã€‚</p><p>ç»¼ä¸Šï¼ŒåŒæ­¥è°ƒç”¨çš„æ–¹å¼å­˜åœ¨ä¸‹åˆ—é—®é¢˜ï¼š</p><ul><li><p>æ‹“å±•æ€§å·®</p></li><li><p>æ€§èƒ½ä¸‹é™</p></li><li><p>çº§è”å¤±è´¥</p></li></ul><p>è€Œè¦è§£å†³è¿™äº›é—®é¢˜ï¼Œæˆ‘ä»¬å°±å¿…é¡»ç”¨<strong>å¼‚æ­¥è°ƒç”¨</strong>çš„æ–¹å¼æ¥ä»£æ›¿<strong>åŒæ­¥è°ƒç”¨</strong>ã€‚</p><h2 id="1-2-å¼‚æ­¥è°ƒç”¨">1.2.å¼‚æ­¥è°ƒç”¨</h2><p>å¼‚æ­¥è°ƒç”¨æ–¹å¼å…¶å®å°±æ˜¯åŸºäºæ¶ˆæ¯é€šçŸ¥çš„æ–¹å¼ï¼Œä¸€èˆ¬åŒ…å«ä¸‰ä¸ªè§’è‰²ï¼š</p><ul><li><p>æ¶ˆæ¯å‘é€è€…ï¼šæŠ•é€’æ¶ˆæ¯çš„äººï¼Œå°±æ˜¯åŸæ¥çš„è°ƒç”¨æ–¹</p></li><li><p>æ¶ˆæ¯Brokerï¼šç®¡ç†ã€æš‚å­˜ã€è½¬å‘æ¶ˆæ¯ï¼Œä½ å¯ä»¥æŠŠå®ƒç†è§£æˆå¾®ä¿¡æœåŠ¡å™¨</p></li><li><p>æ¶ˆæ¯æ¥æ”¶è€…ï¼šæ¥æ”¶å’Œå¤„ç†æ¶ˆæ¯çš„äººï¼Œå°±æ˜¯åŸæ¥çš„æœåŠ¡æä¾›æ–¹</p></li></ul><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/diagram-3.png" alt=""></p><p>åœ¨å¼‚æ­¥è°ƒç”¨ä¸­ï¼Œå‘é€è€…ä¸å†ç›´æ¥åŒæ­¥è°ƒç”¨æ¥æ”¶è€…çš„ä¸šåŠ¡æ¥å£ï¼Œè€Œæ˜¯å‘é€ä¸€æ¡æ¶ˆæ¯æŠ•é€’ç»™æ¶ˆæ¯Brokerã€‚ç„¶åæ¥æ”¶è€…æ ¹æ®è‡ªå·±çš„éœ€æ±‚ä»æ¶ˆæ¯Brokeré‚£é‡Œè®¢é˜…æ¶ˆæ¯ã€‚æ¯å½“å‘é€æ–¹å‘é€æ¶ˆæ¯åï¼Œæ¥å—è€…éƒ½èƒ½è·å–æ¶ˆæ¯å¹¶å¤„ç†ã€‚</p><p>è¿™æ ·ï¼Œå‘é€æ¶ˆæ¯çš„äººå’Œæ¥æ”¶æ¶ˆæ¯çš„äººå°±å®Œå…¨è§£è€¦äº†ã€‚</p><p>è¿˜æ˜¯ä»¥ä½™é¢æ”¯ä»˜ä¸šåŠ¡ä¸ºä¾‹ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/diagram-4.png" alt=""></p><p>é™¤äº†æ‰£å‡ä½™é¢ã€æ›´æ–°æ”¯ä»˜æµæ°´å•çŠ¶æ€ä»¥å¤–ï¼Œå…¶å®ƒè°ƒç”¨é€»è¾‘å…¨éƒ¨å–æ¶ˆã€‚è€Œæ˜¯æ”¹ä¸ºå‘é€ä¸€æ¡æ¶ˆæ¯åˆ°Brokerã€‚è€Œç›¸å…³çš„å¾®æœåŠ¡éƒ½å¯ä»¥è®¢é˜…æ¶ˆæ¯é€šçŸ¥ï¼Œä¸€æ—¦æ¶ˆæ¯åˆ°è¾¾Brokerï¼Œåˆ™ä¼šåˆ†å‘ç»™æ¯ä¸€ä¸ªè®¢é˜…äº†çš„å¾®æœåŠ¡ï¼Œå¤„ç†å„è‡ªçš„ä¸šåŠ¡ã€‚</p><p>å‡å¦‚äº§å“ç»ç†æå‡ºäº†æ–°çš„éœ€æ±‚ï¼Œæ¯”å¦‚è¦åœ¨æ”¯ä»˜æˆåŠŸåæ›´æ–°ç”¨æˆ·ç§¯åˆ†ã€‚æ”¯ä»˜ä»£ç å®Œå…¨ä¸ç”¨å˜æ›´ï¼Œè€Œä»…ä»…æ˜¯è®©ç§¯åˆ†æœåŠ¡ä¹Ÿè®¢é˜…æ¶ˆæ¯å³å¯ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/diagram-5.png" alt=""></p><p>ä¸ç®¡åæœŸå¢åŠ äº†å¤šå°‘æ¶ˆæ¯è®¢é˜…è€…ï¼Œä½œä¸ºæ”¯ä»˜æœåŠ¡æ¥è®²ï¼Œæ‰§è¡Œé—®æ‰£å‡ä½™é¢ã€æ›´æ–°æ”¯ä»˜æµæ°´çŠ¶æ€åï¼Œå‘é€æ¶ˆæ¯å³å¯ã€‚ä¸šåŠ¡è€—æ—¶ä»…ä»…æ˜¯è¿™ä¸‰éƒ¨åˆ†ä¸šåŠ¡è€—æ—¶ï¼Œä»…ä»…100msï¼Œå¤§å¤§æé«˜äº†ä¸šåŠ¡æ€§èƒ½ã€‚</p><p>å¦å¤–ï¼Œä¸ç®¡æ˜¯äº¤æ˜“æœåŠ¡ã€é€šçŸ¥æœåŠ¡ï¼Œè¿˜æ˜¯ç§¯åˆ†æœåŠ¡ï¼Œä»–ä»¬çš„ä¸šåŠ¡ä¸æ”¯ä»˜å…³è”åº¦ä½ã€‚ç°åœ¨é‡‡ç”¨äº†å¼‚æ­¥è°ƒç”¨ï¼Œè§£é™¤äº†è€¦åˆï¼Œä»–ä»¬å³ä¾¿æ‰§è¡Œè¿‡ç¨‹ä¸­å‡ºç°äº†æ•…éšœï¼Œä¹Ÿä¸ä¼šå½±å“åˆ°æ”¯ä»˜æœåŠ¡ã€‚</p><p>ç»¼ä¸Šï¼Œå¼‚æ­¥è°ƒç”¨çš„ä¼˜åŠ¿åŒ…æ‹¬ï¼š</p><ul><li><p>è€¦åˆåº¦æ›´ä½</p></li><li><p>æ€§èƒ½æ›´å¥½</p></li><li><p>ä¸šåŠ¡æ‹“å±•æ€§å¼º</p></li><li><p>æ•…éšœéš”ç¦»ï¼Œé¿å…çº§è”å¤±è´¥</p></li></ul><p>å½“ç„¶ï¼Œå¼‚æ­¥é€šä¿¡ä¹Ÿå¹¶éå®Œç¾æ— ç¼ºï¼Œå®ƒå­˜åœ¨ä¸‹åˆ—ç¼ºç‚¹ï¼š</p><ul><li><p>å®Œå…¨ä¾èµ–äºBrokerçš„å¯é æ€§ã€å®‰å…¨æ€§å’Œæ€§èƒ½</p></li><li><p>æ¶æ„å¤æ‚ï¼ŒåæœŸç»´æŠ¤å’Œè°ƒè¯•éº»çƒ¦</p></li></ul><h2 id="1-3-æŠ€æœ¯é€‰å‹">1.3.æŠ€æœ¯é€‰å‹</h2><p>æ¶ˆæ¯Brokerï¼Œç›®å‰å¸¸è§çš„å®ç°æ–¹æ¡ˆå°±æ˜¯æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆMessageQueueï¼‰ï¼Œç®€ç§°ä¸ºMQ.</p><p>ç›®æ¯”è¾ƒå¸¸è§çš„MQå®ç°ï¼š</p><ul><li><p>ActiveMQ</p></li><li><p>RabbitMQ</p></li><li><p>RocketMQ</p></li><li><p>Kafka</p></li></ul><p>å‡ ç§å¸¸è§MQçš„å¯¹æ¯”ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/d8e1c874b5db80e3913a404a2cb59a89.jpeg" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>è¿½æ±‚å¯ç”¨æ€§ï¼šKafkaã€ RocketMQ ã€RabbitMQ</p><p>è¿½æ±‚å¯é æ€§ï¼šRabbitMQã€RocketMQ</p><p>è¿½æ±‚ååèƒ½åŠ›ï¼šRocketMQã€Kafka</p><p>è¿½æ±‚æ¶ˆæ¯ä½å»¶è¿Ÿï¼šRabbitMQã€Kafka</p><p>æ®ç»Ÿè®¡ï¼Œç›®å‰å›½å†…æ¶ˆæ¯é˜Ÿåˆ—ä½¿ç”¨æœ€å¤šçš„è¿˜æ˜¯RabbitMQï¼Œå†åŠ ä¸Šå…¶å„æ–¹é¢éƒ½æ¯”è¾ƒå‡è¡¡ï¼Œç¨³å®šæ€§ä¹Ÿå¥½ï¼Œå› æ­¤æˆ‘ä»¬è¯¾å ‚ä¸Šé€‰æ‹©RabbitMQæ¥å­¦ä¹ ã€‚</p><h1 id="2-RabbitMQ">2.RabbitMQ</h1><p>RabbitMQæ˜¯åŸºäºErlangè¯­è¨€å¼€å‘çš„å¼€æºæ¶ˆæ¯é€šä¿¡ä¸­é—´ä»¶ï¼Œå®˜ç½‘åœ°å€ï¼š</p><p><a href="https://www.rabbitmq.com/">https://www.rabbitmq.com/</a></p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±å­¦ä¹ å®ƒçš„åŸºæœ¬æ¦‚å¿µå’ŒåŸºç¡€ç”¨æ³•ã€‚</p><h2 id="2-1-å®‰è£…">2.1.å®‰è£…</h2><p>æˆ‘ä»¬åŒæ ·åŸºäºDockeræ¥å®‰è£…RabbitMQï¼Œä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤å³å¯ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">docker run \</span><br><span class="line"> -e RABBITMQ_DEFAULT_USER=itheima \</span><br><span class="line"> -e RABBITMQ_DEFAULT_PASS=123321 \</span><br><span class="line"> -v mq-plugins:/plugins \</span><br><span class="line"> --name mq \</span><br><span class="line"> --hostname mq \</span><br><span class="line"> -p 15672:15672 \</span><br><span class="line"> -p 5672:5672 \</span><br><span class="line"> --network hm-net\</span><br><span class="line"> -d \</span><br><span class="line"> rabbitmq:3.8-management</span><br></pre></td></tr></table></figure><p>å¦‚æœæ‹‰å–é•œåƒå›°éš¾çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨è¯¾å‰èµ„æ–™ç»™å¤§å®¶å‡†å¤‡çš„é•œåƒï¼Œåˆ©ç”¨docker loadå‘½ä»¤åŠ è½½ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/KWDWbLtlfodeGBxOs94c3JFdn9g.png" alt=""></p><p>å¯ä»¥çœ‹åˆ°åœ¨å®‰è£…å‘½ä»¤ä¸­æœ‰ä¸¤ä¸ªæ˜ å°„çš„ç«¯å£ï¼š</p><ul><li><p>15672ï¼šRabbitMQæä¾›çš„ç®¡ç†æ§åˆ¶å°çš„ç«¯å£</p></li><li><p>5672ï¼šRabbitMQçš„æ¶ˆæ¯å‘é€å¤„ç†æ¥å£</p></li></ul><p>å®‰è£…å®Œæˆåï¼Œæˆ‘ä»¬è®¿é—® http://192.168.150.101:15672å³å¯çœ‹åˆ°ç®¡ç†æ§åˆ¶å°ã€‚é¦–æ¬¡è®¿é—®éœ€è¦ç™»å½•ï¼Œé»˜è®¤çš„ç”¨æˆ·åå’Œå¯†ç åœ¨é…ç½®æ–‡ä»¶ä¸­å·²ç»æŒ‡å®šäº†ã€‚</p><p>ç™»å½•åå³å¯çœ‹åˆ°ç®¡ç†æ§åˆ¶å°æ€»è§ˆé¡µé¢ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/YNs9bu47Vo3o1gxnEw1cI9MxnUM.png" alt=""></p><p>RabbitMQå¯¹åº”çš„æ¶æ„å¦‚å›¾ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/HH6fbYlGsoySg1x34UBczqjZnSb.png" alt=""></p><p>å…¶ä¸­åŒ…å«å‡ ä¸ªæ¦‚å¿µï¼š</p><ul><li><p><strong><code>publisher</code></strong>ï¼šç”Ÿäº§è€…ï¼Œä¹Ÿå°±æ˜¯å‘é€æ¶ˆæ¯çš„ä¸€æ–¹</p></li><li><p><strong><code>consumer</code></strong>ï¼šæ¶ˆè´¹è€…ï¼Œä¹Ÿå°±æ˜¯æ¶ˆè´¹æ¶ˆæ¯çš„ä¸€æ–¹</p></li><li><p><strong><code>queue</code></strong>ï¼šé˜Ÿåˆ—ï¼Œå­˜å‚¨æ¶ˆæ¯ã€‚ç”Ÿäº§è€…æŠ•é€’çš„æ¶ˆæ¯ä¼šæš‚å­˜åœ¨æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œç­‰å¾…æ¶ˆè´¹è€…å¤„ç†</p></li><li><p><strong><code>exchange</code></strong>ï¼šäº¤æ¢æœºï¼Œè´Ÿè´£æ¶ˆæ¯è·¯ç”±ã€‚ç”Ÿäº§è€…å‘é€çš„æ¶ˆæ¯ç”±äº¤æ¢æœºå†³å®šæŠ•é€’åˆ°å“ªä¸ªé˜Ÿåˆ—ã€‚</p></li><li><p><strong><code>virtual host</code></strong>ï¼šè™šæ‹Ÿä¸»æœºï¼Œèµ·åˆ°æ•°æ®éš”ç¦»çš„ä½œç”¨ã€‚æ¯ä¸ªè™šæ‹Ÿä¸»æœºç›¸äº’ç‹¬ç«‹ï¼Œæœ‰å„è‡ªçš„exchangeã€queue</p></li></ul><p>ä¸Šè¿°è¿™äº›ä¸œè¥¿éƒ½å¯ä»¥åœ¨RabbitMQçš„ç®¡ç†æ§åˆ¶å°æ¥ç®¡ç†ï¼Œä¸‹ä¸€èŠ‚æˆ‘ä»¬å°±ä¸€èµ·æ¥å­¦ä¹ æ§åˆ¶å°çš„ä½¿ç”¨ã€‚</p><h2 id="2-2-æ”¶å‘æ¶ˆæ¯">2.2.æ”¶å‘æ¶ˆæ¯</h2><h3 id="2-2-1-äº¤æ¢æœº">2.2.1.äº¤æ¢æœº</h3><p>æˆ‘ä»¬æ‰“å¼€Exchangesé€‰é¡¹å¡ï¼Œå¯ä»¥çœ‹åˆ°å·²ç»å­˜åœ¨å¾ˆå¤šäº¤æ¢æœºï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/Dc0VbMHYwoBM1ZxLdRtcAJTZnGc.png" alt=""></p><p>æˆ‘ä»¬ç‚¹å‡»ä»»æ„äº¤æ¢æœºï¼Œå³å¯è¿›å…¥äº¤æ¢æœºè¯¦æƒ…é¡µé¢ã€‚ä»ç„¶ä¼šåˆ©ç”¨æ§åˆ¶å°ä¸­çš„publish message å‘é€ä¸€æ¡æ¶ˆæ¯ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/TMlKboOgZom7Y7xfJ9CccgPdnNh.png" alt=""></p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/BTUkbvuDVo29JDx9YURcYjhFnPc.png" alt=""></p><p>è¿™é‡Œæ˜¯ç”±æ§åˆ¶å°æ¨¡æ‹Ÿäº†ç”Ÿäº§è€…å‘é€çš„æ¶ˆæ¯ã€‚ç”±äºæ²¡æœ‰æ¶ˆè´¹è€…å­˜åœ¨ï¼Œæœ€ç»ˆæ¶ˆæ¯ä¸¢å¤±äº†ï¼Œè¿™æ ·è¯´æ˜äº¤æ¢æœºæ²¡æœ‰å­˜å‚¨æ¶ˆæ¯çš„èƒ½åŠ›ã€‚</p><h3 id="2-2-2-é˜Ÿåˆ—">2.2.2.é˜Ÿåˆ—</h3><p>æˆ‘ä»¬æ‰“å¼€<code>Queues</code>é€‰é¡¹å¡ï¼Œæ–°å»ºä¸€ä¸ªé˜Ÿåˆ—ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/GvVobsp7uoSxfox0c0gcU14dnSc.png" alt=""></p><p>å‘½åä¸º<code>hello.queue1</code>ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/Ew31bOIBoo18dRxIFubcJva0nXf.png" alt=""></p><p>å†ä»¥ç›¸åŒçš„æ–¹å¼ï¼Œåˆ›å»ºä¸€ä¸ªé˜Ÿåˆ—ï¼Œå¯†ç ä¸º<code>hello.queue2</code>ï¼Œæœ€ç»ˆé˜Ÿåˆ—åˆ—è¡¨å¦‚ä¸‹ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/SmOobtVzSou586xV1a9cF11tn5d.png" alt=""></p><p>æ­¤æ—¶ï¼Œæˆ‘ä»¬å†æ¬¡å‘<code>amq.fanout</code>äº¤æ¢æœºå‘é€ä¸€æ¡æ¶ˆæ¯ã€‚ä¼šå‘ç°æ¶ˆæ¯ä¾ç„¶æ²¡æœ‰åˆ°è¾¾é˜Ÿåˆ—ï¼ï¼</p><p>æ€ä¹ˆå›äº‹å‘¢ï¼Ÿ</p><p>å‘é€åˆ°äº¤æ¢æœºçš„æ¶ˆæ¯ï¼Œåªä¼šè·¯ç”±åˆ°ä¸å…¶ç»‘å®šçš„é˜Ÿåˆ—ï¼Œå› æ­¤ä»…ä»…åˆ›å»ºé˜Ÿåˆ—æ˜¯ä¸å¤Ÿçš„ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å°†å…¶ä¸äº¤æ¢æœºç»‘å®šã€‚</p><h3 id="2-2-3-ç»‘å®šå…³ç³»">2.2.3.ç»‘å®šå…³ç³»</h3><p>ç‚¹å‡»<code>Exchanges</code>é€‰é¡¹å¡ï¼Œç‚¹å‡»<code>amq.fanout</code>äº¤æ¢æœºï¼Œè¿›å…¥äº¤æ¢æœºè¯¦æƒ…é¡µï¼Œç„¶åç‚¹å‡»<code>Bindings</code>èœå•ï¼Œåœ¨è¡¨å•ä¸­å¡«å†™è¦ç»‘å®šçš„é˜Ÿåˆ—åç§°ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/HZ2fbpinhoLs4AxqzudcTrSdnWD.png" alt=""></p><p>ç›¸åŒçš„æ–¹å¼ï¼Œå°†hello.queue2ä¹Ÿç»‘å®šåˆ°æ”¹äº¤æ¢æœºã€‚</p><p>æœ€ç»ˆï¼Œç»‘å®šç»“æœå¦‚ä¸‹ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/WFcXbuLVzoa4NxxmZrycHEs8nwh.png" alt=""></p><h3 id="2-2-4-å‘é€æ¶ˆæ¯">2.2.4.å‘é€æ¶ˆæ¯</h3><p>å†æ¬¡å›åˆ°exchangeé¡µé¢ï¼Œæ‰¾åˆ°åˆšåˆšç»‘å®šçš„<code>amq.fanout</code>ï¼Œç‚¹å‡»è¿›å…¥è¯¦æƒ…é¡µï¼Œå†æ¬¡å‘é€ä¸€æ¡æ¶ˆæ¯ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/HzIWbJaR2oGiqwxypvocuQfYn0e.png" alt=""></p><p>å›åˆ°<code>Queues</code>é¡µé¢ï¼Œå¯ä»¥å‘ç°<code>hello.queue</code>ä¸­å·²ç»æœ‰ä¸€æ¡æ¶ˆæ¯äº†ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/ZROjbesEYoIkqcxLYM2cl3lcnZf.png" alt=""></p><p>ç‚¹å‡»é˜Ÿåˆ—åç§°ï¼Œè¿›å…¥è¯¦æƒ…é¡µï¼ŒæŸ¥çœ‹é˜Ÿåˆ—è¯¦æƒ…ï¼Œè¿™æ¬¡æˆ‘ä»¬ç‚¹å‡»get messageï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/XaPeboPQVovkH6xM453cTvqmnDe.png" alt=""></p><p>å¯ä»¥çœ‹åˆ°æ¶ˆæ¯åˆ°è¾¾é˜Ÿåˆ—äº†ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/BR8mbRZOkohqUAxbOUncGdZ1nde.png" alt=""></p><p>è¿™ä¸ªæ—¶å€™å¦‚æœæœ‰æ¶ˆè´¹è€…ç›‘å¬äº†MQçš„<code>hello.queue1</code>æˆ–<code>hello.queue2</code>é˜Ÿåˆ—ï¼Œè‡ªç„¶å°±èƒ½æ¥æ”¶åˆ°æ¶ˆæ¯äº†ã€‚</p><h2 id="2-3-æ•°æ®éš”ç¦»">2.3.æ•°æ®éš”ç¦»</h2><h3 id="2-3-1-ç”¨æˆ·ç®¡ç†">2.3.1.ç”¨æˆ·ç®¡ç†</h3><p>ç‚¹å‡»<code>Admin</code>é€‰é¡¹å¡ï¼Œé¦–å…ˆä¼šçœ‹åˆ°RabbitMQæ§åˆ¶å°çš„ç”¨æˆ·ç®¡ç†ç•Œé¢ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/P27GbS0zAoWnPgx7LCQcFMlonBf.png" alt=""></p><p>è¿™é‡Œçš„ç”¨æˆ·éƒ½æ˜¯RabbitMQçš„ç®¡ç†æˆ–è¿ç»´äººå‘˜ã€‚ç›®å‰åªæœ‰å®‰è£…RabbitMQæ—¶æ·»åŠ çš„<code>itheima</code>è¿™ä¸ªç”¨æˆ·ã€‚ä»”ç»†è§‚å¯Ÿç”¨æˆ·è¡¨æ ¼ä¸­çš„å­—æ®µï¼Œå¦‚ä¸‹ï¼š</p><ul><li><p><code>Name</code>ï¼š<code>itheima</code>ï¼Œä¹Ÿå°±æ˜¯ç”¨æˆ·å</p></li><li><p><code>Tags</code>ï¼š<code>administrator</code>ï¼Œè¯´æ˜<code>itheima</code>ç”¨æˆ·æ˜¯è¶…çº§ç®¡ç†å‘˜ï¼Œæ‹¥æœ‰æ‰€æœ‰æƒé™</p></li><li><p><code>Can access virtual host</code>ï¼š <code>/</code>ï¼Œå¯ä»¥è®¿é—®çš„<code>virtual host</code>ï¼Œè¿™é‡Œçš„<code>/</code>æ˜¯é»˜è®¤çš„<code>virtual host</code></p></li></ul><p>å¯¹äºå°å‹ä¼ä¸šè€Œè¨€ï¼Œå‡ºäºæˆæœ¬è€ƒè™‘ï¼Œæˆ‘ä»¬é€šå¸¸åªä¼šæ­å»ºä¸€å¥—MQé›†ç¾¤ï¼Œå…¬å¸å†…çš„å¤šä¸ªä¸åŒé¡¹ç›®åŒæ—¶ä½¿ç”¨ã€‚è¿™ä¸ªæ—¶å€™ä¸ºäº†é¿å…äº’ç›¸å¹²æ‰°ï¼Œ æˆ‘ä»¬ä¼šåˆ©ç”¨<code>virtual host</code>çš„éš”ç¦»ç‰¹æ€§ï¼Œå°†ä¸åŒé¡¹ç›®éš”ç¦»ã€‚ä¸€èˆ¬ä¼šåšä¸¤ä»¶äº‹æƒ…ï¼š</p><ul><li><p>ç»™æ¯ä¸ªé¡¹ç›®åˆ›å»ºç‹¬ç«‹çš„è¿ç»´è´¦å·ï¼Œå°†ç®¡ç†æƒé™åˆ†ç¦»ã€‚</p></li><li><p>ç»™æ¯ä¸ªé¡¹ç›®åˆ›å»ºä¸åŒçš„<code>virtual host</code>ï¼Œå°†æ¯ä¸ªé¡¹ç›®çš„æ•°æ®éš”ç¦»ã€‚</p></li></ul><p>æ¯”å¦‚ï¼Œæˆ‘ä»¬ç»™é»‘é©¬å•†åŸåˆ›å»ºä¸€ä¸ªæ–°çš„ç”¨æˆ·ï¼Œå‘½åä¸º<code>hmall</code>ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/TbVRbsJaKoL3VSxFGVWcbfV0nbd.png" alt=""></p><p>ä½ ä¼šå‘ç°æ­¤æ—¶hmallç”¨æˆ·æ²¡æœ‰ä»»ä½•<code>virtual host</code>çš„è®¿é—®æƒé™ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/YCq6beky1oiD5yxR3klctQh3nCf.png" alt=""></p><p>åˆ«æ€¥ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±æ¥æˆæƒã€‚</p><h3 id="2-3-2-virtual-host">2.3.2.virtual host</h3><p>æˆ‘ä»¬å…ˆé€€å‡ºç™»å½•ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/Nf5AbO0mKo7RTixOUrUcdfWRn9e.png" alt=""></p><p>åˆ‡æ¢åˆ°åˆšåˆšåˆ›å»ºçš„hmallç”¨æˆ·ç™»å½•ï¼Œç„¶åç‚¹å‡»<code>Virtual Hosts</code>èœå•ï¼Œè¿›å…¥<code>virtual host</code>ç®¡ç†é¡µï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/NWSObodw1oiLcHxYW1TcD4rBn4b.png" alt=""></p><p>å¯ä»¥çœ‹åˆ°ç›®å‰åªæœ‰ä¸€ä¸ªé»˜è®¤çš„<code>virtual host</code>ï¼Œåå­—ä¸º <code>/</code>ã€‚</p><p> æˆ‘ä»¬å¯ä»¥ç»™é»‘é©¬å•†åŸé¡¹ç›®åˆ›å»ºä¸€ä¸ªå•ç‹¬çš„<code>virtual host</code>ï¼Œè€Œä¸æ˜¯ä½¿ç”¨é»˜è®¤çš„<code>/</code>ã€‚</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/GJwSbnpcEolw3cxtLU1cNzTcncc.png" alt=""></p><p>åˆ›å»ºå®Œæˆåå¦‚å›¾ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/BC6EbcBTKoaE3cxoJDWc9sTmnkc.png" alt=""></p><p>ç”±äºæˆ‘ä»¬æ˜¯ç™»å½•<code>hmall</code>è´¦æˆ·ååˆ›å»ºçš„<code>virtual host</code>ï¼Œå› æ­¤å›åˆ°<code>users</code>èœå•ï¼Œä½ ä¼šå‘ç°å½“å‰ç”¨æˆ·å·²ç»å…·å¤‡äº†å¯¹<code>/hmall</code>è¿™ä¸ª<code>virtual host</code>çš„è®¿é—®æƒé™äº†ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/Gl4QbT3buoVEo9xTnK3cXkqAnbG.png" alt=""></p><p>æ­¤æ—¶ï¼Œç‚¹å‡»é¡µé¢å³ä¸Šè§’çš„<code>virtual host</code>ä¸‹æ‹‰èœå•ï¼Œåˆ‡æ¢<code>virtual host</code>ä¸º <code>/hmall</code>ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/EOg4br4TooRmRpxCF9fcfhtkn6g.png" alt=""></p><p>ç„¶åå†æ¬¡æŸ¥çœ‹queuesé€‰é¡¹å¡ï¼Œä¼šå‘ç°ä¹‹å‰çš„é˜Ÿåˆ—å·²ç»çœ‹ä¸åˆ°äº†ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/Xs2hbPZzTojKP0xNWpkcBZuin0g.png" alt=""></p><p>è¿™å°±æ˜¯åŸºäº<code>virtual host </code>çš„éš”ç¦»æ•ˆæœã€‚</p><h1 id="3-SpringAMQP">3.SpringAMQP</h1><p>å°†æ¥æˆ‘ä»¬å¼€å‘ä¸šåŠ¡åŠŸèƒ½çš„æ—¶å€™ï¼Œè‚¯å®šä¸ä¼šåœ¨æ§åˆ¶å°æ”¶å‘æ¶ˆæ¯ï¼Œè€Œæ˜¯åº”è¯¥åŸºäºç¼–ç¨‹çš„æ–¹å¼ã€‚ç”±äº<code>RabbitMQ</code>é‡‡ç”¨äº†AMQPåè®®ï¼Œå› æ­¤å®ƒå…·å¤‡è·¨è¯­è¨€çš„ç‰¹æ€§ã€‚ä»»ä½•è¯­è¨€åªè¦éµå¾ªAMQPåè®®æ”¶å‘æ¶ˆæ¯ï¼Œéƒ½å¯ä»¥ä¸<code>RabbitMQ</code>äº¤äº’ã€‚å¹¶ä¸”<code>RabbitMQ</code>å®˜æ–¹ä¹Ÿæä¾›äº†å„ç§ä¸åŒè¯­è¨€çš„å®¢æˆ·ç«¯ã€‚</p><p>ä½†æ˜¯ï¼ŒRabbitMQå®˜æ–¹æä¾›çš„Javaå®¢æˆ·ç«¯ç¼–ç ç›¸å¯¹å¤æ‚ï¼Œä¸€èˆ¬ç”Ÿäº§ç¯å¢ƒä¸‹æˆ‘ä»¬æ›´å¤šä¼šç»“åˆSpringæ¥ä½¿ç”¨ã€‚è€ŒSpringçš„å®˜æ–¹åˆšå¥½åŸºäºRabbitMQæä¾›äº†è¿™æ ·ä¸€å¥—æ¶ˆæ¯æ”¶å‘çš„æ¨¡æ¿å·¥å…·ï¼šSpringAMQPã€‚å¹¶ä¸”è¿˜åŸºäºSpringBootå¯¹å…¶å®ç°äº†è‡ªåŠ¨è£…é…ï¼Œä½¿ç”¨èµ·æ¥éå¸¸æ–¹ä¾¿ã€‚</p><p>SpringAmqpçš„å®˜æ–¹åœ°å€ï¼š</p><p>SpringAMQPæä¾›äº†ä¸‰ä¸ªåŠŸèƒ½ï¼š</p><ul><li><p>è‡ªåŠ¨å£°æ˜é˜Ÿåˆ—ã€äº¤æ¢æœºåŠå…¶ç»‘å®šå…³ç³»</p></li><li><p>åŸºäºæ³¨è§£çš„ç›‘å¬å™¨æ¨¡å¼ï¼Œå¼‚æ­¥æ¥æ”¶æ¶ˆæ¯</p></li><li><p>å°è£…äº†RabbitTemplateå·¥å…·ï¼Œç”¨äºå‘é€æ¶ˆæ¯</p></li></ul><p>è¿™ä¸€ç« æˆ‘ä»¬å°±ä¸€èµ·å­¦ä¹ ä¸€ä¸‹ï¼Œå¦‚ä½•åˆ©ç”¨SpringAMQPå®ç°å¯¹RabbitMQçš„æ¶ˆæ¯æ”¶å‘ã€‚</p><h2 id="3-1-å¯¼å…¥Demoå·¥ç¨‹">3.1.å¯¼å…¥Demoå·¥ç¨‹</h2><p>åœ¨è¯¾å‰èµ„æ–™ç»™å¤§å®¶æä¾›äº†ä¸€ä¸ªDemoå·¥ç¨‹ï¼Œæ–¹ä¾¿æˆ‘ä»¬å­¦ä¹ SpringAMQPçš„ä½¿ç”¨ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/NTJubEDiVovAn5xS4SScLUUjn4u-175603011395640.png" alt=""></p><p>å°†å…¶å¤åˆ¶åˆ°ä½ çš„å·¥ä½œç©ºé—´ï¼Œç„¶åç”¨Ideaæ‰“å¼€ï¼Œé¡¹ç›®ç»“æ„å¦‚å›¾ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/TWK8bTyJmoRYi2xTzy1cBTGgnyh-175603011395641.png" alt=""></p><p>åŒ…æ‹¬ä¸‰éƒ¨åˆ†ï¼š</p><ul><li><p>mq-demoï¼šçˆ¶å·¥ç¨‹ï¼Œç®¡ç†é¡¹ç›®ä¾èµ–</p></li><li><p>publisherï¼šæ¶ˆæ¯çš„å‘é€è€…</p></li><li><p>consumerï¼šæ¶ˆæ¯çš„æ¶ˆè´¹è€…</p></li></ul><p>åœ¨mq-demoè¿™ä¸ªçˆ¶å·¥ç¨‹ä¸­ï¼Œå·²ç»é…ç½®å¥½äº†SpringAMQPç›¸å…³çš„ä¾èµ–ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.itcast.demo<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mq-demo<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modules</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>publisher<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>consumer<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">modules</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.7.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--AMQPä¾èµ–ï¼ŒåŒ…å«RabbitMQ--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-amqp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--å•å…ƒæµ‹è¯•--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å› æ­¤ï¼Œå­å·¥ç¨‹ä¸­å°±å¯ä»¥ç›´æ¥ä½¿ç”¨SpringAMQPäº†ã€‚</p><h2 id="3-2-å¿«é€Ÿå…¥é—¨">3.2.å¿«é€Ÿå…¥é—¨</h2><p>åœ¨ä¹‹å‰çš„æ¡ˆä¾‹ä¸­ï¼Œæˆ‘ä»¬éƒ½æ˜¯ç»è¿‡äº¤æ¢æœºå‘é€æ¶ˆæ¯åˆ°é˜Ÿåˆ—ï¼Œä¸è¿‡æœ‰æ—¶å€™ä¸ºäº†æµ‹è¯•æ–¹ä¾¿ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç›´æ¥å‘é˜Ÿåˆ—å‘é€æ¶ˆæ¯ï¼Œè·³è¿‡äº¤æ¢æœºã€‚</p><p>åœ¨å…¥é—¨æ¡ˆä¾‹ä¸­ï¼Œæˆ‘ä»¬å°±æ¼”ç¤ºè¿™æ ·çš„ç®€å•æ¨¡å‹ï¼Œå¦‚å›¾ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/diagram-6-175603011395642.png" alt=""></p><p>ä¹Ÿå°±æ˜¯ï¼š</p><ul><li><p>publisherç›´æ¥å‘é€æ¶ˆæ¯åˆ°é˜Ÿåˆ—</p></li><li><p>æ¶ˆè´¹è€…ç›‘å¬å¹¶å¤„ç†é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯</p></li></ul><blockquote><p><strong>æ³¨æ„</strong>ï¼šè¿™ç§æ¨¡å¼ä¸€èˆ¬æµ‹è¯•ä½¿ç”¨ï¼Œå¾ˆå°‘åœ¨ç”Ÿäº§ä¸­ä½¿ç”¨ã€‚</p></blockquote><p>ä¸ºäº†æ–¹ä¾¿æµ‹è¯•ï¼Œæˆ‘ä»¬ç°åœ¨æ§åˆ¶å°æ–°å»ºä¸€ä¸ªé˜Ÿåˆ—ï¼šsimple.queue</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/Pcxnbpl73o8QGwxN30ickh1Gn8f-175603011395643.png" alt=""></p><p>æ·»åŠ æˆåŠŸï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/IUojbN003ocDoyxs4EUc9sopnFP-175603011395644.png" alt=""></p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨Javaä»£ç æ”¶å‘æ¶ˆæ¯äº†ã€‚</p><h3 id="3-2-1-æ¶ˆæ¯å‘é€">3.2.1.æ¶ˆæ¯å‘é€</h3><p>é¦–å…ˆé…ç½®MQåœ°å€ï¼Œåœ¨<code>publisher</code>æœåŠ¡çš„<code>application.yml</code>ä¸­æ·»åŠ é…ç½®ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">rabbitmq:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="number">192.168</span><span class="number">.150</span><span class="number">.101</span> <span class="comment"># ä½ çš„è™šæ‹ŸæœºIP</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">5672</span> <span class="comment"># ç«¯å£</span></span><br><span class="line">    <span class="attr">virtual-host:</span> <span class="string">/hmall</span> <span class="comment"># è™šæ‹Ÿä¸»æœº</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">hmall</span> <span class="comment"># ç”¨æˆ·å</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123</span> <span class="comment"># å¯†ç </span></span><br></pre></td></tr></table></figure><p>ç„¶ååœ¨<code>publisher</code>æœåŠ¡ä¸­ç¼–å†™æµ‹è¯•ç±»<code>SpringAmqpTest</code>ï¼Œå¹¶åˆ©ç”¨<code>RabbitTemplate</code>å®ç°æ¶ˆæ¯å‘é€ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.publisher.amqp;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.rabbit.core.RabbitTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringAmqpTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RabbitTemplate rabbitTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSimpleQueue</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// é˜Ÿåˆ—åç§°</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">queueName</span> <span class="operator">=</span> <span class="string">&quot;simple.queue&quot;</span>;</span><br><span class="line">        <span class="comment">// æ¶ˆæ¯</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">&quot;hello, spring amqp!&quot;</span>;</span><br><span class="line">        <span class="comment">// å‘é€æ¶ˆæ¯</span></span><br><span class="line">        rabbitTemplate.convertAndSend(queueName, message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰“å¼€æ§åˆ¶å°ï¼Œå¯ä»¥çœ‹åˆ°æ¶ˆæ¯å·²ç»å‘é€åˆ°é˜Ÿåˆ—ä¸­ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/N8Nsbeatqo5bGUx7OWJc4M1Anke-175603011395647.png" alt=""></p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å†æ¥å®ç°æ¶ˆæ¯æ¥æ”¶ã€‚</p><h3 id="3-2-2-æ¶ˆæ¯æ¥æ”¶">3.2.2.æ¶ˆæ¯æ¥æ”¶</h3><p>é¦–å…ˆé…ç½®MQåœ°å€ï¼Œåœ¨<code>consumer</code>æœåŠ¡çš„<code>application.yml</code>ä¸­æ·»åŠ é…ç½®ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">rabbitmq:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="number">192.168</span><span class="number">.150</span><span class="number">.101</span> <span class="comment"># ä½ çš„è™šæ‹ŸæœºIP</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">5672</span> <span class="comment"># ç«¯å£</span></span><br><span class="line">    <span class="attr">virtual-host:</span> <span class="string">/hmall</span> <span class="comment"># è™šæ‹Ÿä¸»æœº</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">hmall</span> <span class="comment"># ç”¨æˆ·å</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123</span> <span class="comment"># å¯†ç </span></span><br></pre></td></tr></table></figure><p>ç„¶ååœ¨<code>consumer</code>æœåŠ¡çš„<code>com.itheima.consumer.listener</code>åŒ…ä¸­æ–°å»ºä¸€ä¸ªç±»<code>SpringRabbitListener</code>ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.consumer.listener;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.rabbit.annotation.RabbitListener;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringRabbitListener</span> &#123;</span><br><span class="line">        <span class="comment">// åˆ©ç”¨RabbitListeneræ¥å£°æ˜è¦ç›‘å¬çš„é˜Ÿåˆ—ä¿¡æ¯</span></span><br><span class="line">    <span class="comment">// å°†æ¥ä¸€æ—¦ç›‘å¬çš„é˜Ÿåˆ—ä¸­æœ‰äº†æ¶ˆæ¯ï¼Œå°±ä¼šæ¨é€ç»™å½“å‰æœåŠ¡ï¼Œè°ƒç”¨å½“å‰æ–¹æ³•ï¼Œå¤„ç†æ¶ˆæ¯ã€‚</span></span><br><span class="line">    <span class="comment">// å¯ä»¥çœ‹åˆ°æ–¹æ³•ä½“ä¸­æ¥æ”¶çš„å°±æ˜¯æ¶ˆæ¯ä½“çš„å†…å®¹</span></span><br><span class="line">    <span class="meta">@RabbitListener(queues = &quot;simple.queue&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenSimpleQueueMessage</span><span class="params">(String msg)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;spring æ¶ˆè´¹è€…æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€&quot;</span> + msg + <span class="string">&quot;ã€‘&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-2-3-æµ‹è¯•">3.2.3.æµ‹è¯•</h3><p>å¯åŠ¨consumeræœåŠ¡ï¼Œç„¶ååœ¨publisheræœåŠ¡ä¸­è¿è¡Œæµ‹è¯•ä»£ç ï¼Œå‘é€MQæ¶ˆæ¯ã€‚æœ€ç»ˆconsumeræ”¶åˆ°æ¶ˆæ¯ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/Vbf6b35dyoJb2HxdS8Nc7GI1nOf-175603011395646.png" alt=""></p><h2 id="3-3-WorkQueuesæ¨¡å‹">3.3.WorkQueuesæ¨¡å‹</h2><p>Work queuesï¼Œä»»åŠ¡æ¨¡å‹ã€‚ç®€å•æ¥è¯´å°±æ˜¯<strong>è®©å¤šä¸ªæ¶ˆè´¹è€…ç»‘å®šåˆ°ä¸€ä¸ªé˜Ÿåˆ—ï¼Œå…±åŒæ¶ˆè´¹é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯</strong>ã€‚</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/diagram-7-175603011395645.png" alt=""></p><p>å½“æ¶ˆæ¯å¤„ç†æ¯”è¾ƒè€—æ—¶çš„æ—¶å€™ï¼Œå¯èƒ½ç”Ÿäº§æ¶ˆæ¯çš„é€Ÿåº¦ä¼šè¿œè¿œå¤§äºæ¶ˆæ¯çš„æ¶ˆè´¹é€Ÿåº¦ã€‚é•¿æ­¤ä»¥å¾€ï¼Œæ¶ˆæ¯å°±ä¼šå †ç§¯è¶Šæ¥è¶Šå¤šï¼Œæ— æ³•åŠæ—¶å¤„ç†ã€‚</p><p>æ­¤æ—¶å°±å¯ä»¥ä½¿ç”¨work æ¨¡å‹ï¼Œ<strong>å¤šä¸ªæ¶ˆè´¹è€…å…±åŒå¤„ç†æ¶ˆæ¯å¤„ç†ï¼Œæ¶ˆæ¯å¤„ç†çš„é€Ÿåº¦å°±èƒ½å¤§å¤§æé«˜</strong>äº†ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±æ¥æ¨¡æ‹Ÿè¿™æ ·çš„åœºæ™¯ã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬åœ¨æ§åˆ¶å°åˆ›å»ºä¸€ä¸ªæ–°çš„é˜Ÿåˆ—ï¼Œå‘½åä¸º<code>work.queue</code>ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/HzN7btEXko5VcSxTLx7ca8egnhu-175603011395649.png" alt=""></p><h3 id="3-3-1-æ¶ˆæ¯å‘é€">3.3.1.æ¶ˆæ¯å‘é€</h3><p>è¿™æ¬¡æˆ‘ä»¬å¾ªç¯å‘é€ï¼Œæ¨¡æ‹Ÿå¤§é‡æ¶ˆæ¯å †ç§¯ç°è±¡ã€‚</p><p>åœ¨publisheræœåŠ¡ä¸­çš„SpringAmqpTestç±»ä¸­æ·»åŠ ä¸€ä¸ªæµ‹è¯•æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * workQueue</span></span><br><span class="line"><span class="comment">     * å‘é˜Ÿåˆ—ä¸­ä¸åœå‘é€æ¶ˆæ¯ï¼Œæ¨¡æ‹Ÿæ¶ˆæ¯å †ç§¯ã€‚</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testWorkQueue</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    <span class="comment">// é˜Ÿåˆ—åç§°</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">queueName</span> <span class="operator">=</span> <span class="string">&quot;simple.queue&quot;</span>;</span><br><span class="line">    <span class="comment">// æ¶ˆæ¯</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">&quot;hello, message_&quot;</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">50</span>; i++) &#123;</span><br><span class="line">        <span class="comment">// å‘é€æ¶ˆæ¯ï¼Œæ¯20æ¯«ç§’å‘é€ä¸€æ¬¡ï¼Œç›¸å½“äºæ¯ç§’å‘é€50æ¡æ¶ˆæ¯</span></span><br><span class="line">        rabbitTemplate.convertAndSend(queueName, message + i);</span><br><span class="line">        Thread.sleep(<span class="number">20</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-3-2-æ¶ˆæ¯æ¥æ”¶">3.3.2.æ¶ˆæ¯æ¥æ”¶</h3><p>è¦æ¨¡æ‹Ÿå¤šä¸ªæ¶ˆè´¹è€…ç»‘å®šåŒä¸€ä¸ªé˜Ÿåˆ—ï¼Œæˆ‘ä»¬åœ¨consumeræœåŠ¡çš„SpringRabbitListenerä¸­æ·»åŠ 2ä¸ªæ–°çš„æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RabbitListener(queues = &quot;work.queue&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenWorkQueue1</span><span class="params">(String msg)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;æ¶ˆè´¹è€…1æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€&quot;</span> + msg + <span class="string">&quot;ã€‘&quot;</span> + LocalTime.now());</span><br><span class="line">    Thread.sleep(<span class="number">20</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RabbitListener(queues = &quot;work.queue&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenWorkQueue2</span><span class="params">(String msg)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    System.err.println(<span class="string">&quot;æ¶ˆè´¹è€…2........æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€&quot;</span> + msg + <span class="string">&quot;ã€‘&quot;</span> + LocalTime.now());</span><br><span class="line">    Thread.sleep(<span class="number">200</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„åˆ°è¿™ä¸¤æ¶ˆè´¹è€…ï¼Œéƒ½è®¾ç½®äº†<code>Thead.sleep</code>ï¼Œæ¨¡æ‹Ÿä»»åŠ¡è€—æ—¶ï¼š</p><ul><li><p>æ¶ˆè´¹è€…1 sleepäº†20æ¯«ç§’ï¼Œç›¸å½“äºæ¯ç§’é’Ÿå¤„ç†50ä¸ªæ¶ˆæ¯</p></li><li><p>æ¶ˆè´¹è€…2 sleepäº†200æ¯«ç§’ï¼Œç›¸å½“äºæ¯ç§’å¤„ç†5ä¸ªæ¶ˆæ¯</p></li></ul><h3 id="3-3-3-æµ‹è¯•">3.3.3.æµ‹è¯•</h3><p>å¯åŠ¨ConsumerApplicationåï¼Œåœ¨æ‰§è¡ŒpublisheræœåŠ¡ä¸­åˆšåˆšç¼–å†™çš„å‘é€æµ‹è¯•æ–¹æ³•testWorkQueueã€‚</p><p>æœ€ç»ˆç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_0ã€‘<span class="number">21</span>:<span class="number">06</span>:<span class="number">00.869555300</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">2.</span>.......æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_1ã€‘<span class="number">21</span>:<span class="number">06</span>:<span class="number">00.884518</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_2ã€‘<span class="number">21</span>:<span class="number">06</span>:<span class="number">00.907454400</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_4ã€‘<span class="number">21</span>:<span class="number">06</span>:<span class="number">00.953332100</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_6ã€‘<span class="number">21</span>:<span class="number">06</span>:<span class="number">00.997867300</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_8ã€‘<span class="number">21</span>:<span class="number">06</span>:<span class="number">01.042178700</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">2.</span>.......æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_3ã€‘<span class="number">21</span>:<span class="number">06</span>:<span class="number">01.086478800</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_10ã€‘<span class="number">21</span>:<span class="number">06</span>:<span class="number">01.087476600</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_12ã€‘<span class="number">21</span>:<span class="number">06</span>:<span class="number">01.132578300</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_14ã€‘<span class="number">21</span>:<span class="number">06</span>:<span class="number">01.175851200</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_16ã€‘<span class="number">21</span>:<span class="number">06</span>:<span class="number">01.218533400</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_18ã€‘<span class="number">21</span>:<span class="number">06</span>:<span class="number">01.261322900</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">2.</span>.......æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_5ã€‘<span class="number">21</span>:<span class="number">06</span>:<span class="number">01.287003700</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_20ã€‘<span class="number">21</span>:<span class="number">06</span>:<span class="number">01.304412400</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_22ã€‘<span class="number">21</span>:<span class="number">06</span>:<span class="number">01.349950100</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_24ã€‘<span class="number">21</span>:<span class="number">06</span>:<span class="number">01.394533900</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_26ã€‘<span class="number">21</span>:<span class="number">06</span>:<span class="number">01.439876500</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_28ã€‘<span class="number">21</span>:<span class="number">06</span>:<span class="number">01.482937800</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">2.</span>.......æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_7ã€‘<span class="number">21</span>:<span class="number">06</span>:<span class="number">01.488977100</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_30ã€‘<span class="number">21</span>:<span class="number">06</span>:<span class="number">01.526409300</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_32ã€‘<span class="number">21</span>:<span class="number">06</span>:<span class="number">01.572148</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_34ã€‘<span class="number">21</span>:<span class="number">06</span>:<span class="number">01.618264800</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_36ã€‘<span class="number">21</span>:<span class="number">06</span>:<span class="number">01.660780600</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">2.</span>.......æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_9ã€‘<span class="number">21</span>:<span class="number">06</span>:<span class="number">01.689189300</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_38ã€‘<span class="number">21</span>:<span class="number">06</span>:<span class="number">01.705261</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_40ã€‘<span class="number">21</span>:<span class="number">06</span>:<span class="number">01.746927300</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_42ã€‘<span class="number">21</span>:<span class="number">06</span>:<span class="number">01.789835</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_44ã€‘<span class="number">21</span>:<span class="number">06</span>:<span class="number">01.834393100</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_46ã€‘<span class="number">21</span>:<span class="number">06</span>:<span class="number">01.875312100</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">2.</span>.......æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_11ã€‘<span class="number">21</span>:<span class="number">06</span>:<span class="number">01.889969500</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_48ã€‘<span class="number">21</span>:<span class="number">06</span>:<span class="number">01.920702500</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">2.</span>.......æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_13ã€‘<span class="number">21</span>:<span class="number">06</span>:<span class="number">02.090725900</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">2.</span>.......æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_15ã€‘<span class="number">21</span>:<span class="number">06</span>:<span class="number">02.293060600</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">2.</span>.......æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_17ã€‘<span class="number">21</span>:<span class="number">06</span>:<span class="number">02.493748</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">2.</span>.......æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_19ã€‘<span class="number">21</span>:<span class="number">06</span>:<span class="number">02.696635100</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">2.</span>.......æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_21ã€‘<span class="number">21</span>:<span class="number">06</span>:<span class="number">02.896809700</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">2.</span>.......æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_23ã€‘<span class="number">21</span>:<span class="number">06</span>:<span class="number">03.099533400</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">2.</span>.......æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_25ã€‘<span class="number">21</span>:<span class="number">06</span>:<span class="number">03.301446400</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">2.</span>.......æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_27ã€‘<span class="number">21</span>:<span class="number">06</span>:<span class="number">03.504999100</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">2.</span>.......æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_29ã€‘<span class="number">21</span>:<span class="number">06</span>:<span class="number">03.705702500</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">2.</span>.......æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_31ã€‘<span class="number">21</span>:<span class="number">06</span>:<span class="number">03.906601200</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">2.</span>.......æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_33ã€‘<span class="number">21</span>:<span class="number">06</span>:<span class="number">04.108118500</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">2.</span>.......æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_35ã€‘<span class="number">21</span>:<span class="number">06</span>:<span class="number">04.308945400</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">2.</span>.......æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_37ã€‘<span class="number">21</span>:<span class="number">06</span>:<span class="number">04.511547700</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">2.</span>.......æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_39ã€‘<span class="number">21</span>:<span class="number">06</span>:<span class="number">04.714038400</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">2.</span>.......æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_41ã€‘<span class="number">21</span>:<span class="number">06</span>:<span class="number">04.916192700</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">2.</span>.......æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_43ã€‘<span class="number">21</span>:<span class="number">06</span>:<span class="number">05.116286400</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">2.</span>.......æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_45ã€‘<span class="number">21</span>:<span class="number">06</span>:<span class="number">05.318055100</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">2.</span>.......æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_47ã€‘<span class="number">21</span>:<span class="number">06</span>:<span class="number">05.520656400</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">2.</span>.......æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_49ã€‘<span class="number">21</span>:<span class="number">06</span>:<span class="number">05.723106700</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°æ¶ˆè´¹è€…1å’Œæ¶ˆè´¹è€…2ç«Ÿç„¶æ¯äººæ¶ˆè´¹äº†25æ¡æ¶ˆæ¯ï¼š</p><ul><li><p>æ¶ˆè´¹è€…1å¾ˆå¿«å®Œæˆäº†è‡ªå·±çš„25æ¡æ¶ˆæ¯</p></li><li><p>æ¶ˆè´¹è€…2å´åœ¨ç¼“æ…¢çš„å¤„ç†è‡ªå·±çš„25æ¡æ¶ˆæ¯ã€‚</p></li></ul><p>ä¹Ÿå°±æ˜¯è¯´æ¶ˆæ¯æ˜¯å¹³å‡åˆ†é…ç»™æ¯ä¸ªæ¶ˆè´¹è€…ï¼Œå¹¶æ²¡æœ‰è€ƒè™‘åˆ°æ¶ˆè´¹è€…çš„å¤„ç†èƒ½åŠ›ã€‚å¯¼è‡´1ä¸ªæ¶ˆè´¹è€…ç©ºé—²ï¼Œå¦ä¸€ä¸ªæ¶ˆè´¹è€…å¿™çš„ä¸å¯å¼€äº¤ã€‚æ²¡æœ‰å……åˆ†åˆ©ç”¨æ¯ä¸€ä¸ªæ¶ˆè´¹è€…çš„èƒ½åŠ›ï¼Œæœ€ç»ˆæ¶ˆæ¯å¤„ç†çš„è€—æ—¶è¿œè¿œè¶…è¿‡äº†1ç§’ã€‚è¿™æ ·æ˜¾ç„¶æ˜¯æœ‰é—®é¢˜çš„ã€‚</p><h3 id="3-3-4-èƒ½è€…å¤šåŠ³">3.3.4.èƒ½è€…å¤šåŠ³</h3><p>åœ¨springä¸­æœ‰ä¸€ä¸ªç®€å•çš„é…ç½®ï¼Œå¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚æˆ‘ä»¬ä¿®æ”¹consumeræœåŠ¡çš„application.ymlæ–‡ä»¶ï¼Œæ·»åŠ é…ç½®ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">rabbitmq:</span></span><br><span class="line">    <span class="attr">listener:</span></span><br><span class="line">      <span class="attr">simple:</span></span><br><span class="line">        <span class="attr">prefetch:</span> <span class="number">1</span> <span class="comment"># æ¯æ¬¡åªèƒ½è·å–ä¸€æ¡æ¶ˆæ¯ï¼Œå¤„ç†å®Œæˆæ‰èƒ½è·å–ä¸‹ä¸€ä¸ªæ¶ˆæ¯</span></span><br></pre></td></tr></table></figure><p>å†æ¬¡æµ‹è¯•ï¼Œå‘ç°ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_0ã€‘<span class="number">21</span>:<span class="number">12</span>:<span class="number">51.659664200</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">2.</span>.......æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_1ã€‘<span class="number">21</span>:<span class="number">12</span>:<span class="number">51.680610</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_2ã€‘<span class="number">21</span>:<span class="number">12</span>:<span class="number">51.703625</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_3ã€‘<span class="number">21</span>:<span class="number">12</span>:<span class="number">51.724330100</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_4ã€‘<span class="number">21</span>:<span class="number">12</span>:<span class="number">51.746651100</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_5ã€‘<span class="number">21</span>:<span class="number">12</span>:<span class="number">51.768401400</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_6ã€‘<span class="number">21</span>:<span class="number">12</span>:<span class="number">51.790511400</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_7ã€‘<span class="number">21</span>:<span class="number">12</span>:<span class="number">51.812559800</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_8ã€‘<span class="number">21</span>:<span class="number">12</span>:<span class="number">51.834500600</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_9ã€‘<span class="number">21</span>:<span class="number">12</span>:<span class="number">51.857438800</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_10ã€‘<span class="number">21</span>:<span class="number">12</span>:<span class="number">51.880379600</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">2.</span>.......æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_11ã€‘<span class="number">21</span>:<span class="number">12</span>:<span class="number">51.899327100</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_12ã€‘<span class="number">21</span>:<span class="number">12</span>:<span class="number">51.922828400</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_13ã€‘<span class="number">21</span>:<span class="number">12</span>:<span class="number">51.945617400</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_14ã€‘<span class="number">21</span>:<span class="number">12</span>:<span class="number">51.968942500</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_15ã€‘<span class="number">21</span>:<span class="number">12</span>:<span class="number">51.992215400</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_16ã€‘<span class="number">21</span>:<span class="number">12</span>:<span class="number">52.013325600</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_17ã€‘<span class="number">21</span>:<span class="number">12</span>:<span class="number">52.035687100</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_18ã€‘<span class="number">21</span>:<span class="number">12</span>:<span class="number">52.058188</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_19ã€‘<span class="number">21</span>:<span class="number">12</span>:<span class="number">52.081208400</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">2.</span>.......æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_20ã€‘<span class="number">21</span>:<span class="number">12</span>:<span class="number">52.103406200</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_21ã€‘<span class="number">21</span>:<span class="number">12</span>:<span class="number">52.123827300</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_22ã€‘<span class="number">21</span>:<span class="number">12</span>:<span class="number">52.146165100</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_23ã€‘<span class="number">21</span>:<span class="number">12</span>:<span class="number">52.168828300</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_24ã€‘<span class="number">21</span>:<span class="number">12</span>:<span class="number">52.191769500</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_25ã€‘<span class="number">21</span>:<span class="number">12</span>:<span class="number">52.214839100</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_26ã€‘<span class="number">21</span>:<span class="number">12</span>:<span class="number">52.238998700</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_27ã€‘<span class="number">21</span>:<span class="number">12</span>:<span class="number">52.259772600</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_28ã€‘<span class="number">21</span>:<span class="number">12</span>:<span class="number">52.284131800</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">2.</span>.......æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_29ã€‘<span class="number">21</span>:<span class="number">12</span>:<span class="number">52.306190600</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_30ã€‘<span class="number">21</span>:<span class="number">12</span>:<span class="number">52.325315800</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_31ã€‘<span class="number">21</span>:<span class="number">12</span>:<span class="number">52.347012500</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_32ã€‘<span class="number">21</span>:<span class="number">12</span>:<span class="number">52.368508600</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_33ã€‘<span class="number">21</span>:<span class="number">12</span>:<span class="number">52.391785100</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_34ã€‘<span class="number">21</span>:<span class="number">12</span>:<span class="number">52.416383800</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_35ã€‘<span class="number">21</span>:<span class="number">12</span>:<span class="number">52.439019</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_36ã€‘<span class="number">21</span>:<span class="number">12</span>:<span class="number">52.461733900</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_37ã€‘<span class="number">21</span>:<span class="number">12</span>:<span class="number">52.485990</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_38ã€‘<span class="number">21</span>:<span class="number">12</span>:<span class="number">52.509219900</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">2.</span>.......æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_39ã€‘<span class="number">21</span>:<span class="number">12</span>:<span class="number">52.523683400</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_40ã€‘<span class="number">21</span>:<span class="number">12</span>:<span class="number">52.547412100</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_41ã€‘<span class="number">21</span>:<span class="number">12</span>:<span class="number">52.571191800</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_42ã€‘<span class="number">21</span>:<span class="number">12</span>:<span class="number">52.593024600</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_43ã€‘<span class="number">21</span>:<span class="number">12</span>:<span class="number">52.616731800</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_44ã€‘<span class="number">21</span>:<span class="number">12</span>:<span class="number">52.640317</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_45ã€‘<span class="number">21</span>:<span class="number">12</span>:<span class="number">52.663111100</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_46ã€‘<span class="number">21</span>:<span class="number">12</span>:<span class="number">52.686727</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_47ã€‘<span class="number">21</span>:<span class="number">12</span>:<span class="number">52.709266500</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">2.</span>.......æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_48ã€‘<span class="number">21</span>:<span class="number">12</span>:<span class="number">52.725884900</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_49ã€‘<span class="number">21</span>:<span class="number">12</span>:<span class="number">52.746299900</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥å‘ç°ï¼Œç”±äºæ¶ˆè´¹è€…1å¤„ç†é€Ÿåº¦è¾ƒå¿«ï¼Œæ‰€ä»¥å¤„ç†äº†æ›´å¤šçš„æ¶ˆæ¯ï¼›æ¶ˆè´¹è€…2å¤„ç†é€Ÿåº¦è¾ƒæ…¢ï¼Œåªå¤„ç†äº†6æ¡æ¶ˆæ¯ã€‚è€Œæœ€ç»ˆæ€»çš„æ‰§è¡Œè€—æ—¶ä¹Ÿåœ¨1ç§’å·¦å³ï¼Œå¤§å¤§æå‡ã€‚</p><p>æ­£æ‰€è°“èƒ½è€…å¤šåŠ³ï¼Œè¿™æ ·å……åˆ†åˆ©ç”¨äº†æ¯ä¸€ä¸ªæ¶ˆè´¹è€…çš„å¤„ç†èƒ½åŠ›ï¼Œå¯ä»¥æœ‰æ•ˆé¿å…æ¶ˆæ¯ç§¯å‹é—®é¢˜ã€‚</p><h3 id="3-3-5-æ€»ç»“">3.3.5.æ€»ç»“</h3><p>Workæ¨¡å‹çš„ä½¿ç”¨ï¼š</p><ul><li><p>å¤šä¸ªæ¶ˆè´¹è€…ç»‘å®šåˆ°ä¸€ä¸ªé˜Ÿåˆ—ï¼ŒåŒä¸€æ¡æ¶ˆæ¯åªä¼šè¢«ä¸€ä¸ªæ¶ˆè´¹è€…å¤„ç†</p></li><li><p>é€šè¿‡è®¾ç½®prefetchæ¥æ§åˆ¶æ¶ˆè´¹è€…é¢„å–çš„æ¶ˆæ¯æ•°é‡</p></li></ul><h2 id="3-4-äº¤æ¢æœºç±»å‹">3.4.äº¤æ¢æœºç±»å‹</h2><p>åœ¨ä¹‹å‰çš„ä¸¤ä¸ªæµ‹è¯•æ¡ˆä¾‹ä¸­ï¼Œéƒ½æ²¡æœ‰äº¤æ¢æœºï¼Œç”Ÿäº§è€…ç›´æ¥å‘é€æ¶ˆæ¯åˆ°é˜Ÿåˆ—ã€‚è€Œä¸€æ—¦å¼•å…¥äº¤æ¢æœºï¼Œæ¶ˆæ¯å‘é€çš„æ¨¡å¼ä¼šæœ‰å¾ˆå¤§å˜åŒ–ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/diagram-8-175603011395648.png" alt=""></p><p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨è®¢é˜…æ¨¡å‹ä¸­ï¼Œå¤šäº†ä¸€ä¸ªexchangeè§’è‰²ï¼Œè€Œä¸”è¿‡ç¨‹ç•¥æœ‰å˜åŒ–ï¼š</p><ul><li><p><strong>Publisher</strong>ï¼šç”Ÿäº§è€…ï¼Œä¸å†å‘é€æ¶ˆæ¯åˆ°é˜Ÿåˆ—ä¸­ï¼Œè€Œæ˜¯å‘ç»™äº¤æ¢æœº</p></li><li><p><strong>Exchange</strong>ï¼šäº¤æ¢æœºï¼Œä¸€æ–¹é¢ï¼Œæ¥æ”¶ç”Ÿäº§è€…å‘é€çš„æ¶ˆæ¯ã€‚å¦ä¸€æ–¹é¢ï¼ŒçŸ¥é“å¦‚ä½•å¤„ç†æ¶ˆæ¯ï¼Œä¾‹å¦‚é€’äº¤ç»™æŸä¸ªç‰¹åˆ«é˜Ÿåˆ—ã€é€’äº¤ç»™æ‰€æœ‰é˜Ÿåˆ—ã€æˆ–æ˜¯å°†æ¶ˆæ¯ä¸¢å¼ƒã€‚åˆ°åº•å¦‚ä½•æ“ä½œï¼Œå–å†³äºExchangeçš„ç±»å‹ã€‚</p></li><li><p><strong>Queue</strong>ï¼šæ¶ˆæ¯é˜Ÿåˆ—ä¹Ÿä¸ä»¥å‰ä¸€æ ·ï¼Œæ¥æ”¶æ¶ˆæ¯ã€ç¼“å­˜æ¶ˆæ¯ã€‚ä¸è¿‡é˜Ÿåˆ—ä¸€å®šè¦ä¸äº¤æ¢æœºç»‘å®šã€‚</p></li><li><p><strong>Consumer</strong>ï¼šæ¶ˆè´¹è€…ï¼Œä¸ä»¥å‰ä¸€æ ·ï¼Œè®¢é˜…é˜Ÿåˆ—ï¼Œæ²¡æœ‰å˜åŒ–</p></li></ul><p><strong>Exchangeï¼ˆäº¤æ¢æœºï¼‰åªè´Ÿè´£è½¬å‘æ¶ˆæ¯ï¼Œä¸å…·å¤‡å­˜å‚¨æ¶ˆæ¯çš„èƒ½åŠ›</strong>ï¼Œå› æ­¤å¦‚æœæ²¡æœ‰ä»»ä½•é˜Ÿåˆ—ä¸Exchangeç»‘å®šï¼Œæˆ–è€…æ²¡æœ‰ç¬¦åˆè·¯ç”±è§„åˆ™çš„é˜Ÿåˆ—ï¼Œé‚£ä¹ˆæ¶ˆæ¯ä¼šä¸¢å¤±ï¼</p><p>äº¤æ¢æœºçš„ç±»å‹æœ‰å››ç§ï¼š</p><ul><li><p><strong>Fanout</strong>ï¼šå¹¿æ’­ï¼Œå°†æ¶ˆæ¯äº¤ç»™æ‰€æœ‰ç»‘å®šåˆ°äº¤æ¢æœºçš„é˜Ÿåˆ—ã€‚æˆ‘ä»¬æœ€æ—©åœ¨æ§åˆ¶å°ä½¿ç”¨çš„æ­£æ˜¯Fanoutäº¤æ¢æœº</p></li><li><p><strong>Direct</strong>ï¼šè®¢é˜…ï¼ŒåŸºäºRoutingKeyï¼ˆè·¯ç”±keyï¼‰å‘é€ç»™è®¢é˜…äº†æ¶ˆæ¯çš„é˜Ÿåˆ—</p></li><li><p><strong>Topic</strong>ï¼šé€šé…ç¬¦è®¢é˜…ï¼Œä¸Directç±»ä¼¼ï¼Œåªä¸è¿‡RoutingKeyå¯ä»¥ä½¿ç”¨é€šé…ç¬¦</p></li><li><p><strong>Headers</strong>ï¼šå¤´åŒ¹é…ï¼ŒåŸºäºMQçš„æ¶ˆæ¯å¤´åŒ¹é…ï¼Œç”¨çš„è¾ƒå°‘ã€‚</p></li></ul><p>è¯¾å ‚ä¸­ï¼Œæˆ‘ä»¬è®²è§£å‰é¢çš„ä¸‰ç§äº¤æ¢æœºæ¨¡å¼ã€‚</p><h2 id="3-5-Fanoutäº¤æ¢æœº">3.5.Fanoutäº¤æ¢æœº</h2><p>Fanoutï¼Œè‹±æ–‡ç¿»è¯‘æ˜¯æ‰‡å‡ºï¼Œæˆ‘è§‰å¾—åœ¨MQä¸­å«å¹¿æ’­æ›´åˆé€‚ã€‚</p><p>åœ¨å¹¿æ’­æ¨¡å¼ä¸‹ï¼Œæ¶ˆæ¯å‘é€æµç¨‹æ˜¯è¿™æ ·çš„ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/Z0PrbLnmnocBcyx8Xn0cyIShnjb-175603011395650.png" alt=""></p><ul><li><p>1ï¼‰  å¯ä»¥æœ‰å¤šä¸ªé˜Ÿåˆ—</p></li><li><p>2ï¼‰  æ¯ä¸ªé˜Ÿåˆ—éƒ½è¦ç»‘å®šåˆ°Exchangeï¼ˆäº¤æ¢æœºï¼‰</p></li><li><p>3ï¼‰  ç”Ÿäº§è€…å‘é€çš„æ¶ˆæ¯ï¼Œåªèƒ½å‘é€åˆ°äº¤æ¢æœº</p></li><li><p>4ï¼‰  äº¤æ¢æœºæŠŠæ¶ˆæ¯å‘é€ç»™ç»‘å®šè¿‡çš„æ‰€æœ‰é˜Ÿåˆ—</p></li><li><p>5ï¼‰  è®¢é˜…é˜Ÿåˆ—çš„æ¶ˆè´¹è€…éƒ½èƒ½æ‹¿åˆ°æ¶ˆæ¯</p></li></ul><p>æˆ‘ä»¬çš„è®¡åˆ’æ˜¯è¿™æ ·çš„ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/Reynb5FGbosgNVxHA1HclKlAnfg-175603011395652.png" alt=""></p><ul><li><p>åˆ›å»ºä¸€ä¸ªåä¸º<code> hmall.fanout</code>çš„äº¤æ¢æœºï¼Œç±»å‹æ˜¯<code>Fanout</code></p></li><li><p>åˆ›å»ºä¸¤ä¸ªé˜Ÿåˆ—<code>fanout.queue1</code>å’Œ<code>fanout.queue2</code>ï¼Œç»‘å®šåˆ°äº¤æ¢æœº<code>hmall.fanout</code></p></li></ul><h3 id="3-5-1-å£°æ˜é˜Ÿåˆ—å’Œäº¤æ¢æœº">3.5.1.å£°æ˜é˜Ÿåˆ—å’Œäº¤æ¢æœº</h3><p>åœ¨æ§åˆ¶å°åˆ›å»ºé˜Ÿåˆ—<code>fanout.queue1</code>:</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/TvF5bHPaWowb7exZc6LcFhsPnSr-175603011395651.png" alt=""></p><p>åœ¨åˆ›å»ºä¸€ä¸ªé˜Ÿåˆ—<code>fanout.queue2</code>ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/U4PnbzhFtogqyIxrvOycO9xLnOe-175603011395654.png" alt=""></p><p>ç„¶åå†åˆ›å»ºä¸€ä¸ªäº¤æ¢æœºï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/Jpc3b21AmodhVdx1pdIceYV7nHg-175603011395653.png" alt=""></p><p>ç„¶åç»‘å®šä¸¤ä¸ªé˜Ÿåˆ—åˆ°äº¤æ¢æœºï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/MlREb8DvBoFHmJxFiEJciMLVn8b-175603011395655.png" alt=""></p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/ReCibIyUDoZbmXx4rJecltt7n6f-175603011395656.png" alt=""></p><h3 id="3-5-2-æ¶ˆæ¯å‘é€">3.5.2.æ¶ˆæ¯å‘é€</h3><p>åœ¨publisheræœåŠ¡çš„SpringAmqpTestç±»ä¸­æ·»åŠ æµ‹è¯•æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testFanoutExchange</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// äº¤æ¢æœºåç§°</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">exchangeName</span> <span class="operator">=</span> <span class="string">&quot;hmall.fanout&quot;</span>;</span><br><span class="line">    <span class="comment">// æ¶ˆæ¯</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">&quot;hello, everyone!&quot;</span>;</span><br><span class="line">    rabbitTemplate.convertAndSend(exchangeName, <span class="string">&quot;&quot;</span>, message);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-5-3-æ¶ˆæ¯æ¥æ”¶">3.5.3.æ¶ˆæ¯æ¥æ”¶</h3><p>åœ¨consumeræœåŠ¡çš„SpringRabbitListenerä¸­æ·»åŠ ä¸¤ä¸ªæ–¹æ³•ï¼Œä½œä¸ºæ¶ˆè´¹è€…ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RabbitListener(queues = &quot;fanout.queue1&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenFanoutQueue1</span><span class="params">(String msg)</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;æ¶ˆè´¹è€…1æ¥æ”¶åˆ°Fanoutæ¶ˆæ¯ï¼šã€&quot;</span> + msg + <span class="string">&quot;ã€‘&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RabbitListener(queues = &quot;fanout.queue2&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenFanoutQueue2</span><span class="params">(String msg)</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;æ¶ˆè´¹è€…2æ¥æ”¶åˆ°Fanoutæ¶ˆæ¯ï¼šã€&quot;</span> + msg + <span class="string">&quot;ã€‘&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-5-4-æ€»ç»“">3.5.4.æ€»ç»“</h3><p>äº¤æ¢æœºçš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</p><ul><li><p>æ¥æ”¶publisherå‘é€çš„æ¶ˆæ¯</p></li><li><p>å°†æ¶ˆæ¯æŒ‰ç…§è§„åˆ™è·¯ç”±åˆ°ä¸ä¹‹ç»‘å®šçš„é˜Ÿåˆ—</p></li><li><p>ä¸èƒ½ç¼“å­˜æ¶ˆæ¯ï¼Œè·¯ç”±å¤±è´¥ï¼Œæ¶ˆæ¯ä¸¢å¤±</p></li><li><p>FanoutExchangeçš„ä¼šå°†æ¶ˆæ¯è·¯ç”±åˆ°æ¯ä¸ªç»‘å®šçš„é˜Ÿåˆ—</p></li></ul><h2 id="3-6-Directäº¤æ¢æœº">3.6.Directäº¤æ¢æœº</h2><p>åœ¨Fanoutæ¨¡å¼ä¸­ï¼Œä¸€æ¡æ¶ˆæ¯ï¼Œä¼šè¢«æ‰€æœ‰è®¢é˜…çš„é˜Ÿåˆ—éƒ½æ¶ˆè´¹ã€‚ä½†æ˜¯ï¼Œåœ¨æŸäº›åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬å¸Œæœ›ä¸åŒçš„æ¶ˆæ¯è¢«ä¸åŒçš„é˜Ÿåˆ—æ¶ˆè´¹ã€‚è¿™æ—¶å°±è¦ç”¨åˆ°Directç±»å‹çš„Exchangeã€‚</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/El3hbCOh3ohMT2xatZJcpcqwnDc-175603011395657.png" alt=""></p><p>åœ¨Directæ¨¡å‹ä¸‹ï¼š</p><ul><li><p>é˜Ÿåˆ—ä¸äº¤æ¢æœºçš„ç»‘å®šï¼Œä¸èƒ½æ˜¯ä»»æ„ç»‘å®šäº†ï¼Œè€Œæ˜¯è¦æŒ‡å®šä¸€ä¸ª<code>RoutingKey</code>ï¼ˆè·¯ç”±keyï¼‰</p></li><li><p>æ¶ˆæ¯çš„å‘é€æ–¹åœ¨ å‘ Exchangeå‘é€æ¶ˆæ¯æ—¶ï¼Œä¹Ÿå¿…é¡»æŒ‡å®šæ¶ˆæ¯çš„ <code>RoutingKey</code>ã€‚</p></li><li><p>Exchangeä¸å†æŠŠæ¶ˆæ¯äº¤ç»™æ¯ä¸€ä¸ªç»‘å®šçš„é˜Ÿåˆ—ï¼Œè€Œæ˜¯æ ¹æ®æ¶ˆæ¯çš„<code>Routing Key</code>è¿›è¡Œåˆ¤æ–­ï¼Œåªæœ‰é˜Ÿåˆ—çš„<code>Routingkey</code>ä¸æ¶ˆæ¯çš„ <code>Routing key</code>å®Œå…¨ä¸€è‡´ï¼Œæ‰ä¼šæ¥æ”¶åˆ°æ¶ˆæ¯</p></li></ul><p><strong>æ¡ˆä¾‹éœ€æ±‚å¦‚å›¾</strong>ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/SschbFsTao91PvxfZWKc6L54nkd-175603011395658.png" alt=""></p><ol><li><p> å£°æ˜ä¸€ä¸ªåä¸º<code>hmall.direct</code>çš„äº¤æ¢æœº</p></li><li><p>å£°æ˜é˜Ÿåˆ—<code>direct.queue1</code>ï¼Œç»‘å®š<code>hmall.direct</code>ï¼Œ<code>bindingKey</code>ä¸º<code>blud</code>å’Œ<code>red</code></p></li><li><p>å£°æ˜é˜Ÿåˆ—<code>direct.queue2</code>ï¼Œç»‘å®š<code>hmall.direct</code>ï¼Œ<code>bindingKey</code>ä¸º<code>yellow</code>å’Œ<code>red</code></p></li><li><p> åœ¨<code>consumer</code>æœåŠ¡ä¸­ï¼Œç¼–å†™ä¸¤ä¸ªæ¶ˆè´¹è€…æ–¹æ³•ï¼Œåˆ†åˆ«ç›‘å¬direct.queue1å’Œdirect.queue2 </p></li><li><p> åœ¨publisherä¸­ç¼–å†™æµ‹è¯•æ–¹æ³•ï¼Œå‘<code>hmall.direct</code>å‘é€æ¶ˆæ¯ </p></li></ol><h3 id="3-6-1-å£°æ˜é˜Ÿåˆ—å’Œäº¤æ¢æœº">3.6.1.å£°æ˜é˜Ÿåˆ—å’Œäº¤æ¢æœº</h3><p>é¦–å…ˆåœ¨æ§åˆ¶å°å£°æ˜ä¸¤ä¸ªé˜Ÿåˆ—<code>direct.queue1</code>å’Œ<code>direct.queue2</code>ï¼Œè¿™é‡Œä¸å†å±•ç¤ºè¿‡ç¨‹ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/XeRPbclP1odEO1xa22Hc50Non6p-175603011395659.png" alt=""></p><p>ç„¶åå£°æ˜ä¸€ä¸ªdirectç±»å‹çš„äº¤æ¢æœºï¼Œå‘½åä¸º<code>hmall.direct</code>:</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/SvpDbCaV8oXzzpx4oUScSftLnzf-175603011395660.png" alt=""></p><p>ç„¶åä½¿ç”¨<code>red</code>å’Œ<code>blue</code>ä½œä¸ºkeyï¼Œç»‘å®š<code>direct.queue1</code>åˆ°<code>hmall.direct</code>ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/UIjhbp9j8op6Uux1MaqcxAF7nEg-175603011395661.png" alt=""></p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/Ua6Nb5S5yoV2dGxOm5gcGFNonBb-175603011395662.png" alt=""></p><p>åŒç†ï¼Œä½¿ç”¨<code>red</code>å’Œ<code>yellow</code>ä½œä¸ºkeyï¼Œç»‘å®š<code>direct.queue2</code>åˆ°<code>hmall.direct</code>ï¼Œæ­¥éª¤ç•¥ï¼Œæœ€ç»ˆç»“æœï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/ChembAGFOoGUquxlMvhcJcn7nCg-175603011395663.png" alt=""></p><h3 id="3-6-2-æ¶ˆæ¯æ¥æ”¶">3.6.2.æ¶ˆæ¯æ¥æ”¶</h3><p>åœ¨consumeræœåŠ¡çš„SpringRabbitListenerä¸­æ·»åŠ æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RabbitListener(queues = &quot;direct.queue1&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenDirectQueue1</span><span class="params">(String msg)</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;æ¶ˆè´¹è€…1æ¥æ”¶åˆ°direct.queue1çš„æ¶ˆæ¯ï¼šã€&quot;</span> + msg + <span class="string">&quot;ã€‘&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RabbitListener(queues = &quot;direct.queue2&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenDirectQueue2</span><span class="params">(String msg)</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;æ¶ˆè´¹è€…2æ¥æ”¶åˆ°direct.queue2çš„æ¶ˆæ¯ï¼šã€&quot;</span> + msg + <span class="string">&quot;ã€‘&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-6-3-æ¶ˆæ¯å‘é€">3.6.3.æ¶ˆæ¯å‘é€</h3><p>åœ¨publisheræœåŠ¡çš„SpringAmqpTestç±»ä¸­æ·»åŠ æµ‹è¯•æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSendDirectExchange</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// äº¤æ¢æœºåç§°</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">exchangeName</span> <span class="operator">=</span> <span class="string">&quot;hmall.direct&quot;</span>;</span><br><span class="line">    <span class="comment">// æ¶ˆæ¯</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">&quot;çº¢è‰²è­¦æŠ¥ï¼æ—¥æœ¬ä¹±æ’æ ¸åºŸæ°´ï¼Œå¯¼è‡´æµ·æ´‹ç”Ÿç‰©å˜å¼‚ï¼ŒæƒŠç°å“¥æ–¯æ‹‰ï¼&quot;</span>;</span><br><span class="line">    <span class="comment">// å‘é€æ¶ˆæ¯</span></span><br><span class="line">    rabbitTemplate.convertAndSend(exchangeName, <span class="string">&quot;red&quot;</span>, message);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”±äºä½¿ç”¨çš„redè¿™ä¸ªkeyï¼Œæ‰€ä»¥ä¸¤ä¸ªæ¶ˆè´¹è€…éƒ½æ”¶åˆ°äº†æ¶ˆæ¯ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/QrjCbcq13oBpB3x9uoxcvK0mngh-175603011395664.png" alt=""></p><p>æˆ‘ä»¬å†åˆ‡æ¢ä¸ºblueè¿™ä¸ªkeyï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSendDirectExchange</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// äº¤æ¢æœºåç§°</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">exchangeName</span> <span class="operator">=</span> <span class="string">&quot;hmall.direct&quot;</span>;</span><br><span class="line">    <span class="comment">// æ¶ˆæ¯</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">&quot;æœ€æ–°æŠ¥é“ï¼Œå“¥æ–¯æ‹‰æ˜¯å±…æ°‘è‡ªæ²»å·¨å‹æ°”çƒï¼Œè™šæƒŠä¸€åœºï¼&quot;</span>;</span><br><span class="line">    <span class="comment">// å‘é€æ¶ˆæ¯</span></span><br><span class="line">    rabbitTemplate.convertAndSend(exchangeName, <span class="string">&quot;blue&quot;</span>, message);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½ ä¼šå‘ç°ï¼Œåªæœ‰æ¶ˆè´¹è€…1æ”¶åˆ°äº†æ¶ˆæ¯ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/YyVGb2Z7BoWu2exjQGMc15BRnwf-175603011395665.png" alt=""></p><h3 id="3-6-4-æ€»ç»“">3.6.4.æ€»ç»“</h3><p>æè¿°ä¸‹Directäº¤æ¢æœºä¸Fanoutäº¤æ¢æœºçš„å·®å¼‚ï¼Ÿ</p><ul><li><p>Fanoutäº¤æ¢æœºå°†æ¶ˆæ¯è·¯ç”±ç»™æ¯ä¸€ä¸ªä¸ä¹‹ç»‘å®šçš„é˜Ÿåˆ—</p></li><li><p>Directäº¤æ¢æœºæ ¹æ®RoutingKeyåˆ¤æ–­è·¯ç”±ç»™å“ªä¸ªé˜Ÿåˆ—</p></li><li><p>å¦‚æœå¤šä¸ªé˜Ÿåˆ—å…·æœ‰ç›¸åŒçš„RoutingKeyï¼Œåˆ™ä¸FanoutåŠŸèƒ½ç±»ä¼¼</p></li></ul><h2 id="3-7-Topicäº¤æ¢æœº">3.7.Topicäº¤æ¢æœº</h2><h3 id="3-7-1-è¯´æ˜">3.7.1.è¯´æ˜</h3><p><code>Topic</code>ç±»å‹çš„<code>Exchange</code>ä¸<code>Direct</code>ç›¸æ¯”ï¼Œéƒ½æ˜¯å¯ä»¥æ ¹æ®<code>RoutingKey</code>æŠŠæ¶ˆæ¯è·¯ç”±åˆ°ä¸åŒçš„é˜Ÿåˆ—ã€‚</p><p>åªä¸è¿‡<code>Topic</code>ç±»å‹<code>Exchange</code>å¯ä»¥è®©é˜Ÿåˆ—åœ¨ç»‘å®š<code>BindingKey</code> çš„æ—¶å€™ä½¿ç”¨é€šé…ç¬¦ï¼</p><p><code>BindingKey</code> ä¸€èˆ¬éƒ½æ˜¯æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªå•è¯ç»„æˆï¼Œå¤šä¸ªå•è¯ä¹‹é—´ä»¥<code>.</code>åˆ†å‰²ï¼Œä¾‹å¦‚ï¼š <code>item.insert</code></p><p>é€šé…ç¬¦è§„åˆ™ï¼š</p><ul><li><p><code>#</code>ï¼šåŒ¹é…ä¸€ä¸ªæˆ–å¤šä¸ªè¯</p></li><li><p><code>*</code>ï¼šåŒ¹é…ä¸å¤šä¸å°‘æ°å¥½1ä¸ªè¯</p></li></ul><p>ä¸¾ä¾‹ï¼š</p><ul><li><p><code>item.#</code>ï¼šèƒ½å¤ŸåŒ¹é…<code>item.spu.insert</code> æˆ–è€… <code>item.spu</code></p></li><li><p><code>item.*</code>ï¼šåªèƒ½åŒ¹é…<code>item.spu</code></p></li></ul><p>å›¾ç¤ºï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/QFzzbeUUjoVf0RxfS1AcgT7LnUe-175603011395667.png" alt=""></p><p>å‡å¦‚æ­¤æ—¶publisherå‘é€çš„æ¶ˆæ¯ä½¿ç”¨çš„<code>RoutingKey</code>å…±æœ‰å››ç§ï¼š</p><ul><li><p><code>china.news </code>ä»£è¡¨æœ‰ä¸­å›½çš„æ–°é—»æ¶ˆæ¯ï¼›</p></li><li><p><code>china.weather</code> ä»£è¡¨ä¸­å›½çš„å¤©æ°”æ¶ˆæ¯ï¼›</p></li><li><p><code>japan.news</code> åˆ™ä»£è¡¨æ—¥æœ¬æ–°é—»</p></li><li><p><code>japan.weather</code> ä»£è¡¨æ—¥æœ¬çš„å¤©æ°”æ¶ˆæ¯ï¼›</p></li></ul><p>è§£é‡Šï¼š</p><ul><li><p><code>topic.queue1</code>ï¼šç»‘å®šçš„æ˜¯<code>china.#</code> ï¼Œå‡¡æ˜¯ä»¥ <code>china.</code>å¼€å¤´çš„<code>routing key</code> éƒ½ä¼šè¢«åŒ¹é…åˆ°ï¼ŒåŒ…æ‹¬ï¼š</p><ul><li><p><code>china.news</code></p></li><li><p><code>china.weather</code></p></li></ul></li><li><p><code>topic.queue2</code>ï¼šç»‘å®šçš„æ˜¯<code>#.news</code> ï¼Œå‡¡æ˜¯ä»¥ <code>.news</code>ç»“å°¾çš„ <code>routing key</code> éƒ½ä¼šè¢«åŒ¹é…ã€‚åŒ…æ‹¬:</p><ul><li><p><code>china.news</code></p></li><li><p><code>japan.news</code></p></li></ul></li></ul><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±æŒ‰ç…§ä¸Šå›¾æ‰€ç¤ºï¼Œæ¥æ¼”ç¤ºä¸€ä¸‹Topicäº¤æ¢æœºçš„ç”¨æ³•ã€‚</p><p>é¦–å…ˆï¼Œåœ¨æ§åˆ¶å°æŒ‰ç…§å›¾ç¤ºä¾‹å­åˆ›å»ºé˜Ÿåˆ—ã€äº¤æ¢æœºï¼Œå¹¶åˆ©ç”¨é€šé…ç¬¦ç»‘å®šé˜Ÿåˆ—å’Œäº¤æ¢æœºã€‚æ­¤å¤„æ­¥éª¤ç•¥ã€‚æœ€ç»ˆç»“æœå¦‚ä¸‹ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/H2ZubsD1woeetoxIHMjcuFRanJd-175603011395666.png" alt=""></p><h3 id="3-7-2-æ¶ˆæ¯å‘é€">3.7.2.æ¶ˆæ¯å‘é€</h3><p>åœ¨publisheræœåŠ¡çš„SpringAmqpTestç±»ä¸­æ·»åŠ æµ‹è¯•æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * topicExchange</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSendTopicExchange</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// äº¤æ¢æœºåç§°</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">exchangeName</span> <span class="operator">=</span> <span class="string">&quot;hmall.topic&quot;</span>;</span><br><span class="line">    <span class="comment">// æ¶ˆæ¯</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">&quot;å–œæŠ¥ï¼å­™æ‚Ÿç©ºå¤§æˆ˜å“¥æ–¯æ‹‰ï¼Œèƒœ!&quot;</span>;</span><br><span class="line">    <span class="comment">// å‘é€æ¶ˆæ¯</span></span><br><span class="line">    rabbitTemplate.convertAndSend(exchangeName, <span class="string">&quot;china.news&quot;</span>, message);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-7-3-æ¶ˆæ¯æ¥æ”¶">3.7.3.æ¶ˆæ¯æ¥æ”¶</h3><p>åœ¨consumeræœåŠ¡çš„SpringRabbitListenerä¸­æ·»åŠ æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RabbitListener(queues = &quot;topic.queue1&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenTopicQueue1</span><span class="params">(String msg)</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;æ¶ˆè´¹è€…1æ¥æ”¶åˆ°topic.queue1çš„æ¶ˆæ¯ï¼šã€&quot;</span> + msg + <span class="string">&quot;ã€‘&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RabbitListener(queues = &quot;topic.queue2&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenTopicQueue2</span><span class="params">(String msg)</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;æ¶ˆè´¹è€…2æ¥æ”¶åˆ°topic.queue2çš„æ¶ˆæ¯ï¼šã€&quot;</span> + msg + <span class="string">&quot;ã€‘&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-7-4-æ€»ç»“">3.7.4.æ€»ç»“</h3><p>æè¿°ä¸‹Directäº¤æ¢æœºä¸Topicäº¤æ¢æœºçš„å·®å¼‚ï¼Ÿ</p><ul><li><p>Topicäº¤æ¢æœºæ¥æ”¶çš„æ¶ˆæ¯RoutingKeyå¿…é¡»æ˜¯å¤šä¸ªå•è¯ï¼Œä»¥ <strong><code>.</code></strong> åˆ†å‰²</p></li><li><p>Topicäº¤æ¢æœºä¸é˜Ÿåˆ—ç»‘å®šæ—¶çš„bindingKeyå¯ä»¥æŒ‡å®šé€šé…ç¬¦</p></li><li><p><code>#</code>ï¼šä»£è¡¨0ä¸ªæˆ–å¤šä¸ªè¯</p></li><li><p><code>*</code>ï¼šä»£è¡¨1ä¸ªè¯</p></li></ul><h2 id="3-8-å£°æ˜é˜Ÿåˆ—å’Œäº¤æ¢æœº">3.8.å£°æ˜é˜Ÿåˆ—å’Œäº¤æ¢æœº</h2><p>åœ¨ä¹‹å‰æˆ‘ä»¬éƒ½æ˜¯åŸºäºRabbitMQæ§åˆ¶å°æ¥åˆ›å»ºé˜Ÿåˆ—ã€äº¤æ¢æœºã€‚ä½†æ˜¯åœ¨å®é™…å¼€å‘æ—¶ï¼Œé˜Ÿåˆ—å’Œäº¤æ¢æœºæ˜¯ç¨‹åºå‘˜å®šä¹‰çš„ï¼Œå°†æ¥é¡¹ç›®ä¸Šçº¿ï¼Œåˆè¦äº¤ç»™è¿ç»´å»åˆ›å»ºã€‚é‚£ä¹ˆç¨‹åºå‘˜å°±éœ€è¦æŠŠç¨‹åºä¸­è¿è¡Œçš„æ‰€æœ‰é˜Ÿåˆ—å’Œäº¤æ¢æœºéƒ½å†™ä¸‹æ¥ï¼Œäº¤ç»™è¿ç»´ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­æ˜¯å¾ˆå®¹æ˜“å‡ºç°é”™è¯¯çš„ã€‚</p><p>å› æ­¤æ¨èçš„åšæ³•æ˜¯ç”±ç¨‹åºå¯åŠ¨æ—¶æ£€æŸ¥é˜Ÿåˆ—å’Œäº¤æ¢æœºæ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨è‡ªåŠ¨åˆ›å»ºã€‚</p><h3 id="3-8-1-åŸºæœ¬API">3.8.1.åŸºæœ¬API</h3><p>SpringAMQPæä¾›äº†ä¸€ä¸ªQueueç±»ï¼Œç”¨æ¥åˆ›å»ºé˜Ÿåˆ—ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/LMnRbQuaIoHHrkxByzLcsSPFnjh-175603011395668.png" alt=""></p><p>SpringAMQPè¿˜æä¾›äº†ä¸€ä¸ªExchangeæ¥å£ï¼Œæ¥è¡¨ç¤ºæ‰€æœ‰ä¸åŒç±»å‹çš„äº¤æ¢æœºï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/RwxPbRd0boAOLhxx6qzcXQPqnKd-175603011395669.png" alt=""></p><p>æˆ‘ä»¬å¯ä»¥è‡ªå·±åˆ›å»ºé˜Ÿåˆ—å’Œäº¤æ¢æœºï¼Œä¸è¿‡SpringAMQPè¿˜æä¾›äº†ExchangeBuilderæ¥ç®€åŒ–è¿™ä¸ªè¿‡ç¨‹ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/JDYsbeQn2o2P81xGpvOc5znfn7b-175603011395670.png" alt=""></p><p>è€Œåœ¨ç»‘å®šé˜Ÿåˆ—å’Œäº¤æ¢æœºæ—¶ï¼Œåˆ™éœ€è¦ä½¿ç”¨BindingBuilderæ¥åˆ›å»ºBindingå¯¹è±¡ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/XV57bsutQovJ1kxafTUcqsFWnkh-175603011395672.png" alt=""></p><h3 id="3-8-2-fanoutç¤ºä¾‹">3.8.2.fanoutç¤ºä¾‹</h3><p>åœ¨consumerä¸­åˆ›å»ºä¸€ä¸ªç±»ï¼Œå£°æ˜é˜Ÿåˆ—å’Œäº¤æ¢æœºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.consumer.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.core.Binding;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.core.BindingBuilder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.core.FanoutExchange;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.core.Queue;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FanoutConfig</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å£°æ˜äº¤æ¢æœº</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> Fanoutç±»å‹äº¤æ¢æœº</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> FanoutExchange <span class="title function_">fanoutExchange</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">FanoutExchange</span>(<span class="string">&quot;hmall.fanout&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç¬¬1ä¸ªé˜Ÿåˆ—</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Queue <span class="title function_">fanoutQueue1</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Queue</span>(<span class="string">&quot;fanout.queue1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç»‘å®šé˜Ÿåˆ—å’Œäº¤æ¢æœº</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Binding <span class="title function_">bindingQueue1</span><span class="params">(Queue fanoutQueue1, FanoutExchange fanoutExchange)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(fanoutQueue1).to(fanoutExchange);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç¬¬2ä¸ªé˜Ÿåˆ—</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Queue <span class="title function_">fanoutQueue2</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Queue</span>(<span class="string">&quot;fanout.queue2&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç»‘å®šé˜Ÿåˆ—å’Œäº¤æ¢æœº</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Binding <span class="title function_">bindingQueue2</span><span class="params">(Queue fanoutQueue2, FanoutExchange fanoutExchange)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(fanoutQueue2).to(fanoutExchange);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-8-2-directç¤ºä¾‹">3.8.2.directç¤ºä¾‹</h3><p>directæ¨¡å¼ç”±äºè¦ç»‘å®šå¤šä¸ªKEYï¼Œä¼šéå¸¸éº»çƒ¦ï¼Œæ¯ä¸€ä¸ªKeyéƒ½è¦ç¼–å†™ä¸€ä¸ªbindingï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.consumer.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.core.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DirectConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å£°æ˜äº¤æ¢æœº</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> Directç±»å‹äº¤æ¢æœº</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> DirectExchange <span class="title function_">directExchange</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ExchangeBuilder.directExchange(<span class="string">&quot;hmall.direct&quot;</span>).build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç¬¬1ä¸ªé˜Ÿåˆ—</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Queue <span class="title function_">directQueue1</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Queue</span>(<span class="string">&quot;direct.queue1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç»‘å®šé˜Ÿåˆ—å’Œäº¤æ¢æœº</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Binding <span class="title function_">bindingQueue1WithRed</span><span class="params">(Queue directQueue1, DirectExchange directExchange)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(directQueue1).to(directExchange).with(<span class="string">&quot;red&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç»‘å®šé˜Ÿåˆ—å’Œäº¤æ¢æœº</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Binding <span class="title function_">bindingQueue1WithBlue</span><span class="params">(Queue directQueue1, DirectExchange directExchange)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(directQueue1).to(directExchange).with(<span class="string">&quot;blue&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç¬¬2ä¸ªé˜Ÿåˆ—</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Queue <span class="title function_">directQueue2</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Queue</span>(<span class="string">&quot;direct.queue2&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç»‘å®šé˜Ÿåˆ—å’Œäº¤æ¢æœº</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Binding <span class="title function_">bindingQueue2WithRed</span><span class="params">(Queue directQueue2, DirectExchange directExchange)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(directQueue2).to(directExchange).with(<span class="string">&quot;red&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç»‘å®šé˜Ÿåˆ—å’Œäº¤æ¢æœº</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Binding <span class="title function_">bindingQueue2WithYellow</span><span class="params">(Queue directQueue2, DirectExchange directExchange)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(directQueue2).to(directExchange).with(<span class="string">&quot;yellow&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-8-4-åŸºäºæ³¨è§£å£°æ˜">3.8.4.åŸºäºæ³¨è§£å£°æ˜</h3><p>åŸºäº@Beançš„æ–¹å¼å£°æ˜é˜Ÿåˆ—å’Œäº¤æ¢æœºæ¯”è¾ƒéº»çƒ¦ï¼ŒSpringè¿˜æä¾›äº†åŸºäºæ³¨è§£æ–¹å¼æ¥å£°æ˜ã€‚</p><p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬åŒæ ·å£°æ˜Directæ¨¡å¼çš„äº¤æ¢æœºå’Œé˜Ÿåˆ—ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RabbitListener(bindings = @QueueBinding(</span></span><br><span class="line"><span class="meta">    value = @Queue(name = &quot;direct.queue1&quot;),</span></span><br><span class="line"><span class="meta">    exchange = @Exchange(name = &quot;hmall.direct&quot;, type = ExchangeTypes.DIRECT),</span></span><br><span class="line"><span class="meta">    key = &#123;&quot;red&quot;, &quot;blue&quot;&#125;</span></span><br><span class="line"><span class="meta">))</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenDirectQueue1</span><span class="params">(String msg)</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;æ¶ˆè´¹è€…1æ¥æ”¶åˆ°direct.queue1çš„æ¶ˆæ¯ï¼šã€&quot;</span> + msg + <span class="string">&quot;ã€‘&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RabbitListener(bindings = @QueueBinding(</span></span><br><span class="line"><span class="meta">    value = @Queue(name = &quot;direct.queue2&quot;),</span></span><br><span class="line"><span class="meta">    exchange = @Exchange(name = &quot;hmall.direct&quot;, type = ExchangeTypes.DIRECT),</span></span><br><span class="line"><span class="meta">    key = &#123;&quot;red&quot;, &quot;yellow&quot;&#125;</span></span><br><span class="line"><span class="meta">))</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenDirectQueue2</span><span class="params">(String msg)</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;æ¶ˆè´¹è€…2æ¥æ”¶åˆ°direct.queue2çš„æ¶ˆæ¯ï¼šã€&quot;</span> + msg + <span class="string">&quot;ã€‘&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ˜¯ä¸æ˜¯ç®€å•å¤šäº†ã€‚</p><p>å†è¯•è¯•Topicæ¨¡å¼ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RabbitListener(bindings = @QueueBinding(</span></span><br><span class="line"><span class="meta">    value = @Queue(name = &quot;topic.queue1&quot;),</span></span><br><span class="line"><span class="meta">    exchange = @Exchange(name = &quot;hmall.topic&quot;, type = ExchangeTypes.TOPIC),</span></span><br><span class="line"><span class="meta">    key = &quot;china.#&quot;</span></span><br><span class="line"><span class="meta">))</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenTopicQueue1</span><span class="params">(String msg)</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;æ¶ˆè´¹è€…1æ¥æ”¶åˆ°topic.queue1çš„æ¶ˆæ¯ï¼šã€&quot;</span> + msg + <span class="string">&quot;ã€‘&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RabbitListener(bindings = @QueueBinding(</span></span><br><span class="line"><span class="meta">    value = @Queue(name = &quot;topic.queue2&quot;),</span></span><br><span class="line"><span class="meta">    exchange = @Exchange(name = &quot;hmall.topic&quot;, type = ExchangeTypes.TOPIC),</span></span><br><span class="line"><span class="meta">    key = &quot;#.news&quot;</span></span><br><span class="line"><span class="meta">))</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenTopicQueue2</span><span class="params">(String msg)</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;æ¶ˆè´¹è€…2æ¥æ”¶åˆ°topic.queue2çš„æ¶ˆæ¯ï¼šã€&quot;</span> + msg + <span class="string">&quot;ã€‘&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-9-æ¶ˆæ¯è½¬æ¢å™¨">3.9.æ¶ˆæ¯è½¬æ¢å™¨</h2><p>Springçš„æ¶ˆæ¯å‘é€ä»£ç æ¥æ”¶çš„æ¶ˆæ¯ä½“æ˜¯ä¸€ä¸ªObjectï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/AEDob0gXNozbGTxWbXGceQV3nAf-175603011395671.png" alt=""></p><p>è€Œåœ¨æ•°æ®ä¼ è¾“æ—¶ï¼Œå®ƒä¼šæŠŠä½ å‘é€çš„æ¶ˆæ¯åºåˆ—åŒ–ä¸ºå­—èŠ‚å‘é€ç»™MQï¼Œæ¥æ”¶æ¶ˆæ¯çš„æ—¶å€™ï¼Œè¿˜ä¼šæŠŠå­—èŠ‚ååºåˆ—åŒ–ä¸ºJavaå¯¹è±¡ã€‚</p><p>åªä¸è¿‡ï¼Œé»˜è®¤æƒ…å†µä¸‹Springé‡‡ç”¨çš„åºåˆ—åŒ–æ–¹å¼æ˜¯JDKåºåˆ—åŒ–ã€‚ä¼—æ‰€å‘¨çŸ¥ï¼ŒJDKåºåˆ—åŒ–å­˜åœ¨ä¸‹åˆ—é—®é¢˜ï¼š</p><ul><li><p>æ•°æ®ä½“ç§¯è¿‡å¤§</p></li><li><p>æœ‰å®‰å…¨æ¼æ´</p></li><li><p>å¯è¯»æ€§å·®</p></li></ul><p>æˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹ã€‚</p><h3 id="3-9-1-æµ‹è¯•é»˜è®¤è½¬æ¢å™¨">3.9.1.æµ‹è¯•é»˜è®¤è½¬æ¢å™¨</h3><p>1ï¼‰åˆ›å»ºæµ‹è¯•é˜Ÿåˆ—</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬åœ¨consumeræœåŠ¡ä¸­å£°æ˜ä¸€ä¸ªæ–°çš„é…ç½®ç±»ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/UZB0bgLppoZosXxtKvkc1ts6nMh-175603011395673.png" alt=""></p><p>åˆ©ç”¨@Beançš„æ–¹å¼åˆ›å»ºä¸€ä¸ªé˜Ÿåˆ—ï¼Œ</p><p>å…·ä½“ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.consumer.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.core.Queue;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MessageConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Queue <span class="title function_">objectQueue</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Queue</span>(<span class="string">&quot;object.queue&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œè¿™é‡Œæˆ‘ä»¬å…ˆä¸è¦ç»™è¿™ä¸ªé˜Ÿåˆ—æ·»åŠ æ¶ˆè´¹è€…ï¼Œæˆ‘ä»¬è¦æŸ¥çœ‹æ¶ˆæ¯ä½“çš„æ ¼å¼ã€‚</p><p>é‡å¯consumeræœåŠ¡ä»¥åï¼Œè¯¥é˜Ÿåˆ—å°±ä¼šè¢«è‡ªåŠ¨åˆ›å»ºå‡ºæ¥äº†ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/ROnHbyCujojbQ1xYIVlchnNznsh-175603011395674.png" alt=""></p><p>2ï¼‰å‘é€æ¶ˆæ¯</p><p>æˆ‘ä»¬åœ¨publisheræ¨¡å—çš„SpringAmqpTestä¸­æ–°å¢ä¸€ä¸ªæ¶ˆæ¯å‘é€çš„ä»£ç ï¼Œå‘é€ä¸€ä¸ªMapå¯¹è±¡ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSendMap</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    <span class="comment">// å‡†å¤‡æ¶ˆæ¯</span></span><br><span class="line">    Map&lt;String,Object&gt; msg = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    msg.put(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;æŸ³å²©&quot;</span>);</span><br><span class="line">    msg.put(<span class="string">&quot;age&quot;</span>, <span class="number">21</span>);</span><br><span class="line">    <span class="comment">// å‘é€æ¶ˆæ¯</span></span><br><span class="line">    rabbitTemplate.convertAndSend(<span class="string">&quot;object.queue&quot;</span>, msg);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å‘é€æ¶ˆæ¯åæŸ¥çœ‹æ§åˆ¶å°ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/QPu1bYlfHot8wmxXxp8cB9Qzn9d-175603011395675.png" alt=""></p><p>å¯ä»¥çœ‹åˆ°æ¶ˆæ¯æ ¼å¼éå¸¸ä¸å‹å¥½ã€‚</p><h3 id="3-9-2-é…ç½®JSONè½¬æ¢å™¨">3.9.2.é…ç½®JSONè½¬æ¢å™¨</h3><p>æ˜¾ç„¶ï¼ŒJDKåºåˆ—åŒ–æ–¹å¼å¹¶ä¸åˆé€‚ã€‚æˆ‘ä»¬å¸Œæœ›æ¶ˆæ¯ä½“çš„ä½“ç§¯æ›´å°ã€å¯è¯»æ€§æ›´é«˜ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨JSONæ–¹å¼æ¥åšåºåˆ—åŒ–å’Œååºåˆ—åŒ–ã€‚</p><p>åœ¨<code>publisher</code>å’Œ<code>consumer</code>ä¸¤ä¸ªæœåŠ¡ä¸­éƒ½å¼•å…¥ä¾èµ–ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.dataformat<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-dataformat-xml<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.10<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œå¦‚æœé¡¹ç›®ä¸­å¼•å…¥äº†<code>spring-boot-starter-web</code>ä¾èµ–ï¼Œåˆ™æ— éœ€å†æ¬¡å¼•å…¥<code>Jackson</code>ä¾èµ–ã€‚</p><p>é…ç½®æ¶ˆæ¯è½¬æ¢å™¨ï¼Œåœ¨<code>publisher</code>å’Œ<code>consumer</code>ä¸¤ä¸ªæœåŠ¡çš„å¯åŠ¨ç±»ä¸­æ·»åŠ ä¸€ä¸ªBeanå³å¯ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> MessageConverter <span class="title function_">messageConverter</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">// 1.å®šä¹‰æ¶ˆæ¯è½¬æ¢å™¨</span></span><br><span class="line">    <span class="type">Jackson2JsonMessageConverter</span> <span class="variable">jackson2JsonMessageConverter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Jackson2JsonMessageConverter</span>();</span><br><span class="line">    <span class="comment">// 2.é…ç½®è‡ªåŠ¨åˆ›å»ºæ¶ˆæ¯idï¼Œç”¨äºè¯†åˆ«ä¸åŒæ¶ˆæ¯ï¼Œä¹Ÿå¯ä»¥åœ¨ä¸šåŠ¡ä¸­åŸºäºIDåˆ¤æ–­æ˜¯å¦æ˜¯é‡å¤æ¶ˆæ¯</span></span><br><span class="line">    jackson2JsonMessageConverter.setCreateMessageIds(<span class="literal">true</span>);</span><br><span class="line">    <span class="keyword">return</span> jackson2JsonMessageConverter;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¶ˆæ¯è½¬æ¢å™¨ä¸­æ·»åŠ çš„messageIdå¯ä»¥ä¾¿äºæˆ‘ä»¬å°†æ¥åšå¹‚ç­‰æ€§åˆ¤æ–­ã€‚</p><p>æ­¤æ—¶ï¼Œæˆ‘ä»¬åˆ°MQæ§åˆ¶å°<strong>åˆ é™¤</strong><code>object.queue</code>ä¸­çš„æ—§çš„æ¶ˆæ¯ã€‚ç„¶åå†æ¬¡æ‰§è¡Œåˆšæ‰çš„æ¶ˆæ¯å‘é€çš„ä»£ç ï¼Œåˆ°MQçš„æ§åˆ¶å°æŸ¥çœ‹æ¶ˆæ¯ç»“æ„ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/AEhhb30KoosYHRxuAQIcHXUSnLh-175603011395677.png" alt=""></p><h3 id="3-9-3-æ¶ˆè´¹è€…æ¥æ”¶Object">3.9.3.æ¶ˆè´¹è€…æ¥æ”¶Object</h3><p>æˆ‘ä»¬åœ¨consumeræœåŠ¡ä¸­å®šä¹‰ä¸€ä¸ªæ–°çš„æ¶ˆè´¹è€…ï¼Œpublisheræ˜¯ç”¨Mapå‘é€ï¼Œé‚£ä¹ˆæ¶ˆè´¹è€…ä¹Ÿä¸€å®šè¦ç”¨Mapæ¥æ”¶ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RabbitListener(queues = &quot;object.queue&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenSimpleQueueMessage</span><span class="params">(Map&lt;String, Object&gt; msg)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;æ¶ˆè´¹è€…æ¥æ”¶åˆ°object.queueæ¶ˆæ¯ï¼šã€&quot;</span> + msg + <span class="string">&quot;ã€‘&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="4-ä¸šåŠ¡æ”¹é€ ">4.ä¸šåŠ¡æ”¹é€ </h1><p>æ¡ˆä¾‹éœ€æ±‚ï¼šæ”¹é€ ä½™é¢æ”¯ä»˜åŠŸèƒ½ï¼Œå°†æ”¯ä»˜æˆåŠŸååŸºäºOpenFeignçš„äº¤æ˜“æœåŠ¡çš„æ›´æ–°è®¢å•çŠ¶æ€æ¥å£çš„åŒæ­¥è°ƒç”¨ï¼Œæ”¹ä¸ºåŸºäºRabbitMQçš„å¼‚æ­¥é€šçŸ¥ã€‚</p><p>å¦‚å›¾ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/image-175603011395676.png" alt=""></p><p>è¯´æ˜ï¼šç›®å‰æ²¡æœ‰é€šçŸ¥æœåŠ¡å’Œç§¯åˆ†æœåŠ¡ï¼Œå› æ­¤æˆ‘ä»¬åªå…³æ³¨äº¤æ˜“æœåŠ¡ï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š</p><ul><li><p>å®šä¹‰<code>direct</code>ç±»å‹äº¤æ¢æœºï¼Œå‘½åä¸º<code>pay.direct</code></p></li><li><p>å®šä¹‰æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå‘½åä¸º<code>trade.pay.success.queue</code></p></li><li><p>å°†<code>trade.pay.success.queue</code>ä¸<code>pay.direct</code>ç»‘å®šï¼Œ<code>BindingKey</code>ä¸º<code>pay.success</code></p></li><li><p>æ”¯ä»˜æˆåŠŸæ—¶ä¸å†è°ƒç”¨äº¤æ˜“æœåŠ¡æ›´æ–°è®¢å•çŠ¶æ€çš„æ¥å£ï¼Œè€Œæ˜¯å‘é€ä¸€æ¡æ¶ˆæ¯åˆ°<code>pay.direct</code>ï¼Œå‘é€æ¶ˆæ¯çš„<code>RoutingKey</code>  ä¸º<code>pay.success</code>ï¼Œæ¶ˆæ¯å†…å®¹æ˜¯è®¢å•id</p></li><li><p>äº¤æ˜“æœåŠ¡ç›‘å¬<code>trade.pay.success.queue</code>é˜Ÿåˆ—ï¼Œæ¥æ”¶åˆ°æ¶ˆæ¯åæ›´æ–°è®¢å•çŠ¶æ€ä¸ºå·²æ”¯ä»˜</p></li></ul><h2 id="4-1-é…ç½®MQ">4.1.é…ç½®MQ</h2><p>ä¸ç®¡æ˜¯ç”Ÿäº§è€…è¿˜æ˜¯æ¶ˆè´¹è€…ï¼Œéƒ½éœ€è¦é…ç½®MQçš„åŸºæœ¬ä¿¡æ¯ã€‚åˆ†ä¸ºä¸¤æ­¥ï¼š</p><p>1ï¼‰æ·»åŠ ä¾èµ–ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--æ¶ˆæ¯å‘é€--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-amqp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>2ï¼‰é…ç½®MQåœ°å€ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">rabbitmq:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="number">192.168</span><span class="number">.150</span><span class="number">.101</span> <span class="comment"># ä½ çš„è™šæ‹ŸæœºIP</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">5672</span> <span class="comment"># ç«¯å£</span></span><br><span class="line">    <span class="attr">virtual-host:</span> <span class="string">/hmall</span> <span class="comment"># è™šæ‹Ÿä¸»æœº</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">hmall</span> <span class="comment"># ç”¨æˆ·å</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123</span> <span class="comment"># å¯†ç </span></span><br></pre></td></tr></table></figure><h2 id="4-2-æ¥æ”¶æ¶ˆæ¯">4.2.æ¥æ”¶æ¶ˆæ¯</h2><p>åœ¨trade-serviceæœåŠ¡ä¸­å®šä¹‰ä¸€ä¸ªæ¶ˆæ¯ç›‘å¬ç±»ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/S7RZbgUBMoqrTZxUXMicKsf3n9j-175603011395678.png" alt=""></p><p>å…¶ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hmall.trade.listener;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.hmall.trade.service.IOrderService;</span><br><span class="line"><span class="keyword">import</span> lombok.RequiredArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.core.ExchangeTypes;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.rabbit.annotation.Exchange;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.rabbit.annotation.Queue;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.rabbit.annotation.QueueBinding;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.rabbit.annotation.RabbitListener;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PayStatusListener</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> IOrderService orderService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RabbitListener(bindings = @QueueBinding(</span></span><br><span class="line"><span class="meta">            value = @Queue(name = &quot;trade.pay.success.queue&quot;, durable = &quot;true&quot;),</span></span><br><span class="line"><span class="meta">            exchange = @Exchange(name = &quot;pay.topic&quot;),</span></span><br><span class="line"><span class="meta">            key = &quot;pay.success&quot;</span></span><br><span class="line"><span class="meta">    ))</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenPaySuccess</span><span class="params">(Long orderId)</span>&#123;</span><br><span class="line">        orderService.markOrderPaySuccess(orderId);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4-3-å‘é€æ¶ˆæ¯">4.3.å‘é€æ¶ˆæ¯</h2><p>ä¿®æ”¹<code>pay-service</code>æœåŠ¡ä¸‹çš„<code>com.hmall.pay.service.impl.PayOrderServiceImpl</code>ç±»ä¸­çš„<code>tryPayOrderByBalance</code>æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> RabbitTemplate rabbitTemplate;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">tryPayOrderByBalance</span><span class="params">(PayOrderDTO payOrderDTO)</span> &#123;</span><br><span class="line">    <span class="comment">// 1.æŸ¥è¯¢æ”¯ä»˜å•</span></span><br><span class="line">    <span class="type">PayOrder</span> <span class="variable">po</span> <span class="operator">=</span> getById(payOrderDTO.getId());</span><br><span class="line">    <span class="comment">// 2.åˆ¤æ–­çŠ¶æ€</span></span><br><span class="line">    <span class="keyword">if</span>(!PayStatus.WAIT_BUYER_PAY.equalsValue(po.getStatus()))&#123;</span><br><span class="line">        <span class="comment">// è®¢å•ä¸æ˜¯æœªæ”¯ä»˜ï¼ŒçŠ¶æ€å¼‚å¸¸</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BizIllegalException</span>(<span class="string">&quot;äº¤æ˜“å·²æ”¯ä»˜æˆ–å…³é—­ï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 3.å°è¯•æ‰£å‡ä½™é¢</span></span><br><span class="line">    userClient.deductMoney(payOrderDTO.getPw(), po.getAmount());</span><br><span class="line">    <span class="comment">// 4.ä¿®æ”¹æ”¯ä»˜å•çŠ¶æ€</span></span><br><span class="line">    <span class="type">boolean</span> <span class="variable">success</span> <span class="operator">=</span> markPayOrderSuccess(payOrderDTO.getId(), LocalDateTime.now());</span><br><span class="line">    <span class="keyword">if</span> (!success) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BizIllegalException</span>(<span class="string">&quot;äº¤æ˜“å·²æ”¯ä»˜æˆ–å…³é—­ï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 5.ä¿®æ”¹è®¢å•çŠ¶æ€</span></span><br><span class="line">    <span class="comment">// tradeClient.markOrderPaySuccess(po.getBizOrderNo());</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        rabbitTemplate.convertAndSend(<span class="string">&quot;pay.direct&quot;</span>, <span class="string">&quot;pay.success&quot;</span>, po.getBizOrderNo());</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        log.error(<span class="string">&quot;æ”¯ä»˜æˆåŠŸçš„æ¶ˆæ¯å‘é€å¤±è´¥ï¼Œæ”¯ä»˜å•idï¼š&#123;&#125;ï¼Œ äº¤æ˜“å•idï¼š&#123;&#125;&quot;</span>, po.getId(), po.getBizOrderNo(), e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="5-ç»ƒä¹ ">5.ç»ƒä¹ </h1><h2 id="5-1-æŠ½å–å…±äº«çš„MQé…ç½®">5.1.æŠ½å–å…±äº«çš„MQé…ç½®</h2><p>å°†MQé…ç½®æŠ½å–åˆ°Nacosä¸­ç®¡ç†ï¼Œå¾®æœåŠ¡ä¸­ç›´æ¥ä½¿ç”¨å…±äº«é…ç½®ã€‚</p><h2 id="5-2-æ”¹é€ ä¸‹å•åŠŸèƒ½">5.2.æ”¹é€ ä¸‹å•åŠŸèƒ½</h2><p>æ”¹é€ ä¸‹å•åŠŸèƒ½ï¼Œå°†åŸºäºOpenFeignçš„æ¸…ç†è´­ç‰©è½¦åŒæ­¥è°ƒç”¨ï¼Œæ”¹ä¸ºåŸºäºRabbitMQçš„å¼‚æ­¥é€šçŸ¥ï¼š</p><ul><li><p>å®šä¹‰topicç±»å‹äº¤æ¢æœºï¼Œå‘½åä¸º<code>trade.topic</code></p></li><li><p>å®šä¹‰æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå‘½åä¸º<code>cart.clear.queue</code></p></li><li><p>å°†<code>cart.clear.queue</code>ä¸<code>trade.topic</code>ç»‘å®šï¼Œ<code>BindingKey</code>ä¸º<code>order.create</code></p></li><li><p>ä¸‹å•æˆåŠŸæ—¶ä¸å†è°ƒç”¨æ¸…ç†è´­ç‰©è½¦æ¥å£ï¼Œè€Œæ˜¯å‘é€ä¸€æ¡æ¶ˆæ¯åˆ°<code>trade.topic</code>ï¼Œå‘é€æ¶ˆæ¯çš„<code>RoutingKey</code>  ä¸º<code>order.create</code>ï¼Œæ¶ˆæ¯å†…å®¹æ˜¯ä¸‹å•çš„å…·ä½“å•†å“ã€å½“å‰ç™»å½•ç”¨æˆ·ä¿¡æ¯</p></li><li><p>è´­ç‰©è½¦æœåŠ¡ç›‘å¬<code>cart.clear.queue</code>é˜Ÿåˆ—ï¼Œæ¥æ”¶åˆ°æ¶ˆæ¯åæ¸…ç†æŒ‡å®šç”¨æˆ·çš„è´­ç‰©è½¦ä¸­çš„æŒ‡å®šå•†å“</p></li></ul><h2 id="5-3-ç™»å½•ä¿¡æ¯ä¼ é€’ä¼˜åŒ–">5.3.ç™»å½•ä¿¡æ¯ä¼ é€’ä¼˜åŒ–</h2><p>æŸäº›ä¸šåŠ¡ä¸­ï¼Œéœ€è¦æ ¹æ®ç™»å½•ç”¨æˆ·ä¿¡æ¯å¤„ç†ä¸šåŠ¡ï¼Œè€ŒåŸºäºMQçš„å¼‚æ­¥è°ƒç”¨å¹¶ä¸ä¼šä¼ é€’ç™»å½•ç”¨æˆ·ä¿¡æ¯ã€‚å‰é¢æˆ‘ä»¬çš„åšæ³•æ¯”è¾ƒéº»çƒ¦ï¼Œè‡³å°‘è¦åšä¸¤ä»¶äº‹ï¼š</p><ul><li><p>æ¶ˆæ¯å‘é€è€…åœ¨æ¶ˆæ¯ä½“ä¸­ä¼ é€’ç™»å½•ç”¨æˆ·</p></li><li><p>æ¶ˆè´¹è€…è·å–æ¶ˆæ¯ä½“ä¸­çš„ç™»å½•ç”¨æˆ·ï¼Œå¤„ç†ä¸šåŠ¡</p></li></ul><p>è¿™æ ·åšä¸ä»…éº»çƒ¦ï¼Œè€Œä¸”ç¼–ç¨‹ä½“éªŒä¹Ÿä¸ç»Ÿä¸€ï¼Œæ¯•ç«Ÿæˆ‘ä»¬ä¹‹å‰éƒ½æ˜¯ä½¿ç”¨UserContextæ¥è·å–ç”¨æˆ·ã€‚</p><p>å¤§å®¶æ€è€ƒä¸€ä¸‹ï¼šæœ‰æ²¡æœ‰æ›´ä¼˜é›…çš„åŠæ³•ä¼ è¾“ç™»å½•ç”¨æˆ·ä¿¡æ¯ï¼Œè®©ä½¿ç”¨MQçš„äººæ— æ„ŸçŸ¥ï¼Œä¾ç„¶é‡‡ç”¨UserContextæ¥éšæ—¶è·å–ç”¨æˆ·ã€‚</p><p>å‚è€ƒèµ„æ–™ï¼š</p><iframe src="https://docs.spring.io/spring-amqp/docs/2.4.14/reference/html/#post-processing" sandbox="allow-scripts allow-same-origin allow-presentation allow-forms allow-popups allow-downloads" allowfullscreen allow="encrypted-media; fullscreen; autoplay" referrerpolicy="strict-origin-when-cross-origin" frameborder="0" style="width: 100%; min-height: 461px; border-radius: 8px;"></iframe>]]></content>
    
    
    <summary type="html">MQåŸºç¡€çš„å­¦ä¹ è·¯çº¿ï¼ŒåŒ…æ‹¬MQçš„æ¦‚å¿µã€MQçš„åˆ†ç±»ã€MQçš„ä½¿ç”¨åœºæ™¯ã€MQçš„ä½¿ç”¨æ–¹å¼ç­‰ã€‚</summary>
    
    
    
    <category term="å­¦ä¹ ç¬”è®°" scheme="https://u7u7.top/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    
    <category term="å¾®æœåŠ¡" scheme="https://u7u7.top/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"/>
    
    <category term="Java" scheme="https://u7u7.top/tags/Java/"/>
    
    <category term="MQ" scheme="https://u7u7.top/tags/MQ/"/>
    
  </entry>
  
  <entry>
    <title></title>
    <link href="https://u7u7.top/posts/0.html"/>
    <id>https://u7u7.top/posts/0.html</id>
    <published>2025-08-13T08:33:07.880Z</published>
    <updated>2025-08-24T14:46:46.173Z</updated>
    
    <content type="html"><![CDATA[<p>å¯¹åº”Bç«™è§†é¢‘ï¼š</p><iframe src="https://player.bilibili.com/player.html?bvid=1S142197x7&p=85&vd_source=1ff0c1b434581723cf696ccc2f59ceaa" sandbox="allow-scripts allow-same-origin allow-presentation allow-forms allow-popups allow-downloads" allowfullscreen allow="encrypted-media; fullscreen; autoplay" referrerpolicy="strict-origin-when-cross-origin" frameborder="0" style="width: 100%; min-height: 292px; border-radius: 8px;"></iframe><p>å¾®æœåŠ¡ä¸€æ—¦æ‹†åˆ†ï¼Œå¿…ç„¶æ¶‰åŠåˆ°æœåŠ¡ä¹‹é—´çš„ç›¸äº’è°ƒç”¨ï¼Œç›®å‰æˆ‘ä»¬æœåŠ¡ä¹‹é—´è°ƒç”¨é‡‡ç”¨çš„éƒ½æ˜¯åŸºäºOpenFeignçš„è°ƒç”¨ã€‚è¿™ç§è°ƒç”¨ä¸­ï¼Œè°ƒç”¨è€…å‘èµ·è¯·æ±‚åéœ€è¦<strong>ç­‰å¾…</strong>æœåŠ¡æä¾›è€…æ‰§è¡Œä¸šåŠ¡è¿”å›ç»“æœåï¼Œæ‰èƒ½ç»§ç»­æ‰§è¡Œåé¢çš„ä¸šåŠ¡ã€‚ä¹Ÿå°±æ˜¯è¯´è°ƒç”¨è€…åœ¨è°ƒç”¨è¿‡ç¨‹ä¸­å¤„äºé˜»å¡çŠ¶æ€ï¼Œå› æ­¤æˆ‘ä»¬ç§°è¿™ç§è°ƒç”¨æ–¹å¼ä¸º<strong>åŒæ­¥è°ƒç”¨</strong>ï¼Œä¹Ÿå¯ä»¥å«<strong>åŒæ­¥é€šè®¯</strong>ã€‚ä½†åœ¨å¾ˆå¤šåœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦é‡‡ç”¨<strong>å¼‚æ­¥é€šè®¯</strong>çš„æ–¹å¼ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p><p>æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ä»€ä¹ˆæ˜¯åŒæ­¥é€šè®¯å’Œå¼‚æ­¥é€šè®¯ã€‚å¦‚å›¾ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/B82Sbxk3DoAsVTx7KV1cXjz3nsg-175603011396879.png" alt=""></p><p>è§£è¯»ï¼š</p><ul><li><p>åŒæ­¥é€šè®¯ï¼šå°±å¦‚åŒæ‰“è§†é¢‘ç”µè¯ï¼ŒåŒæ–¹çš„äº¤äº’éƒ½æ˜¯å®æ—¶çš„ã€‚å› æ­¤åŒä¸€æ—¶åˆ»ä½ åªèƒ½è·Ÿä¸€ä¸ªäººæ‰“è§†é¢‘ç”µè¯ã€‚</p></li><li><p>å¼‚æ­¥é€šè®¯ï¼šå°±å¦‚åŒå‘å¾®ä¿¡èŠå¤©ï¼ŒåŒæ–¹çš„äº¤äº’ä¸æ˜¯å®æ—¶çš„ï¼Œä½ ä¸éœ€è¦ç«‹åˆ»ç»™å¯¹æ–¹å›åº”ã€‚å› æ­¤ä½ å¯ä»¥å¤šçº¿æ“ä½œï¼ŒåŒæ—¶è·Ÿå¤šäººèŠå¤©ã€‚</p></li></ul><p>ä¸¤ç§æ–¹å¼å„æœ‰ä¼˜åŠ£ï¼Œæ‰“ç”µè¯å¯ä»¥ç«‹å³å¾—åˆ°å“åº”ï¼Œä½†æ˜¯ä½ å´ä¸èƒ½è·Ÿå¤šä¸ªäººåŒæ—¶é€šè¯ã€‚å‘å¾®ä¿¡å¯ä»¥åŒæ—¶ä¸å¤šä¸ªäººæ”¶å‘å¾®ä¿¡ï¼Œä½†æ˜¯å¾€å¾€å“åº”ä¼šæœ‰å»¶è¿Ÿã€‚</p><p>æ‰€ä»¥ï¼Œå¦‚æœæˆ‘ä»¬çš„ä¸šåŠ¡éœ€è¦å®æ—¶å¾—åˆ°æœåŠ¡æä¾›æ–¹çš„å“åº”ï¼Œåˆ™åº”è¯¥é€‰æ‹©åŒæ­¥é€šè®¯ï¼ˆåŒæ­¥è°ƒç”¨ï¼‰ã€‚è€Œå¦‚æœæˆ‘ä»¬è¿½æ±‚æ›´é«˜çš„æ•ˆç‡ï¼Œå¹¶ä¸”ä¸éœ€è¦å®æ—¶å“åº”ï¼Œåˆ™åº”è¯¥é€‰æ‹©å¼‚æ­¥é€šè®¯ï¼ˆå¼‚æ­¥è°ƒç”¨ï¼‰ã€‚<br> </p><p>åŒæ­¥è°ƒç”¨çš„æ–¹å¼æˆ‘ä»¬å·²ç»å­¦è¿‡äº†ï¼Œä¹‹å‰çš„OpenFeignè°ƒç”¨å°±æ˜¯ã€‚ä½†æ˜¯ï¼š</p><ul><li><p>å¼‚æ­¥è°ƒç”¨åˆè¯¥å¦‚ä½•å®ç°ï¼Ÿ</p></li><li><p>å“ªäº›ä¸šåŠ¡é€‚åˆç”¨å¼‚æ­¥è°ƒç”¨æ¥å®ç°å‘¢ï¼Ÿ</p></li></ul><p>é€šè¿‡ä»Šå¤©çš„å­¦ä¹ ä½ å°±èƒ½æ˜ç™½è¿™äº›é—®é¢˜äº†ã€‚</p><h1 id="1-åˆè¯†MQ">1.åˆè¯†MQ</h1><h2 id="1-1-åŒæ­¥è°ƒç”¨">1.1.åŒæ­¥è°ƒç”¨</h2><p>ä¹‹å‰è¯´è¿‡ï¼Œæˆ‘ä»¬ç°åœ¨åŸºäºOpenFeignçš„è°ƒç”¨éƒ½å±äºæ˜¯åŒæ­¥è°ƒç”¨ï¼Œé‚£ä¹ˆè¿™ç§æ–¹å¼å­˜åœ¨å“ªäº›é—®é¢˜å‘¢ï¼Ÿ</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬ä»¥æ˜¨å¤©ç•™ç»™å¤§å®¶ä½œä¸ºä½œä¸šçš„<strong>ä½™é¢æ”¯ä»˜åŠŸèƒ½</strong>ä¸ºä¾‹æ¥åˆ†æï¼Œé¦–å…ˆçœ‹ä¸‹æ•´ä¸ªæµç¨‹ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/diagram.png" alt=""></p><p>ç›®å‰æˆ‘ä»¬é‡‡ç”¨çš„æ˜¯åŸºäºOpenFeignçš„åŒæ­¥è°ƒç”¨ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸šåŠ¡æ‰§è¡Œæµç¨‹æ˜¯è¿™æ ·çš„ï¼š</p><ul><li><p>æ”¯ä»˜æœåŠ¡éœ€è¦å…ˆè°ƒç”¨ç”¨æˆ·æœåŠ¡å®Œæˆä½™é¢æ‰£å‡</p></li><li><p>ç„¶åæ”¯ä»˜æœåŠ¡è‡ªå·±è¦æ›´æ–°æ”¯ä»˜æµæ°´å•çš„çŠ¶æ€</p></li><li><p>ç„¶åæ”¯ä»˜æœåŠ¡è°ƒç”¨äº¤æ˜“æœåŠ¡ï¼Œæ›´æ–°ä¸šåŠ¡è®¢å•çŠ¶æ€ä¸ºå·²æ”¯ä»˜</p></li></ul><p>ä¸‰ä¸ªæ­¥éª¤ä¾æ¬¡æ‰§è¡Œã€‚</p><p>è¿™å…¶ä¸­å°±å­˜åœ¨3ä¸ªé—®é¢˜ï¼š</p><p><strong>ç¬¬ä¸€</strong>ï¼Œ<strong>æ‹“å±•æ€§å·®</strong></p><p>æˆ‘ä»¬ç›®å‰çš„ä¸šåŠ¡ç›¸å¯¹ç®€å•ï¼Œä½†æ˜¯éšç€ä¸šåŠ¡è§„æ¨¡æ‰©å¤§ï¼Œäº§å“çš„åŠŸèƒ½ä¹Ÿåœ¨ä¸æ–­å®Œå–„ã€‚</p><p>åœ¨å¤§å¤šæ•°ç”µå•†ä¸šåŠ¡ä¸­ï¼Œç”¨æˆ·æ”¯ä»˜æˆåŠŸåéƒ½ä¼šä»¥çŸ­ä¿¡æˆ–è€…å…¶å®ƒæ–¹å¼é€šçŸ¥ç”¨æˆ·ï¼Œå‘ŠçŸ¥æ”¯ä»˜æˆåŠŸã€‚å‡å¦‚åæœŸäº§å“ç»ç†æå‡ºè¿™æ ·æ–°çš„éœ€æ±‚ï¼Œä½ æ€ä¹ˆåŠï¼Ÿæ˜¯ä¸æ˜¯è¦åœ¨ä¸Šè¿°ä¸šåŠ¡ä¸­å†åŠ å…¥é€šçŸ¥ç”¨æˆ·çš„ä¸šåŠ¡ï¼Ÿ</p><p>æŸäº›ç”µå•†é¡¹ç›®ä¸­ï¼Œè¿˜ä¼šæœ‰ç§¯åˆ†æˆ–é‡‘å¸çš„æ¦‚å¿µã€‚å‡å¦‚äº§å“ç»ç†æå‡ºéœ€æ±‚ï¼Œç”¨æˆ·æ”¯ä»˜æˆåŠŸåï¼Œç»™ç”¨æˆ·ä»¥ç§¯åˆ†å¥–åŠ±æˆ–è€…è¿”è¿˜é‡‘å¸ï¼Œä½ æ€ä¹ˆåŠï¼Ÿæ˜¯ä¸æ˜¯è¦åœ¨ä¸Šè¿°ä¸šåŠ¡ä¸­å†åŠ å…¥ç§¯åˆ†ä¸šåŠ¡ã€è¿”è¿˜é‡‘å¸ä¸šåŠ¡ï¼Ÿ</p><p>ã€‚ã€‚ã€‚</p><p>æœ€ç»ˆä½ çš„æ”¯ä»˜ä¸šåŠ¡ä¼šè¶Šæ¥è¶Šè‡ƒè‚¿ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/diagram-1.png" alt=""></p><p>ä¹Ÿå°±æ˜¯è¯´æ¯æ¬¡æœ‰æ–°çš„éœ€æ±‚ï¼Œç°æœ‰æ”¯ä»˜é€»è¾‘éƒ½è¦è·Ÿç€å˜åŒ–ï¼Œä»£ç ç»å¸¸å˜åŠ¨ï¼Œä¸ç¬¦åˆå¼€é—­åŸåˆ™ï¼Œæ‹“å±•æ€§ä¸å¥½ã€‚</p><p><strong>ç¬¬äºŒ</strong>ï¼Œ<strong>æ€§èƒ½ä¸‹é™</strong></p><p>ç”±äºæˆ‘ä»¬é‡‡ç”¨äº†åŒæ­¥è°ƒç”¨ï¼Œè°ƒç”¨è€…éœ€è¦ç­‰å¾…æœåŠ¡æä¾›è€…æ‰§è¡Œå®Œè¿”å›ç»“æœåï¼Œæ‰èƒ½ç»§ç»­å‘ä¸‹æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯è¯´æ¯æ¬¡è¿œç¨‹è°ƒç”¨ï¼Œè°ƒç”¨è€…éƒ½æ˜¯é˜»å¡ç­‰å¾…çŠ¶æ€ã€‚æœ€ç»ˆæ•´ä¸ªä¸šåŠ¡çš„å“åº”æ—¶é•¿å°±æ˜¯æ¯æ¬¡è¿œç¨‹è°ƒç”¨çš„æ‰§è¡Œæ—¶é•¿ä¹‹å’Œï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/diagram-2.png" alt=""></p><p>å‡å¦‚æ¯ä¸ªå¾®æœåŠ¡çš„æ‰§è¡Œæ—¶é•¿éƒ½æ˜¯50msï¼Œåˆ™æœ€ç»ˆæ•´ä¸ªä¸šåŠ¡çš„è€—æ—¶å¯èƒ½é«˜è¾¾300msï¼Œæ€§èƒ½å¤ªå·®äº†ã€‚</p><p><strong>ç¬¬ä¸‰ï¼Œçº§è”å¤±è´¥</strong></p><p>ç”±äºæˆ‘ä»¬æ˜¯åŸºäºOpenFeignè°ƒç”¨äº¤æ˜“æœåŠ¡ã€é€šçŸ¥æœåŠ¡ã€‚å½“äº¤æ˜“æœåŠ¡ã€é€šçŸ¥æœåŠ¡å‡ºç°æ•…éšœæ—¶ï¼Œæ•´ä¸ªäº‹åŠ¡éƒ½ä¼šå›æ»šï¼Œäº¤æ˜“å¤±è´¥ã€‚</p><p>è¿™å…¶å®å°±æ˜¯åŒæ­¥è°ƒç”¨çš„<strong>çº§è”å¤±è´¥</strong>é—®é¢˜ã€‚</p><p>ä½†æ˜¯å¤§å®¶æ€è€ƒä¸€ä¸‹ï¼Œæˆ‘ä»¬å‡è®¾ç”¨æˆ·ä½™é¢å……è¶³ï¼Œæ‰£æ¬¾å·²ç»æˆåŠŸï¼Œæ­¤æ—¶æˆ‘ä»¬åº”è¯¥ç¡®ä¿æ”¯ä»˜æµæ°´å•æ›´æ–°ä¸ºå·²æ”¯ä»˜ï¼Œç¡®ä¿äº¤æ˜“æˆåŠŸã€‚æ¯•ç«Ÿæ”¶åˆ°æ‰‹é‡Œçš„é’±æ²¡é“ç†å†é€€å›å»å§ã€‚</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/CSCWbPDPvo6OVux4ZKecjLVFnsd.png" alt=""></p><p>å› æ­¤ï¼Œè¿™é‡Œä¸èƒ½å› ä¸ºçŸ­ä¿¡é€šçŸ¥ã€æ›´æ–°è®¢å•çŠ¶æ€å¤±è´¥è€Œå›æ»šæ•´ä¸ªäº‹åŠ¡ã€‚</p><p>ç»¼ä¸Šï¼ŒåŒæ­¥è°ƒç”¨çš„æ–¹å¼å­˜åœ¨ä¸‹åˆ—é—®é¢˜ï¼š</p><ul><li><p>æ‹“å±•æ€§å·®</p></li><li><p>æ€§èƒ½ä¸‹é™</p></li><li><p>çº§è”å¤±è´¥</p></li></ul><p>è€Œè¦è§£å†³è¿™äº›é—®é¢˜ï¼Œæˆ‘ä»¬å°±å¿…é¡»ç”¨<strong>å¼‚æ­¥è°ƒç”¨</strong>çš„æ–¹å¼æ¥ä»£æ›¿<strong>åŒæ­¥è°ƒç”¨</strong>ã€‚</p><h2 id="1-2-å¼‚æ­¥è°ƒç”¨">1.2.å¼‚æ­¥è°ƒç”¨</h2><p>å¼‚æ­¥è°ƒç”¨æ–¹å¼å…¶å®å°±æ˜¯åŸºäºæ¶ˆæ¯é€šçŸ¥çš„æ–¹å¼ï¼Œä¸€èˆ¬åŒ…å«ä¸‰ä¸ªè§’è‰²ï¼š</p><ul><li><p>æ¶ˆæ¯å‘é€è€…ï¼šæŠ•é€’æ¶ˆæ¯çš„äººï¼Œå°±æ˜¯åŸæ¥çš„è°ƒç”¨æ–¹</p></li><li><p>æ¶ˆæ¯Brokerï¼šç®¡ç†ã€æš‚å­˜ã€è½¬å‘æ¶ˆæ¯ï¼Œä½ å¯ä»¥æŠŠå®ƒç†è§£æˆå¾®ä¿¡æœåŠ¡å™¨</p></li><li><p>æ¶ˆæ¯æ¥æ”¶è€…ï¼šæ¥æ”¶å’Œå¤„ç†æ¶ˆæ¯çš„äººï¼Œå°±æ˜¯åŸæ¥çš„æœåŠ¡æä¾›æ–¹</p></li></ul><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/diagram-3.png" alt=""></p><p>åœ¨å¼‚æ­¥è°ƒç”¨ä¸­ï¼Œå‘é€è€…ä¸å†ç›´æ¥åŒæ­¥è°ƒç”¨æ¥æ”¶è€…çš„ä¸šåŠ¡æ¥å£ï¼Œè€Œæ˜¯å‘é€ä¸€æ¡æ¶ˆæ¯æŠ•é€’ç»™æ¶ˆæ¯Brokerã€‚ç„¶åæ¥æ”¶è€…æ ¹æ®è‡ªå·±çš„éœ€æ±‚ä»æ¶ˆæ¯Brokeré‚£é‡Œè®¢é˜…æ¶ˆæ¯ã€‚æ¯å½“å‘é€æ–¹å‘é€æ¶ˆæ¯åï¼Œæ¥å—è€…éƒ½èƒ½è·å–æ¶ˆæ¯å¹¶å¤„ç†ã€‚</p><p>è¿™æ ·ï¼Œå‘é€æ¶ˆæ¯çš„äººå’Œæ¥æ”¶æ¶ˆæ¯çš„äººå°±å®Œå…¨è§£è€¦äº†ã€‚</p><p>è¿˜æ˜¯ä»¥ä½™é¢æ”¯ä»˜ä¸šåŠ¡ä¸ºä¾‹ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/diagram-4.png" alt=""></p><p>é™¤äº†æ‰£å‡ä½™é¢ã€æ›´æ–°æ”¯ä»˜æµæ°´å•çŠ¶æ€ä»¥å¤–ï¼Œå…¶å®ƒè°ƒç”¨é€»è¾‘å…¨éƒ¨å–æ¶ˆã€‚è€Œæ˜¯æ”¹ä¸ºå‘é€ä¸€æ¡æ¶ˆæ¯åˆ°Brokerã€‚è€Œç›¸å…³çš„å¾®æœåŠ¡éƒ½å¯ä»¥è®¢é˜…æ¶ˆæ¯é€šçŸ¥ï¼Œä¸€æ—¦æ¶ˆæ¯åˆ°è¾¾Brokerï¼Œåˆ™ä¼šåˆ†å‘ç»™æ¯ä¸€ä¸ªè®¢é˜…äº†çš„å¾®æœåŠ¡ï¼Œå¤„ç†å„è‡ªçš„ä¸šåŠ¡ã€‚</p><p>å‡å¦‚äº§å“ç»ç†æå‡ºäº†æ–°çš„éœ€æ±‚ï¼Œæ¯”å¦‚è¦åœ¨æ”¯ä»˜æˆåŠŸåæ›´æ–°ç”¨æˆ·ç§¯åˆ†ã€‚æ”¯ä»˜ä»£ç å®Œå…¨ä¸ç”¨å˜æ›´ï¼Œè€Œä»…ä»…æ˜¯è®©ç§¯åˆ†æœåŠ¡ä¹Ÿè®¢é˜…æ¶ˆæ¯å³å¯ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/diagram-5.png" alt=""></p><p>ä¸ç®¡åæœŸå¢åŠ äº†å¤šå°‘æ¶ˆæ¯è®¢é˜…è€…ï¼Œä½œä¸ºæ”¯ä»˜æœåŠ¡æ¥è®²ï¼Œæ‰§è¡Œé—®æ‰£å‡ä½™é¢ã€æ›´æ–°æ”¯ä»˜æµæ°´çŠ¶æ€åï¼Œå‘é€æ¶ˆæ¯å³å¯ã€‚ä¸šåŠ¡è€—æ—¶ä»…ä»…æ˜¯è¿™ä¸‰éƒ¨åˆ†ä¸šåŠ¡è€—æ—¶ï¼Œä»…ä»…100msï¼Œå¤§å¤§æé«˜äº†ä¸šåŠ¡æ€§èƒ½ã€‚</p><p>å¦å¤–ï¼Œä¸ç®¡æ˜¯äº¤æ˜“æœåŠ¡ã€é€šçŸ¥æœåŠ¡ï¼Œè¿˜æ˜¯ç§¯åˆ†æœåŠ¡ï¼Œä»–ä»¬çš„ä¸šåŠ¡ä¸æ”¯ä»˜å…³è”åº¦ä½ã€‚ç°åœ¨é‡‡ç”¨äº†å¼‚æ­¥è°ƒç”¨ï¼Œè§£é™¤äº†è€¦åˆï¼Œä»–ä»¬å³ä¾¿æ‰§è¡Œè¿‡ç¨‹ä¸­å‡ºç°äº†æ•…éšœï¼Œä¹Ÿä¸ä¼šå½±å“åˆ°æ”¯ä»˜æœåŠ¡ã€‚</p><p>ç»¼ä¸Šï¼Œå¼‚æ­¥è°ƒç”¨çš„ä¼˜åŠ¿åŒ…æ‹¬ï¼š</p><ul><li><p>è€¦åˆåº¦æ›´ä½</p></li><li><p>æ€§èƒ½æ›´å¥½</p></li><li><p>ä¸šåŠ¡æ‹“å±•æ€§å¼º</p></li><li><p>æ•…éšœéš”ç¦»ï¼Œé¿å…çº§è”å¤±è´¥</p></li></ul><p>å½“ç„¶ï¼Œå¼‚æ­¥é€šä¿¡ä¹Ÿå¹¶éå®Œç¾æ— ç¼ºï¼Œå®ƒå­˜åœ¨ä¸‹åˆ—ç¼ºç‚¹ï¼š</p><ul><li><p>å®Œå…¨ä¾èµ–äºBrokerçš„å¯é æ€§ã€å®‰å…¨æ€§å’Œæ€§èƒ½</p></li><li><p>æ¶æ„å¤æ‚ï¼ŒåæœŸç»´æŠ¤å’Œè°ƒè¯•éº»çƒ¦</p></li></ul><h2 id="1-3-æŠ€æœ¯é€‰å‹">1.3.æŠ€æœ¯é€‰å‹</h2><p>æ¶ˆæ¯Brokerï¼Œç›®å‰å¸¸è§çš„å®ç°æ–¹æ¡ˆå°±æ˜¯æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆMessageQueueï¼‰ï¼Œç®€ç§°ä¸ºMQ.</p><p>ç›®æ¯”è¾ƒå¸¸è§çš„MQå®ç°ï¼š</p><ul><li><p>ActiveMQ</p></li><li><p>RabbitMQ</p></li><li><p>RocketMQ</p></li><li><p>Kafka</p></li></ul><p>å‡ ç§å¸¸è§MQçš„å¯¹æ¯”ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/d8e1c874b5db80e3913a404a2cb59a89.jpeg" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>è¿½æ±‚å¯ç”¨æ€§ï¼šKafkaã€ RocketMQ ã€RabbitMQ</p><p>è¿½æ±‚å¯é æ€§ï¼šRabbitMQã€RocketMQ</p><p>è¿½æ±‚ååèƒ½åŠ›ï¼šRocketMQã€Kafka</p><p>è¿½æ±‚æ¶ˆæ¯ä½å»¶è¿Ÿï¼šRabbitMQã€Kafka</p><p>æ®ç»Ÿè®¡ï¼Œç›®å‰å›½å†…æ¶ˆæ¯é˜Ÿåˆ—ä½¿ç”¨æœ€å¤šçš„è¿˜æ˜¯RabbitMQï¼Œå†åŠ ä¸Šå…¶å„æ–¹é¢éƒ½æ¯”è¾ƒå‡è¡¡ï¼Œç¨³å®šæ€§ä¹Ÿå¥½ï¼Œå› æ­¤æˆ‘ä»¬è¯¾å ‚ä¸Šé€‰æ‹©RabbitMQæ¥å­¦ä¹ ã€‚</p><h1 id="2-RabbitMQ">2.RabbitMQ</h1><p>RabbitMQæ˜¯åŸºäºErlangè¯­è¨€å¼€å‘çš„å¼€æºæ¶ˆæ¯é€šä¿¡ä¸­é—´ä»¶ï¼Œå®˜ç½‘åœ°å€ï¼š</p><p><a href="https://www.rabbitmq.com/">https://www.rabbitmq.com/</a></p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±å­¦ä¹ å®ƒçš„åŸºæœ¬æ¦‚å¿µå’ŒåŸºç¡€ç”¨æ³•ã€‚</p><h2 id="2-1-å®‰è£…">2.1.å®‰è£…</h2><p>æˆ‘ä»¬åŒæ ·åŸºäºDockeræ¥å®‰è£…RabbitMQï¼Œä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤å³å¯ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">docker run \</span><br><span class="line"> -e RABBITMQ_DEFAULT_USER=itheima \</span><br><span class="line"> -e RABBITMQ_DEFAULT_PASS=123321 \</span><br><span class="line"> -v mq-plugins:/plugins \</span><br><span class="line"> --name mq \</span><br><span class="line"> --hostname mq \</span><br><span class="line"> -p 15672:15672 \</span><br><span class="line"> -p 5672:5672 \</span><br><span class="line"> --network hm-net\</span><br><span class="line"> -d \</span><br><span class="line"> rabbitmq:3.8-management</span><br></pre></td></tr></table></figure><p>å¦‚æœæ‹‰å–é•œåƒå›°éš¾çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨è¯¾å‰èµ„æ–™ç»™å¤§å®¶å‡†å¤‡çš„é•œåƒï¼Œåˆ©ç”¨docker loadå‘½ä»¤åŠ è½½ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/KWDWbLtlfodeGBxOs94c3JFdn9g.png" alt=""></p><p>å¯ä»¥çœ‹åˆ°åœ¨å®‰è£…å‘½ä»¤ä¸­æœ‰ä¸¤ä¸ªæ˜ å°„çš„ç«¯å£ï¼š</p><ul><li><p>15672ï¼šRabbitMQæä¾›çš„ç®¡ç†æ§åˆ¶å°çš„ç«¯å£</p></li><li><p>5672ï¼šRabbitMQçš„æ¶ˆæ¯å‘é€å¤„ç†æ¥å£</p></li></ul><p>å®‰è£…å®Œæˆåï¼Œæˆ‘ä»¬è®¿é—® http://192.168.150.101:15672å³å¯çœ‹åˆ°ç®¡ç†æ§åˆ¶å°ã€‚é¦–æ¬¡è®¿é—®éœ€è¦ç™»å½•ï¼Œé»˜è®¤çš„ç”¨æˆ·åå’Œå¯†ç åœ¨é…ç½®æ–‡ä»¶ä¸­å·²ç»æŒ‡å®šäº†ã€‚</p><p>ç™»å½•åå³å¯çœ‹åˆ°ç®¡ç†æ§åˆ¶å°æ€»è§ˆé¡µé¢ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/YNs9bu47Vo3o1gxnEw1cI9MxnUM.png" alt=""></p><p>RabbitMQå¯¹åº”çš„æ¶æ„å¦‚å›¾ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/HH6fbYlGsoySg1x34UBczqjZnSb.png" alt=""></p><p>å…¶ä¸­åŒ…å«å‡ ä¸ªæ¦‚å¿µï¼š</p><ul><li><p><strong><code>publisher</code></strong>ï¼šç”Ÿäº§è€…ï¼Œä¹Ÿå°±æ˜¯å‘é€æ¶ˆæ¯çš„ä¸€æ–¹</p></li><li><p><strong><code>consumer</code></strong>ï¼šæ¶ˆè´¹è€…ï¼Œä¹Ÿå°±æ˜¯æ¶ˆè´¹æ¶ˆæ¯çš„ä¸€æ–¹</p></li><li><p><strong><code>queue</code></strong>ï¼šé˜Ÿåˆ—ï¼Œå­˜å‚¨æ¶ˆæ¯ã€‚ç”Ÿäº§è€…æŠ•é€’çš„æ¶ˆæ¯ä¼šæš‚å­˜åœ¨æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œç­‰å¾…æ¶ˆè´¹è€…å¤„ç†</p></li><li><p><strong><code>exchange</code></strong>ï¼šäº¤æ¢æœºï¼Œè´Ÿè´£æ¶ˆæ¯è·¯ç”±ã€‚ç”Ÿäº§è€…å‘é€çš„æ¶ˆæ¯ç”±äº¤æ¢æœºå†³å®šæŠ•é€’åˆ°å“ªä¸ªé˜Ÿåˆ—ã€‚</p></li><li><p><strong><code>virtual host</code></strong>ï¼šè™šæ‹Ÿä¸»æœºï¼Œèµ·åˆ°æ•°æ®éš”ç¦»çš„ä½œç”¨ã€‚æ¯ä¸ªè™šæ‹Ÿä¸»æœºç›¸äº’ç‹¬ç«‹ï¼Œæœ‰å„è‡ªçš„exchangeã€queue</p></li></ul><p>ä¸Šè¿°è¿™äº›ä¸œè¥¿éƒ½å¯ä»¥åœ¨RabbitMQçš„ç®¡ç†æ§åˆ¶å°æ¥ç®¡ç†ï¼Œä¸‹ä¸€èŠ‚æˆ‘ä»¬å°±ä¸€èµ·æ¥å­¦ä¹ æ§åˆ¶å°çš„ä½¿ç”¨ã€‚</p><h2 id="2-2-æ”¶å‘æ¶ˆæ¯">2.2.æ”¶å‘æ¶ˆæ¯</h2><h3 id="2-2-1-äº¤æ¢æœº">2.2.1.äº¤æ¢æœº</h3><p>æˆ‘ä»¬æ‰“å¼€Exchangesé€‰é¡¹å¡ï¼Œå¯ä»¥çœ‹åˆ°å·²ç»å­˜åœ¨å¾ˆå¤šäº¤æ¢æœºï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/Dc0VbMHYwoBM1ZxLdRtcAJTZnGc.png" alt=""></p><p>æˆ‘ä»¬ç‚¹å‡»ä»»æ„äº¤æ¢æœºï¼Œå³å¯è¿›å…¥äº¤æ¢æœºè¯¦æƒ…é¡µé¢ã€‚ä»ç„¶ä¼šåˆ©ç”¨æ§åˆ¶å°ä¸­çš„publish message å‘é€ä¸€æ¡æ¶ˆæ¯ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/TMlKboOgZom7Y7xfJ9CccgPdnNh.png" alt=""></p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/BTUkbvuDVo29JDx9YURcYjhFnPc.png" alt=""></p><p>è¿™é‡Œæ˜¯ç”±æ§åˆ¶å°æ¨¡æ‹Ÿäº†ç”Ÿäº§è€…å‘é€çš„æ¶ˆæ¯ã€‚ç”±äºæ²¡æœ‰æ¶ˆè´¹è€…å­˜åœ¨ï¼Œæœ€ç»ˆæ¶ˆæ¯ä¸¢å¤±äº†ï¼Œè¿™æ ·è¯´æ˜äº¤æ¢æœºæ²¡æœ‰å­˜å‚¨æ¶ˆæ¯çš„èƒ½åŠ›ã€‚</p><h3 id="2-2-2-é˜Ÿåˆ—">2.2.2.é˜Ÿåˆ—</h3><p>æˆ‘ä»¬æ‰“å¼€<code>Queues</code>é€‰é¡¹å¡ï¼Œæ–°å»ºä¸€ä¸ªé˜Ÿåˆ—ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/GvVobsp7uoSxfox0c0gcU14dnSc.png" alt=""></p><p>å‘½åä¸º<code>hello.queue1</code>ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/Ew31bOIBoo18dRxIFubcJva0nXf.png" alt=""></p><p>å†ä»¥ç›¸åŒçš„æ–¹å¼ï¼Œåˆ›å»ºä¸€ä¸ªé˜Ÿåˆ—ï¼Œå¯†ç ä¸º<code>hello.queue2</code>ï¼Œæœ€ç»ˆé˜Ÿåˆ—åˆ—è¡¨å¦‚ä¸‹ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/SmOobtVzSou586xV1a9cF11tn5d.png" alt=""></p><p>æ­¤æ—¶ï¼Œæˆ‘ä»¬å†æ¬¡å‘<code>amq.fanout</code>äº¤æ¢æœºå‘é€ä¸€æ¡æ¶ˆæ¯ã€‚ä¼šå‘ç°æ¶ˆæ¯ä¾ç„¶æ²¡æœ‰åˆ°è¾¾é˜Ÿåˆ—ï¼ï¼</p><p>æ€ä¹ˆå›äº‹å‘¢ï¼Ÿ</p><p>å‘é€åˆ°äº¤æ¢æœºçš„æ¶ˆæ¯ï¼Œåªä¼šè·¯ç”±åˆ°ä¸å…¶ç»‘å®šçš„é˜Ÿåˆ—ï¼Œå› æ­¤ä»…ä»…åˆ›å»ºé˜Ÿåˆ—æ˜¯ä¸å¤Ÿçš„ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å°†å…¶ä¸äº¤æ¢æœºç»‘å®šã€‚</p><h3 id="2-2-3-ç»‘å®šå…³ç³»">2.2.3.ç»‘å®šå…³ç³»</h3><p>ç‚¹å‡»<code>Exchanges</code>é€‰é¡¹å¡ï¼Œç‚¹å‡»<code>amq.fanout</code>äº¤æ¢æœºï¼Œè¿›å…¥äº¤æ¢æœºè¯¦æƒ…é¡µï¼Œç„¶åç‚¹å‡»<code>Bindings</code>èœå•ï¼Œåœ¨è¡¨å•ä¸­å¡«å†™è¦ç»‘å®šçš„é˜Ÿåˆ—åç§°ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/HZ2fbpinhoLs4AxqzudcTrSdnWD.png" alt=""></p><p>ç›¸åŒçš„æ–¹å¼ï¼Œå°†hello.queue2ä¹Ÿç»‘å®šåˆ°æ”¹äº¤æ¢æœºã€‚</p><p>æœ€ç»ˆï¼Œç»‘å®šç»“æœå¦‚ä¸‹ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/WFcXbuLVzoa4NxxmZrycHEs8nwh.png" alt=""></p><h3 id="2-2-4-å‘é€æ¶ˆæ¯">2.2.4.å‘é€æ¶ˆæ¯</h3><p>å†æ¬¡å›åˆ°exchangeé¡µé¢ï¼Œæ‰¾åˆ°åˆšåˆšç»‘å®šçš„<code>amq.fanout</code>ï¼Œç‚¹å‡»è¿›å…¥è¯¦æƒ…é¡µï¼Œå†æ¬¡å‘é€ä¸€æ¡æ¶ˆæ¯ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/HzIWbJaR2oGiqwxypvocuQfYn0e.png" alt=""></p><p>å›åˆ°<code>Queues</code>é¡µé¢ï¼Œå¯ä»¥å‘ç°<code>hello.queue</code>ä¸­å·²ç»æœ‰ä¸€æ¡æ¶ˆæ¯äº†ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/ZROjbesEYoIkqcxLYM2cl3lcnZf.png" alt=""></p><p>ç‚¹å‡»é˜Ÿåˆ—åç§°ï¼Œè¿›å…¥è¯¦æƒ…é¡µï¼ŒæŸ¥çœ‹é˜Ÿåˆ—è¯¦æƒ…ï¼Œè¿™æ¬¡æˆ‘ä»¬ç‚¹å‡»get messageï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/XaPeboPQVovkH6xM453cTvqmnDe.png" alt=""></p><p>å¯ä»¥çœ‹åˆ°æ¶ˆæ¯åˆ°è¾¾é˜Ÿåˆ—äº†ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/BR8mbRZOkohqUAxbOUncGdZ1nde.png" alt=""></p><p>è¿™ä¸ªæ—¶å€™å¦‚æœæœ‰æ¶ˆè´¹è€…ç›‘å¬äº†MQçš„<code>hello.queue1</code>æˆ–<code>hello.queue2</code>é˜Ÿåˆ—ï¼Œè‡ªç„¶å°±èƒ½æ¥æ”¶åˆ°æ¶ˆæ¯äº†ã€‚</p><h2 id="2-3-æ•°æ®éš”ç¦»">2.3.æ•°æ®éš”ç¦»</h2><h3 id="2-3-1-ç”¨æˆ·ç®¡ç†">2.3.1.ç”¨æˆ·ç®¡ç†</h3><p>ç‚¹å‡»<code>Admin</code>é€‰é¡¹å¡ï¼Œé¦–å…ˆä¼šçœ‹åˆ°RabbitMQæ§åˆ¶å°çš„ç”¨æˆ·ç®¡ç†ç•Œé¢ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/P27GbS0zAoWnPgx7LCQcFMlonBf.png" alt=""></p><p>è¿™é‡Œçš„ç”¨æˆ·éƒ½æ˜¯RabbitMQçš„ç®¡ç†æˆ–è¿ç»´äººå‘˜ã€‚ç›®å‰åªæœ‰å®‰è£…RabbitMQæ—¶æ·»åŠ çš„<code>itheima</code>è¿™ä¸ªç”¨æˆ·ã€‚ä»”ç»†è§‚å¯Ÿç”¨æˆ·è¡¨æ ¼ä¸­çš„å­—æ®µï¼Œå¦‚ä¸‹ï¼š</p><ul><li><p><code>Name</code>ï¼š<code>itheima</code>ï¼Œä¹Ÿå°±æ˜¯ç”¨æˆ·å</p></li><li><p><code>Tags</code>ï¼š<code>administrator</code>ï¼Œè¯´æ˜<code>itheima</code>ç”¨æˆ·æ˜¯è¶…çº§ç®¡ç†å‘˜ï¼Œæ‹¥æœ‰æ‰€æœ‰æƒé™</p></li><li><p><code>Can access virtual host</code>ï¼š <code>/</code>ï¼Œå¯ä»¥è®¿é—®çš„<code>virtual host</code>ï¼Œè¿™é‡Œçš„<code>/</code>æ˜¯é»˜è®¤çš„<code>virtual host</code></p></li></ul><p>å¯¹äºå°å‹ä¼ä¸šè€Œè¨€ï¼Œå‡ºäºæˆæœ¬è€ƒè™‘ï¼Œæˆ‘ä»¬é€šå¸¸åªä¼šæ­å»ºä¸€å¥—MQé›†ç¾¤ï¼Œå…¬å¸å†…çš„å¤šä¸ªä¸åŒé¡¹ç›®åŒæ—¶ä½¿ç”¨ã€‚è¿™ä¸ªæ—¶å€™ä¸ºäº†é¿å…äº’ç›¸å¹²æ‰°ï¼Œ æˆ‘ä»¬ä¼šåˆ©ç”¨<code>virtual host</code>çš„éš”ç¦»ç‰¹æ€§ï¼Œå°†ä¸åŒé¡¹ç›®éš”ç¦»ã€‚ä¸€èˆ¬ä¼šåšä¸¤ä»¶äº‹æƒ…ï¼š</p><ul><li><p>ç»™æ¯ä¸ªé¡¹ç›®åˆ›å»ºç‹¬ç«‹çš„è¿ç»´è´¦å·ï¼Œå°†ç®¡ç†æƒé™åˆ†ç¦»ã€‚</p></li><li><p>ç»™æ¯ä¸ªé¡¹ç›®åˆ›å»ºä¸åŒçš„<code>virtual host</code>ï¼Œå°†æ¯ä¸ªé¡¹ç›®çš„æ•°æ®éš”ç¦»ã€‚</p></li></ul><p>æ¯”å¦‚ï¼Œæˆ‘ä»¬ç»™é»‘é©¬å•†åŸåˆ›å»ºä¸€ä¸ªæ–°çš„ç”¨æˆ·ï¼Œå‘½åä¸º<code>hmall</code>ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/TbVRbsJaKoL3VSxFGVWcbfV0nbd.png" alt=""></p><p>ä½ ä¼šå‘ç°æ­¤æ—¶hmallç”¨æˆ·æ²¡æœ‰ä»»ä½•<code>virtual host</code>çš„è®¿é—®æƒé™ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/YCq6beky1oiD5yxR3klctQh3nCf.png" alt=""></p><p>åˆ«æ€¥ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±æ¥æˆæƒã€‚</p><h3 id="2-3-2-virtual-host">2.3.2.virtual host</h3><p>æˆ‘ä»¬å…ˆé€€å‡ºç™»å½•ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/Nf5AbO0mKo7RTixOUrUcdfWRn9e.png" alt=""></p><p>åˆ‡æ¢åˆ°åˆšåˆšåˆ›å»ºçš„hmallç”¨æˆ·ç™»å½•ï¼Œç„¶åç‚¹å‡»<code>Virtual Hosts</code>èœå•ï¼Œè¿›å…¥<code>virtual host</code>ç®¡ç†é¡µï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/NWSObodw1oiLcHxYW1TcD4rBn4b.png" alt=""></p><p>å¯ä»¥çœ‹åˆ°ç›®å‰åªæœ‰ä¸€ä¸ªé»˜è®¤çš„<code>virtual host</code>ï¼Œåå­—ä¸º <code>/</code>ã€‚</p><p> æˆ‘ä»¬å¯ä»¥ç»™é»‘é©¬å•†åŸé¡¹ç›®åˆ›å»ºä¸€ä¸ªå•ç‹¬çš„<code>virtual host</code>ï¼Œè€Œä¸æ˜¯ä½¿ç”¨é»˜è®¤çš„<code>/</code>ã€‚</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/GJwSbnpcEolw3cxtLU1cNzTcncc.png" alt=""></p><p>åˆ›å»ºå®Œæˆåå¦‚å›¾ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/BC6EbcBTKoaE3cxoJDWc9sTmnkc.png" alt=""></p><p>ç”±äºæˆ‘ä»¬æ˜¯ç™»å½•<code>hmall</code>è´¦æˆ·ååˆ›å»ºçš„<code>virtual host</code>ï¼Œå› æ­¤å›åˆ°<code>users</code>èœå•ï¼Œä½ ä¼šå‘ç°å½“å‰ç”¨æˆ·å·²ç»å…·å¤‡äº†å¯¹<code>/hmall</code>è¿™ä¸ª<code>virtual host</code>çš„è®¿é—®æƒé™äº†ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/Gl4QbT3buoVEo9xTnK3cXkqAnbG.png" alt=""></p><p>æ­¤æ—¶ï¼Œç‚¹å‡»é¡µé¢å³ä¸Šè§’çš„<code>virtual host</code>ä¸‹æ‹‰èœå•ï¼Œåˆ‡æ¢<code>virtual host</code>ä¸º <code>/hmall</code>ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/EOg4br4TooRmRpxCF9fcfhtkn6g.png" alt=""></p><p>ç„¶åå†æ¬¡æŸ¥çœ‹queuesé€‰é¡¹å¡ï¼Œä¼šå‘ç°ä¹‹å‰çš„é˜Ÿåˆ—å·²ç»çœ‹ä¸åˆ°äº†ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/Xs2hbPZzTojKP0xNWpkcBZuin0g.png" alt=""></p><p>è¿™å°±æ˜¯åŸºäº<code>virtual host </code>çš„éš”ç¦»æ•ˆæœã€‚</p><h1 id="3-SpringAMQP">3.SpringAMQP</h1><p>å°†æ¥æˆ‘ä»¬å¼€å‘ä¸šåŠ¡åŠŸèƒ½çš„æ—¶å€™ï¼Œè‚¯å®šä¸ä¼šåœ¨æ§åˆ¶å°æ”¶å‘æ¶ˆæ¯ï¼Œè€Œæ˜¯åº”è¯¥åŸºäºç¼–ç¨‹çš„æ–¹å¼ã€‚ç”±äº<code>RabbitMQ</code>é‡‡ç”¨äº†AMQPåè®®ï¼Œå› æ­¤å®ƒå…·å¤‡è·¨è¯­è¨€çš„ç‰¹æ€§ã€‚ä»»ä½•è¯­è¨€åªè¦éµå¾ªAMQPåè®®æ”¶å‘æ¶ˆæ¯ï¼Œéƒ½å¯ä»¥ä¸<code>RabbitMQ</code>äº¤äº’ã€‚å¹¶ä¸”<code>RabbitMQ</code>å®˜æ–¹ä¹Ÿæä¾›äº†å„ç§ä¸åŒè¯­è¨€çš„å®¢æˆ·ç«¯ã€‚</p><p>ä½†æ˜¯ï¼ŒRabbitMQå®˜æ–¹æä¾›çš„Javaå®¢æˆ·ç«¯ç¼–ç ç›¸å¯¹å¤æ‚ï¼Œä¸€èˆ¬ç”Ÿäº§ç¯å¢ƒä¸‹æˆ‘ä»¬æ›´å¤šä¼šç»“åˆSpringæ¥ä½¿ç”¨ã€‚è€ŒSpringçš„å®˜æ–¹åˆšå¥½åŸºäºRabbitMQæä¾›äº†è¿™æ ·ä¸€å¥—æ¶ˆæ¯æ”¶å‘çš„æ¨¡æ¿å·¥å…·ï¼šSpringAMQPã€‚å¹¶ä¸”è¿˜åŸºäºSpringBootå¯¹å…¶å®ç°äº†è‡ªåŠ¨è£…é…ï¼Œä½¿ç”¨èµ·æ¥éå¸¸æ–¹ä¾¿ã€‚</p><p>SpringAmqpçš„å®˜æ–¹åœ°å€ï¼š</p><p>SpringAMQPæä¾›äº†ä¸‰ä¸ªåŠŸèƒ½ï¼š</p><ul><li><p>è‡ªåŠ¨å£°æ˜é˜Ÿåˆ—ã€äº¤æ¢æœºåŠå…¶ç»‘å®šå…³ç³»</p></li><li><p>åŸºäºæ³¨è§£çš„ç›‘å¬å™¨æ¨¡å¼ï¼Œå¼‚æ­¥æ¥æ”¶æ¶ˆæ¯</p></li><li><p>å°è£…äº†RabbitTemplateå·¥å…·ï¼Œç”¨äºå‘é€æ¶ˆæ¯</p></li></ul><p>è¿™ä¸€ç« æˆ‘ä»¬å°±ä¸€èµ·å­¦ä¹ ä¸€ä¸‹ï¼Œå¦‚ä½•åˆ©ç”¨SpringAMQPå®ç°å¯¹RabbitMQçš„æ¶ˆæ¯æ”¶å‘ã€‚</p><h2 id="3-1-å¯¼å…¥Demoå·¥ç¨‹">3.1.å¯¼å…¥Demoå·¥ç¨‹</h2><p>åœ¨è¯¾å‰èµ„æ–™ç»™å¤§å®¶æä¾›äº†ä¸€ä¸ªDemoå·¥ç¨‹ï¼Œæ–¹ä¾¿æˆ‘ä»¬å­¦ä¹ SpringAMQPçš„ä½¿ç”¨ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/NTJubEDiVovAn5xS4SScLUUjn4u-175603011395640.png" alt=""></p><p>å°†å…¶å¤åˆ¶åˆ°ä½ çš„å·¥ä½œç©ºé—´ï¼Œç„¶åç”¨Ideaæ‰“å¼€ï¼Œé¡¹ç›®ç»“æ„å¦‚å›¾ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/TWK8bTyJmoRYi2xTzy1cBTGgnyh-175603011395641.png" alt=""></p><p>åŒ…æ‹¬ä¸‰éƒ¨åˆ†ï¼š</p><ul><li><p>mq-demoï¼šçˆ¶å·¥ç¨‹ï¼Œç®¡ç†é¡¹ç›®ä¾èµ–</p></li><li><p>publisherï¼šæ¶ˆæ¯çš„å‘é€è€…</p></li><li><p>consumerï¼šæ¶ˆæ¯çš„æ¶ˆè´¹è€…</p></li></ul><p>åœ¨mq-demoè¿™ä¸ªçˆ¶å·¥ç¨‹ä¸­ï¼Œå·²ç»é…ç½®å¥½äº†SpringAMQPç›¸å…³çš„ä¾èµ–ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.itcast.demo<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mq-demo<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modules</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>publisher<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>consumer<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">modules</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.7.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--AMQPä¾èµ–ï¼ŒåŒ…å«RabbitMQ--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-amqp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--å•å…ƒæµ‹è¯•--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å› æ­¤ï¼Œå­å·¥ç¨‹ä¸­å°±å¯ä»¥ç›´æ¥ä½¿ç”¨SpringAMQPäº†ã€‚</p><h2 id="3-2-å¿«é€Ÿå…¥é—¨">3.2.å¿«é€Ÿå…¥é—¨</h2><p>åœ¨ä¹‹å‰çš„æ¡ˆä¾‹ä¸­ï¼Œæˆ‘ä»¬éƒ½æ˜¯ç»è¿‡äº¤æ¢æœºå‘é€æ¶ˆæ¯åˆ°é˜Ÿåˆ—ï¼Œä¸è¿‡æœ‰æ—¶å€™ä¸ºäº†æµ‹è¯•æ–¹ä¾¿ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç›´æ¥å‘é˜Ÿåˆ—å‘é€æ¶ˆæ¯ï¼Œè·³è¿‡äº¤æ¢æœºã€‚</p><p>åœ¨å…¥é—¨æ¡ˆä¾‹ä¸­ï¼Œæˆ‘ä»¬å°±æ¼”ç¤ºè¿™æ ·çš„ç®€å•æ¨¡å‹ï¼Œå¦‚å›¾ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/diagram-6-175603011395642.png" alt=""></p><p>ä¹Ÿå°±æ˜¯ï¼š</p><ul><li><p>publisherç›´æ¥å‘é€æ¶ˆæ¯åˆ°é˜Ÿåˆ—</p></li><li><p>æ¶ˆè´¹è€…ç›‘å¬å¹¶å¤„ç†é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯</p></li></ul><blockquote><p><strong>æ³¨æ„</strong>ï¼šè¿™ç§æ¨¡å¼ä¸€èˆ¬æµ‹è¯•ä½¿ç”¨ï¼Œå¾ˆå°‘åœ¨ç”Ÿäº§ä¸­ä½¿ç”¨ã€‚</p></blockquote><p>ä¸ºäº†æ–¹ä¾¿æµ‹è¯•ï¼Œæˆ‘ä»¬ç°åœ¨æ§åˆ¶å°æ–°å»ºä¸€ä¸ªé˜Ÿåˆ—ï¼šsimple.queue</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/Pcxnbpl73o8QGwxN30ickh1Gn8f-175603011395643.png" alt=""></p><p>æ·»åŠ æˆåŠŸï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/IUojbN003ocDoyxs4EUc9sopnFP-175603011395644.png" alt=""></p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨Javaä»£ç æ”¶å‘æ¶ˆæ¯äº†ã€‚</p><h3 id="3-2-1-æ¶ˆæ¯å‘é€">3.2.1.æ¶ˆæ¯å‘é€</h3><p>é¦–å…ˆé…ç½®MQåœ°å€ï¼Œåœ¨<code>publisher</code>æœåŠ¡çš„<code>application.yml</code>ä¸­æ·»åŠ é…ç½®ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">rabbitmq:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="number">192.168</span><span class="number">.150</span><span class="number">.101</span> <span class="comment"># ä½ çš„è™šæ‹ŸæœºIP</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">5672</span> <span class="comment"># ç«¯å£</span></span><br><span class="line">    <span class="attr">virtual-host:</span> <span class="string">/hmall</span> <span class="comment"># è™šæ‹Ÿä¸»æœº</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">hmall</span> <span class="comment"># ç”¨æˆ·å</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123</span> <span class="comment"># å¯†ç </span></span><br></pre></td></tr></table></figure><p>ç„¶ååœ¨<code>publisher</code>æœåŠ¡ä¸­ç¼–å†™æµ‹è¯•ç±»<code>SpringAmqpTest</code>ï¼Œå¹¶åˆ©ç”¨<code>RabbitTemplate</code>å®ç°æ¶ˆæ¯å‘é€ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.publisher.amqp;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.rabbit.core.RabbitTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringAmqpTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RabbitTemplate rabbitTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSimpleQueue</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// é˜Ÿåˆ—åç§°</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">queueName</span> <span class="operator">=</span> <span class="string">&quot;simple.queue&quot;</span>;</span><br><span class="line">        <span class="comment">// æ¶ˆæ¯</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">&quot;hello, spring amqp!&quot;</span>;</span><br><span class="line">        <span class="comment">// å‘é€æ¶ˆæ¯</span></span><br><span class="line">        rabbitTemplate.convertAndSend(queueName, message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰“å¼€æ§åˆ¶å°ï¼Œå¯ä»¥çœ‹åˆ°æ¶ˆæ¯å·²ç»å‘é€åˆ°é˜Ÿåˆ—ä¸­ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/N8Nsbeatqo5bGUx7OWJc4M1Anke-175603011395647.png" alt=""></p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å†æ¥å®ç°æ¶ˆæ¯æ¥æ”¶ã€‚</p><h3 id="3-2-2-æ¶ˆæ¯æ¥æ”¶">3.2.2.æ¶ˆæ¯æ¥æ”¶</h3><p>é¦–å…ˆé…ç½®MQåœ°å€ï¼Œåœ¨<code>consumer</code>æœåŠ¡çš„<code>application.yml</code>ä¸­æ·»åŠ é…ç½®ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">rabbitmq:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="number">192.168</span><span class="number">.150</span><span class="number">.101</span> <span class="comment"># ä½ çš„è™šæ‹ŸæœºIP</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">5672</span> <span class="comment"># ç«¯å£</span></span><br><span class="line">    <span class="attr">virtual-host:</span> <span class="string">/hmall</span> <span class="comment"># è™šæ‹Ÿä¸»æœº</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">hmall</span> <span class="comment"># ç”¨æˆ·å</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123</span> <span class="comment"># å¯†ç </span></span><br></pre></td></tr></table></figure><p>ç„¶ååœ¨<code>consumer</code>æœåŠ¡çš„<code>com.itheima.consumer.listener</code>åŒ…ä¸­æ–°å»ºä¸€ä¸ªç±»<code>SpringRabbitListener</code>ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.consumer.listener;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.rabbit.annotation.RabbitListener;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringRabbitListener</span> &#123;</span><br><span class="line">        <span class="comment">// åˆ©ç”¨RabbitListeneræ¥å£°æ˜è¦ç›‘å¬çš„é˜Ÿåˆ—ä¿¡æ¯</span></span><br><span class="line">    <span class="comment">// å°†æ¥ä¸€æ—¦ç›‘å¬çš„é˜Ÿåˆ—ä¸­æœ‰äº†æ¶ˆæ¯ï¼Œå°±ä¼šæ¨é€ç»™å½“å‰æœåŠ¡ï¼Œè°ƒç”¨å½“å‰æ–¹æ³•ï¼Œå¤„ç†æ¶ˆæ¯ã€‚</span></span><br><span class="line">    <span class="comment">// å¯ä»¥çœ‹åˆ°æ–¹æ³•ä½“ä¸­æ¥æ”¶çš„å°±æ˜¯æ¶ˆæ¯ä½“çš„å†…å®¹</span></span><br><span class="line">    <span class="meta">@RabbitListener(queues = &quot;simple.queue&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenSimpleQueueMessage</span><span class="params">(String msg)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;spring æ¶ˆè´¹è€…æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€&quot;</span> + msg + <span class="string">&quot;ã€‘&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-2-3-æµ‹è¯•">3.2.3.æµ‹è¯•</h3><p>å¯åŠ¨consumeræœåŠ¡ï¼Œç„¶ååœ¨publisheræœåŠ¡ä¸­è¿è¡Œæµ‹è¯•ä»£ç ï¼Œå‘é€MQæ¶ˆæ¯ã€‚æœ€ç»ˆconsumeræ”¶åˆ°æ¶ˆæ¯ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/Vbf6b35dyoJb2HxdS8Nc7GI1nOf-175603011395646.png" alt=""></p><h2 id="3-3-WorkQueuesæ¨¡å‹">3.3.WorkQueuesæ¨¡å‹</h2><p>Work queuesï¼Œä»»åŠ¡æ¨¡å‹ã€‚ç®€å•æ¥è¯´å°±æ˜¯<strong>è®©å¤šä¸ªæ¶ˆè´¹è€…ç»‘å®šåˆ°ä¸€ä¸ªé˜Ÿåˆ—ï¼Œå…±åŒæ¶ˆè´¹é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯</strong>ã€‚</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/diagram-7-175603011395645.png" alt=""></p><p>å½“æ¶ˆæ¯å¤„ç†æ¯”è¾ƒè€—æ—¶çš„æ—¶å€™ï¼Œå¯èƒ½ç”Ÿäº§æ¶ˆæ¯çš„é€Ÿåº¦ä¼šè¿œè¿œå¤§äºæ¶ˆæ¯çš„æ¶ˆè´¹é€Ÿåº¦ã€‚é•¿æ­¤ä»¥å¾€ï¼Œæ¶ˆæ¯å°±ä¼šå †ç§¯è¶Šæ¥è¶Šå¤šï¼Œæ— æ³•åŠæ—¶å¤„ç†ã€‚</p><p>æ­¤æ—¶å°±å¯ä»¥ä½¿ç”¨work æ¨¡å‹ï¼Œ<strong>å¤šä¸ªæ¶ˆè´¹è€…å…±åŒå¤„ç†æ¶ˆæ¯å¤„ç†ï¼Œæ¶ˆæ¯å¤„ç†çš„é€Ÿåº¦å°±èƒ½å¤§å¤§æé«˜</strong>äº†ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±æ¥æ¨¡æ‹Ÿè¿™æ ·çš„åœºæ™¯ã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬åœ¨æ§åˆ¶å°åˆ›å»ºä¸€ä¸ªæ–°çš„é˜Ÿåˆ—ï¼Œå‘½åä¸º<code>work.queue</code>ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/HzN7btEXko5VcSxTLx7ca8egnhu-175603011395649.png" alt=""></p><h3 id="3-3-1-æ¶ˆæ¯å‘é€">3.3.1.æ¶ˆæ¯å‘é€</h3><p>è¿™æ¬¡æˆ‘ä»¬å¾ªç¯å‘é€ï¼Œæ¨¡æ‹Ÿå¤§é‡æ¶ˆæ¯å †ç§¯ç°è±¡ã€‚</p><p>åœ¨publisheræœåŠ¡ä¸­çš„SpringAmqpTestç±»ä¸­æ·»åŠ ä¸€ä¸ªæµ‹è¯•æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * workQueue</span></span><br><span class="line"><span class="comment">     * å‘é˜Ÿåˆ—ä¸­ä¸åœå‘é€æ¶ˆæ¯ï¼Œæ¨¡æ‹Ÿæ¶ˆæ¯å †ç§¯ã€‚</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testWorkQueue</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    <span class="comment">// é˜Ÿåˆ—åç§°</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">queueName</span> <span class="operator">=</span> <span class="string">&quot;simple.queue&quot;</span>;</span><br><span class="line">    <span class="comment">// æ¶ˆæ¯</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">&quot;hello, message_&quot;</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">50</span>; i++) &#123;</span><br><span class="line">        <span class="comment">// å‘é€æ¶ˆæ¯ï¼Œæ¯20æ¯«ç§’å‘é€ä¸€æ¬¡ï¼Œç›¸å½“äºæ¯ç§’å‘é€50æ¡æ¶ˆæ¯</span></span><br><span class="line">        rabbitTemplate.convertAndSend(queueName, message + i);</span><br><span class="line">        Thread.sleep(<span class="number">20</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-3-2-æ¶ˆæ¯æ¥æ”¶">3.3.2.æ¶ˆæ¯æ¥æ”¶</h3><p>è¦æ¨¡æ‹Ÿå¤šä¸ªæ¶ˆè´¹è€…ç»‘å®šåŒä¸€ä¸ªé˜Ÿåˆ—ï¼Œæˆ‘ä»¬åœ¨consumeræœåŠ¡çš„SpringRabbitListenerä¸­æ·»åŠ 2ä¸ªæ–°çš„æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RabbitListener(queues = &quot;work.queue&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenWorkQueue1</span><span class="params">(String msg)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;æ¶ˆè´¹è€…1æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€&quot;</span> + msg + <span class="string">&quot;ã€‘&quot;</span> + LocalTime.now());</span><br><span class="line">    Thread.sleep(<span class="number">20</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RabbitListener(queues = &quot;work.queue&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenWorkQueue2</span><span class="params">(String msg)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    System.err.println(<span class="string">&quot;æ¶ˆè´¹è€…2........æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€&quot;</span> + msg + <span class="string">&quot;ã€‘&quot;</span> + LocalTime.now());</span><br><span class="line">    Thread.sleep(<span class="number">200</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„åˆ°è¿™ä¸¤æ¶ˆè´¹è€…ï¼Œéƒ½è®¾ç½®äº†<code>Thead.sleep</code>ï¼Œæ¨¡æ‹Ÿä»»åŠ¡è€—æ—¶ï¼š</p><ul><li><p>æ¶ˆè´¹è€…1 sleepäº†20æ¯«ç§’ï¼Œç›¸å½“äºæ¯ç§’é’Ÿå¤„ç†50ä¸ªæ¶ˆæ¯</p></li><li><p>æ¶ˆè´¹è€…2 sleepäº†200æ¯«ç§’ï¼Œç›¸å½“äºæ¯ç§’å¤„ç†5ä¸ªæ¶ˆæ¯</p></li></ul><h3 id="3-3-3-æµ‹è¯•">3.3.3.æµ‹è¯•</h3><p>å¯åŠ¨ConsumerApplicationåï¼Œåœ¨æ‰§è¡ŒpublisheræœåŠ¡ä¸­åˆšåˆšç¼–å†™çš„å‘é€æµ‹è¯•æ–¹æ³•testWorkQueueã€‚</p><p>æœ€ç»ˆç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_0ã€‘<span class="number">21</span>:<span class="number">06</span>:<span class="number">00.869555300</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">2.</span>.......æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_1ã€‘<span class="number">21</span>:<span class="number">06</span>:<span class="number">00.884518</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_2ã€‘<span class="number">21</span>:<span class="number">06</span>:<span class="number">00.907454400</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_4ã€‘<span class="number">21</span>:<span class="number">06</span>:<span class="number">00.953332100</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_6ã€‘<span class="number">21</span>:<span class="number">06</span>:<span class="number">00.997867300</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_8ã€‘<span class="number">21</span>:<span class="number">06</span>:<span class="number">01.042178700</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">2.</span>.......æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_3ã€‘<span class="number">21</span>:<span class="number">06</span>:<span class="number">01.086478800</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_10ã€‘<span class="number">21</span>:<span class="number">06</span>:<span class="number">01.087476600</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_12ã€‘<span class="number">21</span>:<span class="number">06</span>:<span class="number">01.132578300</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_14ã€‘<span class="number">21</span>:<span class="number">06</span>:<span class="number">01.175851200</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_16ã€‘<span class="number">21</span>:<span class="number">06</span>:<span class="number">01.218533400</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_18ã€‘<span class="number">21</span>:<span class="number">06</span>:<span class="number">01.261322900</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">2.</span>.......æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_5ã€‘<span class="number">21</span>:<span class="number">06</span>:<span class="number">01.287003700</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_20ã€‘<span class="number">21</span>:<span class="number">06</span>:<span class="number">01.304412400</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_22ã€‘<span class="number">21</span>:<span class="number">06</span>:<span class="number">01.349950100</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_24ã€‘<span class="number">21</span>:<span class="number">06</span>:<span class="number">01.394533900</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_26ã€‘<span class="number">21</span>:<span class="number">06</span>:<span class="number">01.439876500</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_28ã€‘<span class="number">21</span>:<span class="number">06</span>:<span class="number">01.482937800</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">2.</span>.......æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_7ã€‘<span class="number">21</span>:<span class="number">06</span>:<span class="number">01.488977100</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_30ã€‘<span class="number">21</span>:<span class="number">06</span>:<span class="number">01.526409300</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_32ã€‘<span class="number">21</span>:<span class="number">06</span>:<span class="number">01.572148</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_34ã€‘<span class="number">21</span>:<span class="number">06</span>:<span class="number">01.618264800</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_36ã€‘<span class="number">21</span>:<span class="number">06</span>:<span class="number">01.660780600</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">2.</span>.......æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_9ã€‘<span class="number">21</span>:<span class="number">06</span>:<span class="number">01.689189300</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_38ã€‘<span class="number">21</span>:<span class="number">06</span>:<span class="number">01.705261</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_40ã€‘<span class="number">21</span>:<span class="number">06</span>:<span class="number">01.746927300</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_42ã€‘<span class="number">21</span>:<span class="number">06</span>:<span class="number">01.789835</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_44ã€‘<span class="number">21</span>:<span class="number">06</span>:<span class="number">01.834393100</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_46ã€‘<span class="number">21</span>:<span class="number">06</span>:<span class="number">01.875312100</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">2.</span>.......æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_11ã€‘<span class="number">21</span>:<span class="number">06</span>:<span class="number">01.889969500</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_48ã€‘<span class="number">21</span>:<span class="number">06</span>:<span class="number">01.920702500</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">2.</span>.......æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_13ã€‘<span class="number">21</span>:<span class="number">06</span>:<span class="number">02.090725900</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">2.</span>.......æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_15ã€‘<span class="number">21</span>:<span class="number">06</span>:<span class="number">02.293060600</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">2.</span>.......æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_17ã€‘<span class="number">21</span>:<span class="number">06</span>:<span class="number">02.493748</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">2.</span>.......æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_19ã€‘<span class="number">21</span>:<span class="number">06</span>:<span class="number">02.696635100</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">2.</span>.......æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_21ã€‘<span class="number">21</span>:<span class="number">06</span>:<span class="number">02.896809700</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">2.</span>.......æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_23ã€‘<span class="number">21</span>:<span class="number">06</span>:<span class="number">03.099533400</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">2.</span>.......æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_25ã€‘<span class="number">21</span>:<span class="number">06</span>:<span class="number">03.301446400</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">2.</span>.......æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_27ã€‘<span class="number">21</span>:<span class="number">06</span>:<span class="number">03.504999100</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">2.</span>.......æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_29ã€‘<span class="number">21</span>:<span class="number">06</span>:<span class="number">03.705702500</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">2.</span>.......æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_31ã€‘<span class="number">21</span>:<span class="number">06</span>:<span class="number">03.906601200</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">2.</span>.......æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_33ã€‘<span class="number">21</span>:<span class="number">06</span>:<span class="number">04.108118500</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">2.</span>.......æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_35ã€‘<span class="number">21</span>:<span class="number">06</span>:<span class="number">04.308945400</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">2.</span>.......æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_37ã€‘<span class="number">21</span>:<span class="number">06</span>:<span class="number">04.511547700</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">2.</span>.......æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_39ã€‘<span class="number">21</span>:<span class="number">06</span>:<span class="number">04.714038400</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">2.</span>.......æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_41ã€‘<span class="number">21</span>:<span class="number">06</span>:<span class="number">04.916192700</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">2.</span>.......æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_43ã€‘<span class="number">21</span>:<span class="number">06</span>:<span class="number">05.116286400</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">2.</span>.......æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_45ã€‘<span class="number">21</span>:<span class="number">06</span>:<span class="number">05.318055100</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">2.</span>.......æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_47ã€‘<span class="number">21</span>:<span class="number">06</span>:<span class="number">05.520656400</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">2.</span>.......æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_49ã€‘<span class="number">21</span>:<span class="number">06</span>:<span class="number">05.723106700</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°æ¶ˆè´¹è€…1å’Œæ¶ˆè´¹è€…2ç«Ÿç„¶æ¯äººæ¶ˆè´¹äº†25æ¡æ¶ˆæ¯ï¼š</p><ul><li><p>æ¶ˆè´¹è€…1å¾ˆå¿«å®Œæˆäº†è‡ªå·±çš„25æ¡æ¶ˆæ¯</p></li><li><p>æ¶ˆè´¹è€…2å´åœ¨ç¼“æ…¢çš„å¤„ç†è‡ªå·±çš„25æ¡æ¶ˆæ¯ã€‚</p></li></ul><p>ä¹Ÿå°±æ˜¯è¯´æ¶ˆæ¯æ˜¯å¹³å‡åˆ†é…ç»™æ¯ä¸ªæ¶ˆè´¹è€…ï¼Œå¹¶æ²¡æœ‰è€ƒè™‘åˆ°æ¶ˆè´¹è€…çš„å¤„ç†èƒ½åŠ›ã€‚å¯¼è‡´1ä¸ªæ¶ˆè´¹è€…ç©ºé—²ï¼Œå¦ä¸€ä¸ªæ¶ˆè´¹è€…å¿™çš„ä¸å¯å¼€äº¤ã€‚æ²¡æœ‰å……åˆ†åˆ©ç”¨æ¯ä¸€ä¸ªæ¶ˆè´¹è€…çš„èƒ½åŠ›ï¼Œæœ€ç»ˆæ¶ˆæ¯å¤„ç†çš„è€—æ—¶è¿œè¿œè¶…è¿‡äº†1ç§’ã€‚è¿™æ ·æ˜¾ç„¶æ˜¯æœ‰é—®é¢˜çš„ã€‚</p><h3 id="3-3-4-èƒ½è€…å¤šåŠ³">3.3.4.èƒ½è€…å¤šåŠ³</h3><p>åœ¨springä¸­æœ‰ä¸€ä¸ªç®€å•çš„é…ç½®ï¼Œå¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚æˆ‘ä»¬ä¿®æ”¹consumeræœåŠ¡çš„application.ymlæ–‡ä»¶ï¼Œæ·»åŠ é…ç½®ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">rabbitmq:</span></span><br><span class="line">    <span class="attr">listener:</span></span><br><span class="line">      <span class="attr">simple:</span></span><br><span class="line">        <span class="attr">prefetch:</span> <span class="number">1</span> <span class="comment"># æ¯æ¬¡åªèƒ½è·å–ä¸€æ¡æ¶ˆæ¯ï¼Œå¤„ç†å®Œæˆæ‰èƒ½è·å–ä¸‹ä¸€ä¸ªæ¶ˆæ¯</span></span><br></pre></td></tr></table></figure><p>å†æ¬¡æµ‹è¯•ï¼Œå‘ç°ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_0ã€‘<span class="number">21</span>:<span class="number">12</span>:<span class="number">51.659664200</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">2.</span>.......æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_1ã€‘<span class="number">21</span>:<span class="number">12</span>:<span class="number">51.680610</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_2ã€‘<span class="number">21</span>:<span class="number">12</span>:<span class="number">51.703625</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_3ã€‘<span class="number">21</span>:<span class="number">12</span>:<span class="number">51.724330100</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_4ã€‘<span class="number">21</span>:<span class="number">12</span>:<span class="number">51.746651100</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_5ã€‘<span class="number">21</span>:<span class="number">12</span>:<span class="number">51.768401400</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_6ã€‘<span class="number">21</span>:<span class="number">12</span>:<span class="number">51.790511400</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_7ã€‘<span class="number">21</span>:<span class="number">12</span>:<span class="number">51.812559800</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_8ã€‘<span class="number">21</span>:<span class="number">12</span>:<span class="number">51.834500600</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_9ã€‘<span class="number">21</span>:<span class="number">12</span>:<span class="number">51.857438800</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_10ã€‘<span class="number">21</span>:<span class="number">12</span>:<span class="number">51.880379600</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">2.</span>.......æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_11ã€‘<span class="number">21</span>:<span class="number">12</span>:<span class="number">51.899327100</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_12ã€‘<span class="number">21</span>:<span class="number">12</span>:<span class="number">51.922828400</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_13ã€‘<span class="number">21</span>:<span class="number">12</span>:<span class="number">51.945617400</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_14ã€‘<span class="number">21</span>:<span class="number">12</span>:<span class="number">51.968942500</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_15ã€‘<span class="number">21</span>:<span class="number">12</span>:<span class="number">51.992215400</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_16ã€‘<span class="number">21</span>:<span class="number">12</span>:<span class="number">52.013325600</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_17ã€‘<span class="number">21</span>:<span class="number">12</span>:<span class="number">52.035687100</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_18ã€‘<span class="number">21</span>:<span class="number">12</span>:<span class="number">52.058188</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_19ã€‘<span class="number">21</span>:<span class="number">12</span>:<span class="number">52.081208400</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">2.</span>.......æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_20ã€‘<span class="number">21</span>:<span class="number">12</span>:<span class="number">52.103406200</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_21ã€‘<span class="number">21</span>:<span class="number">12</span>:<span class="number">52.123827300</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_22ã€‘<span class="number">21</span>:<span class="number">12</span>:<span class="number">52.146165100</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_23ã€‘<span class="number">21</span>:<span class="number">12</span>:<span class="number">52.168828300</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_24ã€‘<span class="number">21</span>:<span class="number">12</span>:<span class="number">52.191769500</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_25ã€‘<span class="number">21</span>:<span class="number">12</span>:<span class="number">52.214839100</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_26ã€‘<span class="number">21</span>:<span class="number">12</span>:<span class="number">52.238998700</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_27ã€‘<span class="number">21</span>:<span class="number">12</span>:<span class="number">52.259772600</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_28ã€‘<span class="number">21</span>:<span class="number">12</span>:<span class="number">52.284131800</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">2.</span>.......æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_29ã€‘<span class="number">21</span>:<span class="number">12</span>:<span class="number">52.306190600</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_30ã€‘<span class="number">21</span>:<span class="number">12</span>:<span class="number">52.325315800</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_31ã€‘<span class="number">21</span>:<span class="number">12</span>:<span class="number">52.347012500</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_32ã€‘<span class="number">21</span>:<span class="number">12</span>:<span class="number">52.368508600</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_33ã€‘<span class="number">21</span>:<span class="number">12</span>:<span class="number">52.391785100</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_34ã€‘<span class="number">21</span>:<span class="number">12</span>:<span class="number">52.416383800</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_35ã€‘<span class="number">21</span>:<span class="number">12</span>:<span class="number">52.439019</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_36ã€‘<span class="number">21</span>:<span class="number">12</span>:<span class="number">52.461733900</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_37ã€‘<span class="number">21</span>:<span class="number">12</span>:<span class="number">52.485990</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_38ã€‘<span class="number">21</span>:<span class="number">12</span>:<span class="number">52.509219900</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">2.</span>.......æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_39ã€‘<span class="number">21</span>:<span class="number">12</span>:<span class="number">52.523683400</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_40ã€‘<span class="number">21</span>:<span class="number">12</span>:<span class="number">52.547412100</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_41ã€‘<span class="number">21</span>:<span class="number">12</span>:<span class="number">52.571191800</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_42ã€‘<span class="number">21</span>:<span class="number">12</span>:<span class="number">52.593024600</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_43ã€‘<span class="number">21</span>:<span class="number">12</span>:<span class="number">52.616731800</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_44ã€‘<span class="number">21</span>:<span class="number">12</span>:<span class="number">52.640317</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_45ã€‘<span class="number">21</span>:<span class="number">12</span>:<span class="number">52.663111100</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_46ã€‘<span class="number">21</span>:<span class="number">12</span>:<span class="number">52.686727</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_47ã€‘<span class="number">21</span>:<span class="number">12</span>:<span class="number">52.709266500</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">2.</span>.......æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_48ã€‘<span class="number">21</span>:<span class="number">12</span>:<span class="number">52.725884900</span></span><br><span class="line">æ¶ˆè´¹è€…<span class="number">1</span>æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€hello, message_49ã€‘<span class="number">21</span>:<span class="number">12</span>:<span class="number">52.746299900</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥å‘ç°ï¼Œç”±äºæ¶ˆè´¹è€…1å¤„ç†é€Ÿåº¦è¾ƒå¿«ï¼Œæ‰€ä»¥å¤„ç†äº†æ›´å¤šçš„æ¶ˆæ¯ï¼›æ¶ˆè´¹è€…2å¤„ç†é€Ÿåº¦è¾ƒæ…¢ï¼Œåªå¤„ç†äº†6æ¡æ¶ˆæ¯ã€‚è€Œæœ€ç»ˆæ€»çš„æ‰§è¡Œè€—æ—¶ä¹Ÿåœ¨1ç§’å·¦å³ï¼Œå¤§å¤§æå‡ã€‚</p><p>æ­£æ‰€è°“èƒ½è€…å¤šåŠ³ï¼Œè¿™æ ·å……åˆ†åˆ©ç”¨äº†æ¯ä¸€ä¸ªæ¶ˆè´¹è€…çš„å¤„ç†èƒ½åŠ›ï¼Œå¯ä»¥æœ‰æ•ˆé¿å…æ¶ˆæ¯ç§¯å‹é—®é¢˜ã€‚</p><h3 id="3-3-5-æ€»ç»“">3.3.5.æ€»ç»“</h3><p>Workæ¨¡å‹çš„ä½¿ç”¨ï¼š</p><ul><li><p>å¤šä¸ªæ¶ˆè´¹è€…ç»‘å®šåˆ°ä¸€ä¸ªé˜Ÿåˆ—ï¼ŒåŒä¸€æ¡æ¶ˆæ¯åªä¼šè¢«ä¸€ä¸ªæ¶ˆè´¹è€…å¤„ç†</p></li><li><p>é€šè¿‡è®¾ç½®prefetchæ¥æ§åˆ¶æ¶ˆè´¹è€…é¢„å–çš„æ¶ˆæ¯æ•°é‡</p></li></ul><h2 id="3-4-äº¤æ¢æœºç±»å‹">3.4.äº¤æ¢æœºç±»å‹</h2><p>åœ¨ä¹‹å‰çš„ä¸¤ä¸ªæµ‹è¯•æ¡ˆä¾‹ä¸­ï¼Œéƒ½æ²¡æœ‰äº¤æ¢æœºï¼Œç”Ÿäº§è€…ç›´æ¥å‘é€æ¶ˆæ¯åˆ°é˜Ÿåˆ—ã€‚è€Œä¸€æ—¦å¼•å…¥äº¤æ¢æœºï¼Œæ¶ˆæ¯å‘é€çš„æ¨¡å¼ä¼šæœ‰å¾ˆå¤§å˜åŒ–ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/diagram-8-175603011395648.png" alt=""></p><p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨è®¢é˜…æ¨¡å‹ä¸­ï¼Œå¤šäº†ä¸€ä¸ªexchangeè§’è‰²ï¼Œè€Œä¸”è¿‡ç¨‹ç•¥æœ‰å˜åŒ–ï¼š</p><ul><li><p><strong>Publisher</strong>ï¼šç”Ÿäº§è€…ï¼Œä¸å†å‘é€æ¶ˆæ¯åˆ°é˜Ÿåˆ—ä¸­ï¼Œè€Œæ˜¯å‘ç»™äº¤æ¢æœº</p></li><li><p><strong>Exchange</strong>ï¼šäº¤æ¢æœºï¼Œä¸€æ–¹é¢ï¼Œæ¥æ”¶ç”Ÿäº§è€…å‘é€çš„æ¶ˆæ¯ã€‚å¦ä¸€æ–¹é¢ï¼ŒçŸ¥é“å¦‚ä½•å¤„ç†æ¶ˆæ¯ï¼Œä¾‹å¦‚é€’äº¤ç»™æŸä¸ªç‰¹åˆ«é˜Ÿåˆ—ã€é€’äº¤ç»™æ‰€æœ‰é˜Ÿåˆ—ã€æˆ–æ˜¯å°†æ¶ˆæ¯ä¸¢å¼ƒã€‚åˆ°åº•å¦‚ä½•æ“ä½œï¼Œå–å†³äºExchangeçš„ç±»å‹ã€‚</p></li><li><p><strong>Queue</strong>ï¼šæ¶ˆæ¯é˜Ÿåˆ—ä¹Ÿä¸ä»¥å‰ä¸€æ ·ï¼Œæ¥æ”¶æ¶ˆæ¯ã€ç¼“å­˜æ¶ˆæ¯ã€‚ä¸è¿‡é˜Ÿåˆ—ä¸€å®šè¦ä¸äº¤æ¢æœºç»‘å®šã€‚</p></li><li><p><strong>Consumer</strong>ï¼šæ¶ˆè´¹è€…ï¼Œä¸ä»¥å‰ä¸€æ ·ï¼Œè®¢é˜…é˜Ÿåˆ—ï¼Œæ²¡æœ‰å˜åŒ–</p></li></ul><p><strong>Exchangeï¼ˆäº¤æ¢æœºï¼‰åªè´Ÿè´£è½¬å‘æ¶ˆæ¯ï¼Œä¸å…·å¤‡å­˜å‚¨æ¶ˆæ¯çš„èƒ½åŠ›</strong>ï¼Œå› æ­¤å¦‚æœæ²¡æœ‰ä»»ä½•é˜Ÿåˆ—ä¸Exchangeç»‘å®šï¼Œæˆ–è€…æ²¡æœ‰ç¬¦åˆè·¯ç”±è§„åˆ™çš„é˜Ÿåˆ—ï¼Œé‚£ä¹ˆæ¶ˆæ¯ä¼šä¸¢å¤±ï¼</p><p>äº¤æ¢æœºçš„ç±»å‹æœ‰å››ç§ï¼š</p><ul><li><p><strong>Fanout</strong>ï¼šå¹¿æ’­ï¼Œå°†æ¶ˆæ¯äº¤ç»™æ‰€æœ‰ç»‘å®šåˆ°äº¤æ¢æœºçš„é˜Ÿåˆ—ã€‚æˆ‘ä»¬æœ€æ—©åœ¨æ§åˆ¶å°ä½¿ç”¨çš„æ­£æ˜¯Fanoutäº¤æ¢æœº</p></li><li><p><strong>Direct</strong>ï¼šè®¢é˜…ï¼ŒåŸºäºRoutingKeyï¼ˆè·¯ç”±keyï¼‰å‘é€ç»™è®¢é˜…äº†æ¶ˆæ¯çš„é˜Ÿåˆ—</p></li><li><p><strong>Topic</strong>ï¼šé€šé…ç¬¦è®¢é˜…ï¼Œä¸Directç±»ä¼¼ï¼Œåªä¸è¿‡RoutingKeyå¯ä»¥ä½¿ç”¨é€šé…ç¬¦</p></li><li><p><strong>Headers</strong>ï¼šå¤´åŒ¹é…ï¼ŒåŸºäºMQçš„æ¶ˆæ¯å¤´åŒ¹é…ï¼Œç”¨çš„è¾ƒå°‘ã€‚</p></li></ul><p>è¯¾å ‚ä¸­ï¼Œæˆ‘ä»¬è®²è§£å‰é¢çš„ä¸‰ç§äº¤æ¢æœºæ¨¡å¼ã€‚</p><h2 id="3-5-Fanoutäº¤æ¢æœº">3.5.Fanoutäº¤æ¢æœº</h2><p>Fanoutï¼Œè‹±æ–‡ç¿»è¯‘æ˜¯æ‰‡å‡ºï¼Œæˆ‘è§‰å¾—åœ¨MQä¸­å«å¹¿æ’­æ›´åˆé€‚ã€‚</p><p>åœ¨å¹¿æ’­æ¨¡å¼ä¸‹ï¼Œæ¶ˆæ¯å‘é€æµç¨‹æ˜¯è¿™æ ·çš„ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/Z0PrbLnmnocBcyx8Xn0cyIShnjb-175603011395650.png" alt=""></p><ul><li><p>1ï¼‰  å¯ä»¥æœ‰å¤šä¸ªé˜Ÿåˆ—</p></li><li><p>2ï¼‰  æ¯ä¸ªé˜Ÿåˆ—éƒ½è¦ç»‘å®šåˆ°Exchangeï¼ˆäº¤æ¢æœºï¼‰</p></li><li><p>3ï¼‰  ç”Ÿäº§è€…å‘é€çš„æ¶ˆæ¯ï¼Œåªèƒ½å‘é€åˆ°äº¤æ¢æœº</p></li><li><p>4ï¼‰  äº¤æ¢æœºæŠŠæ¶ˆæ¯å‘é€ç»™ç»‘å®šè¿‡çš„æ‰€æœ‰é˜Ÿåˆ—</p></li><li><p>5ï¼‰  è®¢é˜…é˜Ÿåˆ—çš„æ¶ˆè´¹è€…éƒ½èƒ½æ‹¿åˆ°æ¶ˆæ¯</p></li></ul><p>æˆ‘ä»¬çš„è®¡åˆ’æ˜¯è¿™æ ·çš„ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/Reynb5FGbosgNVxHA1HclKlAnfg-175603011395652.png" alt=""></p><ul><li><p>åˆ›å»ºä¸€ä¸ªåä¸º<code> hmall.fanout</code>çš„äº¤æ¢æœºï¼Œç±»å‹æ˜¯<code>Fanout</code></p></li><li><p>åˆ›å»ºä¸¤ä¸ªé˜Ÿåˆ—<code>fanout.queue1</code>å’Œ<code>fanout.queue2</code>ï¼Œç»‘å®šåˆ°äº¤æ¢æœº<code>hmall.fanout</code></p></li></ul><h3 id="3-5-1-å£°æ˜é˜Ÿåˆ—å’Œäº¤æ¢æœº">3.5.1.å£°æ˜é˜Ÿåˆ—å’Œäº¤æ¢æœº</h3><p>åœ¨æ§åˆ¶å°åˆ›å»ºé˜Ÿåˆ—<code>fanout.queue1</code>:</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/TvF5bHPaWowb7exZc6LcFhsPnSr-175603011395651.png" alt=""></p><p>åœ¨åˆ›å»ºä¸€ä¸ªé˜Ÿåˆ—<code>fanout.queue2</code>ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/U4PnbzhFtogqyIxrvOycO9xLnOe-175603011395654.png" alt=""></p><p>ç„¶åå†åˆ›å»ºä¸€ä¸ªäº¤æ¢æœºï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/Jpc3b21AmodhVdx1pdIceYV7nHg-175603011395653.png" alt=""></p><p>ç„¶åç»‘å®šä¸¤ä¸ªé˜Ÿåˆ—åˆ°äº¤æ¢æœºï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/MlREb8DvBoFHmJxFiEJciMLVn8b-175603011395655.png" alt=""></p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/ReCibIyUDoZbmXx4rJecltt7n6f-175603011395656.png" alt=""></p><h3 id="3-5-2-æ¶ˆæ¯å‘é€">3.5.2.æ¶ˆæ¯å‘é€</h3><p>åœ¨publisheræœåŠ¡çš„SpringAmqpTestç±»ä¸­æ·»åŠ æµ‹è¯•æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testFanoutExchange</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// äº¤æ¢æœºåç§°</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">exchangeName</span> <span class="operator">=</span> <span class="string">&quot;hmall.fanout&quot;</span>;</span><br><span class="line">    <span class="comment">// æ¶ˆæ¯</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">&quot;hello, everyone!&quot;</span>;</span><br><span class="line">    rabbitTemplate.convertAndSend(exchangeName, <span class="string">&quot;&quot;</span>, message);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-5-3-æ¶ˆæ¯æ¥æ”¶">3.5.3.æ¶ˆæ¯æ¥æ”¶</h3><p>åœ¨consumeræœåŠ¡çš„SpringRabbitListenerä¸­æ·»åŠ ä¸¤ä¸ªæ–¹æ³•ï¼Œä½œä¸ºæ¶ˆè´¹è€…ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RabbitListener(queues = &quot;fanout.queue1&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenFanoutQueue1</span><span class="params">(String msg)</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;æ¶ˆè´¹è€…1æ¥æ”¶åˆ°Fanoutæ¶ˆæ¯ï¼šã€&quot;</span> + msg + <span class="string">&quot;ã€‘&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RabbitListener(queues = &quot;fanout.queue2&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenFanoutQueue2</span><span class="params">(String msg)</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;æ¶ˆè´¹è€…2æ¥æ”¶åˆ°Fanoutæ¶ˆæ¯ï¼šã€&quot;</span> + msg + <span class="string">&quot;ã€‘&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-5-4-æ€»ç»“">3.5.4.æ€»ç»“</h3><p>äº¤æ¢æœºçš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</p><ul><li><p>æ¥æ”¶publisherå‘é€çš„æ¶ˆæ¯</p></li><li><p>å°†æ¶ˆæ¯æŒ‰ç…§è§„åˆ™è·¯ç”±åˆ°ä¸ä¹‹ç»‘å®šçš„é˜Ÿåˆ—</p></li><li><p>ä¸èƒ½ç¼“å­˜æ¶ˆæ¯ï¼Œè·¯ç”±å¤±è´¥ï¼Œæ¶ˆæ¯ä¸¢å¤±</p></li><li><p>FanoutExchangeçš„ä¼šå°†æ¶ˆæ¯è·¯ç”±åˆ°æ¯ä¸ªç»‘å®šçš„é˜Ÿåˆ—</p></li></ul><h2 id="3-6-Directäº¤æ¢æœº">3.6.Directäº¤æ¢æœº</h2><p>åœ¨Fanoutæ¨¡å¼ä¸­ï¼Œä¸€æ¡æ¶ˆæ¯ï¼Œä¼šè¢«æ‰€æœ‰è®¢é˜…çš„é˜Ÿåˆ—éƒ½æ¶ˆè´¹ã€‚ä½†æ˜¯ï¼Œåœ¨æŸäº›åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬å¸Œæœ›ä¸åŒçš„æ¶ˆæ¯è¢«ä¸åŒçš„é˜Ÿåˆ—æ¶ˆè´¹ã€‚è¿™æ—¶å°±è¦ç”¨åˆ°Directç±»å‹çš„Exchangeã€‚</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/El3hbCOh3ohMT2xatZJcpcqwnDc-175603011395657.png" alt=""></p><p>åœ¨Directæ¨¡å‹ä¸‹ï¼š</p><ul><li><p>é˜Ÿåˆ—ä¸äº¤æ¢æœºçš„ç»‘å®šï¼Œä¸èƒ½æ˜¯ä»»æ„ç»‘å®šäº†ï¼Œè€Œæ˜¯è¦æŒ‡å®šä¸€ä¸ª<code>RoutingKey</code>ï¼ˆè·¯ç”±keyï¼‰</p></li><li><p>æ¶ˆæ¯çš„å‘é€æ–¹åœ¨ å‘ Exchangeå‘é€æ¶ˆæ¯æ—¶ï¼Œä¹Ÿå¿…é¡»æŒ‡å®šæ¶ˆæ¯çš„ <code>RoutingKey</code>ã€‚</p></li><li><p>Exchangeä¸å†æŠŠæ¶ˆæ¯äº¤ç»™æ¯ä¸€ä¸ªç»‘å®šçš„é˜Ÿåˆ—ï¼Œè€Œæ˜¯æ ¹æ®æ¶ˆæ¯çš„<code>Routing Key</code>è¿›è¡Œåˆ¤æ–­ï¼Œåªæœ‰é˜Ÿåˆ—çš„<code>Routingkey</code>ä¸æ¶ˆæ¯çš„ <code>Routing key</code>å®Œå…¨ä¸€è‡´ï¼Œæ‰ä¼šæ¥æ”¶åˆ°æ¶ˆæ¯</p></li></ul><p><strong>æ¡ˆä¾‹éœ€æ±‚å¦‚å›¾</strong>ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/SschbFsTao91PvxfZWKc6L54nkd-175603011395658.png" alt=""></p><ol><li><p> å£°æ˜ä¸€ä¸ªåä¸º<code>hmall.direct</code>çš„äº¤æ¢æœº</p></li><li><p>å£°æ˜é˜Ÿåˆ—<code>direct.queue1</code>ï¼Œç»‘å®š<code>hmall.direct</code>ï¼Œ<code>bindingKey</code>ä¸º<code>blud</code>å’Œ<code>red</code></p></li><li><p>å£°æ˜é˜Ÿåˆ—<code>direct.queue2</code>ï¼Œç»‘å®š<code>hmall.direct</code>ï¼Œ<code>bindingKey</code>ä¸º<code>yellow</code>å’Œ<code>red</code></p></li><li><p> åœ¨<code>consumer</code>æœåŠ¡ä¸­ï¼Œç¼–å†™ä¸¤ä¸ªæ¶ˆè´¹è€…æ–¹æ³•ï¼Œåˆ†åˆ«ç›‘å¬direct.queue1å’Œdirect.queue2 </p></li><li><p> åœ¨publisherä¸­ç¼–å†™æµ‹è¯•æ–¹æ³•ï¼Œå‘<code>hmall.direct</code>å‘é€æ¶ˆæ¯ </p></li></ol><h3 id="3-6-1-å£°æ˜é˜Ÿåˆ—å’Œäº¤æ¢æœº">3.6.1.å£°æ˜é˜Ÿåˆ—å’Œäº¤æ¢æœº</h3><p>é¦–å…ˆåœ¨æ§åˆ¶å°å£°æ˜ä¸¤ä¸ªé˜Ÿåˆ—<code>direct.queue1</code>å’Œ<code>direct.queue2</code>ï¼Œè¿™é‡Œä¸å†å±•ç¤ºè¿‡ç¨‹ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/XeRPbclP1odEO1xa22Hc50Non6p-175603011395659.png" alt=""></p><p>ç„¶åå£°æ˜ä¸€ä¸ªdirectç±»å‹çš„äº¤æ¢æœºï¼Œå‘½åä¸º<code>hmall.direct</code>:</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/SvpDbCaV8oXzzpx4oUScSftLnzf-175603011395660.png" alt=""></p><p>ç„¶åä½¿ç”¨<code>red</code>å’Œ<code>blue</code>ä½œä¸ºkeyï¼Œç»‘å®š<code>direct.queue1</code>åˆ°<code>hmall.direct</code>ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/UIjhbp9j8op6Uux1MaqcxAF7nEg-175603011395661.png" alt=""></p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/Ua6Nb5S5yoV2dGxOm5gcGFNonBb-175603011395662.png" alt=""></p><p>åŒç†ï¼Œä½¿ç”¨<code>red</code>å’Œ<code>yellow</code>ä½œä¸ºkeyï¼Œç»‘å®š<code>direct.queue2</code>åˆ°<code>hmall.direct</code>ï¼Œæ­¥éª¤ç•¥ï¼Œæœ€ç»ˆç»“æœï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/ChembAGFOoGUquxlMvhcJcn7nCg-175603011395663.png" alt=""></p><h3 id="3-6-2-æ¶ˆæ¯æ¥æ”¶">3.6.2.æ¶ˆæ¯æ¥æ”¶</h3><p>åœ¨consumeræœåŠ¡çš„SpringRabbitListenerä¸­æ·»åŠ æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RabbitListener(queues = &quot;direct.queue1&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenDirectQueue1</span><span class="params">(String msg)</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;æ¶ˆè´¹è€…1æ¥æ”¶åˆ°direct.queue1çš„æ¶ˆæ¯ï¼šã€&quot;</span> + msg + <span class="string">&quot;ã€‘&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RabbitListener(queues = &quot;direct.queue2&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenDirectQueue2</span><span class="params">(String msg)</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;æ¶ˆè´¹è€…2æ¥æ”¶åˆ°direct.queue2çš„æ¶ˆæ¯ï¼šã€&quot;</span> + msg + <span class="string">&quot;ã€‘&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-6-3-æ¶ˆæ¯å‘é€">3.6.3.æ¶ˆæ¯å‘é€</h3><p>åœ¨publisheræœåŠ¡çš„SpringAmqpTestç±»ä¸­æ·»åŠ æµ‹è¯•æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSendDirectExchange</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// äº¤æ¢æœºåç§°</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">exchangeName</span> <span class="operator">=</span> <span class="string">&quot;hmall.direct&quot;</span>;</span><br><span class="line">    <span class="comment">// æ¶ˆæ¯</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">&quot;çº¢è‰²è­¦æŠ¥ï¼æ—¥æœ¬ä¹±æ’æ ¸åºŸæ°´ï¼Œå¯¼è‡´æµ·æ´‹ç”Ÿç‰©å˜å¼‚ï¼ŒæƒŠç°å“¥æ–¯æ‹‰ï¼&quot;</span>;</span><br><span class="line">    <span class="comment">// å‘é€æ¶ˆæ¯</span></span><br><span class="line">    rabbitTemplate.convertAndSend(exchangeName, <span class="string">&quot;red&quot;</span>, message);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”±äºä½¿ç”¨çš„redè¿™ä¸ªkeyï¼Œæ‰€ä»¥ä¸¤ä¸ªæ¶ˆè´¹è€…éƒ½æ”¶åˆ°äº†æ¶ˆæ¯ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/QrjCbcq13oBpB3x9uoxcvK0mngh-175603011395664.png" alt=""></p><p>æˆ‘ä»¬å†åˆ‡æ¢ä¸ºblueè¿™ä¸ªkeyï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSendDirectExchange</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// äº¤æ¢æœºåç§°</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">exchangeName</span> <span class="operator">=</span> <span class="string">&quot;hmall.direct&quot;</span>;</span><br><span class="line">    <span class="comment">// æ¶ˆæ¯</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">&quot;æœ€æ–°æŠ¥é“ï¼Œå“¥æ–¯æ‹‰æ˜¯å±…æ°‘è‡ªæ²»å·¨å‹æ°”çƒï¼Œè™šæƒŠä¸€åœºï¼&quot;</span>;</span><br><span class="line">    <span class="comment">// å‘é€æ¶ˆæ¯</span></span><br><span class="line">    rabbitTemplate.convertAndSend(exchangeName, <span class="string">&quot;blue&quot;</span>, message);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½ ä¼šå‘ç°ï¼Œåªæœ‰æ¶ˆè´¹è€…1æ”¶åˆ°äº†æ¶ˆæ¯ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/YyVGb2Z7BoWu2exjQGMc15BRnwf-175603011395665.png" alt=""></p><h3 id="3-6-4-æ€»ç»“">3.6.4.æ€»ç»“</h3><p>æè¿°ä¸‹Directäº¤æ¢æœºä¸Fanoutäº¤æ¢æœºçš„å·®å¼‚ï¼Ÿ</p><ul><li><p>Fanoutäº¤æ¢æœºå°†æ¶ˆæ¯è·¯ç”±ç»™æ¯ä¸€ä¸ªä¸ä¹‹ç»‘å®šçš„é˜Ÿåˆ—</p></li><li><p>Directäº¤æ¢æœºæ ¹æ®RoutingKeyåˆ¤æ–­è·¯ç”±ç»™å“ªä¸ªé˜Ÿåˆ—</p></li><li><p>å¦‚æœå¤šä¸ªé˜Ÿåˆ—å…·æœ‰ç›¸åŒçš„RoutingKeyï¼Œåˆ™ä¸FanoutåŠŸèƒ½ç±»ä¼¼</p></li></ul><h2 id="3-7-Topicäº¤æ¢æœº">3.7.Topicäº¤æ¢æœº</h2><h3 id="3-7-1-è¯´æ˜">3.7.1.è¯´æ˜</h3><p><code>Topic</code>ç±»å‹çš„<code>Exchange</code>ä¸<code>Direct</code>ç›¸æ¯”ï¼Œéƒ½æ˜¯å¯ä»¥æ ¹æ®<code>RoutingKey</code>æŠŠæ¶ˆæ¯è·¯ç”±åˆ°ä¸åŒçš„é˜Ÿåˆ—ã€‚</p><p>åªä¸è¿‡<code>Topic</code>ç±»å‹<code>Exchange</code>å¯ä»¥è®©é˜Ÿåˆ—åœ¨ç»‘å®š<code>BindingKey</code> çš„æ—¶å€™ä½¿ç”¨é€šé…ç¬¦ï¼</p><p><code>BindingKey</code> ä¸€èˆ¬éƒ½æ˜¯æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªå•è¯ç»„æˆï¼Œå¤šä¸ªå•è¯ä¹‹é—´ä»¥<code>.</code>åˆ†å‰²ï¼Œä¾‹å¦‚ï¼š <code>item.insert</code></p><p>é€šé…ç¬¦è§„åˆ™ï¼š</p><ul><li><p><code>#</code>ï¼šåŒ¹é…ä¸€ä¸ªæˆ–å¤šä¸ªè¯</p></li><li><p><code>*</code>ï¼šåŒ¹é…ä¸å¤šä¸å°‘æ°å¥½1ä¸ªè¯</p></li></ul><p>ä¸¾ä¾‹ï¼š</p><ul><li><p><code>item.#</code>ï¼šèƒ½å¤ŸåŒ¹é…<code>item.spu.insert</code> æˆ–è€… <code>item.spu</code></p></li><li><p><code>item.*</code>ï¼šåªèƒ½åŒ¹é…<code>item.spu</code></p></li></ul><p>å›¾ç¤ºï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/QFzzbeUUjoVf0RxfS1AcgT7LnUe-175603011395667.png" alt=""></p><p>å‡å¦‚æ­¤æ—¶publisherå‘é€çš„æ¶ˆæ¯ä½¿ç”¨çš„<code>RoutingKey</code>å…±æœ‰å››ç§ï¼š</p><ul><li><p><code>china.news </code>ä»£è¡¨æœ‰ä¸­å›½çš„æ–°é—»æ¶ˆæ¯ï¼›</p></li><li><p><code>china.weather</code> ä»£è¡¨ä¸­å›½çš„å¤©æ°”æ¶ˆæ¯ï¼›</p></li><li><p><code>japan.news</code> åˆ™ä»£è¡¨æ—¥æœ¬æ–°é—»</p></li><li><p><code>japan.weather</code> ä»£è¡¨æ—¥æœ¬çš„å¤©æ°”æ¶ˆæ¯ï¼›</p></li></ul><p>è§£é‡Šï¼š</p><ul><li><p><code>topic.queue1</code>ï¼šç»‘å®šçš„æ˜¯<code>china.#</code> ï¼Œå‡¡æ˜¯ä»¥ <code>china.</code>å¼€å¤´çš„<code>routing key</code> éƒ½ä¼šè¢«åŒ¹é…åˆ°ï¼ŒåŒ…æ‹¬ï¼š</p><ul><li><p><code>china.news</code></p></li><li><p><code>china.weather</code></p></li></ul></li><li><p><code>topic.queue2</code>ï¼šç»‘å®šçš„æ˜¯<code>#.news</code> ï¼Œå‡¡æ˜¯ä»¥ <code>.news</code>ç»“å°¾çš„ <code>routing key</code> éƒ½ä¼šè¢«åŒ¹é…ã€‚åŒ…æ‹¬:</p><ul><li><p><code>china.news</code></p></li><li><p><code>japan.news</code></p></li></ul></li></ul><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±æŒ‰ç…§ä¸Šå›¾æ‰€ç¤ºï¼Œæ¥æ¼”ç¤ºä¸€ä¸‹Topicäº¤æ¢æœºçš„ç”¨æ³•ã€‚</p><p>é¦–å…ˆï¼Œåœ¨æ§åˆ¶å°æŒ‰ç…§å›¾ç¤ºä¾‹å­åˆ›å»ºé˜Ÿåˆ—ã€äº¤æ¢æœºï¼Œå¹¶åˆ©ç”¨é€šé…ç¬¦ç»‘å®šé˜Ÿåˆ—å’Œäº¤æ¢æœºã€‚æ­¤å¤„æ­¥éª¤ç•¥ã€‚æœ€ç»ˆç»“æœå¦‚ä¸‹ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/H2ZubsD1woeetoxIHMjcuFRanJd-175603011395666.png" alt=""></p><h3 id="3-7-2-æ¶ˆæ¯å‘é€">3.7.2.æ¶ˆæ¯å‘é€</h3><p>åœ¨publisheræœåŠ¡çš„SpringAmqpTestç±»ä¸­æ·»åŠ æµ‹è¯•æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * topicExchange</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSendTopicExchange</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// äº¤æ¢æœºåç§°</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">exchangeName</span> <span class="operator">=</span> <span class="string">&quot;hmall.topic&quot;</span>;</span><br><span class="line">    <span class="comment">// æ¶ˆæ¯</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">&quot;å–œæŠ¥ï¼å­™æ‚Ÿç©ºå¤§æˆ˜å“¥æ–¯æ‹‰ï¼Œèƒœ!&quot;</span>;</span><br><span class="line">    <span class="comment">// å‘é€æ¶ˆæ¯</span></span><br><span class="line">    rabbitTemplate.convertAndSend(exchangeName, <span class="string">&quot;china.news&quot;</span>, message);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-7-3-æ¶ˆæ¯æ¥æ”¶">3.7.3.æ¶ˆæ¯æ¥æ”¶</h3><p>åœ¨consumeræœåŠ¡çš„SpringRabbitListenerä¸­æ·»åŠ æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RabbitListener(queues = &quot;topic.queue1&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenTopicQueue1</span><span class="params">(String msg)</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;æ¶ˆè´¹è€…1æ¥æ”¶åˆ°topic.queue1çš„æ¶ˆæ¯ï¼šã€&quot;</span> + msg + <span class="string">&quot;ã€‘&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RabbitListener(queues = &quot;topic.queue2&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenTopicQueue2</span><span class="params">(String msg)</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;æ¶ˆè´¹è€…2æ¥æ”¶åˆ°topic.queue2çš„æ¶ˆæ¯ï¼šã€&quot;</span> + msg + <span class="string">&quot;ã€‘&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-7-4-æ€»ç»“">3.7.4.æ€»ç»“</h3><p>æè¿°ä¸‹Directäº¤æ¢æœºä¸Topicäº¤æ¢æœºçš„å·®å¼‚ï¼Ÿ</p><ul><li><p>Topicäº¤æ¢æœºæ¥æ”¶çš„æ¶ˆæ¯RoutingKeyå¿…é¡»æ˜¯å¤šä¸ªå•è¯ï¼Œä»¥ <strong><code>.</code></strong> åˆ†å‰²</p></li><li><p>Topicäº¤æ¢æœºä¸é˜Ÿåˆ—ç»‘å®šæ—¶çš„bindingKeyå¯ä»¥æŒ‡å®šé€šé…ç¬¦</p></li><li><p><code>#</code>ï¼šä»£è¡¨0ä¸ªæˆ–å¤šä¸ªè¯</p></li><li><p><code>*</code>ï¼šä»£è¡¨1ä¸ªè¯</p></li></ul><h2 id="3-8-å£°æ˜é˜Ÿåˆ—å’Œäº¤æ¢æœº">3.8.å£°æ˜é˜Ÿåˆ—å’Œäº¤æ¢æœº</h2><p>åœ¨ä¹‹å‰æˆ‘ä»¬éƒ½æ˜¯åŸºäºRabbitMQæ§åˆ¶å°æ¥åˆ›å»ºé˜Ÿåˆ—ã€äº¤æ¢æœºã€‚ä½†æ˜¯åœ¨å®é™…å¼€å‘æ—¶ï¼Œé˜Ÿåˆ—å’Œäº¤æ¢æœºæ˜¯ç¨‹åºå‘˜å®šä¹‰çš„ï¼Œå°†æ¥é¡¹ç›®ä¸Šçº¿ï¼Œåˆè¦äº¤ç»™è¿ç»´å»åˆ›å»ºã€‚é‚£ä¹ˆç¨‹åºå‘˜å°±éœ€è¦æŠŠç¨‹åºä¸­è¿è¡Œçš„æ‰€æœ‰é˜Ÿåˆ—å’Œäº¤æ¢æœºéƒ½å†™ä¸‹æ¥ï¼Œäº¤ç»™è¿ç»´ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­æ˜¯å¾ˆå®¹æ˜“å‡ºç°é”™è¯¯çš„ã€‚</p><p>å› æ­¤æ¨èçš„åšæ³•æ˜¯ç”±ç¨‹åºå¯åŠ¨æ—¶æ£€æŸ¥é˜Ÿåˆ—å’Œäº¤æ¢æœºæ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨è‡ªåŠ¨åˆ›å»ºã€‚</p><h3 id="3-8-1-åŸºæœ¬API">3.8.1.åŸºæœ¬API</h3><p>SpringAMQPæä¾›äº†ä¸€ä¸ªQueueç±»ï¼Œç”¨æ¥åˆ›å»ºé˜Ÿåˆ—ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/LMnRbQuaIoHHrkxByzLcsSPFnjh-175603011395668.png" alt=""></p><p>SpringAMQPè¿˜æä¾›äº†ä¸€ä¸ªExchangeæ¥å£ï¼Œæ¥è¡¨ç¤ºæ‰€æœ‰ä¸åŒç±»å‹çš„äº¤æ¢æœºï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/RwxPbRd0boAOLhxx6qzcXQPqnKd-175603011395669.png" alt=""></p><p>æˆ‘ä»¬å¯ä»¥è‡ªå·±åˆ›å»ºé˜Ÿåˆ—å’Œäº¤æ¢æœºï¼Œä¸è¿‡SpringAMQPè¿˜æä¾›äº†ExchangeBuilderæ¥ç®€åŒ–è¿™ä¸ªè¿‡ç¨‹ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/JDYsbeQn2o2P81xGpvOc5znfn7b-175603011395670.png" alt=""></p><p>è€Œåœ¨ç»‘å®šé˜Ÿåˆ—å’Œäº¤æ¢æœºæ—¶ï¼Œåˆ™éœ€è¦ä½¿ç”¨BindingBuilderæ¥åˆ›å»ºBindingå¯¹è±¡ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/XV57bsutQovJ1kxafTUcqsFWnkh-175603011395672.png" alt=""></p><h3 id="3-8-2-fanoutç¤ºä¾‹">3.8.2.fanoutç¤ºä¾‹</h3><p>åœ¨consumerä¸­åˆ›å»ºä¸€ä¸ªç±»ï¼Œå£°æ˜é˜Ÿåˆ—å’Œäº¤æ¢æœºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.consumer.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.core.Binding;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.core.BindingBuilder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.core.FanoutExchange;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.core.Queue;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FanoutConfig</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å£°æ˜äº¤æ¢æœº</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> Fanoutç±»å‹äº¤æ¢æœº</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> FanoutExchange <span class="title function_">fanoutExchange</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">FanoutExchange</span>(<span class="string">&quot;hmall.fanout&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç¬¬1ä¸ªé˜Ÿåˆ—</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Queue <span class="title function_">fanoutQueue1</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Queue</span>(<span class="string">&quot;fanout.queue1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç»‘å®šé˜Ÿåˆ—å’Œäº¤æ¢æœº</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Binding <span class="title function_">bindingQueue1</span><span class="params">(Queue fanoutQueue1, FanoutExchange fanoutExchange)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(fanoutQueue1).to(fanoutExchange);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç¬¬2ä¸ªé˜Ÿåˆ—</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Queue <span class="title function_">fanoutQueue2</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Queue</span>(<span class="string">&quot;fanout.queue2&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç»‘å®šé˜Ÿåˆ—å’Œäº¤æ¢æœº</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Binding <span class="title function_">bindingQueue2</span><span class="params">(Queue fanoutQueue2, FanoutExchange fanoutExchange)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(fanoutQueue2).to(fanoutExchange);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-8-2-directç¤ºä¾‹">3.8.2.directç¤ºä¾‹</h3><p>directæ¨¡å¼ç”±äºè¦ç»‘å®šå¤šä¸ªKEYï¼Œä¼šéå¸¸éº»çƒ¦ï¼Œæ¯ä¸€ä¸ªKeyéƒ½è¦ç¼–å†™ä¸€ä¸ªbindingï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.consumer.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.core.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DirectConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å£°æ˜äº¤æ¢æœº</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> Directç±»å‹äº¤æ¢æœº</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> DirectExchange <span class="title function_">directExchange</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ExchangeBuilder.directExchange(<span class="string">&quot;hmall.direct&quot;</span>).build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç¬¬1ä¸ªé˜Ÿåˆ—</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Queue <span class="title function_">directQueue1</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Queue</span>(<span class="string">&quot;direct.queue1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç»‘å®šé˜Ÿåˆ—å’Œäº¤æ¢æœº</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Binding <span class="title function_">bindingQueue1WithRed</span><span class="params">(Queue directQueue1, DirectExchange directExchange)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(directQueue1).to(directExchange).with(<span class="string">&quot;red&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç»‘å®šé˜Ÿåˆ—å’Œäº¤æ¢æœº</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Binding <span class="title function_">bindingQueue1WithBlue</span><span class="params">(Queue directQueue1, DirectExchange directExchange)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(directQueue1).to(directExchange).with(<span class="string">&quot;blue&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç¬¬2ä¸ªé˜Ÿåˆ—</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Queue <span class="title function_">directQueue2</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Queue</span>(<span class="string">&quot;direct.queue2&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç»‘å®šé˜Ÿåˆ—å’Œäº¤æ¢æœº</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Binding <span class="title function_">bindingQueue2WithRed</span><span class="params">(Queue directQueue2, DirectExchange directExchange)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(directQueue2).to(directExchange).with(<span class="string">&quot;red&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç»‘å®šé˜Ÿåˆ—å’Œäº¤æ¢æœº</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Binding <span class="title function_">bindingQueue2WithYellow</span><span class="params">(Queue directQueue2, DirectExchange directExchange)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(directQueue2).to(directExchange).with(<span class="string">&quot;yellow&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-8-4-åŸºäºæ³¨è§£å£°æ˜">3.8.4.åŸºäºæ³¨è§£å£°æ˜</h3><p>åŸºäº@Beançš„æ–¹å¼å£°æ˜é˜Ÿåˆ—å’Œäº¤æ¢æœºæ¯”è¾ƒéº»çƒ¦ï¼ŒSpringè¿˜æä¾›äº†åŸºäºæ³¨è§£æ–¹å¼æ¥å£°æ˜ã€‚</p><p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬åŒæ ·å£°æ˜Directæ¨¡å¼çš„äº¤æ¢æœºå’Œé˜Ÿåˆ—ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RabbitListener(bindings = @QueueBinding(</span></span><br><span class="line"><span class="meta">    value = @Queue(name = &quot;direct.queue1&quot;),</span></span><br><span class="line"><span class="meta">    exchange = @Exchange(name = &quot;hmall.direct&quot;, type = ExchangeTypes.DIRECT),</span></span><br><span class="line"><span class="meta">    key = &#123;&quot;red&quot;, &quot;blue&quot;&#125;</span></span><br><span class="line"><span class="meta">))</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenDirectQueue1</span><span class="params">(String msg)</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;æ¶ˆè´¹è€…1æ¥æ”¶åˆ°direct.queue1çš„æ¶ˆæ¯ï¼šã€&quot;</span> + msg + <span class="string">&quot;ã€‘&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RabbitListener(bindings = @QueueBinding(</span></span><br><span class="line"><span class="meta">    value = @Queue(name = &quot;direct.queue2&quot;),</span></span><br><span class="line"><span class="meta">    exchange = @Exchange(name = &quot;hmall.direct&quot;, type = ExchangeTypes.DIRECT),</span></span><br><span class="line"><span class="meta">    key = &#123;&quot;red&quot;, &quot;yellow&quot;&#125;</span></span><br><span class="line"><span class="meta">))</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenDirectQueue2</span><span class="params">(String msg)</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;æ¶ˆè´¹è€…2æ¥æ”¶åˆ°direct.queue2çš„æ¶ˆæ¯ï¼šã€&quot;</span> + msg + <span class="string">&quot;ã€‘&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ˜¯ä¸æ˜¯ç®€å•å¤šäº†ã€‚</p><p>å†è¯•è¯•Topicæ¨¡å¼ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RabbitListener(bindings = @QueueBinding(</span></span><br><span class="line"><span class="meta">    value = @Queue(name = &quot;topic.queue1&quot;),</span></span><br><span class="line"><span class="meta">    exchange = @Exchange(name = &quot;hmall.topic&quot;, type = ExchangeTypes.TOPIC),</span></span><br><span class="line"><span class="meta">    key = &quot;china.#&quot;</span></span><br><span class="line"><span class="meta">))</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenTopicQueue1</span><span class="params">(String msg)</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;æ¶ˆè´¹è€…1æ¥æ”¶åˆ°topic.queue1çš„æ¶ˆæ¯ï¼šã€&quot;</span> + msg + <span class="string">&quot;ã€‘&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RabbitListener(bindings = @QueueBinding(</span></span><br><span class="line"><span class="meta">    value = @Queue(name = &quot;topic.queue2&quot;),</span></span><br><span class="line"><span class="meta">    exchange = @Exchange(name = &quot;hmall.topic&quot;, type = ExchangeTypes.TOPIC),</span></span><br><span class="line"><span class="meta">    key = &quot;#.news&quot;</span></span><br><span class="line"><span class="meta">))</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenTopicQueue2</span><span class="params">(String msg)</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;æ¶ˆè´¹è€…2æ¥æ”¶åˆ°topic.queue2çš„æ¶ˆæ¯ï¼šã€&quot;</span> + msg + <span class="string">&quot;ã€‘&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-9-æ¶ˆæ¯è½¬æ¢å™¨">3.9.æ¶ˆæ¯è½¬æ¢å™¨</h2><p>Springçš„æ¶ˆæ¯å‘é€ä»£ç æ¥æ”¶çš„æ¶ˆæ¯ä½“æ˜¯ä¸€ä¸ªObjectï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/AEDob0gXNozbGTxWbXGceQV3nAf-175603011395671.png" alt=""></p><p>è€Œåœ¨æ•°æ®ä¼ è¾“æ—¶ï¼Œå®ƒä¼šæŠŠä½ å‘é€çš„æ¶ˆæ¯åºåˆ—åŒ–ä¸ºå­—èŠ‚å‘é€ç»™MQï¼Œæ¥æ”¶æ¶ˆæ¯çš„æ—¶å€™ï¼Œè¿˜ä¼šæŠŠå­—èŠ‚ååºåˆ—åŒ–ä¸ºJavaå¯¹è±¡ã€‚</p><p>åªä¸è¿‡ï¼Œé»˜è®¤æƒ…å†µä¸‹Springé‡‡ç”¨çš„åºåˆ—åŒ–æ–¹å¼æ˜¯JDKåºåˆ—åŒ–ã€‚ä¼—æ‰€å‘¨çŸ¥ï¼ŒJDKåºåˆ—åŒ–å­˜åœ¨ä¸‹åˆ—é—®é¢˜ï¼š</p><ul><li><p>æ•°æ®ä½“ç§¯è¿‡å¤§</p></li><li><p>æœ‰å®‰å…¨æ¼æ´</p></li><li><p>å¯è¯»æ€§å·®</p></li></ul><p>æˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹ã€‚</p><h3 id="3-9-1-æµ‹è¯•é»˜è®¤è½¬æ¢å™¨">3.9.1.æµ‹è¯•é»˜è®¤è½¬æ¢å™¨</h3><p>1ï¼‰åˆ›å»ºæµ‹è¯•é˜Ÿåˆ—</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬åœ¨consumeræœåŠ¡ä¸­å£°æ˜ä¸€ä¸ªæ–°çš„é…ç½®ç±»ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/UZB0bgLppoZosXxtKvkc1ts6nMh-175603011395673.png" alt=""></p><p>åˆ©ç”¨@Beançš„æ–¹å¼åˆ›å»ºä¸€ä¸ªé˜Ÿåˆ—ï¼Œ</p><p>å…·ä½“ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.consumer.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.core.Queue;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MessageConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Queue <span class="title function_">objectQueue</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Queue</span>(<span class="string">&quot;object.queue&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œè¿™é‡Œæˆ‘ä»¬å…ˆä¸è¦ç»™è¿™ä¸ªé˜Ÿåˆ—æ·»åŠ æ¶ˆè´¹è€…ï¼Œæˆ‘ä»¬è¦æŸ¥çœ‹æ¶ˆæ¯ä½“çš„æ ¼å¼ã€‚</p><p>é‡å¯consumeræœåŠ¡ä»¥åï¼Œè¯¥é˜Ÿåˆ—å°±ä¼šè¢«è‡ªåŠ¨åˆ›å»ºå‡ºæ¥äº†ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/ROnHbyCujojbQ1xYIVlchnNznsh-175603011395674.png" alt=""></p><p>2ï¼‰å‘é€æ¶ˆæ¯</p><p>æˆ‘ä»¬åœ¨publisheræ¨¡å—çš„SpringAmqpTestä¸­æ–°å¢ä¸€ä¸ªæ¶ˆæ¯å‘é€çš„ä»£ç ï¼Œå‘é€ä¸€ä¸ªMapå¯¹è±¡ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSendMap</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    <span class="comment">// å‡†å¤‡æ¶ˆæ¯</span></span><br><span class="line">    Map&lt;String,Object&gt; msg = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    msg.put(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;æŸ³å²©&quot;</span>);</span><br><span class="line">    msg.put(<span class="string">&quot;age&quot;</span>, <span class="number">21</span>);</span><br><span class="line">    <span class="comment">// å‘é€æ¶ˆæ¯</span></span><br><span class="line">    rabbitTemplate.convertAndSend(<span class="string">&quot;object.queue&quot;</span>, msg);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å‘é€æ¶ˆæ¯åæŸ¥çœ‹æ§åˆ¶å°ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/QPu1bYlfHot8wmxXxp8cB9Qzn9d-175603011395675.png" alt=""></p><p>å¯ä»¥çœ‹åˆ°æ¶ˆæ¯æ ¼å¼éå¸¸ä¸å‹å¥½ã€‚</p><h3 id="3-9-2-é…ç½®JSONè½¬æ¢å™¨">3.9.2.é…ç½®JSONè½¬æ¢å™¨</h3><p>æ˜¾ç„¶ï¼ŒJDKåºåˆ—åŒ–æ–¹å¼å¹¶ä¸åˆé€‚ã€‚æˆ‘ä»¬å¸Œæœ›æ¶ˆæ¯ä½“çš„ä½“ç§¯æ›´å°ã€å¯è¯»æ€§æ›´é«˜ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨JSONæ–¹å¼æ¥åšåºåˆ—åŒ–å’Œååºåˆ—åŒ–ã€‚</p><p>åœ¨<code>publisher</code>å’Œ<code>consumer</code>ä¸¤ä¸ªæœåŠ¡ä¸­éƒ½å¼•å…¥ä¾èµ–ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.dataformat<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-dataformat-xml<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.10<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œå¦‚æœé¡¹ç›®ä¸­å¼•å…¥äº†<code>spring-boot-starter-web</code>ä¾èµ–ï¼Œåˆ™æ— éœ€å†æ¬¡å¼•å…¥<code>Jackson</code>ä¾èµ–ã€‚</p><p>é…ç½®æ¶ˆæ¯è½¬æ¢å™¨ï¼Œåœ¨<code>publisher</code>å’Œ<code>consumer</code>ä¸¤ä¸ªæœåŠ¡çš„å¯åŠ¨ç±»ä¸­æ·»åŠ ä¸€ä¸ªBeanå³å¯ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> MessageConverter <span class="title function_">messageConverter</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">// 1.å®šä¹‰æ¶ˆæ¯è½¬æ¢å™¨</span></span><br><span class="line">    <span class="type">Jackson2JsonMessageConverter</span> <span class="variable">jackson2JsonMessageConverter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Jackson2JsonMessageConverter</span>();</span><br><span class="line">    <span class="comment">// 2.é…ç½®è‡ªåŠ¨åˆ›å»ºæ¶ˆæ¯idï¼Œç”¨äºè¯†åˆ«ä¸åŒæ¶ˆæ¯ï¼Œä¹Ÿå¯ä»¥åœ¨ä¸šåŠ¡ä¸­åŸºäºIDåˆ¤æ–­æ˜¯å¦æ˜¯é‡å¤æ¶ˆæ¯</span></span><br><span class="line">    jackson2JsonMessageConverter.setCreateMessageIds(<span class="literal">true</span>);</span><br><span class="line">    <span class="keyword">return</span> jackson2JsonMessageConverter;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¶ˆæ¯è½¬æ¢å™¨ä¸­æ·»åŠ çš„messageIdå¯ä»¥ä¾¿äºæˆ‘ä»¬å°†æ¥åšå¹‚ç­‰æ€§åˆ¤æ–­ã€‚</p><p>æ­¤æ—¶ï¼Œæˆ‘ä»¬åˆ°MQæ§åˆ¶å°<strong>åˆ é™¤</strong><code>object.queue</code>ä¸­çš„æ—§çš„æ¶ˆæ¯ã€‚ç„¶åå†æ¬¡æ‰§è¡Œåˆšæ‰çš„æ¶ˆæ¯å‘é€çš„ä»£ç ï¼Œåˆ°MQçš„æ§åˆ¶å°æŸ¥çœ‹æ¶ˆæ¯ç»“æ„ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/AEhhb30KoosYHRxuAQIcHXUSnLh-175603011395677.png" alt=""></p><h3 id="3-9-3-æ¶ˆè´¹è€…æ¥æ”¶Object">3.9.3.æ¶ˆè´¹è€…æ¥æ”¶Object</h3><p>æˆ‘ä»¬åœ¨consumeræœåŠ¡ä¸­å®šä¹‰ä¸€ä¸ªæ–°çš„æ¶ˆè´¹è€…ï¼Œpublisheræ˜¯ç”¨Mapå‘é€ï¼Œé‚£ä¹ˆæ¶ˆè´¹è€…ä¹Ÿä¸€å®šè¦ç”¨Mapæ¥æ”¶ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RabbitListener(queues = &quot;object.queue&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenSimpleQueueMessage</span><span class="params">(Map&lt;String, Object&gt; msg)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;æ¶ˆè´¹è€…æ¥æ”¶åˆ°object.queueæ¶ˆæ¯ï¼šã€&quot;</span> + msg + <span class="string">&quot;ã€‘&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="4-ä¸šåŠ¡æ”¹é€ ">4.ä¸šåŠ¡æ”¹é€ </h1><p>æ¡ˆä¾‹éœ€æ±‚ï¼šæ”¹é€ ä½™é¢æ”¯ä»˜åŠŸèƒ½ï¼Œå°†æ”¯ä»˜æˆåŠŸååŸºäºOpenFeignçš„äº¤æ˜“æœåŠ¡çš„æ›´æ–°è®¢å•çŠ¶æ€æ¥å£çš„åŒæ­¥è°ƒç”¨ï¼Œæ”¹ä¸ºåŸºäºRabbitMQçš„å¼‚æ­¥é€šçŸ¥ã€‚</p><p>å¦‚å›¾ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/image-175603011395676.png" alt=""></p><p>è¯´æ˜ï¼šç›®å‰æ²¡æœ‰é€šçŸ¥æœåŠ¡å’Œç§¯åˆ†æœåŠ¡ï¼Œå› æ­¤æˆ‘ä»¬åªå…³æ³¨äº¤æ˜“æœåŠ¡ï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š</p><ul><li><p>å®šä¹‰<code>direct</code>ç±»å‹äº¤æ¢æœºï¼Œå‘½åä¸º<code>pay.direct</code></p></li><li><p>å®šä¹‰æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå‘½åä¸º<code>trade.pay.success.queue</code></p></li><li><p>å°†<code>trade.pay.success.queue</code>ä¸<code>pay.direct</code>ç»‘å®šï¼Œ<code>BindingKey</code>ä¸º<code>pay.success</code></p></li><li><p>æ”¯ä»˜æˆåŠŸæ—¶ä¸å†è°ƒç”¨äº¤æ˜“æœåŠ¡æ›´æ–°è®¢å•çŠ¶æ€çš„æ¥å£ï¼Œè€Œæ˜¯å‘é€ä¸€æ¡æ¶ˆæ¯åˆ°<code>pay.direct</code>ï¼Œå‘é€æ¶ˆæ¯çš„<code>RoutingKey</code>  ä¸º<code>pay.success</code>ï¼Œæ¶ˆæ¯å†…å®¹æ˜¯è®¢å•id</p></li><li><p>äº¤æ˜“æœåŠ¡ç›‘å¬<code>trade.pay.success.queue</code>é˜Ÿåˆ—ï¼Œæ¥æ”¶åˆ°æ¶ˆæ¯åæ›´æ–°è®¢å•çŠ¶æ€ä¸ºå·²æ”¯ä»˜</p></li></ul><h2 id="4-1-é…ç½®MQ">4.1.é…ç½®MQ</h2><p>ä¸ç®¡æ˜¯ç”Ÿäº§è€…è¿˜æ˜¯æ¶ˆè´¹è€…ï¼Œéƒ½éœ€è¦é…ç½®MQçš„åŸºæœ¬ä¿¡æ¯ã€‚åˆ†ä¸ºä¸¤æ­¥ï¼š</p><p>1ï¼‰æ·»åŠ ä¾èµ–ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--æ¶ˆæ¯å‘é€--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-amqp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>2ï¼‰é…ç½®MQåœ°å€ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">rabbitmq:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="number">192.168</span><span class="number">.150</span><span class="number">.101</span> <span class="comment"># ä½ çš„è™šæ‹ŸæœºIP</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">5672</span> <span class="comment"># ç«¯å£</span></span><br><span class="line">    <span class="attr">virtual-host:</span> <span class="string">/hmall</span> <span class="comment"># è™šæ‹Ÿä¸»æœº</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">hmall</span> <span class="comment"># ç”¨æˆ·å</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123</span> <span class="comment"># å¯†ç </span></span><br></pre></td></tr></table></figure><h2 id="4-2-æ¥æ”¶æ¶ˆæ¯">4.2.æ¥æ”¶æ¶ˆæ¯</h2><p>åœ¨trade-serviceæœåŠ¡ä¸­å®šä¹‰ä¸€ä¸ªæ¶ˆæ¯ç›‘å¬ç±»ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/S7RZbgUBMoqrTZxUXMicKsf3n9j-175603011395678.png" alt=""></p><p>å…¶ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hmall.trade.listener;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.hmall.trade.service.IOrderService;</span><br><span class="line"><span class="keyword">import</span> lombok.RequiredArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.core.ExchangeTypes;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.rabbit.annotation.Exchange;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.rabbit.annotation.Queue;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.rabbit.annotation.QueueBinding;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.rabbit.annotation.RabbitListener;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PayStatusListener</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> IOrderService orderService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RabbitListener(bindings = @QueueBinding(</span></span><br><span class="line"><span class="meta">            value = @Queue(name = &quot;trade.pay.success.queue&quot;, durable = &quot;true&quot;),</span></span><br><span class="line"><span class="meta">            exchange = @Exchange(name = &quot;pay.topic&quot;),</span></span><br><span class="line"><span class="meta">            key = &quot;pay.success&quot;</span></span><br><span class="line"><span class="meta">    ))</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenPaySuccess</span><span class="params">(Long orderId)</span>&#123;</span><br><span class="line">        orderService.markOrderPaySuccess(orderId);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4-3-å‘é€æ¶ˆæ¯">4.3.å‘é€æ¶ˆæ¯</h2><p>ä¿®æ”¹<code>pay-service</code>æœåŠ¡ä¸‹çš„<code>com.hmall.pay.service.impl.PayOrderServiceImpl</code>ç±»ä¸­çš„<code>tryPayOrderByBalance</code>æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> RabbitTemplate rabbitTemplate;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">tryPayOrderByBalance</span><span class="params">(PayOrderDTO payOrderDTO)</span> &#123;</span><br><span class="line">    <span class="comment">// 1.æŸ¥è¯¢æ”¯ä»˜å•</span></span><br><span class="line">    <span class="type">PayOrder</span> <span class="variable">po</span> <span class="operator">=</span> getById(payOrderDTO.getId());</span><br><span class="line">    <span class="comment">// 2.åˆ¤æ–­çŠ¶æ€</span></span><br><span class="line">    <span class="keyword">if</span>(!PayStatus.WAIT_BUYER_PAY.equalsValue(po.getStatus()))&#123;</span><br><span class="line">        <span class="comment">// è®¢å•ä¸æ˜¯æœªæ”¯ä»˜ï¼ŒçŠ¶æ€å¼‚å¸¸</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BizIllegalException</span>(<span class="string">&quot;äº¤æ˜“å·²æ”¯ä»˜æˆ–å…³é—­ï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 3.å°è¯•æ‰£å‡ä½™é¢</span></span><br><span class="line">    userClient.deductMoney(payOrderDTO.getPw(), po.getAmount());</span><br><span class="line">    <span class="comment">// 4.ä¿®æ”¹æ”¯ä»˜å•çŠ¶æ€</span></span><br><span class="line">    <span class="type">boolean</span> <span class="variable">success</span> <span class="operator">=</span> markPayOrderSuccess(payOrderDTO.getId(), LocalDateTime.now());</span><br><span class="line">    <span class="keyword">if</span> (!success) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BizIllegalException</span>(<span class="string">&quot;äº¤æ˜“å·²æ”¯ä»˜æˆ–å…³é—­ï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 5.ä¿®æ”¹è®¢å•çŠ¶æ€</span></span><br><span class="line">    <span class="comment">// tradeClient.markOrderPaySuccess(po.getBizOrderNo());</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        rabbitTemplate.convertAndSend(<span class="string">&quot;pay.direct&quot;</span>, <span class="string">&quot;pay.success&quot;</span>, po.getBizOrderNo());</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        log.error(<span class="string">&quot;æ”¯ä»˜æˆåŠŸçš„æ¶ˆæ¯å‘é€å¤±è´¥ï¼Œæ”¯ä»˜å•idï¼š&#123;&#125;ï¼Œ äº¤æ˜“å•idï¼š&#123;&#125;&quot;</span>, po.getId(), po.getBizOrderNo(), e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="5-ç»ƒä¹ ">5.ç»ƒä¹ </h1><h2 id="5-1-æŠ½å–å…±äº«çš„MQé…ç½®">5.1.æŠ½å–å…±äº«çš„MQé…ç½®</h2><p>å°†MQé…ç½®æŠ½å–åˆ°Nacosä¸­ç®¡ç†ï¼Œå¾®æœåŠ¡ä¸­ç›´æ¥ä½¿ç”¨å…±äº«é…ç½®ã€‚</p><h2 id="5-2-æ”¹é€ ä¸‹å•åŠŸèƒ½">5.2.æ”¹é€ ä¸‹å•åŠŸèƒ½</h2><p>æ”¹é€ ä¸‹å•åŠŸèƒ½ï¼Œå°†åŸºäºOpenFeignçš„æ¸…ç†è´­ç‰©è½¦åŒæ­¥è°ƒç”¨ï¼Œæ”¹ä¸ºåŸºäºRabbitMQçš„å¼‚æ­¥é€šçŸ¥ï¼š</p><ul><li><p>å®šä¹‰topicç±»å‹äº¤æ¢æœºï¼Œå‘½åä¸º<code>trade.topic</code></p></li><li><p>å®šä¹‰æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå‘½åä¸º<code>cart.clear.queue</code></p></li><li><p>å°†<code>cart.clear.queue</code>ä¸<code>trade.topic</code>ç»‘å®šï¼Œ<code>BindingKey</code>ä¸º<code>order.create</code></p></li><li><p>ä¸‹å•æˆåŠŸæ—¶ä¸å†è°ƒç”¨æ¸…ç†è´­ç‰©è½¦æ¥å£ï¼Œè€Œæ˜¯å‘é€ä¸€æ¡æ¶ˆæ¯åˆ°<code>trade.topic</code>ï¼Œå‘é€æ¶ˆæ¯çš„<code>RoutingKey</code>  ä¸º<code>order.create</code>ï¼Œæ¶ˆæ¯å†…å®¹æ˜¯ä¸‹å•çš„å…·ä½“å•†å“ã€å½“å‰ç™»å½•ç”¨æˆ·ä¿¡æ¯</p></li><li><p>è´­ç‰©è½¦æœåŠ¡ç›‘å¬<code>cart.clear.queue</code>é˜Ÿåˆ—ï¼Œæ¥æ”¶åˆ°æ¶ˆæ¯åæ¸…ç†æŒ‡å®šç”¨æˆ·çš„è´­ç‰©è½¦ä¸­çš„æŒ‡å®šå•†å“</p></li></ul><h2 id="5-3-ç™»å½•ä¿¡æ¯ä¼ é€’ä¼˜åŒ–">5.3.ç™»å½•ä¿¡æ¯ä¼ é€’ä¼˜åŒ–</h2><p>æŸäº›ä¸šåŠ¡ä¸­ï¼Œéœ€è¦æ ¹æ®ç™»å½•ç”¨æˆ·ä¿¡æ¯å¤„ç†ä¸šåŠ¡ï¼Œè€ŒåŸºäºMQçš„å¼‚æ­¥è°ƒç”¨å¹¶ä¸ä¼šä¼ é€’ç™»å½•ç”¨æˆ·ä¿¡æ¯ã€‚å‰é¢æˆ‘ä»¬çš„åšæ³•æ¯”è¾ƒéº»çƒ¦ï¼Œè‡³å°‘è¦åšä¸¤ä»¶äº‹ï¼š</p><ul><li><p>æ¶ˆæ¯å‘é€è€…åœ¨æ¶ˆæ¯ä½“ä¸­ä¼ é€’ç™»å½•ç”¨æˆ·</p></li><li><p>æ¶ˆè´¹è€…è·å–æ¶ˆæ¯ä½“ä¸­çš„ç™»å½•ç”¨æˆ·ï¼Œå¤„ç†ä¸šåŠ¡</p></li></ul><p>è¿™æ ·åšä¸ä»…éº»çƒ¦ï¼Œè€Œä¸”ç¼–ç¨‹ä½“éªŒä¹Ÿä¸ç»Ÿä¸€ï¼Œæ¯•ç«Ÿæˆ‘ä»¬ä¹‹å‰éƒ½æ˜¯ä½¿ç”¨UserContextæ¥è·å–ç”¨æˆ·ã€‚</p><p>å¤§å®¶æ€è€ƒä¸€ä¸‹ï¼šæœ‰æ²¡æœ‰æ›´ä¼˜é›…çš„åŠæ³•ä¼ è¾“ç™»å½•ç”¨æˆ·ä¿¡æ¯ï¼Œè®©ä½¿ç”¨MQçš„äººæ— æ„ŸçŸ¥ï¼Œä¾ç„¶é‡‡ç”¨UserContextæ¥éšæ—¶è·å–ç”¨æˆ·ã€‚</p><p>å‚è€ƒèµ„æ–™ï¼š</p><iframe src="https://docs.spring.io/spring-amqp/docs/2.4.14/reference/html/#post-processing" sandbox="allow-scripts allow-same-origin allow-presentation allow-forms allow-popups allow-downloads" allowfullscreen allow="encrypted-media; fullscreen; autoplay" referrerpolicy="strict-origin-when-cross-origin" frameborder="0" style="width: 100%; min-height: 461px; border-radius: 8px;"></iframe>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;å¯¹åº”Bç«™è§†é¢‘ï¼š&lt;/p&gt;
&lt;iframe src=&quot;https://player.bilibili.com/player.html?bvid=1S142197x7&amp;p=85&amp;vd_source=1ff0c1b434581723cf696ccc2f59ceaa&quot; sandbox</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>å¾®æœåŠ¡SpringCloudAlibaba</title>
    <link href="https://u7u7.top/posts/CloudAli.html"/>
    <id>https://u7u7.top/posts/CloudAli.html</id>
    <published>2025-08-08T03:00:25.000Z</published>
    <updated>2025-08-25T01:39:01.264Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å¾®æœåŠ¡æ‹†åˆ†">å¾®æœåŠ¡æ‹†åˆ†</h1><p>å¾®æœåŠ¡æ‹†åˆ†çš„æ ¸å¿ƒæ˜¯<strong>æŒ‰ä¸šåŠ¡è¾¹ç•Œè§£è€¦</strong>ï¼Œå°†å•ä½“åº”ç”¨æ‹†åˆ†ä¸ºç‹¬ç«‹è¿è¡Œçš„æœåŠ¡ã€‚</p><ul><li>åŸåˆ™ï¼šéµå¾ª â€œå•ä¸€èŒè´£â€ï¼Œæ¯ä¸ªæœåŠ¡ä¸“æ³¨äºç‰¹å®šä¸šåŠ¡åŸŸï¼ˆå¦‚è®¢å•ã€å•†å“ã€ç”¨æˆ·ï¼‰ï¼Œåšåˆ°é«˜å†…èšä½è€¦åˆã€‚</li><li>ç›®çš„ï¼šä¾¿äºå›¢é˜Ÿç‹¬ç«‹å¼€å‘ã€éƒ¨ç½²å’Œæ‰©å±•ï¼Œé¿å…å•ä½“åº”ç”¨çš„ â€œç‰µä¸€å‘è€ŒåŠ¨å…¨èº«â€ã€‚</li><li>å…³é”®ï¼šæ‹†åˆ†ç²’åº¦éœ€å¹³è¡¡ï¼ˆè¿‡ç»†ä¼šå¢åŠ æœåŠ¡é€šä¿¡æˆæœ¬ï¼Œè¿‡ç²—åˆ™å¤±å»å¾®æœåŠ¡ä¼˜åŠ¿ï¼‰ï¼Œéœ€è€ƒè™‘æœåŠ¡é—´ä¾èµ–å…³ç³»ã€‚</li></ul><h1 id="NACOS">NACOS</h1><p>åœ¨å¾®æœåŠ¡è¿œç¨‹è°ƒç”¨çš„è¿‡ç¨‹ä¸­ï¼ŒåŒ…æ‹¬ä¸¤ä¸ªè§’è‰²ï¼š</p><ul><li>æœåŠ¡æä¾›è€…ï¼šæä¾›æ¥å£ä¾›å…¶å®ƒå¾®æœåŠ¡è®¿é—®ï¼Œæ¯”å¦‚<code>item-service</code></li><li>æœåŠ¡æ¶ˆè´¹è€…ï¼šè°ƒç”¨å…¶å®ƒå¾®æœåŠ¡æä¾›çš„æ¥å£ï¼Œæ¯”å¦‚<code>cart-service</code></li></ul><p>åœ¨å¤§å‹å¾®æœåŠ¡é¡¹ç›®ä¸­ï¼ŒæœåŠ¡æä¾›è€…çš„æ•°é‡ä¼šéå¸¸å¤šï¼Œä¸ºäº†ç®¡ç†è¿™äº›æœåŠ¡å°±å¼•å…¥äº†<strong>æ³¨å†Œä¸­å¿ƒ</strong>çš„æ¦‚å¿µã€‚æ³¨å†Œä¸­å¿ƒã€æœåŠ¡æä¾›è€…ã€æœåŠ¡æ¶ˆè´¹è€…ä¸‰è€…é—´å…³ç³»å¦‚ä¸‹ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/image-20250808172540550.png" alt="image-20250808172540550"></p><p>æµç¨‹å¦‚ä¸‹ï¼š</p><ul><li>æœåŠ¡å¯åŠ¨æ—¶å°±ä¼šæ³¨å†Œè‡ªå·±çš„æœåŠ¡ä¿¡æ¯ï¼ˆæœåŠ¡åã€IPã€ç«¯å£ï¼‰åˆ°æ³¨å†Œä¸­å¿ƒ</li><li>è°ƒç”¨è€…å¯ä»¥ä»æ³¨å†Œä¸­å¿ƒè®¢é˜…æƒ³è¦çš„æœåŠ¡ï¼Œè·å–æœåŠ¡å¯¹åº”çš„å®ä¾‹åˆ—è¡¨ï¼ˆ1ä¸ªæœåŠ¡å¯èƒ½å¤šå®ä¾‹éƒ¨ç½²ï¼‰</li><li>è°ƒç”¨è€…è‡ªå·±å¯¹å®ä¾‹åˆ—è¡¨è´Ÿè½½å‡è¡¡ï¼ŒæŒ‘é€‰ä¸€ä¸ªå®ä¾‹</li><li>è°ƒç”¨è€…å‘è¯¥å®ä¾‹å‘èµ·è¿œç¨‹è°ƒç”¨</li></ul><p>å½“æœåŠ¡æä¾›è€…çš„å®ä¾‹å®•æœºæˆ–è€…å¯åŠ¨æ–°å®ä¾‹æ—¶ï¼Œè°ƒç”¨è€…å¦‚ä½•å¾—çŸ¥å‘¢ï¼Ÿ</p><ul><li>æœåŠ¡æä¾›è€…ä¼šå®šæœŸå‘æ³¨å†Œä¸­å¿ƒå‘é€è¯·æ±‚ï¼ŒæŠ¥å‘Šè‡ªå·±çš„å¥åº·çŠ¶æ€ï¼ˆå¿ƒè·³è¯·æ±‚ï¼‰</li><li>å½“æ³¨å†Œä¸­å¿ƒé•¿æ—¶é—´æ”¶ä¸åˆ°æä¾›è€…çš„å¿ƒè·³æ—¶ï¼Œä¼šè®¤ä¸ºè¯¥å®ä¾‹å®•æœºï¼Œå°†å…¶ä»æœåŠ¡çš„å®ä¾‹åˆ—è¡¨ä¸­å‰”é™¤</li><li>å½“æœåŠ¡æœ‰æ–°å®ä¾‹å¯åŠ¨æ—¶ï¼Œä¼šå‘é€æ³¨å†ŒæœåŠ¡è¯·æ±‚ï¼Œå…¶ä¿¡æ¯ä¼šè¢«è®°å½•åœ¨æ³¨å†Œä¸­å¿ƒçš„æœåŠ¡å®ä¾‹åˆ—è¡¨</li><li>å½“æ³¨å†Œä¸­å¿ƒæœåŠ¡åˆ—è¡¨å˜æ›´æ—¶ï¼Œä¼šä¸»åŠ¨é€šçŸ¥å¾®æœåŠ¡ï¼Œæ›´æ–°æœ¬åœ°æœåŠ¡åˆ—è¡¨</li></ul><blockquote><p>æˆ‘ä»¬é¡¹ç›®ä½¿ç”¨é˜¿é‡Œçš„NACOSï¼Œç”¨æ¥æ³¨å†ŒæœåŠ¡ï¼Œåªè¦ç»™æˆ‘ä»¬çš„å¾®æœåŠ¡å¼•å…¥ä¾èµ–å’Œé…ç½®ï¼Œå°±å¯ä»¥åœ¨æ³¨å†Œä¸­å¿ƒçœ‹åˆ°å¾®æœåŠ¡ï¼Œç›®å‰æˆ‘ä»¬åªä½¿ç”¨äº†nacosçš„é…ç½®ä¸­å¿ƒï¼Œå¯ä»¥å°†å‡ ä¸ªå¾®æœåŠ¡å…¬å…±çš„yamlå†™å…¥é…ç½®åˆ—è¡¨</p></blockquote><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/image-20250808172938602.png" alt="image-20250808172938602"></p><h1 id="OpenFeign">OpenFeign</h1><p>OpenFeign æ˜¯<strong>å£°æ˜å¼ HTTP å®¢æˆ·ç«¯</strong>ï¼Œç®€åŒ–å¾®æœåŠ¡é—´è¿œç¨‹è°ƒç”¨ã€‚</p><ul><li>åŸºäºæ¥å£ + æ³¨è§£å®šä¹‰è°ƒç”¨è§„åˆ™ï¼ˆå¦‚<code>@FeignClient</code>æŒ‡å®šç›®æ ‡æœåŠ¡ï¼‰ï¼Œæ— éœ€æ‰‹åŠ¨ç¼–å†™ HTTP è¯·æ±‚ä»£ç ã€‚</li><li>è‡ªåŠ¨é›†æˆ Ribbonï¼Œå®ç°è´Ÿè½½å‡è¡¡ï¼ˆä» Nacos è·å–æœåŠ¡åˆ—è¡¨åï¼Œåˆ†å‘è¯·æ±‚åˆ°ä¸åŒå®ä¾‹ï¼‰ã€‚</li><li>æ”¯æŒæ•´åˆ Sentinelï¼Œä¸ºè¿œç¨‹è°ƒç”¨æ·»åŠ ç†”æ–­ã€é™çº§èƒ½åŠ›ï¼ˆå¦‚é…ç½®<code>fallback</code>å¤„ç†è°ƒç”¨å¤±è´¥åœºæ™¯ï¼‰ã€‚</li></ul><blockquote><p>é¡¹ç›®ä¸­ä½¿ç”¨OpenFeignä¸»è¦æ˜¯å®šä¹‰äº†ä¸€ä¸ªapiæ¨¡å—ï¼Œå°†ä¸€äº›å¤šä¸ªå¾®æœåŠ¡éƒ½è¦è°ƒç”¨çš„æ¥å£æˆ–è€…æ–¹æ³•ï¼Œæ”¾åœ¨apiæ¨¡å—ä¸­é€šè¿‡åœ¨å¾®æœåŠ¡å¯åŠ¨ç±»@EnableFeignClientsï¼Œåœ¨Clientä¸­ä½¿ç”¨@FeignClient(â€œitem-serviceâ€)æ³¨è§£ï¼Œä½¿ç”¨è¿œç¨‹è°ƒç”¨æœåŠ¡ï¼ŒåŒæ—¶æˆ‘ä»¬é…ç½®äº†okHttpæ›¿æ¢é»˜è®¤çš„HttpURLConnectionï¼Œæ”¯æŒè¿æ¥æ± ã€‚</p></blockquote><p>æ”¯æŒæ—¥å¿—è¾“å‡ºéœ€è¦åˆ›å»ºä¸€ä¸ªé…ç½®ç±»æ³¨å†Œbeanï¼Œåœ¨éœ€è¦æ‰“å°æ—¥å¿—çš„clientåŠ ä¸Š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FeignClient(value = &quot;item-service&quot;, configuration = DefaultFeignConfig.class)</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableFeignClients(defaultConfiguration = DefaultFeignConfig.class)</span> <span class="comment">//å¯åŠ¨ç±»é…ç½® å…¨å±€ç”Ÿæ•ˆ</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hmall.api.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> feign.Logger;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DefaultFeignConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Logger.Level <span class="title function_">feignLogLevel</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Logger.Level.FULL;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="Gateway">Gateway</h1><p>Gatewayå…¶å®å°±æ˜¯ä¸€ä¸ªç½‘å…³å¾®æœåŠ¡ï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªæ–°çš„å¾®æœåŠ¡ï¼Œåœ¨é¡¹ç›®ä¸­æˆ‘ä»¬å¿«é€Ÿå…¥é—¨æ˜¯ä½¿ç”¨hm-gatewayå®Œæˆäº†è·¯ç”±è½¬å‘ï¼Œnginxç»Ÿä¸€è¯·æ±‚8080ï¼Œæˆ‘ä»¬é€šè¿‡gatewayï¼Œå°†è¿›å…¥8080çš„è¯·æ±‚ï¼Œé€šè¿‡è·¯ç”±è§„åˆ™è½¬å‘ç»™å¯¹åº”çš„ç›®æ ‡æœåŠ¡ï¼ŒåŒæ—¶å®ƒè¿˜æ”¯æŒæ–­è¨€å’Œè·¯ç”±è¿‡æ»¤ã€åŠ¨æ€è·¯ç”±ç­‰ä½œç”¨ã€‚æ€»ç»“ï¼šGateway æ˜¯å¾®æœåŠ¡çš„<strong>ç»Ÿä¸€å…¥å£ç½‘å…³</strong>ï¼Œå¤„ç†æ‰€æœ‰å¤–éƒ¨è¯·æ±‚ï¼Œæ ¸å¿ƒåŠŸèƒ½æ˜¯è·¯ç”±ä¸è¿‡æ»¤ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">gateway</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">server-addr:</span> <span class="number">192.168</span><span class="number">.219</span><span class="number">.128</span><span class="string">:8848</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">item</span> <span class="comment"># è·¯ç”±è§„åˆ™idï¼Œè‡ªå®šä¹‰ï¼Œå”¯ä¸€</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">lb://item-service</span> <span class="comment"># è·¯ç”±çš„ç›®æ ‡æœåŠ¡ï¼Œlbä»£è¡¨è´Ÿè½½å‡è¡¡ï¼Œä¼šä»æ³¨å†Œä¸­å¿ƒæ‹‰å–æœåŠ¡åˆ—è¡¨</span></span><br><span class="line">          <span class="attr">predicates:</span> <span class="comment"># è·¯ç”±æ–­è¨€ï¼Œåˆ¤æ–­å½“å‰è¯·æ±‚æ˜¯å¦ç¬¦åˆå½“å‰è§„åˆ™ï¼Œç¬¦åˆåˆ™è·¯ç”±åˆ°ç›®æ ‡æœåŠ¡</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/items/**,/search/**</span> <span class="comment"># è¿™é‡Œæ˜¯ä»¥è¯·æ±‚è·¯å¾„ä½œä¸ºåˆ¤æ–­è§„åˆ™</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">cart</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">lb://cart-service</span></span><br><span class="line">          <span class="attr">predicates:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/carts/**</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">user</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">lb://user-service</span></span><br><span class="line">          <span class="attr">predicates:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/users/**,/addresses/**</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">trade</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">lb://trade-service</span></span><br><span class="line">          <span class="attr">predicates:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/orders/**</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">pay</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">lb://pay-service</span></span><br><span class="line">          <span class="attr">predicates:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/pay-orders/**</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="ç½‘å…³ç™»å½•æ ¡éªŒ">ç½‘å…³ç™»å½•æ ¡éªŒ</h2><p>å•ä½“æ¶æ„æ—¶æˆ‘ä»¬åªéœ€è¦å®Œæˆä¸€æ¬¡ç”¨æˆ·ç™»å½•ã€èº«ä»½æ ¡éªŒï¼Œå°±å¯ä»¥åœ¨æ‰€æœ‰ä¸šåŠ¡ä¸­è·å–åˆ°ç”¨æˆ·ä¿¡æ¯ã€‚è€Œå¾®æœåŠ¡æ‹†åˆ†åï¼Œæ¯ä¸ªå¾®æœåŠ¡éƒ½ç‹¬ç«‹éƒ¨ç½²ï¼Œä¸å†å…±äº«æ•°æ®ã€‚ä¹Ÿå°±æ„å‘³ç€æ¯ä¸ªå¾®æœåŠ¡éƒ½éœ€è¦åšç™»å½•æ ¡éªŒï¼Œè¿™æ˜¾ç„¶ä¸å¯å–ã€‚</p><p>æˆ‘ä»¬çš„ç™»å½•æ˜¯åŸºäºJWTæ¥å®ç°çš„ï¼Œæ ¡éªŒJWTçš„ç®—æ³•å¤æ‚ï¼Œè€Œä¸”éœ€è¦ç”¨åˆ°ç§˜é’¥ã€‚å¦‚æœæ¯ä¸ªå¾®æœåŠ¡éƒ½å»åšç™»å½•æ ¡éªŒï¼Œè¿™å°±å­˜åœ¨ç€ä¸¤å¤§é—®é¢˜ï¼š</p><ul><li>æ¯ä¸ªå¾®æœåŠ¡éƒ½éœ€è¦çŸ¥é“JWTçš„ç§˜é’¥ï¼Œä¸å®‰å…¨</li><li>æ¯ä¸ªå¾®æœåŠ¡é‡å¤ç¼–å†™ç™»å½•æ ¡éªŒä»£ç ã€æƒé™æ ¡éªŒä»£ç ï¼Œéº»çƒ¦</li></ul><p>æ—¢ç„¶ç½‘å…³æ˜¯æ‰€æœ‰å¾®æœåŠ¡çš„å…¥å£ï¼Œä¸€åˆ‡è¯·æ±‚éƒ½éœ€è¦å…ˆç»è¿‡ç½‘å…³ã€‚æˆ‘ä»¬å®Œå…¨å¯ä»¥æŠŠç™»å½•æ ¡éªŒçš„å·¥ä½œæ”¾åˆ°ç½‘å…³å»åšï¼Œè¿™æ ·ä¹‹å‰è¯´çš„é—®é¢˜å°±è§£å†³äº†ï¼š</p><ul><li>åªéœ€è¦åœ¨ç½‘å…³å’Œç”¨æˆ·æœåŠ¡ä¿å­˜ç§˜é’¥</li><li>åªéœ€è¦åœ¨ç½‘å…³å¼€å‘ç™»å½•æ ¡éªŒåŠŸèƒ½</li></ul><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/image-20250808174705433.png" alt="image-20250808174705433"></p><ul><li>ç½‘å…³è·¯ç”±æ˜¯é…ç½®çš„ï¼Œè¯·æ±‚è½¬å‘æ˜¯Gatewayå†…éƒ¨ä»£ç ï¼Œæˆ‘ä»¬å¦‚ä½•åœ¨è½¬å‘ä¹‹å‰åšç™»å½•æ ¡éªŒï¼Ÿ</li><li>ç½‘å…³æ ¡éªŒJWTä¹‹åï¼Œå¦‚ä½•å°†ç”¨æˆ·ä¿¡æ¯ä¼ é€’ç»™å¾®æœåŠ¡ï¼Ÿ</li><li>å¾®æœåŠ¡ä¹‹é—´ä¹Ÿä¼šç›¸äº’è°ƒç”¨ï¼Œè¿™ç§è°ƒç”¨ä¸ç»è¿‡ç½‘å…³ï¼Œåˆè¯¥å¦‚ä½•ä¼ é€’ç”¨æˆ·ä¿¡æ¯ï¼Ÿ</li></ul><p>é¦–å…ˆç™»å½•æ ¡éªŒå¿…é¡»åœ¨è¯·æ±‚è½¬å‘åˆ°å¾®æœåŠ¡ä¹‹å‰åšã€‚è€Œç½‘å…³çš„è¯·æ±‚è½¬å‘æ˜¯<code>Gateway</code>å†…éƒ¨ä»£ç å®ç°çš„ï¼Œè¦æƒ³åœ¨è¯·æ±‚è½¬å‘ä¹‹å‰åšç™»å½•æ ¡éªŒï¼Œå°±å¿…é¡»äº†è§£<code>Gateway</code>å†…éƒ¨å·¥ä½œçš„åŸºæœ¬åŸç†ã€‚</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/image-20250808174859617.png" alt="image-20250808174859617"></p><ol><li>å®¢æˆ·ç«¯è¯·æ±‚è¿›å…¥ç½‘å…³åç”±<code>HandlerMapping</code>å¯¹è¯·æ±‚åšåˆ¤æ–­ï¼Œæ‰¾åˆ°ä¸å½“å‰è¯·æ±‚åŒ¹é…çš„è·¯ç”±è§„åˆ™ï¼ˆ<strong><code>Route</code></strong>ï¼‰ï¼Œç„¶åå°†è¯·æ±‚äº¤ç»™<code>WebHandler</code>å»å¤„ç†ã€‚</li><li><code>WebHandler</code>åˆ™ä¼šåŠ è½½å½“å‰è·¯ç”±ä¸‹éœ€è¦æ‰§è¡Œçš„è¿‡æ»¤å™¨é“¾ï¼ˆ<strong><code>Filter chain</code></strong>ï¼‰ï¼Œç„¶åæŒ‰ç…§é¡ºåºé€ä¸€æ‰§è¡Œè¿‡æ»¤å™¨ï¼ˆåé¢ç§°ä¸º**<code>Filter</code>**ï¼‰ã€‚</li><li>å›¾ä¸­<code>Filter</code>è¢«è™šçº¿åˆ†ä¸ºå·¦å³ä¸¤éƒ¨åˆ†ï¼Œæ˜¯å› ä¸º<code>Filter</code>å†…éƒ¨çš„é€»è¾‘åˆ†ä¸º<code>pre</code>å’Œ<code>post</code>ä¸¤éƒ¨åˆ†ï¼Œåˆ†åˆ«ä¼šåœ¨è¯·æ±‚è·¯ç”±åˆ°å¾®æœåŠ¡<strong>ä¹‹å‰</strong>å’Œ<strong>ä¹‹å</strong>è¢«æ‰§è¡Œã€‚</li><li>åªæœ‰æ‰€æœ‰<code>Filter</code>çš„<code>pre</code>é€»è¾‘éƒ½ä¾æ¬¡é¡ºåºæ‰§è¡Œé€šè¿‡åï¼Œè¯·æ±‚æ‰ä¼šè¢«è·¯ç”±åˆ°å¾®æœåŠ¡ã€‚</li><li>å¾®æœåŠ¡è¿”å›ç»“æœåï¼Œå†å€’åºæ‰§è¡Œ<code>Filter</code>çš„<code>post</code>é€»è¾‘ã€‚</li><li>æœ€ç»ˆæŠŠå“åº”ç»“æœè¿”å›ã€‚</li></ol><p>å¦‚å›¾ä¸­æ‰€ç¤ºï¼Œæœ€ç»ˆè¯·æ±‚è½¬å‘æ˜¯æœ‰ä¸€ä¸ªåä¸º<code>NettyRoutingFilter</code>çš„è¿‡æ»¤å™¨æ¥æ‰§è¡Œçš„ï¼Œè€Œä¸”è¿™ä¸ªè¿‡æ»¤å™¨æ˜¯æ•´ä¸ªè¿‡æ»¤å™¨é“¾ä¸­é¡ºåºæœ€é åçš„ä¸€ä¸ªã€‚<strong>å¦‚æœæˆ‘ä»¬èƒ½å¤Ÿå®šä¹‰ä¸€ä¸ªè¿‡æ»¤å™¨ï¼Œåœ¨å…¶ä¸­å®ç°ç™»å½•æ ¡éªŒé€»è¾‘ï¼Œå¹¶ä¸”å°†è¿‡æ»¤å™¨æ‰§è¡Œé¡ºåºå®šä¹‰åˆ°</strong>**<code>NettyRoutingFilter</code>**<strong>ä¹‹å‰</strong>ï¼Œè¿™å°±ç¬¦åˆæˆ‘ä»¬çš„éœ€æ±‚äº†ã€‚</p><p>ç½‘å…³è¿‡æ»¤å™¨é“¾ä¸­çš„è¿‡æ»¤å™¨æœ‰ä¸¤ç§ï¼š</p><ul><li><strong><code>GatewayFilter</code></strong>ï¼šè·¯ç”±è¿‡æ»¤å™¨ï¼Œä½œç”¨èŒƒå›´æ¯”è¾ƒçµæ´»ï¼Œå¯ä»¥æ˜¯ä»»æ„æŒ‡å®šçš„è·¯ç”±<code>Route</code>.</li><li><strong><code>GlobalFilter</code></strong>ï¼šå…¨å±€è¿‡æ»¤å™¨ï¼Œä½œç”¨èŒƒå›´æ˜¯æ‰€æœ‰è·¯ç”±ï¼Œä¸å¯é…ç½®ã€‚</li></ul><h2 id="GatewayFilter">GatewayFilter</h2><p>è¯¥è¿‡æ»¤å™¨å®ç°ï¼Œéœ€è¦å…ˆåˆ›å»ºä¸€ä¸ªç±»ç»§æ‰¿AbstractGatewayFilterFactory,ç„¶åé‡å†™Applyæ–¹æ³•ã€‚è¿˜éœ€è¦åœ¨å¯¹åº”çš„applicationæ–‡ä»¶ä¸­è¿›è¡Œé…ç½®ï¼Œæ³¨æ„ï¼è¯¥ç±»çš„åç§°ä¸€å®šè¦ä»¥GatewayFilterFactoryä¸ºåç¼€ã€‚åœ¨yamléœ€è¦é…ç½®ï¼Œå¯ä»¥å…¨å±€ä¹Ÿå¯ä»¥å•ä¸ªæœåŠ¡ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">default-filters:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">PrintAny</span> <span class="comment"># æ­¤å¤„ç›´æ¥ä»¥è‡ªå®šä¹‰çš„GatewayFilterFactoryç±»åç§°å‰ç¼€ç±»å£°æ˜è¿‡æ»¤å™¨</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">test_route</span></span><br><span class="line">        <span class="attr">uri:</span> <span class="string">lb://test-service</span></span><br><span class="line">        <span class="attr">predicates:</span></span><br><span class="line">          <span class="string">-Path=/test/**</span></span><br><span class="line">        <span class="attr">filters:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">PrintAny=key,</span> <span class="string">value</span> <span class="comment"># é€—å·ä¹‹å‰æ˜¯è¯·æ±‚å¤´çš„keyï¼Œé€—å·ä¹‹åæ˜¯value </span></span><br><span class="line">    </span><br></pre></td></tr></table></figure><p>æˆ‘è¿™é‡Œæµ‹è¯•ç›´æ¥ä½¿ç”¨äº†å…¨å±€è¿‡æ»¤å™¨ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PrintAnyGatewayFilterFactory</span> <span class="comment">// çˆ¶ç±»æ³›å‹æ˜¯å†…éƒ¨ç±»çš„Configç±»å‹</span></span><br><span class="line">                <span class="keyword">extends</span> <span class="title class_">AbstractGatewayFilterFactory</span>&lt;PrintAnyGatewayFilterFactory.Config&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> GatewayFilter <span class="title function_">apply</span><span class="params">(Config config)</span> &#123;</span><br><span class="line">        <span class="comment">// OrderedGatewayFilteræ˜¯GatewayFilterçš„å­ç±»ï¼ŒåŒ…å«ä¸¤ä¸ªå‚æ•°ï¼š</span></span><br><span class="line">        <span class="comment">// - GatewayFilterï¼šè¿‡æ»¤å™¨</span></span><br><span class="line">        <span class="comment">// - int orderå€¼ï¼šå€¼è¶Šå°ï¼Œè¿‡æ»¤å™¨æ‰§è¡Œä¼˜å…ˆçº§è¶Šé«˜</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">OrderedGatewayFilter</span>(<span class="keyword">new</span> <span class="title class_">GatewayFilter</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> Mono&lt;Void&gt; <span class="title function_">filter</span><span class="params">(ServerWebExchange exchange, GatewayFilterChain chain)</span> &#123;</span><br><span class="line">                <span class="comment">// è·å–configå€¼</span></span><br><span class="line">                <span class="type">String</span> <span class="variable">a</span> <span class="operator">=</span> config.getA();</span><br><span class="line">                <span class="type">String</span> <span class="variable">b</span> <span class="operator">=</span> config.getB();</span><br><span class="line">                <span class="type">String</span> <span class="variable">c</span> <span class="operator">=</span> config.getC();</span><br><span class="line">                <span class="comment">// ç¼–å†™è¿‡æ»¤å™¨é€»è¾‘</span></span><br><span class="line">                System.out.println(<span class="string">&quot;a = &quot;</span> + a);</span><br><span class="line">                System.out.println(<span class="string">&quot;b = &quot;</span> + b);</span><br><span class="line">                System.out.println(<span class="string">&quot;c = &quot;</span> + c);</span><br><span class="line">                <span class="comment">// æ”¾è¡Œ</span></span><br><span class="line">                <span class="keyword">return</span> chain.filter(exchange);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="number">100</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è‡ªå®šä¹‰é…ç½®å±æ€§ï¼Œæˆå‘˜å˜é‡åç§°å¾ˆé‡è¦ï¼Œä¸‹é¢ä¼šç”¨åˆ°</span></span><br><span class="line">    <span class="meta">@Data</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Config</span>&#123;</span><br><span class="line">        <span class="keyword">private</span> String a;</span><br><span class="line">        <span class="keyword">private</span> String b;</span><br><span class="line">        <span class="keyword">private</span> String c;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å°†å˜é‡åç§°ä¾æ¬¡è¿”å›ï¼Œé¡ºåºå¾ˆé‡è¦ï¼Œå°†æ¥è¯»å–å‚æ•°æ—¶éœ€è¦æŒ‰é¡ºåºè·å–</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;String&gt; <span class="title function_">shortcutFieldOrder</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> List.of(<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">        <span class="comment">// è¿”å›å½“å‰é…ç½®ç±»çš„ç±»å‹ï¼Œä¹Ÿå°±æ˜¯å†…éƒ¨çš„Config</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Class&lt;Config&gt; <span class="title function_">getConfigClass</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Config.class;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="GlobalFilter">GlobalFilter</h2><p>è¿™ä¸ªæ˜¯åœ¨é¡¹ç›®ä¸­ä½¿ç”¨çš„è¿‡æ»¤å™¨ï¼Œä»–ä½¿ç”¨æ¯”è¾ƒç®€ç­”å…¶å®ï¼Œä¸æ”¯æŒåŠ¨æ€å‚æ•°ï¼Œå› ä¸ºé¡¹ç›®åªåšä¸€ä¸ªè¿‡æ»¤å¹¶ä¸”å°†ç”¨æˆ·ä¿¡æ¯ä¼ å‚ï¼Œæ‰€ä»¥å°±ç”¨GlobalFilterï¼Œä»–åªè¦å®ç°ä¸¤ä¸ªæ¥å£ï¼Œä¸€ä¸ªGlobalFilterï¼Œä¸€ä¸ªordered(æ’åºçš„å¯ä»¥ä¸ç»™)ã€‚orderedå¯ä»¥è®¾ç½®è¿‡æ»¤å™¨çš„æ‰§è¡Œé¡ºåºï¼ŒæŒ‰ç…§è‡ªå·±ä¸šåŠ¡æƒ…å†µæ¥ã€‚å› ä¸ºé¡¹ç›®ä¸­ä½¿ç”¨çš„è¿™ä¸ªï¼Œæµ‹è¯•ç”¨ä¾‹å°±ä¸å†™äº†ã€‚</p><h2 id="ç™»å½•æ ¡éªŒ">ç™»å½•æ ¡éªŒ</h2><p>è¿™é‡Œæˆ‘ä»¬è¦å…ˆæŠŠé…ç½®ç±»å†™å¥½åœ¨gatewayæœåŠ¡ä¸­ï¼Œåˆ›å»ºè¿‡æ»¤å™¨ï¼Œå½“ç„¶ç§˜é’¥å’Œæ ¡éªŒè·¯å¾„è¦åœ¨yamlé…ç½®å¥½ã€‚exchangeä¸­æœ‰è¯·æ±‚å¤´ä¿¡æ¯ï¼Œé€šè¿‡chainè½¬å‘ç»™å…¶ä»–æœåŠ¡ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AutoGlobalFilter</span> <span class="keyword">implements</span> <span class="title class_">GlobalFilter</span>, Ordered &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> JwtTool jwtTool;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> AuthProperties authProperties;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">AntPathMatcher</span> <span class="variable">antPathMatcher</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AntPathMatcher</span>();</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;Void&gt; <span class="title function_">filter</span><span class="params">(ServerWebExchange exchange, GatewayFilterChain chain)</span> &#123;</span><br><span class="line">        <span class="comment">//ç”¨æˆ·æ‹¦æˆª æ ¡éªŒ</span></span><br><span class="line">        <span class="type">ServerHttpRequest</span> <span class="variable">request</span> <span class="operator">=</span> exchange.getRequest();</span><br><span class="line">        <span class="comment">//åˆ¤æ–­æ˜¯å¦éœ€è¦æ‹¦æˆª</span></span><br><span class="line">        <span class="keyword">if</span> (ifExclude(request.getPath().toString())) &#123;</span><br><span class="line">            <span class="keyword">return</span> chain.filter(exchange);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        List&lt;String&gt; headers = request.getHeaders().get(<span class="string">&quot;Authorization&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (!CollectionUtils.isEmpty(headers))&#123;</span><br><span class="line">            token = headers.get(<span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//æ£€éªŒå¹¶è§£æ token</span></span><br><span class="line">        Long userId;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            userId = jwtTool.parseToken(token);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="type">ServerHttpResponse</span> <span class="variable">response</span> <span class="operator">=</span> exchange.getResponse();</span><br><span class="line">            response.setStatusCode(HttpStatus.UNAUTHORIZED);</span><br><span class="line">            <span class="keyword">return</span> response.setComplete();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//ä¼ é€’ç”¨æˆ·ä¿¡æ¯</span></span><br><span class="line">        System.out.println(<span class="string">&quot;userId = &quot;</span> + userId); <span class="comment">// æ‰“å°ç”¨æˆ·id</span></span><br><span class="line">        <span class="type">ServerWebExchange</span> <span class="variable">swe</span> <span class="operator">=</span> exchange.mutate().request(builder -&gt; builder.header(<span class="string">&quot;user-info&quot;</span>, userId.toString())).build();</span><br><span class="line">        <span class="comment">//æ”¾è¡Œ</span></span><br><span class="line">        <span class="keyword">return</span> chain.filter(swe);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">ifExclude</span><span class="params">(String string)</span> &#123;</span><br><span class="line">        <span class="comment">// åˆ¤æ–­å½“å‰è¯·æ±‚è·¯å¾„æ˜¯å¦åœ¨æ’é™¤è·¯å¾„åˆ—è¡¨ä¸­ï¼Œå¦‚æœåœ¨ä»»æ„ä¸€ä¸ªæ’é™¤è·¯å¾„ä¸‹ï¼Œåˆ™ä¸éœ€è¦æ‹¦æˆª</span></span><br><span class="line">        <span class="keyword">return</span> authProperties.getExcludePaths().stream().anyMatch(path -&gt; antPathMatcher.match(path, string));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getOrder</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç”¨æˆ·ä¿¡æ¯ä¼ é€’">ç”¨æˆ·ä¿¡æ¯ä¼ é€’</h2><p>ç°åœ¨æˆ‘ä»¬æŠŠç”¨æˆ·IDå‘é€åˆ°äº†è¯·æ±‚å¤´ä¸­å¹¶ä¸”å‘½åä¸ºuser-info,é‚£æˆ‘ä»¬å†å®šä¹‰ä¸€ä¸ªæ‹¦æˆªå™¨ï¼Œå°†è¯·æ±‚å¤´ä¸­çš„ç”¨æˆ·idæ‹¿åˆ°æ”¾åˆ°threadlocalé‡Œé¢å°±å¯ä»¥äº†ã€‚ä¸‹é¢æ˜¯æµç¨‹å›¾ã€‚</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/image-20250808212831153.png" alt="image-20250808212831153"></p><p>ç”±äºæ¯ä¸ªå¾®æœåŠ¡éƒ½æœ‰è·å–ç™»å½•ç”¨æˆ·çš„éœ€æ±‚ï¼Œå› æ­¤æ‹¦æˆªå™¨æˆ‘ä»¬ç›´æ¥å†™åœ¨<code>hm-common</code>ä¸­ï¼Œå¹¶å†™å¥½è‡ªåŠ¨è£…é…ã€‚è¿™æ ·å¾®æœåŠ¡åªéœ€è¦å¼•å…¥<code>hm-common</code>å°±å¯ä»¥ç›´æ¥å…·å¤‡æ‹¦æˆªå™¨åŠŸèƒ½ï¼Œæ— éœ€é‡å¤ç¼–å†™ã€‚åœ¨hm-commonå®šä¹‰ä¸€ä¸ªæ‹¦æˆªå™¨å®ç°HandlerInterceptoræ¥å£ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserInfoInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line"><span class="comment">//ä¹‹å‰</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//å–å‡ºç”¨æˆ·idå¹¶å­˜åˆ°thread local</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">userId</span> <span class="operator">=</span> request.getHeader(<span class="string">&quot;user-info&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (StrUtil.isNotEmpty(userId))&#123;</span><br><span class="line">            UserContext.setUser(Long.valueOf(userId));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        UserContext.removeUser();<span class="comment">//ç§»é™¤ç”¨æˆ·</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨åˆ°äº†è¿™ä¸ªæ¥å£å°±è®²ä¸€ä¸‹æŠŠã€‚</p><p><strong><code>HandlerInterceptor</code> æ¥å£</strong><br>è¿™æ˜¯ Spring MVC æä¾›çš„æ‹¦æˆªå™¨æ¥å£ï¼Œç”¨äºåœ¨æ§åˆ¶å™¨ï¼ˆControllerï¼‰æ–¹æ³•æ‰§è¡Œå‰åæ’å…¥è‡ªå®šä¹‰é€»è¾‘ï¼Œä¸»è¦æœ‰ä¸‰ä¸ªæ–¹æ³•ï¼š</p><ul><li><code>preHandle</code>ï¼šè¯·æ±‚åˆ°è¾¾æ§åˆ¶å™¨<strong>ä¹‹å‰</strong>æ‰§è¡Œï¼ˆé¢„å¤„ç†ï¼‰</li><li><code>postHandle</code>ï¼šæ§åˆ¶å™¨æ–¹æ³•æ‰§è¡Œå®Œæˆä½†è§†å›¾æœªæ¸²æŸ“<strong>ä¹‹å‰</strong>æ‰§è¡Œï¼ˆåå¤„ç†ï¼‰</li><li><code>afterCompletion</code>ï¼šæ•´ä¸ªè¯·æ±‚å®Œæˆï¼ˆåŒ…æ‹¬è§†å›¾æ¸²æŸ“ï¼‰<strong>ä¹‹å</strong>æ‰§è¡Œï¼ˆèµ„æºæ¸…ç†ï¼‰</li></ul><p>åŒæ—¶è¿™é‡Œæˆ‘ä»¬è¦å¼•å…¥ä¸€ä¸ªspringMvcçš„é…ç½®ç±»ï¼Œé…ç½®åˆšåˆšçš„æ‹¦æˆªå™¨ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(DispatcherServlet.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MvcConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> &#123;</span><br><span class="line">        registry.addInterceptor(<span class="keyword">new</span> <span class="title class_">UserInfoInterceptor</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå¹¶ä¸ä¼šç›´æ¥ç”Ÿæ•ˆï¼Œå› ä¸ºå…¶ä»–å¾®æœåŠ¡çš„å¹¶ä¸ä¼šæ‰«æåˆ°è¿™ä¸ªåŒ…ï¼ŒåŸºäºSpringBootçš„è‡ªåŠ¨è£…é…åŸç†ï¼Œæˆ‘ä»¬è¦å°†å…¶æ·»åŠ åˆ°<code>resources</code>ç›®å½•ä¸‹çš„<code>META-INF/spring.factories</code>æ–‡ä»¶ä¸­ã€‚è¿™é‡Œæˆ‘åé¢ä¼šå¤ä¹ è‡ªåŠ¨è£…é…çš„åŸç†çš„ã€‚è¿™ä¸ªæ—¶å€™threadlocalé‡Œé¢å°±æœ‰æˆ‘ä»¬å­˜å…¥çš„ç”¨æˆ·ä¿¡æ¯äº†ã€‚</p><h2 id="OpenFeignä¼ é€’ç”¨æˆ·">OpenFeignä¼ é€’ç”¨æˆ·</h2><p>è¿˜æœ‰å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯å½“æˆ‘ä»¬ä¸‹å•æœåŠ¡çš„æ—¶å€™ï¼Œè®¢å•æœåŠ¡è·å–åˆ°äº†ç”¨æˆ·ä¿¡æ¯ä¿å­˜è®¢å•ï¼Œä½†æ˜¯åˆ°æ¸…ç†è´­ç‰©è½¦çš„åˆ°æ—¶å€™ï¼Œåœ¨è´­ç‰©è½¦æœåŠ¡æ˜¯æ²¡æœ‰å½“å‰ç”¨æˆ·çš„IDçš„ï¼Œå°±ä¼šå¯¼è‡´è´­ç‰©è½¦æœåŠ¡ä¸çŸ¥é“åˆ é™¤å“ªä¸ªç”¨æˆ·çš„è´­ç‰©è½¦ã€‚æ³¨æ„å› ä¸ºæ˜¯ä¸åŒçš„æœåŠ¡ï¼Œæ‰€ä»¥ä¸æ˜¯åŒä¸€ä¸ªçº¿ç¨‹ä¹Ÿå°±ä¸æ˜¯åŒä¸€ä¸ªthreadlocalã€‚ç”±äºå¾®æœåŠ¡è·å–ç”¨æˆ·ä¿¡æ¯æ˜¯é€šè¿‡æ‹¦æˆªå™¨åœ¨è¯·æ±‚å¤´ä¸­è¯»å–ï¼Œå› æ­¤è¦æƒ³å®ç°å¾®æœåŠ¡ä¹‹é—´çš„ç”¨æˆ·ä¿¡æ¯ä¼ é€’ï¼Œå°±<strong>å¿…é¡»åœ¨å¾®æœåŠ¡å‘èµ·è°ƒç”¨æ—¶æŠŠç”¨æˆ·ä¿¡æ¯å­˜å…¥è¯·æ±‚å¤´</strong>ã€‚å› ä¸ºæˆ‘ä»¬æ˜¯ä½¿ç”¨<strong>OpenFeign</strong>å®ç°å¾®æœåŠ¡ä¹‹é—´äº’ç›¸è°ƒç”¨çš„ï¼Œæˆ‘ä»¬å¯ä»¥å°†OpenFeignæ¯æ¬¡çš„å‘èµ·è¯·æ±‚éƒ½æºå¸¦ç™»å½•ç”¨æˆ·ä¿¡æ¯å°±å¥½äº†ã€‚</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/image-20250808214052181.png" alt="image-20250808214052181"></p><p>Feignæœ‰ä¸€ä¸ªæ‹¦æˆªå™¨æ¥å£<strong>feign.RequestInterceptor</strong>ï¼Œåªè¦å®ç°è¿™ä¸ªæ¥å£å¹¶å®ç°applyæ–¹æ³•å°±è¡Œäº†ï¼Œåˆ©ç”¨<code>RequestTemplate</code>ç±»æ¥æ·»åŠ è¯·æ±‚å¤´ï¼Œå°†ç”¨æˆ·ä¿¡æ¯ä¿å­˜åˆ°è¯·æ±‚å¤´ä¸­ã€‚å¯ä»¥åœ¨ä¹‹å‰apiæ¨¡å—ä¸­DefaultFeignClienté‡Œé¢æ³¨å†Œä¸€ä¸ªæ–¹æ³•beanã€‚è¿™æ ·å°±å®Œæˆäº†é€šè¿‡gatewayå®ç°æœåŠ¡ä¹‹å‰é€šè®¯å•¦ï¼ï¼ï¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> RequestInterceptor <span class="title function_">userInfoRequestInterceptor</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RequestInterceptor</span>() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">apply</span><span class="params">(RequestTemplate template)</span> &#123;</span><br><span class="line">            <span class="comment">// è·å–ç™»å½•ç”¨æˆ·</span></span><br><span class="line">            <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> UserContext.getUser();</span><br><span class="line">            <span class="keyword">if</span>(userId == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="comment">// å¦‚æœä¸ºç©ºåˆ™ç›´æ¥è·³è¿‡</span></span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// å¦‚æœä¸ä¸ºç©ºåˆ™æ”¾å…¥è¯·æ±‚å¤´ä¸­ï¼Œä¼ é€’ç»™ä¸‹æ¸¸å¾®æœåŠ¡</span></span><br><span class="line">            template.header(<span class="string">&quot;user-info&quot;</span>, userId.toString());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="é…ç½®ç®¡ç†">é…ç½®ç®¡ç†</h2><blockquote><p>åé¢çš„é…ç½®ç®¡ç†å…¶å®å°±æ˜¯å…¬å…±yamlçš„é…ç½®ï¼Œé€šè¿‡å®šä¹‰ä¸€ä¸ªå±æ€§ç±»@ConfigurationProperties(prefix = â€œhm.cartâ€)å¯ä»¥å®ç°çƒ­æ›´æ–° ã€‚åé¢æ”¾ä¸€ä¸ªåŠ¨æ€è·¯ç”±çš„é…ç½®ä»£ç ã€‚å…·ä½“å°±ä¸è®²äº†ï¼Œç½‘ä¸Šæ•™ç¨‹æ¯”è¾ƒå¤šã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hmall.gateway.routers;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.hutool.json.*;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.cloud.nacos.*;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.nacos.api.config.listener.*;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.nacos.api.exception.*;</span><br><span class="line"><span class="keyword">import</span> com.hmall.common.utils.*;</span><br><span class="line"><span class="keyword">import</span> lombok.*;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.gateway.route.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.*;</span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.*;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ClassName</span> DynamicRouteLoader</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> TODO</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> CC</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@DATE</span> 2025/8/5 16:15</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DynamicRouteLoader</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> NacosConfigManager nacosConfigManager;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> RouteDefinitionWriter writer;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Set&lt;String&gt; routeIds = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DATA_ID</span> <span class="operator">=</span> <span class="string">&quot;dynamic-route.json&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">GROUP</span> <span class="operator">=</span> <span class="string">&quot;DEFAULT_GROUP&quot;</span>;</span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initRouteConfigListener</span><span class="params">()</span> <span class="keyword">throws</span> NacosException &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">configAndSignListener</span> <span class="operator">=</span> nacosConfigManager.getConfigService()</span><br><span class="line">                .getConfigAndSignListener(DATA_ID, GROUP, <span class="number">5000</span>, <span class="keyword">new</span> <span class="title class_">Listener</span>() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="keyword">public</span> Executor <span class="title function_">getExecutor</span><span class="params">()</span> &#123;</span><br><span class="line">                        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">receiveConfigInfo</span><span class="params">(String s)</span> &#123;</span><br><span class="line">                        <span class="comment">//ç›‘å¬åˆ°æ›´æ–°äº† æ›´æ–°è·¯ç”±è¡¨</span></span><br><span class="line">                        log.debug(<span class="string">&quot;ç›‘å¬åˆ°è·¯ç”±é…ç½®å˜æ›´ï¼Œ&#123;&#125;&quot;</span>, s);</span><br><span class="line">                        updateRouteConfig(s);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">        <span class="comment">//ç¬¬ä¸€æ¬¡å¯åŠ¨æ—¶å€™åˆå§‹åŒ–è·¯ç”±è¡¨</span></span><br><span class="line">        log.info(<span class="string">&quot;åˆå§‹åŒ–è·¯ç”±è¡¨&quot;</span>);</span><br><span class="line">        updateRouteConfig(configAndSignListener);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">updateRouteConfig</span><span class="params">(String config)</span>&#123;</span><br><span class="line">        List&lt;RouteDefinition&gt; routeDefinitions = JSONUtil.toList(config, RouteDefinition.class);</span><br><span class="line">        <span class="comment">// 2.1.åˆ é™¤æ—§çš„è·¯ç”±è¡¨</span></span><br><span class="line">        routeIds.forEach(routeId -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                writer.delete(Mono.just(routeId)).subscribe();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                log.error(<span class="string">&quot;åˆ é™¤è·¯ç”±è¡¨å¤±è´¥&quot;</span>, e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        routeIds.clear();</span><br><span class="line">        <span class="comment">// 2.2.åˆ¤æ–­æ˜¯å¦æœ‰æ–°çš„è·¯ç”±è¦æ›´æ–°</span></span><br><span class="line">        <span class="keyword">if</span> (CollUtils.isEmpty(routeDefinitions)) &#123;</span><br><span class="line">            <span class="comment">// æ— æ–°è·¯ç”±é…ç½®ï¼Œç›´æ¥ç»“æŸ</span></span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        routeDefinitions.forEach(routeDefinition -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                writer.save(Mono.just(routeDefinition)).subscribe();</span><br><span class="line">                routeIds.add(routeDefinition.getId());</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                log.error(<span class="string">&quot;æ›´æ–°è·¯ç”±è¡¨å¤±è´¥&quot;</span>, e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="å¾®æœåŠ¡ä¿æŠ¤ï¼ˆSentinelï¼‰">å¾®æœåŠ¡ä¿æŠ¤ï¼ˆSentinelï¼‰</h1><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡é˜¿é‡Œå¼€å‘çš„Sentinelå®ç°å¾®æœåŠ¡çš„ä¿æŠ¤ï¼Œå®ƒé‡Œé¢è‡ªå¸¦qpså®æ—¶ç›‘æ§å’Œç›´æ¥å¯¹è¯·æ±‚æ¥å£<strong>ç°‡ç‚¹é“¾è·¯</strong>è¿›è¡Œç†”æ–­å’Œæµæ§ä»¥åŠéš”ç¦»ã€‚</p><h3 id="æŠ¥é”™Â±-add-opens-java-base-java-lang-ALL-UNNAMED">æŠ¥é”™Â±-add-opens=java.base/java.lang=ALL-UNNAMED</h3><h2 id="è¯·æ±‚é™æµ">è¯·æ±‚é™æµ</h2><p>æœåŠ¡æ•…éšœæœ€é‡è¦åŸå› ï¼Œå°±æ˜¯å¹¶å‘å¤ªé«˜ï¼è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œå°±èƒ½é¿å…å¤§éƒ¨åˆ†æ•…éšœã€‚å½“ç„¶ï¼Œæ¥å£çš„å¹¶å‘ä¸æ˜¯ä¸€ç›´å¾ˆé«˜ï¼Œè€Œæ˜¯çªå‘çš„ã€‚å› æ­¤è¯·æ±‚é™æµï¼Œå°±æ˜¯<strong>é™åˆ¶æˆ–æ§åˆ¶</strong>æ¥å£è®¿é—®çš„å¹¶å‘æµé‡ï¼Œé¿å…æœåŠ¡å› æµé‡æ¿€å¢è€Œå‡ºç°æ•…éšœã€‚</p><p>è¯·æ±‚é™æµå¾€å¾€ä¼šæœ‰ä¸€ä¸ªé™æµå™¨ï¼Œæ•°é‡é«˜ä½èµ·ä¼çš„å¹¶å‘è¯·æ±‚æ›²çº¿ï¼Œç»è¿‡é™æµå™¨å°±å˜çš„éå¸¸å¹³ç¨³ã€‚è¿™å°±åƒæ˜¯æ°´ç”µç«™çš„å¤§åï¼Œèµ·åˆ°è“„æ°´çš„ä½œç”¨ï¼Œå¯ä»¥é€šè¿‡å¼€å…³æ§åˆ¶æ°´æµå‡ºçš„å¤§å°ï¼Œè®©ä¸‹æ¸¸æ°´æµå§‹ç»ˆç»´æŒåœ¨ä¸€ä¸ªå¹³ç¨³çš„é‡ã€‚</p><p><strong>é¡¹ç›®</strong>ï¼šæˆ‘ä»¬è¿™é‡Œç›´æ¥å¯¹è´­ç‰©è½¦è®¾ç½®qpsä¸º10ï¼Œæ¯ç§’å‘100ä¸ªè¯·æ±‚ï¼Œå‘ç°æ‹’ç»qps90ï¼Œé€šè¿‡10ã€‚å®ç°é™æµ</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/image-20250808150758362.png" alt="image-20250808150758362"></p><h2 id="çº¿ç¨‹éš”ç¦»">çº¿ç¨‹éš”ç¦»</h2><p>å½“ä¸€ä¸ªä¸šåŠ¡æ¥å£å“åº”æ—¶é—´é•¿ï¼Œè€Œä¸”å¹¶å‘é«˜æ—¶ï¼Œå°±å¯èƒ½è€—å°½æœåŠ¡å™¨çš„çº¿ç¨‹èµ„æºï¼Œå¯¼è‡´æœåŠ¡å†…çš„å…¶å®ƒæ¥å£å—åˆ°å½±å“ã€‚æ‰€ä»¥æˆ‘ä»¬å¿…é¡»æŠŠè¿™ç§å½±å“é™ä½ï¼Œæˆ–è€…ç¼©å‡å½±å“çš„èŒƒå›´ã€‚çº¿ç¨‹éš”ç¦»æ­£æ˜¯è§£å†³è¿™ä¸ªé—®é¢˜çš„å¥½åŠæ³•ã€‚t</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/image-20250808151348705.png" alt="image-20250808151348705"></p><p>è½®èˆ¹çš„èˆ¹èˆ±ä¼šè¢«éš”æ¿åˆ†å‰²ä¸ºNä¸ªç›¸äº’éš”ç¦»çš„å¯†é—­èˆ±ï¼Œå‡å¦‚è½®èˆ¹è§¦ç¤è¿›æ°´ï¼Œåªæœ‰æŸåçš„éƒ¨åˆ†å¯†é—­èˆ±ä¼šè¿›æ°´ï¼Œè€Œå…¶ä»–èˆ±ç”±äºç›¸äº’éš”ç¦»ï¼Œå¹¶ä¸ä¼šè¿›æ°´ã€‚è¿™æ ·å°±æŠŠè¿›æ°´æ§åˆ¶åœ¨éƒ¨åˆ†èˆ¹ä½“ï¼Œé¿å…äº†æ•´ä¸ªèˆ¹èˆ±è¿›æ°´è€Œæ²‰æ²¡ã€‚ä¸ºäº†é¿å…æŸä¸ªæ¥å£æ•…éšœæˆ–å‹åŠ›è¿‡å¤§å¯¼è‡´æ•´ä¸ªæœåŠ¡ä¸å¯ç”¨ï¼Œæˆ‘ä»¬å¯ä»¥é™å®šæ¯ä¸ªæ¥å£å¯ä»¥ä½¿ç”¨çš„èµ„æºèŒƒå›´ï¼Œä¹Ÿå°±æ˜¯å°†å…¶â€œéš”ç¦»â€èµ·æ¥ã€‚</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/image-20250808151437176.png" alt="image-20250808151437176"></p><p>å¦‚å›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬ç»™æŸ¥è¯¢è´­ç‰©è½¦ä¸šåŠ¡é™å®šå¯ç”¨çº¿ç¨‹æ•°é‡ä¸Šé™ä¸º20ï¼Œè¿™æ ·å³ä¾¿æŸ¥è¯¢è´­ç‰©è½¦çš„è¯·æ±‚å› ä¸ºæŸ¥è¯¢å•†å“æœåŠ¡è€Œå‡ºç°æ•…éšœï¼Œä¹Ÿä¸ä¼šå¯¼è‡´æœåŠ¡å™¨çš„çº¿ç¨‹èµ„æºè¢«è€—å°½ï¼Œä¸ä¼šå½±å“åˆ°å…¶å®ƒæ¥å£ã€‚å› ä¸ºæˆ‘ä»¬æ˜¯<strong>FeignClien</strong>æ¥å£ï¼Œæ‰€ä»¥é¡¹ç›®ä¸­è¿›è¡Œéš”ç¦»çš„æ—¶å€™è¦å¼€å¯Feignçš„SentinelåŠŸèƒ½æ”¯æŒã€‚</p><p><strong>é¡¹ç›®</strong>ï¼šæˆ‘ä»¬å¯¹æŸ¥è¯¢å•†å“æ¥å£è¿›è¡Œæµæ§ï¼Œå› ä¸ºæŸ¥è¯¢è´­ç‰©è½¦çš„ä¸‹çº§é“¾è·¯æ˜¯æŸ¥è¯¢å•†å“ã€‚</p><h2 id="æœåŠ¡ç†”æ–­">æœåŠ¡ç†”æ–­</h2><p>çº¿ç¨‹éš”ç¦»è™½ç„¶é¿å…äº†é›ªå´©é—®é¢˜ï¼Œä½†æ•…éšœæœåŠ¡ï¼ˆå•†å“æœåŠ¡ï¼‰ä¾ç„¶ä¼šæ‹–æ…¢è´­ç‰©è½¦æœåŠ¡ï¼ˆæœåŠ¡è°ƒç”¨æ–¹ï¼‰çš„æ¥å£å“åº”é€Ÿåº¦ã€‚è€Œä¸”å•†å“æŸ¥è¯¢çš„æ•…éšœä¾ç„¶ä¼šå¯¼è‡´æŸ¥è¯¢è´­ç‰©è½¦åŠŸèƒ½å‡ºç°æ•…éšœï¼Œè´­ç‰©è½¦ä¸šåŠ¡ä¹Ÿå˜çš„ä¸å¯ç”¨äº†ã€‚</p><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬è¦åšä¸¤ä»¶äº‹æƒ…ï¼š</p><ul><li><strong>ç¼–å†™æœåŠ¡é™çº§é€»è¾‘</strong>ï¼šå°±æ˜¯æœåŠ¡è°ƒç”¨å¤±è´¥åçš„å¤„ç†é€»è¾‘ï¼Œæ ¹æ®ä¸šåŠ¡åœºæ™¯ï¼Œå¯ä»¥æŠ›å‡ºå¼‚å¸¸ï¼Œä¹Ÿå¯ä»¥è¿”å›å‹å¥½æç¤ºæˆ–é»˜è®¤æ•°æ®ã€‚</li><li><strong>å¼‚å¸¸ç»Ÿè®¡å’Œç†”æ–­</strong>ï¼šç»Ÿè®¡æœåŠ¡æä¾›æ–¹çš„å¼‚å¸¸æ¯”ä¾‹ï¼Œå½“æ¯”ä¾‹è¿‡é«˜è¡¨æ˜è¯¥æ¥å£ä¼šå½±å“åˆ°å…¶å®ƒæœåŠ¡ï¼Œåº”è¯¥æ‹’ç»è°ƒç”¨è¯¥æ¥å£ï¼Œè€Œæ˜¯ç›´æ¥èµ°é™çº§é€»è¾‘ã€‚</li></ul><p><strong>é¡¹ç›®</strong>ï¼šè¿™é‡Œæˆ‘ä»¬ç”¨äº†FallbackFactoryç»™FeignClientç¼–å†™é™çº§é€»è¾‘ï¼Œæœ‰å¼‚å¸¸çš„æ—¶å€™è¿”å›ç©ºæ•°æ®ã€‚</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/image-20250808151531472.png" alt="image-20250808151531472"></p><h1 id="åˆ†å¸ƒå¼äº‹åŠ¡ï¼ˆSeataï¼‰">åˆ†å¸ƒå¼äº‹åŠ¡ï¼ˆSeataï¼‰</h1><p>åœ¨æˆ‘ä»¬è´­ç‰©è½¦æäº¤è®¢å•ä¸šåŠ¡ä¸­ï¼Œåœ¨åŸæœ¬çš„å•ä½“é¡¹ç›®ä¸­ï¼Œæˆ‘é€šè¿‡åœ¨æäº¤è®¢å•æ–¹æ³•ä¸­@Transactional,ä¿è¯äº†äº‹åŠ¡çš„ä¸€è‡´æ€§ã€‚é˜²æ­¢æäº¤è®¢å•çš„æ—¶å€™è´­ç‰©è½¦åˆ é™¤å•†å“ï¼Œä½†æ˜¯åœ¨ä¸šåŠ¡æ‰§è¡Œå®Œæˆä¹‹å‰å‘ç”Ÿäº†æŠ¥é”™(æ¨¡æ‹Ÿåº“å­˜æ²¡äº†)ï¼Œæ²¡æœ‰è¿›è¡Œæ•°æ®çš„å›æ»šï¼Œå¯¼è‡´è´­ç‰©è½¦æ•°æ®æ¶ˆå¤±äº†è€Œä¸”æ²¡æäº¤è®¢å•çš„æƒ…å†µã€‚æ³¨å†Œä¸ºå•ä½“äº‹åŠ¡ï¼Œä¼šä¿è¯ACIDç‰¹æ€§ã€‚</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/image-20250808130021852.png" alt="image-20250808130021852"></p><p>ç”±äºè®¢å•ã€è´­ç‰©è½¦ã€å•†å“åˆ†åˆ«åœ¨ä¸‰ä¸ªä¸åŒçš„å¾®æœåŠ¡ï¼Œè€Œæ¯ä¸ªå¾®æœåŠ¡éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„æ•°æ®åº“ï¼Œå› æ­¤ä¸‹å•è¿‡ç¨‹ä¸­å°±ä¼šè·¨å¤šä¸ªæ•°æ®åº“å®Œæˆä¸šåŠ¡ã€‚è€Œæ¯ä¸ªå¾®æœåŠ¡éƒ½ä¼šæ‰§è¡Œè‡ªå·±çš„æœ¬åœ°äº‹åŠ¡ï¼š</p><ul><li>äº¤æ˜“æœåŠ¡ï¼šä¸‹å•äº‹åŠ¡</li><li>è´­ç‰©è½¦æœåŠ¡ï¼šæ¸…ç†è´­ç‰©è½¦äº‹åŠ¡</li><li>åº“å­˜æœåŠ¡ï¼šæ‰£å‡åº“å­˜äº‹åŠ¡</li></ul><p>æ•´ä¸ªä¸šåŠ¡ä¸­ï¼Œå„ä¸ªæœ¬åœ°äº‹åŠ¡æ˜¯æœ‰å…³è”çš„ã€‚å› æ­¤æ¯ä¸ªå¾®æœåŠ¡çš„æœ¬åœ°äº‹åŠ¡ï¼Œä¹Ÿå¯ä»¥ç§°ä¸º<strong>åˆ†æ”¯äº‹åŠ¡</strong>ã€‚å¤šä¸ªæœ‰å…³è”çš„åˆ†æ”¯äº‹åŠ¡ä¸€èµ·å°±ç»„æˆäº†<strong>å…¨å±€äº‹åŠ¡</strong>ã€‚æˆ‘ä»¬å¿…é¡»ä¿è¯æ•´ä¸ªå…¨å±€äº‹åŠ¡åŒæ—¶æˆåŠŸæˆ–å¤±è´¥ï¼Œæ¯ä¸€ä¸ªåˆ†æ”¯äº‹åŠ¡å°±æ˜¯ä¼ ç»Ÿçš„<strong>å•ä½“äº‹åŠ¡</strong>ï¼Œéƒ½å¯ä»¥æ»¡è¶³ACIDç‰¹æ€§ï¼Œç»è¿‡æµ‹è¯•åœ¨å¾®æœåŠ¡ä¸­<strong>æ— æ³•æ»¡è¶³</strong>æ•´ä¸ªä¸šåŠ¡æµç¨‹çš„ACIDï¼Œå‚ä¸äº‹åŠ¡çš„å¤šä¸ªå­ä¸šåŠ¡åœ¨ä¸åŒçš„å¾®æœåŠ¡ï¼Œè·¨è¶Šäº†ä¸åŒçš„æ•°æ®åº“ã€‚è™½ç„¶æ¯ä¸ªå•ç‹¬çš„ä¸šåŠ¡éƒ½èƒ½åœ¨æœ¬åœ°éµå¾ªACIDï¼Œä½†æ˜¯å®ƒä»¬<strong>äº’ç›¸ä¹‹é—´æ²¡æœ‰æ„ŸçŸ¥</strong>ï¼Œä¸çŸ¥é“æœ‰äººå¤±è´¥äº†ï¼Œæ— æ³•ä¿è¯æœ€ç»ˆç»“æœçš„ç»Ÿä¸€ï¼Œä¹Ÿå°±æ— æ³•éµå¾ªACIDçš„äº‹åŠ¡ç‰¹æ€§äº†ã€‚</p><blockquote><p>è¿™å°±æ˜¯åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜ï¼Œå‡ºç°ä»¥ä¸‹æƒ…å†µä¹‹ä¸€å°±å¯èƒ½äº§ç”Ÿåˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜ï¼š</p><ul><li>ä¸šåŠ¡è·¨å¤šä¸ªæœåŠ¡å®ç°</li><li>ä¸šåŠ¡è·¨å¤šä¸ªæ•°æ®æºå®ç°</li></ul></blockquote><h2 id="Seata">Seata</h2><p>è¿™é‡Œé‡‡ç”¨ä½¿ç”¨é˜¿é‡Œå¼€æºçš„Seataè§£å†³åˆ†å¸ƒå¼çš„äº‹åŠ¡é—®é¢˜ã€‚åˆ†å¸ƒå¼äº‹åŠ¡äº§ç”Ÿçš„æ ¹æœ¬åŸå› å°±æ˜¯äº’ç›¸æ²¡æ„ŸçŸ¥ä¹ˆï¼Œé‚£è§£å†³æ€è·¯å°±åƒä¹‹å‰å­¦Redisåˆ†å¸ƒå¼é”ä¸€æ ·ï¼Œæ‰¾ä¸€ä¸ªèƒ½ç®¡ç†æ‰€æœ‰å•ä½“äº‹åŠ¡çš„ä¸œè¥¿ã€‚è¿™é‡Œ<strong>äº‹åŠ¡åè°ƒè€…</strong>ï¼Œä»–çš„ä»»åŠ¡å°±æ˜¯ç›‘æ§æ¯ä¸ªå•ä½“äº‹åŠ¡ï¼Œåˆ¤æ–­äº‹åŠ¡æäº¤å’Œå¤±è´¥ï¼Œç„¶åæ‰¾ä¸€ä¸ªå…¨å±€äº‹åŠ¡ï¼Œä¿è¯å…¨å±€äº‹åŠ¡ä¸‹æ¯ä¸ªäº‹åŠ¡éƒ½è¦ä¸€èµ·æäº¤æˆ–è€…å›æ»šã€‚Seataä¹Ÿæ˜¯è¿™ä¹ˆä¸ªæ€è·¯ã€‚</p><p>ä»–åˆ†äº†TMï¼ŒTCï¼ŒRMã€‚ä¸‰ä¸ªè§’è‰²ç®¡ç†äº‹åŠ¡ã€‚</p><ul><li><strong>TC(Transaction Coordinator)-äº‹åŠ¡åè°ƒè€…</strong>ï¼šç»´æŠ¤å…¨å±€å’Œåˆ†æ”¯äº‹åŠ¡çš„çŠ¶æ€ï¼Œåè°ƒå…¨å±€äº‹åŠ¡æäº¤æˆ–å›æ»šã€‚</li><li><strong>TM (Transaction Manager)-äº‹åŠ¡ç®¡ç†å™¨</strong>ï¼šå®šä¹‰å…¨å±€äº‹åŠ¡çš„èŒƒå›´ã€å¼€å§‹å…¨å±€äº‹åŠ¡ã€æäº¤æˆ–å›æ»šå…¨å±€äº‹åŠ¡ã€‚</li><li><strong>RM (Resource Manager)-èµ„æºç®¡ç†å™¨</strong>ï¼šç®¡ç†åˆ†æ”¯äº‹åŠ¡ï¼Œä¸TCäº¤è°ˆä»¥æ³¨å†Œåˆ†æ”¯äº‹åŠ¡å’ŒæŠ¥å‘Šåˆ†æ”¯äº‹åŠ¡çš„çŠ¶æ€ï¼Œå¹¶é©±åŠ¨åˆ†æ”¯äº‹åŠ¡æäº¤æˆ–å›æ»šã€‚</li></ul><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/image-20250808132858193.png" alt="image-20250808132858193"></p><p>å…¶ä¸­ï¼Œ<strong>TM</strong>å’Œ<strong>RM</strong>å¯ä»¥ç†è§£ä¸ºSeataçš„å®¢æˆ·ç«¯éƒ¨åˆ†ï¼Œå¼•å…¥åˆ°å‚ä¸äº‹åŠ¡çš„å¾®æœåŠ¡ä¾èµ–ä¸­å³å¯ã€‚å°†æ¥<strong>TM</strong>å’Œ<strong>RM</strong>å°±ä¼šååŠ©å¾®æœåŠ¡ï¼Œå®ç°æœ¬åœ°åˆ†æ”¯äº‹åŠ¡ä¸<strong>TC</strong>ä¹‹é—´äº¤äº’ï¼Œå®ç°äº‹åŠ¡çš„æäº¤æˆ–å›æ»šã€‚</p><p>è€Œ<strong>TC</strong>æœåŠ¡åˆ™æ˜¯äº‹åŠ¡åè°ƒä¸­å¿ƒï¼Œæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„å¾®æœåŠ¡ï¼Œéœ€è¦å•ç‹¬éƒ¨ç½²ã€‚éƒ¨ç½²è¿‡ç¨‹å°±çœç•¥äº†ï¼Œè¿™é‡Œç›´æ¥è¯´ä¸€ä¸‹Seataçš„ä¸¤ç§åˆ†å¸ƒå¼è§£å†³æ–¹æ¡ˆï¼ŒATå’ŒXAã€‚ä¸€å…±æœ‰å››ç§è¿˜æœ‰TCCå’ŒSAGA</p><h2 id="XAæ¨¡å¼">XAæ¨¡å¼</h2><p>è¿™ç§æ¨¡å¼æ˜¯<strong>å¼ºä¸€è‡´æ€§</strong>äº‹åŠ¡ï¼Œåˆ†ä¸¤é˜¶æ®µçš„æ“ä½œã€‚é¦–å…ˆTMä¼šå¼€å¯å…¨å±€äº‹åŠ¡å¹¶ç®¡ç†åˆ†æ”¯äº‹åŠ¡</p><p>RMä¸€é˜¶æ®µæ“ä½œ</p><ol><li>æ³¨å†Œåˆ†æ”¯äº‹åŠ¡åˆ°TC</li><li>æ‰§è¡Œä¸šåŠ¡sqlä½†æ˜¯ä¸æäº¤</li><li>æŠ¥å‘Šäº‹åŠ¡çš„çŠ¶æ€æˆåŠŸæˆ–å¤±è´¥</li></ol><p>TCå’ŒRMäºŒé˜¶æ®µæ“ä½œ</p><ol><li>TCæ£€æŸ¥å„åˆ†æ”¯çš„çŠ¶æ€ï¼Œå…¨æˆåŠŸå°±æäº¤ï¼Œæœ‰ä¸€ä¸ªå¤±è´¥å°±å›æ»šï¼Œé€šçŸ¥RMæ‰§è¡Œæ“ä½œ</li><li>å¬åˆ°TCæ£€æŸ¥åˆ†æ”¯äº‹åŠ¡çš„çŠ¶æ€å†³å®šæ˜¯å¦å…¨éƒ¨æäº¤</li></ol><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/image-20250808135450904.png" alt="image-20250808135450904"></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">seata:</span></span><br><span class="line">  <span class="attr">data-source-proxy-mode:</span> <span class="string">XA</span></span><br></pre></td></tr></table></figure><p>ä¼˜ç‚¹ï¼š</p><ul><li>äº‹åŠ¡çš„å¼ºä¸€è‡´æ€§ï¼Œä¿è¯äº†ACIDåŸåˆ™</li><li>å¸¸ç”¨æ•°æ®åº“éƒ½æ”¯æŒï¼Œå®ç°ç®€å•ï¼Œæ²¡æœ‰ä»£ç å…¥ä¾µ@GlobalTransaction</li></ul><p>ç¼ºç‚¹ï¼š</p><ul><li>ç±»ä¼¼äºä¸²è¡Œæ“ä½œï¼Œå½“äºŒé˜¶æ®µæ²¡ç»“æŸçš„æ—¶å€™ï¼Œä¸€é˜¶æ®µä¼šé”å®šæ•°æ®åº“èµ„æºï¼ŒRMç®¡ç†çš„<code>å¾®æœåŠ¡æ— æ³•å†æ‰§è¡Œå…¶ä»–æ“ä½œ</code>ï¼Œå½“äºŒé˜¶æ®µæ‰§è¡Œå®Œæ¯•ä»¥åæ‰ä¼šé‡Šæ”¾ä¸€é˜¶æ®µçš„èµ„æºï¼Œä¼šå¯¼è‡´æ€§èƒ½è¿‡å·®ã€‚</li></ul><h2 id="ATæ¨¡å¼-é»˜è®¤">ATæ¨¡å¼(é»˜è®¤)</h2><p><code>AT</code>æ¨¡å¼åŒæ ·æ˜¯åˆ†é˜¶æ®µæäº¤çš„äº‹åŠ¡æ¨¡å‹ï¼Œä¸è¿‡ç¼ºå¼¥è¡¥äº†<code>XA</code>æ¨¡å‹ä¸­èµ„æºé”å®šå‘¨æœŸè¿‡é•¿çš„ç¼ºé™·ã€‚ä»–çš„å·¥ä½œåŸç†æ˜¯è¿™æ ·çš„å‰é¢éƒ¨åˆ†ä¸€æ ·ï¼Œä½†æ˜¯åœ¨RMæ‰§è¡Œsql çš„æ—¶å€™ä¼šç›´æ¥æäº¤**ï¼ˆè¿™ä¸ªæ—¶å€™ä¼šé‡Šæ”¾æ•°æ®åº“é”ï¼‰<strong>ï¼Œé‚£å¦‚ä½•è¿›è¡Œæ•°æ®å›æ»šå‘¢ï¼Œä»–é‡‡ç”¨äº†å¿«ç…§ï¼Œè¦ä½¿ç”¨ATæ¨¡å¼ï¼Œè¦åœ¨æ¯ä¸ªæ•°æ®åº“å»ºä¸€ä¸ªundo logè¡¨ï¼Œä»–ä¼šåœ¨æ‰§è¡Œsqlå‰è®°å½•æ›´æ–°å‰çš„æ•°æ®ï¼Œæ”¾åˆ°undo logè¡¨ä¸­ï¼Œå½“åæœŸTCé€šçŸ¥RMæäº¤çš„æ—¶å€™ä¼šåˆ é™¤logï¼Œå¦‚æœè¦å›æ»šï¼Œå°±æŒ‰ç…§è®°å½•çš„logè¿›è¡Œæ•°æ®å›æ»šï¼Œå›æ»šä»¥åå†åˆ é™¤æ•°æ®ï¼Œå®ƒæ˜¯</strong>æœ€ç»ˆä¸€è‡´æ€§**äº‹åŠ¡ã€‚è¿™å…¶å®å°±æ˜¯ç©ºé—´æ¢æ—¶é—´çš„ä¸€ç§æ€æƒ³ï¼Œä¿è¯ç›´æ¥æäº¤ï¼Œé‚£ä¹ˆå¦‚æœæ•°æ®è¦å›æ»šï¼Œå°±è¦è®°å½•æ•°æ®ã€‚ä½†æ˜¯æ­£å¸¸ä¸šåŠ¡ä¸­å…¶å®å›æ»šçš„æ“ä½œæ˜¯æ¯”è¾ƒå°‘çš„ï¼Œæ‰€ä»¥ç”¨ATæ¨¡å¼æ€§èƒ½æ¯”è¾ƒå¥½ï¼Œç»¼åˆä¸‹æ¥ä¹Ÿæ¯”è¾ƒå¥½ç”¨ï¼Œå®ƒä¹Ÿæœ‰ç¼ºç‚¹</p><p>â€”â€”ï¼ˆå‡è®¾è¿™æ¬¡ä¼šå¤±è´¥å›æ»šï¼‰å½“åˆ†æ”¯ä¸šåŠ¡æäº¤ä»¥å~å›æ»šä¹‹å‰ï¼Œè¿™æ®µæ—¶é—´æœ‰å…¶ä»–ä¸šåŠ¡è®¿é—®æ•°æ®åº“ï¼Œä¼šå‡ºç°æ•°æ®åº“ä¸ä¸€è‡´çš„é—®é¢˜ï¼Œè¿™æ˜¯æ— æ³•é¿å…çš„ï¼Œä½†æ˜¯è¿™æ®µæ—¶é—´å¾ˆçŸ­ï¼Œè¦ä½œå–èˆã€‚</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/image-20250808141301723.png" alt="image-20250808141301723"></p><h2 id="åŒºåˆ«">åŒºåˆ«</h2><ul><li><code>XA</code>æ¨¡å¼ä¸€é˜¶æ®µä¸æäº¤äº‹åŠ¡ï¼Œé”å®šèµ„æºï¼›<code>AT</code>æ¨¡å¼ä¸€é˜¶æ®µç›´æ¥æäº¤ï¼Œä¸é”å®šèµ„æºã€‚</li><li><code>XA</code>æ¨¡å¼ä¾èµ–æ•°æ®åº“æœºåˆ¶å®ç°å›æ»šï¼›<code>AT</code>æ¨¡å¼åˆ©ç”¨æ•°æ®å¿«ç…§å®ç°æ•°æ®å›æ»šã€‚</li><li><code>XA</code>æ¨¡å¼å¼ºä¸€è‡´ï¼›<code>AT</code>æ¨¡å¼æœ€ç»ˆä¸€è‡´</li></ul>]]></content>
    
    
    <summary type="html">æ¢³ç†çš„å¾®æœåŠ¡é‡è¦çŸ¥è¯†ç‚¹ï¼</summary>
    
    
    
    <category term="å­¦ä¹ ç¬”è®°" scheme="https://u7u7.top/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    
    <category term="å¾®æœåŠ¡" scheme="https://u7u7.top/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"/>
    
    <category term="Java" scheme="https://u7u7.top/tags/Java/"/>
    
    <category term="ä¸ªäººç†è§£" scheme="https://u7u7.top/tags/%E4%B8%AA%E4%BA%BA%E7%90%86%E8%A7%A3/"/>
    
    <category term="é¡¹ç›®" scheme="https://u7u7.top/tags/%E9%A1%B9%E7%9B%AE/"/>
    
  </entry>
  
  <entry>
    <title>åŠ›æ‰£åˆ·é¢˜</title>
    <link href="https://u7u7.top/posts/leetcodeSF.html"/>
    <id>https://u7u7.top/posts/leetcodeSF.html</id>
    <published>2025-08-01T03:00:25.000Z</published>
    <updated>2025-08-20T01:46:07.478Z</updated>
    
    <content type="html"><![CDATA[<p>åŠ›æ‰£ç®—æ³•é¢˜â€”â€”è¿™é‡Œéƒ½æ˜¯è‡ªå·±åšè¿‡çš„ï¼Œæ‰“ç®—ä»2025å¹´8æœˆå¼€å§‹èƒ½ä¿æŒåœ¨ä¸€å¤©ä¸€é“çš„é¢‘ç‡ã€‚åŠ›æ‰£çƒ­é—¨100é¢˜è¿›è¡Œäº†æ ‡æ³¨ã€‚æˆ‘çœ‹çƒ­é—¨é¢˜é‡Œé¢äºŒå‰æ ‘å’ŒåŠ¨æ€è§„åˆ’æ˜¯ä¸å¤ªç†Ÿçš„ï¼Œè¦æŠ½æ—¶é—´èŠ±åŠŸå¤«å­¦ä¹ ä¸€ä¸‹ã€‚</p><h1 id="å“ˆå¸Œ">å“ˆå¸Œ</h1><h2 id="2025-07-161-ä¸¤æ•°ä¹‹å’Œç®€å•">2025-07-16<a href="https://leetcode.cn/problems/two-sum/">1. ä¸¤æ•°ä¹‹å’Œ</a><code>ç®€å•</code></h2><blockquote><p>ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ <code>nums</code> å’Œä¸€ä¸ªæ•´æ•°ç›®æ ‡å€¼ <code>target</code>ï¼Œè¯·ä½ åœ¨è¯¥æ•°ç»„ä¸­æ‰¾å‡º <strong>å’Œä¸ºç›®æ ‡å€¼</strong> <em><code>target</code></em> çš„é‚£ <strong>ä¸¤ä¸ª</strong> æ•´æ•°ï¼Œå¹¶è¿”å›å®ƒä»¬çš„æ•°ç»„ä¸‹æ ‡ã€‚</p><p>é¢˜è§£ï¼šç”¨hashå€¼ä¸­çš„containskeyæ–¹æ³•ï¼Œéå†ä¸€éæ•°ç»„ï¼Œå­˜åœ¨å’Œtarget-num1ä¸€æ ·å¤§çš„æ•°å­—num2ï¼Œä»£è¡¨num1+num2=targetï¼Œvalueè®°å½•ä¸‹æ ‡ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span>[] twoSum(<span class="type">int</span>[] nums, <span class="type">int</span> target) &#123;</span><br><span class="line">        HashMap&lt;Integer,Integer&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;Integer,Integer&gt;();</span><br><span class="line">        <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> nums.length;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;len;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(map.containsKey(target-nums[i]))&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">int</span>[]&#123;map.get(target-nums[i]),i&#125;;</span><br><span class="line">            &#125;</span><br><span class="line">            map.put(nums[i],i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">int</span>[]&#123;<span class="number">0</span>&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2025-07-1649-å­—æ¯å¼‚ä½è¯åˆ†ç»„ä¸­ç­‰">2025-07-16<a href="https://leetcode.cn/problems/group-anagrams/">49. å­—æ¯å¼‚ä½è¯åˆ†ç»„</a><code>ä¸­ç­‰</code></h2><blockquote><p>é¢˜è§£ï¼šéå†å­ä¸²æ•°ç»„ï¼Œå…¨éƒ¨æŒ‰acsillç æ’åºã€‚æ’å¥½åºå‘mapä¸­æ·»åŠ ï¼Œå­˜åœ¨å°±åˆ—è¡¨æ·»åŠ ï¼Œä¸å­˜åœ¨åˆ›å»ºkeyï¼Œæ‰“å°value</p><p>ç»™ä½ ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„ï¼Œè¯·ä½ å°† å­—æ¯å¼‚ä½è¯ ç»„åˆåœ¨ä¸€èµ·ã€‚å¯ä»¥æŒ‰ä»»æ„é¡ºåºè¿”å›ç»“æœåˆ—è¡¨ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;String&gt;&gt; <span class="title function_">groupAnagrams</span><span class="params">(String[] strs)</span> &#123;</span><br><span class="line">        HashMap&lt;String, List&lt;String&gt;&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (String str : strs) &#123;</span><br><span class="line">            <span class="comment">//æ’åº eat -&gt; aet</span></span><br><span class="line">            <span class="type">char</span>[] chars = str.toCharArray();</span><br><span class="line">            Arrays.sort(chars);</span><br><span class="line">            <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(chars);</span><br><span class="line">            List&lt;String&gt; listRes = map.getOrDefault(key, <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;());</span><br><span class="line">            listRes.add(str);</span><br><span class="line">            map.put(key,listRes);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(map.values());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2025-07-22128-æœ€é•¿è¿ç»­åºåˆ—ä¸­ç­‰">2025-07-22<a href="https://leetcode.cn/problems/longest-consecutive-sequence/">128. æœ€é•¿è¿ç»­åºåˆ—</a><code>ä¸­ç­‰</code></h2><blockquote><p>é¢˜è§£ï¼šå…ˆå°†æ‰€æœ‰æ•°å­—æ”¾hashsetä¸­ï¼Œå­˜åœ¨éå†setï¼Œå­˜åœ¨å½“å‰æ•°å­—å°1çš„ä¸­æ–­å½“å‰å¾ªç¯ã€‚è¿™æ ·èƒ½æœ€å°å¼€å§‹ç®—ï¼Œå½“æœ‰æ¯”å½“å‰æ•°å­—å¤§1çš„whileå¾ªç¯ï¼Œä¸€ç›´+1ï¼Œç›´åˆ°ä¸å­˜åœ¨ï¼Œè®°å½•é•¿åº¦ã€‚è¿™æ ·å°±èƒ½æ‰¾åˆ°æœ€é•¿è¿ç»­çš„æ•´æ•°é•¿åº¦ã€‚</p><p>ç»™å®šä¸€ä¸ªæœªæ’åºçš„æ•´æ•°æ•°ç»„ <code>nums</code> ï¼Œæ‰¾å‡ºæ•°å­—è¿ç»­çš„æœ€é•¿åºåˆ—ï¼ˆä¸è¦æ±‚åºåˆ—å…ƒç´ åœ¨åŸæ•°ç»„ä¸­è¿ç»­ï¼‰çš„é•¿åº¦ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">longestConsecutive</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">length</span> <span class="operator">=</span> nums.length;</span><br><span class="line">        <span class="keyword">if</span> (length&lt;=<span class="number">1</span>) <span class="keyword">return</span> length;</span><br><span class="line">        Set&lt;Integer&gt; numSet = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> num : nums) &#123;</span><br><span class="line">            numSet.add(num);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> longestStreak=<span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> currentStreak=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> num : numSet)&#123;</span><br><span class="line">            <span class="keyword">if</span> (numSet.contains(num-<span class="number">1</span>))&#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">int</span> <span class="variable">currentNum</span> <span class="operator">=</span> num;</span><br><span class="line">            currentStreak=<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">while</span> (numSet.contains(currentNum+<span class="number">1</span>))&#123;</span><br><span class="line">                currentNum++;</span><br><span class="line">                currentStreak++;</span><br><span class="line">            &#125;</span><br><span class="line">            longestStreak = Math.max(longestStreak, currentStreak);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> longestStreak;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="åŒæŒ‡é’ˆ">åŒæŒ‡é’ˆ</h1><h2 id="2025-07-06283-ç§»åŠ¨é›¶ç®€å•">2025-07-06<a href="https://leetcode.cn/problems/move-zeroes/">283. ç§»åŠ¨é›¶</a><code>ç®€å•</code></h2><blockquote><p>é¢˜è§£ï¼šæŠŠéå†çš„æ‰€æœ‰éé›¶æ•°ç»™æ–°æ•°ç»„ï¼Œä¸¤ä¸ªæ•°ç»„ä¸€æ ·é•¿ï¼Œæ–°æ•°ç»„æ²¡èµ‹å€¼çš„åé¢å…¨0</p><p>ç»™å®šä¸€ä¸ªæ•°ç»„ <code>nums</code>ï¼Œç¼–å†™ä¸€ä¸ªå‡½æ•°å°†æ‰€æœ‰ <code>0</code> ç§»åŠ¨åˆ°æ•°ç»„çš„æœ«å°¾ï¼ŒåŒæ—¶ä¿æŒéé›¶å…ƒç´ çš„ç›¸å¯¹é¡ºåºã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">moveZeroes</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(nums==<span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//ç¬¬ä¸€æ¬¡éå†çš„æ—¶å€™ï¼ŒjæŒ‡é’ˆè®°å½•é0çš„ä¸ªæ•°ï¼Œåªè¦æ˜¯é0çš„ç»Ÿç»Ÿéƒ½èµ‹ç»™nums[j]</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;nums.length;++i) &#123;</span><br><span class="line">            <span class="keyword">if</span>(nums[i]!=<span class="number">0</span>) &#123;</span><br><span class="line">                nums[j++] = nums[i];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//é0å…ƒç´ ç»Ÿè®¡å®Œäº†ï¼Œå‰©ä¸‹çš„éƒ½æ˜¯0äº†</span></span><br><span class="line">        <span class="comment">//æ‰€ä»¥ç¬¬äºŒæ¬¡éå†æŠŠæœ«å°¾çš„å…ƒç´ éƒ½èµ‹ä¸º0å³å¯</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=j;i&lt;nums.length;++i) &#123;</span><br><span class="line">            nums[i] = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2025-07-2311-ç››æœ€å¤šæ°´çš„å®¹å™¨ä¸­ç­‰">2025-07-23<a href="https://leetcode.cn/problems/container-with-most-water/">11. ç››æœ€å¤šæ°´çš„å®¹å™¨</a><code>ä¸­ç­‰</code></h2><blockquote><p>é¢˜è§£ï¼šå·¦å³æŒ‡é’ˆï¼Œä¸€ä¸ªåœ¨æœ€å·¦è¾¹ä¸€ä¸ªåœ¨æœ€å³è¾¹ï¼Œå½“å·¦è¾¹é«˜åº¦æ¯”å³è¾¹å°ï¼Œå»ºç«‹ä¸´æ—¶å˜é‡ä¸ºå½“å‰å·¦ä¾§é•¿åº¦ï¼Œä¸€ç›´å·¦æŒ‡é’ˆå³ç§»ï¼Œç›´åˆ°å¤§äºå¤–å¾ªç¯å·¦ä¾§é•¿åº¦ç»Ÿè®¡æœ€å¤§å€¼ã€‚åŒç†å½“å³ä¾§å°ï¼Œå³ä¾§å‘å·¦è¾¹ç§»ã€‚ä¸ºä»€ä¹ˆå¯ä»¥è¿™æ ·ç§»åŠ¨ï¼Ÿå› ä¸ºåªè¦æŸä¸€ä¾§ç§»åŠ¨çš„æ—¶å€™ï¼Œé‡åˆ°çš„æŸ±å­æ¯”ä¹‹å‰çŸ­ï¼Œå°±ä¸€å®šä»£è¡¨å­˜å‚¨é‡å°ï¼Œåº•çŸ­äº†é«˜ä¹ŸçŸ­äº†ã€‚</p><p>ç»™å®šä¸€ä¸ªé•¿åº¦ä¸º <code>n</code> çš„æ•´æ•°æ•°ç»„ <code>height</code> ã€‚æœ‰ <code>n</code> æ¡å‚çº¿ï¼Œç¬¬ <code>i</code> æ¡çº¿çš„ä¸¤ä¸ªç«¯ç‚¹æ˜¯ <code>(i, 0)</code> å’Œ <code>(i, height[i])</code> ã€‚æ‰¾å‡ºå…¶ä¸­çš„ä¸¤æ¡çº¿ï¼Œä½¿å¾—å®ƒä»¬ä¸ <code>x</code> è½´å…±åŒæ„æˆçš„å®¹å™¨å¯ä»¥å®¹çº³æœ€å¤šçš„æ°´ã€‚è¿”å›å®¹å™¨å¯ä»¥å‚¨å­˜çš„æœ€å¤§æ°´é‡ã€‚</p></blockquote><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/image-20250814172644706.png" alt="image-20250814172644706"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maxArea</span><span class="params">(<span class="type">int</span>[] height)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">left</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">right</span> <span class="operator">=</span> height.length-<span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">maxArea</span> <span class="operator">=</span> (right-left)*Math.min(height[left], height[right]);<span class="comment">//ä½“ç§¯</span></span><br><span class="line">        <span class="keyword">while</span> (left&lt;right) &#123;</span><br><span class="line">            <span class="keyword">if</span> (height[left]&lt;=height[right]) &#123;</span><br><span class="line">                <span class="type">int</span> <span class="variable">temp</span> <span class="operator">=</span> height[left];</span><br><span class="line">                <span class="keyword">while</span> (left&lt;right &amp;&amp; height[left]&lt;=temp) &#123;</span><br><span class="line">                    left++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="type">int</span> <span class="variable">temp</span> <span class="operator">=</span> height[right];</span><br><span class="line">                <span class="keyword">while</span> (left&lt;right &amp;&amp; height[right]&lt;=temp) &#123;</span><br><span class="line">                    right--;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            maxArea = Math.max(maxArea, (right-left)*Math.min(height[left], height[right]));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> maxArea;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2025-07-1615-ä¸‰æ•°ä¹‹å’Œä¸­ç­‰">2025-07-16<a href="https://leetcode.cn/problems/3sum/">15. ä¸‰æ•°ä¹‹å’Œ</a><code>ä¸­ç­‰</code></h2><blockquote><p>é¢˜è§£ï¼šæ‰¾åˆ°ä¸‰ä¸ªæ•°ç›¸åŠ ä¸º0ï¼Œå…ˆæ’åºï¼Œä»å·¦å‘å³éå†ï¼ŒåŒæ—¶è®¾ç½®å·¦å³æŒ‡é’ˆï¼Œå·¦æŒ‡é’ˆæ˜¯å½“å‰ç´¢å¼•+1ï¼Œå³æŒ‡é’ˆæ˜¯å³ä¾§ï¼Œåˆ¤æ–­å†…ç¼©ï¼Œå¤§äº0å³æ”¶ç¼©ï¼Œå°äº0å·¦æ”¶ç¼©ã€‚ä¸º0å°±æ”¶é›†å¹¶ä¸”å»é‡å·¦å³æŒ‡é’ˆç§»åŠ¨ï¼Œå»é™¤é‡å¤å€¼ã€‚</p><p>ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ <code>nums</code> ï¼Œåˆ¤æ–­æ˜¯å¦å­˜åœ¨ä¸‰å…ƒç»„ <code>[nums[i], nums[j], nums[k]]</code> æ»¡è¶³ <code>i != j</code>ã€<code>i != k</code> ä¸” <code>j != k</code> ï¼ŒåŒæ—¶è¿˜æ»¡è¶³ <code>nums[i] + nums[j] + nums[k] == 0</code> ã€‚è¯·ä½ è¿”å›æ‰€æœ‰å’Œä¸º <code>0</code> ä¸”ä¸é‡å¤çš„ä¸‰å…ƒç»„ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.AbstractList;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">threeSum</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">AbstractList</span>&lt;List&lt;Integer&gt;&gt;() &#123;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> List&lt;Integer&gt; <span class="title function_">get</span><span class="params">(<span class="type">int</span> index)</span> &#123;</span><br><span class="line">                init();</span><br><span class="line">                <span class="keyword">return</span> result.get(index);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">size</span><span class="params">()</span> &#123;</span><br><span class="line">                init();</span><br><span class="line">                <span class="keyword">return</span> result.size();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">private</span> List&lt;List&lt;Integer&gt;&gt; result;</span><br><span class="line">            <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (result != <span class="literal">null</span>) <span class="keyword">return</span>;</span><br><span class="line">                result = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">                <span class="keyword">if</span> (nums.length &lt; <span class="number">3</span>) &#123;</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                Arrays.sort(nums);</span><br><span class="line">                <span class="keyword">if</span> (nums[<span class="number">0</span>] &gt;<span class="number">0</span>) <span class="keyword">return</span>;</span><br><span class="line">                <span class="comment">// å¤–å±‚å¾ªç¯ï¼šå›ºå®šä¸‰å…ƒç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼ˆç´¢å¼•iï¼‰</span></span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; nums.length - <span class="number">2</span>; i++) &#123;</span><br><span class="line">                    <span class="comment">// å·¦æŒ‡é’ˆï¼ši+1ï¼ˆç¬¬äºŒä¸ªå…ƒç´ ï¼‰</span></span><br><span class="line">                    <span class="type">int</span> <span class="variable">left</span> <span class="operator">=</span> i + <span class="number">1</span>;</span><br><span class="line">                    <span class="comment">// å³æŒ‡é’ˆï¼šæ•°ç»„æœ«å°¾ï¼ˆç¬¬ä¸‰ä¸ªå…ƒç´ ï¼‰</span></span><br><span class="line">                    <span class="type">int</span> <span class="variable">right</span> <span class="operator">=</span> nums.length - <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// åŒæŒ‡é’ˆéå†ï¼šå¯»æ‰¾ä¸nums[i]ä¹‹å’Œä¸º0çš„ä¸¤ä¸ªå…ƒç´ </span></span><br><span class="line">                    <span class="keyword">while</span> (left &lt; right) &#123;</span><br><span class="line">                        <span class="comment">// è®¡ç®—ä¸‰æ•°ä¹‹å’Œï¼ˆç”¨longé¿å…intæº¢å‡ºï¼‰</span></span><br><span class="line">                        <span class="type">long</span> <span class="variable">sum</span> <span class="operator">=</span> (<span class="type">long</span>) nums[i] + nums[left] + nums[right];</span><br><span class="line">                        <span class="keyword">if</span> (sum == <span class="number">0</span>) &#123;</span><br><span class="line">                            <span class="comment">// æ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„ä¸‰å…ƒç»„ï¼Œæ·»åŠ åˆ°ç»“æœåˆ—è¡¨</span></span><br><span class="line">                            result.add(Arrays.asList(nums[i], nums[left], nums[right]));</span><br><span class="line">                            <span class="comment">// å»é‡ï¼šè·³è¿‡leftæŒ‡é’ˆåæ‰€æœ‰ä¸å½“å‰nums[left]ç›¸åŒçš„å…ƒç´ </span></span><br><span class="line">                            <span class="keyword">while</span> (left &lt; right &amp;&amp; nums[left] == nums[++left]);</span><br><span class="line">                            <span class="comment">// å»é‡ï¼šè·³è¿‡rightæŒ‡é’ˆå‰æ‰€æœ‰ä¸å½“å‰nums[right]ç›¸åŒçš„å…ƒç´ </span></span><br><span class="line">                            <span class="keyword">while</span> (left &lt; right &amp;&amp; nums[right] == nums[--right]);</span><br><span class="line">                        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (sum &lt; <span class="number">0</span>) &#123;</span><br><span class="line">                            <span class="comment">// å’Œå°äº0ï¼šéœ€è¦å¢å¤§æ€»å’Œï¼Œå·¦æŒ‡é’ˆå³ç§»ï¼ˆæ•°ç»„å·²æ’åºï¼Œå³ç§»åå€¼å˜å¤§ï¼‰</span></span><br><span class="line">                            <span class="comment">// åŒæ—¶è·³è¿‡é‡å¤å…ƒç´ </span></span><br><span class="line">                            <span class="keyword">while</span> (left &lt; right &amp;&amp; nums[left] == nums[++left]);</span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                            <span class="comment">// å’Œå¤§äº0ï¼šéœ€è¦å‡å°æ€»å’Œï¼Œå³æŒ‡é’ˆå·¦ç§»ï¼ˆå·¦ç§»åå€¼å˜å°ï¼‰</span></span><br><span class="line">                            <span class="comment">// åŒæ—¶è·³è¿‡é‡å¤å…ƒç´ </span></span><br><span class="line">                            <span class="keyword">while</span> (left &lt; right &amp;&amp; nums[right] == nums[--right]);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">// å»é‡ï¼šè·³è¿‡å¤–å±‚å¾ªç¯ä¸­ä¸å½“å‰nums[i]ç›¸åŒçš„å…ƒç´ ï¼ˆé¿å…é‡å¤ä¸‰å…ƒç»„ï¼‰</span></span><br><span class="line">                    <span class="keyword">while</span> (i &lt; nums.length - <span class="number">2</span> &amp;&amp; nums[i] == nums[i + <span class="number">1</span>]) &#123;</span><br><span class="line">                        i++;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="2025-07-2442-æ¥é›¨æ°´å›°éš¾">2025-07-24<a href="https://leetcode.cn/problems/trapping-rain-water/">42. æ¥é›¨æ°´</a><code>å›°éš¾</code></h1><blockquote><p>é¢˜è§£ï¼š</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">trap</span><span class="params">(<span class="type">int</span>[] height)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (height.length&lt;=<span class="number">2</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="comment">//æ‰¾æœ€é«˜æŸ±å­</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">maxHeight</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">maxIndex</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; height.length; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (height[i]&gt;maxHeight)&#123;</span><br><span class="line">                maxHeight = height[i];</span><br><span class="line">                maxIndex=i;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> <span class="variable">res</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> maxTemp=<span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> i=<span class="number">0</span>;</span><br><span class="line">        <span class="comment">//å·¦ä¾§ç§¯æ°´</span></span><br><span class="line">        <span class="keyword">while</span> (i&lt;maxIndex)&#123;</span><br><span class="line">            <span class="keyword">if</span> (height[i]&gt;maxTemp) maxTemp=height[i];</span><br><span class="line">            res += maxTemp - height[i];</span><br><span class="line">            i++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//å³ä¾§ç§¯æ°´</span></span><br><span class="line">        <span class="type">int</span> j=height.length-<span class="number">1</span>;</span><br><span class="line">        maxTemp=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (j&gt;maxIndex)&#123;</span><br><span class="line">            <span class="keyword">if</span> (height[j]&gt;maxTemp) maxTemp=height[j];</span><br><span class="line">            res += maxTemp - height[j];</span><br><span class="line">            j--;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="æ»‘åŠ¨çª—å£">æ»‘åŠ¨çª—å£</h1><h2 id="2025-07-193-æ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²ä¸­ç­‰">2025-07-19<a href="https://leetcode.cn/problems/longest-substring-without-repeating-characters/">3. æ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²</a><code>ä¸­ç­‰</code></h2><blockquote><p>é¢˜è§£ï¼š</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">lengthOfLongestSubstring</span><span class="params">(String s)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> s.length();</span><br><span class="line">        <span class="keyword">if</span> (s.length() &lt;= <span class="number">1</span>) <span class="keyword">return</span> n;</span><br><span class="line">        <span class="type">char</span>[] occ = <span class="keyword">new</span> <span class="title class_">char</span>[<span class="number">128</span>];</span><br><span class="line">        <span class="type">char</span>[] chars = s.toCharArray();</span><br><span class="line">        <span class="type">int</span> <span class="variable">maxRes</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">left</span> <span class="operator">=</span> <span class="number">0</span>,right=<span class="number">0</span>; right &lt; n; right++) &#123;</span><br><span class="line">            <span class="type">char</span> <span class="variable">c</span> <span class="operator">=</span> chars[right];<span class="comment">//å³ä¾§æ•°æ®</span></span><br><span class="line">            occ[c]++;<span class="comment">//è®°å½•</span></span><br><span class="line">            <span class="comment">//æœ‰é‡å¤çš„ä»å·¦è¾¹å»é™¤</span></span><br><span class="line">            <span class="keyword">while</span> (occ[c]&gt;<span class="number">1</span>)&#123;</span><br><span class="line">                occ[chars[left]]--;</span><br><span class="line">                left++;</span><br><span class="line">            &#125;</span><br><span class="line">            maxRes = Math.max(maxRes, right - left + <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> maxRes;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2025-07-29438-æ‰¾åˆ°å­—ç¬¦ä¸²ä¸­æ‰€æœ‰å­—æ¯å¼‚ä½è¯ä¸­ç­‰">2025-07-29<a href="https://leetcode.cn/problems/find-all-anagrams-in-a-string/">438. æ‰¾åˆ°å­—ç¬¦ä¸²ä¸­æ‰€æœ‰å­—æ¯å¼‚ä½è¯</a><code>ä¸­ç­‰</code></h2><blockquote><p>é¢˜è§£ï¼š</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;Integer&gt; <span class="title function_">findAnagrams</span><span class="params">(String s, String p)</span> &#123;</span><br><span class="line">        List&lt;Integer&gt; res = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="type">int</span> <span class="variable">sLen</span> <span class="operator">=</span> s.length();</span><br><span class="line">        <span class="type">int</span> <span class="variable">pLen</span> <span class="operator">=</span> p.length();</span><br><span class="line">        <span class="keyword">if</span> (sLen &lt; pLen) <span class="keyword">return</span> res;</span><br><span class="line">        <span class="type">int</span>[] pCount = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">26</span>];</span><br><span class="line">        <span class="type">int</span>[] sCount = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">26</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; pLen; i++) pCount[p.charAt(i) - <span class="string">&#x27;a&#x27;</span>]++;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;sLen;i++)&#123;</span><br><span class="line">            sCount[s.charAt(i) - <span class="string">&#x27;a&#x27;</span>]++;</span><br><span class="line">            <span class="comment">//å½“i&gt;=pLençš„æ—¶å€™éœ€è¦æŠŠå·¦ä¾§ç§»é™¤</span></span><br><span class="line">            <span class="keyword">if</span> (i&gt;=pLen) sCount[s.charAt(i-pLen) - <span class="string">&#x27;a&#x27;</span>]--;</span><br><span class="line">            <span class="keyword">if</span> (i&gt;=pLen-<span class="number">1</span>)&#123;</span><br><span class="line">                <span class="keyword">if</span> (Arrays.equals(pCount, sCount))res.add(i-pLen+<span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="å­ä¸²">å­ä¸²</h1><h2 id="2025-07-31560-å’Œä¸º-K-çš„å­æ•°ç»„ä¸­ç­‰">2025-07-31<a href="https://leetcode.cn/problems/subarray-sum-equals-k/">560. å’Œä¸º K çš„å­æ•°ç»„</a><code>ä¸­ç­‰</code></h2><blockquote><p>é¢˜è§£ï¼š</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">subarraySum</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> k)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">c</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">p</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        Map&lt;Integer, Integer&gt; pc = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;((<span class="type">int</span>) (nums.length / <span class="number">0.75</span>) + <span class="number">1</span>);</span><br><span class="line">        pc.put(<span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> num : nums) &#123;</span><br><span class="line">            p += num;</span><br><span class="line">            c += pc.getOrDefault(p - k, <span class="number">0</span>);</span><br><span class="line">            pc.merge(p, <span class="number">1</span>, Integer::sum);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> c;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2025-08-01239-æ»‘åŠ¨çª—å£æœ€å¤§å€¼å›°éš¾">2025-08-01<a href="https://leetcode.cn/problems/sliding-window-maximum/">239. æ»‘åŠ¨çª—å£æœ€å¤§å€¼</a><code>å›°éš¾</code></h2><blockquote><p>tag -â€”â€”<a href="https://leetcode.cn/tag/queue/">é˜Ÿåˆ—</a> <a href="https://leetcode.cn/tag/array/">æ•°ç»„</a> <a href="https://leetcode.cn/tag/sliding-window/">æ»‘åŠ¨ çª—å£ </a><a href="https://leetcode.cn/tag/monotonic-queue/">å•è°ƒé˜Ÿåˆ— </a><a href="https://leetcode.cn/tag/heap-priority-queue/">å †ï¼ˆä¼˜å…ˆé˜Ÿåˆ—ï¼‰</a></p><p>é¢˜è§£ï¼šç”¨æ ˆçš„æ€æƒ³ï¼Œçª—å£ä¸ºkä½,åˆšå¼€å§‹ä¸è¿›whileå¾ªç¯ï¼Œå½“é˜Ÿåˆ—é•¿åº¦å¤§äºkä»¥åè¿›è¡Œæ“ä½œã€‚å°†é˜Ÿåˆ—ä¸­å¦‚æœé å‰çš„æ•°åé¢æœ‰æ¯”å®ƒå¤§çš„å°±å¼¹å‡ºï¼Œå°†æœ€å¤§å€¼æ”¾è¿›res</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="comment">/*è¾“å…¥ï¼šnums = [1,3,-1,-3,5,3,6,7], k = 3</span></span><br><span class="line"><span class="comment">è¾“å‡ºï¼š[3,3,5,5,6,7]*/</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span>[] maxSlidingWindow(<span class="type">int</span>[] nums, <span class="type">int</span> k) &#123;</span><br><span class="line">        <span class="keyword">if</span>(k==<span class="number">1</span> || nums==<span class="literal">null</span>) <span class="keyword">return</span> nums;</span><br><span class="line">        <span class="type">int</span> len=nums.length;</span><br><span class="line">        <span class="type">int</span>[] res = <span class="keyword">new</span> <span class="title class_">int</span>[len-k+<span class="number">1</span>];</span><br><span class="line">        LinkedList&lt;Integer&gt; queue = <span class="keyword">new</span> <span class="title class_">LinkedList</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;len;i++)&#123;</span><br><span class="line">            <span class="comment">// ä¿è¯ä»å¤§åˆ°å° å¦‚æœå‰é¢æ•°å°åˆ™éœ€è¦ä¾æ¬¡å¼¹å‡ºï¼Œç›´è‡³æ»¡è¶³è¦æ±‚</span></span><br><span class="line">            <span class="keyword">while</span>(!queue.isEmpty() &amp;&amp; nums[queue.peekLast()] &lt;= nums[i])&#123;</span><br><span class="line">                queue.pollLast();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// æ·»åŠ å½“å‰å€¼å¯¹åº”çš„æ•°ç»„ä¸‹æ ‡</span></span><br><span class="line">            queue.addLast(i);</span><br><span class="line">            <span class="comment">// åˆ¤æ–­å½“å‰é˜Ÿåˆ—ä¸­é˜Ÿé¦–çš„å€¼æ˜¯å¦æœ‰æ•ˆ</span></span><br><span class="line">            <span class="keyword">if</span>(queue.peek() &lt;= i-k)&#123;</span><br><span class="line">                queue.poll();   </span><br><span class="line">            &#125; </span><br><span class="line">            <span class="comment">// å½“çª—å£é•¿åº¦ä¸ºkæ—¶ ä¿å­˜å½“å‰çª—å£ä¸­æœ€å¤§å€¼</span></span><br><span class="line">            <span class="keyword">if</span>(i+<span class="number">1</span>&gt;=k) res[i-k+<span class="number">1</span>]=nums[queue.peek()];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2025-08-0876-æœ€å°è¦†ç›–å­ä¸²å›°éš¾">2025-08-08<a href="https://leetcode.cn/problems/minimum-window-substring/">76. æœ€å°è¦†ç›–å­ä¸²</a><code>å›°éš¾</code></h2><blockquote><p>tagâ€”â€”<a href="https://leetcode.cn/tag/hash-table/">å“ˆå¸Œè¡¨</a><a href="https://leetcode.cn/tag/string/">å­—ç¬¦ä¸²</a><a href="https://leetcode.cn/tag/sliding-window/">æ»‘åŠ¨çª—å£</a></p><p>é¢˜è§£ï¼šé€šè¿‡distanceæ ‡å¿—ä½ï¼Œå½“å³æŒ‡é’ˆéå†åˆ°å…¨éƒ¨çš„å­ä¸²ï¼Œè¿›å¾ªç¯çœ‹å·¦ä¾§ï¼Œå·¦ä¾§å‡å°‘åˆ°å­ä¸²çš„æŸå€¼ç»Ÿè®¡é•¿åº¦ï¼Œå½“å·¦ä¾§ç­‰äºç›®æ ‡å­ä¸²ä¹‹ä¸€ï¼Œdistanceå‡å°‘ï¼Œå³æŒ‡é’ˆç»§ç»­æ‰¾ï¼Œæ‰¾åˆ°distanceï¼Œå·¦ä¾§å†æ”¶ç¼©</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//76 è¦†ç›–å­ä¸²ï¼ˆæ»‘åŠ¨çª—å£ï¼‰</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">minWindow</span><span class="params">(String s, String t)</span> &#123;</span><br><span class="line">    <span class="comment">// è·å–å­—ç¬¦ä¸²é•¿åº¦</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">sLen</span> <span class="operator">=</span> s.length();</span><br><span class="line">    <span class="type">int</span> <span class="variable">tLen</span> <span class="operator">=</span> t.length();</span><br><span class="line">    <span class="comment">// è¾¹ç•Œæ¡ä»¶åˆ¤æ–­ï¼šå¦‚æœsæ¯”tçŸ­ï¼Œæˆ–è€…ä»»ä¸€ä¸ºç©ºï¼Œåˆ™ä¸å¯èƒ½å­˜åœ¨è¦†ç›–å­ä¸²</span></span><br><span class="line">    <span class="keyword">if</span> (sLen &lt; tLen || sLen == <span class="number">0</span> || tLen == <span class="number">0</span>) <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="type">char</span>[] sCharArray = s.toCharArray();</span><br><span class="line">    <span class="type">char</span>[] tCharArray = t.toCharArray();</span><br><span class="line">    <span class="comment">// winFreq: è®°å½•å½“å‰çª—å£ä¸­å„å­—ç¬¦å‡ºç°çš„æ¬¡æ•°</span></span><br><span class="line">    <span class="comment">// tFreq: è®°å½•å­—ç¬¦ä¸²tä¸­å„å­—ç¬¦å‡ºç°çš„æ¬¡æ•°</span></span><br><span class="line">    <span class="type">int</span>[] winFreq = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">64</span>]; <span class="comment">// çª—å£</span></span><br><span class="line">    <span class="type">int</span>[] tFreq = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">64</span>];   <span class="comment">// ç»Ÿè®¡tä¸­å­—ç¬¦å‡ºç°çš„æ¬¡æ•°å’Œä½ç½®</span></span><br><span class="line">    <span class="comment">// distanceè¡¨ç¤ºå½“å‰çª—å£ä¸­æ»¡è¶³å­—ç¬¦æ•°é‡è¦æ±‚çš„å­—ç¬¦ç§ç±»æ•°</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">distance</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–æœ€å°é•¿åº¦ä¸ºä¸€ä¸ªæ¯”å¯èƒ½æœ€å¤§å€¼æ›´å¤§çš„æ•°</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">minLen</span> <span class="operator">=</span> sLen + <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç»Ÿè®¡å­—ç¬¦ä¸²tä¸­æ¯ä¸ªå­—ç¬¦çš„å‡ºç°æ¬¡æ•°</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">char</span> c : tCharArray) &#123;</span><br><span class="line">        tFreq[c - <span class="string">&#x27;A&#x27;</span>]++; <span class="comment">// é€šè¿‡å­—ç¬¦ä¸&#x27;A&#x27;çš„å·®å€¼ä½œä¸ºç´¢å¼•</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æ»‘åŠ¨çª—å£çš„å·¦å³æŒ‡é’ˆ</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">left</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">right</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// è®°å½•æœ€å°è¦†ç›–å­ä¸²çš„èµ·å§‹ä½ç½®</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">begin</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// s = &quot;ADOBECODEBANC&quot;, t = &quot;ABC&quot;  -&gt; &quot;BANC&quot;</span></span><br><span class="line">    <span class="keyword">while</span> (right &lt; sLen) &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœå½“å‰å­—ç¬¦ä¸åœ¨tä¸­ï¼Œç›´æ¥è·³è¿‡</span></span><br><span class="line">        <span class="keyword">if</span> (tFreq[sCharArray[right] - <span class="string">&#x27;A&#x27;</span>] == <span class="number">0</span>) &#123;</span><br><span class="line">            right++;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å½“çª—å£ä¸­è¯¥å­—ç¬¦çš„æ•°é‡å°äºtä¸­è¯¥å­—ç¬¦çš„æ•°é‡æ—¶ï¼Œè¯´æ˜è¿™ä¸ªå­—ç¬¦æ˜¯éœ€è¦çš„ï¼Œå¢åŠ distance</span></span><br><span class="line">        <span class="keyword">if</span> (winFreq[sCharArray[right] - <span class="string">&#x27;A&#x27;</span>] &lt; tFreq[sCharArray[right] - <span class="string">&#x27;A&#x27;</span>]) &#123;</span><br><span class="line">            distance++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// æ›´æ–°çª—å£ä¸­è¯¥å­—ç¬¦çš„è®¡æ•°</span></span><br><span class="line">        winFreq[sCharArray[right] - <span class="string">&#x27;A&#x27;</span>]++;</span><br><span class="line">        right++;</span><br><span class="line">        <span class="comment">// å½“distanceç­‰äºtçš„é•¿åº¦æ—¶ï¼Œè¯´æ˜å½“å‰çª—å£å·²ç»åŒ…å«äº†tçš„æ‰€æœ‰å­—ç¬¦</span></span><br><span class="line">        <span class="keyword">while</span> (distance == tLen) &#123; <span class="comment">//ADOBEC</span></span><br><span class="line">            <span class="comment">// è®°å½•æœ€çŸ­é•¿åº¦å¹¶è®°å½•å¼€å¤´çš„ä¸‹æ ‡</span></span><br><span class="line">            <span class="keyword">if</span> (right - left &lt; minLen) &#123;</span><br><span class="line">                minLen = right - left;</span><br><span class="line">                begin = left;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// å¦‚æœå·¦è¾¹ç•Œå­—ç¬¦ä¸åœ¨tä¸­ï¼Œç›´æ¥ç§»åŠ¨å·¦æŒ‡é’ˆ</span></span><br><span class="line">            <span class="keyword">if</span> (tFreq[sCharArray[left] - <span class="string">&#x27;A&#x27;</span>] == <span class="number">0</span>) &#123;</span><br><span class="line">                left++;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// å¦‚æœå½“å‰çª—å£ä¸­è¯¥å­—ç¬¦çš„æ•°é‡æ­£å¥½ç­‰äºtä¸­è¯¥å­—ç¬¦çš„æ•°é‡ï¼Œ</span></span><br><span class="line">            <span class="comment">// ç§»é™¤è¯¥å­—ç¬¦åå°†ä¸å†æ»¡è¶³è¦æ±‚ï¼Œéœ€è¦å‡å°‘distance</span></span><br><span class="line">            <span class="keyword">if</span> (winFreq[sCharArray[left] - <span class="string">&#x27;A&#x27;</span>] == tFreq[sCharArray[left] - <span class="string">&#x27;A&#x27;</span>]) &#123;</span><br><span class="line">                distance--;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// æ›´æ–°çª—å£ä¸­è¯¥å­—ç¬¦çš„è®¡æ•°</span></span><br><span class="line">            winFreq[sCharArray[left] - <span class="string">&#x27;A&#x27;</span>]--;</span><br><span class="line">            left++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å¦‚æœminLenæ²¡æœ‰è¢«æ›´æ–°è¿‡ï¼Œè¯´æ˜æ²¡æœ‰æ‰¾åˆ°è¦†ç›–å­ä¸²</span></span><br><span class="line">    <span class="keyword">if</span> (minLen == sLen + <span class="number">1</span>) <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="comment">// è¿”å›æœ€å°è¦†ç›–å­ä¸²</span></span><br><span class="line">    <span class="keyword">return</span> s.substring(begin, begin + minLen);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="æ™®é€šæ•°ç»„">æ™®é€šæ•°ç»„</h1><h1 id="çŸ©é˜µ">çŸ©é˜µ</h1><h1 id="é“¾è¡¨">é“¾è¡¨</h1><h1 id="äºŒå‰æ ‘">äºŒå‰æ ‘</h1><h1 id="å›¾è®º">å›¾è®º</h1><h1 id="å›æº¯">å›æº¯</h1><h1 id="äºŒåˆ†æŸ¥æ‰¾">äºŒåˆ†æŸ¥æ‰¾</h1><h1 id="æ ˆ">æ ˆ</h1><h1 id="å †">å †</h1><h1 id="è´ªå¿ƒç®—æ³•">è´ªå¿ƒç®—æ³•</h1><h1 id="åŠ¨æ€è§„æ ¼">åŠ¨æ€è§„æ ¼</h1><h1 id="å¤šç»´åŠ¨æ€è§„åˆ’">å¤šç»´åŠ¨æ€è§„åˆ’</h1><h1 id="æŠ€å·§">æŠ€å·§</h1>]]></content>
    
    
    <summary type="html">HOT-100ï¼</summary>
    
    
    
    <category term="ç®—æ³•" scheme="https://u7u7.top/categories/%E7%AE%97%E6%B3%95/"/>
    
    
    <category term="Java" scheme="https://u7u7.top/tags/Java/"/>
    
    <category term="é¡¹ç›®" scheme="https://u7u7.top/tags/%E9%A1%B9%E7%9B%AE/"/>
    
    <category term="ç®—æ³•" scheme="https://u7u7.top/tags/%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>çº¿ç¨‹æ± ä½¿ç”¨</title>
    <link href="https://u7u7.top/posts/ThreadPool.html"/>
    <id>https://u7u7.top/posts/ThreadPool.html</id>
    <published>2025-08-01T02:00:25.000Z</published>
    <updated>2025-08-25T01:30:22.814Z</updated>
    
    <content type="html"><![CDATA[<h1 id="çº¿ç¨‹æ± ä¼˜åŒ–ç™¾ä¸‡æ•°æ®æ’å…¥æ•°æ®åº“">çº¿ç¨‹æ± ä¼˜åŒ–ç™¾ä¸‡æ•°æ®æ’å…¥æ•°æ®åº“</h1><p>æ„å»ºUser</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> User <span class="title function_">buildUser</span><span class="params">(<span class="type">int</span> i)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> User.builder()</span><br><span class="line">            .openid(<span class="string">&quot;&quot;</span>+i)</span><br><span class="line">            .name(<span class="string">&quot;user_&quot;</span>+i)</span><br><span class="line">            .sex(<span class="string">&quot;1&quot;</span>)</span><br><span class="line">            .build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€åˆç‰ˆæœ¬å•çº¿ç¨‹æ± </p><p>è€—æ—¶29s</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å•çº¿ç¨‹çº¿ç¨‹æ± </span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">ExecutorService</span> <span class="variable">SECKILL_ORDER_EXECUTOR</span> <span class="operator">=</span> Executors.newSingleThreadExecutor();</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç”¨AtomicIntegerä¿è¯çº¿ç¨‹å®‰å…¨ï¼ˆåŸå­æ“ä½œ+å¯è§æ€§ï¼‰</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="type">AtomicInteger</span> <span class="variable">count</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomicInteger</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">class</span> <span class="title class_">ThreadHandler</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//æŒ‡å®šArrayListåˆå§‹å®¹é‡ï¼ˆ1000ï¼‰ï¼Œå‡å°‘æ‰©å®¹å¼€é”€</span></span><br><span class="line">        List&lt;User&gt; users = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(<span class="number">10000</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">1000000</span>; i++) &#123;</span><br><span class="line">                users.add(buildUser(i));</span><br><span class="line">                count.incrementAndGet(); <span class="comment">// åŸå­è‡ªå¢ï¼Œçº¿ç¨‹å®‰å…¨</span></span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (i % <span class="number">10000</span> == <span class="number">0</span>) &#123;</span><br><span class="line">                    userService.saveBatch(users);</span><br><span class="line">                    users.clear();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// å¤„ç†æœ€åä¸è¶³æ•°æ®</span></span><br><span class="line">            <span class="keyword">if</span> (!users.isEmpty()) &#123;</span><br><span class="line">                userService.saveBatch(users);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="comment">//æ•è·å¼‚å¸¸ï¼Œé¿å…ä»»åŠ¡æ— å£°ä¸­æ–­</span></span><br><span class="line">            System.err.println(<span class="string">&quot;æ’å…¥å¤±è´¥ï¼š&quot;</span> + e.getMessage());</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testInsertBatch</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="type">long</span> <span class="variable">startTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç”¨Futureè·å–ä»»åŠ¡æ‰§è¡Œç»“æœï¼Œé˜»å¡ç­‰å¾…ä»»åŠ¡å®Œæˆ</span></span><br><span class="line">    Future&lt;?&gt; future = SECKILL_ORDER_EXECUTOR.submit(<span class="keyword">new</span> <span class="title class_">ThreadHandler</span>());</span><br><span class="line">    future.get(); <span class="comment">// å…³é”®ï¼šç­‰å¾…å­çº¿ç¨‹ä»»åŠ¡æ‰§è¡Œå®Œæ¯•</span></span><br><span class="line"></span><br><span class="line">    <span class="type">long</span> <span class="variable">endTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ­¤æ—¶countå·²ç¡®ä¿æ˜¯æœ€ç»ˆå€¼ï¼ˆå› ä¸ºfuture.get()å·²ç­‰å¾…ä»»åŠ¡å®Œæˆï¼‰</span></span><br><span class="line">    System.out.println(<span class="string">&quot;æ€»è€—æ—¶ï¼š&quot;</span> + (endTime - startTime) + <span class="string">&quot;msï¼Œæ’å…¥æ€»æ•°ï¼š&quot;</span> + count.get());</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å…³é—­çº¿ç¨‹æ± ï¼Œé¿å…èµ„æºæ³„æ¼</span></span><br><span class="line">    SECKILL_ORDER_EXECUTOR.shutdown();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¼˜åŒ–ï¼šçº¿ç¨‹æ± æ”¹é€ è‡ªå®šä¹‰çº¿ç¨‹æ±  æ€»è€—æ—¶ï¼š11429msï¼Œæ’å…¥æ€»æ•°ï¼š1000000</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¼˜åŒ–1ï¼šè‡ªå®šä¹‰çº¿ç¨‹æ± ï¼ˆIOå¯†é›†å‹ä»»åŠ¡ï¼Œçº¿ç¨‹æ•°=CPUæ ¸å¿ƒæ•°*2ï¼‰</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">CPU_CORES</span> <span class="operator">=</span> Runtime.getRuntime().availableProcessors();</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">ExecutorService</span> <span class="variable">CUSTOM_EXECUTOR</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(</span><br><span class="line">        CPU_CORES,                  <span class="comment">// æ ¸å¿ƒçº¿ç¨‹æ•°ï¼ˆCPUæ ¸å¿ƒæ•°ï¼Œå‡å°‘ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼‰</span></span><br><span class="line">        CPU_CORES * <span class="number">2</span>,              <span class="comment">// æœ€å¤§çº¿ç¨‹æ•°ï¼ˆIOå¯†é›†å‹å¯é€‚å½“å¢åŠ ï¼‰</span></span><br><span class="line">        <span class="number">60L</span>, TimeUnit.SECONDS,      <span class="comment">// ç©ºé—²çº¿ç¨‹å­˜æ´»æ—¶é—´</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">ArrayBlockingQueue</span>&lt;&gt;(<span class="number">100</span>), <span class="comment">// æœ‰ç•Œé˜Ÿåˆ—ï¼ˆé¿å…æ— ç•Œé˜Ÿåˆ—OOMï¼‰</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">ThreadFactory</span>() &#123;       <span class="comment">// è‡ªå®šä¹‰çº¿ç¨‹å·¥å‚ï¼ˆä¾¿äºè°ƒè¯•ï¼‰</span></span><br><span class="line">            <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">AtomicInteger</span> <span class="variable">threadNum</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomicInteger</span>(<span class="number">1</span>);</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> Thread <span class="title function_">newThread</span><span class="params">(Runnable r)</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(r, <span class="string">&quot;batch-insert-thread-&quot;</span> + threadNum.getAndIncrement());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>.CallerRunsPolicy() <span class="comment">// æ‹’ç»ç­–ç•¥ï¼šæäº¤è€…æ‰§è¡Œï¼ˆç¼“è§£å‹åŠ›ï¼‰</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>æ•°æ®åˆ†ç‰‡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç”¨AtomicIntegerä¿è¯çº¿ç¨‹å®‰å…¨ï¼ˆåŸå­æ“ä½œ+å¯è§æ€§ï¼‰</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="type">AtomicInteger</span> <span class="variable">totalCount</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomicInteger</span>(<span class="number">0</span>);</span><br><span class="line"><span class="comment">// æ¯æ‰¹æ’å…¥æ•°é‡ï¼ˆæ ¹æ®æ•°æ®åº“æ€§èƒ½è°ƒæ•´ï¼‰</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">BATCH_SIZE</span> <span class="operator">=</span> <span class="number">5000</span>;</span><br><span class="line"><span class="comment">// æ€»æ•°æ®é‡</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">TOTAL_DATA</span> <span class="operator">=</span> <span class="number">1000000</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ•°æ®åˆ†ç‰‡ä»»åŠ¡</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">InsertTask</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> start;  <span class="comment">// åˆ†ç‰‡èµ·å§‹ç´¢å¼•</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> end;    <span class="comment">// åˆ†ç‰‡ç»“æŸç´¢å¼•</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">InsertTask</span><span class="params">(<span class="type">int</span> start, <span class="type">int</span> end)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.start = start;</span><br><span class="line">        <span class="built_in">this</span>.end = end;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="comment">// äº‹åŠ¡å†…æ‰¹é‡æ’å…¥ï¼ˆå‡å°‘äº‹åŠ¡æäº¤å¼€é”€ï¼‰ åœ¨runæ–¹æ³•å¤–é¢å‡å°‘äº‹åŠ¡æäº¤æ¬¡æ•°</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        List&lt;User&gt; batchList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(BATCH_SIZE); <span class="comment">// é¢„åˆ†é…å®¹é‡</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">localCount</span> <span class="operator">=</span> <span class="number">0</span>; <span class="comment">// çº¿ç¨‹å†…è®¡æ•°ï¼ˆå‡å°‘åŸå­æ“ä½œé¢‘ç‡ï¼‰</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">namePrefix</span> <span class="operator">=</span> <span class="string">&quot;user_&quot;</span>; <span class="comment">// é¢„å®šä¹‰å‰ç¼€ï¼Œå‡å°‘å¯¹è±¡åˆ›å»º</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> start; i &lt; end; i++) &#123;</span><br><span class="line">                <span class="comment">// ç›´æ¥ä½¿ç”¨æ„é€ æ–¹æ³•åˆ›å»ºå¯¹è±¡ï¼Œå‡å°‘setterå¼€é”€</span></span><br><span class="line">                batchList.add(<span class="keyword">new</span> <span class="title class_">User</span>(namePrefix+i));</span><br><span class="line">                localCount++;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// è¾¾åˆ°æ‰¹æ¬¡å¤§å°åˆ™æ’å…¥</span></span><br><span class="line">                <span class="keyword">if</span> (batchList.size() &gt;= BATCH_SIZE) &#123;</span><br><span class="line">                    saveBatch(batchList);</span><br><span class="line">                    batchList.clear();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// å¤„ç†å‰©ä½™æ•°æ®</span></span><br><span class="line">            <span class="keyword">if</span> (!batchList.isEmpty()) &#123;</span><br><span class="line">                saveBatch(batchList);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// æœ€åç»Ÿä¸€æ›´æ–°æ€»è®¡æ•°ï¼ˆå‡å°‘AtomicIntegeræ“ä½œæ¬¡æ•°ï¼‰</span></span><br><span class="line">            totalCount.addAndGet(localCount);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            System.err.println(<span class="string">&quot;çº¿ç¨‹&quot;</span> + Thread.currentThread().getName() + <span class="string">&quot;æ’å…¥å¤±è´¥ï¼š&quot;</span> + e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">saveBatch</span><span class="params">(List&lt;User&gt; users)</span> &#123;</span><br><span class="line">        userService.saveBatch(users, BATCH_SIZE); <span class="comment">// æŒ‡å®šæ‰¹æ¬¡å¤§å°é€‚é…æ¡†æ¶</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testBatchInsertWithCustomPool</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">long</span> <span class="variable">startTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">    List&lt;Future&lt;?&gt;&gt; futures = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¼˜åŒ–2ï¼šæ•°æ®åˆ†ç‰‡ï¼ˆæ¯ä¸ªçº¿ç¨‹å¤„ç†çº¦5-10ä¸‡æ¡ï¼Œå‡å°‘çº¿ç¨‹è°ƒåº¦å¼€é”€ï¼‰</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">perThreadData</span> <span class="operator">=</span> <span class="number">100000</span>; <span class="comment">// æ¯ä¸ªçº¿ç¨‹å¤„ç†10ä¸‡æ¡</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">threadCount</span> <span class="operator">=</span> (<span class="type">int</span>) Math.ceil((<span class="type">double</span>) TOTAL_DATA / perThreadData);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; threadCount; i++) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">start</span> <span class="operator">=</span> i * perThreadData;</span><br><span class="line">        <span class="type">int</span> <span class="variable">end</span> <span class="operator">=</span> Math.min((i + <span class="number">1</span>) * perThreadData, TOTAL_DATA);</span><br><span class="line">        futures.add(CUSTOM_EXECUTOR.submit(<span class="keyword">new</span> <span class="title class_">InsertTask</span>(start, end)));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆ</span></span><br><span class="line">    <span class="keyword">for</span> (Future&lt;?&gt; future : futures) &#123;</span><br><span class="line">        future.get();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å…³é—­çº¿ç¨‹æ± </span></span><br><span class="line">    CUSTOM_EXECUTOR.shutdown();</span><br><span class="line">    <span class="comment">// ç­‰å¾…çº¿ç¨‹æ± å®Œå…¨å…³é—­ï¼ˆæœ€å¤šç­‰1åˆ†é’Ÿï¼‰</span></span><br><span class="line">    CUSTOM_EXECUTOR.awaitTermination(<span class="number">1</span>, TimeUnit.MINUTES);</span><br><span class="line"></span><br><span class="line">    <span class="type">long</span> <span class="variable">endTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">    System.out.println(<span class="string">&quot;æ€»è€—æ—¶ï¼š&quot;</span> + (endTime - startTime) + <span class="string">&quot;msï¼Œæ’å…¥æ€»æ•°ï¼š&quot;</span> + totalCount.get());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŠ å…¥jvmé¢„çƒ­çœ‹çœ‹ æ€»è€—æ—¶ï¼š10142msï¼Œæ’å…¥æ€»æ•°ï¼š1000000</p><p>ä¼˜åŒ–äº†ä¸€ç§’</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// JVMé¢„çƒ­æ–¹æ³•</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">warmUp</span><span class="params">()</span> &#123;</span><br><span class="line">    List&lt;User&gt; warmUpList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(<span class="number">100</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line">        warmUpList.add(<span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;warmup_&quot;</span> + i));</span><br><span class="line">    &#125;</span><br><span class="line">    userService.saveBatch(warmUpList);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ€»ç»“ï¼šä¸€å¼€å§‹å•Šï¼Œç”¨å•çº¿ç¨‹å¤„ç†ç™¾ä¸‡æ¡æ•°æ®ï¼Œæ…¢æ‚ æ‚ åœ°è·‘äº† 29 ç§’ï¼Œçº¯å±æµªè´¹å¤šæ ¸ CPU çš„åŠ›æ°”ã€‚åæ¥æ”¹äº†æ”¹ï¼Œæäº†ä¸ªè‡ªå®šä¹‰çº¿ç¨‹æ± ï¼ŒæŒ‰ CPU æ ¸å¿ƒæ•°åˆ†é…çº¿ç¨‹ï¼ŒæŠŠ 100 ä¸‡æ¡æ•°æ®åˆ‡æˆä¸€å—ä¸€å—çš„ï¼Œè®©å¤šä¸ªçº¿ç¨‹åŒæ—¶å¤„ç†ï¼Œè¿™ä¸€ä¸‹å°±å¿«å¤šäº†ï¼Œç›´æ¥é™åˆ° 11 ç§’å·¦å³ã€‚ä¸­é—´è¿˜ç¢ç£¨äº†äº›ç»†èŠ‚ï¼Œæ¯”å¦‚è®¡æ•°çš„æ—¶å€™ä¸è®©çº¿ç¨‹é¢‘ç¹æŠ¢ç€ç®—ï¼Œè€Œæ˜¯å„è‡ªè®°å®Œæœ€åä¸€èµ·æ±‡æ€»ï¼›åˆ—è¡¨å’Œå­—ç¬¦ä¸²ä¹Ÿæå‰å‡†å¤‡å¥½ï¼Œå°‘æäº›é‡å¤åˆ›å»ºçš„æ´»å„¿ã€‚æ•°æ®åº“é‚£è¾¹ä¹Ÿè°ƒäº†è°ƒï¼Œè®©æ¯ä¸ªçº¿ç¨‹å¤„ç†çš„æ•°æ®éƒ½æ”¾ä¸€ä¸ªäº‹åŠ¡é‡Œæäº¤ï¼Œå°‘è®©æ•°æ®åº“æ¥å›è·‘ IOã€‚æœ€åè¿˜åŠ äº†ä¸ª â€œçƒ­èº«â€ æ­¥éª¤ï¼Œè®©ç³»ç»Ÿå…ˆè·‘ç‚¹æ•°æ®è¿›å…¥çŠ¶æ€ï¼Œè¿™ä¹ˆä¸€æŠ˜è…¾ï¼Œè€—æ—¶å°±å‹åˆ° 10 ç§’äº†ï¼Œæ¯”åŸæ¥å¿«äº†å¿«ä¸¤å€å‘¢ã€‚</p><p>ä¸ºä»€ä¹ˆåªå¿«äº†ä¸¤å€ï¼šå› ä¸ºæ’å…¥æ•°æ®åº“æ˜¯IOæ“ä½œï¼Œåœ¨ç£ç›˜ï¼Œå¤„ç†äº‹åŠ¡ï¼Œç»´æŠ¤ç´¢å¼•ã€‚è¿™äº›æ“ä½œä¸­ï¼Œå¹¶ä¸æ˜¯CPUå•ç‹¬å¹²æ´»ï¼Œæ‰€ä»¥å¼€å¤šä¸ªæ ¸å¿ƒæ•°ï¼Œä¹Ÿåªæ˜¯åŠ å¿«äº†CPUå¤„ç†å·¥ä½œçš„æ•ˆç‡ã€‚</p>]]></content>
    
    
    <summary type="html">å¤„ç†ç™¾ä¸‡æ•°æ®æ’å…¥æ•°æ®åº“</summary>
    
    
    
    <category term="æ‚é¡¹" scheme="https://u7u7.top/categories/%E6%9D%82%E9%A1%B9/"/>
    
    
    <category term="Java" scheme="https://u7u7.top/tags/Java/"/>
    
    <category term="é¡¹ç›®" scheme="https://u7u7.top/tags/%E9%A1%B9%E7%9B%AE/"/>
    
    <category term="JUC" scheme="https://u7u7.top/tags/JUC/"/>
    
    <category term="å¤šçº¿ç¨‹" scheme="https://u7u7.top/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"/>
    
    <category term="è°ƒä¼˜" scheme="https://u7u7.top/tags/%E8%B0%83%E4%BC%98/"/>
    
  </entry>
  
  <entry>
    <title>é¢è¯•é¢˜é›†</title>
    <link href="https://u7u7.top/posts/ms.html"/>
    <id>https://u7u7.top/posts/ms.html</id>
    <published>2025-07-28T04:00:25.000Z</published>
    <updated>2025-08-08T14:07:38.551Z</updated>
    
    <content type="html"><![CDATA[<p>æ¨èçš„å‡ ä¸ªå…«è‚¡æ–‡ç½‘ç«™</p><div class="site-card-group"><a class="site-card" href="https://xiaolincoding.com/"><div class="img"><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/20250728135701.png"/></div><div class="info"><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/20250728141028.png"/><span class="title">å°æ—coding</span><span class="desc">å†…å®¹å°‘</span></div></a><a class="site-card" href="https://javaguide.cn/"><div class="img"><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/20250728141622.png"/></div><div class="info"><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/20250728140855.png"/><span class="title">Javaguide</span><span class="desc">å†…å®¹è¯¦ç»†</span></div></a><a class="site-card" href="https://javabetter.cn/sidebar/sanfene/nixi.html"><div class="img"><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/20250728141704.png"/></div><div class="info"><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/20250728141409.png"/><span class="title">äºŒå“¥</span><span class="desc">åŒ…å«å­¦ä¹ è·¯çº¿</span></div></a><a class="site-card" href="https://zha-ge.cn/"><div class="img"><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/20250728141720.png"/></div><div class="info"><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/20250728141502.png"/><span class="title">æ¸£å“¥</span><span class="desc">æ”¯æŒAI</span></div></a><a class="site-card" href="https://www.mianshiya.com/"><div class="img"><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/20250728142542.png"/></div><div class="info"><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/20250728142648.png"/><span class="title">é¢è¯•é¸­</span><span class="desc">é±¼çš®çš„æ¯”è¾ƒå…¨</span></div></a></div><h1 id="JAVAé¢è¯•">JAVAé¢è¯•</h1><h2 id="NIOå’ŒAIOåŒºåˆ«">NIOå’ŒAIOåŒºåˆ«</h2><h2 id="é¢å‘å¯¹è±¡å’Œé¢å‘è¿‡ç¨‹">é¢å‘å¯¹è±¡å’Œé¢å‘è¿‡ç¨‹</h2><p>é¢å‘è¿‡ç¨‹ç¼–ç¨‹æ˜¯ä»¥è¿‡ç¨‹ä¸ºä¸­å¿ƒçš„ç¼–ç¨‹æ€æƒ³ï¼Œå°†é—®é¢˜æ‹†è§£ä¸ºä¸€ç³»åˆ—çš„è¿‡ç¨‹å’Œæ­¥éª¤æˆ–è€…å‡½æ•°æ¥è§£å†³é—®é¢˜ï¼Œå®ƒçš„ä»£ç é‡ç”¨å¾ˆå·®ï¼Œä½†æ˜¯æ•ˆç‡è¾ƒé«˜ã€‚é¢å‘å¯¹è±¡ç¼–ç¨‹æ˜¯ä»¥å¯¹è±¡ä¸ºä¸­å¿ƒï¼Œé€šè¿‡å°†é—®é¢˜æ‹†è§£ä¸ºå¯¹è±¡çš„è¡Œä¸ºå’Œå±æ€§å’Œæ–¹æ³•ï¼Œé€šè¿‡ä¸åŒå¯¹è±¡çš„äº¤äº’æ¥è§£å†³é—®é¢˜ï¼Œé€‚åˆå¤æ‚å’Œæ¨¡å—åŒ–çš„é—®é¢˜ï¼Œä»£ç é‡ç”¨æ€§é«˜ã€‚</p><h2 id="Streamæµ">Streamæµ</h2><p>å®ƒæ˜¯java8ä»¥åå¼•å…¥çš„æ–°ç‰¹æ€§ï¼Œå®ƒå¯ä»¥å¯¹æ•°æ®æºæ¯”å¦‚é›†åˆ æ•°ç»„ ioè¿›è¡Œä¸€ç³»åˆ—çš„æ“ä½œåºåˆ—ï¼Œåƒä¸€ä¸ªæµæ°´çº¿ä¸€æ ·å°†æ•°æ®æºä¸€æ­¥ä¸€æ­¥çš„æ“ä½œï¼Œå®ƒæ”¯æŒå¹¶è¡Œè®¡ç®—ï¼Œå¤§å¤§æé«˜äº†å¯¹æ•°æ®æºçš„å¤„ç†æ•ˆç‡ã€‚</p><h2 id="finalå…³é”®å­—ä»‹ç»ä¸€ä¸‹">finalå…³é”®å­—ä»‹ç»ä¸€ä¸‹</h2><p>finalä¿®é¥°ç±»çš„è¯ ç±»ä¸èƒ½è¢«ç»§æ‰¿ï¼Œä¿®é¥°æ–¹æ³•ï¼Œæ–¹æ³•ä¸èƒ½è¢«é‡å†™ï¼Œä¿®é¥°å˜é‡ï¼Œå˜é‡åªèƒ½èµ‹å€¼ä¸€æ¬¡ï¼Œä¸€èˆ¬ä¿®é¥°çš„æ—¶å€™å°±èµ‹å€¼äº†ã€‚</p><h2 id="finallyåœ¨try-catch">finallyåœ¨try catch</h2><p>æ“ä½œä¸€äº›éœ€è¦æ‰‹åŠ¨é‡Šæ”¾çš„èµ„æºæ—¶ï¼Œä¿è¯è¿™äº›èµ„æºèƒ½è¢«æ­£ç¡®å…³é—­ã€‚å³ä¾¿åœ¨<code>try</code>å—ä¸­å‘ç”Ÿå¼‚å¸¸ï¼Œæˆ–è€…<code>try</code>å—ä¸­çš„ä»£ç æ‰§è¡Œäº†<code>return</code>è¯­å¥ï¼Œ<code>finally</code>å—ä¸­çš„ä»£ç ä¾ç„¶ä¼šæ‰§è¡Œã€‚</p><h2 id="StringBufferä¸StringBuilder">StringBufferä¸StringBuilder</h2><p>StringBufferï¼šå¯å˜å­—ç¬¦ä¸²ã€æ•ˆç‡ä½ã€çº¿ç¨‹å®‰å…¨ï¼›é€‚åˆå¤šçº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½åŠ äº†synchronized</p><p>StringBuilderï¼šå¯å˜å­—ç¬¦åºåˆ—ã€æ•ˆç‡é«˜ã€çº¿ç¨‹ä¸å®‰å…¨ï¼›é€‚åˆå•çº¿ç¨‹</p><h2 id="å‡ ç§å˜é‡çš„åŒºåˆ«">å‡ ç§å˜é‡çš„åŒºåˆ«</h2><table><thead><tr><th><strong>å˜é‡ç±»å‹</strong></th><th><strong>å®šä¹‰ä½ç½®</strong></th><th><strong>ä½œç”¨åŸŸ</strong></th><th><strong>ç”Ÿå‘½å‘¨æœŸ</strong></th><th><strong>åˆå§‹åŒ–</strong></th><th><strong>å…±äº«æ€§</strong></th></tr></thead><tbody><tr><td>å±€éƒ¨å˜é‡</td><td>æ–¹æ³• / ä»£ç å—å†…éƒ¨</td><td>å£°æ˜å®ƒçš„æ–¹æ³• / ä»£ç å—å†…</td><td>æ–¹æ³• / ä»£ç å—æ‰§è¡ŒæœŸé—´</td><td>å¿…é¡»æ‰‹åŠ¨åˆå§‹åŒ–</td><td>ä¸å…±äº«</td></tr><tr><td>å…¨å±€å˜é‡</td><td>ç±»å¤–éƒ¨ï¼ˆJava é€šè¿‡<code>static</code>æ¨¡æ‹Ÿï¼‰</td><td>æ•´ä¸ªç¨‹åº</td><td>ç¨‹åºè¿è¡ŒæœŸé—´</td><td>å¿…é¡»æ‰‹åŠ¨åˆå§‹åŒ–</td><td>æ‰€æœ‰ç±»å…±äº«</td></tr><tr><td>æˆå‘˜å˜é‡</td><td>ç±»å†…éƒ¨ï¼Œæ— <code>static</code></td><td>æ•´ä¸ªç±»å†…éƒ¨</td><td>å¯¹è±¡åˆ›å»ºåˆ°é”€æ¯</td><td>å¯é»˜è®¤åˆå§‹åŒ–</td><td>æ¯ä¸ªå¯¹è±¡ç‹¬ç«‹å‰¯æœ¬</td></tr><tr><td>é™æ€æˆå‘˜å˜é‡</td><td>ç±»å†…éƒ¨ï¼Œæœ‰<code>static</code></td><td>æ•´ä¸ªç±»å†…éƒ¨</td><td>ç±»åŠ è½½åˆ°å¸è½½</td><td>å¯é»˜è®¤åˆå§‹åŒ–</td><td>æ‰€æœ‰å¯¹è±¡å…±äº«</td></tr></tbody></table><h2 id="çº¿ç¨‹æ± é‡Œé¢éœ€è¦é…ç½®å“ªäº›ä¸»è¦å‚æ•°">çº¿ç¨‹æ± é‡Œé¢éœ€è¦é…ç½®å“ªäº›ä¸»è¦å‚æ•°</h2><p>çº¿ç¨‹æ± ï¼ˆ<code>ThreadPoolExecutor</code>ï¼‰çš„ä¸»è¦é…ç½®å‚æ•°ï¼Œæœ‰æ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œæœ€å¤§çº¿ç¨‹æ•°ï¼Œçº¿ç¨‹ç©ºé—²æ—¶é—´ï¼Œæ—¶é—´å•ä½ï¼Œä»»åŠ¡é˜Ÿåˆ—ï¼Œçº¿ç¨‹å·¥ç¨‹å’Œæ‹’ç»ç­–ç•¥ã€‚çº¿ç¨‹åˆ›å»ºçš„è¿‡ç¨‹é¦–å…ˆæ˜¯æäº¤ä»»åŠ¡ï¼Œè°ƒç”¨çº¿ç¨‹æ± çš„æ—¶å€™ä¼šåˆ¤æ–­å½“å‰ä»»åŠ¡çš„çº¿ç¨‹æ•°æ˜¯å¦å°äºæ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œå¦‚æœå°äºï¼Œå°±åˆ›å»ºæ ¸å¿ƒçº¿ç¨‹ï¼Œå½“è¿è¡Œçš„çº¿ç¨‹æ•°ç­‰äºæ ¸å¿ƒçº¿ç¨‹æ•°çš„æ—¶å€™ï¼Œå°†ä»»åŠ¡æ”¾å…¥ä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼Œå¦‚æœè¿˜æœ‰æ–°çš„ä»»åŠ¡æ¥ï¼Œä»»åŠ¡é˜Ÿåˆ—æ»¡äº†ï¼Œå¹¶ä¸”å½“å‰æ ¸å¿ƒçº¿ç¨‹æ•°å°äºæœ€å¤§çº¿ç¨‹æ•°ï¼Œä¼šåˆ›å»ºéæ ¸å¿ƒçº¿ç¨‹æ•°ã€‚å¦‚æœè¾¾åˆ°æœ€å¤§çº¿ç¨‹æ•°å¹¶ä¸”ä»»åŠ¡é˜Ÿåˆ—å·²æ»¡ï¼Œä¼šæ‰§è¡Œä½ è®¾ç½®çš„æ‹’ç»ç­–ç•¥ï¼Œæœ€åä»»åŠ¡æ‰§è¡Œå®Œäº†ï¼Œä¼šé”€æ¯çº¿ç¨‹ã€‚</p><h2 id="åˆ›å»ºçº¿ç¨‹"><strong>åˆ›å»ºçº¿ç¨‹</strong></h2><p>çº¿ç¨‹çš„åˆ›å»ºåº•å±‚å…¶å®éƒ½æ˜¯é€šè¿‡Threadç±»å»å®ç°ï¼Œä»–æœ‰ä¸¤ä¸ªæ ¸å¿ƒæ–¹æ³•ï¼Œä¸€ä¸ªstartæ–¹æ³•ï¼Œä¸€ä¸ªrunæ–¹æ³•ï¼Œstartæ–¹æ³•æ˜¯å¯åŠ¨çº¿ç¨‹ï¼Œæ­¤æ—¶çº¿ç¨‹ä¼šç­‰å¾…cpuè°ƒåº¦èµ„æºï¼Œå½“çº¿ç¨‹è¢«è°ƒåº¦ä»¥åä¼šå›è°ƒåˆ°çº¿ç¨‹ï¼Œç„¶åå†æ‰§è¡Œrunæ–¹æ³•ï¼Œå¯¹ä»»åŠ¡é€»è¾‘è¿›ä¸€ä¸ªæ‰§è¡Œã€‚æ‰€ä»¥å¯åŠ¨çº¿ç¨‹çš„æ–¹å¼åªæœ‰threadçš„startæ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹å‡ ç§æ–¹å¼å†™æˆ‘ä»¬çš„ä»»åŠ¡é€»è¾‘ï¼Œåœ¨javaä¸­æˆ‘ä»¬å¯ä»¥é€šè¿‡ç»§æ‰¿threadç±»ï¼Œå¹¶ä¸”é‡å†™runæ–¹æ³•ï¼Œå†™æˆ‘ä»¬çš„ä»»åŠ¡é€»è¾‘æ‰§è¡Œä»»åŠ¡ã€‚è¿˜æœ‰é€šè¿‡å®ç°runnableæ¥å£çš„runæ–¹æ³•ï¼Œä¼šé€šè¿‡threadçš„æ„é€ å‡½æ•°ï¼Œä¼ å…¥è¿›å»ã€‚ä¹Ÿå¯ä»¥å»ç»“åˆfutureTaskå’Œcallable(æœ‰è¿”å›å€¼)æ¥å£ï¼Œå®ç°å¼‚æ­¥ä»»åŠ¡çš„æ‰§è¡Œã€‚</p><h2 id="çº¿ç¨‹æ± å¦‚æœå®ç°å¤ç”¨">çº¿ç¨‹æ± å¦‚æœå®ç°å¤ç”¨</h2><p>çº¿ç¨‹æ± çš„å¤ç”¨ä¹Ÿæ˜¯çº¿ç¨‹æ± çš„æ ¸å¿ƒæ€æƒ³ï¼Œå®ƒå¹¶ä¸æ˜¯çº¿ç¨‹ä½¿ç”¨å®Œä»¥åå†æ‹¿å›æ¥ï¼Œå®ƒçš„å®ç°æ˜¯é€šè¿‡çº¿ç¨‹æ± é‡Œé¢ç»´æŠ¤çš„é˜»å¡é˜Ÿåˆ—å®ç°çš„ï¼Œå½“çº¿ç¨‹æ‰§è¡Œå®Œä¸€ä¸ªä»»åŠ¡ä»¥åï¼Œä¸ä¼šç«‹åˆ»ç»“æŸï¼Œè€Œæ˜¯é€šè¿‡è‡ªæ—‹çš„æ–¹å¼ï¼Œå®ƒä¼šä»é˜»å¡é˜Ÿåˆ—è°ƒç”¨takeæˆ–è€…pollæ–¹æ³•ï¼Œè·å–æ–°çš„ä»»åŠ¡ã€‚å¦‚æœé˜Ÿåˆ—ä¸­æœ‰ä»»åŠ¡ï¼Œé‚£çº¿ç¨‹å°±æ‰§è¡Œæ–°çš„ä»»åŠ¡ï¼Œå¦‚æœé˜Ÿåˆ—ä¸­ä»»åŠ¡ä¸ºç©ºï¼Œé‚£å°±è¦åˆ†å‡ ç§æƒ…å†µï¼Œæ ¹æ®æ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œæœ€å¤§çº¿ç¨‹æ•°ï¼Œè¶…æ—¶æ—¶é—´ï¼Œæ˜¯å¦å…è®¸å›æ”¶ã€‚æ¯”å¦‚å½“å‰çº¿ç¨‹æ•°æ²¡æœ‰è¾¾åˆ°æ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œé‚£å®ƒä¼šè¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œç­‰å¾…é˜»å¡é˜Ÿåˆ—æ¥æ–°çš„ä»»åŠ¡ï¼Œå¦‚æœè¶…è¿‡æ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œå¹¶ä¸”å…è®¸å›æ”¶ï¼Œå¹¶ä¸”æ²¡ä»»åŠ¡äº†ï¼Œå°±ä¼šå›æ”¶ï¼Œè¿™æ ·çš„é€»è¾‘å®ç°çº¿ç¨‹çš„å¤ç”¨ã€‚</p><h2 id="çº¿ç¨‹æ± ä¸ºä»€ä¹ˆä¸èƒ½ä½¿ç”¨æ— ç•Œé˜Ÿåˆ—">çº¿ç¨‹æ± ä¸ºä»€ä¹ˆä¸èƒ½ä½¿ç”¨æ— ç•Œé˜Ÿåˆ—</h2><h2 id="é˜»å¡é˜Ÿåˆ—ä»€ä¹ˆæƒ…å†µä¼šé˜»å¡">é˜»å¡é˜Ÿåˆ—ä»€ä¹ˆæƒ…å†µä¼šé˜»å¡</h2><p>ä¸€èˆ¬ç”¨äºå¤šçº¿ç¨‹ä¹‹é—´å®ç°çº¿ç¨‹å®‰å…¨é€šè®¯å’Œåè°ƒ</p><ul><li>é˜»å¡æ“ä½œ<ul><li>å½“é˜Ÿåˆ—å·²æ»¡æ—¶ï¼Œå‘é˜Ÿåˆ—ä¸­æ·»åŠ å…ƒç´ çš„æ“ä½œï¼ˆå¦‚<code>put</code>ï¼‰ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°é˜Ÿåˆ—æœ‰ç©ºé—²ä½ç½®ã€‚</li><li>å½“é˜Ÿåˆ—ä¸ºç©ºæ—¶ï¼Œä»é˜Ÿåˆ—ä¸­è·å–å…ƒç´ çš„æ“ä½œï¼ˆå¦‚<code>take</code>ï¼‰ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°é˜Ÿåˆ—ä¸­æœ‰å…ƒç´ å¯ç”¨ã€‚</li></ul></li><li><strong>çº¿ç¨‹å®‰å…¨</strong>ï¼šå†…éƒ¨å®ç°äº†é”æœºåˆ¶ï¼ˆå¦‚<code>ReentrantLock</code>ï¼‰ï¼Œç¡®ä¿å¤šçº¿ç¨‹ç¯å¢ƒä¸‹æ“ä½œçš„å®‰å…¨æ€§ã€‚</li></ul><h2 id="çº¿ç¨‹çš„çŠ¶æ€">çº¿ç¨‹çš„çŠ¶æ€</h2><p>åœ¨JAVAä¸­å°è£…äº†çº¿ç¨‹çš„å…­ç§çŠ¶æ€ï¼Œç¬¬ä¸€ç§æ˜¯newï¼Œå½“å‰çº¿ç¨‹è¢«åˆ›å»ºäº†ï¼Œä½†æ˜¯æ²¡æœ‰æ‰§è¡Œstartæ–¹æ³•ï¼Œç¬¬äºŒä¸ªå°±æ˜¯runnableï¼Œæ­¤æ—¶çº¿ç¨‹å·²ç»æ‰§è¡Œäº†æˆ–è€…ç­‰å¾…æ‰§è¡Œï¼Œæ­¤æ—¶CPUä¼šè°ƒåº¦èµ„æºåˆ†é…ä»»åŠ¡ç»™è¯¥çº¿ç¨‹ï¼Œç¬¬ä¸‰ä¸ªæ˜¯blockedï¼Œçº¿ç¨‹ä¸­æœ‰æŸä¸ªçº¿ç¨‹æ‹¿åˆ°äº†é”ï¼Œå…¶ä»–çº¿ç¨‹ä¼šè¿›å»blockedé˜»å¡çŠ¶æ€ï¼Œç­‰å¾…é”é‡Šæ”¾ï¼Œç¬¬å››ä¸ªæ˜¯waitingï¼Œçº¿ç¨‹ç­‰å¾…å…¶ä»–çº¿ç¨‹æ‰§è¡Œå®Œï¼Œè¿™é‡Œæˆ‘ä»¬ä¸€èˆ¬æ˜¯æ‰‹åŠ¨çš„å»waitæˆ–è€…parkï¼Œç¬¬äº”ä¸ªæ˜¯ç°åœ¨wait parkåŠ æ—¶é—´å‚æ•°ï¼Œçº¿ç¨‹ä¼šè¿›å…¥Time waitingçŠ¶æ€ï¼ŒsleepåŒæ ·ä¼šè¿›å»è¯¥çŠ¶æ€ã€‚æœ€åä¸€ä¸ªå°±æ˜¯ç»ˆæ­¢çŠ¶æ€ï¼Œæ‰§è¡Œå®Œrunæ–¹æ³•ä»¥åè¿›å…¥ç»ˆæ­¢çŠ¶æ€ã€‚</p><h2 id="waitå’ŒblockedåŒºåˆ«">waitå’ŒblockedåŒºåˆ«</h2><p>waitå’Œblockedè§¦å‘æ¡ä»¶ä¸ä¸€æ ·ï¼Œé¦–å…ˆwaitæ˜¯ç”¨æˆ·é€šè¿‡waitæˆ–è€…parkæ‰‹åŠ¨ä¸»åŠ¨å»è§¦å‘ï¼Œç„¶åéœ€è¦é€šè¿‡notifyè¿›è¡Œä¸€ä¸ªæ‰‹åŠ¨å”¤é†’ã€‚ä½†æ˜¯blockedæ˜¯è¢«åŠ¨å»è§¦å‘ï¼Œå®ƒæ˜¯å½“é‡åˆ°å…¶ä»–çº¿ç¨‹æ‹¿åˆ°é”ä»¥åï¼Œè¯¥çº¿ç¨‹ä¼šè¿›å…¥é˜»å¡çŠ¶æ€ï¼Œç›´åˆ°çº¿ç¨‹æ‹¿åˆ°é”ä»¥ååœ¨ä¼šå»æ‰§è¡Œä»»åŠ¡ã€‚waitåœ¨æ‰§è¡Œçš„æ—¶å€™ä¼šä¸»åŠ¨çš„å»é‡Šæ”¾é”ï¼Œè€Œblockedæ˜¯è¦æ‹¿åˆ°ç›‘è§†å™¨é”ä»¥åç­‰å¾…æ‰§è¡Œå®Œå†å»é‡Šæ”¾é”ã€‚</p><h2 id="ThreadLocal">ThreadLocal</h2><p>threadlocalæ˜¯å•çº¿ç¨‹çš„å‰¯æœ¬å˜é‡ï¼Œå®ƒæ˜¯å±äºå½“å‰çº¿ç¨‹çš„ï¼Œçº¿ç¨‹ä¹‹é—´äº’ç›¸ä¸å½±å“ï¼Œä¿è¯äº†çº¿ç¨‹å˜é‡çš„å®‰å…¨ã€‚å®ƒçš„ç»“æ„æ˜¯åœ¨threadé‡Œé¢æœ‰ä¸€ä¸ªthreadlocalmapæ˜¯kvçš„é›†åˆï¼Œå½“æˆ‘ç»™threadlocal setçš„æ—¶å€™ä¼šå°†å½“å‰çº¿ç¨‹threadlocalå¯¹è±¡å½“key  å€¼ä¸ºvalueã€‚getä¹Ÿæ˜¯ä¸€æ ·ï¼Œé€šè¿‡å½“å‰threadlocalåœ¨threadlocalmapä¸­è·å–valueã€‚å­˜åœ¨ä¸€ä¸ªå†…å­˜æ³„éœ²é—®é¢˜ threadlocalå’Œthreadå¼•ç”¨åœ¨æ ˆä¸­ï¼Œå¯¹è±¡åœ¨å †ä¸­ï¼Œäº§ç”Ÿå…³é”®ï¼Œthreadé‡Œé¢è¿˜æœ‰ä¸€ä¸ªthreadlocalmapï¼Œä»–ä¹Ÿæ˜¯åœ¨å †ä¸­ï¼Œå¹¶ä¸”å’Œthreadå…³è”ï¼ŒåŒæ—¶å®ƒçš„keyæ˜¯å¼±å¼•ç”¨ï¼Œå¹¶ä¸”å’Œthreadlocalå¯¹è±¡å…³è”ï¼Œè¿™æ ·åœ¨åƒåœ¾å›æ”¶çš„æ—¶å€™ï¼Œå°±å›æ”¶åªæœ‰å¼±å¼•ç”¨å…³è”çš„threadlocalï¼Œåˆå› ä¸ºvalueæ˜¯å¼ºå¼•ç”¨ï¼Œthreadå­˜åœ¨valueå°±å­˜åœ¨ã€‚ä¸é”€æ¯å°±ä¸€ç›´å­˜åœ¨ï¼Œæ‰€ä»¥mapä¼šæœ‰ä¸€ä¸ªkeyä¸ºnullï¼Œvalueå­˜åœ¨çš„æƒ…å†µï¼Œåœ¨çº¿ç¨‹æ± çš„æƒ…å†µä¸‹ï¼Œçº¿ç¨‹åˆä¸ä¼šé”€æ¯ï¼Œè€Œæ˜¯ä¸€ç›´å¤ç”¨ï¼Œé‚£å°±ä¼šå¯¼è‡´ä¸€ç›´æ·»åŠ ç©ºkeyåˆæœ‰valueå¯¼è‡´å†…å­˜æº¢å‡ºã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨æ¯æ¬¡å›æ”¶çš„æ—¶å€™æ‰‹åŠ¨removeå°†å¼ºå¼•ç”¨çš„valueåˆ é™¤ã€‚</p><h2 id="synchronizedå’ŒReentrantLocké”">synchronizedå’ŒReentrantLocké”</h2><p>synchronizedæ˜¯javaä¸­çš„ä¸€ä¸ªå…³é”®å­—ï¼Œè€ŒReentrantLockæ˜¯jdkæä¾›çš„ä¸€ä¸ªç±»ï¼Œsynchronizedæ˜¯jvmå±‚é¢çš„ï¼Œå®ƒæ˜¯éå…¬å¹³é”ï¼Œåº•å±‚åƒæ‚²è§‚é”ï¼Œè‡ªåŠ¨åŠ é”å’Œè‡ªåŠ¨é‡Šæ”¾ã€‚è€ŒReentrantLockæ˜¯apiå±‚é¢çš„é”ï¼Œå®ƒå¯ä»¥å®ç°éå…¬å¹³é”å’Œå…¬å¹³é”ï¼Œåº•å±‚åƒä¹è§‚é”ï¼ŒåŠ é”é‡Šæ”¾é”éœ€è¦é€šè¿‡lock å’Œ unlockã€‚</p><h2 id="CAS-æ‚²è§‚é”å’Œä¹è§‚é”">CAS æ‚²è§‚é”å’Œä¹è§‚é”</h2><p>CASæ˜¯æ¯”è¾ƒå’Œäº¤æ¢ï¼Œå®ƒçš„ä½œç”¨å°±æ˜¯å½“å‡ ä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œä¸€ä¸ªä»»åŠ¡çš„æ—¶å€™ï¼Œçº¿ç¨‹ä¼šæœ‰ä¸€ä¸ªold value å’Œ ä¸€ä¸ªnew valueï¼Œå®ƒå¯ä»¥æ¯”è¾ƒä»»åŠ¡çš„çŠ¶æ€å€¼ï¼Œä¸€èˆ¬çŠ¶æ€å€¼ä¼šæœ‰0,1ä¸¤ä¸ªçŠ¶æ€ï¼Œçº¿ç¨‹ä¹Ÿä¼šæœ‰0å’Œ1ä¸¤ä¸ªçŠ¶æ€å€¼ï¼Œå¦‚æœæŸä¸ªçº¿ç¨‹æ‰§è¡Œä»»åŠ¡çš„æ—¶å€™ï¼Œå‘ç°ä»»åŠ¡çš„çŠ¶æ€å€¼å’Œè‡ªå·±old valueä¸€æ ·ï¼Œå°±ä¼šæŠŠä»»åŠ¡çš„çŠ¶æ€å€¼æ”¹æˆnew valueï¼Œè¿™æ ·å…¶ä»–çº¿ç¨‹æ¥çš„æ—¶å€™å‘ç°ä»»åŠ¡çš„çŠ¶æ€å€¼å’Œè‡ªå·±çš„oldvalueä¸ä¸€æ ·ï¼Œå°±è¿›å…¥è‡ªæ—‹ï¼Œé‡å¤casæ“ä½œï¼Œç›´åˆ°ä»»åŠ¡çŠ¶æ€å’Œè‡ªå·±çš„oldvalueä¸€æ ·ã€‚é‚£æ‚²è§‚é”å°±æ˜¯çº¿ç¨‹æ‚²è§‚çš„è®¤ä¸ºçº¿ç¨‹ä¸€å®šä¼šå‘ç”Ÿå†²çªï¼Œå°±ä¼šæå‰åŠ é”é˜²æ­¢å…¶ä»–çº¿ç¨‹åŒæ—¶å¹¶å‘æ“ä½œã€‚è€Œä¹è§‚é”å°±æ˜¯ä¹è§‚çš„è®¤ä¸ºçº¿ç¨‹ä¸ä¼šå‡ºç°å†²çªï¼Œå®ƒå°±ä¼šè¿›è¡Œä¸€ä¸ªæ£€æŸ¥ï¼Œæ£€æŸ¥èµ„æºæ˜¯å¦è¢«ä¿®æ”¹äº†ï¼Œè‹¥æœªè¢«ä¿®æ”¹åˆ™æˆåŠŸæäº¤ï¼Œå¦åˆ™é‡è¯•æˆ–æ”¾å¼ƒã€‚</p><h2 id="é¥¿æ±‰å¼å’Œæ‡’æ±‰å¼">é¥¿æ±‰å¼å’Œæ‡’æ±‰å¼</h2><p>éƒ½æ˜¯å•ä¾‹è®¾è®¡æ¨¡å¼ï¼Œé¥¿æ±‰å¼å°±æ˜¯åœ¨ç±»åŠ è½½çš„æ—¶å€™å°±ä¼šè¿«ä¸åŠå¾…çš„åˆ›å»ºå®ä¾‹å¯¹è±¡ï¼Œæ‡’æ±‰å¼æ˜¯å½“ç±»è¢«åŠ è½½çš„æ—¶å€™å¹¶ä¸ä¼šå®ä¾‹åŒ–å¯¹è±¡ï¼Œè€Œæ˜¯åœ¨ç¬¬ä¸€æ¬¡æ‰§è¡Œgetinstanceæ–¹æ³•ä¸­å®ä¾‹åŒ–å¯¹è±¡ï¼Œä¸€èˆ¬ä¼šåœ¨æ–¹æ³•ä¸­åŠ é”ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚é¥¿æ±‰å¼çš„åŠ è½½æ¨¡å¼å®ç°ç®€å•ï¼Œå› ä¸ºæ˜¯jvmä¿è¯å¤©ç„¶çº¿ç¨‹å®‰å…¨ï¼Œä½†æ˜¯ä¼šæµªè´¹èµ„æºçš„å ç”¨ï¼Œå› ä¸ºæœ‰æ—¶å€™å®ä¾‹æ²¡æœ‰è¢«ä½¿ç”¨å°±ä¼šèµ„æºæµªè´¹ï¼Œè€Œæ‡’æ±‰å¼å®ç°ç›¸å¯¹å¤æ‚ï¼Œç¬¬ä¸€æ¬¡è·å–å®ä¾‹çš„é€Ÿåº¦æ¯”è¾ƒæ…¢ï¼Œä½†æ˜¯èŠ‚çº¦å†…å­˜å› ä¸ºæ˜¯æŒ‰éœ€åˆ›å»ºçš„ã€‚</p><p>åœ¨ <code>nginx.conf</code> æˆ– <code>sites-available</code> ç›®å½•ä¸‹åˆ›å»ºé…ç½®æ–‡ä»¶ï¼Œç¤ºä¾‹ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>;              <span class="comment"># ç›‘å¬ç«¯å£</span></span><br><span class="line">    <span class="attribute">server_name</span> example.com;  <span class="comment"># åŸŸåæˆ–IP</span></span><br><span class="line"></span><br><span class="line">    <span class="section">location</span> / &#123;</span><br><span class="line">        <span class="attribute">proxy_pass</span> http://backend_server;  <span class="comment"># åç«¯æœåŠ¡å™¨åœ°å€</span></span><br><span class="line">        <span class="attribute">proxy_set_header</span> Host <span class="variable">$host</span>;       <span class="comment"># ä¼ é€’åŸå§‹è¯·æ±‚å¤´</span></span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Real-IP <span class="variable">$remote_addr</span>;  <span class="comment"># ä¼ é€’çœŸå®IP</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…³é”®é…ç½®å‚æ•°è¯´æ˜</p><ul><li><strong>proxy_pass</strong>ï¼šåç«¯æœåŠ¡å™¨åœ°å€ï¼ˆæ”¯æŒ HTTP/HTTPSï¼‰</li><li>proxy_set_headerï¼šä¼ é€’å®¢æˆ·ç«¯è¯·æ±‚å¤´ä¿¡æ¯<ul><li><code>Host</code>ï¼šä¿ç•™åŸå§‹è¯·æ±‚çš„åŸŸå</li><li><code>X-Real-IP</code>ï¼šä¼ é€’å®¢æˆ·ç«¯çœŸå® IP</li><li><code>X-Forwarded-For</code>ï¼šè®°å½•å®Œæ•´ä»£ç†é“¾ IP</li><li><code>X-Forwarded-Proto</code>ï¼šä¼ é€’è¯·æ±‚åè®®ï¼ˆHTTP/HTTPSï¼‰</li></ul></li></ul><h2 id="ç®€è¿°ä¸€ä¸‹JAVAä¸‰å¤§ç‰¹æ€§">ç®€è¿°ä¸€ä¸‹JAVAä¸‰å¤§ç‰¹æ€§</h2><p>Java çš„ä¸‰å¤§ç‰¹æ€§ï¼š</p><ol><li><strong>å°è£…</strong>ï¼šå°†æ•°æ®å’Œæ“ä½œæ•°æ®çš„æ–¹æ³•ç»‘å®šåœ¨ä¸€èµ·ï¼Œéšè—å†…éƒ¨å®ç°ç»†èŠ‚ï¼Œé€šè¿‡å…¬å…±æ¥å£è®¿é—®ã€‚</li><li><strong>ç»§æ‰¿</strong>ï¼šå­ç±»ç»§æ‰¿çˆ¶ç±»çš„å±æ€§å’Œæ–¹æ³•ï¼Œå®ç°ä»£ç å¤ç”¨å’Œæ‰©å±•ã€‚</li><li><strong>å¤šæ€</strong>ï¼šåŒä¸€æ–¹æ³•å¯ä»¥æ ¹æ®å¯¹è±¡ç±»å‹çš„ä¸åŒè¡¨ç°å‡ºä¸åŒçš„è¡Œä¸ºï¼Œé€šè¿‡ç»§æ‰¿å’Œæ¥å£å®ç°ã€‚</li></ol><h2 id="é›†åˆ">é›†åˆ</h2><p>Java é›†åˆä¸»è¦åˆ†ä¸ºä¸¤å¤§æ¥å£ï¼š</p><ol><li><strong>Collection</strong>ï¼šå­˜å‚¨å•ä¸ªå…ƒç´ çš„é›†åˆã€‚<ul><li><strong>List</strong>ï¼šæœ‰åºå¯é‡å¤ï¼Œå¦‚<code>ArrayList</code>ã€<code>LinkedList</code>ã€‚</li><li><strong>Set</strong>ï¼šæ— åºä¸å¯é‡å¤ï¼Œå¦‚<code>HashSet</code>ã€<code>TreeSet</code>ã€‚</li><li><strong>Queue</strong>ï¼šé˜Ÿåˆ—ï¼Œå¦‚<code>LinkedList</code>ã€<code>PriorityQueue</code>ã€‚</li></ul></li><li><strong>Map</strong>ï¼šå­˜å‚¨é”®å€¼å¯¹çš„é›†åˆï¼Œå¦‚<code>HashMap</code>ã€<code>TreeMap</code>ã€<code>ConcurrentHashMap</code>ã€‚</li></ol><h2 id="linkedlistå’Œ-ArrayList-çš„å¯¹æ¯”">linkedlistå’Œ <strong>ArrayList çš„å¯¹æ¯”</strong></h2><p>linkedliståº•å±‚æ˜¯åŒå‘é“¾è¡¨å­˜å‚¨çš„éè¿ç»­å†…å­˜ï¼Œè€Œarraylistæ˜¯åŠ¨æ€æ•°ç»„ï¼Œå®ƒæ˜¯è¿ç»­å†…å­˜å­˜å‚¨çš„ã€‚é‚£ä»–ä»¬çš„æ‰©å®¹æœºåˆ¶ä¹Ÿæ˜¯ä¸ä¸€æ ·çš„è¿™ä¹Ÿå’Œä»–ä»¬åº•å±‚å®ç°æ˜¯æœ‰å…³ç³»ï¼Œarrayliståº•å±‚æ˜¯åŠ¨æ€æ•°ç»„ï¼Œæ‰€ä»¥å®¹é‡ä¸è¶³çš„æ—¶å€™ï¼Œä¼šåˆ›å»ºæ–°æ•°ç»„ï¼Œå†æŠŠå…ƒç´ å¤åˆ¶ï¼Œé‚£ä¸€èˆ¬æ–°æ•°ç»„é•¿åº¦æ˜¯åŸæ¥çš„1.5å€ï¼Œé‚£linkedlistå› ä¸ºæ˜¯é“¾è¡¨çš„å…³ç³»ï¼Œå®ƒåœ¨æ’å…¥æ—¶å€™æ˜¯åŠ¨æ€åˆ›å»ºæ–°èŠ‚ç‚¹ã€‚ä»–ä»¬çš„å…±åŒç‚¹å°±æ˜¯çº¿ç¨‹éƒ½ä¸æ˜¯å¾ˆå®‰å…¨ï¼Œéœ€è¦synchronizedListåŒ…è£…ã€‚æˆ–è€…ç”¨copyonwirtearraylistã€‚é€‰æ‹©çš„è¯çœ‹æ’å…¥æ•°æ®çš„æ—¶å€™ï¼Œå¦‚æœæ˜¯åœ¨å°¾ç«¯æˆ–è€…ç»å¸¸éœ€è¦ç´¢å¼•å€¼æŸ¥å…ƒç´ ï¼Œè¿™ä¸ªæ—¶å€™é€‰ç”¨arraylistï¼Œå¦‚æœéœ€è¦å…ƒç´ æ”¾å¤´éƒ¨æˆ–è€…ä¸­é—´ï¼Œå¹¶ä¸”æ’å…¥æ“ä½œæ¯”è¾ƒå¤šï¼Œå°±é€‰æ‹©linkedlistã€‚</p><h2 id="hashMapåº•å±‚å®ç°">hashMapåº•å±‚å®ç°</h2><p>hashmapåº•å±‚åˆ†java8ä¹‹å‰å’Œä¹‹åï¼Œå› ä¸ºåœ¨8çš„æ—¶å€™å¯¹å®ƒè¿›è¡Œäº†ä¸€ä¸ªä¼˜åŒ–ï¼Œåœ¨8ä¹‹å‰æ˜¯é‡‡ç”¨ä¸€ä¸ªé“¾è¡¨+æ•°ç»„çš„æ–¹å¼å»å­˜å‚¨æ•°æ®ï¼Œé‚£ä¹ˆåœ¨8ä»¥åæ˜¯åŠ äº†ä¸€ä¸ªçº¢é»‘æ ‘çš„æ–¹å¼å­˜å‚¨ï¼Œå½“æ•°ç»„é•¿åº¦å¤§äº64ï¼Œé“¾è¡¨è¶…è¿‡8çš„æ—¶å€™ï¼Œä¼šä»é“¾è¡¨è½¬æˆçº¢é»‘æ ‘ï¼Œæé«˜äº†æ•°æ®é‡å¤§çš„æ—¶å€™çš„ä¸€ä¸ªæŸ¥è¯¢æ•ˆç‡ã€‚å› ä¸ºéƒ½æ˜¯æ•°ç»„+é“¾è¡¨æˆ–è€…çº¢é»‘æ ‘æ¥å®ç°ï¼Œå…¶å®å°±æ˜¯æ’å…¥æ•°æ®çš„æ—¶å€™ä¼šæ ¹æ®ä¸€ä¸ªhashå€¼è¿›è¡Œæ•°ç»„çš„æ’å…¥ï¼Œä¹Ÿå°±æ˜¯å“ˆå¸Œæ¡¶ä¹ˆã€‚å¦‚æœå‘ç”Ÿhashå†²çªäº†ï¼Œé‚£ä¹ˆä¼šåœ¨åŒæ ·çš„hashå€¼ä¸‹é¢åˆ›å»ºä¸€ä¸ªé“¾è¡¨ï¼Œæ˜¯è¿™æ ·æ¥å­˜å‚¨æ•°æ®çš„ã€‚é€šè¿‡ <code>(n - 1) &amp; hash</code> ç¡®å®šå…ƒç´ ä½ç½®ï¼Œå¦‚æœè¦å­˜100ä¸ªå…ƒç´ ï¼Œå®¹é‡è®¾ä¸ºå¤šå¤§ï¼Œ100/0.75ä¹ˆï¼Œè´Ÿè½½å› å­æ˜¯0.75ï¼Œå†åŠ 1ï¼Œç„¶åå› ä¸ºå®¹é‡è¦æ˜¯2çš„å¹‚æ‰€ä»¥éœ€è¦å‘ä¸Šæ‰¾2çš„å¹‚ã€‚</p><h2 id="ConcurrentHashMapå’Œhashmapçš„åŒºåˆ«">ConcurrentHashMapå’Œhashmapçš„åŒºåˆ«</h2><p>æœ€å¤§çš„åŒºåˆ«å…¶å®å°±æ˜¯åœ¨å¤šçº¿ç¨‹çš„æƒ…å†µä¸‹ï¼Œhashmapæ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼Œå› ä¸ºåº•å±‚åŸç†æ˜¯é“¾è¡¨+æ•°ç»„ä¹ˆï¼Œå¹¶æ²¡æœ‰åŠ é”ï¼Œæ‰€ä»¥åœ¨é«˜å¹¶å‘çš„æƒ…å†µä¸‹è‚¯å®šä¼šå¯¼è‡´æ•°æ®ä¸ä¸€è‡´ï¼Œæˆ–è€…é“¾è¡¨æˆç¯å¯¼è‡´æ­»å¾ªç¯çš„é—®é¢˜ã€‚è€Œconcurrenthashmapåº•å±‚åœ¨ä»¥å‰æ˜¯åˆ†å¸ƒæ®µé”+CASæ¯”è¾ƒæ—¶äº¤æ¢ï¼Œé‚£åœ¨JAVA8ä»¥åæ˜¯ä½¿ç”¨CASåŠ synchronizedé”ï¼Œå®ƒä¼šå¯¹é“¾è¡¨çš„å¤´ç»“ç‚¹åŠ é”ï¼Œè¿™æ ·åœ¨å…¶ä»–çº¿ç¨‹ä¿®æ”¹å€¼çš„æ—¶å€™å°±ä¼šç­‰å¾… å®ƒçš„ç‰¹ç‚¹æ˜¯å¯¹æ•°æ®åœ¨è¯»æ“ä½œä¸åŠ é”ï¼Œåœ¨å†™å…¥æ“ä½œå…ˆé€šè¿‡CASæ’å…¥ï¼Œå¤±è´¥çš„è¯å°±åŠ synchronizedé”ï¼Œæé«˜å¹¶å‘æ•ˆç‡ã€‚</p><h2 id="ConcurrentHashMap-ä¸ºä½•ç¦æ­¢-null-ä½œä¸º-keyï¼Ÿ">ConcurrentHashMap ä¸ºä½•ç¦æ­¢ null ä½œä¸º keyï¼Ÿ</h2><ul><li>å¹¶å‘åœºæ™¯ä¸‹ï¼Œ<code>null</code> ä¼šå¯¼è‡´ <strong>é€»è¾‘æ­§ä¹‰</strong>ï¼š<code>get(null)</code> è¿”å› <code>null</code>ï¼Œæ— æ³•åŒºåˆ† â€œkey ä¸å­˜åœ¨â€ å’Œ â€œvalue ä¸º nullâ€ï¼›</li><li>è®¾è®¡ä¸Šä¿æŒä¸ <code>Hashtable</code>ï¼ˆçº¿ç¨‹å®‰å…¨ä¸”ç¦æ­¢ null keyï¼‰çš„ä¸€è‡´æ€§ï¼Œé¿å…å¹¶å‘åˆ¤æ–­å¤æ‚ï¼Œä¿éšœçº¿ç¨‹å®‰å…¨é€»è¾‘æ¸…æ™°ã€‚</li></ul><h2 id="å¦‚ä½•åˆ›å»ºçº¿ç¨‹">å¦‚ä½•åˆ›å»ºçº¿ç¨‹</h2><p>Java åˆ›å»ºçº¿ç¨‹çš„ä¸‰ç§æ–¹å¼ï¼š</p><ol><li><p><strong>ç»§æ‰¿ Thread ç±»</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä½¿ç”¨ï¼šnew MyThread().start();</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyThread</span> <span class="keyword">extends</span> <span class="title class_">Thread</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Thread running&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>å®ç° Runnable æ¥å£</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä½¿ç”¨ï¼šnew Thread(new MyRunnable()).start();</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyRunnable</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Runnable running&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>å®ç° Callable æ¥å£</strong>ï¼ˆæ”¯æŒè¿”å›å€¼ï¼‰ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä½¿ç”¨ï¼šé€šè¿‡FutureTaskå’ŒThreadæ‰§è¡Œ</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyCallable</span> <span class="keyword">implements</span> <span class="title class_">Callable</span>&lt;String&gt; &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">call</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Result&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h2 id="ä»‹ç»Mybatis">ä»‹ç»Mybatis</h2><p><strong>åŠè‡ªåŠ¨ ORMï¼ˆå¯¹è±¡å…³ç³»æ˜ å°„ï¼‰æ¡†æ¶</strong>ï¼Œé€šè¿‡ XML æˆ–æ³¨è§£å°† SQL è¯­å¥ä¸ Java å¯¹è±¡ç»‘å®šï¼Œä¸€èˆ¬ç”¨#{name}çš„å½¢å¼å ä½</p><ul><li><strong>XML é…ç½®</strong>ï¼šé€šè¿‡ <code>&lt;select&gt;</code>ã€<code>&lt;insert&gt;</code> ç­‰æ ‡ç­¾ç¼–å†™ SQLã€‚</li><li><strong>æ³¨è§£æ”¯æŒ</strong>ï¼šä½¿ç”¨ <code>@Select</code>ã€<code>@Insert</code> ç­‰æ³¨è§£ç›´æ¥åœ¨æ¥å£ä¸­å®šä¹‰ SQLã€‚</li></ul><h2 id="mybatiså’Œmybatis-plusåŒºåˆ«">mybatiså’Œmybatis-plusåŒºåˆ«</h2><p>mybatisæ˜¯ä¸€èˆ¬æ˜¯ç”¨xmlå’Œæ³¨è§£æ‰‹åŠ¨ç¼–å†™SQLï¼Œmybatis-plusæ˜¯å†…ç½®äº†å¾ˆå¤šUURDçš„æ–¹æ³•ï¼ŒåŸºç¡€çš„SQLç¼–å†™ä»£ç ä¼šå°‘å¾ˆå¤šã€‚è¿™æ ·çš„è¯mybatiså°±æ¯”è¾ƒé€‚åˆä¸€äº›å¤æ‚çš„ä¸šåŠ¡é€»è¾‘ï¼Œå¤šè¡¨æŸ¥è¯¢è¿˜è¦åˆ†ç»„ç»Ÿè®¡ä»€ä¹ˆçš„ã€‚mybatis-plusçš„è¯å¤æ‚æŸ¥è¯¢å°±éœ€Lambda è¡¨è¾¾å¼æˆ– Wrapper æ¡ä»¶æ„é€ å™¨æ¥æŸ¥è¯¢å¤šè¡¨ã€‚åˆ†é¡µæ˜¯ä½¿ç”¨PageHelper(é¡µç ï¼Œæ¯é¡µæ˜¾ç¤º) ã€‚</p><h2 id="å¦‚ä½•é˜²æ­¢SQLæ³¨å…¥">å¦‚ä½•é˜²æ­¢SQLæ³¨å…¥</h2><p>ä¼˜å…ˆä½¿ç”¨ <code>#&#123;&#125;</code> å ä½ç¬¦å°†å‚æ•°ä½œä¸ºé¢„ç¼–è¯‘è¯­å¥çš„å ä½ç¬¦ï¼ˆ<code>?</code>ï¼‰å¤„ç†ï¼Œåº•å±‚ä½¿ç”¨ <code>PreparedStatement</code>ï¼Œå®Œå…¨é¿å… SQL æ³¨å…¥ã€‚å‚æ•°å€¼ï¼ˆå¦‚ <code>1' OR '1'='1</code>ï¼‰è¢«è‡ªåŠ¨è½¬ä¹‰ä¸ºå­—ç¬¦ä¸²ï¼Œä½œä¸ºæ•°æ®è€Œé SQL ä»£ç å¤„ç†ã€‚mybatis-plusçš„è¯æ˜¯ <code>Wrapper</code> æ¡ä»¶æ„é€ å™¨ä¼šè‡ªåŠ¨ä½¿ç”¨é¢„ç¼–è¯‘ã€‚ä½¿ç”¨lambdaæ—¶å€™ï¼Œ<strong>å‚æ•°ç±»å‹ä¼šä¸¥æ ¼æ ¡éªŒ</strong>ï¼Œé˜²æ­¢éæ³• SQLï¼Œå†…ç½®çš„å¾ˆå¤šæ’ä»¶éƒ½ä¼šé˜²æ­¢sqlæ³¨å…¥ã€‚</p><h2 id="propertieså’Œymlå’Œyamlçš„åŠ è½½é¡ºåºå’Œä¼˜å…ˆçº§ä»¥åŠåŒºåˆ«">propertieså’Œymlå’Œyamlçš„åŠ è½½é¡ºåºå’Œä¼˜å…ˆçº§ä»¥åŠåŒºåˆ«</h2><p>propertiesæ˜¯é”®å€¼å¯¹ï¼Œymlå’Œyamlæ˜¯æ ‘å½¢ç»“æ„ä¹ˆï¼ŒSpring Boot ä¼šæŒ‰propertiesï¼Œyamlï¼ŒymlåŠ è½½<strong>åŒä¸€ç›®å½•</strong>ä¸‹çš„é…ç½®æ–‡ä»¶ï¼ŒååŠ è½½çš„è¦†ç›–å…ˆåŠ è½½çš„ã€‚ç‰¹å®šç¯å¢ƒé…ç½®ï¼ˆå¦‚ <code>application-dev.properties</code>ï¼‰ä¼šè¦†ç›–é»˜è®¤ï¼ˆ<code>application.properties</code>ï¼‰ã€‚</p><h2 id="é‡è½½å’Œé‡å†™çš„åŒºåˆ«">é‡è½½å’Œé‡å†™çš„åŒºåˆ«</h2><p>å®šä¹‰ä½ç½®ä¸åŒï¼š</p><ul><li>é‡è½½å‘ç”Ÿåœ¨<strong>åŒä¸€ä¸ªç±»ä¸­</strong>ï¼Œæ˜¯å¤šä¸ªåŒåæ–¹æ³•å› å‚æ•°åˆ—è¡¨ä¸åŒï¼ˆç±»å‹ã€æ•°é‡ã€é¡ºåºï¼‰è€Œå…±å­˜çš„ç°è±¡ï¼›</li><li>é‡å†™å‘ç”Ÿåœ¨<strong>å­ç±»ä¸çˆ¶ç±»ä¹‹é—´</strong>ï¼Œå­ç±»é€šè¿‡ç›¸åŒå‚æ•°åˆ—è¡¨è¦†ç›–çˆ¶ç±»çš„æ–¹æ³•å®ç°ã€‚</li></ul><p>å¤šæ€ï¼šåŠ¨æ€ç¼–è¯‘çœ‹å·¦è¿è¡Œçœ‹å³ï¼Œé™æ€ç¼–è¯‘çœ‹å·¦è¿è¡Œçœ‹å·¦</p><p>é‡è½½å±äºç¼–è¯‘æ—¶å¤šæ€ï¼ˆé™æ€ç»‘å®šï¼‰ç¼–è¯‘å™¨æ ¹æ®è°ƒç”¨æ—¶çš„å‚æ•°ç±»å‹ç›´æ¥ç¡®å®šæ–¹æ³•ç‰ˆæœ¬ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">test</span><span class="params">(<span class="type">int</span> i)</span> &#123; ... &#125;  <span class="comment">// æ–¹æ³•1</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">test</span><span class="params">(String s)</span> &#123; ... &#125;  <span class="comment">// æ–¹æ³•2</span></span><br><span class="line">test(<span class="number">10</span>);  <span class="comment">// ç¼–è¯‘æ—¶ç¡®å®šè°ƒç”¨æ–¹æ³•1</span></span><br></pre></td></tr></table></figure><p>é‡å†™å±äº</p><p>è¿è¡Œæ—¶å¤šæ€ï¼ˆåŠ¨æ€ç»‘å®šï¼‰JVM æ ¹æ®å¯¹è±¡å®é™…ç±»å‹å†³å®šæ‰§è¡Œå“ªä¸ªæ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Parent</span> <span class="variable">p</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Child</span>();</span><br><span class="line">p.method();  <span class="comment">// è¿è¡Œæ—¶è°ƒç”¨Childçš„method()</span></span><br></pre></td></tr></table></figure><h2 id="å’ŒequalsåŒºåˆ«"><a href="https://blog.csdn.net/weixin_46460843/article/details/110310604?fromshare=blogdetail&amp;sharetype=blogdetail&amp;sharerId=110310604&amp;sharerefer=PC&amp;sharesource=U7_7cc&amp;sharefrom=from_link">==å’ŒequalsåŒºåˆ«</a></h2><ul><li>â€œ==â€æ˜¯è¿ç®—ç¬¦ï¼Œå¦‚æœæ˜¯åŸºæœ¬æ•°æ®ç±»å‹ï¼Œåˆ™æ¯”è¾ƒ<strong>å­˜å‚¨çš„å€¼</strong>ï¼›å¦‚æœæ˜¯å¼•ç”¨æ•°æ®ç±»å‹ï¼Œåˆ™æ¯”è¾ƒ<strong>æ‰€æŒ‡å‘å¯¹è±¡çš„åœ°å€å€¼</strong>ã€‚</li><li>equalsæ˜¯Objectçš„æ–¹æ³•ï¼Œæ¯”è¾ƒçš„æ˜¯<strong>æ‰€æŒ‡å‘çš„å¯¹è±¡çš„åœ°å€å€¼</strong>ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œé‡å†™ä¹‹åæ¯”è¾ƒçš„æ˜¯<strong>å¯¹è±¡çš„å€¼</strong>ã€‚ä¸€èˆ¬æƒ…å†µæˆ‘ä»¬åˆ›å»ºçš„ç±»éƒ½ä¼šå¯¹equalsæ–¹æ³•è¿›è¡Œé‡å†™</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">s1</span> <span class="operator">=</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line"><span class="type">String</span> <span class="variable">s2</span> <span class="operator">=</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">System.out.println(s1 == s2);    <span class="comment">//trueï¼Œæ¯”è¾ƒåœ°å€å€¼ï¼šå†…å®¹ç›¸åŒï¼Œå› ä¸ºå¸¸é‡æ± ä¸­åªæœ‰ä¸€ä¸ªâ€œhelloâ€ï¼Œæ‰€ä»¥å®ƒä»¬çš„åœ°å€å€¼ç›¸åŒ</span></span><br><span class="line">System.out.println(s1.equals(s2));<span class="comment">//trueï¼Œæ¯”è¾ƒå†…å®¹ï¼šå†…å®¹ç›¸åŒï¼Œå› ä¸ºå¸¸é‡æ± ä¸­åªæœ‰ä¸€ä¸ªâ€œhelloâ€ï¼Œæ‰€ä»¥å®ƒä»¬çš„åœ°å€å€¼ç›¸åŒ</span></span><br><span class="line">System.out.println(s1.equals(<span class="string">&quot;hello&quot;</span>)); <span class="comment">//true</span></span><br><span class="line"><span class="type">String</span> <span class="variable">s3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line"><span class="type">String</span> <span class="variable">s4</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">System.out.println(s3 == s4);        <span class="comment">//false,æ¯”è¾ƒåœ°å€å€¼ï¼šs3å’Œs4åœ¨å †å†…å­˜ä¸­çš„åœ°å€å€¼ä¸åŒ</span></span><br><span class="line">System.out.println(s3.equals(s4));    <span class="comment">//trueï¼Œæ¯”è¾ƒå†…å®¹ï¼šå†…å®¹ç›¸åŒ</span></span><br></pre></td></tr></table></figure><h2 id="é‡å†™-equals-å¿…å¹¶é‡å†™-hashCode">é‡å†™ equals()å¿…å¹¶é‡å†™ hashCode</h2><p>Java è§„èŒƒè¦æ±‚ï¼š<em><code>equals</code> ç›¸ç­‰çš„å¯¹è±¡ï¼Œ<code>hashCode</code> å¿…é¡»ç›¸ç­‰</em>ã€‚è‹¥ä»…é‡å†™ <code>equals</code>ï¼Œä¸é‡å†™ <code>hashCode</code>ï¼Œä¼šå¯¼è‡´ <strong>å“ˆå¸Œé›†åˆï¼ˆå¦‚ <code>HashMap</code>ã€<code>HashSet</code>ï¼‰é€»è¾‘é”™è¯¯</strong>ï¼ˆæ¯”å¦‚ä¸¤ä¸ª <code>equals</code> ç›¸ç­‰çš„å¯¹è±¡å›  <code>hashCode</code> ä¸åŒï¼Œè¢«å“ˆå¸Œè¡¨åˆ¤å®šä¸ºä¸åŒé”® / å…ƒç´ ï¼Œç ´åå”¯ä¸€æ€§ï¼‰</p><h2 id="ç¼“å­˜ä¸æ•°æ®åº“å¦‚ä½•ä¿è¯æ•°æ®ä¸€è‡´æ€§">ç¼“å­˜ä¸æ•°æ®åº“å¦‚ä½•ä¿è¯æ•°æ®ä¸€è‡´æ€§</h2><ul><li><strong>Cache-Aside æ¨¡å¼</strong>ï¼šæ›´æ–°æ•°æ®åº“åï¼Œ<strong>åˆ é™¤ç¼“å­˜</strong>ï¼ˆè€Œéæ›´æ–°ï¼Œé¿å…å¹¶å‘å†²çªï¼‰ï¼›</li><li><strong>å»¶æ—¶åŒåˆ </strong>ï¼šæ›´æ–°æ•°æ®åº“ â†’ åˆ ç¼“å­˜ â†’ çŸ­æš‚ä¼‘çœ ï¼ˆé¿å…è„è¯»ï¼‰â†’ å†åˆ ç¼“å­˜ï¼ˆå¤„ç†å¹¶å‘æ›´æ–°å»¶è¿Ÿï¼‰ï¼›</li><li><strong>æœ€ç»ˆä¸€è‡´æ€§</strong>ï¼šç»“åˆæ¶ˆæ¯é˜Ÿåˆ—å¼‚æ­¥åŒæ­¥ï¼Œä¿è¯æœ€ç»ˆæ•°æ®ä¸€è‡´ã€‚</li></ul><h2 id="JVM">JVM</h2><p>jvm jre jdk</p><p>JVMæ˜¯javaçš„è™šæ‹Ÿæœºï¼Œå¸®åŠ©Java å®ç° â€œä¸€æ¬¡ç¼–å†™ï¼Œåˆ°å¤„è¿è¡Œâ€ï¼ŒåŒæ—¶ä¹Ÿæ˜¯javaè·¨å¹³å°ä½¿ç”¨çš„ä¾é ï¼Œjreæ˜¯è¿è¡Œjavaçš„ç¯å¢ƒï¼Œå®ƒåŒ…å«äº†jvmï¼Œå¦‚æœåªè¿è¡Œç¼–è¯‘å¥½çš„jaråŒ…æˆ–è€…classæ–‡ä»¶ï¼Œé‚£ä¹ˆåªéœ€è¦æœ‰jreå°±è¡Œï¼Œä½†æ˜¯å¦‚æœè¦å¼€å‘javaï¼Œå°‘ä¸äº†éœ€è¦ç¼–è¯‘ï¼Œè¿™æ—¶å€™å°±éœ€è¦æœ‰jdkï¼ŒjdkåŒ…å«äº†jreå’Œjvmï¼Œæä¾›äº†å¾ˆå¤šjava çš„å¼€å‘å·¥å…·ã€‚ç¼–è¯‘å™¨ï¼ˆjavacï¼‰ï¼Œæ‰“åŒ…å·¥å…·jar</p><h2 id="JUC">JUC</h2><h1 id="Springé¢è¯•">Springé¢è¯•</h1><h2 id="IOCå’ŒAOP">IOCå’ŒAOP</h2><p>æ˜¯springçš„ä¸¤å¤§é‡è¦ç‰¹æ€§ï¼ŒIOCå°±æ˜¯æ§åˆ¶åè½¬ã€æ³¨å…¥ä¾èµ–ä¹ˆã€‚ä»–å°±æ˜¯Springå°†æˆ‘ä»¬çš„ç±»é€šè¿‡çš„æ–¹å¼ï¼Œå°†ä»–çš„åˆ›å»ºå’Œç”Ÿå‘½å‘¨æœŸéƒ½æ”¾åˆ°Springå®¹å™¨ä¸­ç»Ÿä¸€ç®¡ç†ï¼Œè¿™æ ·æˆ‘ä»¬å…¶ä»–çš„ç±»å¦‚æœéœ€è¦è°ƒç”¨æŸä¸ªç±»å°±å¯ä»¥ç›´æ¥åˆ°Springçš„å®¹å™¨å·¥å‚ä¸­å»æ‰¾ã€‚AOPå°±æ˜¯IOCçš„ä¸€ä¸ªæ‰©å±•ï¼Œä»–æ˜¯é¢å‘åˆ‡é¢ç¼–ç¨‹ï¼Œå…¶å®å°±æ˜¯ä¸€ä¸ªåŠ¨æ€ä»£ç†ï¼Œé€šå¸¸æƒ…å†µä»–çš„ä½œç”¨å°±æ˜¯èƒ½å®ç°æˆ‘ä»¬éä¸šåŠ¡çš„ä»£ç ï¼Œä¸å»å½±å“å®é™…çš„ä¸šåŠ¡ï¼Œå…¶å®å°±æ˜¯åœ¨ä¸åŠ¨å·²ç»å®Œæˆçš„ä¸šåŠ¡ä»£ç ï¼Œæƒ³è¦åœ¨åŠ ä¸Šéä¸šåŠ¡çš„ä»£ç çš„æ—¶å€™ä¼šç”¨åˆ°AOPæ€æƒ³ï¼Œæ¯”å¦‚è¦çœ‹æ—¥å¿—ï¼Œç®—æ¥å£æ—¶é—´ï¼Œäº‹åŠ¡ç®¡ç†ç­‰ã€‚AOPæœ‰äº”å¤§é€šçŸ¥ï¼Œå‰ç½® åç½® ç¯ç»• å¼‚å¸¸ æœ€ç»ˆï¼Œæ·»åŠ å’Œä¸šåŠ¡æ— å…³çš„é€»è¾‘ã€‚</p><h2 id="Beançš„ç”Ÿå‘½å‘¨æœŸ">Beançš„ç”Ÿå‘½å‘¨æœŸ</h2><p>IOCçš„åŠ è½½å…¶å®å°±æ˜¯ä¸€ä¸ªBeançš„åˆ›å»ºä¹ˆï¼ŒBeanä»åˆ›å»ºåˆ°é”€æ¯å°±æ˜¯å®ƒçš„ç”Ÿå‘½å‘¨æœŸï¼Œåˆ†ä¸ºå®ä¾‹åŒ–ï¼Œå®ƒæ˜¯é€šè¿‡åå°„å»æ‰¾æ„é€ å‡½æ•°å®ä¾‹åŒ–çš„ã€‚å†å±æ€§èµ‹å€¼ï¼Œè§£æè‡ªåŠ¨è£…é…çš„ï¼Œä¸€èˆ¬ç”¨@autowiredæˆ–è€…@resource,è§£å†³äº†å¾ªç¯ä¾èµ–çš„é—®é¢˜ã€‚æ¥ç€æ˜¯åˆå§‹åŒ–ï¼Œåˆå§‹åŒ–çš„æ—¶å€™è°ƒç”¨åˆå§‹åŒ–ç”Ÿå‘½å‘¨æœŸå›è°ƒï¼Œè¿™ä¸ªæ—¶å€™å°±å¯ä»¥ä½¿ç”¨è¯¥ç±»äº†ï¼Œæœ€åå®¹å™¨å…³é—­çš„æ—¶å€™ï¼Œè°ƒç”¨é”€æ¯ç”Ÿå‘½å‘¨æœŸå›è°ƒï¼Œå°†Beanè¿›è¡Œä¸€ä¸ªé”€æ¯å¤„ç†ã€‚</p><h2 id="Spring-çš„è‡ªåŠ¨è£…é…è¿‡ç¨‹å¦‚ä½•è¯†åˆ«è¦è£…é…çš„ç±»ï¼Ÿä¼šæ‰«æå…¨éƒ¨ç±»å—ï¼Ÿ">Spring çš„è‡ªåŠ¨è£…é…è¿‡ç¨‹å¦‚ä½•è¯†åˆ«è¦è£…é…çš„ç±»ï¼Ÿä¼šæ‰«æå…¨éƒ¨ç±»å—ï¼Ÿ</h2><p>Spring è¯†åˆ«è¦è£…é…çš„ç±»ä¸»è¦é€šè¿‡ <strong>ç»„ä»¶æ‰«æï¼ˆComponent Scanï¼‰</strong>ï¼Œè€Œéæ‰«æé¡¹ç›®ä¸­çš„å…¨éƒ¨ç±»ï¼Œå…·ä½“é€»è¾‘å¦‚ä¸‹ï¼šä»–ä¼šæ‰«æspringç”¨æ³¨è§£æ ‡è®°çš„ä¸€äº›ç±»ï¼Œå°†æ ‡è®°çš„ç±»æ³¨å†Œä¸º Beanã€‚å¼€å‘è€…éœ€åœ¨é…ç½®ä¸­æŒ‡å®šæ‰«æçš„åŒ…è·¯å¾„ï¼ˆå¦‚<code>@ComponentScan(&quot;com.example&quot;)</code>ï¼‰ï¼ŒSpring ä»…æ‰«æè¯¥è·¯å¾„ä¸‹çš„ç±»ï¼Œä¸ä¼šæ‰«ææ‰€æœ‰ç±»ï¼Œä»¥æ­¤æå‡æ•ˆç‡ã€‚</p><h2 id="Spring-Boot-è‡ªåŠ¨é…ç½®åŸç†ï¼Ÿ">Spring Boot è‡ªåŠ¨é…ç½®åŸç†ï¼Ÿ</h2><ol><li><strong>æ³¨è§£é©±åŠ¨</strong>ï¼š<code>@SpringBootApplication</code> åŒ…å« <code>@EnableAutoConfiguration</code>ï¼Œè§¦å‘è‡ªåŠ¨é…ç½®ï¼›</li><li><strong>SPI æœºåˆ¶</strong>ï¼šSpring æ‰«æ <code>META-INF/spring.factories</code>ï¼ŒåŠ è½½æ‰€æœ‰ <code>AutoConfiguration</code> ç±»ï¼›</li><li><strong>æ¡ä»¶è£…é…</strong>ï¼šé€šè¿‡ <code>@Conditional</code>ï¼ˆå¦‚ <code>@ConditionalOnClass</code>ã€<code>@ConditionalOnBean</code>ï¼‰åˆ¤æ–­ç¯å¢ƒæ˜¯å¦æ»¡è¶³ï¼Œæ»¡è¶³åˆ™è‡ªåŠ¨åˆ›å»º Beanã€‚</li></ol><h2 id="Componentå’Œ-Bean">@Componentå’Œ@Bean</h2><p>é¦–å…ˆåœ¨ç”¨é€”æ–¹é¢å’Œä½¿ç”¨æ–¹æ³•ä¸åŒï¼ŒComponentæ³¨è§£æ˜¯æ ‡è¯†æ™®é€šçš„ç±»ï¼Œspringä¼šé€šè¿‡Componentscanæ‰«æå°†ç±»æ³¨å†Œåˆ°spring IOCå®¹å™¨ä¸­ã€‚@beanä¸€èˆ¬æ˜¯åœ¨é…ç½®ç±»ä¸­çš„æ–¹æ³•ï¼Œå£°æ˜å’Œæ‰‹åŠ¨é…ç½®ä¸€ä¸ªbeanå¯¹è±¡ã€‚Componentæ³¨è§£æ˜¯springè‡ªåŠ¨åˆ›å»ºå’Œåˆå§‹åŒ–çš„ï¼Œbeanæ³¨è§£å¯ä»¥æ‰‹åŠ¨æ§åˆ¶beançš„åˆ›å»ºå’Œé…ç½®è¿‡ç¨‹</p><h2 id="autowiredå’Œ-resource">@autowiredå’Œ@resource</h2><p>autowiredæ˜¯æŒ‰ç…§ç±»è¿›è¡Œæ³¨å…¥æ˜¯Springè‡ªå¸¦çš„ï¼Œresourceæ˜¯æŒ‰ç…§å¯¹è±¡åè¿›è¡Œæ³¨å…¥ï¼Œå¯¹è±¡åæ‰¾ä¸åˆ°å°±æ‰¾ç±»ï¼Œå®ƒå±äºjdk</p><h2 id="SSM">SSM</h2><p>Spring + Spring MVC + MyBatis ä¸‰ä¸ªæ¡†æ¶çš„ç»„åˆï¼Œæ˜¯ Java ä¼ä¸šçº§å¼€å‘ä¸­ç»å…¸çš„ <strong>Web åº”ç”¨æ¶æ„</strong>ã€‚è¿™ä¸‰ä¸ªæ¡†æ¶å„å¸å…¶èŒï¼Œå…±åŒæ„æˆäº†ä¸€ä¸ªå®Œæ•´çš„åˆ†å±‚å¼€å‘ä½“ç³»ï¼š</p><ul><li><strong>Spring</strong>ï¼šè´Ÿè´£<strong>å…¨å±€ç®¡ç†</strong>ï¼ˆIoC å®¹å™¨ã€AOP åˆ‡é¢ï¼‰å’Œ<strong>ç»„ä»¶åè°ƒ</strong>ï¼›</li><li><strong>Spring MVC</strong>ï¼šä½œä¸º<strong>è¡¨ç°å±‚æ¡†æ¶</strong>ï¼Œå¤„ç† HTTP è¯·æ±‚å’Œå“åº”ï¼›</li><li><strong>MyBatis</strong>ï¼šä½œä¸º<strong>æ•°æ®è®¿é—®å±‚æ¡†æ¶</strong>ï¼Œç®€åŒ–æ•°æ®åº“æ“ä½œã€‚</li></ul><h2 id="TODO-JDKåŠ¨æ€ä»£ç†å’ŒCGLIBåŠ¨æ€ä»£ç†">TODO JDKåŠ¨æ€ä»£ç†å’ŒCGLIBåŠ¨æ€ä»£ç†</h2><h2 id="æ‹¦æˆªå™¨çš„ä½¿ç”¨åœºæ™¯">æ‹¦æˆªå™¨çš„ä½¿ç”¨åœºæ™¯</h2><p>æ‹¦æˆªå™¨å…¶å®å°±æ˜¯ä¸€ä¸ªAOPçš„æ€æƒ³ï¼Œæœ€å¸¸è§çš„å°±æ˜¯ç”¨æˆ·ç™»å½•çš„æ—¶å€™è¿›è¡Œèº«ä»½éªŒè¯å’Œæƒé™æ ¡éªŒï¼Œè¿˜æœ‰æ—¥å¿—çš„è®°å½•å’Œç›‘æ§ï¼Œè¿˜æœ‰å¯¹ä¼ å‚å‡ºå‚çš„æ•°æ®è¿›è¡Œæ ¡éªŒï¼Œçœ‹æ˜¯å¦ç¬¦åˆä¸šåŠ¡éœ€æ±‚ï¼Œè¿˜æœ‰å‰ç«¯è·¨åŸŸè¯·æ±‚ä¹Ÿæœ‰ç”¨åˆ°ã€‚</p><h2 id="æ‹¦æˆªå™¨å’Œè¿‡æ»¤å™¨çš„åŒºåˆ«">æ‹¦æˆªå™¨å’Œè¿‡æ»¤å™¨çš„åŒºåˆ«</h2><p>æ¥æºä¸åŒè¿‡æ»¤å™¨æ¥è‡ªservletè€Œæ‹¦æˆªå™¨æ˜¯springï¼Œä»–ä»¬ä¹Ÿæ˜¯å®ç°äº†ä¸åŒçš„ç±»ï¼Œè¿›è¡Œæ–¹æ³•çš„å®ç°ï¼Œè¿‡æ»¤å™¨å®ç°äº†filteræ¥å£ï¼Œåº•å±‚æ˜¯é€šè¿‡ä¸€ä¸ªfilterchainç±»è¿›è¡Œé“¾çš„æ“ä½œå®ç°è¿‡æ»¤çš„ï¼Œè€Œæ‹¦æˆªå™¨æ˜¯å®ç°handlerInterceptoræ¥å£ã€‚æ‹¦æˆªå™¨åº•å±‚æ˜¯é€šè¿‡åå°„å®ç°çš„ã€‚ä»–ä»¬åœ¨é¡¹ç›®ä¸­æ‰€åœ¨ä½ç½®ä¹Ÿä¸ä¸€æ ·ï¼Œæ‹¦æˆªå™¨æ›´æ¥è¿‘controllerå±‚ï¼Œæ‰€ä»¥ç»å¸¸ç”¨æ¥åšç™»å½•æ ¡éªŒï¼Œè¿‡æ»¤å™¨å°±ç”¨æ¥åšç¼–ç è§„åˆ™ç­‰åŠŸèƒ½ã€‚</p><h2 id="Springäº‹åŠ¡">Springäº‹åŠ¡</h2><h3 id="Springäº‹åŠ¡çš„åˆ›å»º">Springäº‹åŠ¡çš„åˆ›å»º</h3><p>ç”¨ä¸€ä¸ªæ³¨è§£@Transactionalï¼Œåœ¨serviceå±‚ä½¿ç”¨è¯¥æ³¨è§£è®¾ç½®éš”ç¦»çº§åˆ« ä¼ æ’­çº§åˆ« å¼‚å¸¸å¤„ç†ã€‚å¤æ‚é€»è¾‘é€šå¸¸ä½¿ç”¨TransactionTemplateï¼Œæ ¸å¿ƒéƒ½æ˜¯ä¿æŒä¸šåŠ¡æ“ä½œæ•°æ®æ—¶çš„åŸå­æ€§ã€‚</p><h3 id="Springäº‹åŠ¡çš„éš”ç¦»çº§åˆ«">Springäº‹åŠ¡çš„éš”ç¦»çº§åˆ«</h3><p>é»˜è®¤çŠ¶æ€å’Œæ•°æ®åº“çš„éš”ç¦»çº§åˆ«ä¿æŒä¸€è‡´ï¼Œè¿˜æœ‰è¯»æœªæäº¤ï¼Œè¯»å·²æäº¤ï¼Œå¯é‡å¤è¯»å’Œä¸²è¡ŒåŒ–ã€‚</p><h3 id="Springäº‹åŠ¡çš„å¤±æ•ˆ">Springäº‹åŠ¡çš„å¤±æ•ˆ</h3><p>ç¬¬ä¸€ä¸ªå°±æ˜¯å¯¹épublicæ–¹æ³•ï¼Œä½¿ç”¨äº‹åŠ¡çš„æ—¶å€™ä¼šå¤±æ•ˆï¼Œå› ä¸ºäº‹åŠ¡å…¶å®åŸºäºAOPçš„ï¼Œé‚£AOPæºç é‡Œé¢æœ‰å†™ä½¿ç”¨æ³¨è§£å¦‚æœè¯¥æ–¹æ³•ä¸ºépublicåˆ™ä¼šè¿”å›ä¸€ä¸ªnullå€¼ï¼Œç¬¬äºŒä¸ªå°±æ˜¯åŒä¸€ä¸ªç±»ä¸­ï¼Œéäº‹åŠ¡æ–¹æ³•ä¸­è°ƒç”¨äº†äº‹åŠ¡æ–¹æ³•ä¹Ÿä¼šå¯¼è‡´å¤±æ•ˆï¼Œç¬¬ä¸‰ä¸ªå°±æ˜¯äº‹åŠ¡åœ¨å¼‚å¸¸å¤„ç†çš„æ—¶å€™ï¼Œäº‹åŠ¡å†…éƒ¨æ²¡æœ‰å¯¹å¼‚å¸¸æŠ›å‡ºæˆ–è€…è¿›è¡Œå¤„ç†ï¼Œå¯¼è‡´äº‹åŠ¡æ— æ³•å›æ»šï¼Œç¬¬å››ä¸ªå°±æ˜¯æ•°æ®åº“ä¸æ”¯æŒäº‹åŠ¡çš„è¯ä¹Ÿä¼šå¤±æ•ˆã€‚</p><h3 id="Springäº‹åŠ¡çš„ä¼ æ’­è¡Œä¸º">Springäº‹åŠ¡çš„ä¼ æ’­è¡Œä¸º</h3><p>å…¶å®æ˜¯ä¸€ä¸ªäº‹åŠ¡è°ƒç”¨å¦ä¸€ä¸ªäº‹åŠ¡çš„æƒ…å†µï¼Œè¯¥äº‹åŠ¡çš„å‡ ç§æ‰§è¡Œæƒ…å†µã€‚å…·ä½“ä¸äº†è§£ã€‚</p><ol start="3"><li></li></ol><h2 id="Spring-ä¸­ä¸¤ä¸ª-id-ç›¸åŒçš„-bean-ä¼šæŠ¥é”™å—ï¼Ÿ">Spring ä¸­ä¸¤ä¸ª id ç›¸åŒçš„ bean ä¼šæŠ¥é”™å—ï¼Ÿ</h2><p><strong>ä¼šæŠ¥é”™</strong>ã€‚Spring å®¹å™¨ä¸­ï¼Œ<code>id</code> æ˜¯ bean çš„å”¯ä¸€æ ‡è¯†ã€‚è‹¥é…ç½®é‡å¤ <code>id</code>ï¼Œå®¹å™¨åˆå§‹åŒ–æ—¶ä¼šæŠ›å‡º <strong><code>BeanDefinitionStoreException</code></strong>ï¼ˆå†²çªæ£€æµ‹å¤±è´¥ï¼‰ã€‚</p><h1 id="MYSQLé¢è¯•">MYSQLé¢è¯•</h1><h2 id="å…³ç³»å‹æ•°æ®åº“å’Œéå…³ç³»å‹æ•°æ®åº“çš„åŒºåˆ«">å…³ç³»å‹æ•°æ®åº“å’Œéå…³ç³»å‹æ•°æ®åº“çš„åŒºåˆ«</h2><p>å…³ç³»å‹æ•°æ®åº“æœ‰å›ºå®šçš„è¡¨ç»“æ„åƒmysqlè¿™ç§è¡¨å’Œè¡¨ä¹‹é—´å­˜åœ¨å…³è”ï¼Œéå…³ç³»å‹æ•°æ®åº“æ²¡æœ‰å›ºå®šçš„è¡¨ç»“æ„ï¼Œæ‰€ä»¥æ¯”è¾ƒçµæ´»ã€‚</p><h2 id="DDLå’ŒDML">DDLå’ŒDML</h2><p>DDLæ˜¯å¯¹æ•°æ®åº“è¡¨è¿›è¡Œçš„æ“ä½œï¼Œæ¯”å¦‚ä¿®æ”¹è¡¨ç»“æ„ï¼Œåˆ›å»ºè¡¨ï¼Œåˆ é™¤è¡¨ã€‚DMLæ˜¯å¯¹è¡¨æ•°æ®çš„æ“ä½œï¼Œæ¯”å¦‚æ’å…¥æ•°æ®ï¼Œåˆ é™¤æ•°æ®ä¿®æ”¹æ•°æ®ã€‚</p><h2 id="ç¬›å¡å°”ç§¯">ç¬›å¡å°”ç§¯</h2><p>å…¶å®å°±æ˜¯å¤šè¡¨è¿æ¥çš„æ—¶å€™ï¼Œæ— è¿æ¥æ¡ä»¶çš„æŒ‡å®šï¼Œå°±ä¼šå¯¼è‡´æŸ¥è¯¢çš„ç»“æœçš„è¡Œæ•°æ˜¯æ¯ä¸ªè¡¨è¡Œæ•°ç›¸ä¹˜ã€‚æ‰€ä»¥è¦å°è¡¨é©±åŠ¨å¤§è¡¨ï¼Œå¯ä»¥å‡å°‘å¤–å±‚çš„å¾ªç¯æ¬¡æ•°ã€‚</p><h2 id="MySQLçš„è¿æ¥æ–¹å¼">MySQLçš„è¿æ¥æ–¹å¼</h2><p>å†…è¿æ¥ å·¦è¿æ¥ å³è¿æ¥ å…¨è¿æ¥ å·¦å¤–è¿æ¥ å³å¤–è¿æ¥ äº¤å‰è¿æ¥</p><h2 id="COUNT-COUNT-1-COUNT-åˆ—">COUNT(*) COUNT(1) COUNT(åˆ—)</h2><p>ä¸€èˆ¬ä½¿ç”¨COUNT(<em>),å…¶å®åœ¨MySQLä¸­count(</em>)å’Œcount1çš„æŸ¥è¯¢æ•ˆç‡æ˜¯å·®ä¸å¤šçš„ï¼Œå¦‚æœåˆ—åä¸ºä¸»é”®çš„æƒ…å†µä¸‹ï¼Œcount(åˆ—å)ä¼šæ¯”è¾ƒå¿«ï¼Œä»–ä»¬çš„æ•ˆç‡åœ¨ä¸åŒçš„åœºæ™¯ä¸‹æ˜¯ä¸åŒçš„ï¼Œé‚£ä¹ˆåŒºåˆ«å°±æ˜¯*æ˜¯æ‰§è¡Œçš„æ—¶å€™åŒ…æ‹¬äº†æ‰€æœ‰çš„åˆ—ï¼Œè®¡ç®—å‡ºæ¥æ˜¯è¡Œæ•°ï¼Œå³ä½¿æ˜¯nullä¹Ÿä¼šè®°å½•ï¼Œ1æ˜¯å¸¸é‡ï¼Œå¿½ç•¥äº†æ‰€æœ‰çš„åˆ—ï¼Œä»£è¡¨ä»£ç è¡Œï¼Œæ‰€ä»¥ä¹Ÿä¸ä¼šå¿½ç•¥nullï¼Œä½†æ˜¯åˆ—åçš„è¯ä¼šå»é™¤nullå€¼ï¼Œä¸ç»Ÿè®¡ã€‚</p><h2 id="MySQLç´¢å¼•çš„ç†è§£">MySQLç´¢å¼•çš„ç†è§£</h2><p>MySQLçš„å®ç°æ˜¯é€‰æ‹©çš„innodbï¼Œé‚£innodbç´¢å¼•æ•°æ®å­˜å‚¨ç»“æ„æ˜¯ä½¿ç”¨çš„b+æ ‘ï¼ŒB+æ ‘æ˜¯å¶å­èŠ‚ç‚¹å­˜å‚¨æ•°æ®ï¼Œéå¶å­èŠ‚ç‚¹å­˜å‚¨é”®å€¼ï¼ŒåŒæ—¶éå¶å­èŠ‚ç‚¹çˆ¶èŠ‚ç‚¹çš„å…ƒç´ éƒ½åœ¨å­èŠ‚ç‚¹çš„å…ƒç´ ä¸­ï¼Œå¹¶ä¸”æ˜¯æœ€å¤§çš„ä¸€ä¸ªï¼Œå¶å­èŠ‚ç‚¹æœ‰ä¸€ä¸ªæŒ‡å‘ç›¸é‚»é“¾è¡¨çš„æŒ‡é’ˆï¼Œæ–¹ä¾¿èŒƒå›´æŸ¥è¯¢ã€‚èšç°‡ç´¢å¼•å­˜å‚¨æ•´è¡Œçš„æ•°æ®å’Œé”®å€¼ï¼Œéèšç°‡ç´¢å¼•å­˜å‚¨ç´¢å¼•åˆ—çš„å€¼å’ŒæŒ‡å‘èšç°‡ç´¢å¼•çš„é”®å€¼ã€‚æ‰€ä»¥æˆ‘ä»¬å¦‚æœä½¿ç”¨éèšç°‡ç´¢å¼•ï¼Œå®ƒä¼šå…ˆæ‰¾åˆ°ç´¢å¼•åˆ—çš„å€¼ï¼Œå†å»æ‰¾èšç°‡ç´¢å¼•çš„é”®å€¼ï¼Œå†é€šè¿‡èšç°‡ç´¢å¼•çš„é”®å€¼æ‰¾åˆ°è¡Œæ•°æ®ï¼Œè¿™æ ·å°±ä¼šæœ‰ä¸€ä¸ªå›è¡¨çš„æ“ä½œï¼Œè¿›è¡Œä¸¤æ¬¡æŸ¥è¯¢çš„IOã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç»„åˆç´¢å¼•æ¥é¿å…å›è¡¨çš„æ“ä½œï¼Œå°†æ‰€éœ€è¦ä½¿ç”¨çš„åˆ—éƒ½è®¾ç½®ä¸ºç»„åˆç´¢å¼•ï¼Œè¿™æ ·æŸ¥è¯¢å­—æ®µçš„æ—¶å€™å› ä¸ºç»„åˆç´¢å¼•ä¸­å·²ç»æœ‰äº†å¯¹åº”çš„å­—æ®µï¼Œå°±ä¸ä¼šå†å»æ‰¾èšç°‡ç´¢å¼•äº†ï¼Œå¯ä»¥ç›´æ¥æ‰¾æ•°æ®è¡Œã€‚</p><h2 id="èšç°‡ç´¢å¼•å’Œéèšç°‡ç´¢å¼•">èšç°‡ç´¢å¼•å’Œéèšç°‡ç´¢å¼•</h2><p>åœ¨å­˜å‚¨æ–¹å¼ä¸Šä¸å¤ªä¸€æ ·ï¼Œèšç°‡ç´¢å¼•æ˜¯ç´¢å¼•ç»“æ„å’Œæ•°æ®è¡Œä¸€èµ·å­˜å‚¨çš„ï¼Œè€Œéèšç°‡ç´¢å¼•æ˜¯åˆ†å¼€å­˜å‚¨ï¼Œä¸€ä¸ªè¡¨åªèƒ½æœ‰ä¸€ä¸ªèšç°‡ç´¢å¼•è€Œå¯ä»¥æœ‰å¤šä¸ªéèšç°‡ç´¢å¼•ï¼Œæ•ˆç‡ä¸Šé¢èšç°‡ç´¢å¼•æ•ˆç‡é«˜æ¯”è¾ƒé€‚åˆèŒƒå›´æ€§çš„æŸ¥æ‰¾ï¼Œè€Œéèšç°‡ç´¢å¼•æ•ˆç‡æ¯”è¾ƒä½ï¼ŒæŸ¥è¯¢ä¼šåšä¸¤æ¬¡IOã€‚</p><h2 id="æ•°æ®åº“æ…¢æŸ¥è¯¢å’Œä¼˜åŒ–"><strong>æ•°æ®åº“æ…¢æŸ¥è¯¢å’Œä¼˜åŒ–</strong></h2><p>é¦–å…ˆæ…¢æŸ¥è¯¢å…¶å®æ˜¯MySQLèƒ½è®°å½•sqlæ‰§è¡Œæ—¶é—´å¤šé•¿çš„è¯­å¥çš„ä¸€ä¸ªæ‰‹æ®µï¼Œå®ƒä¼šæŠŠä¸€äº›æ‰§è¡Œæ—¶é—´è¶…è¿‡æˆ‘ä»¬è®¾ç½®çš„æ…¢æŸ¥è¯¢é˜ˆå€¼çš„è¯­å¥å†™å…¥æ…¢æŸ¥è¯¢æ—¥å¿—ä¸­ï¼Œæˆ‘ä»¬è¦åœ¨MySQLä¸­å¼€å¯æ…¢æŸ¥è¯¢ï¼Œè®¾ç½®slow_query_logè®¾ç½®ä¸º1 æ—¶é—´æ˜¯long_query_timeä¸­è®¾ç½®ï¼Œå‡ºç°æ…¢æŸ¥è¯¢çš„sqlè¯­å¥éƒ½éœ€è¦ä¼˜åŒ–ã€‚é¦–å…ˆæ˜¯å¯¹sqlè¯­å¥çš„ä¼˜åŒ–ï¼Œè¿™ç§ä¸€èˆ¬æ ¹æ®æˆ‘ä»¬çš„å¸¸è¯†æ¥ä¼˜åŒ–ï¼Œæ¯”å¦‚é¿å…ä½¿ç”¨select*ï¼Œæ¨¡ç³ŠæŸ¥è¯¢çš„æ—¶å€™ç™¾åˆ†å·æ”¾åˆ°äº†å‰é¢ï¼Œä½¿ç”¨orï¼Œè€ƒè™‘ä½¿ç”¨unionæˆ–è€…unionallï¼Œä½¿ç”¨äº†ä¸ç­‰äºå¯ä»¥ä½¿ç”¨inï¼Œç”¨äº†å­æŸ¥è¯¢with asï¼Œå¯ä»¥ä½¿ç”¨joinï¼Œéšå¼è½¬æ¢ï¼Œéæ­£ç¡®å‡½æ•°å¤„ç†å­—æ®µã€‚é™¤äº†è¿™äº›å¯ä»¥è€ƒè™‘ä½¿ç”¨ç´¢å¼•æ¥ä¼˜åŒ–ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨explanå…³é”®å­—ï¼ŒæŸ¥è¯¢æœ‰æ²¡æœ‰èµ°ç´¢å¼•ï¼Œæœ‰æ²¡æœ‰å…¨è¡¨æ‰«æï¼Œæœ‰æ²¡æœ‰å›è¡¨ã€‚æˆ‘ä»¬ä¼šé¦–å…ˆè€ƒè™‘ç»™ç»å¸¸éœ€è¦æŸ¥è¯¢çš„åˆ—å¢åŠ ç´¢å¼•ï¼Œå’Œè¦è¿æ¥æ¡ä»¶çš„åˆ—å»ºç«‹æ‰€ä»¥åŒæ—¶æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¦†ç›–ç´¢ï¼Œå¯ä»¥ç»™å­—æ®µæ·»åŠ è¦†ç›–ç´¢å¼•è¿™æ ·è¯¥åˆ—æŸ¥è¯¢å¾—æ—¶å€™å°±ä¼šåœ¨è¾…åŠ©ç´¢å¼•æ ‘ä¸Šé¢ï¼Œå¯ä»¥æœ‰æ•ˆåœ°å‡å°å›è¡¨æ“ä½œã€‚æˆ‘ä»¬å¯ä»¥é€‚å½“ä½¿ç”¨å‰ç¼€ç´¢å¼•ï¼Œå¹¶ä¸”æ­£ç¡®ä½¿ç”¨è”åˆç´¢å¼•é¿å…è¿‡å¤šçš„åˆ—ä½¿ç”¨è¦†ç›–ç´¢å¼•ã€‚åŒæ—¶è¦é¿å…èŒƒå›´æŸ¥è¯¢æ•°æ®å› ä¸ºmysqlä»–èµ°ç´¢å¼•çš„è¯ä¼šä»è¾…åŠ©ç´¢å¼•å®¿èˆæ‰¾å®Œå†å›ä¸»é”®æ‰¾æ•°æ®ï¼Œæ‰€ä»¥æ‰¾å¦‚æœä½ çš„è¦†ç›–èŒƒå›´è¿‡å¤§ä¼šå¯¼è‡´ä»–ä»–è¿˜ä¸å¦‚è¿›è¡Œä¸€éå…¨é¢æ‰«æé‚£å› ä¸ºmysqlæ˜¯è‡ªå¸¦ä¸€ä¸ªä¼˜åŒ–å™¨çš„é‚£ä»–å¯èƒ½å°±ä¼šèµ°å…¨è¡¨æ‰«æã€‚å¿…è¦çš„æ—¶å€™å¯ä»¥è€ƒè™‘ä½¿ç”¨åˆ†æ‰¹æŸ¥è¯¢æˆ–è€…mysqlçš„ç¼“å­˜å¤§å°æˆ–è€…åˆ†åº“åˆ†è¡¨è¯»å†™åˆ†ç¦»ã€‚</p><h2 id="æ€ä¹ˆä¼˜åŒ–SQLæ•ˆç‡"><strong>æ€ä¹ˆä¼˜åŒ–SQLæ•ˆç‡</strong></h2><p>é¦–å…ˆæ˜¯å¯¹sqlè¯­å¥çš„ä¼˜åŒ–ï¼Œè‚¯å®šè¦å¼€å¯åˆ†ææ…¢æŸ¥è¯¢æ—¥å¿—ï¼Œç­›é€‰å‡ºæ•ˆç‡æ¯”è¾ƒä½çš„sqlè¯­å¥ï¼Œç„¶åå¼€å§‹åˆ†æï¼Œæ˜¯IOæ•°æ®è®¿é—®å¯¼è‡´çš„è¿˜æ˜¯CPUæ•°æ®è¿ç®—å¯¼è‡´çš„ï¼Œè¿™æ—¶å€™ä¼šä½¿ç”¨åˆ°explainåˆ†æå‡ºå¸¸è§çš„sqlè¯­å¥ä¸­çš„é—®é¢˜ã€‚æ¯”å¦‚IOå¯¼è‡´ï¼Œå¯ä»¥ç´¢å¼•ä¼˜åŒ–ï¼Œæ·»åŠ ç´¢å¼•çš„è¦†ç›–èŒƒå›´ï¼Œæˆ–è€…æœ‰å¤šè¡¨æ“ä½œï¼Œä¸´æ—¶è¡¨è¿‡å¤šï¼Œè¿™ç±»çš„é—®é¢˜ï¼Œé‚£ä¹ˆåƒç´¢å¼•ä¼˜åŒ–æˆ‘ä»¬åº”è¯¥éµå¾ªæœ€å·¦åŒ¹é…ä¹ˆï¼Œé˜²æ­¢sqlè¯­å¥ç­›é€‰ä¼šå¤šæ¬¡å…¨è¡¨æŸ¥æ‰¾ï¼Œå¯ä»¥åœ¨å­—æ®µåŒ¹é…çš„æ—¶å€™æ³¨æ„æ•°æ®ç±»å‹ä¸€è‡´ï¼Œè€Œä¸”å°‘ç”¨æ¨¡ç³ŠåŒ¹é…ï¼Œå¦‚æœæ˜¯CPUæ•°æ®è¿ç®—å¯¼è‡´çš„ï¼Œé‚£è¦çœ‹åˆ†ç»„æ“ä½œå’Œæ’åºæ˜¯ä¸æ˜¯æœ‰é—®é¢˜ï¼Œå¹¶ä¸”è¦å‡å°‘å‡½æ•°çš„æ“ä½œï¼Œå› ä¸ºåº•å±‚éƒ½å¯èƒ½ä¼šæ¶‰åŠåˆ°å…¨è¡¨æŸ¥è¯¢ï¼Œå¿…è¦çš„æ—¶å€™ä¹Ÿå¯ä»¥åˆ†æ‰¹æŸ¥è¯¢ã€‚å†åé¢å°±æ˜¯å¯¹æ•°æ®åº“çš„é…ç½®äº†ï¼Œæ¯”å¦‚ç¼“å­˜æ± çš„å¤§å°ä¹‹ç±»çš„ï¼Œæˆ–è€…åˆ†åº“åˆ†è¡¨ è¯»å†™åˆ†ç¦»çš„æ“ä½œã€‚</p><p>ç´¢å¼•æ·»åŠ çš„æ—¶å€™ä¼˜å…ˆè€ƒè™‘åŸºæ•°å¤§çš„ï¼Œæˆ–è€…ç»å¸¸ä½œä¸ºæŸ¥è¯¢æ¡ä»¶çš„å­—æ®µä½œä¸ºç´¢å¼•ï¼Œå°±æ˜¯å”¯ä¸€æ€§çš„æ¯”å¦‚ç”¨æˆ·idï¼Œæˆ–è€…æŒ‰ç…§æœ€å·¦å‰ç¼€åŒ¹é…æ·»åŠ å¤åˆç´¢å¼•ç­‰ç­‰ã€‚åŒæ—¶è¦é¿å…å‡½æ•°åˆ—å’ŒçŠ¶æ€åˆ—ã€‚é¿å…ç»™ç»å¸¸æ›´æ–°çš„å­—æ®µæ·»åŠ ç´¢å¼•ï¼Œæˆ–è€…å”¯ä¸€æ€§ å¤ªå·®çš„å­—æ®µæ·»åŠ ç´¢å¼•ã€‚</p><p>ç”¨explainåˆ†æçš„æ—¶å€™å¯ä»¥æŸ¥çœ‹typeå’Œä¸€äº›ä¿¡æ¯ï¼Œå½“å‘ç°å…¨è¡¨æŸ¥è¯¢æˆ–è€…å…¨ç´¢å¼•æŸ¥è¯¢çš„æ—¶å€™ï¼Œæˆ–è€…keyä¸ºnullï¼Œæ‰«æè¡Œæ•°è¿‡é•¿ï¼Œæˆ–è€…ä¿¡æ¯ä¸Šè¯´æœ‰ä¸´æ—¶è¡¨ç­‰ç­‰ã€‚åƒwhereï¼Œjoinï¼Œgroup byè¿™äº›æ–¹æ³•ä½¿ç”¨çš„æ—¶å€™éƒ½éœ€è¦æ·»åŠ ç´¢å¼•äº†ã€‚</p><h2 id="ç´¢å¼•å¤±æ•ˆçš„åœºæ™¯">ç´¢å¼•å¤±æ•ˆçš„åœºæ™¯</h2><p>ç´¢å¼•åˆ—å‚ä¸äº†sqlæŸ¥è¯¢çš„è®¡ç®—æˆ–ä½¿ç”¨äº†å‡½æ•°ï¼ŒlikeåŒ¹é…ç”¨%å¼€å¤´ï¼ŒwhereåŒ¹é…çš„æ—¶å€™å­˜åœ¨éšå¼è½¬æ¢çš„é—®é¢˜ï¼Œç´¢å¼•åˆ—è¿›è¡Œäº†orè¿æ¥ï¼Œè¡¨éå¸¸å°ï¼Œå…¨è¡¨æ‰«ææ¯”ç´¢å¼•æŸ¥æ‰¾è¿˜å¿«çš„æ—¶å€™ï¼Œè¿˜æœ‰å°±æ˜¯ä½¿ç”¨groupåˆ†ç»„æˆ–è€…orderæ’åºçš„æ—¶å€™åˆ†ç»„å­—æ®µå’Œç´¢å¼•é¡ºåºä¸ä¸€è‡´ã€‚</p><h2 id="MySQLçš„äº‹åŠ¡">MySQLçš„äº‹åŠ¡</h2><p>MySQLçš„äº‹åŠ¡å°±æ˜¯æ•°æ®å¤„ç†çš„æ—¶å€™çš„ä¸€äº›åœºæ™¯ï¼Œéœ€è¦ä¿è¯ä¸€ç»„SQLè¯­å¥è¦ä¹ˆå…¨éƒ¨æ‰§è¡ŒæˆåŠŸè¦ä¹ˆæ‰§è¡Œå¤±è´¥ã€‚äº‹åŠ¡æœ‰å››å¤§ç‰¹æ€§ï¼Œé¦–å…ˆæ˜¯åŸå­æ€§ï¼ŒåŸå­æ€§å°±æ˜¯æ¯”å¦‚å½“Aç»™Bè½¬è´¦ï¼ŒAæ‰£é’±ï¼ŒBåŠ é’±ï¼ŒAæ‰£é’±äº†Bæ²¡æ”¶åˆ°é’±ï¼Œæˆ–è€…Bæ”¶åˆ°ï¼ŒAæ²¡æ‰£ï¼Œè¿™ç§æƒ…å†µMySQLä¼šå°†æ•°æ®å›æ»šã€‚ç¬¬äºŒä¸ªæ˜¯ä¸€è‡´æ€§ï¼Œäº‹åŠ¡æ‰§è¡Œå‰åï¼Œä¿æŒä¸€è‡´æ€§ï¼Œæ•°æ®ä¸è¢«ç ´åã€‚ç¬¬ä¸‰ä¸ªæ˜¯éš”ç¦»æ€§ï¼Œå½“å¤šä¸ªäº‹åŠ¡å¹¶å‘æ‰§è¡Œçš„æ—¶å€™ï¼Œäº‹åŠ¡ä¹‹é—´äº’ä¸å½±å“ã€‚æœ€åä¸€ä¸ªæ˜¯æŒä¹…æ€§ï¼Œå½“æ•°æ®åº“å‡ºç°æ–­ç”µ å´©æºƒç­‰é—®é¢˜çš„æ—¶å€™ï¼Œæ•°æ®ä¸ä¼šä¸¢å¤±ï¼Œåœ¨MySQLé‡Œæ˜¯é€šè¿‡redo logè®°å½•æé«˜çš„ä¿®æ”¹ï¼Œå‡ºç°å´©æºƒçš„æƒ…å†µæ—¶ï¼Œä¼šé€šè¿‡æ—¥å¿—æ¢å¤æ•°æ®ã€‚</p><h2 id="äº‹åŠ¡éš”ç¦»çº§åˆ«">äº‹åŠ¡éš”ç¦»çº§åˆ«</h2><p>æœ‰å››å¤§éš”ç¦»çº§åˆ«ï¼Œåˆ†åˆ«æ˜¯è¯»æœªæäº¤ï¼Œè¿™ä¸ªæ˜¯ä¸€ä¸ªäº‹åŠ¡è¯»å–äº†å¦ä¸€ä¸ªäº‹åŠ¡æ²¡æœ‰æäº¤çš„æ•°æ®ï¼Œä¼šå‡ºç°è„è¯»çš„é—®é¢˜ï¼Œæ¥ç€å°±æ˜¯è¯»å·²æäº¤ï¼Œå®ƒåªä¼šè¯»äº‹åŠ¡å·²ç»æäº¤çš„æ•°æ®ï¼Œå®ƒè§£å†³äº†è„è¯»çš„é—®é¢˜ï¼Œæé«˜äº†æ•°æ®ä¸€è‡´æ€§ï¼Œä½†æ˜¯å‡ºç°äº†ä¸å¯é‡å¤è¯»çš„é—®é¢˜ï¼Œå¤šæ¬¡è¯»å–çš„ç»“æœä¸ä¸€æ ·ï¼Œç„¶åå°±æ˜¯RRå¯é‡å¤è¯»ï¼Œè§£å†³äº†è„è¯»å’Œä¸å¯é‡å¤è¯»çš„é—®é¢˜ã€‚è¿˜æœ‰ä¸€ä¸ªä¸²è¡ŒåŒ–ï¼Œè¿™ä¸ªåŸºæœ¬å°±æ˜¯æŠŠäº‹åŠ¡è¿›è¡Œä¸²è¡Œå¤„ç†ï¼Œå°±ä¸ä¼šå‡ºç°å¹¶å‘çš„æ—¶å€™å‡ºç°çš„å„ç§äº‹åŠ¡é—®é¢˜ã€‚</p><h2 id="MVCC">MVCC</h2><p>MVCCå®ç°äº†è¯»å·²æäº¤å’Œå¯é‡å¤è¯»ä¸¤ä¸ªäº‹åŠ¡éš”ç¦»çº§åˆ«ï¼ŒMVCCæ˜¯å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼Œå°±å’Œå®ƒçš„åå­—ä¸€æ ·ï¼Œæ˜¯é€šè¿‡å¤šç‰ˆæœ¬çš„å½¢å¼è§£å†³å¹¶å‘é—®é¢˜ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ— é”çš„æœºåˆ¶ï¼Œå› ä¸ºmysqlç»å¸¸è¦è¯»ï¼Œå¦‚æœå› ä¸ºå…¶ä»–çº¿ç¨‹çš„å†™æ“ä½œï¼Œä¸Šé”äº†å¯¼è‡´è¯»æ“ä½œéœ€è¦é˜»å¡ç­‰å¾…ï¼Œè¿™æ ·æ•ˆç‡éå¸¸å·®ï¼Œæ‰€ä»¥å‡ºç°äº†MVCCï¼Œå½“äº‹åŠ¡å¿«ç…§è¯»çš„æ—¶å€™ï¼Œå°†æ•°æ®è¿›è¡Œä¸€ä¸ªå¿«ç…§ï¼Œä¼šç”Ÿæˆä¸€ä¸ªreadviewè§†å›¾ï¼ŒMVCCä¼šåœ¨çº¿ç¨‹ä¿®æ”¹åˆ é™¤æ•°æ®çš„æ—¶å€™ï¼Œä¼šç”Ÿæˆä¸€ä¸ªundo logï¼Œæ–¹ä¾¿å›æ»šçš„æ•°æ®ï¼Œå¦‚æœæœ‰çº¿ç¨‹æ‰§è¡ŒæŸ¥è¯¢æ•°æ®çš„æ—¶å€™ï¼Œä¼šæŒ‰ç…§è§„åˆ™åˆ¤æ–­æ•°æ®æœ‰æ²¡æœ‰è¢«å…¶ä»–çº¿ç¨‹æ›´æ”¹ï¼Œåœ¨æŸ¥æ•°æ®çš„è¿‡ç¨‹ä¸­è¢«ä¿®æ”¹äº†ï¼ŒMySQLä¼šè¿›è¡Œä¸€ä¸ªidçš„åˆ¤æ–­ï¼Œä»–ä¼šä»å¿«ç…§ä¸­æ‰¾ï¼Œå½“æ—¶å®ƒæ‰§è¡ŒæŸ¥è¯¢å‘½ä»¤çš„æ—¶å€™çš„æ•°æ®ï¼Œè¿™æ ·å°±å°†å¤šçº¿ç¨‹å¹¶å‘é—®é¢˜å¯¼è‡´æ•°æ®ä¸ä¸€è‡´é—®é¢˜è¿›è¡Œäº†è§£å†³ï¼Œå¹¶ä¸”ä¸ä¼šå½±å“æ€§èƒ½ã€‚</p><h2 id="MySQLçš„é”ï¼ˆæœªè§£å†³ï¼‰">MySQLçš„é”ï¼ˆæœªè§£å†³ï¼‰</h2><h2 id="SQL-åˆ†é¡µ-limit-500000-10å’Œ-limit-10-é€Ÿåº¦ä¸€è‡´ï¼Ÿ">SQL åˆ†é¡µ limit 500000,10å’Œ limit 10 é€Ÿåº¦ä¸€è‡´ï¼Ÿ</h2><p><strong>ä¸ä¸€è‡´</strong>ã€‚limit50000 10 éœ€è¦è·³è¿‡å‰é¢50wè¡Œï¼Œå†å–æ•°æ®ï¼Œæ•°æ®åº“éœ€æ‰«æ 500010 è¡Œï¼Œå†ä¸¢å¼ƒå‰ 500000 è¡Œï¼Œè€—æ—¶è¿œé«˜äº ç›´æ¥å–å‰ 10 è¡Œã€‚åç§»é‡è¶Šå¤§ï¼Œæ€§èƒ½è¶Šå·®ã€‚</p><h2 id="æ•°æ®åº“ä¸­ç´¢å¼•ç±»å‹æœ‰å“ªäº›">æ•°æ®åº“ä¸­ç´¢å¼•ç±»å‹æœ‰å“ªäº›</h2><h3 id="1-B-Tree-ç´¢å¼•">1. <strong>B-Tree ç´¢å¼•</strong></h3><ul><li><strong>ç‰¹ç‚¹</strong>ï¼šæœ€å¸¸ç”¨çš„ç´¢å¼•ç±»å‹ï¼ŒåŸºäº B + æ ‘ç»“æ„å®ç°ï¼Œæ”¯æŒç­‰å€¼æŸ¥è¯¢ï¼ˆ<code>WHERE col = value</code>ï¼‰ã€èŒƒå›´æŸ¥è¯¢ï¼ˆ<code>WHERE col BETWEEN a AND b</code>ï¼‰å’Œæ’åºï¼ˆ<code>ORDER BY</code>ï¼‰ã€‚</li><li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šå‡ ä¹æ‰€æœ‰åœºæ™¯ï¼Œç‰¹åˆ«æ˜¯èŒƒå›´æŸ¥è¯¢ã€‚</li><li><strong>æ”¯æŒå¼•æ“</strong>ï¼šInnoDBã€MyISAMã€Memory ç­‰ã€‚</li></ul><h3 id="2-å“ˆå¸Œç´¢å¼•">2. <strong>å“ˆå¸Œç´¢å¼•</strong></h3><ul><li><strong>ç‰¹ç‚¹</strong>ï¼šåŸºäºå“ˆå¸Œè¡¨å®ç°ï¼Œä»…æ”¯æŒç­‰å€¼æŸ¥è¯¢ï¼ˆ<code>=</code>ã€<code>IN()</code>ï¼‰ï¼Œä¸æ”¯æŒèŒƒå›´æŸ¥è¯¢ã€‚</li><li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šå†…å­˜è¡¨ï¼ˆMemory å¼•æ“é»˜è®¤ä½¿ç”¨ï¼‰æˆ– InnoDB çš„è‡ªé€‚åº”å“ˆå¸Œç´¢å¼•ï¼ˆç”±å¼•æ“è‡ªåŠ¨åˆ›å»ºï¼‰ã€‚</li><li><strong>æ”¯æŒå¼•æ“</strong>ï¼šMemoryã€InnoDBï¼ˆè‡ªé€‚åº”å“ˆå¸Œç´¢å¼•ï¼‰ã€‚</li></ul><h3 id="3-å…¨æ–‡ç´¢å¼•">3. <strong>å…¨æ–‡ç´¢å¼•</strong></h3><ul><li><p><strong>ç‰¹ç‚¹</strong>ï¼šä¸“é—¨ç”¨äºæ–‡æœ¬æœç´¢ï¼Œæ”¯æŒ<code>MATCH AGAINST</code>è¯­æ³•ã€‚</p></li><li><p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šæ–‡ç« å†…å®¹ã€è¯„è®ºç­‰å¤§æ–‡æœ¬å­—æ®µçš„æœç´¢ã€‚</p></li><li><p><strong>æ”¯æŒå¼•æ“</strong>ï¼šInnoDBï¼ˆMySQL 5.6+ï¼‰ã€MyISAMã€‚</p></li><li><p>ç¤ºä¾‹</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> articles <span class="keyword">WHERE</span> <span class="keyword">MATCH</span>(content) AGAINST(<span class="string">&#x27;å…³é”®è¯&#x27;</span> <span class="keyword">IN</span> <span class="keyword">NATURAL</span> <span class="keyword">LANGUAGE</span> MODE);</span><br></pre></td></tr></table></figure></li></ul><h3 id="4-ç©ºé—´ç´¢å¼•">4. <strong>ç©ºé—´ç´¢å¼•</strong></h3><ul><li><strong>ç‰¹ç‚¹</strong>ï¼šç”¨äºå­˜å‚¨å’ŒæŸ¥è¯¢ç©ºé—´æ•°æ®ï¼ˆå¦‚åœ°ç†ä½ç½®ã€å‡ ä½•å½¢çŠ¶ï¼‰ã€‚</li><li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šåœ°å›¾åº”ç”¨ã€åœ°ç†ä¿¡æ¯ç³»ç»Ÿï¼ˆGISï¼‰ã€‚</li><li><strong>æ”¯æŒå¼•æ“</strong>ï¼šInnoDBã€MyISAMã€‚</li><li><strong>æ³¨æ„</strong>ï¼šéœ€è¦ä½¿ç”¨<code>SPATIAL</code>å…³é”®å­—åˆ›å»ºï¼Œä¸”å­—æ®µç±»å‹å¿…é¡»ä¸º<code>GEOMETRY</code>ã€<code>POINT</code>ç­‰ç©ºé—´ç±»å‹ã€‚</li></ul><h3 id="5-èšç°‡ç´¢å¼•ï¼ˆClustered-Indexï¼‰">5. <strong>èšç°‡ç´¢å¼•ï¼ˆClustered Indexï¼‰</strong></h3><ul><li><strong>ç‰¹ç‚¹</strong>ï¼šInnoDB å­˜å‚¨å¼•æ“ç‰¹æœ‰çš„ç´¢å¼•ç±»å‹ï¼Œæ•°æ®è¡Œç›´æ¥å­˜å‚¨åœ¨ç´¢å¼•çš„å¶å­èŠ‚ç‚¹ä¸­ã€‚</li><li><strong>ä¸»é”®å³èšç°‡ç´¢å¼•</strong>ï¼šæ¯ä¸ªè¡¨åªèƒ½æœ‰ä¸€ä¸ªèšç°‡ç´¢å¼•ï¼Œé€šå¸¸æ˜¯ä¸»é”®ã€‚å¦‚æœæ²¡æœ‰å®šä¹‰ä¸»é”®ï¼ŒInnoDB ä¼šé€‰æ‹©å”¯ä¸€éç©ºç´¢å¼•æˆ–ç”Ÿæˆéšè—çš„èšç°‡ç´¢å¼•ã€‚</li></ul><h3 id="6-è¾…åŠ©ç´¢å¼•ï¼ˆSecondary-Indexï¼‰">6. <strong>è¾…åŠ©ç´¢å¼•ï¼ˆSecondary Indexï¼‰</strong></h3><ul><li><strong>ç‰¹ç‚¹</strong>ï¼šé™¤èšç°‡ç´¢å¼•å¤–çš„æ‰€æœ‰ç´¢å¼•ï¼ˆå¦‚æ™®é€šç´¢å¼•ã€å”¯ä¸€ç´¢å¼•ï¼‰ï¼Œå¶å­èŠ‚ç‚¹å­˜å‚¨çš„æ˜¯ä¸»é”®å€¼ï¼ˆè€Œéæ•°æ®è¡Œï¼‰ã€‚</li><li><strong>å›è¡¨æŸ¥è¯¢</strong>ï¼šé€šè¿‡è¾…åŠ©ç´¢å¼•æŸ¥è¯¢æ•°æ®æ—¶ï¼Œå¯èƒ½éœ€è¦å…ˆæ‰¾åˆ°ä¸»é”®ï¼Œå†é€šè¿‡ä¸»é”®æŸ¥è¯¢å®Œæ•´æ•°æ®è¡Œã€‚</li></ul><h3 id="7-ç»„åˆç´¢å¼•ï¼ˆå¤åˆç´¢å¼•ï¼‰">7. <strong>ç»„åˆç´¢å¼•ï¼ˆå¤åˆç´¢å¼•ï¼‰</strong></h3><ul><li><p><strong>ç‰¹ç‚¹</strong>ï¼šåŸºäºå¤šä¸ªåˆ—åˆ›å»ºçš„ç´¢å¼•ï¼Œéµå¾ª â€œæœ€å·¦å‰ç¼€åŸåˆ™â€ã€‚</p></li><li><p>ç¤ºä¾‹</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> INDEX idx_name_age <span class="keyword">ON</span> users (name, age);</span><br><span class="line"><span class="comment">-- æ”¯æŒæŸ¥è¯¢ï¼šWHERE name = &#x27;å¼ ä¸‰&#x27; AND age = 20</span></span><br><span class="line"><span class="comment">-- æ”¯æŒæŸ¥è¯¢ï¼šWHERE name = &#x27;å¼ ä¸‰&#x27;ï¼ˆæœ€å·¦å‰ç¼€ï¼‰</span></span><br><span class="line"><span class="comment">-- ä¸æ”¯æŒæŸ¥è¯¢ï¼šWHERE age = 20ï¼ˆè·³è¿‡äº†nameåˆ—ï¼‰</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="8-å”¯ä¸€ç´¢å¼•ï¼ˆUnique-Indexï¼‰">8. <strong>å”¯ä¸€ç´¢å¼•ï¼ˆUnique Indexï¼‰</strong></h3><ul><li><p><strong>ç‰¹ç‚¹</strong>ï¼šç¡®ä¿ç´¢å¼•åˆ—çš„å€¼å”¯ä¸€ï¼Œå…è®¸<code>NULL</code>ï¼ˆä½†æ¯ä¸ª<code>NULL</code>è§†ä¸ºä¸åŒå€¼ï¼‰ã€‚</p></li><li><p>ç¤ºä¾‹</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">UNIQUE</span> INDEX idx_email <span class="keyword">ON</span> users (email);</span><br></pre></td></tr></table></figure></li></ul><h3 id="9-ä¸»é”®ç´¢å¼•ï¼ˆPrimary-Keyï¼‰">9. <strong>ä¸»é”®ç´¢å¼•ï¼ˆPrimary Keyï¼‰</strong></h3><ul><li><strong>ç‰¹ç‚¹</strong>ï¼šç‰¹æ®Šçš„å”¯ä¸€ç´¢å¼•ï¼Œä¸å…è®¸<code>NULL</code>ï¼Œæ¯ä¸ªè¡¨åªèƒ½æœ‰ä¸€ä¸ªä¸»é”®ã€‚</li><li><strong>èšç°‡ç´¢å¼•å…³è”</strong>ï¼šInnoDB ä¸­ä¸»é”®å³èšç°‡ç´¢å¼•ï¼Œå†³å®šæ•°æ®çš„ç‰©ç†å­˜å‚¨é¡ºåºã€‚</li></ul><h3 id="10-è¦†ç›–ç´¢å¼•ï¼ˆCovering-Indexï¼‰">10. <strong>è¦†ç›–ç´¢å¼•ï¼ˆCovering Indexï¼‰</strong></h3><ul><li><p><strong>ç‰¹ç‚¹</strong>ï¼šç´¢å¼•åŒ…å«æ‰€æœ‰æŸ¥è¯¢éœ€è¦çš„å­—æ®µï¼Œæ— éœ€å›è¡¨æŸ¥è¯¢æ•°æ®ã€‚</p></li><li><p>ç¤ºä¾‹</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> name, age <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> name <span class="operator">=</span> <span class="string">&#x27;å¼ ä¸‰&#x27;</span>;</span><br><span class="line"><span class="comment">-- è‹¥ç´¢å¼•åŒ…å«nameå’Œageï¼Œåˆ™ç›´æ¥é€šè¿‡ç´¢å¼•è¿”å›ç»“æœï¼Œæ— éœ€è®¿é—®æ•°æ®è¡Œã€‚</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="11-å‡½æ•°ç´¢å¼•ï¼ˆFunctional-Indexï¼‰">11. <strong>å‡½æ•°ç´¢å¼•ï¼ˆFunctional Indexï¼‰</strong></h3><ul><li><p><strong>ç‰¹ç‚¹</strong>ï¼šåŸºäºè¡¨è¾¾å¼æˆ–å‡½æ•°åˆ›å»ºçš„ç´¢å¼•ã€‚</p></li><li><p><strong>æ”¯æŒç‰ˆæœ¬</strong>ï¼šMySQL 5.7+ã€‚</p></li><li><p>ç¤ºä¾‹</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> INDEX idx_upper_name <span class="keyword">ON</span> users (<span class="built_in">UPPER</span>(name));</span><br><span class="line"><span class="comment">-- æ”¯æŒæŸ¥è¯¢ï¼šWHERE UPPER(name) = &#x27;ZHANGSAN;</span></span><br></pre></td></tr></table></figure></li></ul><h1 id="Redis">Redis</h1><h2 id="rediså’Œmqçš„æœºåˆ¶å’ŒåŸç†">rediså’Œmqçš„æœºåˆ¶å’ŒåŸç†</h2><ul><li><strong>Redis</strong>ï¼šä»¥ <strong>å†…å­˜å­˜å‚¨ + å•çº¿ç¨‹æ¨¡å‹</strong> ä¸ºåŸºç¡€ï¼Œé€šè¿‡é«˜æ•ˆæ•°æ®ç»“æ„ã€æŒä¹…åŒ–å’Œé›†ç¾¤æ–¹æ¡ˆï¼Œå®ç°é«˜é€Ÿç¼“å­˜ä¸åˆ†å¸ƒå¼èƒ½åŠ›ã€‚</li><li><strong>MQ</strong>ï¼šä»¥ <strong>ç”Ÿäº§è€… - é˜Ÿåˆ— - æ¶ˆè´¹è€…</strong> ä¸ºæ¨¡å‹ï¼Œé€šè¿‡å¼‚æ­¥è§£è€¦ã€æµé‡æ§åˆ¶å’ŒæŒä¹…åŒ–ï¼Œè§£å†³åˆ†å¸ƒå¼ç³»ç»Ÿçš„é€šä¿¡åä½œé—®é¢˜ã€‚<br>ä¸¤è€…å¸¸é…åˆï¼ˆå¦‚ Redis ç¼“å­˜åŠ é€Ÿï¼ŒMQ å¼‚æ­¥è§£è€¦ï¼‰ï¼Œæ„å»ºé«˜æ€§èƒ½ã€é«˜å¯é çš„åˆ†å¸ƒå¼æ¶æ„ã€‚</li></ul><h2 id="é…ç½®Redisæ—¶å€™è¦åºåˆ—åŒ–é…ç½®">é…ç½®Redisæ—¶å€™è¦åºåˆ—åŒ–é…ç½®</h2><p>å› ä¸ºå¦‚æœä¸é…ç½®åºåˆ—åŒ–å™¨ï¼ŒRedisTemplateä¼šä½¿ç”¨é»˜è®¤çš„åºåˆ—åŒ–å™¨ï¼ˆJdkSerializationRedisSerializerï¼‰ã€‚<br>é»˜è®¤åºåˆ—åŒ–å™¨çš„é—®é¢˜ï¼šåºåˆ—åŒ–åçš„æ•°æ®æ˜¯Javaç‰¹æœ‰çš„äºŒè¿›åˆ¶æ ¼å¼ï¼Œä¸å¯è¯»ä¸”ä¸é€šç”¨ã€‚åœ¨RedisConfigç±»ä¸­ï¼Œä½¿ç”¨äº†ä»¥ä¸‹åºåˆ—åŒ–å™¨ï¼šStringRedisSerializer</p><h2 id="Redisçš„ç¼“å­˜ä¸€è‡´æ€§">Redisçš„ç¼“å­˜ä¸€è‡´æ€§</h2><p>rediså’ŒMySQLçš„æ•°æ®ä¸€è‡´æ€§é—®é¢˜ï¼Œä¸»è¦è¦å›´ç»•ç€å†™æ“ä½œï¼Œå› ä¸ºåœ¨æ›´æ–°å’Œåˆ é™¤çš„æ—¶å€™ä¼šäº§ç”Ÿä¸€è‡´æ€§é—®é¢˜ï¼Œä¸€èˆ¬æ˜¯ç”¨æ—è·¯ç¼“å­˜æ¨¡å¼ï¼Œå®ƒåœ¨è¯»æ“ä½œçš„æ—¶å€™ä¼šå…ˆæŸ¥çœ‹ç¼“å­˜ä¸­æ•°æ®ï¼Œç¼“å­˜å‘½ä¸­çš„è¯è¿”å›ï¼Œå¦‚æœæ²¡æœ‰å°±æŸ¥æ•°æ®åº“ï¼Œå†å°†æ•°æ®å†™å…¥ç¼“å­˜ä¸­ï¼Œé‚£å†™æ“ä½œå®ƒæ˜¯å…ˆæ›´æ–°æ•°æ®åº“å†å°†ç¼“å­˜åˆ é™¤ã€‚è¿™æ ·å°±ä¿è¯äº†ä¸€è‡´æ€§ã€‚</p><h2 id="Redisçš„äºŒçº§ç¼“å­˜">Redisçš„äºŒçº§ç¼“å­˜</h2><p>åˆ†ä¸ºæœ¬åœ°ç¼“å­˜å’Œåˆ†å¸ƒå¼ç¼“å­˜ï¼Œæœ¬åœ°ç¼“å­˜å°±æ˜¯æ”¾åœ¨æœ¬åœ°å­˜å‚¨key valueï¼Œåˆ†å¸ƒå¼ç¼“å­˜ä¸€èˆ¬æ˜¯ç”¨äºè§£å†³æœ¬åœ°ç¼“å­˜æ— æ³•è·¨å®ä¾‹å…±äº«ç¼“å­˜çš„ä¸€è‡´æ€§å’Œç¼“å­˜ç©¿é€ å‡»ç©¿ é›ªå´©çš„é—®é¢˜ã€‚</p><h2 id="è®²ä¸€ä¸‹ç¼“å­˜ç©¿é€ï¼Œç¼“å­˜å‡»ç©¿ï¼Œç¼“å­˜é›ªå´©">è®²ä¸€ä¸‹ç¼“å­˜ç©¿é€ï¼Œç¼“å­˜å‡»ç©¿ï¼Œç¼“å­˜é›ªå´©</h2><p>ç¼“å­˜ç©¿é€å°±æ˜¯å› ä¸ºä¸€èˆ¬è®¾è®¡ä¸šåŠ¡çš„æ—¶å€™ï¼Œä¼šä¼˜å…ˆè®¿é—®ç¼“å­˜ä¸­æ•°æ®æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨è®¿é—®æ•°æ®åº“ï¼Œæ”»å‡»è€…å°±æ˜¯å¯ä»¥ç”¨è¿™ä¸€ç‚¹æ„é€ æ¶æ„è¯·æ±‚ï¼Œå¤šæ¬¡è®¿é—®æ•°æ®åº“ï¼Œå¯¼è‡´æ•°æ®åº“å‹åŠ›è¿‡å¤§ã€‚è¿™ç§æƒ…å†µå¯ä»¥å¯¹è®¿é—®è¯·æ±‚è¿›è¡Œåˆæ³•æ€§æ£€æŸ¥ï¼Œè¿‡æ»¤éæ³•å­—ç¬¦æˆ–è€…ä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨è¿‡æ»¤ï¼Œå†å†³å®šæ˜¯å¦è®¿é—®æ•°æ®åº“ã€‚æˆ–è€…ç»™redisè®¾ç½®nullå€¼æˆ–è€…ç©ºå­—ç¬¦ä¸²ã€‚</p><p>ç¼“å­˜å‡»ç©¿å°±æ˜¯å½“ç¼“å­˜æ•°æ®è¿‡æœŸæˆ–è€…å¤±æ•ˆçš„æ—¶å€™ï¼Œæ”»å‡»è€…å¹¶å‘è®¿é—®å¤±æ•ˆæ•°æ®ï¼Œè¿™æ ·ä¼šç›´æ¥è®¿é—®æ•°æ®åº“ï¼Œå¯¼è‡´é«˜å¹¶å‘ï¼Œç»™æ•°æ®åº“é€ æˆå‹åŠ›ã€‚è§£å†³æ–¹å¼å¯ä»¥åœ¨ç¼“å­˜å¤±æ•ˆæˆ–è€…è¿‡æœŸå‰ï¼Œè¿›è¡Œé¢„æ›´æ–°æˆ–è€…å»¶è¿Ÿæ›´æ–°ï¼Œè®©æ”»å‡»è€…ä¸çŸ¥é“æ›´æ–°çš„æ—¶é—´ã€‚ç¬¬äºŒä¸ªå°±æ˜¯è§£å†³å¹¶å‘æ”»å‡»ï¼Œè¿™é‡Œå¯ä»¥ä½¿ç”¨é”ï¼Œäº’æ–¥é”å’Œåˆ†å¸ƒå¼é”ï¼Œè¿‡æœŸæˆ–è€…å¤±æ•ˆçš„æ—¶å€™æœ‰çº¿ç¨‹æ²¡æœ‰è®¿é—®åˆ°ç¼“å­˜ä¸­æ•°æ®ï¼Œåˆ™ç»™è¯¥çº¿ç¨‹ä¸€ä¸ªé”ï¼Œ è¿™ä¸ªæ—¶å€™å°±å¯ä»¥å¢åŠ ä¸€ä¸ªåˆ¤æ–­å¦‚æœæœ‰é”ï¼Œåˆ™æŸ¥è¯¢æ•°æ®ï¼ŒåŒæ—¶é‡Šæ”¾é”ï¼Œå¹¶å°†æ•°æ®æ›´æ–°åˆ°ç¼“å­˜ï¼Œå¦‚æœæ²¡æœ‰é”å°±çº¿ç¨‹ç­‰å¾…ã€‚æˆ–è€…é€»è¾‘è¿‡æœŸï¼Œæ·»åŠ é€»è¾‘æ—¶é—´å­—æ®µï¼Œå½“ç°åœ¨è¯·æ±‚æ¥å£çš„æ—¶å€™ï¼Œå…ˆåˆ¤æ–­å½“å‰æ—¶é—´æ˜¯å¦åœ¨è¿‡æœŸæ—¶é—´ä¹‹å‰ï¼Œå¦‚æœæœªè¿‡æœŸï¼Œå°†æ•°æ®ç›´æ¥è¿”å›ï¼Œå¦‚æœè¿‡æœŸäº†ï¼Œè¿›è¡Œç¼“å­˜é‡å»ºï¼ŒåŠ ä¸Šäº’æ–¥é”ï¼Œé‡æ–°æŸ¥æ‰¾ä¸€æ¬¡æ•°æ®åº“ï¼Œå°è£…æ–°çš„è¿‡æœŸæ—¶é—´ï¼Œå°†æ•°æ®æ”¾å…¥ç¼“å­˜ä¸­ã€‚é‚£ä¹ˆåœ¨è¿‡æœŸæ—¶é—´ä»¥åçš„æ‰€æœ‰çº¿ç¨‹ï¼Œåªæœ‰æ‹¿åˆ°é”çš„çº¿ç¨‹è¿›è¡Œäº†ç¼“å­˜ä¿®æ”¹ï¼Œåé¢çº¿ç¨‹å‘ç°æ—¶é—´éƒ½æ²¡è¿‡æœŸï¼Œå°±æ‹¿ä¿®æ”¹åçš„æ•°æ®ã€‚æ‰€ä»¥ä¼šæœ‰ä¸€ä¸ªæ•°æ®ä¸€è‡´æ€§çš„é—®é¢˜ï¼Œåœ¨è¿‡æœŸæ—¶é—´å†…çš„æ•°æ®éƒ½æ˜¯æ—§æ•°æ®ã€‚</p><p>ç¼“å­˜é›ªå´©æ˜¯ç¼“å­˜ä¸­å¤§é‡çš„æ•°æ®å…¨éƒ¨å¤±æ•ˆï¼Œå¯¼è‡´éå¸¸å¤šçš„è¯·æ±‚ç›´æ¥è®¿é—®æ•°æ®åº“ï¼Œå¯¼è‡´æ•°æ®åº“å‹åŠ›å‰§å¢ã€‚æœ€ç®€å•çš„æ˜¯ç»™æ¯ä¸ªkeyçš„TTLå¢åŠ éšæœºå€¼ï¼Œç¼“å­˜é¢„çƒ­çš„æ—¶å€™ç»™ç¼“å­˜æ•°æ®çš„è®¾ç½®è¿‡æœŸæ—¶é—´TTLçš„æ—¶å€™å®šä¹‰ä¸€ä¸ªèŒƒå›´ï¼Œè¿½åŠ è¯¥èŒƒå›´çš„éšæœºæ•°ã€‚è¿™ç§æƒ…å†µä¸€èˆ¬ä½¿ç”¨åˆ†å¸ƒå¼é›†ç¾¤æé«˜å¯é æ€§æˆ–è€…é™æµï¼Œè¦ä¹ˆå¤šçº§ç¼“å­˜ã€‚</p><h2 id="Redisçš„åˆ†å¸ƒå¼é”">Redisçš„åˆ†å¸ƒå¼é”</h2><p>é€šè¿‡SetNxå‘½ä»¤å®ç°ï¼Œå½“å®¢æˆ·ç«¯å°è¯•ä½¿ç”¨<code>SETNX</code>å‘½ä»¤è®¾ç½®ä¸€ä¸ªç‰¹å®šçš„keyï¼Œå€¼å¯ä»¥æ˜¯ä»»æ„å”¯ä¸€æ ‡è¯†å®¢æˆ·ç«¯çš„å­—ç¬¦ä¸²ï¼Œä¼šè¿”å›ä¸€ä¸ªtrueè¡¨ç¤ºåŠ é”æˆåŠŸï¼Œè¿™æ ·å…¶ä»–çš„å®¢æˆ·ç«¯å°±ä¸èƒ½å†è®¿é—®è¿™ä¸ªkeyäº†ã€‚å½“è¯¥å®¢æˆ·ç«¯ä½¿ç”¨å®Œæˆ–è€…è¿‡æœŸæ—¶é—´åˆ°äº†ï¼Œä¼šåˆ é™¤è¿™ä¸ªkeyè¿™ä¸ªé”å°±é‡Šæ”¾äº†ã€‚è¿‡æœŸæ—¶é—´çš„è®¾ç½®ä¼šç”¨ä¸€ä¸ªçœ‹é—¨ç‹—çš„æœºåˆ¶ï¼Œåœ¨javaä¸­ä½¿ç”¨redissonçš„é”å®ç°ï¼Œä¼šè‡ªåŠ¨å¤„ç†é”çš„ç»­æœŸã€å¯é‡å…¥ç­‰é—®é¢˜ï¼Œè¿˜æ”¯æŒå…¬å¹³é”ã€è”é”ã€çº¢é”ç­‰æ›´å¤æ‚çš„åˆ†å¸ƒå¼é”åœºæ™¯ã€‚</p><h2 id="ä¸‰ç§åˆ†å¸ƒå¼é”çš„åŒºåˆ«">ä¸‰ç§åˆ†å¸ƒå¼é”çš„åŒºåˆ«</h2><h2 id="å“¨å…µæœºåˆ¶">å“¨å…µæœºåˆ¶</h2><h2 id="åœºæ™¯é¢˜">åœºæ™¯é¢˜</h2><h2 id="ç”¨æˆ·ç™»å½•çš„æµç¨‹å¼€å‘">ç”¨æˆ·ç™»å½•çš„æµç¨‹å¼€å‘</h2><p>ç”¨æˆ·é€šè¿‡å‰ç«¯è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ï¼Œæˆ–è€…æ‰«ç ï¼Œæ‰‹æœºå·ç­‰æ–¹å¼è¿›è¡Œç™»é™†ã€‚åç«¯æ¥å—åˆ°æ•°æ®ï¼Œè¿›è¡ŒéªŒè¯ï¼ŒéªŒè¯æˆåŠŸä¼šç”Ÿæˆä¸€ä¸ªtokenï¼Œé‚£ä¸€èˆ¬æˆ‘ä»¬ä¸ºäº†é˜²æ­¢æ³„æ¼ï¼Œæˆ‘ä»¬ä¼šå°†tokenè¿”å›ï¼ŒåŒæ—¶å¯¹tokenè¿›è¡Œä¸€ä¸ªåŠ å¯†ï¼Œç”Ÿæˆæˆ‘ä»¬æ‰€è°“çš„jwtä»¤ç‰Œã€‚æˆ‘ä¼šé€‰æ‹©è®¾ç½®jwtä»¤ç‰Œçš„è¿‡æœŸæ—¶é—´ï¼Œæ”¾åœ¨redisä¸­ï¼Œåç»­ç”¨æˆ·è¿›è¡Œä¸€ç³»åˆ—æ“ä½œçš„æ—¶å€™ï¼Œæˆ‘ä¼šè®¾ç½®ä¸€ä¸ªæ‹¦æˆªå™¨ï¼Œå°†ç”¨æˆ·æŒæœ‰çš„tokenå’Œjwtä»¤ç‰Œè¿›è¡Œæ ¡éªŒï¼Œæ ¡éªŒé€šè¿‡æ­£å¸¸æ“ä½œï¼Œä¸é€šè¿‡è¿”å›tokenè¿‡æœŸï¼Œé‡æ–°ç™»å½•ã€‚tokenè¿‡æœŸè¿™é‡Œçœ‹ä¸šåŠ¡éœ€æ±‚ï¼Œå¦‚æœç”²æ–¹è¦æ±‚ï¼Œç”¨æˆ·åœ¨æ“ä½œçš„æ—¶å€™ä¸è¦è¿‡æœŸï¼Œé‚£ä¹ˆå°±åœ¨ç”¨æˆ·å¸¦ç€tokenè®¿é—®å…¶ä»–ç½‘é¡µçš„æ—¶å€™ï¼Œè¿›è¡Œä¸€ä¸ªjwtä»¤ç‰Œçš„è¿‡æœŸæ—¶é—´åˆ·æ–°ï¼Œå½“é•¿æ—¶é—´åœ¨ä¸€ä¸ªé¡µé¢æ²¡æ“ä½œçš„æ—¶å€™ï¼Œè¿‡æœŸæ—¶é—´åˆ°äº†ï¼Œå°±è·³è½¬ç™»å½•ç•Œé¢é‡æ–°ç™»å½•ï¼Œæˆ–è€…å›åˆ°ä¸ç”¨ç™»å½•çš„é¦–é¡µã€‚</p><h2 id="Tokenå¦‚ä½•ç»­è´¹">Tokenå¦‚ä½•ç»­è´¹</h2><p>å¯ä»¥é€šè¿‡åˆ·æ–°ä»¤ç‰Œçš„æ–¹å¼è¡Œç»­è´¹ï¼Œå½“ç”¨æˆ·çš„ç™»å½•çš„æ—¶å€™ï¼Œæˆ‘ä»¬åç«¯æ‹¿åˆ°ä¸€ä¸ªè®¿é—®ä»¤ç‰Œå’Œåˆ·æ–°ä»¤ç‰Œï¼Œå½“è®¿é—®ä»¤ç‰Œå¤±æ•ˆäº†ï¼Œè¾¾åˆ°æˆ‘ä»¬è®¾ç½®çš„å¤±æ•ˆæ—¶é—´äº†ï¼Œè¿˜è¦è¯·æ±‚è®¿é—®çš„æ—¶å€™ï¼Œå°±å¯ä»¥é€šè¿‡åˆ·æ–°ä»¤ç‰Œï¼Œè¯·æ±‚æ–°çš„è®¿é—®ä»¤ç‰Œç»™ç”¨æˆ·ã€‚</p><h1 id="é¡¹ç›®éš¾ç‚¹äº®ç‚¹">é¡¹ç›®éš¾ç‚¹äº®ç‚¹</h1><h2 id="execlå¯¼å…¥">execlå¯¼å…¥</h2><h2 id="execlå¯¼å‡º">execlå¯¼å‡º</h2><p>ç”¨äº†execlwriteç±»ï¼Œæˆ‘å…ˆè¿›è¡Œäº†åˆ†æ‰¹æŸ¥è¯¢æ•°æ®åº“ï¼Œæ„é€ ä¸åŒçš„sheeté¡µï¼Œæœ€åå¯¼å‡ºæ•°æ®åˆ°sheeté¡µä¸­ï¼Œä¸­é—´åŠ åŒæ­¥é”ã€‚ç„¶åæŠŠåˆšåˆšçš„å¼‚æ­¥ä»»åŠ¡æ”¾åˆ°çº¿ç¨‹æ± é‡Œé¢ï¼Œç­‰ä»»åŠ¡æ‰§è¡Œå®Œåˆ·æ–°æµå¹¶å…³é—­æµã€‚å®ç°å¤šçº¿ç¨‹å¯¼å‡ºä¼˜åŒ–å¯¼å‡ºæ•ˆç‡ã€‚</p><h2 id="å¤šç«¯æ“ä½œåŒä¸€ä¸ªæ•°æ®">å¤šç«¯æ“ä½œåŒä¸€ä¸ªæ•°æ®</h2><h2 id="JVMè°ƒä¼˜">JVMè°ƒä¼˜</h2><h2 id="å¿ƒè·³æœºåˆ¶">å¿ƒè·³æœºåˆ¶</h2><h2 id="MySQLæ­»é”">MySQLæ­»é”</h2><h2 id="æ‹¦æˆªå™¨-Filter-å’Œè¿‡æ»¤å™¨-interceptor">æ‹¦æˆªå™¨(Filter)å’Œè¿‡æ»¤å™¨(interceptor)</h2><p>è¿‡æ»¤å™¨æ˜¯åœ¨web.xmlè¿›è¡Œé…ç½®çš„å¹¶ä¸”ä¾èµ–servletå®¹å™¨ï¼Œè€Œæ‹¦æˆªå™¨æ˜¯åœ¨springçš„é…ç½®æ–‡ä»¶ä¸­æˆ–è€…é€šè¿‡æ³¨è§£çš„æ–¹å¼é…ç½®ä¸ä¾èµ–servletå®¹å™¨ã€‚è¿‡æ»¤å™¨åªèƒ½è¿‡æ»¤requestå’Œresponseè¯·æ±‚ï¼Œè€Œæ‹¦æˆªå™¨å¤šäº†ä¸€äº›springMVCçš„ä¸€äº›è¯·æ±‚æ–¹å¼ï¼Œæ¯”å¦‚handlerå’Œexceptionè¿›è¡Œæ“ä½œã€‚åœ¨æ‰§è¡Œé¡ºåºä¹Ÿæœ‰åŒºåˆ«ï¼ŒFilteræ˜¯åœ¨servletå®¹å™¨æ¥æ”¶åˆ°è¯·æ±‚ï¼Œä½†æ˜¯æ²¡è¢«è°ƒç”¨çš„æ—¶å€™ä½¿ç”¨ï¼Œinterceptoræ˜¯åœ¨servletè°ƒç”¨ä»¥åï¼Œå“åº”è¿˜æ²¡å‘é€åˆ°å®¢æˆ·ç«¯ä¹‹å‰è¿è¡Œçš„ã€‚</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/image-20250801172121578.png" alt="image-20250801172121578"></p><h2 id="å†…å­˜æº¢å‡ºé—®é¢˜">å†…å­˜æº¢å‡ºé—®é¢˜</h2><h2 id="spring">spring</h2><h2 id="spring-bean">spring bean</h2><h2 id="ioc-aop">ioc aop</h2><h2 id="äº‹åŠ¡ç®¡ç†">äº‹åŠ¡ç®¡ç†</h2><h2 id="springboot">springboot</h2><h1 id="ä¸šåŠ¡ç±»">ä¸šåŠ¡ç±»</h1><h2 id="PO-DOã€DTOã€VOã€BO">PO/DOã€DTOã€VOã€BO</h2><p>ä¸€ä¸ªDOç±»å¯¹åº”çš„æ•°æ®åº“çš„è¡¨ç»“æ„ï¼Œå­—æ®µåå’Œè¡¨åå¯¹åº”ï¼Œä¸€èˆ¬æ˜¯ç±»é€šè¿‡é©¼å³°å‘½åæ³•ã€‚DTOæ˜¯å‰ç«¯è¿”å›ç»™åç«¯çš„æ•°æ®å°è£…çš„ç±»ï¼Œç”¨äºæ¥å—å‰ç«¯æ•°æ®ï¼ŒVOåˆ™æ˜¯è¿”å›å‰ç«¯æ‰€éœ€è¦çš„ç±»ã€‚BOæ˜¯å½“æˆ‘ä»¬æ­£å¸¸ç¼–å†™ä»£ç ï¼Œç»å¸¸éœ€è¦è‡ªå·±å­˜å‚¨ä¸€äº›ç›¸åŒçš„æ•°æ®çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥é€‰åˆ™è‡ªå·±æ–°å»ºä¸€ä¸ªç±»ï¼Œç”¨äºå­˜æ”¾ä¸€äº›å¸¸ç”¨å‚æ•°ï¼Œå¯ä»¥ä¼˜åŒ–ä»£ç ã€‚</p><h1 id="å¤§æ•°æ®">å¤§æ•°æ®</h1><h2 id="Hadoopæ€ä¹ˆé…ç½®æµç¨‹-éœ€è¦æ”¹ä»€ä¹ˆæ–‡ä»¶">Hadoopæ€ä¹ˆé…ç½®æµç¨‹ éœ€è¦æ”¹ä»€ä¹ˆæ–‡ä»¶</h2><ol><li><strong>åŸºç¡€ç¯å¢ƒå‡†å¤‡</strong>ï¼š<ul><li>å®‰è£… Java å¹¶é…ç½®<code>JAVA_HOME</code>ç¯å¢ƒå˜é‡ã€‚</li><li>é…ç½® SSH æ— å¯†ç ç™»å½•ã€‚</li></ul></li><li><strong>æ ¸å¿ƒé…ç½®æ–‡ä»¶ä¿®æ”¹</strong>ï¼ˆä½äº<code>$HADOOP_HOME/etc/hadoop</code>ç›®å½•ï¼‰ï¼š<ul><li><code>core-site.xml</code>ï¼šé…ç½® Hadoop æ ¸å¿ƒå‚æ•°ï¼Œå¦‚ HDFS çš„ NameNode åœ°å€ã€‚</li><li><code>hdfs-site.xml</code>ï¼šé…ç½® HDFS å‚æ•°ï¼Œå¦‚å‰¯æœ¬æ•°ã€æ•°æ®å­˜å‚¨ä½ç½®ã€‚</li><li><code>mapred-site.xml</code>ï¼šé…ç½® MapReduce å‚æ•°ï¼ŒæŒ‡å®šèµ„æºè°ƒåº¦æ¡†æ¶ã€‚</li><li><code>yarn-site.xml</code>ï¼šé…ç½® YARN å‚æ•°ï¼Œå¦‚ ResourceManager å’Œ NodeManager åœ°å€ã€‚</li></ul></li><li><strong>ç¯å¢ƒå˜é‡é…ç½®</strong>ï¼š<ul><li><code>hadoop-env.sh</code>ï¼šè®¾ç½® Hadoop è¿è¡Œç¯å¢ƒï¼Œå¦‚ Java è·¯å¾„ã€‚</li></ul></li></ol><h2 id="Hiveæ€ä¹ˆé…ç½®å¹¶å’Œmysqlè¿æ¥">Hiveæ€ä¹ˆé…ç½®å¹¶å’Œmysqlè¿æ¥</h2><ol><li><strong>åŸºç¡€é…ç½®</strong>ï¼š<ul><li>ä¿®æ”¹<code>hive-site.xml</code>ï¼Œé…ç½®å…ƒæ•°æ®å­˜å‚¨ä½ç½®ï¼š</li></ul></li><li><strong>ä¾èµ–å‡†å¤‡</strong>ï¼š<ul><li>å°† MySQL JDBCé©±åŠ¨ï¼ˆå¦‚<code>mysql-connector-java.jar</code>ï¼‰æ”¾å…¥ Hive çš„<code>lib</code>ç›®å½•ã€‚</li></ul></li><li><strong>åˆå§‹åŒ–å…ƒæ•°æ®åº“</strong>ï¼š<ul><li>æ‰§è¡Œ<code>schematool -initSchema -dbType mysql</code>åˆå§‹åŒ– MySQL å…ƒæ•°æ®åº“ã€‚</li></ul></li></ol><h1 id="éƒ¨ç½²">éƒ¨ç½²</h1><h2 id="ä¸ºä»€ä¹ˆä½¿ç”¨docker">ä¸ºä»€ä¹ˆä½¿ç”¨docker</h2><p>å› ä¸ºæˆ‘ä»¬ä¹‹å‰è¿™ä¸ªé¡¹ç›®æäº¤ç»™ç”²æ–¹çš„æ—¶å€™ï¼Œä»–æ˜¯åˆ†é…ç»™æˆ‘ä»¬ä¸€ä¸ªäº‘æœåŠ¡å™¨ï¼Œä»–åœ¨éªŒæ”¶çš„æ—¶å€™ä¼šé‡å¯æ‰€æœ‰çš„æœåŠ¡å™¨ï¼Œé‚£è¿™é‡Œå°±éœ€è¦è€ƒè™‘åˆ°ä¸€ä¸ªéƒ¨ç½²æŒä¹…åŒ–çš„é—®é¢˜ï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨äº†dockerï¼Œå°†æˆ‘ä»¬æœ¬åœ°æœåŠ¡å™¨çš„ä¾èµ–å’Œç¯å¢ƒæ‰“é•œåƒï¼Œè¿ç§»åˆ°ç”²æ–¹çš„äº‘æœåŠ¡å™¨ï¼Œå†™äº†è„šæœ¬åœ¨æœåŠ¡å™¨å¯åŠ¨åå°±è‡ªåŠ¨è¿è¡Œæˆ‘ä»¬çš„é¡¹ç›®ï¼ŒjaråŒ…ã€‚æ­£å¸¸ä½¿ç”¨dockeréƒ¨ç½²çš„åŸå› ï¼Œæ˜¯å®ƒçš„éƒ¨ç½²æ•ˆç‡é«˜å¹¶ä¸”æ–¹ä¾¿ç»´æŠ¤ï¼Œè¿˜æœ‰æŒä¹…åŒ–å•Šï¼Œæ•°æ®è¿ç§»éƒ½æ¯”è¾ƒæ–¹ä¾¿ï¼Œæ”¯æŒçš„æŠ€æœ¯æ ˆå’Œå…¼å®¹æ€§ä¹Ÿæ¯”è¾ƒå¥½ã€‚</p>]]></content>
    
    
    <summary type="html">å¸¸è§é¢è¯•é¢˜æ¢³ç†</summary>
    
    
    
    <category term="é¢è¯•" scheme="https://u7u7.top/categories/%E9%9D%A2%E8%AF%95/"/>
    
    
    <category term="Java" scheme="https://u7u7.top/tags/Java/"/>
    
    <category term="é¡¹ç›®" scheme="https://u7u7.top/tags/%E9%A1%B9%E7%9B%AE/"/>
    
    <category term="SpringBoot" scheme="https://u7u7.top/tags/SpringBoot/"/>
    
    <category term="Mysql" scheme="https://u7u7.top/tags/Mysql/"/>
    
    <category term="Redis" scheme="https://u7u7.top/tags/Redis/"/>
    
    <category term="Mybatis-plus" scheme="https://u7u7.top/tags/Mybatis-plus/"/>
    
    <category term="Mybatis" scheme="https://u7u7.top/tags/Mybatis/"/>
    
  </entry>
  
  <entry>
    <title>ä¼˜æ¢ç¤¾äº¤è´­äº‘å¹³å°</title>
    <link href="https://u7u7.top/posts/dp.html"/>
    <id>https://u7u7.top/posts/dp.html</id>
    <published>2025-07-28T03:00:25.000Z</published>
    <updated>2025-08-03T12:24:07.508Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ä¼˜æ¢ç¤¾äº¤è´­äº‘å¹³å°">ä¼˜æ¢ç¤¾äº¤è´­äº‘å¹³å°</h1><p>ä¸»è¦æ˜¯ä½¿ç”¨redis+Springboot+mysql+mybatis-plusçš„é¡¹ç›®ã€‚ç›®çš„æ˜¯é”»ç‚¼redisçš„ä½¿ç”¨å’Œå¼•å…¥æ¶ˆæ¯é˜Ÿåˆ—æ–¹ä¾¿å­¦ä¹ mqã€‚æ¶ˆæ¯é˜Ÿåˆ—éƒ¨åˆ†redisä½¿ç”¨streamæ¥å®ç°ã€‚</p><h2 id="ç§’æ€æ€»ç»“-é‡ç‚¹"><strong>ç§’æ€æ€»ç»“(é‡ç‚¹):</strong></h2><p>é¡¹ç›®ä¸­ç§’æ€åœºæ™¯æ˜¯ä½¿ç”¨å¯ä»¥æŠ¢è´­æŸä¸ªä¼˜æƒ åŠµã€‚ç§’æ€ä¼šå‡ºç°çš„æƒ…å†µï¼Œä¸€ç§’ä¼šæœ‰åƒä¸‡çš„ç”¨æˆ·åŒæ—¶ç‚¹å‡»ï¼Œè®¿é—®æ¥å£ã€‚ä¼šå­˜åœ¨çš„é—®é¢˜å¹¶è§£å†³ï¼š</p><ol><li>ä¿è¯è®¢å• ID å…¨å±€å”¯ä¸€ï¼Œé¿å…è§„å¾‹æ€§æ³„éœ²ä¸šåŠ¡æ•°æ®ï¼›</li><li>é˜²æ­¢åº“å­˜è¶…å–ï¼Œç¡®ä¿å®é™…å–å‡ºæ•°é‡ä¸è¶…è¿‡åº“å­˜ï¼›</li><li>åº”å¯¹é«˜å¹¶å‘è¯·æ±‚ï¼Œé¿å…æ•°æ®åº“å‹åŠ›è¿‡å¤§å¯¼è‡´ç³»ç»Ÿå´©æºƒã€‚</li></ol><p><strong>æ³¨æ„ï¼ï¼å¹¶å‘é‡‡ç”¨jmteræ¨¡æ‹Ÿ</strong></p><h3 id="1ã€ä¿è¯è®¢å•IDå…¨å±€å”¯ä¸€"><strong>1ã€ä¿è¯è®¢å•IDå…¨å±€å”¯ä¸€</strong></h3><p>è‹¥ä½¿ç”¨æ•°æ®åº“è‡ªå¢ IDï¼Œå­˜åœ¨ä¸¤ä¸ªç¼ºé™·ï¼š</p><ol><li>ID è§„å¾‹æ€§æ˜æ˜¾ï¼Œæ˜“è¢«çŒœæµ‹æ•æ„Ÿä¿¡æ¯ï¼ˆå¦‚æ¯æ—¥è®¢å•é‡ï¼‰</li><li>å•è¡¨æ•°æ®é‡è¿‡å¤§æ—¶éœ€æ‹†åº“æ‹†è¡¨ï¼Œè‡ªå¢ ID æ— æ³•ä¿è¯å…¨å±€å”¯ä¸€ã€‚</li></ol><p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šåŸºäº Redis å®ç°å…¨å±€å”¯ä¸€ ID ç”Ÿæˆå™¨</p><ul><li><p>ID ç»„æˆ</p><ul><li>ç¬¦å·ä½ï¼ˆ1bitï¼Œå›ºå®šä¸º 0ï¼‰ï¼›</li><li>æ—¶é—´æˆ³ï¼ˆ31bitï¼Œä»¥ç§’ä¸ºå•ä½ï¼Œå¯è¦†ç›– 69 å¹´ï¼‰ï¼›</li><li>åºåˆ—å·ï¼ˆ32bitï¼Œç§’å†…è®¡æ•°å™¨ï¼Œæ”¯æŒæ¯ç§’ç”Ÿæˆ 2Â³Â² ä¸ªå”¯ä¸€ IDï¼‰ã€‚</li></ul></li><li><p>å®ç°é€»è¾‘</p><ul><li><p>ç”Ÿæˆå½“å‰æ—¶é—´æˆ³ï¼ˆç›¸å¯¹äºèµ·å§‹æ—¶é—´æˆ³çš„åç§»é‡ï¼‰ï¼›</p></li><li><p>æŒ‰æ—¥æœŸç”Ÿæˆ Redis è‡ªå¢åºåˆ—å·ï¼ˆç¡®ä¿æ¯æ—¥åºåˆ—å·ç‹¬ç«‹ï¼‰ï¼›</p></li><li><p>æ‹¼æ¥æ—¶é—´æˆ³å’Œåºåˆ—å·ï¼Œç”Ÿæˆå…¨å±€å”¯ä¸€ IDã€‚</p></li></ul></li></ul><h3 id="2ã€è§£å†³è¶…å–é—®é¢˜">2ã€è§£å†³è¶…å–é—®é¢˜</h3><p>é—®é¢˜çš„äº§ç”Ÿï¼Œå¤§é‡è¯·æ±‚åŒæ—¶è®¿é—®æ•°æ®åº“ï¼Œåˆ¤æ–­å½“å‰å•†å“æœ‰åº“å­˜ï¼Œæ‰§è¡Œåº“å­˜æ‰£å‡çš„ä»£ç ï¼Œä¼šå¯¼è‡´è¶…å–ã€‚</p><p>è§£å†³çš„æ–¹å¼ï¼Œé€šè¿‡åç»­çš„æ›´æ–°ï¼Œå¯¹è¯¥æ–¹æ³•è¿›è¡Œäº†æ…¢æ…¢çš„ä¿®æ”¹ã€‚</p><h4 id="2-1-ä½¿ç”¨æ•°æ®åº“ä¹è§‚é”">2.1 ä½¿ç”¨æ•°æ®åº“ä¹è§‚é”</h4><p>åˆšå¼€å§‹é‡‡ç”¨ä¹è§‚é”ç‰ˆæœ¬æ§åˆ¶ï¼Œåœ¨æ•°æ®åº“å±‚é¢é€šè¿‡ç‰ˆæœ¬å·å’Œåº“å­˜åˆ¤æ–­æ¡ä»¶ç¡®ä¿æ‰£å‡åº“å­˜çš„åŸå­æ€§ï¼Œè§£å†³å¹¶å‘æ›´æ–°å¯¼è‡´è¶…å–ã€‚</p><details class="folding-tag" cyan close><summary> é€šè¿‡æ•°æ®åº“è§£å†³è¶…å–ä»£ç  </summary>              <div class='content'>              <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">seckillVoucherService.update().setSql(<span class="string">&quot;stock= stock -1&quot;</span>).eq(<span class="string">&quot;voucher_id&quot;</span>, voucherId)</span><br><span class="line">    .update().gt(<span class="string">&quot;stock&quot;</span>,<span class="number">0</span>); <span class="comment">//where id = ? and stock &gt; 0</span></span><br></pre></td></tr></table></figure><p>åŸç†:</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/1653369268550.png" alt="1653369268550"></p>              </div>            </details><h3 id="3ã€è§£å†³ä¸€äººä¸€å•é—®é¢˜">3ã€è§£å†³ä¸€äººä¸€å•é—®é¢˜</h3><p>TODO ä¸€äººä¸€å•å­˜åœ¨çš„é—®é¢˜ï¼ŒåŒæ ·æ˜¯å¹¶å‘åœºæ™¯ä¼šå‡ºç°é—®é¢˜</p><h4 id="3-1-åˆå§‹ç‰ˆæ•°æ®åº“åˆ¤æ–­">3.1 åˆå§‹ç‰ˆæ•°æ®åº“åˆ¤æ–­</h4><p>è¿™ä¸ªå¦‚æœä¸è€ƒè™‘é«˜å¹¶å‘çš„åœºæ™¯ï¼Œæ¯”è¾ƒç®€å•ï¼Œåªéœ€è¦åˆ¤æ–­è®¢å•è¡¨ä¸­æ˜¯å¦å­˜åœ¨è¯¥ç”¨æˆ·idå°±å¥½ã€‚</p><details class="folding-tag" cyan close><summary> é€šè¿‡æ•°æ®åº“è§£å†³ä¸€äººä¸€å•é—®é¢˜ </summary>              <div class='content'>              <p><strong>è§£å†³</strong>ï¼šé‡ç‚¹å…¶å®åœ¨5çš„éƒ¨åˆ†ï¼Œç°åœ¨æ˜¯å…ˆé€šè¿‡æŸ¥è¯¢æ•°æ®åº“åˆ¤æ–­ç”¨æˆ·æ˜¯å¦ä¸‹è¿‡å•,å†å†³å®šæ˜¯å¦å¯ä»¥ä¸‹å•æ‰£é™¤åº“å­˜ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">seckillVoucher</span><span class="params">(Long voucherId)</span> &#123;</span><br><span class="line">    <span class="comment">// 1.æŸ¥è¯¢ä¼˜æƒ åˆ¸</span></span><br><span class="line">    <span class="type">SeckillVoucher</span> <span class="variable">voucher</span> <span class="operator">=</span> seckillVoucherService.getById(voucherId);</span><br><span class="line">    <span class="comment">// 2.åˆ¤æ–­ç§’æ€æ˜¯å¦å¼€å§‹</span></span><br><span class="line">    <span class="keyword">if</span> (voucher.getBeginTime().isAfter(LocalDateTime.now())) &#123;</span><br><span class="line">        <span class="comment">// å°šæœªå¼€å§‹</span></span><br><span class="line">        <span class="keyword">return</span> Result.fail(<span class="string">&quot;ç§’æ€å°šæœªå¼€å§‹ï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 3.åˆ¤æ–­ç§’æ€æ˜¯å¦å·²ç»ç»“æŸ</span></span><br><span class="line">    <span class="keyword">if</span> (voucher.getEndTime().isBefore(LocalDateTime.now())) &#123;</span><br><span class="line">        <span class="comment">// å°šæœªå¼€å§‹</span></span><br><span class="line">        <span class="keyword">return</span> Result.fail(<span class="string">&quot;ç§’æ€å·²ç»ç»“æŸï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 4.åˆ¤æ–­åº“å­˜æ˜¯å¦å……è¶³</span></span><br><span class="line">    <span class="keyword">if</span> (voucher.getStock() &lt; <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="comment">// åº“å­˜ä¸è¶³</span></span><br><span class="line">        <span class="keyword">return</span> Result.fail(<span class="string">&quot;åº“å­˜ä¸è¶³ï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 5.ä¸€äººä¸€å•é€»è¾‘</span></span><br><span class="line">    <span class="comment">// 5.1.ç”¨æˆ·id</span></span><br><span class="line">    <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> UserHolder.getUser().getId();</span><br><span class="line">    <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> query().eq(<span class="string">&quot;user_id&quot;</span>, userId).eq(<span class="string">&quot;voucher_id&quot;</span>, voucherId).count();</span><br><span class="line">    <span class="comment">// 5.2.åˆ¤æ–­æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">    <span class="keyword">if</span> (count &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// ç”¨æˆ·å·²ç»è´­ä¹°è¿‡äº†</span></span><br><span class="line">        <span class="keyword">return</span> Result.fail(<span class="string">&quot;ç”¨æˆ·å·²ç»è´­ä¹°è¿‡ä¸€æ¬¡ï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//6ï¼Œæ‰£å‡åº“å­˜</span></span><br><span class="line">    <span class="type">boolean</span> <span class="variable">success</span> <span class="operator">=</span> seckillVoucherService.update()</span><br><span class="line">            .setSql(<span class="string">&quot;stock= stock -1&quot;</span>)</span><br><span class="line">            .eq(<span class="string">&quot;voucher_id&quot;</span>, voucherId).update().gt(<span class="string">&quot;stock&quot;</span>,<span class="number">0</span>);;</span><br><span class="line">    <span class="keyword">if</span> (!success) &#123;</span><br><span class="line">        <span class="comment">//æ‰£å‡åº“å­˜</span></span><br><span class="line">        <span class="keyword">return</span> Result.fail(<span class="string">&quot;åº“å­˜ä¸è¶³ï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//7.åˆ›å»ºè®¢å•</span></span><br><span class="line">    <span class="type">VoucherOrder</span> <span class="variable">voucherOrder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">VoucherOrder</span>();</span><br><span class="line">    <span class="comment">// 7.1.è®¢å•id</span></span><br><span class="line">    <span class="type">long</span> <span class="variable">orderId</span> <span class="operator">=</span> redisIdWorker.nextId(<span class="string">&quot;order&quot;</span>);</span><br><span class="line">    voucherOrder.setId(orderId);</span><br><span class="line">    voucherOrder.setUserId(userId);</span><br><span class="line">    <span class="comment">// 7.3.ä»£é‡‘åˆ¸id</span></span><br><span class="line">    voucherOrder.setVoucherId(voucherId);</span><br><span class="line">    save(voucherOrder);</span><br><span class="line">    <span class="keyword">return</span> Result.ok(orderId);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å­˜åœ¨é—®é¢˜</strong>:ç°åœ¨çš„é—®é¢˜è¿˜æ˜¯å’Œä¹‹å‰ä¸€æ ·ï¼Œå¹¶å‘è¿‡æ¥ï¼ŒæŸ¥è¯¢æ•°æ®åº“ï¼Œéƒ½ä¸å­˜åœ¨è®¢å•ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜æ˜¯éœ€è¦åŠ é”ï¼Œä½†æ˜¯ä¹è§‚é”æ¯”è¾ƒé€‚åˆæ›´æ–°æ•°æ®ï¼Œè€Œç°åœ¨æ˜¯æ’å…¥æ•°æ®ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä½¿ç”¨æ‚²è§‚é”æ“ä½œ</p>              </div>            </details><p><strong>è§£å†³</strong>ï¼šé¦–å…ˆæˆ‘ä»¬çš„åˆå§‹æ–¹æ¡ˆæ˜¯å°è£…äº†ä¸€ä¸ªcreateVoucherOrderæ–¹æ³•ï¼ŒåŒæ—¶ä¸ºäº†ç¡®ä¿ä»–çº¿ç¨‹å®‰å…¨ï¼Œåœ¨æ–¹æ³•ä¸Šæ·»åŠ äº†ä¸€synchronized é”ã€‚å†åœ¨åŸæ–¹æ³•ä¸­è°ƒç”¨createVoucherOrderæ–¹æ³•ã€‚</p><details class="folding-tag" cyan close><summary> é€šè¿‡æ‚²è§‚é”è§£å†³ </summary>              <div class='content'>              <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">synchronized</span> Result <span class="title function_">createVoucherOrder</span><span class="params">(Long voucherId)</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> UserHolder.getUser().getId();</span><br><span class="line">         <span class="comment">// 5.1.æŸ¥è¯¢è®¢å•</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> query().eq(<span class="string">&quot;user_id&quot;</span>, userId).eq(<span class="string">&quot;voucher_id&quot;</span>, voucherId).count();</span><br><span class="line">        <span class="comment">// 5.2.åˆ¤æ–­æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">        <span class="keyword">if</span> (count &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// ç”¨æˆ·å·²ç»è´­ä¹°è¿‡äº†</span></span><br><span class="line">            <span class="keyword">return</span> Result.fail(<span class="string">&quot;ç”¨æˆ·å·²ç»è´­ä¹°è¿‡ä¸€æ¬¡ï¼&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 6.æ‰£å‡åº“å­˜</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">success</span> <span class="operator">=</span> seckillVoucherService.update()</span><br><span class="line">                .setSql(<span class="string">&quot;stock = stock - 1&quot;</span>) <span class="comment">// set stock = stock - 1</span></span><br><span class="line">                .eq(<span class="string">&quot;voucher_id&quot;</span>, voucherId).gt(<span class="string">&quot;stock&quot;</span>, <span class="number">0</span>) <span class="comment">// where id = ? and stock &gt; 0</span></span><br><span class="line">                .update();</span><br><span class="line">        <span class="keyword">if</span> (!success) &#123;</span><br><span class="line">            <span class="comment">// æ‰£å‡å¤±è´¥</span></span><br><span class="line">            <span class="keyword">return</span> Result.fail(<span class="string">&quot;åº“å­˜ä¸è¶³ï¼&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 7.åˆ›å»ºè®¢å•</span></span><br><span class="line">        <span class="type">VoucherOrder</span> <span class="variable">voucherOrder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">VoucherOrder</span>();</span><br><span class="line">        <span class="comment">// 7.1.è®¢å•id</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">orderId</span> <span class="operator">=</span> redisIdWorker.nextId(<span class="string">&quot;order&quot;</span>);</span><br><span class="line">        voucherOrder.setId(orderId);</span><br><span class="line">        <span class="comment">// 7.2.ç”¨æˆ·id</span></span><br><span class="line">        voucherOrder.setUserId(userId);</span><br><span class="line">        <span class="comment">// 7.3.ä»£é‡‘åˆ¸id</span></span><br><span class="line">        voucherOrder.setVoucherId(voucherId);</span><br><span class="line">        save(voucherOrder);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 7.è¿”å›è®¢å•id</span></span><br><span class="line">        <span class="keyword">return</span> Result.ok(orderId);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å­˜åœ¨é—®é¢˜</strong>:è¿™æ ·æ·»åŠ é”ï¼Œé”çš„ç²’åº¦å¤ªç²—äº†ï¼Œåœ¨ä½¿ç”¨é”è¿‡ç¨‹ä¸­ï¼Œæ§åˆ¶<strong>é”ç²’åº¦</strong> æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„äº‹æƒ…ï¼Œå› ä¸ºå¦‚æœé”çš„ç²’åº¦å¤ªå¤§ï¼Œä¼šå¯¼è‡´æ¯ä¸ªçº¿ç¨‹è¿›æ¥éƒ½ä¼šé”ä½ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å»æ§åˆ¶é”çš„ç²’åº¦</p>              </div>            </details><p><strong>è§£å†³</strong>ï¼šè¿™æ®µä»£ç éœ€è¦ä¿®æ”¹ä¸ºï¼šintern() è¿™ä¸ªæ–¹æ³•æ˜¯ä»å¸¸é‡æ± ä¸­æ‹¿åˆ°æ•°æ®ï¼Œå¦‚æœæˆ‘ä»¬ç›´æ¥ä½¿ç”¨userId.toString() ä»–æ‹¿åˆ°çš„å¯¹è±¡å®é™…ä¸Šæ˜¯ä¸åŒçš„å¯¹è±¡ï¼Œnewå‡ºæ¥çš„å¯¹è±¡ï¼Œæˆ‘ä»¬ä½¿ç”¨é”å¿…é¡»ä¿è¯é”å¿…é¡»æ˜¯åŒä¸€æŠŠï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä½¿ç”¨intern()æ–¹æ³•</p><details class="folding-tag" cyan close><summary> è§£å†³é”ç²’åº¦å¤ªç²—çš„é—®é¢˜ </summary>              <div class='content'>              <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span>  Result <span class="title function_">createVoucherOrder</span><span class="params">(Long voucherId)</span> &#123;</span><br><span class="line">    <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> UserHolder.getUser().getId();</span><br><span class="line">    <span class="keyword">synchronized</span>(userId.toString().intern())&#123;</span><br><span class="line">        <span class="comment">// 5.1.æŸ¥è¯¢è®¢å•</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> query().eq(<span class="string">&quot;user_id&quot;</span>, userId).eq(<span class="string">&quot;voucher_id&quot;</span>, voucherId).count();</span><br><span class="line">        <span class="comment">// 5.2.åˆ¤æ–­æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">        <span class="keyword">if</span> (count &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// ç”¨æˆ·å·²ç»è´­ä¹°è¿‡äº†</span></span><br><span class="line">            <span class="keyword">return</span> Result.fail(<span class="string">&quot;ç”¨æˆ·å·²ç»è´­ä¹°è¿‡ä¸€æ¬¡ï¼&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 6.æ‰£å‡åº“å­˜</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">success</span> <span class="operator">=</span> seckillVoucherService.update()</span><br><span class="line">            .setSql(<span class="string">&quot;stock = stock - 1&quot;</span>) <span class="comment">// set stock = stock - 1</span></span><br><span class="line">            .eq(<span class="string">&quot;voucher_id&quot;</span>, voucherId).gt(<span class="string">&quot;stock&quot;</span>, <span class="number">0</span>) <span class="comment">// where id = ? and stock &gt; 0</span></span><br><span class="line">            .update();</span><br><span class="line">        <span class="keyword">if</span> (!success) &#123;</span><br><span class="line">            <span class="comment">// æ‰£å‡å¤±è´¥</span></span><br><span class="line">            <span class="keyword">return</span> Result.fail(<span class="string">&quot;åº“å­˜ä¸è¶³ï¼&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 7.åˆ›å»ºè®¢å•</span></span><br><span class="line">        <span class="type">VoucherOrder</span> <span class="variable">voucherOrder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">VoucherOrder</span>();</span><br><span class="line">        <span class="comment">// 7.1.è®¢å•id</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">orderId</span> <span class="operator">=</span> redisIdWorker.nextId(<span class="string">&quot;order&quot;</span>);</span><br><span class="line">        voucherOrder.setId(orderId);</span><br><span class="line">        <span class="comment">// 7.2.ç”¨æˆ·id</span></span><br><span class="line">        voucherOrder.setUserId(userId);</span><br><span class="line">        <span class="comment">// 7.3.ä»£é‡‘åˆ¸id</span></span><br><span class="line">        voucherOrder.setVoucherId(voucherId);</span><br><span class="line">        save(voucherOrder);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 7.è¿”å›è®¢å•id</span></span><br><span class="line">        <span class="keyword">return</span> Result.ok(orderId);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å­˜åœ¨é—®é¢˜</strong>:å½“å‰æ–¹æ³•è¢«springçš„äº‹åŠ¡æ§åˆ¶ï¼Œå¦‚æœä½ åœ¨æ–¹æ³•å†…éƒ¨åŠ é”ï¼Œå¯èƒ½ä¼šå¯¼è‡´å½“å‰æ–¹æ³•äº‹åŠ¡è¿˜æ²¡æœ‰æäº¤ï¼Œä½†æ˜¯é”å·²ç»é‡Šæ”¾ä¹Ÿä¼šå¯¼è‡´é—®é¢˜ã€‚</p>              </div>            </details><p>è§£å†³ï¼šæˆ‘ä»¬é€‰æ‹©å°†å½“å‰æ–¹æ³•æ•´ä½“åŒ…è£¹èµ·æ¥ï¼Œç¡®ä¿äº‹åŠ¡ä¸ä¼šå‡ºç°é—®é¢˜ã€‚</p><details class="folding-tag" cyan close><summary> è§£å†³äº‹åŠ¡é—®é¢˜ </summary>              <div class='content'>              <p>åœ¨seckillVoucher æ–¹æ³•ä¸­ï¼Œæ·»åŠ ä»¥ä¸‹é€»è¾‘ï¼Œè¿™æ ·å°±èƒ½ä¿è¯äº‹åŠ¡çš„ç‰¹æ€§ï¼ŒåŒæ—¶ä¹Ÿæ§åˆ¶äº†é”çš„ç²’åº¦</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">synchronized</span> (userId.toString().intern())&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">this</span>.createVoucherOrder(voucherId);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯ä»¥ä¸Šåšæ³•ä¾ç„¶æœ‰é—®é¢˜ï¼Œå› ä¸ºä½ è°ƒç”¨çš„æ–¹æ³•ï¼Œå…¶å®æ˜¯this.çš„æ–¹å¼è°ƒç”¨çš„ï¼Œäº‹åŠ¡æƒ³è¦ç”Ÿæ•ˆï¼Œè¿˜å¾—åˆ©ç”¨ä»£ç†æ¥ç”Ÿæ•ˆï¼Œæ‰€ä»¥è¿™ä¸ªåœ°æ–¹ï¼Œæˆ‘ä»¬éœ€è¦è·å¾—åŸå§‹çš„äº‹åŠ¡å¯¹è±¡ï¼Œ æ¥æ“ä½œäº‹åŠ¡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">synchronized</span> (userId.toString().intern())&#123;</span><br><span class="line"><span class="type">ISeckillVoucherService</span> <span class="variable">proxy</span> <span class="operator">=</span> (ISeckillVoucherService) AopContext.currentProxy();</span><br><span class="line"><span class="keyword">return</span> proxy.createVoucherOrder(voucherId);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>              </div>            </details><h4 id="3-2-åˆ†å¸ƒå¼é”è§£å†³é”å¤±æ•ˆ">3.2 åˆ†å¸ƒå¼é”è§£å†³é”å¤±æ•ˆ</h4><p><strong>æœ‰å…³é”å¤±æ•ˆåŸå› åˆ†æ</strong></p><p>ç”±äºç°åœ¨æˆ‘ä»¬éƒ¨ç½²äº†å¤šä¸ªtomcatï¼Œæ¯ä¸ªtomcatéƒ½æœ‰ä¸€ä¸ªå±äºè‡ªå·±çš„jvmï¼Œé‚£ä¹ˆå‡è®¾åœ¨æœåŠ¡å™¨Açš„tomcatå†…éƒ¨ï¼Œæœ‰ä¸¤ä¸ªçº¿ç¨‹ï¼Œè¿™ä¸¤ä¸ªçº¿ç¨‹ç”±äºä½¿ç”¨çš„æ˜¯åŒä¸€ä»½ä»£ç ï¼Œé‚£ä¹ˆä»–ä»¬çš„é”å¯¹è±¡æ˜¯åŒä¸€ä¸ªï¼Œæ˜¯å¯ä»¥å®ç°äº’æ–¥çš„ï¼Œä½†æ˜¯å¦‚æœç°åœ¨æ˜¯æœåŠ¡å™¨Bçš„tomcatå†…éƒ¨ï¼Œåˆæœ‰ä¸¤ä¸ªçº¿ç¨‹ï¼Œä½†æ˜¯ä»–ä»¬çš„é”å¯¹è±¡å†™çš„è™½ç„¶å’ŒæœåŠ¡å™¨Aä¸€æ ·ï¼Œä½†æ˜¯é”å¯¹è±¡å´ä¸æ˜¯åŒä¸€ä¸ªï¼Œæ‰€ä»¥çº¿ç¨‹3å’Œçº¿ç¨‹4å¯ä»¥å®ç°äº’æ–¥ï¼Œä½†æ˜¯å´æ— æ³•å’Œçº¿ç¨‹1å’Œçº¿ç¨‹2å®ç°äº’æ–¥ï¼Œè¿™å°±æ˜¯ é›†ç¾¤ç¯å¢ƒä¸‹ï¼Œsyné”å¤±æ•ˆçš„åŸå› ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å°±éœ€è¦ä½¿ç”¨åˆ†å¸ƒå¼é”æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><p>åˆ†å¸ƒå¼é”ï¼šæ»¡è¶³åˆ†å¸ƒå¼ç³»ç»Ÿæˆ–é›†ç¾¤æ¨¡å¼ä¸‹å¤šè¿›ç¨‹å¯è§å¹¶ä¸”<strong>äº’æ–¥</strong>çš„é”ã€‚</p><p>åˆ†å¸ƒå¼é”çš„æ ¸å¿ƒæ€æƒ³å°±æ˜¯è®©å¤§å®¶éƒ½ä½¿ç”¨åŒä¸€æŠŠé”ï¼Œåªè¦å¤§å®¶ä½¿ç”¨çš„æ˜¯åŒä¸€æŠŠé”ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±èƒ½é”ä½çº¿ç¨‹ï¼Œä¸è®©çº¿ç¨‹è¿›è¡Œï¼Œè®©ç¨‹åºä¸²è¡Œæ‰§è¡Œï¼Œè¿™å°±æ˜¯åˆ†å¸ƒå¼é”çš„æ ¸å¿ƒæ€è·¯</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/1653374296906.png" alt="1653374296906"></p><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨setnxæ–¹æ³•ã€‚å½“æœ‰å¤šä¸ªçº¿ç¨‹è¿›å…¥æ—¶ï¼Œæˆ‘ä»¬å°±åˆ©ç”¨è¯¥æ–¹æ³•ï¼Œç¬¬ä¸€ä¸ªçº¿ç¨‹è¿›å…¥æ—¶ï¼Œredis ä¸­å°±æœ‰è¿™ä¸ªkey äº†ï¼Œè¿”å›äº†1ï¼Œå¦‚æœç»“æœæ˜¯1ï¼Œåˆ™è¡¨ç¤ºä»–æŠ¢åˆ°äº†é”ï¼Œé‚£ä¹ˆä»–å»æ‰§è¡Œä¸šåŠ¡ï¼Œç„¶åå†åˆ é™¤é”ï¼Œé€€å‡ºé”é€»è¾‘ï¼Œæ²¡æœ‰æŠ¢åˆ°é”çš„å“¥ä»¬ï¼Œç­‰å¾…ä¸€å®šæ—¶é—´åé‡è¯•å³å¯</p><details class="folding-tag" cyan close><summary> åˆ†å¸ƒå¼é”åˆä½¿ç”¨ </summary>              <div class='content'>              <p>åˆ©ç”¨setnxæ–¹æ³•è¿›è¡ŒåŠ é”ï¼ŒåŒæ—¶å¢åŠ è¿‡æœŸæ—¶é—´ï¼Œé˜²æ­¢æ­»é”ï¼Œæ­¤æ–¹æ³•å¯ä»¥ä¿è¯åŠ é”å’Œå¢åŠ è¿‡æœŸæ—¶é—´å…·æœ‰åŸå­æ€§</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String KEY_PREFIX=<span class="string">&quot;lock:&quot;</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">tryLock</span><span class="params">(<span class="type">long</span> timeoutSec)</span> &#123;</span><br><span class="line">    <span class="comment">// è·å–çº¿ç¨‹æ ‡ç¤º</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">threadId</span> <span class="operator">=</span> Thread.currentThread().getId()</span><br><span class="line">    <span class="comment">// è·å–é”</span></span><br><span class="line">    <span class="type">Boolean</span> <span class="variable">success</span> <span class="operator">=</span> stringRedisTemplate.opsForValue()</span><br><span class="line">            .setIfAbsent(KEY_PREFIX + name, threadId + <span class="string">&quot;&quot;</span>, timeoutSec, TimeUnit.SECONDS);</span><br><span class="line">    <span class="keyword">return</span> Boolean.TRUE.equals(success);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>é‡Šæ”¾é”é€»è¾‘</li></ul><p>SimpleRedisLock</p><p>é‡Šæ”¾é”ï¼Œé˜²æ­¢åˆ é™¤åˆ«äººçš„é”</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">unlock</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">//é€šè¿‡delåˆ é™¤é”</span></span><br><span class="line">    stringRedisTemplate.delete(KEY_PREFIX + name);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ä¿®æ”¹ä¸šåŠ¡ä»£ç </li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> Result <span class="title function_">seckillVoucher</span><span class="params">(Long voucherId)</span> &#123;</span><br><span class="line">      <span class="comment">// 1.æŸ¥è¯¢ä¼˜æƒ åˆ¸</span></span><br><span class="line">      <span class="type">SeckillVoucher</span> <span class="variable">voucher</span> <span class="operator">=</span> seckillVoucherService.getById(voucherId);</span><br><span class="line">      <span class="comment">// 2.åˆ¤æ–­ç§’æ€æ˜¯å¦å¼€å§‹</span></span><br><span class="line">      <span class="keyword">if</span> (voucher.getBeginTime().isAfter(LocalDateTime.now())) &#123;</span><br><span class="line">          <span class="comment">// å°šæœªå¼€å§‹</span></span><br><span class="line">          <span class="keyword">return</span> Result.fail(<span class="string">&quot;ç§’æ€å°šæœªå¼€å§‹ï¼&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// 3.åˆ¤æ–­ç§’æ€æ˜¯å¦å·²ç»ç»“æŸ</span></span><br><span class="line">      <span class="keyword">if</span> (voucher.getEndTime().isBefore(LocalDateTime.now())) &#123;</span><br><span class="line">          <span class="comment">// å°šæœªå¼€å§‹</span></span><br><span class="line">          <span class="keyword">return</span> Result.fail(<span class="string">&quot;ç§’æ€å·²ç»ç»“æŸï¼&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// 4.åˆ¤æ–­åº“å­˜æ˜¯å¦å……è¶³</span></span><br><span class="line">      <span class="keyword">if</span> (voucher.getStock() &lt; <span class="number">1</span>) &#123;</span><br><span class="line">          <span class="comment">// åº“å­˜ä¸è¶³</span></span><br><span class="line">          <span class="keyword">return</span> Result.fail(<span class="string">&quot;åº“å­˜ä¸è¶³ï¼&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> UserHolder.getUser().getId();</span><br><span class="line">      <span class="comment">//åˆ›å»ºé”å¯¹è±¡(æ–°å¢ä»£ç )</span></span><br><span class="line">      <span class="type">SimpleRedisLock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleRedisLock</span>(<span class="string">&quot;order:&quot;</span> + userId, stringRedisTemplate);</span><br><span class="line">      <span class="comment">//è·å–é”å¯¹è±¡</span></span><br><span class="line">      <span class="type">boolean</span> <span class="variable">isLock</span> <span class="operator">=</span> lock.tryLock(<span class="number">1200</span>);</span><br><span class="line"><span class="comment">//åŠ é”å¤±è´¥</span></span><br><span class="line">      <span class="keyword">if</span> (!isLock) &#123;</span><br><span class="line">          <span class="keyword">return</span> Result.fail(<span class="string">&quot;ä¸å…è®¸é‡å¤ä¸‹å•&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">          <span class="comment">//è·å–ä»£ç†å¯¹è±¡(äº‹åŠ¡)</span></span><br><span class="line">          <span class="type">IVoucherOrderService</span> <span class="variable">proxy</span> <span class="operator">=</span> (IVoucherOrderService) AopContext.currentProxy();</span><br><span class="line">          <span class="keyword">return</span> proxy.createVoucherOrder(voucherId);</span><br><span class="line">      &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">          <span class="comment">//é‡Šæ”¾é”</span></span><br><span class="line">          lock.unlock();</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>              </div>            </details><p><strong>é—®é¢˜</strong>ï¼šä¼šå­˜åœ¨ä¸€ä¸ªé”è¯¯åˆ çš„æƒ…å†µï¼Œæ¯”å¦‚åŒæ—¶è¿›æ¥äº†çº¿ç¨‹ABCï¼Œæˆ‘ä»¬æ˜¯æœ‰è®¾ç½®è¿‡æœŸæ—¶é—´çš„ã€‚å‡å¦‚çº¿ç¨‹Aä¸šåŠ¡é˜»å¡äº†ï¼Œæ‰§è¡Œæ—¶é—´è¶…è¿‡äº†è¿‡æœŸæ—¶é—´ï¼Œæ­¤æ—¶é”è¿‡æœŸäº†è‡ªåŠ¨åˆ é™¤ã€‚çº¿ç¨‹Bæ‹¿åˆ°äº†é”ï¼Œå¹¶å¼€å§‹æ‰§è¡Œä¸šåŠ¡ï¼Œä¸šåŠ¡è¿˜æ²¡æ‰§è¡Œå®Œã€‚çº¿ç¨‹Aç»ˆäºæ‰§è¡Œå®Œäº†ï¼Œæ­¤æ—¶ä¸»åŠ¨åˆ é™¤äº†é”ã€‚é”åˆç©ºé—²äº†ï¼Œçº¿ç¨‹Cåˆæ‹¿åˆ°äº†é”ã€‚å¼€å§‹æ‰§è¡Œä¸šåŠ¡ï¼ŒBåˆæ‰§è¡Œå®Œäº†ï¼Œåˆ é™¤äº†é”ï¼Œè¿™æ ·æ˜¯é”è¯¯åˆ çš„æƒ…å†µã€‚</p><details class="folding-tag" cyan close><summary> çº¿ç¨‹æ ‡è¯†è§£å†³é”è¯¯åˆ  </summary>              <div class='content'>              <p>å¦‚æ ‡é¢˜ä¸€æ ·ï¼Œæˆ‘ä»¬ç»™çº¿ç¨‹é”çš„æ—¶å€™å¯ä»¥ç»™ä¸€ä¸ªçº¿ç¨‹æ ‡è¯†ï¼Œè¡¨ç¤ºè¿™ä¸ªé”ç»™äº†çº¿ç¨‹Bã€‚çº¿ç¨‹Aæ‰§è¡Œå®Œä¸šåŠ¡ï¼Œè¦åˆ é™¤é”çš„æ—¶å€™ï¼Œå‘ç°ä¸æ˜¯è‡ªå·±æ›¾ç»æ‹¿åˆ°çš„é”ï¼Œé‚£å°±ä¸åˆ é™¤ã€‚è¿™æ ·å°±è§£å†³äº†é”è¯¯åˆ ã€‚æˆ‘ä»¬é€šè¿‡UUIDç»™çº¿ç¨‹å¢åŠ æ ‡è¯†ã€‚</p>              </div>            </details><p><strong>é—®é¢˜</strong>ï¼šå­˜åœ¨ä¸€ä¸ªæç«¯çš„é”è¯¯åˆ é—®é¢˜ï¼Œå› ä¸ºæˆ‘ä»¬çš„ä»£ç å¹¶æ²¡æœ‰ä¿è¯åŸå­æ€§ï¼Œæ‰€ä»¥ä¼šå‡ºç°è¿™ç§æƒ…å†µâ€”â€”å½“çº¿ç¨‹Aä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼Œåˆ¤æ–­é”æ˜¯å¦å±äºè‡ªå·±çš„æ—¶å€™ï¼Œåˆ¤æ–­ä¸ºtrueï¼Œå‡†å¤‡æ‰§è¡Œåˆ é™¤é”çš„æ“ä½œï¼Œåœ¨åˆ é™¤ä¹‹å‰ï¼Œé”è¿‡æœŸæ—¶é—´åˆ°äº†ï¼Œæ­¤æ—¶é”è¢«redisåˆ é™¤ï¼Œçº¿ç¨‹Bæ‹¿åˆ°äº†é”ï¼Œç„¶åAæ‰æ‰§è¡Œåˆ é™¤é”æ“ä½œï¼Œè¿™æ ·åˆæŠŠçº¿ç¨‹Bçš„é”ç»™åˆ äº†ã€‚é‚£æˆ‘ä»¬å°±éœ€è¦å°†æ‹¿é”ï¼Œåˆ¤æ–­é”ï¼Œåˆ é™¤é”ä¿è¯åŸå­æ€§ã€‚</p><details class="folding-tag" cyan close><summary> Luaè„šæœ¬ä¿è¯åŸå­æ€§ </summary>              <div class='content'>              <p>è¿™ä¸ªæ—¶å€™é¡ºåˆ©å¼•å‡ºredisè‡ªå¸¦çš„luaè„šæœ¬ï¼Œé€šè¿‡callå‘½ä»¤ä¿è¯å¤šæ¡å‘½ä»¤çš„åŸå­æ€§ã€‚å®ƒä¹Ÿå¯ä»¥é€šè¿‡thenæ¥ä¿è¯ä¸Šä¸€æ¡å‘½ä»¤æ‰§è¡Œå®Œä»¥åè¿”å›çš„ç»“æœæ‰§è¡Œä¸åŒçš„æ“ä½œï¼Œè¿™ä¸€å—ä¹Ÿä¿è¯äº†åŸå­æ€§ã€‚è¿™æ˜¯å®ƒçš„ä¼˜ç‚¹ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆç¨‹åºå‘˜åæœŸä¸å®Œå…¨ä½¿ç”¨redissionï¼Œè€Œä½¿ç”¨è°ƒç”¨luaè„šæœ¬çš„æ–¹å¼ä¿è¯åŸå­æ€§çš„åŸå› ã€‚åŒæ—¶å®ƒå¯ä»¥ä¼ é€’keyå’Œvalueçš„å‚æ•°ï¼Œæ‰€ä»¥å¯ä»¥åˆ¤æ–­è¿”å›å€¼ï¼Œå®ç°æˆ‘ä»¬ä¸Šé¢åˆ¤æ–­çº¿ç¨‹æ ‡è¯†ã€‚</p><p>æ”¹é€ SimpleRedisLockæ‰§è¡Œluaè„šæœ¬</p><div class="tabs" id="javaæ‰§è¡Œluaè„šæœ¬"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#javaæ‰§è¡Œluaè„šæœ¬-1">Java</button></li><li class="tab"><button type="button" data-href="#javaæ‰§è¡Œluaè„šæœ¬-2">Luaè„šæœ¬</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="javaæ‰§è¡Œluaè„šæœ¬-1"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> DefaultRedisScript&lt;Long&gt; UNLOCK_SCRIPT;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        UNLOCK_SCRIPT = <span class="keyword">new</span> <span class="title class_">DefaultRedisScript</span>&lt;&gt;();</span><br><span class="line">        UNLOCK_SCRIPT.setLocation(<span class="keyword">new</span> <span class="title class_">ClassPathResource</span>(<span class="string">&quot;unlock.lua&quot;</span>));</span><br><span class="line">        UNLOCK_SCRIPT.setResultType(Long.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">unlock</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// è°ƒç”¨luaè„šæœ¬</span></span><br><span class="line">    stringRedisTemplate.execute(</span><br><span class="line">            UNLOCK_SCRIPT,</span><br><span class="line">            Collections.singletonList(KEY_PREFIX + name),<span class="comment">//é”key</span></span><br><span class="line">            ID_PREFIX + Thread.currentThread().getId());<span class="comment">//çº¿ç¨‹æ ‡è¯†value</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="javaæ‰§è¡Œluaè„šæœ¬-2"><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- è¿™é‡Œçš„ KEYS[1] å°±æ˜¯é”çš„keyï¼Œè¿™é‡Œçš„ARGV[1] å°±æ˜¯å½“å‰çº¿ç¨‹æ ‡ç¤º</span></span><br><span class="line"><span class="comment">-- è·å–é”ä¸­çš„æ ‡ç¤ºï¼Œåˆ¤æ–­æ˜¯å¦ä¸å½“å‰çº¿ç¨‹æ ‡ç¤ºä¸€è‡´</span></span><br><span class="line"><span class="keyword">if</span> (redis.call(<span class="string">&#x27;GET&#x27;</span>, KEYS[<span class="number">1</span>]) == ARGV[<span class="number">1</span>]) <span class="keyword">then</span></span><br><span class="line">  <span class="comment">-- ä¸€è‡´ï¼Œåˆ™åˆ é™¤é”</span></span><br><span class="line">  <span class="keyword">return</span> redis.call(<span class="string">&#x27;DEL&#x27;</span>, KEYS[<span class="number">1</span>])</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="comment">-- ä¸ä¸€è‡´ï¼Œåˆ™ç›´æ¥è¿”å›</span></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><p><strong>æµ‹è¯•</strong>ï¼šç¬¬ä¸€ä¸ªçº¿ç¨‹è¿›æ¥ï¼Œå¾—åˆ°äº†é”ï¼Œæ‰‹åŠ¨åˆ é™¤é”ï¼Œæ¨¡æ‹Ÿé”è¶…æ—¶äº†ï¼Œå…¶ä»–çº¿ç¨‹ä¼šæ‰§è¡Œluaæ¥æŠ¢é”ï¼Œå½“ç¬¬ä¸€å¤©çº¿ç¨‹åˆ©ç”¨luaåˆ é™¤é”æ—¶ï¼Œluaèƒ½ä¿è¯ä»–ä¸èƒ½åˆ é™¤ä»–çš„é”ï¼Œç¬¬äºŒä¸ªçº¿ç¨‹åˆ é™¤é”æ—¶ï¼Œåˆ©ç”¨luaåŒæ ·å¯ä»¥ä¿è¯ä¸ä¼šåˆ é™¤åˆ«äººçš„é”ï¼ŒåŒæ—¶è¿˜èƒ½ä¿è¯åŸå­æ€§ã€‚</p>              </div>            </details><h4 id="3-3-redissonè§£å†³å››å¤§é—®é¢˜">3.3 redissonè§£å†³å››å¤§é—®é¢˜</h4><p>åŸºäºsetnxå®ç°çš„åˆ†å¸ƒå¼é”å­˜åœ¨ä¸‹é¢çš„é—®é¢˜ï¼š</p><p><strong>é‡å…¥é—®é¢˜</strong>ï¼šé‡å…¥é—®é¢˜æ˜¯æŒ‡ è·å¾—é”çš„çº¿ç¨‹å¯ä»¥å†æ¬¡è¿›å…¥åˆ°ç›¸åŒçš„é”çš„ä»£ç å—ä¸­ï¼Œå¯é‡å…¥é”çš„æ„ä¹‰åœ¨äºé˜²æ­¢æ­»é”ï¼Œæ¯”å¦‚HashTableè¿™æ ·çš„ä»£ç ä¸­ï¼Œä»–çš„æ–¹æ³•éƒ½æ˜¯ä½¿ç”¨synchronizedä¿®é¥°çš„ï¼Œå‡å¦‚ä»–åœ¨ä¸€ä¸ªæ–¹æ³•å†…ï¼Œè°ƒç”¨å¦ä¸€ä¸ªæ–¹æ³•ï¼Œé‚£ä¹ˆæ­¤æ—¶å¦‚æœæ˜¯ä¸å¯é‡å…¥çš„ï¼Œä¸å°±æ­»é”äº†å—ï¼Ÿæ‰€ä»¥å¯é‡å…¥é”ä»–çš„ä¸»è¦æ„ä¹‰æ˜¯é˜²æ­¢æ­»é”ï¼Œæˆ‘ä»¬çš„synchronizedå’ŒLocké”éƒ½æ˜¯å¯é‡å…¥çš„ã€‚</p><p><strong>ä¸å¯é‡è¯•</strong>ï¼šæ˜¯æŒ‡ç›®å‰çš„åˆ†å¸ƒå¼åªèƒ½å°è¯•ä¸€æ¬¡ï¼Œæˆ‘ä»¬è®¤ä¸ºåˆç†çš„æƒ…å†µæ˜¯ï¼šå½“çº¿ç¨‹åœ¨è·å¾—é”å¤±è´¥åï¼Œä»–åº”è¯¥èƒ½å†æ¬¡å°è¯•è·å¾—é”ã€‚</p><p><strong>è¶…æ—¶é‡Šæ”¾</strong>ï¼šæˆ‘ä»¬åœ¨åŠ é”æ—¶å¢åŠ äº†è¿‡æœŸæ—¶é—´ï¼Œè¿™æ ·çš„æˆ‘ä»¬å¯ä»¥é˜²æ­¢æ­»é”ï¼Œä½†æ˜¯å¦‚æœå¡é¡¿çš„æ—¶é—´è¶…é•¿ï¼Œè™½ç„¶æˆ‘ä»¬é‡‡ç”¨äº†luaè¡¨è¾¾å¼é˜²æ­¢åˆ é”çš„æ—¶å€™ï¼Œè¯¯åˆ åˆ«äººçš„é”ï¼Œä½†æ˜¯æ¯•ç«Ÿæ²¡æœ‰é”ä½ï¼Œæœ‰å®‰å…¨éšæ‚£</p><p><strong>ä¸»ä»ä¸€è‡´æ€§ï¼š</strong> å¦‚æœRedisæä¾›äº†ä¸»ä»é›†ç¾¤ï¼Œå½“æˆ‘ä»¬å‘é›†ç¾¤å†™æ•°æ®æ—¶ï¼Œä¸»æœºéœ€è¦å¼‚æ­¥çš„å°†æ•°æ®åŒæ­¥ç»™ä»æœºï¼Œè€Œä¸‡ä¸€åœ¨åŒæ­¥è¿‡å»ä¹‹å‰ï¼Œä¸»æœºå®•æœºäº†ï¼Œå°±ä¼šå‡ºç°æ­»é”é—®é¢˜ã€‚</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/1653546070602-17538468019109.png" alt="1653546070602"></p><p>Redissonå¯¹ä»£ç çš„æ”¹é€ ï¼Œè¿™é‡Œæˆ‘è¦è¯´ä¸€ä¸‹ï¼Œredissoné…ç½®å¥½redisä»¥åï¼Œå®ƒæ˜¯è‡ªå¸¦è·å–é”å’Œé‡Šæ”¾é”çš„æ–¹æ³•çš„ã€‚å®ƒåº•å±‚ä¿è¯äº†åŸå­æ€§å’Œè§£å†³äº†ä¸Šé¢çš„éƒ¨åˆ†é—®é¢˜ï¼Œè¯¦ç»†åœ¨ä¸‹é¢åˆ†å¸ƒå¼é”-redissionä¸­æœ‰ï¼Œæ¯”è¾ƒæŠ½è±¡ï¼Œä½†æ˜¯åº•å±‚å…¶å®è¿˜æ˜¯ä½¿ç”¨äº†luaè„šæœ¬ã€‚çœ‹å®Œæºç è°ˆè°ˆè‡ªå·±çš„ç†è§£çš„å¯é‡å…¥æœºåˆ¶ã€‚çœ‹é—¨ç‹—å’Œä¸»ä»å°±ä¸ç»†è¯´äº†ã€‚</p><blockquote><p>è¯´ç™½äº†ï¼Œå…ˆåˆ¤æ–­é”å­˜åœ¨ï¼Œä¸å­˜åœ¨å°±ï¼Œè¯´æ˜æ˜¯é¦–æ¬¡æ“ä½œåˆ›å»ºé”ï¼Œè‹¥ä¸»é”å­˜åœ¨ï¼Œä¸”å“ˆå¸Œè¡¨ä¸­å­˜åœ¨å½“å‰çº¿ç¨‹çš„æ ‡è¯†ï¼ˆ<code>ARGV[2]</code>ï¼‰ï¼Œè¯´æ˜æ˜¯<strong>åŒä¸€çº¿ç¨‹å†æ¬¡è¯·æ±‚é”</strong>ï¼ˆå¯é‡å…¥åœºæ™¯ï¼‰å°†é‡å…¥æ¬¡æ•°+1ï¼Œå†è®¾ç½®è¿‡æœŸæ—¶é—´ã€‚è¿”å›nilè¡¨ç¤ºé‡å…¥é”æˆåŠŸã€‚é”è¢«å…¶ä»–çº¿ç¨‹æŒæœ‰çš„æ—¶å€™ return redis.call(â€˜pttlâ€™, KEYS[1]);</p></blockquote><div class="tabs" id="redisson"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#redisson-1">Redissonå®¢æˆ·ç«¯é…ç½®</button></li><li class="tab"><button type="button" data-href="#redisson-2">ä»£ç æ”¹é€ </button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="redisson-1"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedissonConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RedissonClient <span class="title function_">redissonClient</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">// é…ç½®</span></span><br><span class="line">        <span class="type">Config</span> <span class="variable">config</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Config</span>();</span><br><span class="line">        config.useSingleServer().setAddress(<span class="string">&quot;redis://192.168.150.101:6379&quot;</span>)</span><br><span class="line">            .setPassword(<span class="string">&quot;123321&quot;</span>);</span><br><span class="line">        <span class="comment">// åˆ›å»ºRedissonClientå¯¹è±¡</span></span><br><span class="line">        <span class="keyword">return</span> Redisson.create(config);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="redisson-2"><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Long userId = UserHolder.getUser().getId();</span><br><span class="line">//åˆ›å»ºé”å¯¹è±¡ è¿™ä¸ªä»£ç ä¸ç”¨äº†ï¼Œå› ä¸ºæˆ‘ä»¬ç°åœ¨è¦ä½¿ç”¨åˆ†å¸ƒå¼é”</span><br><span class="line">//SimpleRedisLock lock = new SimpleRedisLock(<span class="string">&quot;order:&quot;</span> + userId, stringRedisTemplate);</span><br><span class="line">RLock lock = redissonClient.getLock(<span class="string">&quot;lock:order:&quot;</span> + userId);</span><br><span class="line">//è·å–é”å¯¹è±¡</span><br><span class="line">boolean isLock = lock.tryLock();</span><br><span class="line">//åŠ é”å¤±è´¥</span><br><span class="line"><span class="keyword">if</span> (!isLock) &#123;</span><br><span class="line">    <span class="keyword">return</span> Result.fail(<span class="string">&quot;ä¸å…è®¸é‡å¤ä¸‹å•&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">try &#123;</span><br><span class="line">    //è·å–ä»£ç†å¯¹è±¡(äº‹åŠ¡)</span><br><span class="line">    IVoucherOrderService proxy = (IVoucherOrderService) AopContext.currentProxy();</span><br><span class="line">    <span class="keyword">return</span> proxy.createVoucherOrder(voucherId);</span><br><span class="line">&#125; finally &#123;</span><br><span class="line">    //é‡Šæ”¾é”</span><br><span class="line">    lock.unlock();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h3 id="4ã€å¼‚æ­¥ç§’æ€">4ã€å¼‚æ­¥ç§’æ€</h3><p>è¿™é‡Œçš„ä¼˜åŒ–æ€è·¯æ˜¯çœ‹Tomcatéƒ¨åˆ†ï¼Œæˆ‘ä»¬ä¸ºäº†ä¿è¯åŸå­æ€§ä¼šç‰ºç‰²æ•ˆç‡ï¼Œç°åœ¨æˆ‘ä»¬çš„ç¨‹åºç±»ä¼¼äºä¸²è¡ŒåŒ–ã€‚éœ€è¦å…ˆæŸ¥åˆ¸åœ¨åˆ¤æ–­åº“å­˜ï¼Œå†æŸ¥è®¢å•çœ‹æ˜¯ä¸æ˜¯ä¸€äººä¸€å•ï¼Œå†å‡å°‘åº“å­˜å†å­˜è®¢å•ã€‚æˆ‘ä»¬å¯ä»¥å°†åˆ¤æ–­åº“å­˜å’Œç”¨æˆ·æ˜¯å¦ä¸‹è¿‡å•æ”¾åœ¨redisä¸­åˆ¤æ–­ï¼Œä¸ºäº†ä¿è¯åŸå­æ€§ä½¿ç”¨luaè„šæœ¬ï¼Œé€šè¿‡è¿”å›å€¼åˆ¤æ–­æ˜¯å¦èƒ½ä¸‹å•ï¼Œæˆ‘ä»¬å¯ä»¥å°†èƒ½ä¸‹å•çš„ä»»åŠ¡ï¼Œä¸¢åˆ°ä¸€ä¸ªé˜»å¡é˜Ÿåˆ—ä¸­ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹æ¥æ‰§è¡Œè¯¥é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ã€‚å®ç°å¼‚æ­¥ä¸‹å•ã€‚</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/1653562234886.png" alt="1653562234886"></p><ul><li>å…ˆåˆ©ç”¨Rediså®Œæˆåº“å­˜ä½™é‡ã€ä¸€äººä¸€å•åˆ¤æ–­ï¼Œå®ŒæˆæŠ¢å•ä¸šåŠ¡</li><li>å†å°†ä¸‹å•ä¸šåŠ¡æ”¾å…¥é˜»å¡é˜Ÿåˆ—ï¼Œåˆ©ç”¨ç‹¬ç«‹çº¿ç¨‹å¼‚æ­¥ä¸‹å•</li></ul><p>å®ç°æ­¥éª¤ï¼š</p><blockquote><ol><li>é¦–å…ˆåœ¨ä¿å­˜ç§’æ€åˆ¸çš„æ—¶å€™ï¼Œå°†åº“å­˜ä¿¡æ¯å­˜ä¸€ä»½åˆ°redisï¼›seckill:stock:è®¢å•ID ä¸ºkey  åº“å­˜é‡ä¸ºvalue</li><li>ç¼–å†™luaè„šæœ¬ï¼Œå‚æ•°éœ€è¦3ä¸ªvalueï¼Œ<strong>ä¼˜æƒ åˆ¸ID ç”¨æˆ·IDå’Œè®¢å•ID</strong>,è„šæœ¬ä¸šåŠ¡åˆ¤æ–­åº“å­˜æ˜¯å¦å……è¶³ï¼Œç”¨æˆ·æ˜¯å¦ä¸‹å•ï¼Œä¸æ»¡è¶³å°±è¿”å›1æˆ–è€…2ã€‚è¿”å›0ä»£è¡¨èƒ½é¡ºåˆ©ä¸‹å•ï¼Œæ­¤æ—¶æ‰£é™¤redisä¼˜æƒ åˆ¸åº“å­˜-1ï¼Œä¿å­˜ç”¨æˆ·IDåˆ°redis(setç±»å‹) seckill:order:è®¢å•ID ç”¨æˆ·ä¸ºkey valueä¸ºIDã€‚</li><li>æ‰§è¡Œé€»è¾‘: JAVAä»£ç éœ€è¦åˆ›å»ºçº¿ç¨‹æ± newSingleThreadExecutorå’Œé˜»å¡é˜Ÿåˆ—BlockingQueueã€‚è¿™é‡Œéƒ½æ˜¯ç”¨çš„åŸºç¡€çš„ï¼Œä¸ç”¨é…ç½®å‚æ•°ã€‚ç±»åˆå§‹åŒ–åçº¿ç¨‹æ± ä¼šåˆ†é…ç©ºé—²çº¿ç¨‹æ‰§è¡Œnew VoucherOrderHandler()ã€‚è¿™æ˜¯ä¸€ä¸ªä»»åŠ¡ç±»ï¼Œå°±æ˜¯å¯ä»¥è¢«çº¿ç¨‹æ‰§è¡Œçš„ä¸€æ®µä»£ç ã€‚çº¿ç¨‹ä¼šä¸€ç›´ä¸æ–­çš„æ‰§è¡Œä»–çš„runæ–¹æ³•ï¼Œä½†æ˜¯æˆ‘ä»¬ä»£ç ä¸­while(True)ä»é˜Ÿåˆ—ä¸­è·å–è®¢å•ä¿¡æ¯ï¼Œè¿™é‡Œä½¿ç”¨äº†takeæ–¹æ³•ã€‚**BlockingQueueçš„take()æ–¹æ³•æ˜¯ä¸€ä¸ªé˜»å¡å¼è·å–å…ƒç´ çš„æ–¹æ³• å½“é˜Ÿåˆ—ä¸­æ²¡æœ‰å…ƒç´ æ—¶ï¼Œè°ƒç”¨take()çš„çº¿ç¨‹ä¼šè¢«æŒ‚èµ·ï¼ˆé˜»å¡ï¼‰ï¼Œè¿›å…¥WAITINGçŠ¶æ€ï¼Œä¸ä¼šå ç”¨ CPU èµ„æºï¼›ç›´åˆ°æœ‰å…¶ä»–çº¿ç¨‹å‘é˜Ÿåˆ—ä¸­æ·»åŠ äº†å…ƒç´ ï¼ˆå³æ–°ä»»åŠ¡å…¥é˜Ÿï¼‰ï¼Œé˜»å¡çš„çº¿ç¨‹æ‰ä¼šè¢«å”¤é†’ï¼Œç»§ç»­æ‰§è¡Œtake()å¹¶è¿”å›æ–°å…ƒç´ ã€‚**å½“ç”¨æˆ·ç‚¹å‡»æŠ¢è´­ç§’æ€å‘èµ·è¯·æ±‚çš„æ—¶å€™ï¼Œæ‰§è¡ŒseckillVoucheræ–¹æ³•ï¼Œå…ˆæ‰§è¡Œluaè„šæœ¬ï¼Œåˆ¤æ–­ç»“æœæ˜¯å¦ä¸º0ï¼Œç»“æœä¸ä¸º0ç›´æ¥è¿”å›æ— åº“å­˜æˆ–è€…ä¸‹è¿‡å•äº†ã€‚å¦‚æœä¸º0å°†åˆ›å»ºvoucherOrderå¯¹è±¡å¹¶æ”¾å…¥é˜»å¡é˜Ÿåˆ—ä¸­å»ï¼ŒåŒæ—¶è·å–ä»£ç†å¯¹è±¡(åé¢ä»£ç ä¿è¯äº‹åŠ¡çš„)ã€‚å½“æ‹¿åˆ°è®¢å•ä¿¡æ¯ä»¥åï¼Œä¼šæ‰§è¡Œåˆ›å»ºè®¢å•handleVoucherOrder(voucherOrder);åˆ›å»ºè®¢å•çš„æ—¶å€™åŠ é”ä¿è¯äº†ä¸€äººä¸€å•ï¼Œå› ä¸ºé˜²æ­¢äº‹åŠ¡å¤±æ•ˆï¼ˆå› ä¸ºspringäº‹åŠ¡æ˜¯åœ¨threadlocalçº¿ç¨‹å‰¯æœ¬å˜é‡ä¸­ï¼Œå…¶ä»–çº¿ç¨‹æ‹¿ä¸åˆ°ï¼Œè¿™é‡Œæ˜¯å¤šçº¿ç¨‹ä¼šäº‹åŠ¡å¤±æ•ˆï¼‰ï¼Œæ‰€ä»¥å°†æ¥å£å®šä¹‰åœ¨æœ€å¤–é¢å¯ä»¥è°ƒç”¨åˆ›å»ºè®¢å•æ–¹æ³•ä¿è¯äº‹åŠ¡æ€§ã€‚æ­¤æ—¶åˆ›å»ºè®¢å•ä»»åŠ¡æ‰§è¡Œæ•°æ®åº“æ‰£å‡åº“å­˜å’Œä¿å­˜è®¢å•IDçš„æ“ä½œã€‚</li></ol></blockquote><p>ä»£ç å¦‚ä¸‹:</p><div class="tabs" id="é˜»å¡é˜Ÿåˆ—ç§’æ€"><ul class="nav-tabs"><li class="tab"><button type="button" data-href="#é˜»å¡é˜Ÿåˆ—ç§’æ€-1">Luaè„šæœ¬</button></li><li class="tab"><button type="button" data-href="#é˜»å¡é˜Ÿåˆ—ç§’æ€-2">æ”¾é˜»å¡é˜Ÿåˆ—</button></li><li class="tab active"><button type="button" data-href="#é˜»å¡é˜Ÿåˆ—ç§’æ€-3">çº¿ç¨‹æ± åˆ†é…ä»»åŠ¡</button></li><li class="tab"><button type="button" data-href="#é˜»å¡é˜Ÿåˆ—ç§’æ€-4">æ›´æ–°æ•°æ®åº“</button></li></ul><div class="tab-contents"><div class="tab-item-content" id="é˜»å¡é˜Ÿåˆ—ç§’æ€-1"><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- å‚æ•°åˆ—è¡¨</span></span><br><span class="line"><span class="keyword">local</span> voucherId = ARGV[<span class="number">1</span>]</span><br><span class="line"><span class="keyword">local</span> userId = ARGV[<span class="number">2</span>]</span><br><span class="line"><span class="comment">--æ¶ˆæ¯é˜Ÿåˆ—ä½¿ç”¨</span></span><br><span class="line"><span class="keyword">local</span> orderId = ARGV[<span class="number">3</span>]</span><br><span class="line"><span class="comment">-- æ•°æ®key</span></span><br><span class="line"><span class="keyword">local</span> stockKey = <span class="string">&#x27;seckill:stock:&#x27;</span> .. voucherId</span><br><span class="line"><span class="keyword">local</span> orderKey = <span class="string">&#x27;seckill:order:&#x27;</span> .. voucherId</span><br><span class="line"><span class="comment">-- åˆ¤æ–­åº“å­˜æ˜¯å¦å……è¶³</span></span><br><span class="line"><span class="keyword">if</span> (redis.call(<span class="string">&quot;get&quot;</span>,stockKey) ~= <span class="literal">nil</span> <span class="keyword">and</span> <span class="built_in">tonumber</span>(redis.call(<span class="string">&quot;get&quot;</span>,stockKey))  &lt;= <span class="number">0</span>) <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (redis.call(<span class="string">&quot;sismember&quot;</span>,orderKey,userId) == <span class="number">1</span>) <span class="keyword">then</span></span><br><span class="line">    <span class="comment">-- ç”¨æˆ·å·²è´­ä¹°</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">2</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="comment">-- æ‰£å‡åº“å­˜ userIdå­˜seté›†åˆè¿”å›0</span></span><br><span class="line">redis.call(<span class="string">&quot;incrby&quot;</span>,stockKey,<span class="number">-1</span>)</span><br><span class="line">redis.call(<span class="string">&quot;sadd&quot;</span>,orderKey,userId)</span><br><span class="line"><span class="comment">-- 3.6.å‘é€æ¶ˆæ¯åˆ°é˜Ÿåˆ—ä¸­ï¼Œ XADD stream.orders * k1 v1 k2 v2 ... æ¶ˆæ¯é˜Ÿåˆ—ä½¿ç”¨</span></span><br><span class="line"><span class="comment">--redis.call(&#x27;xadd&#x27;, &#x27;stream.orders&#x27;, &#x27;*&#x27;, &#x27;userId&#x27;, userId, &#x27;voucherId&#x27;, voucherId, &#x27;id&#x27;, orderId)</span></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="é˜»å¡é˜Ÿåˆ—ç§’æ€-2"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è°ƒç”¨æ¥å£çš„æ—¶å€™å°±æ‰§è¡Œå°†ä»»åŠ¡ä¸¢é˜»å¡é˜Ÿåˆ—å¹¶è·å–ä»£ç†å¯¹è±¡</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">seckillVoucher</span><span class="params">(Long voucherId)</span> &#123;</span><br><span class="line">    <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> UserHolder.getUser().getId();</span><br><span class="line">    <span class="type">long</span> <span class="variable">orderId</span> <span class="operator">=</span> redisIdWorker.nextId(<span class="string">&quot;order&quot;</span>);</span><br><span class="line">    <span class="comment">// 1.æ‰§è¡Œluaè„šæœ¬</span></span><br><span class="line">    <span class="type">Long</span> <span class="variable">result</span> <span class="operator">=</span> stringRedisTemplate.execute(</span><br><span class="line">        SECKILL_SCRIPT,</span><br><span class="line">        Collections.emptyList(),</span><br><span class="line">        voucherId.toString(), userId.toString(), String.valueOf(orderId)</span><br><span class="line">    );</span><br><span class="line">    <span class="type">int</span> <span class="variable">r</span> <span class="operator">=</span> result.intValue();</span><br><span class="line">    <span class="comment">// 2.åˆ¤æ–­ç»“æœæ˜¯å¦ä¸º0</span></span><br><span class="line">    <span class="keyword">if</span> (r != <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// 2.1.ä¸ä¸º0 ï¼Œä»£è¡¨æ²¡æœ‰è´­ä¹°èµ„æ ¼</span></span><br><span class="line">        <span class="keyword">return</span> Result.fail(r == <span class="number">1</span> ? <span class="string">&quot;åº“å­˜ä¸è¶³&quot;</span> : <span class="string">&quot;ä¸èƒ½é‡å¤ä¸‹å•&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">VoucherOrder</span> <span class="variable">voucherOrder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">VoucherOrder</span>();</span><br><span class="line">    voucherOrder.setId(orderId);</span><br><span class="line">    <span class="comment">// 2.4.ç”¨æˆ·id</span></span><br><span class="line">    voucherOrder.setUserId(userId);</span><br><span class="line">    <span class="comment">// 2.5.ä»£é‡‘åˆ¸id</span></span><br><span class="line">    voucherOrder.setVoucherId(voucherId);</span><br><span class="line">    <span class="comment">// 2.6.æ”¾å…¥é˜»å¡é˜Ÿåˆ—</span></span><br><span class="line">    orderTasks.add(voucherOrder);</span><br><span class="line">    <span class="comment">//3.è·å–ä»£ç†å¯¹è±¡</span></span><br><span class="line">    proxy = (IVoucherOrderService)AopContext.currentProxy();</span><br><span class="line">    <span class="comment">//4.è¿”å›è®¢å•id</span></span><br><span class="line">    <span class="keyword">return</span> Result.ok(orderId);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content active" id="é˜»å¡é˜Ÿåˆ—ç§’æ€-3"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å¼‚æ­¥å¤„ç†çº¿ç¨‹æ± </span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">ExecutorService</span> <span class="variable">SECKILL_ORDER_EXECUTOR</span> <span class="operator">=</span> Executors.newSingleThreadExecutor();</span><br><span class="line"><span class="comment">//åˆ›å»ºé˜»å¡é˜Ÿåˆ—</span></span><br><span class="line"><span class="keyword">private</span> BlockingQueue&lt;VoucherOrder&gt; orderTasks =<span class="keyword">new</span>  <span class="title class_">ArrayBlockingQueue</span>&lt;&gt;(<span class="number">1024</span> * <span class="number">1024</span>);</span><br><span class="line"><span class="comment">//åœ¨ç±»åˆå§‹åŒ–ä¹‹åæ‰§è¡Œï¼Œå› ä¸ºå½“è¿™ä¸ªç±»åˆå§‹åŒ–å¥½äº†ä¹‹åï¼Œéšæ—¶éƒ½æ˜¯æœ‰å¯èƒ½è¦æ‰§è¡Œçš„</span></span><br><span class="line"><span class="meta">@PostConstruct</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> &#123;</span><br><span class="line">   SECKILL_ORDER_EXECUTOR.submit(<span class="keyword">new</span> <span class="title class_">VoucherOrderHandler</span>());</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ç”¨äºçº¿ç¨‹æ± å¤„ç†çš„ä»»åŠ¡</span></span><br><span class="line"><span class="comment">// å½“åˆå§‹åŒ–å®Œæ¯•åï¼Œå°±ä¼šå»ä»å¯¹åˆ—ä¸­å»æ‹¿ä¿¡æ¯</span></span><br><span class="line"> <span class="keyword">private</span> <span class="keyword">class</span> <span class="title class_">VoucherOrderHandler</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">while</span> (<span class="literal">true</span>)&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="comment">// 1.è·å–é˜Ÿåˆ—ä¸­çš„è®¢å•ä¿¡æ¯</span></span><br><span class="line">                    <span class="type">VoucherOrder</span> <span class="variable">voucherOrder</span> <span class="operator">=</span> orderTasks.take();</span><br><span class="line">                    <span class="comment">// 2.åˆ›å»ºè®¢å•</span></span><br><span class="line">                    handleVoucherOrder(voucherOrder);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                    log.error(<span class="string">&quot;å¤„ç†è®¢å•å¼‚å¸¸&quot;</span>, e);</span><br><span class="line">                &#125;</span><br><span class="line">           &#125;</span><br><span class="line">        &#125;</span><br><span class="line">     </span><br><span class="line">       <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">handleVoucherOrder</span><span class="params">(VoucherOrder voucherOrder)</span> &#123;</span><br><span class="line">            <span class="comment">//1.è·å–ç”¨æˆ·</span></span><br><span class="line">            <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> voucherOrder.getUserId();</span><br><span class="line">            <span class="comment">// 2.åˆ›å»ºé”å¯¹è±¡</span></span><br><span class="line">            <span class="type">RLock</span> <span class="variable">redisLock</span> <span class="operator">=</span> redissonClient.getLock(<span class="string">&quot;lock:order:&quot;</span> + userId);</span><br><span class="line">            <span class="comment">// 3.å°è¯•è·å–é”</span></span><br><span class="line">            <span class="type">boolean</span> <span class="variable">isLock</span> <span class="operator">=</span> redisLock.lock();</span><br><span class="line">            <span class="comment">// 4.åˆ¤æ–­æ˜¯å¦è·å¾—é”æˆåŠŸ</span></span><br><span class="line">            <span class="keyword">if</span> (!isLock) &#123;</span><br><span class="line">                <span class="comment">// è·å–é”å¤±è´¥ï¼Œç›´æ¥è¿”å›å¤±è´¥æˆ–è€…é‡è¯•</span></span><br><span class="line">                log.error(<span class="string">&quot;ä¸å…è®¸é‡å¤ä¸‹å•ï¼&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line"><span class="comment">//æ³¨æ„ï¼šç”±äºæ˜¯springçš„äº‹åŠ¡æ˜¯æ”¾åœ¨threadLocalä¸­ï¼Œæ­¤æ—¶çš„æ˜¯å¤šçº¿ç¨‹ï¼Œäº‹åŠ¡ä¼šå¤±æ•ˆ</span></span><br><span class="line">                proxy.createVoucherOrder(voucherOrder);</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                <span class="comment">// é‡Šæ”¾é”</span></span><br><span class="line">                redisLock.unlock();</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="é˜»å¡é˜Ÿåˆ—ç§’æ€-4"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span>  <span class="keyword">void</span> <span class="title function_">createVoucherOrder</span><span class="params">(VoucherOrder voucherOrder)</span> &#123;</span><br><span class="line">    <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> voucherOrder.getUserId();</span><br><span class="line">    <span class="comment">// 5.1.æŸ¥è¯¢è®¢å•</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> query().eq(<span class="string">&quot;user_id&quot;</span>, userId).eq(<span class="string">&quot;voucher_id&quot;</span>, voucherOrder.getVoucherId()).count();</span><br><span class="line">    <span class="comment">// 5.2.åˆ¤æ–­æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">    <span class="keyword">if</span> (count &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// ç”¨æˆ·å·²ç»è´­ä¹°è¿‡äº†</span></span><br><span class="line">        log.error(<span class="string">&quot;ç”¨æˆ·å·²ç»è´­ä¹°è¿‡äº†&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 6.æ‰£å‡åº“å­˜</span></span><br><span class="line">    <span class="type">boolean</span> <span class="variable">success</span> <span class="operator">=</span> seckillVoucherService.update()</span><br><span class="line">        .setSql(<span class="string">&quot;stock = stock - 1&quot;</span>) <span class="comment">// set stock = stock - 1</span></span><br><span class="line">        .eq(<span class="string">&quot;voucher_id&quot;</span>, voucherOrder.getVoucherId()).gt(<span class="string">&quot;stock&quot;</span>, <span class="number">0</span>) <span class="comment">// where id = ? and stock &gt; 0</span></span><br><span class="line">        .update();</span><br><span class="line">    <span class="keyword">if</span> (!success) &#123;</span><br><span class="line">        <span class="comment">// æ‰£å‡å¤±è´¥</span></span><br><span class="line">        log.error(<span class="string">&quot;åº“å­˜ä¸è¶³&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    save(voucherOrder);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h3 id="5ã€æ¶ˆæ¯é˜Ÿåˆ—">5ã€æ¶ˆæ¯é˜Ÿåˆ—</h3><p>æ¶ˆæ¯é˜Ÿåˆ—å…¶å®å°±æ˜¯ä¸€ä¸ªä¸­é—´ä»¶ï¼Œå¯ä»¥æŠŠä¸€äº›ä»»åŠ¡ä¸¢åœ¨æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œä»–çš„å¥½å¤„<strong>è§£è€¦</strong>ï¼Œæ¯”å¦‚ç”Ÿäº§è€…å‘å®ŒæŒ‚äº†ï¼Œæ¶ˆè´¹è€…æœªæ¶ˆè´¹ï¼Œåæ­£åªè¦æ•°æ®å­˜åˆ°äº†æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œæ•°æ®å°±ç›¸å½“äºä¸€ä»½å¤‡ä»½ï¼Œèƒ½ä¿è¯æ•°æ®ä¸ä¸¢å¤±ã€‚æˆ‘ä»¬ä¸‹å•ä¹‹åï¼Œåˆ©ç”¨rediså»è¿›è¡Œæ ¡éªŒä¸‹å•æ¡ä»¶ï¼Œå†é€šè¿‡é˜Ÿåˆ—æŠŠæ¶ˆæ¯å‘é€å‡ºå»ï¼Œç„¶åå†å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹å»æ¶ˆè´¹è¿™ä¸ªæ¶ˆæ¯ï¼Œå®Œæˆè§£è€¦ï¼ŒåŒæ—¶ä¹ŸåŠ å¿«æˆ‘ä»¬çš„å“åº”é€Ÿåº¦ã€‚</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/1653574849336.png" alt="1653574849336"></p><p>å› ä¸ºä¸€èˆ¬æ¶ˆæ¯é˜Ÿåˆ—MQ,ä¼šæœ‰å…¶ä»–çš„ä¸­é—´ä»¶ä½¿ç”¨ï¼Œè¿™é‡Œå­¦ä¹ rediså¯ä»¥ä½¿ç”¨redisæ”¯æŒçš„mqï¼Œå®é™…ä¸šåŠ¡ä¸­ä¸ç»å¸¸ä½¿ç”¨ï¼Œæ‰€ä»¥ä¸åšé‡ç‚¹è¦æ±‚ï¼Œçœ‹ä¸‰ç§æ¶ˆæ¯é˜Ÿåˆ—çš„å¯¹æ¯”ï¼Œæˆ‘ä»¬é€‰æ‹©streamæ¥å®ç°æ¶ˆæ¯é˜Ÿåˆ—çš„ä»£ç æ”¹é€ ï¼ŒStreamè¿˜æ”¯æŒæ¶ˆè´¹ç»„ã€‚</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/1653578560691.png" alt="1653578560691"></p><p>é€šè¿‡Streamç»“æ„ä½œä¸ºæ¶ˆæ¯é˜Ÿåˆ—å®ç°å¼‚æ­¥ç§’æ€ä¸‹å•ï¼Œä»£ç è¿›è¡Œæ”¹é€ ã€‚è¿™é‡Œé€»è¾‘ä¸è®²äº†ä¸æ˜¯å¾ˆé‡è¦ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">class</span> <span class="title class_">VoucherOrderHandler</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// 1.è·å–æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„è®¢å•ä¿¡æ¯ XREADGROUP GROUP g1 c1 COUNT 1 BLOCK 2000 STREAMS s1 &gt;</span></span><br><span class="line">                List&lt;MapRecord&lt;String, Object, Object&gt;&gt; list = stringRedisTemplate.opsForStream().read(</span><br><span class="line">                    Consumer.from(<span class="string">&quot;g1&quot;</span>, <span class="string">&quot;c1&quot;</span>),</span><br><span class="line">                    StreamReadOptions.empty().count(<span class="number">1</span>).block(Duration.ofSeconds(<span class="number">2</span>)),</span><br><span class="line">                    StreamOffset.create(<span class="string">&quot;stream.orders&quot;</span>, ReadOffset.lastConsumed())</span><br><span class="line">                );</span><br><span class="line">                <span class="comment">// 2.åˆ¤æ–­è®¢å•ä¿¡æ¯æ˜¯å¦ä¸ºç©º</span></span><br><span class="line">                <span class="keyword">if</span> (list == <span class="literal">null</span> || list.isEmpty()) &#123;</span><br><span class="line">                    <span class="comment">// å¦‚æœä¸ºnullï¼Œè¯´æ˜æ²¡æœ‰æ¶ˆæ¯ï¼Œç»§ç»­ä¸‹ä¸€æ¬¡å¾ªç¯</span></span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// è§£ææ•°æ®</span></span><br><span class="line">                MapRecord&lt;String, Object, Object&gt; record = list.get(<span class="number">0</span>);</span><br><span class="line">                Map&lt;Object, Object&gt; value = record.getValue();</span><br><span class="line">                <span class="type">VoucherOrder</span> <span class="variable">voucherOrder</span> <span class="operator">=</span> BeanUtil.fillBeanWithMap(value, <span class="keyword">new</span> <span class="title class_">VoucherOrder</span>(), <span class="literal">true</span>);</span><br><span class="line">                <span class="comment">// 3.åˆ›å»ºè®¢å•</span></span><br><span class="line">                createVoucherOrder(voucherOrder);</span><br><span class="line">                <span class="comment">// 4.ç¡®è®¤æ¶ˆæ¯ XACK</span></span><br><span class="line">                stringRedisTemplate.opsForStream().acknowledge(<span class="string">&quot;s1&quot;</span>, <span class="string">&quot;g1&quot;</span>, record.getId());</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                log.error(<span class="string">&quot;å¤„ç†è®¢å•å¼‚å¸¸&quot;</span>, e);</span><br><span class="line">                <span class="comment">//å¤„ç†å¼‚å¸¸æ¶ˆæ¯</span></span><br><span class="line">                handlePendingList();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">handlePendingList</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// 1.è·å–pending-listä¸­çš„è®¢å•ä¿¡æ¯ XREADGROUP GROUP g1 c1 COUNT 1 BLOCK 2000 STREAMS s1 0</span></span><br><span class="line">                List&lt;MapRecord&lt;String, Object, Object&gt;&gt; list = stringRedisTemplate.opsForStream().read(</span><br><span class="line">                    Consumer.from(<span class="string">&quot;g1&quot;</span>, <span class="string">&quot;c1&quot;</span>),</span><br><span class="line">                    StreamReadOptions.empty().count(<span class="number">1</span>),</span><br><span class="line">                    StreamOffset.create(<span class="string">&quot;stream.orders&quot;</span>, ReadOffset.from(<span class="string">&quot;0&quot;</span>))</span><br><span class="line">                );</span><br><span class="line">                <span class="comment">// 2.åˆ¤æ–­è®¢å•ä¿¡æ¯æ˜¯å¦ä¸ºç©º</span></span><br><span class="line">                <span class="keyword">if</span> (list == <span class="literal">null</span> || list.isEmpty()) &#123;</span><br><span class="line">                    <span class="comment">// å¦‚æœä¸ºnullï¼Œè¯´æ˜æ²¡æœ‰å¼‚å¸¸æ¶ˆæ¯ï¼Œç»“æŸå¾ªç¯</span></span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// è§£ææ•°æ®</span></span><br><span class="line">                MapRecord&lt;String, Object, Object&gt; record = list.get(<span class="number">0</span>);</span><br><span class="line">                Map&lt;Object, Object&gt; value = record.getValue();</span><br><span class="line">                <span class="type">VoucherOrder</span> <span class="variable">voucherOrder</span> <span class="operator">=</span> BeanUtil.fillBeanWithMap(value, <span class="keyword">new</span> <span class="title class_">VoucherOrder</span>(), <span class="literal">true</span>);</span><br><span class="line">                <span class="comment">// 3.åˆ›å»ºè®¢å•</span></span><br><span class="line">                createVoucherOrder(voucherOrder);</span><br><span class="line">                <span class="comment">// 4.ç¡®è®¤æ¶ˆæ¯ XACK</span></span><br><span class="line">                stringRedisTemplate.opsForStream().acknowledge(<span class="string">&quot;s1&quot;</span>, <span class="string">&quot;g1&quot;</span>, record.getId());</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                log.error(<span class="string">&quot;å¤„ç†penddingè®¢å•å¼‚å¸¸&quot;</span>, e);</span><br><span class="line">                <span class="keyword">try</span>&#123;</span><br><span class="line">                    Thread.sleep(<span class="number">20</span>);</span><br><span class="line">                &#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="6ã€jmeteræµ‹è¯•é«˜å¹¶å‘ï¼Œæ·»åŠ token">6ã€jmeteræµ‹è¯•é«˜å¹¶å‘ï¼Œæ·»åŠ token</h3><p>è¿™ä¸€å—æ˜¯åœ¨ä»å¼‚æ­¥ç§’æ€ä¸‹å•é‚£è¾¹æµ‹è¯•å¤šä¸ªç”¨æˆ·åŒæ—¶ä¸‹å•çš„æ—¶å€™ï¼Œå‡ºç°çš„é—®é¢˜ï¼Œå› ä¸ºä¹‹å‰æ²¡ä½¿ç”¨è¿‡jmeterã€‚è€å¸ˆé‚£è¾¹ç›´æ¥å‘é€äº†1000æ¡è¯·æ±‚ï¼Œä½†æ˜¯æ¯ä¸ªè¯·æ±‚éƒ½éœ€è¦æœ‰å¯¹åº”çš„tokenï¼Œè€å¸ˆæä¾›çš„æ•°æ®åº“ä¸­ç”¨æˆ·å·²ç»æ–°å»ºå¥½äº†ï¼Œè¿™é‡Œæˆ‘ä»¬éœ€è¦æ‰‹åŠ¨å‘redisæ·»åŠ tokenï¼Œå¹¶ä¸”è¦æŠŠtokenä¿å­˜åˆ°ä¸€ä¸ªtxtæ–‡ä»¶ï¼Œæ–¹ä¾¿jmeteræŒ‰è¡Œè°ƒç”¨ã€‚è¿™é‡Œæˆ‘å†™äº†ä¸€ä¸ªæµ‹è¯•ç±»ã€‚æ‰§è¡Œå®Œä¼šå†resourceä¸‹é¢ç”Ÿæˆä¸€ä¸ªtokens.txtã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">tokenTest</span> &#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> StringRedisTemplate stringRedisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> IUserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//ä»æ•°æ®åº“ç”¨æˆ·è¡¨æ‹¿å…¨éƒ¨user</span></span><br><span class="line">        List&lt;User&gt; userList = userService.list();</span><br><span class="line">        <span class="keyword">for</span> (User user : userList) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> UUID.randomUUID().toString();</span><br><span class="line">            <span class="comment">//å°†tokenå†™å…¥æ–‡ä»¶</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="type">FileWriter</span> <span class="variable">writer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileWriter</span>(<span class="string">&quot;tokens.txt&quot;</span>, <span class="literal">false</span>); <span class="comment">// å…ˆæ¸…ç©ºåŸæ–‡ä»¶</span></span><br><span class="line">                writer.write(token + System.lineSeparator());</span><br><span class="line">                writer.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                log.info(<span class="string">&quot;é”™è¯¯ä¿¡æ¯&#123;&#125;&quot;</span>, String.valueOf(e));</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="type">String</span> <span class="variable">tokenKey</span> <span class="operator">=</span> LOGIN_USER_KEY + token;</span><br><span class="line">            <span class="type">UserDTO</span> <span class="variable">userDTO</span> <span class="operator">=</span> BeanUtil.copyProperties(user, UserDTO.class);</span><br><span class="line">            Map&lt;String, Object&gt; userMap = BeanUtil.beanToMap(userDTO,<span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;(),</span><br><span class="line">                    CopyOptions.create()</span><br><span class="line">                            .setIgnoreNullValue(<span class="literal">true</span>)</span><br><span class="line">                            .setFieldValueEditor((fieldName,fieldValue)-&gt;fieldValue.toString()));</span><br><span class="line">            stringRedisTemplate.opsForHash().putAll(tokenKey, userMap);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>jmeteré…ç½®ï¼ŒHTTPä¿¡æ¯å¤´ç®¡ç†å™¨ä¸­é…ç½®authorization ${token}ã€‚å¯¹äº†è®°å¾—åŠ æ–­è¨€ï¼Œå°†successæ–­è¨€è®¾ç½®trueã€‚ä¸ç„¶ä¼šéƒ½æ˜¯è¿”å›æˆåŠŸæ— æ³•åˆ¤æ–­æŠ¥å‘Šçš„å¼‚å¸¸äº†ã€‚</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/image-20250730155921675.png" alt="image-20250730155921675"></p><h2 id="1ã€çŸ­ä¿¡ç™»å½•">1ã€çŸ­ä¿¡ç™»å½•</h2><h3 id="1-1ã€å¯¼å…¥ä¼˜æ¢ç¤¾äº¤è´­äº‘å¹³å°é¡¹ç›®">1.1ã€å¯¼å…¥ä¼˜æ¢ç¤¾äº¤è´­äº‘å¹³å°é¡¹ç›®</h3><h4 id="1-1-1-ã€å¯¼å…¥SQL">1.1.1 ã€å¯¼å…¥SQL</h4><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/1653057872536.png" alt="1653057872536"></p><h4 id="1-1-2ã€æœ‰å…³å½“å‰æ¨¡å‹">1.1.2ã€æœ‰å…³å½“å‰æ¨¡å‹</h4><p>æ‰‹æœºæˆ–è€…appç«¯å‘èµ·è¯·æ±‚ï¼Œè¯·æ±‚æˆ‘ä»¬çš„nginxæœåŠ¡å™¨ï¼ŒnginxåŸºäºä¸ƒå±‚æ¨¡å‹èµ°çš„äº‹HTTPåè®®ï¼Œå¯ä»¥å®ç°åŸºäºLuaç›´æ¥ç»•å¼€tomcatè®¿é—®redisï¼Œä¹Ÿå¯ä»¥ä½œä¸ºé™æ€èµ„æºæœåŠ¡å™¨ï¼Œè½»æ¾æ‰›ä¸‹ä¸Šä¸‡å¹¶å‘ï¼Œ è´Ÿè½½å‡è¡¡åˆ°ä¸‹æ¸¸tomcatæœåŠ¡å™¨ï¼Œæ‰“æ•£æµé‡ï¼Œæˆ‘ä»¬éƒ½çŸ¥é“ä¸€å°4æ ¸8Gçš„tomcatï¼Œåœ¨ä¼˜åŒ–å’Œå¤„ç†ç®€å•ä¸šåŠ¡çš„åŠ æŒä¸‹ï¼Œå¤§ä¸äº†å°±å¤„ç†1000å·¦å³çš„å¹¶å‘ï¼Œ ç»è¿‡nginxçš„è´Ÿè½½å‡è¡¡åˆ†æµåï¼Œåˆ©ç”¨é›†ç¾¤æ”¯æ’‘èµ·æ•´ä¸ªé¡¹ç›®ï¼ŒåŒæ—¶nginxåœ¨éƒ¨ç½²äº†å‰ç«¯é¡¹ç›®åï¼Œæ›´æ˜¯å¯ä»¥åšåˆ°åŠ¨é™åˆ†ç¦»ï¼Œè¿›ä¸€æ­¥é™ä½tomcatæœåŠ¡çš„å‹åŠ›ï¼Œè¿™äº›åŠŸèƒ½éƒ½å¾—é nginxèµ·ä½œç”¨ï¼Œæ‰€ä»¥nginxæ˜¯æ•´ä¸ªé¡¹ç›®ä¸­é‡è¦çš„ä¸€ç¯ã€‚</p><p>åœ¨tomcatæ”¯æ’‘èµ·å¹¶å‘æµé‡åï¼Œæˆ‘ä»¬å¦‚æœè®©tomcatç›´æ¥å»è®¿é—®Mysqlï¼Œæ ¹æ®ç»éªŒMysqlä¼ä¸šçº§æœåŠ¡å™¨åªè¦ä¸Šç‚¹å¹¶å‘ï¼Œä¸€èˆ¬æ˜¯16æˆ–32 æ ¸å¿ƒcpuï¼Œ32 æˆ–64Gå†…å­˜ï¼Œåƒä¼ä¸šçº§mysqlåŠ ä¸Šå›ºæ€ç¡¬ç›˜èƒ½å¤Ÿæ”¯æ’‘çš„å¹¶å‘ï¼Œå¤§æ¦‚å°±æ˜¯4000èµ·~7000å·¦å³ï¼Œä¸Šä¸‡å¹¶å‘ï¼Œ ç¬é—´å°±ä¼šè®©MysqlæœåŠ¡å™¨çš„cpuï¼Œç¡¬ç›˜å…¨éƒ¨æ‰“æ»¡ï¼Œå®¹æ˜“å´©æºƒï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹ï¼Œä¼šé€‰æ‹©ä½¿ç”¨mysqlé›†ç¾¤ï¼ŒåŒæ—¶ä¸ºäº†è¿›ä¸€æ­¥é™ä½Mysqlçš„å‹åŠ›ï¼ŒåŒæ—¶å¢åŠ è®¿é—®çš„æ€§èƒ½ï¼Œæˆ‘ä»¬ä¹Ÿä¼šåŠ å…¥Redisï¼ŒåŒæ—¶ä½¿ç”¨Redisé›†ç¾¤ä½¿å¾—Rediså¯¹å¤–æä¾›æ›´å¥½çš„æœåŠ¡ã€‚</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/1653059409865.png" alt="1653059409865"></p><h4 id="1-1-3ã€å¯¼å…¥åç«¯é¡¹ç›®">1.1.3ã€å¯¼å…¥åç«¯é¡¹ç›®</h4><p>åœ¨èµ„æ–™ä¸­æä¾›äº†ä¸€ä¸ªé¡¹ç›®æºç ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/1653060237073.png" alt="1653060237073"></p><h4 id="1-1-4ã€å¯¼å…¥å‰ç«¯å·¥ç¨‹">1.1.4ã€å¯¼å…¥å‰ç«¯å·¥ç¨‹</h4><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/1653060337562.png" alt="1653060337562"></p><h3 id="1-2ã€redisè®¾è®¡">1.2ã€redisè®¾è®¡</h3><p>é¦–å…ˆæˆ‘ä»¬è¦æ€è€ƒä¸€ä¸‹åˆ©ç”¨redisæ¥å­˜å‚¨æ•°æ®ï¼Œé‚£ä¹ˆåˆ°åº•ä½¿ç”¨å“ªç§ç»“æ„å‘¢ï¼Ÿç”±äºå­˜å…¥çš„æ•°æ®æ¯”è¾ƒç®€å•ï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘ä½¿ç”¨Stringï¼Œæˆ–è€…æ˜¯ä½¿ç”¨å“ˆå¸Œï¼Œå¦‚ä¸‹å›¾ï¼Œå¦‚æœä½¿ç”¨Stringï¼Œæ³¨æ„ä»–çš„valueï¼Œç”¨å¤šå ç”¨ä¸€ç‚¹ç©ºé—´ï¼Œå¦‚æœä½¿ç”¨å“ˆå¸Œï¼Œåˆ™ä»–çš„valueä¸­åªä¼šå­˜å‚¨ä»–æ•°æ®æœ¬èº«ï¼Œå¦‚æœä¸æ˜¯ç‰¹åˆ«åœ¨æ„å†…å­˜ï¼Œå…¶å®ä½¿ç”¨Stringå°±å¯ä»¥å•¦ã€‚</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/1653319261433.png" alt="1653319261433"></p><h4 id="1-2-1ã€è®¾è®¡keyçš„å…·ä½“ç»†èŠ‚">1.2.1ã€è®¾è®¡keyçš„å…·ä½“ç»†èŠ‚</h4><p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨Stringç»“æ„ï¼Œå°±æ˜¯ä¸€ä¸ªç®€å•çš„keyï¼Œvalueé”®å€¼å¯¹çš„æ–¹å¼ï¼Œä½†æ˜¯å…³äºkeyçš„å¤„ç†ï¼Œsessionä»–æ˜¯æ¯ä¸ªç”¨æˆ·éƒ½æœ‰è‡ªå·±çš„sessionï¼Œä½†æ˜¯redisçš„keyæ˜¯å…±äº«çš„ï¼Œå’±ä»¬å°±ä¸èƒ½ä½¿ç”¨codeäº†</p><p>åœ¨è®¾è®¡è¿™ä¸ªkeyçš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¹‹å‰è®²è¿‡éœ€è¦æ»¡è¶³ä¸¤ç‚¹</p><p>1ã€keyè¦å…·æœ‰å”¯ä¸€æ€§</p><p>2ã€keyè¦æ–¹ä¾¿æºå¸¦</p><p>å¦‚æœæˆ‘ä»¬é‡‡ç”¨phoneï¼šæ‰‹æœºå·è¿™ä¸ªçš„æ•°æ®æ¥å­˜å‚¨å½“ç„¶æ˜¯å¯ä»¥çš„ï¼Œä½†æ˜¯å¦‚æœæŠŠè¿™æ ·çš„æ•æ„Ÿæ•°æ®å­˜å‚¨åˆ°redisä¸­å¹¶ä¸”ä»é¡µé¢ä¸­å¸¦è¿‡æ¥æ¯•ç«Ÿä¸å¤ªåˆé€‚ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨åå°ç”Ÿæˆä¸€ä¸ªéšæœºä¸²tokenï¼Œç„¶åè®©å‰ç«¯å¸¦æ¥è¿™ä¸ªtokenå°±èƒ½å®Œæˆæˆ‘ä»¬çš„æ•´ä½“é€»è¾‘äº†</p><h4 id="1-2-2ã€æ•´ä½“è®¿é—®æµç¨‹">1.2.2ã€æ•´ä½“è®¿é—®æµç¨‹</h4><p>å½“æ³¨å†Œå®Œæˆåï¼Œç”¨æˆ·å»ç™»å½•ä¼šå»æ ¡éªŒç”¨æˆ·æäº¤çš„æ‰‹æœºå·å’ŒéªŒè¯ç ï¼Œæ˜¯å¦ä¸€è‡´ï¼Œå¦‚æœä¸€è‡´ï¼Œåˆ™æ ¹æ®æ‰‹æœºå·æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ï¼Œä¸å­˜åœ¨åˆ™æ–°å»ºï¼Œæœ€åå°†ç”¨æˆ·æ•°æ®ä¿å­˜åˆ°redisï¼Œå¹¶ä¸”ç”Ÿæˆtokenä½œä¸ºredisçš„keyï¼Œå½“æˆ‘ä»¬æ ¡éªŒç”¨æˆ·æ˜¯å¦ç™»å½•æ—¶ï¼Œä¼šå»æºå¸¦ç€tokenè¿›è¡Œè®¿é—®ï¼Œä»redisä¸­å–å‡ºtokenå¯¹åº”çš„valueï¼Œåˆ¤æ–­æ˜¯å¦å­˜åœ¨è¿™ä¸ªæ•°æ®ï¼Œå¦‚æœæ²¡æœ‰åˆ™æ‹¦æˆªï¼Œå¦‚æœå­˜åœ¨åˆ™å°†å…¶ä¿å­˜åˆ°threadLocalä¸­ï¼Œå¹¶ä¸”æ”¾è¡Œã€‚</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/1653319474181.png" alt="1653319474181"></p><h3 id="1-3ã€ä½¿ç”¨rediså®ŒæˆçŸ­ä¿¡ç™»å½•">1.3ã€ä½¿ç”¨rediså®ŒæˆçŸ­ä¿¡ç™»å½•</h3><p><strong>UserControllerä»£ç </strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å‘é€æ‰‹æœºéªŒè¯ç </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;code&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">sendCode</span><span class="params">(<span class="meta">@RequestParam(&quot;phone&quot;)</span> String phone)</span> &#123;</span><br><span class="line">    <span class="comment">//å‘é€çŸ­ä¿¡éªŒè¯ç å¹¶ä¿å­˜éªŒè¯ç </span></span><br><span class="line">    <span class="keyword">return</span> userService.sendCode(phone);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç™»å½•åŠŸèƒ½</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> loginForm ç™»å½•å‚æ•°ï¼ŒåŒ…å«æ‰‹æœºå·ã€éªŒè¯ç ï¼›æˆ–è€…æ‰‹æœºå·ã€å¯†ç </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/login&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">login</span><span class="params">(<span class="meta">@RequestBody</span> LoginFormDTO loginForm)</span>&#123;</span><br><span class="line">    <span class="comment">//å®ç°ç™»å½•åŠŸèƒ½</span></span><br><span class="line">    <span class="keyword">return</span> userService.login(loginForm);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>UserServiceImplä»£ç </strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Result <span class="title function_">sendCode</span><span class="params">(String phone)</span> &#123;</span><br><span class="line">    <span class="comment">//æ ¡éªŒæ‰‹æœºå·</span></span><br><span class="line">    <span class="keyword">if</span> (RegexUtils.isPhoneInvalid(phone)) &#123;</span><br><span class="line">        <span class="keyword">return</span> Result.fail(<span class="string">&quot;æ‰‹æœºå·æ ¼å¼é”™è¯¯&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//è·å–éªŒè¯ç code</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">code</span> <span class="operator">=</span> RandomUtil.randomNumbers(<span class="number">4</span>);</span><br><span class="line">    <span class="comment">//å­˜å…¥redis</span></span><br><span class="line">    stringRedisTemplate.opsForValue().set(RedisConstants.LOGIN_CODE_KEY + phone, code, RedisConstants.LOGIN_CODE_TTL, TimeUnit.MINUTES);</span><br><span class="line">    log.debug(<span class="string">&quot;å‘é€éªŒè¯ç  phone=&#123;&#125;,code = &#123;&#125;&quot;</span>,phone, code);</span><br><span class="line">    <span class="keyword">return</span> Result.ok();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">login</span><span class="params">(LoginFormDTO loginForm)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">phone</span> <span class="operator">=</span> loginForm.getPhone();</span><br><span class="line">    <span class="keyword">if</span> (RegexUtils.isPhoneInvalid(phone)) &#123;</span><br><span class="line">        <span class="keyword">return</span> Result.fail(<span class="string">&quot;æ‰‹æœºå·æ ¼å¼é”™è¯¯&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//ç™»å½• è¦å…ˆå°†éªŒè¯ç å–å‡ºæ¥</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">cacheCode</span> <span class="operator">=</span> stringRedisTemplate.opsForValue().get(RedisConstants.LOGIN_CODE_KEY + phone);</span><br><span class="line">    <span class="keyword">if</span> (cacheCode == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> Result.fail(<span class="string">&quot;æ‰‹æœºå·æœªæ³¨å†Œ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">String</span> <span class="variable">code</span> <span class="operator">=</span> loginForm.getCode();</span><br><span class="line">    <span class="comment">//æŸ¥çœ‹æ‰‹æœºå·å’ŒéªŒè¯ç æ˜¯å¦ä¸€è‡´</span></span><br><span class="line">    <span class="keyword">if</span> (!cacheCode.equals(code)) &#123;</span><br><span class="line">        <span class="keyword">return</span> Result.fail(<span class="string">&quot;éªŒè¯ç é”™è¯¯&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 4.ä¸€è‡´ï¼Œæ ¹æ®æ‰‹æœºå·æŸ¥è¯¢ç”¨æˆ· select * from tb_user where phone = ?</span></span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> query().eq(<span class="string">&quot;phone&quot;</span>, phone).one();</span><br><span class="line">    <span class="comment">// 5.åˆ¤æ–­ç”¨æˆ·æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">    <span class="keyword">if</span> (user == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// 6.ä¸å­˜åœ¨ï¼Œåˆ›å»ºæ–°ç”¨æˆ·å¹¶ä¿å­˜</span></span><br><span class="line">        user = createUserWithPhone(phone);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 7.ä¿å­˜ç”¨æˆ·ä¿¡æ¯åˆ° redisä¸­</span></span><br><span class="line">    <span class="comment">// 7.1.éšæœºç”Ÿæˆtokenï¼Œä½œä¸ºç™»å½•ä»¤ç‰Œ</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> UUID.randomUUID().toString();</span><br><span class="line">    <span class="comment">// 7.2.å°†Userå¯¹è±¡è½¬ä¸ºHashMapå­˜å‚¨</span></span><br><span class="line">    <span class="type">UserDTO</span> <span class="variable">userDTO</span> <span class="operator">=</span> BeanUtil.copyProperties(user, UserDTO.class);</span><br><span class="line">    Map&lt;String, Object&gt; userMap = BeanUtil.beanToMap(userDTO,<span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;(),</span><br><span class="line">            CopyOptions.create()</span><br><span class="line">                    .setIgnoreNullValue(<span class="literal">true</span>)</span><br><span class="line">                    .setFieldValueEditor((fieldName,fieldValue)-&gt;fieldValue.toString()));</span><br><span class="line">    stringRedisTemplate.opsForHash().putAll(RedisConstants.LOGIN_USER_KEY + token, userMap);</span><br><span class="line">    <span class="comment">// 7.3.è®¾ç½®tokenæœ‰æ•ˆæœŸ</span></span><br><span class="line">    stringRedisTemplate.expire(RedisConstants.LOGIN_USER_KEY + token, RedisConstants.LOGIN_USER_TTL, TimeUnit.MINUTES);</span><br><span class="line">    <span class="keyword">return</span> Result.ok(token);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1-4-è§£å†³çŠ¶æ€ç™»å½•åˆ·æ–°é—®é¢˜">1.4 è§£å†³çŠ¶æ€ç™»å½•åˆ·æ–°é—®é¢˜</h3><h4 id="1-4-1-åˆå§‹æ–¹æ¡ˆæ€è·¯æ€»ç»“ï¼š">1.4.1 åˆå§‹æ–¹æ¡ˆæ€è·¯æ€»ç»“ï¼š</h4><p>åœ¨è¿™ä¸ªæ–¹æ¡ˆä¸­ï¼Œä»–ç¡®å®å¯ä»¥ä½¿ç”¨å¯¹åº”è·¯å¾„çš„æ‹¦æˆªï¼ŒåŒæ—¶åˆ·æ–°ç™»å½•tokenä»¤ç‰Œçš„å­˜æ´»æ—¶é—´ï¼Œä½†æ˜¯ç°åœ¨è¿™ä¸ªæ‹¦æˆªå™¨ä»–åªæ˜¯æ‹¦æˆªéœ€è¦è¢«æ‹¦æˆªçš„è·¯å¾„ï¼Œå‡è®¾å½“å‰ç”¨æˆ·è®¿é—®äº†ä¸€äº›ä¸éœ€è¦æ‹¦æˆªçš„è·¯å¾„ï¼Œé‚£ä¹ˆè¿™ä¸ªæ‹¦æˆªå™¨å°±ä¸ä¼šç”Ÿæ•ˆï¼Œæ‰€ä»¥æ­¤æ—¶ä»¤ç‰Œåˆ·æ–°çš„åŠ¨ä½œå®é™…ä¸Šå°±ä¸ä¼šæ‰§è¡Œï¼Œæ‰€ä»¥è¿™ä¸ªæ–¹æ¡ˆä»–æ˜¯å­˜åœ¨é—®é¢˜çš„</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/1653320822964.png" alt="1653320822964"></p><h4 id="1-4-2-ä¼˜åŒ–æ–¹æ¡ˆ">1.4.2 ä¼˜åŒ–æ–¹æ¡ˆ</h4><p>æ—¢ç„¶ä¹‹å‰çš„æ‹¦æˆªå™¨æ— æ³•å¯¹ä¸éœ€è¦æ‹¦æˆªçš„è·¯å¾„ç”Ÿæ•ˆï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥æ·»åŠ ä¸€ä¸ªæ‹¦æˆªå™¨ï¼Œåœ¨ç¬¬ä¸€ä¸ªæ‹¦æˆªå™¨ä¸­æ‹¦æˆªæ‰€æœ‰çš„è·¯å¾„ï¼ŒæŠŠç¬¬äºŒä¸ªæ‹¦æˆªå™¨åšçš„äº‹æƒ…æ”¾å…¥åˆ°ç¬¬ä¸€ä¸ªæ‹¦æˆªå™¨ä¸­ï¼ŒåŒæ—¶åˆ·æ–°ä»¤ç‰Œï¼Œå› ä¸ºç¬¬ä¸€ä¸ªæ‹¦æˆªå™¨æœ‰äº†threadLocalçš„æ•°æ®ï¼Œæ‰€ä»¥æ­¤æ—¶ç¬¬äºŒä¸ªæ‹¦æˆªå™¨åªéœ€è¦åˆ¤æ–­æ‹¦æˆªå™¨ä¸­çš„userå¯¹è±¡æ˜¯å¦å­˜åœ¨å³å¯ï¼Œå®Œæˆæ•´ä½“åˆ·æ–°åŠŸèƒ½ã€‚</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/1653320764547.png" alt="1653320764547"></p><h4 id="1-4-3-ä»£ç ">1.4.3 ä»£ç </h4><p><strong>RefreshTokenInterceptor</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RefreshTokenInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> StringRedisTemplate stringRedisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">RefreshTokenInterceptor</span><span class="params">(StringRedisTemplate stringRedisTemplate)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.stringRedisTemplate = stringRedisTemplate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// 1.è·å–è¯·æ±‚å¤´ä¸­çš„token</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> request.getHeader(<span class="string">&quot;authorization&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (StrUtil.isBlank(token)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 2.åŸºäºTOKENè·å–redisä¸­çš„ç”¨æˆ·</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span>  <span class="operator">=</span> LOGIN_USER_KEY + token;</span><br><span class="line">        Map&lt;Object, Object&gt; userMap = stringRedisTemplate.opsForHash().entries(key);</span><br><span class="line">        <span class="comment">// 3.åˆ¤æ–­ç”¨æˆ·æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">        <span class="keyword">if</span> (userMap.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 5.å°†æŸ¥è¯¢åˆ°çš„hashæ•°æ®è½¬ä¸ºUserDTO</span></span><br><span class="line">        <span class="type">UserDTO</span> <span class="variable">userDTO</span> <span class="operator">=</span> BeanUtil.fillBeanWithMap(userMap, <span class="keyword">new</span> <span class="title class_">UserDTO</span>(), <span class="literal">false</span>);</span><br><span class="line">        <span class="comment">// 6.å­˜åœ¨ï¼Œä¿å­˜ç”¨æˆ·ä¿¡æ¯åˆ° ThreadLocal</span></span><br><span class="line">        UserHolder.saveUser(userDTO);</span><br><span class="line">        <span class="comment">// 7.åˆ·æ–°tokenæœ‰æ•ˆæœŸ</span></span><br><span class="line">        stringRedisTemplate.expire(key, LOGIN_USER_TTL, TimeUnit.MINUTES);</span><br><span class="line">        <span class="comment">// 8.æ”¾è¡Œ</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// ç§»é™¤ç”¨æˆ·</span></span><br><span class="line">        UserHolder.removeUser();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>LoginInterceptor</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// 1.åˆ¤æ–­æ˜¯å¦éœ€è¦æ‹¦æˆªï¼ˆThreadLocalä¸­æ˜¯å¦æœ‰ç”¨æˆ·ï¼‰</span></span><br><span class="line">        <span class="keyword">if</span> (UserHolder.getUser() == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">// æ²¡æœ‰ï¼Œéœ€è¦æ‹¦æˆªï¼Œè®¾ç½®çŠ¶æ€ç </span></span><br><span class="line">            response.setStatus(<span class="number">401</span>);</span><br><span class="line">            <span class="comment">// æ‹¦æˆª</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// æœ‰ç”¨æˆ·ï¼Œåˆ™æ”¾è¡Œ</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2ã€å•†æˆ·æŸ¥è¯¢ç¼“å­˜">2ã€å•†æˆ·æŸ¥è¯¢ç¼“å­˜</h2><h3 id="2-1-æ·»åŠ å•†æˆ·ç¼“å­˜">2.1 æ·»åŠ å•†æˆ·ç¼“å­˜</h3><p>åœ¨æˆ‘ä»¬æŸ¥è¯¢å•†æˆ·ä¿¡æ¯æ—¶ï¼Œæˆ‘ä»¬æ˜¯ç›´æ¥æ“ä½œä»æ•°æ®åº“ä¸­å»è¿›è¡ŒæŸ¥è¯¢çš„ï¼Œå¤§è‡´é€»è¾‘æ˜¯è¿™æ ·ï¼Œç›´æ¥æŸ¥è¯¢æ•°æ®åº“é‚£è‚¯å®šæ…¢å’¯ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å¢åŠ ç¼“å­˜</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">queryShopById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span> &#123;</span><br><span class="line">    <span class="comment">//è¿™é‡Œæ˜¯ç›´æ¥æŸ¥è¯¢æ•°æ®åº“</span></span><br><span class="line">    <span class="keyword">return</span> shopService.queryById(id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-1-1-ã€ç¼“å­˜æ¨¡å‹å’Œæ€è·¯">2.1.1 ã€ç¼“å­˜æ¨¡å‹å’Œæ€è·¯</h4><p>æ ‡å‡†çš„æ“ä½œæ–¹å¼å°±æ˜¯æŸ¥è¯¢æ•°æ®åº“ä¹‹å‰å…ˆæŸ¥è¯¢ç¼“å­˜ï¼Œå¦‚æœç¼“å­˜æ•°æ®å­˜åœ¨ï¼Œåˆ™ç›´æ¥ä»ç¼“å­˜ä¸­è¿”å›ï¼Œå¦‚æœç¼“å­˜æ•°æ®ä¸å­˜åœ¨ï¼Œå†æŸ¥è¯¢æ•°æ®åº“ï¼Œç„¶åå°†æ•°æ®å­˜å…¥redisã€‚</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/1653322097736.png" alt="1653322097736"></p><h4 id="2-1-2ã€ä»£ç å®ç°-ä½¿ç”¨SpringCache-ç¼“å­˜åŒå†™">2.1.2ã€ä»£ç å®ç° ä½¿ç”¨SpringCache(ç¼“å­˜åŒå†™)</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Cacheable(cacheNames = CACHE_SHOP_KEY,key = &quot;#id&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Shop <span class="title function_">queryById</span><span class="params">(Serializable id)</span> &#123;</span><br><span class="line">        <span class="type">Shop</span> <span class="variable">shop</span> <span class="operator">=</span> <span class="built_in">this</span>.getById(id);</span><br><span class="line">        <span class="keyword">return</span> shop;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@CacheEvict(cacheNames = CACHE_SHOP_KEY,key = &quot;#shop.id&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateShop</span><span class="params">(Shop shop)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.updateById(shop);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h4 id="2-1-3ã€å®ç°cacheableè®¾ç½®ttl">2.1.3ã€å®ç°cacheableè®¾ç½®ttl</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hmdp.config;</span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CacheConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RedisCacheManager <span class="title function_">cacheManager</span><span class="params">(RedisConnectionFactory connectionFactory)</span> &#123;</span><br><span class="line">        <span class="comment">// åˆ›å»ºObjectMapperç”¨äºå¤„ç†åºåˆ—åŒ–å’Œååºåˆ—åŒ–</span></span><br><span class="line">        <span class="type">ObjectMapper</span> <span class="variable">objectMapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line">        <span class="comment">// æ³¨å†ŒJavaTimeModuleä»¥æ”¯æŒJava 8æ—¥æœŸæ—¶é—´ç±»å‹</span></span><br><span class="line">        objectMapper.registerModule(<span class="keyword">new</span> <span class="title class_">JavaTimeModule</span>());</span><br><span class="line">        <span class="comment">// ç¦ç”¨å°†æ—¥æœŸåºåˆ—åŒ–ä¸ºæ—¶é—´æˆ³æ ¼å¼ï¼Œä¿æŒå¯è¯»æ€§</span></span><br><span class="line">        objectMapper.disable(SerializationFeature.WRITE_DATES_AS_TIMESTAMPS);</span><br><span class="line">        <span class="comment">// å¯ç”¨é»˜è®¤çš„å¤šæ€ç±»å‹ä¿¡æ¯å¤„ç†ï¼Œä»¥ä¾¿åœ¨ååºåˆ—åŒ–æ—¶ä¿ç•™ç±»å‹ä¿¡æ¯</span></span><br><span class="line">        objectMapper.activateDefaultTyping(</span><br><span class="line">                objectMapper.getPolymorphicTypeValidator(),</span><br><span class="line">                ObjectMapper.DefaultTyping.NON_FINAL,</span><br><span class="line">                JsonTypeInfo.As.PROPERTY</span><br><span class="line">        );</span><br><span class="line">        <span class="comment">// åˆ›å»ºé€šç”¨çš„Jackson2 JSON Redisåºåˆ—åŒ–å™¨</span></span><br><span class="line">        <span class="type">GenericJackson2JsonRedisSerializer</span> <span class="variable">serializer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GenericJackson2JsonRedisSerializer</span>(objectMapper);</span><br><span class="line">        <span class="comment">// å®šä¹‰é»˜è®¤çš„ç¼“å­˜é…ç½®ï¼Œè®¾ç½®ç¼“å­˜æ¡ç›®è¿‡æœŸæ—¶é—´ä¸º10åˆ†é’Ÿï¼Œå¹¶ä½¿ç”¨å®šä¹‰å¥½çš„åºåˆ—åŒ–å™¨</span></span><br><span class="line">        <span class="type">RedisCacheConfiguration</span> <span class="variable">defaultConfig</span> <span class="operator">=</span> RedisCacheConfiguration.defaultCacheConfig()</span><br><span class="line">                .entryTtl(Duration.ofMinutes(<span class="number">10</span>))</span><br><span class="line">                .serializeValuesWith(RedisSerializationContext.SerializationPair.fromSerializer(serializer));</span><br><span class="line">        <span class="comment">// åˆ›å»ºç¼“å­˜é…ç½®æ˜ å°„ï¼Œå…è®¸ä¸ºä¸åŒçš„ç¼“å­˜åç§°å®šä¹‰ä¸åŒçš„é…ç½®</span></span><br><span class="line">        Map&lt;String, RedisCacheConfiguration&gt; cacheConfigurations = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">// ä¸ºåº—é“ºç¼“å­˜è®¾ç½®å•ç‹¬çš„è¿‡æœŸæ—¶é—´ï¼ˆ1å°æ—¶ï¼‰</span></span><br><span class="line">        cacheConfigurations.put(CACHE_SHOP_KEY, defaultConfig.entryTtl(Duration.ofDays(<span class="number">1</span>)));</span><br><span class="line">        <span class="comment">// æ„å»ºRedisCacheManagerå®ä¾‹ï¼Œä½¿ç”¨é»˜è®¤é…ç½®å’Œè‡ªå®šä¹‰çš„ç¼“å­˜é…ç½®åˆå§‹åŒ–</span></span><br><span class="line">        <span class="keyword">return</span> RedisCacheManager.builder(connectionFactory)</span><br><span class="line">                .cacheDefaults(defaultConfig)</span><br><span class="line">                .withInitialCacheConfigurations(cacheConfigurations)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-2-è§£å†³ç¼“å­˜ç©¿é€é—®é¢˜">2.2 è§£å†³ç¼“å­˜ç©¿é€é—®é¢˜</h3><p>ç¼“å­˜ç©¿é€å°±æ˜¯å› ä¸ºä¸€èˆ¬è®¾è®¡ä¸šåŠ¡çš„æ—¶å€™ï¼Œä¼šä¼˜å…ˆè®¿é—®ç¼“å­˜ä¸­æ•°æ®æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨è®¿é—®æ•°æ®åº“ï¼Œæ”»å‡»è€…å°±æ˜¯å¯ä»¥ç”¨è¿™ä¸€ç‚¹æ„é€ æ¶æ„è¯·æ±‚ï¼Œå¤šæ¬¡è®¿é—®æ•°æ®åº“ï¼Œå¯¼è‡´æ•°æ®åº“å‹åŠ›è¿‡å¤§ã€‚è¿™ç§æƒ…å†µå¯ä»¥å¯¹è®¿é—®è¯·æ±‚è¿›è¡Œåˆæ³•æ€§æ£€æŸ¥ï¼Œè¿‡æ»¤éæ³•å­—ç¬¦æˆ–è€…ä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨è¿‡æ»¤ï¼Œå†å†³å®šæ˜¯å¦è®¿é—®æ•°æ®åº“ã€‚æˆ–è€…ç»™redisè®¾ç½®nullå€¼æˆ–è€…ç©ºå­—ç¬¦ä¸²ã€‚</p><p>å¸¸è§çš„è§£å†³æ–¹æ¡ˆæœ‰ä¸¤ç§ï¼š</p><ul><li>ç¼“å­˜ç©ºå¯¹è±¡<ul><li>ä¼˜ç‚¹ï¼šå®ç°ç®€å•ï¼Œç»´æŠ¤æ–¹ä¾¿</li><li>ç¼ºç‚¹ï¼š<ul><li>é¢å¤–çš„å†…å­˜æ¶ˆè€—</li><li>å¯èƒ½é€ æˆçŸ­æœŸçš„ä¸ä¸€è‡´</li></ul></li></ul></li><li>å¸ƒéš†è¿‡æ»¤<ul><li>ä¼˜ç‚¹ï¼šå†…å­˜å ç”¨è¾ƒå°‘ï¼Œæ²¡æœ‰å¤šä½™key</li><li>ç¼ºç‚¹ï¼š<ul><li>å®ç°å¤æ‚</li><li>å­˜åœ¨è¯¯åˆ¤å¯èƒ½</li></ul></li></ul></li></ul><p>**ç¼“å­˜ç©ºå¯¹è±¡æ€è·¯åˆ†æï¼š**å½“æˆ‘ä»¬å®¢æˆ·ç«¯è®¿é—®ä¸å­˜åœ¨çš„æ•°æ®æ—¶ï¼Œå…ˆè¯·æ±‚redisï¼Œä½†æ˜¯æ­¤æ—¶redisä¸­æ²¡æœ‰æ•°æ®ï¼Œæ­¤æ—¶ä¼šè®¿é—®åˆ°æ•°æ®åº“ï¼Œä½†æ˜¯æ•°æ®åº“ä¸­ä¹Ÿæ²¡æœ‰æ•°æ®ï¼Œè¿™ä¸ªæ•°æ®ç©¿é€äº†ç¼“å­˜ï¼Œç›´å‡»æ•°æ®åº“ï¼Œæˆ‘ä»¬éƒ½çŸ¥é“æ•°æ®åº“èƒ½å¤Ÿæ‰¿è½½çš„å¹¶å‘ä¸å¦‚redisè¿™ä¹ˆé«˜ï¼Œå¦‚æœå¤§é‡çš„è¯·æ±‚åŒæ—¶è¿‡æ¥è®¿é—®è¿™ç§ä¸å­˜åœ¨çš„æ•°æ®ï¼Œè¿™äº›è¯·æ±‚å°±éƒ½ä¼šè®¿é—®åˆ°æ•°æ®åº“ï¼Œç®€å•çš„è§£å†³æ–¹æ¡ˆå°±æ˜¯å“ªæ€•è¿™ä¸ªæ•°æ®åœ¨æ•°æ®åº“ä¸­ä¹Ÿä¸å­˜åœ¨ï¼Œæˆ‘ä»¬ä¹ŸæŠŠè¿™ä¸ªæ•°æ®å­˜å…¥åˆ°redisä¸­å»ï¼Œè¿™æ ·ï¼Œä¸‹æ¬¡ç”¨æˆ·è¿‡æ¥è®¿é—®è¿™ä¸ªä¸å­˜åœ¨çš„æ•°æ®ï¼Œé‚£ä¹ˆåœ¨redisä¸­ä¹Ÿèƒ½æ‰¾åˆ°è¿™ä¸ªæ•°æ®å°±ä¸ä¼šè¿›å…¥åˆ°ç¼“å­˜äº†</p><p>**å¸ƒéš†è¿‡æ»¤ï¼š**å¸ƒéš†è¿‡æ»¤å™¨å…¶å®é‡‡ç”¨çš„æ˜¯å“ˆå¸Œæ€æƒ³æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œé€šè¿‡ä¸€ä¸ªåºå¤§çš„äºŒè¿›åˆ¶æ•°ç»„ï¼Œèµ°å“ˆå¸Œæ€æƒ³å»åˆ¤æ–­å½“å‰è¿™ä¸ªè¦æŸ¥è¯¢çš„è¿™ä¸ªæ•°æ®æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå¸ƒéš†è¿‡æ»¤å™¨åˆ¤æ–­å­˜åœ¨ï¼Œåˆ™æ”¾è¡Œï¼Œè¿™ä¸ªè¯·æ±‚ä¼šå»è®¿é—®redisï¼Œå“ªæ€•æ­¤æ—¶redisä¸­çš„æ•°æ®è¿‡æœŸäº†ï¼Œä½†æ˜¯æ•°æ®åº“ä¸­ä¸€å®šå­˜åœ¨è¿™ä¸ªæ•°æ®ï¼Œåœ¨æ•°æ®åº“ä¸­æŸ¥è¯¢å‡ºæ¥è¿™ä¸ªæ•°æ®åï¼Œå†å°†å…¶æ”¾å…¥åˆ°redisä¸­ï¼Œ</p><p>å‡è®¾å¸ƒéš†è¿‡æ»¤å™¨åˆ¤æ–­è¿™ä¸ªæ•°æ®ä¸å­˜åœ¨ï¼Œåˆ™ç›´æ¥è¿”å›</p><p>è¿™ç§æ–¹å¼ä¼˜ç‚¹åœ¨äºèŠ‚çº¦å†…å­˜ç©ºé—´ï¼Œå­˜åœ¨è¯¯åˆ¤ï¼Œè¯¯åˆ¤åŸå› åœ¨äºï¼šå¸ƒéš†è¿‡æ»¤å™¨èµ°çš„æ˜¯å“ˆå¸Œæ€æƒ³ï¼Œåªè¦å“ˆå¸Œæ€æƒ³ï¼Œå°±å¯èƒ½å­˜åœ¨å“ˆå¸Œå†²çª</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/1653326156516.png" alt="1653326156516"></p><h4 id="2-2-1-ç¼–ç è§£å†³å•†å“æŸ¥è¯¢çš„ç¼“å­˜ç©¿é€é—®é¢˜ï¼š">2.2.1 ç¼–ç è§£å†³å•†å“æŸ¥è¯¢çš„ç¼“å­˜ç©¿é€é—®é¢˜ï¼š</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Cacheable(cacheNames = CACHE_SHOP_KEY,key = &quot;#id&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Shop <span class="title function_">queryById</span><span class="params">(Serializable id)</span> &#123;</span><br><span class="line">        <span class="type">Shop</span> <span class="variable">shop</span> <span class="operator">=</span> <span class="built_in">this</span>.getById(id);</span><br><span class="line">        <span class="keyword">if</span> (shop == <span class="literal">null</span>)&#123;    <span class="comment">//ç¼“å­˜ç©¿é€()</span></span><br><span class="line">            <span class="comment">//ç¼“å­˜ç©¿é€</span></span><br><span class="line">            stringRedisTemplate.opsForValue().set(CACHE_SHOP_KEY +id,<span class="string">&quot;&quot;</span>,CACHE_NULL_TTL, TimeUnit.MINUTES);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> shop;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>æ ¸å¿ƒæ€è·¯å¦‚ä¸‹ï¼š</p><p>åœ¨åŸæ¥çš„é€»è¾‘ä¸­ï¼Œæˆ‘ä»¬å¦‚æœå‘ç°è¿™ä¸ªæ•°æ®åœ¨mysqlä¸­ä¸å­˜åœ¨ï¼Œç›´æ¥å°±è¿”å›404äº†ï¼Œè¿™æ ·æ˜¯ä¼šå­˜åœ¨ç¼“å­˜ç©¿é€é—®é¢˜çš„</p><p>ç°åœ¨çš„é€»è¾‘ä¸­ï¼šå¦‚æœè¿™ä¸ªæ•°æ®ä¸å­˜åœ¨ï¼Œæˆ‘ä»¬ä¸ä¼šè¿”å›404 ï¼Œè¿˜æ˜¯ä¼šæŠŠè¿™ä¸ªæ•°æ®å†™å…¥åˆ°Redisä¸­ï¼Œå¹¶ä¸”å°†valueè®¾ç½®ä¸ºç©ºï¼Œæ¬§å½“å†æ¬¡å‘èµ·æŸ¥è¯¢æ—¶ï¼Œæˆ‘ä»¬å¦‚æœå‘ç°å‘½ä¸­ä¹‹åï¼Œåˆ¤æ–­è¿™ä¸ªvalueæ˜¯å¦æ˜¯nullï¼Œå¦‚æœæ˜¯nullï¼Œåˆ™æ˜¯ä¹‹å‰å†™å…¥çš„æ•°æ®ï¼Œè¯æ˜æ˜¯ç¼“å­˜ç©¿é€æ•°æ®ï¼Œå¦‚æœä¸æ˜¯ï¼Œåˆ™ç›´æ¥è¿”å›æ•°æ®ã€‚</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/1653327124561.png" alt="1653327124561"></p><p><strong>å°æ€»ç»“ï¼š</strong></p><p>ç¼“å­˜ç©¿é€äº§ç”Ÿçš„åŸå› æ˜¯ä»€ä¹ˆï¼Ÿ</p><ul><li>ç”¨æˆ·è¯·æ±‚çš„æ•°æ®åœ¨ç¼“å­˜ä¸­å’Œæ•°æ®åº“ä¸­éƒ½ä¸å­˜åœ¨ï¼Œä¸æ–­å‘èµ·è¿™æ ·çš„è¯·æ±‚ï¼Œç»™æ•°æ®åº“å¸¦æ¥å·¨å¤§å‹åŠ›</li></ul><p>ç¼“å­˜ç©¿é€çš„è§£å†³æ–¹æ¡ˆæœ‰å“ªäº›ï¼Ÿ</p><ul><li>ç¼“å­˜nullå€¼</li><li>å¸ƒéš†è¿‡æ»¤</li><li>å¢å¼ºidçš„å¤æ‚åº¦ï¼Œé¿å…è¢«çŒœæµ‹idè§„å¾‹</li><li>åšå¥½æ•°æ®çš„åŸºç¡€æ ¼å¼æ ¡éªŒ</li><li>åŠ å¼ºç”¨æˆ·æƒé™æ ¡éªŒ</li><li>åšå¥½çƒ­ç‚¹å‚æ•°çš„é™æµ</li></ul><h3 id="2-3-ç¼“å­˜é›ªå´©é—®é¢˜åŠè§£å†³æ€è·¯">2.3 ç¼“å­˜é›ªå´©é—®é¢˜åŠè§£å†³æ€è·¯</h3><p>ç¼“å­˜é›ªå´©æ˜¯æŒ‡åœ¨åŒä¸€æ—¶æ®µå¤§é‡çš„ç¼“å­˜keyåŒæ—¶å¤±æ•ˆæˆ–è€…RedisæœåŠ¡å®•æœºï¼Œå¯¼è‡´å¤§é‡è¯·æ±‚åˆ°è¾¾æ•°æ®åº“ï¼Œå¸¦æ¥å·¨å¤§å‹åŠ›ã€‚</p><p>è§£å†³æ–¹æ¡ˆï¼š</p><ul><li>ç»™ä¸åŒçš„Keyçš„TTLæ·»åŠ éšæœºå€¼</li><li>åˆ©ç”¨Redisé›†ç¾¤æé«˜æœåŠ¡çš„å¯ç”¨æ€§</li><li>ç»™ç¼“å­˜ä¸šåŠ¡æ·»åŠ é™çº§é™æµç­–ç•¥</li><li>ç»™ä¸šåŠ¡æ·»åŠ å¤šçº§ç¼“å­˜</li></ul><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/1653327884526.png" alt="1653327884526"></p><h3 id="2-4-ç¼“å­˜å‡»ç©¿é—®é¢˜åŠè§£å†³æ€è·¯">2.4 ç¼“å­˜å‡»ç©¿é—®é¢˜åŠè§£å†³æ€è·¯</h3><p>ç¼“å­˜å‡»ç©¿é—®é¢˜ä¹Ÿå«çƒ­ç‚¹Keyé—®é¢˜ï¼Œå°±æ˜¯ä¸€ä¸ªè¢«é«˜å¹¶å‘è®¿é—®å¹¶ä¸”ç¼“å­˜é‡å»ºä¸šåŠ¡è¾ƒå¤æ‚çš„keyçªç„¶å¤±æ•ˆäº†ï¼Œæ— æ•°çš„è¯·æ±‚è®¿é—®ä¼šåœ¨ç¬é—´ç»™æ•°æ®åº“å¸¦æ¥å·¨å¤§çš„å†²å‡»ã€‚</p><p>å¸¸è§çš„è§£å†³æ–¹æ¡ˆæœ‰ä¸¤ç§ï¼š</p><ul><li>äº’æ–¥é”</li><li>é€»è¾‘è¿‡æœŸ</li></ul><p>é€»è¾‘åˆ†æï¼šå‡è®¾çº¿ç¨‹1åœ¨æŸ¥è¯¢ç¼“å­˜ä¹‹åï¼Œæœ¬æ¥åº”è¯¥å»æŸ¥è¯¢æ•°æ®åº“ï¼Œç„¶åæŠŠè¿™ä¸ªæ•°æ®é‡æ–°åŠ è½½åˆ°ç¼“å­˜çš„ï¼Œæ­¤æ—¶åªè¦çº¿ç¨‹1èµ°å®Œè¿™ä¸ªé€»è¾‘ï¼Œå…¶ä»–çº¿ç¨‹å°±éƒ½èƒ½ä»ç¼“å­˜ä¸­åŠ è½½è¿™äº›æ•°æ®äº†ï¼Œä½†æ˜¯å‡è®¾åœ¨çº¿ç¨‹1æ²¡æœ‰èµ°å®Œçš„æ—¶å€™ï¼Œåç»­çš„çº¿ç¨‹2ï¼Œçº¿ç¨‹3ï¼Œçº¿ç¨‹4åŒæ—¶è¿‡æ¥è®¿é—®å½“å‰è¿™ä¸ªæ–¹æ³•ï¼Œ é‚£ä¹ˆè¿™äº›çº¿ç¨‹éƒ½ä¸èƒ½ä»ç¼“å­˜ä¸­æŸ¥è¯¢åˆ°æ•°æ®ï¼Œé‚£ä¹ˆä»–ä»¬å°±ä¼šåŒä¸€æ—¶åˆ»æ¥è®¿é—®æŸ¥è¯¢ç¼“å­˜ï¼Œéƒ½æ²¡æŸ¥åˆ°ï¼Œæ¥ç€åŒä¸€æ—¶é—´å»è®¿é—®æ•°æ®åº“ï¼ŒåŒæ—¶çš„å»æ‰§è¡Œæ•°æ®åº“ä»£ç ï¼Œå¯¹æ•°æ®åº“è®¿é—®å‹åŠ›è¿‡å¤§</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/1653328022622.png" alt="1653328022622"></p><p>è§£å†³æ–¹æ¡ˆä¸€ã€ä½¿ç”¨é”æ¥è§£å†³ï¼š</p><p>å› ä¸ºé”èƒ½å®ç°äº’æ–¥æ€§ã€‚å‡è®¾çº¿ç¨‹è¿‡æ¥ï¼Œåªèƒ½ä¸€ä¸ªäººä¸€ä¸ªäººçš„æ¥è®¿é—®æ•°æ®åº“ï¼Œä»è€Œé¿å…å¯¹äºæ•°æ®åº“è®¿é—®å‹åŠ›è¿‡å¤§ï¼Œä½†è¿™ä¹Ÿä¼šå½±å“æŸ¥è¯¢çš„æ€§èƒ½ï¼Œå› ä¸ºæ­¤æ—¶ä¼šè®©æŸ¥è¯¢çš„æ€§èƒ½ä»å¹¶è¡Œå˜æˆäº†ä¸²è¡Œï¼Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨tryLockæ–¹æ³• + double checkæ¥è§£å†³è¿™æ ·çš„é—®é¢˜ã€‚</p><p>å‡è®¾ç°åœ¨çº¿ç¨‹1è¿‡æ¥è®¿é—®ï¼Œä»–æŸ¥è¯¢ç¼“å­˜æ²¡æœ‰å‘½ä¸­ï¼Œä½†æ˜¯æ­¤æ—¶ä»–è·å¾—åˆ°äº†é”çš„èµ„æºï¼Œé‚£ä¹ˆçº¿ç¨‹1å°±ä¼šä¸€ä¸ªäººå»æ‰§è¡Œé€»è¾‘ï¼Œå‡è®¾ç°åœ¨çº¿ç¨‹2è¿‡æ¥ï¼Œçº¿ç¨‹2åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå¹¶æ²¡æœ‰è·å¾—åˆ°é”ï¼Œé‚£ä¹ˆçº¿ç¨‹2å°±å¯ä»¥è¿›è¡Œåˆ°ä¼‘çœ ï¼Œç›´åˆ°çº¿ç¨‹1æŠŠé”é‡Šæ”¾åï¼Œçº¿ç¨‹2è·å¾—åˆ°é”ï¼Œç„¶åå†æ¥æ‰§è¡Œé€»è¾‘ï¼Œæ­¤æ—¶å°±èƒ½å¤Ÿä»ç¼“å­˜ä¸­æ‹¿åˆ°æ•°æ®äº†ã€‚</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/1653328288627.png" alt="1653328288627"></p><p>è§£å†³æ–¹æ¡ˆäºŒã€é€»è¾‘è¿‡æœŸæ–¹æ¡ˆ</p><p>æ–¹æ¡ˆåˆ†æï¼šæˆ‘ä»¬ä¹‹æ‰€ä»¥ä¼šå‡ºç°è¿™ä¸ªç¼“å­˜å‡»ç©¿é—®é¢˜ï¼Œä¸»è¦åŸå› æ˜¯åœ¨äºæˆ‘ä»¬å¯¹keyè®¾ç½®äº†è¿‡æœŸæ—¶é—´ï¼Œå‡è®¾æˆ‘ä»¬ä¸è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œå…¶å®å°±ä¸ä¼šæœ‰ç¼“å­˜å‡»ç©¿çš„é—®é¢˜ï¼Œä½†æ˜¯ä¸è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œè¿™æ ·æ•°æ®ä¸å°±ä¸€ç›´å ç”¨æˆ‘ä»¬å†…å­˜äº†å—ï¼Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨é€»è¾‘è¿‡æœŸæ–¹æ¡ˆã€‚</p><p>æˆ‘ä»¬æŠŠè¿‡æœŸæ—¶é—´è®¾ç½®åœ¨ redisçš„valueä¸­ï¼Œæ³¨æ„ï¼šè¿™ä¸ªè¿‡æœŸæ—¶é—´å¹¶ä¸ä¼šç›´æ¥ä½œç”¨äºredisï¼Œè€Œæ˜¯æˆ‘ä»¬åç»­é€šè¿‡é€»è¾‘å»å¤„ç†ã€‚å‡è®¾çº¿ç¨‹1å»æŸ¥è¯¢ç¼“å­˜ï¼Œç„¶åä»valueä¸­åˆ¤æ–­å‡ºæ¥å½“å‰çš„æ•°æ®å·²ç»è¿‡æœŸäº†ï¼Œæ­¤æ—¶çº¿ç¨‹1å»è·å¾—äº’æ–¥é”ï¼Œé‚£ä¹ˆå…¶ä»–çº¿ç¨‹ä¼šè¿›è¡Œé˜»å¡ï¼Œè·å¾—äº†é”çš„çº¿ç¨‹ä»–ä¼šå¼€å¯ä¸€ä¸ª çº¿ç¨‹å»è¿›è¡Œ ä»¥å‰çš„é‡æ„æ•°æ®çš„é€»è¾‘ï¼Œç›´åˆ°æ–°å¼€çš„çº¿ç¨‹å®Œæˆè¿™ä¸ªé€»è¾‘åï¼Œæ‰é‡Šæ”¾é”ï¼Œ è€Œçº¿ç¨‹1ç›´æ¥è¿›è¡Œè¿”å›ï¼Œå‡è®¾ç°åœ¨çº¿ç¨‹3è¿‡æ¥è®¿é—®ï¼Œç”±äºçº¿ç¨‹çº¿ç¨‹2æŒæœ‰ç€é”ï¼Œæ‰€ä»¥çº¿ç¨‹3æ— æ³•è·å¾—é”ï¼Œçº¿ç¨‹3ä¹Ÿç›´æ¥è¿”å›æ•°æ®ï¼Œåªæœ‰ç­‰åˆ°æ–°å¼€çš„çº¿ç¨‹2æŠŠé‡å»ºæ•°æ®æ„å»ºå®Œåï¼Œå…¶ä»–çº¿ç¨‹æ‰èƒ½èµ°è¿”å›æ­£ç¡®çš„æ•°æ®ã€‚</p><p>è¿™ç§æ–¹æ¡ˆå·§å¦™åœ¨äºï¼Œå¼‚æ­¥çš„æ„å»ºç¼“å­˜ï¼Œç¼ºç‚¹åœ¨äºåœ¨æ„å»ºå®Œç¼“å­˜ä¹‹å‰ï¼Œè¿”å›çš„éƒ½æ˜¯è„æ•°æ®ã€‚</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/1653328663897.png" alt="1653328663897"></p><p>è¿›è¡Œå¯¹æ¯”</p><p>**äº’æ–¥é”æ–¹æ¡ˆï¼š**ç”±äºä¿è¯äº†äº’æ–¥æ€§ï¼Œæ‰€ä»¥æ•°æ®ä¸€è‡´ï¼Œä¸”å®ç°ç®€å•ï¼Œå› ä¸ºä»…ä»…åªéœ€è¦åŠ ä¸€æŠŠé”è€Œå·²ï¼Œä¹Ÿæ²¡å…¶ä»–çš„äº‹æƒ…éœ€è¦æ“å¿ƒï¼Œæ‰€ä»¥æ²¡æœ‰é¢å¤–çš„å†…å­˜æ¶ˆè€—ï¼Œç¼ºç‚¹åœ¨äºæœ‰é”å°±æœ‰æ­»é”é—®é¢˜çš„å‘ç”Ÿï¼Œä¸”åªèƒ½ä¸²è¡Œæ‰§è¡Œæ€§èƒ½è‚¯å®šå—åˆ°å½±å“</p><p><strong>é€»è¾‘è¿‡æœŸæ–¹æ¡ˆï¼š</strong> çº¿ç¨‹è¯»å–è¿‡ç¨‹ä¸­ä¸éœ€è¦ç­‰å¾…ï¼Œæ€§èƒ½å¥½ï¼Œæœ‰ä¸€ä¸ªé¢å¤–çš„çº¿ç¨‹æŒæœ‰é”å»è¿›è¡Œé‡æ„æ•°æ®ï¼Œä½†æ˜¯åœ¨é‡æ„æ•°æ®å®Œæˆå‰ï¼Œå…¶ä»–çš„çº¿ç¨‹åªèƒ½è¿”å›ä¹‹å‰çš„æ•°æ®ï¼Œä¸”å®ç°èµ·æ¥éº»çƒ¦</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/1653357522914.png" alt="1653357522914"></p><h3 id="2-5-åˆ©ç”¨äº’æ–¥é”è§£å†³ç¼“å­˜å‡»ç©¿é—®é¢˜">2.5 åˆ©ç”¨äº’æ–¥é”è§£å†³ç¼“å­˜å‡»ç©¿é—®é¢˜</h3><p>æ ¸å¿ƒæ€è·¯ï¼šç›¸è¾ƒäºåŸæ¥ä»ç¼“å­˜ä¸­æŸ¥è¯¢ä¸åˆ°æ•°æ®åç›´æ¥æŸ¥è¯¢æ•°æ®åº“è€Œè¨€ï¼Œç°åœ¨çš„æ–¹æ¡ˆæ˜¯ è¿›è¡ŒæŸ¥è¯¢ä¹‹åï¼Œå¦‚æœä»ç¼“å­˜æ²¡æœ‰æŸ¥è¯¢åˆ°æ•°æ®ï¼Œåˆ™è¿›è¡Œäº’æ–¥é”çš„è·å–ï¼Œè·å–äº’æ–¥é”åï¼Œåˆ¤æ–­æ˜¯å¦è·å¾—åˆ°äº†é”ï¼Œå¦‚æœæ²¡æœ‰è·å¾—åˆ°ï¼Œåˆ™ä¼‘çœ ï¼Œè¿‡ä¸€ä¼šå†è¿›è¡Œå°è¯•ï¼Œç›´åˆ°è·å–åˆ°é”ä¸ºæ­¢ï¼Œæ‰èƒ½è¿›è¡ŒæŸ¥è¯¢</p><p>å¦‚æœè·å–åˆ°äº†é”çš„çº¿ç¨‹ï¼Œå†å»è¿›è¡ŒæŸ¥è¯¢ï¼ŒæŸ¥è¯¢åå°†æ•°æ®å†™å…¥redisï¼Œå†é‡Šæ”¾é”ï¼Œè¿”å›æ•°æ®ï¼Œåˆ©ç”¨äº’æ–¥é”å°±èƒ½ä¿è¯åªæœ‰ä¸€ä¸ªçº¿ç¨‹å»æ‰§è¡Œæ“ä½œæ•°æ®åº“çš„é€»è¾‘ï¼Œé˜²æ­¢ç¼“å­˜å‡»ç©¿</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/1653357860001.png" alt="1653357860001"></p><p><strong>æ“ä½œé”çš„ä»£ç ï¼š</strong></p><p>æ ¸å¿ƒæ€è·¯å°±æ˜¯åˆ©ç”¨redisçš„setnxæ–¹æ³•æ¥è¡¨ç¤ºè·å–é”ï¼Œè¯¥æ–¹æ³•å«ä¹‰æ˜¯redisä¸­å¦‚æœæ²¡æœ‰è¿™ä¸ªkeyï¼Œåˆ™æ’å…¥æˆåŠŸï¼Œè¿”å›1ï¼Œåœ¨stringRedisTemplateä¸­è¿”å›trueï¼Œ  å¦‚æœæœ‰è¿™ä¸ªkeyåˆ™æ’å…¥å¤±è´¥ï¼Œåˆ™è¿”å›0ï¼Œåœ¨stringRedisTemplateè¿”å›falseï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡trueï¼Œæˆ–è€…æ˜¯falseï¼Œæ¥è¡¨ç¤ºæ˜¯å¦æœ‰çº¿ç¨‹æˆåŠŸæ’å…¥keyï¼ŒæˆåŠŸæ’å…¥çš„keyçš„çº¿ç¨‹æˆ‘ä»¬è®¤ä¸ºä»–å°±æ˜¯è·å¾—åˆ°é”çš„çº¿ç¨‹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">tryLock</span><span class="params">(String key)</span> &#123;</span><br><span class="line">    <span class="type">Boolean</span> <span class="variable">flag</span> <span class="operator">=</span> stringRedisTemplate.opsForValue().setIfAbsent(key, <span class="string">&quot;1&quot;</span>, <span class="number">10</span>, TimeUnit.SECONDS);</span><br><span class="line">    <span class="keyword">return</span> BooleanUtil.isTrue(flag);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">unlock</span><span class="params">(String key)</span> &#123;</span><br><span class="line">    stringRedisTemplate.delete(key);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ“ä½œä»£ç ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ç¼“å­˜å‡»ç©¿ äº’æ–¥é”</span></span><br><span class="line"><span class="keyword">public</span> Shop <span class="title function_">queryRedis</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> CACHE_SHOP_KEY + id; <span class="comment">//ç¼“å­˜key</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">shopValue</span> <span class="operator">=</span> stringRedisTemplate.opsForValue().get(key);</span><br><span class="line">    <span class="comment">//æ˜¯å¦å­˜åœ¨ç¼“å­˜</span></span><br><span class="line">    <span class="keyword">if</span> (StrUtil.isNotBlank(shopValue))&#123;</span><br><span class="line">        <span class="keyword">return</span> JSONUtil.toBean(shopValue, Shop.class);<span class="comment">//ç›´æ¥è¿”å›</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//æ˜¯å¦æ˜¯ç©ºå€¼</span></span><br><span class="line">    <span class="keyword">if</span> (shopValue != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;<span class="comment">//ç©ºå€¼è¿”å›</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//ç¼“å­˜é‡å»º</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">lockKey</span> <span class="operator">=</span> LOCK_SHOP_KEY + id;</span><br><span class="line">    Shop shop;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">isLock</span> <span class="operator">=</span> tryLock(lockKey);</span><br><span class="line">        <span class="keyword">if</span> (!isLock)&#123;</span><br><span class="line">            <span class="comment">//æ²¡é” ç­‰å¾…</span></span><br><span class="line">            Thread.sleep(<span class="number">50</span>);</span><br><span class="line">            <span class="keyword">return</span> queryRedis(id);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//æˆåŠŸ</span></span><br><span class="line">        shop = getById(id);</span><br><span class="line">        Thread.sleep(<span class="number">500</span>);<span class="comment">//æ¨¡æ‹Ÿé‡å»ºå»¶è¿Ÿ</span></span><br><span class="line">        <span class="keyword">if</span> (shop == <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="comment">//ç¼“å­˜ç©¿é€</span></span><br><span class="line">            stringRedisTemplate.opsForValue().set(CACHE_SHOP_KEY+id,<span class="string">&quot;&quot;</span>,CACHE_NULL_TTL, TimeUnit.MINUTES);</span><br><span class="line">        &#125;</span><br><span class="line">        stringRedisTemplate.opsForValue().set(CACHE_SHOP_KEY+id, JSONUtil.toJsonStr(shop),CACHE_SHOP_TTL, TimeUnit.MINUTES);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        unLock(lockKey);<span class="comment">//é‡Šæ”¾é”</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> shop;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-6ã€åˆ©ç”¨é€»è¾‘è¿‡æœŸè§£å†³ç¼“å­˜å‡»ç©¿é—®é¢˜">2.6ã€åˆ©ç”¨é€»è¾‘è¿‡æœŸè§£å†³ç¼“å­˜å‡»ç©¿é—®é¢˜</h3><p><strong>éœ€æ±‚ï¼šä¿®æ”¹æ ¹æ®idæŸ¥è¯¢å•†é“ºçš„ä¸šåŠ¡ï¼ŒåŸºäºé€»è¾‘è¿‡æœŸæ–¹å¼æ¥è§£å†³ç¼“å­˜å‡»ç©¿é—®é¢˜</strong></p><p>æ€è·¯åˆ†æï¼šå½“ç”¨æˆ·å¼€å§‹æŸ¥è¯¢redisæ—¶ï¼Œåˆ¤æ–­æ˜¯å¦å‘½ä¸­ï¼Œå¦‚æœæ²¡æœ‰å‘½ä¸­åˆ™ç›´æ¥è¿”å›ç©ºæ•°æ®ï¼Œä¸æŸ¥è¯¢æ•°æ®åº“ï¼Œè€Œä¸€æ—¦å‘½ä¸­åï¼Œå°†valueå–å‡ºï¼Œåˆ¤æ–­valueä¸­çš„è¿‡æœŸæ—¶é—´æ˜¯å¦æ»¡è¶³ï¼Œå¦‚æœæ²¡æœ‰è¿‡æœŸï¼Œåˆ™ç›´æ¥è¿”å›redisä¸­çš„æ•°æ®ï¼Œå¦‚æœè¿‡æœŸï¼Œåˆ™åœ¨å¼€å¯ç‹¬ç«‹çº¿ç¨‹åç›´æ¥è¿”å›ä¹‹å‰çš„æ•°æ®ï¼Œç‹¬ç«‹çº¿ç¨‹å»é‡æ„æ•°æ®ï¼Œé‡æ„å®Œæˆåé‡Šæ”¾äº’æ–¥é”ã€‚</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/1653360308731.png" alt="1653360308731"></p><p>å¦‚æœå°è£…æ•°æ®ï¼šå› ä¸ºç°åœ¨redisä¸­å­˜å‚¨çš„æ•°æ®çš„valueéœ€è¦å¸¦ä¸Šè¿‡æœŸæ—¶é—´ï¼Œæ­¤æ—¶è¦ä¹ˆä½ å»ä¿®æ”¹åŸæ¥çš„å®ä½“ç±»ï¼Œè¦ä¹ˆä½ </p><p><strong>æ­¥éª¤ä¸€ã€</strong></p><p>æ–°å»ºä¸€ä¸ªå®ä½“ç±»ï¼Œæˆ‘ä»¬é‡‡ç”¨ç¬¬äºŒä¸ªæ–¹æ¡ˆï¼Œè¿™ä¸ªæ–¹æ¡ˆï¼Œå¯¹åŸæ¥ä»£ç æ²¡æœ‰ä¾µå…¥æ€§ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisData</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> LocalDateTime expireTime;</span><br><span class="line">    <span class="keyword">private</span> Object data;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ­¥éª¤äºŒã€</strong></p><p>åœ¨<strong>ShopServiceImpl</strong> æ–°å¢æ­¤æ–¹æ³•ï¼Œåˆ©ç”¨å•å…ƒæµ‹è¯•è¿›è¡Œç¼“å­˜é¢„çƒ­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveShopRedis</span><span class="params">(Long id, Long time)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    <span class="type">RedisData</span> <span class="variable">redisData</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RedisData</span>();</span><br><span class="line">    <span class="type">Shop</span> <span class="variable">shop</span> <span class="operator">=</span> getById(id);</span><br><span class="line">    Thread.sleep(<span class="number">200</span>);<span class="comment">//æ¨¡æ‹Ÿè€—æ—¶ çº¿ç¨‹å¹¶å‘æµ‹è¯•</span></span><br><span class="line">    redisData.setData(shop);</span><br><span class="line">    redisData.setExpireTime(LocalDateTime.now().plusSeconds(time));</span><br><span class="line">    stringRedisTemplate.opsForValue().set(RedisConstants.CACHE_SHOP_KEY + id, JSONUtil.toJsonStr(redisData));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å•å…ƒæµ‹è¯•</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">textSaveShop</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    shopService.saveShopRedis(<span class="number">1L</span>,<span class="number">10L</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­¥éª¤ä¸‰ï¼šæ­£å¼ä»£ç </p><p><strong>ShopServiceImpl</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">ExecutorService</span> <span class="variable">CACHE_REBUILD_EXECUTOR</span> <span class="operator">=</span> Executors.newFixedThreadPool(<span class="number">10</span>);</span><br><span class="line"><span class="keyword">public</span> Shop <span class="title function_">queryWithLogicalExpire</span><span class="params">( Long id )</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> CACHE_SHOP_KEY + id;</span><br><span class="line">    <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> stringRedisTemplate.opsForValue().get(key);</span><br><span class="line">    <span class="comment">//æœªå‘½ä¸­ è¿”å›ç©º</span></span><br><span class="line">    <span class="keyword">if</span> (StrUtil.isBlank(json))&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//å‘½ä¸­ ååºåˆ—åŒ–</span></span><br><span class="line">    <span class="type">RedisData</span> <span class="variable">redisData</span> <span class="operator">=</span> JSONUtil.toBean(json, RedisData.class);</span><br><span class="line">    <span class="type">Shop</span> <span class="variable">shop</span> <span class="operator">=</span> JSONUtil.toBean((JSONObject) redisData.getData(), Shop.class);</span><br><span class="line">    <span class="comment">//åˆ¤æ–­æ˜¯å¦è¿‡æœŸ</span></span><br><span class="line">    <span class="type">LocalDateTime</span> <span class="variable">expireTime</span> <span class="operator">=</span> redisData.getExpireTime();</span><br><span class="line">    <span class="keyword">if</span> (expireTime.isAfter(LocalDateTime.now()))&#123;</span><br><span class="line">        <span class="comment">//æœªè¿‡æœŸ</span></span><br><span class="line">        <span class="keyword">return</span> shop;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//è¿‡æœŸ ç¼“å­˜é‡å»º</span></span><br><span class="line">    <span class="comment">// 6.1.è·å–äº’æ–¥é”</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">lockKey</span> <span class="operator">=</span> LOCK_SHOP_KEY + id;</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">isLock</span> <span class="operator">=</span> tryLock(lockKey);</span><br><span class="line">    <span class="comment">// 6.2.åˆ¤æ–­æ˜¯å¦è·å–é”æˆåŠŸ</span></span><br><span class="line">    <span class="keyword">if</span> (isLock)&#123;</span><br><span class="line">        CACHE_REBUILD_EXECUTOR.submit( ()-&gt;&#123;</span><br><span class="line">            <span class="keyword">try</span>&#123;</span><br><span class="line">                <span class="comment">//é‡å»ºç¼“å­˜</span></span><br><span class="line">                <span class="built_in">this</span>.saveShopRedis(id,<span class="number">20L</span>);</span><br><span class="line">            &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">            &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">                 unLock(lockKey);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 6.4.è¿”å›è¿‡æœŸçš„å•†é“ºä¿¡æ¯</span></span><br><span class="line">    <span class="keyword">return</span> shop;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-7ã€å°è£…Rediså·¥å…·ç±»">2.7ã€å°è£…Rediså·¥å…·ç±»</h3><p>åŸºäºStringRedisTemplateå°è£…ä¸€ä¸ªç¼“å­˜å·¥å…·ç±»ï¼Œæ»¡è¶³ä¸‹åˆ—éœ€æ±‚ï¼š</p><ul><li>æ–¹æ³•1ï¼šå°†ä»»æ„Javaå¯¹è±¡åºåˆ—åŒ–ä¸ºjsonå¹¶å­˜å‚¨åœ¨stringç±»å‹çš„keyä¸­ï¼Œå¹¶ä¸”å¯ä»¥è®¾ç½®TTLè¿‡æœŸæ—¶é—´</li><li>æ–¹æ³•2ï¼šå°†ä»»æ„Javaå¯¹è±¡åºåˆ—åŒ–ä¸ºjsonå¹¶å­˜å‚¨åœ¨stringç±»å‹çš„keyä¸­ï¼Œå¹¶ä¸”å¯ä»¥è®¾ç½®é€»è¾‘è¿‡æœŸæ—¶é—´ï¼Œç”¨äºå¤„ç†ç¼“</li></ul><p>å­˜å‡»ç©¿é—®é¢˜</p><ul><li>æ–¹æ³•3ï¼šæ ¹æ®æŒ‡å®šçš„keyæŸ¥è¯¢ç¼“å­˜ï¼Œå¹¶ååºåˆ—åŒ–ä¸ºæŒ‡å®šç±»å‹ï¼Œåˆ©ç”¨ç¼“å­˜ç©ºå€¼çš„æ–¹å¼è§£å†³ç¼“å­˜ç©¿é€é—®é¢˜</li><li>æ–¹æ³•4ï¼šæ ¹æ®æŒ‡å®šçš„keyæŸ¥è¯¢ç¼“å­˜ï¼Œå¹¶ååºåˆ—åŒ–ä¸ºæŒ‡å®šç±»å‹ï¼Œéœ€è¦åˆ©ç”¨é€»è¾‘è¿‡æœŸè§£å†³ç¼“å­˜å‡»ç©¿é—®é¢˜</li></ul><p>å°†é€»è¾‘è¿›è¡Œå°è£…</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hmdp.utils;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ClassName</span> CacheClient</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> TODO</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> CC</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@DATE</span> 2025/7/19 14:28</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CacheClient</span> &#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> StringRedisTemplate stringRedisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">ExecutorService</span> <span class="variable">CACHE_REBUILD_EXECUTOR</span> <span class="operator">=</span> Executors.newFixedThreadPool(<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">set</span><span class="params">(String key, Object value, Long time, TimeUnit unit)</span> &#123;</span><br><span class="line">        stringRedisTemplate.opsForValue().set(key, JSONUtil.toJsonStr(value), time, unit);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setWithLogicalExpire</span><span class="params">(String key, Object value, Long time, TimeUnit unit)</span> &#123;</span><br><span class="line">        <span class="type">RedisData</span> <span class="variable">redisData</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RedisData</span>();</span><br><span class="line">        redisData.setData(value);</span><br><span class="line">        redisData.setExpireTime(LocalDateTime.now().plusSeconds(unit.toSeconds(time)));</span><br><span class="line">        stringRedisTemplate.opsForValue().set(key, JSONUtil.toJsonStr(redisData));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ç¼“å­˜å‡»ç©¿ äº’æ–¥é”</span></span><br><span class="line">    <span class="keyword">public</span> &lt;R, ID&gt; R <span class="title function_">queryWithMutex</span><span class="params">(String keyPrefix, ID id, Class&lt;R&gt; type, Function&lt;ID, R&gt; dbFallback, Long time, TimeUnit unit)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> keyPrefix + id; <span class="comment">//ç¼“å­˜key</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> stringRedisTemplate.opsForValue().get(key);</span><br><span class="line">        <span class="comment">//æ˜¯å¦å­˜åœ¨ç¼“å­˜</span></span><br><span class="line">        <span class="keyword">if</span> (StrUtil.isNotBlank(json)) &#123;</span><br><span class="line">            <span class="keyword">return</span> JSONUtil.toBean(json, type);<span class="comment">//ç›´æ¥è¿”å›</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//æ˜¯å¦æ˜¯ç©ºå€¼</span></span><br><span class="line">        <span class="keyword">if</span> (json != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;<span class="comment">//ç©ºå€¼è¿”å›</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//ç¼“å­˜é‡å»º</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">lockKey</span> <span class="operator">=</span> <span class="string">&quot;lock:&quot;</span> + key;</span><br><span class="line">        R r;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">boolean</span> <span class="variable">isLock</span> <span class="operator">=</span> tryLock(lockKey);</span><br><span class="line">            <span class="keyword">if</span> (!isLock) &#123;</span><br><span class="line">                <span class="comment">//æ²¡é” ç­‰å¾…</span></span><br><span class="line">                Thread.sleep(<span class="number">50</span>);</span><br><span class="line">                <span class="keyword">return</span> queryWithMutex(keyPrefix, id, type, dbFallback, time, unit);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//æˆåŠŸ</span></span><br><span class="line">            r = dbFallback.apply(id);</span><br><span class="line">            Thread.sleep(<span class="number">500</span>);<span class="comment">//æ¨¡æ‹Ÿé‡å»ºå»¶è¿Ÿ</span></span><br><span class="line">            <span class="keyword">if</span> (r == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="comment">//ç¼“å­˜ç©¿é€</span></span><br><span class="line">                stringRedisTemplate.opsForValue().set(key, <span class="string">&quot;&quot;</span>, CACHE_NULL_TTL, TimeUnit.MINUTES);</span><br><span class="line">            &#125;</span><br><span class="line">            set(key, r, time, unit);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            unLock(lockKey);<span class="comment">//é‡Šæ”¾é”</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> r;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//é€»è¾‘è¿‡æœŸ</span></span><br><span class="line">    <span class="keyword">public</span> &lt;R, ID&gt; R <span class="title function_">queryWithLogicalExpire</span><span class="params">(String keyPrefix, ID id, Class&lt;R&gt; type, Function&lt;ID, R&gt; dbFallback, Long time, TimeUnit unit)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> keyPrefix + id;</span><br><span class="line">        <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> stringRedisTemplate.opsForValue().get(key);</span><br><span class="line">        <span class="comment">//æœªå‘½ä¸­ è¿”å›ç©º</span></span><br><span class="line">        <span class="keyword">if</span> (StrUtil.isBlank(json)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//å‘½ä¸­ ååºåˆ—åŒ–</span></span><br><span class="line">        <span class="type">RedisData</span> <span class="variable">redisData</span> <span class="operator">=</span> JSONUtil.toBean(json, RedisData.class);</span><br><span class="line">        <span class="type">R</span> <span class="variable">r</span> <span class="operator">=</span> JSONUtil.toBean((JSONObject) redisData.getData(), type);</span><br><span class="line">        <span class="comment">//åˆ¤æ–­æ˜¯å¦è¿‡æœŸ</span></span><br><span class="line">        <span class="type">LocalDateTime</span> <span class="variable">expireTime</span> <span class="operator">=</span> redisData.getExpireTime();</span><br><span class="line">        <span class="keyword">if</span> (expireTime.isAfter(LocalDateTime.now())) &#123;</span><br><span class="line">            <span class="comment">//æœªè¿‡æœŸ</span></span><br><span class="line">            <span class="keyword">return</span> r;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//è¿‡æœŸ ç¼“å­˜é‡å»º</span></span><br><span class="line">        <span class="comment">// 6.1.è·å–äº’æ–¥é”</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">lockKey</span> <span class="operator">=</span> <span class="string">&quot;lock:&quot;</span> + key;</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">isLock</span> <span class="operator">=</span> tryLock(lockKey);</span><br><span class="line">        <span class="comment">// 6.2.åˆ¤æ–­æ˜¯å¦è·å–é”æˆåŠŸ</span></span><br><span class="line">        <span class="keyword">if</span> (isLock) &#123;</span><br><span class="line">            CACHE_REBUILD_EXECUTOR.submit(() -&gt; &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="comment">// æŸ¥è¯¢æ•°æ®åº“</span></span><br><span class="line">                    <span class="type">R</span> <span class="variable">newR</span> <span class="operator">=</span> dbFallback.apply(id);</span><br><span class="line">                    <span class="comment">// é‡å»ºç¼“å­˜</span></span><br><span class="line">                    <span class="built_in">this</span>.setWithLogicalExpire(key, newR, time, unit);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">                &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                    unLock(lockKey);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 6.4.è¿”å›è¿‡æœŸçš„å•†é“ºä¿¡æ¯</span></span><br><span class="line">        <span class="keyword">return</span> r;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">tryLock</span><span class="params">(String key)</span> &#123;</span><br><span class="line">        <span class="type">Boolean</span> <span class="variable">flag</span> <span class="operator">=</span> stringRedisTemplate.opsForValue().setIfAbsent(key, <span class="string">&quot;1&quot;</span>, <span class="number">10</span>, TimeUnit.SECONDS);</span><br><span class="line">        <span class="keyword">return</span> BooleanUtil.isTrue(flag);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">unLock</span><span class="params">(String key)</span> &#123;</span><br><span class="line">        stringRedisTemplate.delete(key);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3ã€ä¼˜æƒ å·ç§’æ€"><strong>3ã€ä¼˜æƒ å·ç§’æ€</strong></h2><h3 id="3-1-å…¨å±€å”¯ä¸€ID">3.1 -å…¨å±€å”¯ä¸€ID</h3><p>æ¯ä¸ªåº—é“ºéƒ½å¯ä»¥å‘å¸ƒä¼˜æƒ åˆ¸ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/1653362612286.png" alt="1653362612286"></p><p>å½“ç”¨æˆ·æŠ¢è´­æ—¶ï¼Œå°±ä¼šç”Ÿæˆè®¢å•å¹¶ä¿å­˜åˆ°tb_voucher_orderè¿™å¼ è¡¨ä¸­ï¼Œè€Œè®¢å•è¡¨å¦‚æœä½¿ç”¨æ•°æ®åº“è‡ªå¢IDå°±å­˜åœ¨ä¸€äº›é—®é¢˜ï¼š</p><ul><li>idçš„è§„å¾‹æ€§å¤ªæ˜æ˜¾</li><li>å—å•è¡¨æ•°æ®é‡çš„é™åˆ¶</li></ul><p>åœºæ™¯åˆ†æï¼šå¦‚æœæˆ‘ä»¬çš„idå…·æœ‰å¤ªæ˜æ˜¾çš„è§„åˆ™ï¼Œç”¨æˆ·æˆ–è€…è¯´å•†ä¸šå¯¹æ‰‹å¾ˆå®¹æ˜“çŒœæµ‹å‡ºæ¥æˆ‘ä»¬çš„ä¸€äº›æ•æ„Ÿä¿¡æ¯ï¼Œæ¯”å¦‚å•†åŸåœ¨ä¸€å¤©æ—¶é—´å†…ï¼Œå–å‡ºäº†å¤šå°‘å•ï¼Œè¿™æ˜æ˜¾ä¸åˆé€‚ã€‚</p><p>åœºæ™¯åˆ†æäºŒï¼šéšç€æˆ‘ä»¬å•†åŸè§„æ¨¡è¶Šæ¥è¶Šå¤§ï¼Œmysqlçš„å•è¡¨çš„å®¹é‡ä¸å®œè¶…è¿‡500Wï¼Œæ•°æ®é‡è¿‡å¤§ä¹‹åï¼Œæˆ‘ä»¬è¦è¿›è¡Œæ‹†åº“æ‹†è¡¨ï¼Œä½†æ‹†åˆ†è¡¨äº†ä¹‹åï¼Œä»–ä»¬ä»é€»è¾‘ä¸Šè®²ä»–ä»¬æ˜¯åŒä¸€å¼ è¡¨ï¼Œæ‰€ä»¥ä»–ä»¬çš„idæ˜¯ä¸èƒ½ä¸€æ ·çš„ï¼Œ äºæ˜¯ä¹æˆ‘ä»¬éœ€è¦ä¿è¯idçš„å”¯ä¸€æ€§ã€‚</p><p><strong>å…¨å±€IDç”Ÿæˆå™¨</strong>ï¼Œæ˜¯ä¸€ç§åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸‹ç”¨æ¥ç”Ÿæˆå…¨å±€å”¯ä¸€IDçš„å·¥å…·ï¼Œä¸€èˆ¬è¦æ»¡è¶³ä¸‹åˆ—ç‰¹æ€§ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/1653363100502.png" alt="1653363100502"></p><p>ä¸ºäº†å¢åŠ IDçš„å®‰å…¨æ€§ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ç›´æ¥ä½¿ç”¨Redisè‡ªå¢çš„æ•°å€¼ï¼Œè€Œæ˜¯æ‹¼æ¥ä¸€äº›å…¶å®ƒä¿¡æ¯ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/1653363172079.png" alt="1653363172079">IDçš„ç»„æˆéƒ¨åˆ†ï¼šç¬¦å·ä½ï¼š1bitï¼Œæ°¸è¿œä¸º0</p><p>æ—¶é—´æˆ³ï¼š31bitï¼Œä»¥ç§’ä¸ºå•ä½ï¼Œå¯ä»¥ä½¿ç”¨69å¹´</p><p>åºåˆ—å·ï¼š32bitï¼Œç§’å†…çš„è®¡æ•°å™¨ï¼Œæ”¯æŒæ¯ç§’äº§ç”Ÿ2^32ä¸ªä¸åŒID</p><h3 id="3-2-Rediså®ç°å…¨å±€å”¯ä¸€Id">3.2 -Rediså®ç°å…¨å±€å”¯ä¸€Id</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisIdWorker</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¼€å§‹æ—¶é—´æˆ³</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">BEGIN_TIMESTAMP</span> <span class="operator">=</span> <span class="number">1640995200L</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åºåˆ—å·çš„ä½æ•°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">COUNT_BITS</span> <span class="operator">=</span> <span class="number">32</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> StringRedisTemplate stringRedisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">RedisIdWorker</span><span class="params">(StringRedisTemplate stringRedisTemplate)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.stringRedisTemplate = stringRedisTemplate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">long</span> <span class="title function_">nextId</span><span class="params">(String keyPrefix)</span> &#123;</span><br><span class="line">        <span class="comment">// 1.ç”Ÿæˆæ—¶é—´æˆ³</span></span><br><span class="line">        <span class="type">LocalDateTime</span> <span class="variable">now</span> <span class="operator">=</span> LocalDateTime.now();</span><br><span class="line">        <span class="type">long</span> <span class="variable">nowSecond</span> <span class="operator">=</span> now.toEpochSecond(ZoneOffset.UTC);</span><br><span class="line">        <span class="type">long</span> <span class="variable">timestamp</span> <span class="operator">=</span> nowSecond - BEGIN_TIMESTAMP;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2.ç”Ÿæˆåºåˆ—å·</span></span><br><span class="line">        <span class="comment">// 2.1.è·å–å½“å‰æ—¥æœŸï¼Œç²¾ç¡®åˆ°å¤©</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">date</span> <span class="operator">=</span> now.format(DateTimeFormatter.ofPattern(<span class="string">&quot;yyyy:MM:dd&quot;</span>));</span><br><span class="line">        <span class="comment">// 2.2.è‡ªå¢é•¿</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">count</span> <span class="operator">=</span> stringRedisTemplate.opsForValue().increment(<span class="string">&quot;icr:&quot;</span> + keyPrefix + <span class="string">&quot;:&quot;</span> + date);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3.æ‹¼æ¥å¹¶è¿”å›</span></span><br><span class="line">        <span class="keyword">return</span> timestamp &lt;&lt; COUNT_BITS | count;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•ç±»</p><p>çŸ¥è¯†å°è´´å£«ï¼šå…³äºcountdownlatch</p><p>countdownlatchåä¸ºä¿¡å·æªï¼šä¸»è¦çš„ä½œç”¨æ˜¯åŒæ­¥åè°ƒåœ¨å¤šçº¿ç¨‹çš„ç­‰å¾…äºå”¤é†’é—®é¢˜</p><p>æˆ‘ä»¬å¦‚æœæ²¡æœ‰CountDownLatch ï¼Œé‚£ä¹ˆç”±äºç¨‹åºæ˜¯å¼‚æ­¥çš„ï¼Œå½“å¼‚æ­¥ç¨‹åºæ²¡æœ‰æ‰§è¡Œå®Œæ—¶ï¼Œä¸»çº¿ç¨‹å°±å·²ç»æ‰§è¡Œå®Œäº†ï¼Œç„¶åæˆ‘ä»¬æœŸæœ›çš„æ˜¯åˆ†çº¿ç¨‹å…¨éƒ¨èµ°å®Œä¹‹åï¼Œä¸»çº¿ç¨‹å†èµ°ï¼Œæ‰€ä»¥æˆ‘ä»¬æ­¤æ—¶éœ€è¦ä½¿ç”¨åˆ°CountDownLatch</p><p>CountDownLatch ä¸­æœ‰ä¸¤ä¸ªæœ€é‡è¦çš„æ–¹æ³•</p><p>1ã€countDown</p><p>2ã€await</p><p>await æ–¹æ³• æ˜¯é˜»å¡æ–¹æ³•ï¼Œæˆ‘ä»¬æ‹…å¿ƒåˆ†çº¿ç¨‹æ²¡æœ‰æ‰§è¡Œå®Œæ—¶ï¼Œmainçº¿ç¨‹å°±å…ˆæ‰§è¡Œï¼Œæ‰€ä»¥ä½¿ç”¨awaitå¯ä»¥è®©mainçº¿ç¨‹é˜»å¡ï¼Œé‚£ä¹ˆä»€ä¹ˆæ—¶å€™mainçº¿ç¨‹ä¸å†é˜»å¡å‘¢ï¼Ÿå½“CountDownLatch  å†…éƒ¨ç»´æŠ¤çš„ å˜é‡å˜ä¸º0æ—¶ï¼Œå°±ä¸å†é˜»å¡ï¼Œç›´æ¥æ”¾è¡Œï¼Œé‚£ä¹ˆä»€ä¹ˆæ—¶å€™CountDownLatch   ç»´æŠ¤çš„å˜é‡å˜ä¸º0 å‘¢ï¼Œæˆ‘ä»¬åªéœ€è¦è°ƒç”¨ä¸€æ¬¡countDown ï¼Œå†…éƒ¨å˜é‡å°±å‡å°‘1ï¼Œæˆ‘ä»¬è®©åˆ†çº¿ç¨‹å’Œå˜é‡ç»‘å®šï¼Œ æ‰§è¡Œå®Œä¸€ä¸ªåˆ†çº¿ç¨‹å°±å‡å°‘ä¸€ä¸ªå˜é‡ï¼Œå½“åˆ†çº¿ç¨‹å…¨éƒ¨èµ°å®Œï¼ŒCountDownLatch ç»´æŠ¤çš„å˜é‡å°±æ˜¯0ï¼Œæ­¤æ—¶awaitå°±ä¸å†é˜»å¡ï¼Œç»Ÿè®¡å‡ºæ¥çš„æ—¶é—´ä¹Ÿå°±æ˜¯æ‰€æœ‰åˆ†çº¿ç¨‹æ‰§è¡Œå®Œåçš„æ—¶é—´ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testIdWorker</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    <span class="type">CountDownLatch</span> <span class="variable">latch</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CountDownLatch</span>(<span class="number">300</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">Runnable</span> <span class="variable">task</span> <span class="operator">=</span> () -&gt; &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line">            <span class="type">long</span> <span class="variable">id</span> <span class="operator">=</span> redisIdWorker.nextId(<span class="string">&quot;order&quot;</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;id = &quot;</span> + id);</span><br><span class="line">        &#125;</span><br><span class="line">        latch.countDown();</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="type">long</span> <span class="variable">begin</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">300</span>; i++) &#123;</span><br><span class="line">        es.submit(task);</span><br><span class="line">    &#125;</span><br><span class="line">    latch.await();</span><br><span class="line">    <span class="type">long</span> <span class="variable">end</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">    System.out.println(<span class="string">&quot;time = &quot;</span> + (end - begin));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-3-æ·»åŠ ä¼˜æƒ å·">3.3 æ·»åŠ ä¼˜æƒ å·</h3><p>æ¯ä¸ªåº—é“ºéƒ½å¯ä»¥å‘å¸ƒä¼˜æƒ åˆ¸ï¼Œåˆ†ä¸ºå¹³ä»·åˆ¸å’Œç‰¹ä»·åˆ¸ã€‚å¹³ä»·åˆ¸å¯ä»¥ä»»æ„è´­ä¹°ï¼Œè€Œç‰¹ä»·åˆ¸éœ€è¦ç§’æ€æŠ¢è´­ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/1653365145124.png" alt="1653365145124"></p><p>tb_voucherï¼šä¼˜æƒ åˆ¸çš„åŸºæœ¬ä¿¡æ¯ï¼Œä¼˜æƒ é‡‘é¢ã€ä½¿ç”¨è§„åˆ™ç­‰<br>tb_seckill_voucherï¼šä¼˜æƒ åˆ¸çš„åº“å­˜ã€å¼€å§‹æŠ¢è´­æ—¶é—´ï¼Œç»“æŸæŠ¢è´­æ—¶é—´ã€‚ç‰¹ä»·ä¼˜æƒ åˆ¸æ‰éœ€è¦å¡«å†™è¿™äº›ä¿¡æ¯</p><p>å¹³ä»·å·ç”±äºä¼˜æƒ åŠ›åº¦å¹¶ä¸æ˜¯å¾ˆå¤§ï¼Œæ‰€ä»¥æ˜¯å¯ä»¥ä»»æ„é¢†å–</p><p>è€Œä»£é‡‘åˆ¸ç”±äºä¼˜æƒ åŠ›åº¦å¤§ï¼Œæ‰€ä»¥åƒç¬¬äºŒç§å·ï¼Œå°±å¾—é™åˆ¶æ•°é‡ï¼Œä»è¡¨ç»“æ„ä¸Šä¹Ÿèƒ½çœ‹å‡ºï¼Œç‰¹ä»·å·é™¤äº†å…·æœ‰ä¼˜æƒ å·çš„åŸºæœ¬ä¿¡æ¯ä»¥å¤–ï¼Œè¿˜å…·æœ‰åº“å­˜ï¼ŒæŠ¢è´­æ—¶é—´ï¼Œç»“æŸæ—¶é—´ç­‰ç­‰å­—æ®µ</p><p>**æ–°å¢æ™®é€šå·ä»£ç ï¼š  **VoucherController</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">addVoucher</span><span class="params">(<span class="meta">@RequestBody</span> Voucher voucher)</span> &#123;</span><br><span class="line">    voucherService.save(voucher);</span><br><span class="line">    <span class="keyword">return</span> Result.ok(voucher.getId());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ–°å¢ç§’æ€å·ä»£ç ï¼š</strong></p><p><strong>VoucherController</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;seckill&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">addSeckillVoucher</span><span class="params">(<span class="meta">@RequestBody</span> Voucher voucher)</span> &#123;</span><br><span class="line">    voucherService.addSeckillVoucher(voucher);</span><br><span class="line">    <span class="keyword">return</span> Result.ok(voucher.getId());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>VoucherServiceImpl</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addSeckillVoucher</span><span class="params">(Voucher voucher)</span> &#123;</span><br><span class="line">    <span class="comment">// ä¿å­˜ä¼˜æƒ åˆ¸</span></span><br><span class="line">    save(voucher);</span><br><span class="line">    <span class="comment">// ä¿å­˜ç§’æ€ä¿¡æ¯</span></span><br><span class="line">    <span class="type">SeckillVoucher</span> <span class="variable">seckillVoucher</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SeckillVoucher</span>();</span><br><span class="line">    seckillVoucher.setVoucherId(voucher.getId());</span><br><span class="line">    seckillVoucher.setStock(voucher.getStock());</span><br><span class="line">    seckillVoucher.setBeginTime(voucher.getBeginTime());</span><br><span class="line">    seckillVoucher.setEndTime(voucher.getEndTime());</span><br><span class="line">    seckillVoucherService.save(seckillVoucher);</span><br><span class="line">    <span class="comment">// ä¿å­˜ç§’æ€åº“å­˜åˆ°Redisä¸­</span></span><br><span class="line">    stringRedisTemplate.opsForValue().set(SECKILL_STOCK_KEY + voucher.getId(), voucher.getStock().toString());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-4-å®ç°ç§’æ€ä¸‹å•">3.4 å®ç°ç§’æ€ä¸‹å•</h3><p>ä¸‹å•æ ¸å¿ƒæ€è·¯ï¼šå½“æˆ‘ä»¬ç‚¹å‡»æŠ¢è´­æ—¶ï¼Œä¼šè§¦å‘å³ä¾§çš„è¯·æ±‚ï¼Œæˆ‘ä»¬åªéœ€è¦ç¼–å†™å¯¹åº”çš„controllerå³å¯</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/1653365839526.png" alt="1653365839526"></p><p>ç§’æ€ä¸‹å•åº”è¯¥æ€è€ƒçš„å†…å®¹ï¼š</p><p>ä¸‹å•æ—¶éœ€è¦åˆ¤æ–­ä¸¤ç‚¹ï¼š</p><ul><li>ç§’æ€æ˜¯å¦å¼€å§‹æˆ–ç»“æŸï¼Œå¦‚æœå°šæœªå¼€å§‹æˆ–å·²ç»ç»“æŸåˆ™æ— æ³•ä¸‹å•</li><li>åº“å­˜æ˜¯å¦å……è¶³ï¼Œä¸è¶³åˆ™æ— æ³•ä¸‹å•</li></ul><p>ä¸‹å•æ ¸å¿ƒé€»è¾‘åˆ†æï¼š</p><p>å½“ç”¨æˆ·å¼€å§‹è¿›è¡Œä¸‹å•ï¼Œæˆ‘ä»¬åº”å½“å»æŸ¥è¯¢ä¼˜æƒ å·ä¿¡æ¯ï¼ŒæŸ¥è¯¢åˆ°ä¼˜æƒ å·ä¿¡æ¯ï¼Œåˆ¤æ–­æ˜¯å¦æ»¡è¶³ç§’æ€æ¡ä»¶</p><p>æ¯”å¦‚æ—¶é—´æ˜¯å¦å……è¶³ï¼Œå¦‚æœæ—¶é—´å……è¶³ï¼Œåˆ™è¿›ä¸€æ­¥åˆ¤æ–­åº“å­˜æ˜¯å¦è¶³å¤Ÿï¼Œå¦‚æœä¸¤è€…éƒ½æ»¡è¶³ï¼Œåˆ™æ‰£å‡åº“å­˜ï¼Œåˆ›å»ºè®¢å•ï¼Œç„¶åè¿”å›è®¢å•idï¼Œå¦‚æœæœ‰ä¸€ä¸ªæ¡ä»¶ä¸æ»¡è¶³åˆ™ç›´æ¥ç»“æŸã€‚</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/1653366238564.png" alt="1653366238564"></p><p>VoucherOrderServiceImpl</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">seckillVoucher</span><span class="params">(Long voucherId)</span> &#123;</span><br><span class="line">    <span class="comment">// 1.æŸ¥è¯¢ä¼˜æƒ åˆ¸</span></span><br><span class="line">    <span class="type">SeckillVoucher</span> <span class="variable">voucher</span> <span class="operator">=</span> seckillVoucherService.getById(voucherId);</span><br><span class="line">    <span class="comment">// 2.åˆ¤æ–­ç§’æ€æ˜¯å¦å¼€å§‹</span></span><br><span class="line">    <span class="keyword">if</span> (voucher.getBeginTime().isAfter(LocalDateTime.now())) &#123;</span><br><span class="line">        <span class="comment">// å°šæœªå¼€å§‹</span></span><br><span class="line">        <span class="keyword">return</span> Result.fail(<span class="string">&quot;ç§’æ€å°šæœªå¼€å§‹ï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 3.åˆ¤æ–­ç§’æ€æ˜¯å¦å·²ç»ç»“æŸ</span></span><br><span class="line">    <span class="keyword">if</span> (voucher.getEndTime().isBefore(LocalDateTime.now())) &#123;</span><br><span class="line">        <span class="comment">// å°šæœªå¼€å§‹</span></span><br><span class="line">        <span class="keyword">return</span> Result.fail(<span class="string">&quot;ç§’æ€å·²ç»ç»“æŸï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 4.åˆ¤æ–­åº“å­˜æ˜¯å¦å……è¶³</span></span><br><span class="line">    <span class="keyword">if</span> (voucher.getStock() &lt; <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="comment">// åº“å­˜ä¸è¶³</span></span><br><span class="line">        <span class="keyword">return</span> Result.fail(<span class="string">&quot;åº“å­˜ä¸è¶³ï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//5ï¼Œæ‰£å‡åº“å­˜</span></span><br><span class="line">    <span class="type">boolean</span> <span class="variable">success</span> <span class="operator">=</span> seckillVoucherService.update()</span><br><span class="line">            .setSql(<span class="string">&quot;stock= stock -1&quot;</span>)</span><br><span class="line">            .eq(<span class="string">&quot;voucher_id&quot;</span>, voucherId).update();</span><br><span class="line">    <span class="keyword">if</span> (!success) &#123;</span><br><span class="line">        <span class="comment">//æ‰£å‡åº“å­˜</span></span><br><span class="line">        <span class="keyword">return</span> Result.fail(<span class="string">&quot;åº“å­˜ä¸è¶³ï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//6.åˆ›å»ºè®¢å•</span></span><br><span class="line">    <span class="type">VoucherOrder</span> <span class="variable">voucherOrder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">VoucherOrder</span>();</span><br><span class="line">    <span class="comment">// 6.1.è®¢å•id</span></span><br><span class="line">    <span class="type">long</span> <span class="variable">orderId</span> <span class="operator">=</span> redisIdWorker.nextId(<span class="string">&quot;order&quot;</span>);</span><br><span class="line">    voucherOrder.setId(orderId);</span><br><span class="line">    <span class="comment">// 6.2.ç”¨æˆ·id</span></span><br><span class="line">    <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> UserHolder.getUser().getId();</span><br><span class="line">    voucherOrder.setUserId(userId);</span><br><span class="line">    <span class="comment">// 6.3.ä»£é‡‘åˆ¸id</span></span><br><span class="line">    voucherOrder.setVoucherId(voucherId);</span><br><span class="line">    save(voucherOrder);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> Result.ok(orderId);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-5-åº“å­˜è¶…å–é—®é¢˜åˆ†æ">3.5 åº“å­˜è¶…å–é—®é¢˜åˆ†æ</h3><p>æœ‰å…³è¶…å–é—®é¢˜åˆ†æï¼šåœ¨æˆ‘ä»¬åŸæœ‰ä»£ç ä¸­æ˜¯è¿™ä¹ˆå†™çš„</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (voucher.getStock() &lt; <span class="number">1</span>) &#123;</span><br><span class="line">       <span class="comment">// åº“å­˜ä¸è¶³</span></span><br><span class="line">       <span class="keyword">return</span> Result.fail(<span class="string">&quot;åº“å­˜ä¸è¶³ï¼&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="comment">//5ï¼Œæ‰£å‡åº“å­˜</span></span><br><span class="line">   <span class="type">boolean</span> <span class="variable">success</span> <span class="operator">=</span> seckillVoucherService.update()</span><br><span class="line">           .setSql(<span class="string">&quot;stock= stock -1&quot;</span>)</span><br><span class="line">           .eq(<span class="string">&quot;voucher_id&quot;</span>, voucherId).update();</span><br><span class="line">   <span class="keyword">if</span> (!success) &#123;</span><br><span class="line">       <span class="comment">//æ‰£å‡åº“å­˜</span></span><br><span class="line">       <span class="keyword">return</span> Result.fail(<span class="string">&quot;åº“å­˜ä¸è¶³ï¼&quot;</span>);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>å‡è®¾çº¿ç¨‹1è¿‡æ¥æŸ¥è¯¢åº“å­˜ï¼Œåˆ¤æ–­å‡ºæ¥åº“å­˜å¤§äº1ï¼Œæ­£å‡†å¤‡å»æ‰£å‡åº“å­˜ï¼Œä½†æ˜¯è¿˜æ²¡æœ‰æ¥å¾—åŠå»æ‰£å‡ï¼Œæ­¤æ—¶çº¿ç¨‹2è¿‡æ¥ï¼Œçº¿ç¨‹2ä¹Ÿå»æŸ¥è¯¢åº“å­˜ï¼Œå‘ç°è¿™ä¸ªæ•°é‡ä¸€å®šä¹Ÿå¤§äº1ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªçº¿ç¨‹éƒ½ä¼šå»æ‰£å‡åº“å­˜ï¼Œæœ€ç»ˆå¤šä¸ªçº¿ç¨‹ç›¸å½“äºä¸€èµ·å»æ‰£å‡åº“å­˜ï¼Œæ­¤æ—¶å°±ä¼šå‡ºç°åº“å­˜çš„è¶…å–é—®é¢˜ã€‚</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/1653368335155.png" alt="1653368335155"></p><p>è¶…å–é—®é¢˜æ˜¯å…¸å‹çš„å¤šçº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œé’ˆå¯¹è¿™ä¸€é—®é¢˜çš„å¸¸è§è§£å†³æ–¹æ¡ˆå°±æ˜¯åŠ é”ï¼šè€Œå¯¹äºåŠ é”ï¼Œæˆ‘ä»¬é€šå¸¸æœ‰ä¸¤ç§è§£å†³æ–¹æ¡ˆï¼šè§ä¸‹å›¾ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/1653368562591.png" alt="1653368562591"></p><p><strong>æ‚²è§‚é”ï¼š</strong></p><p>æ‚²è§‚é”å¯ä»¥å®ç°å¯¹äºæ•°æ®çš„ä¸²è¡ŒåŒ–æ‰§è¡Œï¼Œæ¯”å¦‚synï¼Œå’Œlockéƒ½æ˜¯æ‚²è§‚é”çš„ä»£è¡¨ï¼ŒåŒæ—¶ï¼Œæ‚²è§‚é”ä¸­åˆå¯ä»¥å†ç»†åˆ†ä¸ºå…¬å¹³é”ï¼Œéå…¬å¹³é”ï¼Œå¯é‡å…¥é”ï¼Œç­‰ç­‰</p><p><strong>ä¹è§‚é”ï¼š</strong></p><p>ä¹è§‚é”ï¼šä¼šæœ‰ä¸€ä¸ªç‰ˆæœ¬å·ï¼Œæ¯æ¬¡æ“ä½œæ•°æ®ä¼šå¯¹ç‰ˆæœ¬å·+1ï¼Œå†æäº¤å›æ•°æ®æ—¶ï¼Œä¼šå»æ ¡éªŒæ˜¯å¦æ¯”ä¹‹å‰çš„ç‰ˆæœ¬å¤§1 ï¼Œå¦‚æœå¤§1 ï¼Œåˆ™è¿›è¡Œæ“ä½œæˆåŠŸï¼Œè¿™å¥—æœºåˆ¶çš„æ ¸å¿ƒé€»è¾‘åœ¨äºï¼Œå¦‚æœåœ¨æ“ä½œè¿‡ç¨‹ä¸­ï¼Œç‰ˆæœ¬å·åªæ¯”åŸæ¥å¤§1 ï¼Œé‚£ä¹ˆå°±æ„å‘³ç€æ“ä½œè¿‡ç¨‹ä¸­æ²¡æœ‰äººå¯¹ä»–è¿›è¡Œè¿‡ä¿®æ”¹ï¼Œä»–çš„æ“ä½œå°±æ˜¯å®‰å…¨çš„ï¼Œå¦‚æœä¸å¤§1ï¼Œåˆ™æ•°æ®è¢«ä¿®æ”¹è¿‡ï¼Œå½“ç„¶ä¹è§‚é”è¿˜æœ‰ä¸€äº›å˜ç§çš„å¤„ç†æ–¹å¼æ¯”å¦‚cas</p><p>ä¹è§‚é”çš„å…¸å‹ä»£è¡¨ï¼šå°±æ˜¯casï¼Œåˆ©ç”¨casè¿›è¡Œæ— é”åŒ–æœºåˆ¶åŠ é”ï¼Œvar5 æ˜¯æ“ä½œå‰è¯»å–çš„å†…å­˜å€¼ï¼Œwhileä¸­çš„var1+var2 æ˜¯é¢„ä¼°å€¼ï¼Œå¦‚æœé¢„ä¼°å€¼ == å†…å­˜å€¼ï¼Œåˆ™ä»£è¡¨ä¸­é—´æ²¡æœ‰è¢«äººä¿®æ”¹è¿‡ï¼Œæ­¤æ—¶å°±å°†æ–°å€¼å»æ›¿æ¢ å†…å­˜å€¼</p><p>å…¶ä¸­do while æ˜¯ä¸ºäº†åœ¨æ“ä½œå¤±è´¥æ—¶ï¼Œå†æ¬¡è¿›è¡Œè‡ªæ—‹æ“ä½œï¼Œå³æŠŠä¹‹å‰çš„é€»è¾‘å†æ“ä½œä¸€æ¬¡ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> var5;</span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    var5 = <span class="built_in">this</span>.getIntVolatile(var1, var2);</span><br><span class="line">&#125; <span class="keyword">while</span>(!<span class="built_in">this</span>.compareAndSwapInt(var1, var2, var5, var5 + var4));</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> var5;</span><br></pre></td></tr></table></figure><p><strong>è¯¾ç¨‹ä¸­çš„ä½¿ç”¨æ–¹å¼ï¼š</strong></p><p>è¯¾ç¨‹ä¸­çš„ä½¿ç”¨æ–¹å¼æ˜¯æ²¡æœ‰åƒcasä¸€æ ·å¸¦è‡ªæ—‹çš„æ“ä½œï¼Œä¹Ÿæ²¡æœ‰å¯¹versionçš„ç‰ˆæœ¬å·+1 ï¼Œä»–çš„æ“ä½œé€»è¾‘æ˜¯åœ¨æ“ä½œæ—¶ï¼Œå¯¹ç‰ˆæœ¬å·è¿›è¡Œ+1 æ“ä½œï¼Œç„¶åè¦æ±‚version å¦‚æœæ˜¯1 çš„æƒ…å†µä¸‹ï¼Œæ‰èƒ½æ“ä½œï¼Œé‚£ä¹ˆç¬¬ä¸€ä¸ªçº¿ç¨‹åœ¨æ“ä½œåï¼Œæ•°æ®åº“ä¸­çš„versionå˜æˆäº†2ï¼Œä½†æ˜¯ä»–è‡ªå·±æ»¡è¶³version=1 ï¼Œæ‰€ä»¥æ²¡æœ‰é—®é¢˜ï¼Œæ­¤æ—¶çº¿ç¨‹2æ‰§è¡Œï¼Œçº¿ç¨‹2 æœ€åä¹Ÿéœ€è¦åŠ ä¸Šæ¡ä»¶version =1 ï¼Œä½†æ˜¯ç°åœ¨ç”±äºçº¿ç¨‹1å·²ç»æ“ä½œè¿‡äº†ï¼Œæ‰€ä»¥çº¿ç¨‹2ï¼Œæ“ä½œæ—¶å°±ä¸æ»¡è¶³version=1 çš„æ¡ä»¶äº†ï¼Œæ‰€ä»¥çº¿ç¨‹2æ— æ³•æ‰§è¡ŒæˆåŠŸ</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/1653369268550.png" alt="1653369268550"></p><h3 id="3-6-ä¹è§‚é”è§£å†³è¶…å–é—®é¢˜">3.6 ä¹è§‚é”è§£å†³è¶…å–é—®é¢˜</h3><p><strong>ä¿®æ”¹ä»£ç æ–¹æ¡ˆä¸€ã€</strong></p><p>VoucherOrderServiceImpl åœ¨æ‰£å‡åº“å­˜æ—¶ï¼Œæ”¹ä¸ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">boolean</span> <span class="variable">success</span> <span class="operator">=</span> seckillVoucherService.update()</span><br><span class="line">            .setSql(<span class="string">&quot;stock= stock -1&quot;</span>) <span class="comment">//set stock = stock -1</span></span><br><span class="line">            .eq(<span class="string">&quot;voucher_id&quot;</span>, voucherId).eq(<span class="string">&quot;stock&quot;</span>,voucher.getStock()).update(); <span class="comment">//where id = ï¼Ÿ and stock = ?</span></span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šé€»è¾‘çš„æ ¸å¿ƒå«ä¹‰æ˜¯ï¼šåªè¦æˆ‘æ‰£å‡åº“å­˜æ—¶çš„åº“å­˜å’Œä¹‹å‰æˆ‘æŸ¥è¯¢åˆ°çš„åº“å­˜æ˜¯ä¸€æ ·çš„ï¼Œå°±æ„å‘³ç€æ²¡æœ‰äººåœ¨ä¸­é—´ä¿®æ”¹è¿‡åº“å­˜ï¼Œé‚£ä¹ˆæ­¤æ—¶å°±æ˜¯å®‰å…¨çš„ï¼Œä½†æ˜¯ä»¥ä¸Šè¿™ç§æ–¹å¼é€šè¿‡æµ‹è¯•å‘ç°ä¼šæœ‰å¾ˆå¤šå¤±è´¥çš„æƒ…å†µï¼Œå¤±è´¥çš„åŸå› åœ¨äºï¼šåœ¨ä½¿ç”¨ä¹è§‚é”è¿‡ç¨‹ä¸­å‡è®¾100ä¸ªçº¿ç¨‹åŒæ—¶éƒ½æ‹¿åˆ°äº†100çš„åº“å­˜ï¼Œç„¶åå¤§å®¶ä¸€èµ·å»è¿›è¡Œæ‰£å‡ï¼Œä½†æ˜¯100ä¸ªäººä¸­åªæœ‰1ä¸ªäººèƒ½æ‰£å‡æˆåŠŸï¼Œå…¶ä»–çš„äººåœ¨å¤„ç†æ—¶ï¼Œä»–ä»¬åœ¨æ‰£å‡æ—¶ï¼Œåº“å­˜å·²ç»è¢«ä¿®æ”¹è¿‡äº†ï¼Œæ‰€ä»¥æ­¤æ—¶å…¶ä»–çº¿ç¨‹éƒ½ä¼šå¤±è´¥</p><p><strong>ä¿®æ”¹ä»£ç æ–¹æ¡ˆäºŒã€</strong></p><p>ä¹‹å‰çš„æ–¹å¼è¦ä¿®æ”¹å‰åéƒ½ä¿æŒä¸€è‡´ï¼Œä½†æ˜¯è¿™æ ·æˆ‘ä»¬åˆ†æè¿‡ï¼ŒæˆåŠŸçš„æ¦‚ç‡å¤ªä½ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„ä¹è§‚é”éœ€è¦å˜ä¸€ä¸‹ï¼Œæ”¹æˆstockå¤§äº0 å³å¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">boolean</span> <span class="variable">success</span> <span class="operator">=</span> seckillVoucherService.update()</span><br><span class="line">            .setSql(<span class="string">&quot;stock= stock -1&quot;</span>)</span><br><span class="line">            .eq(<span class="string">&quot;voucher_id&quot;</span>, voucherId).update().gt(<span class="string">&quot;stock&quot;</span>,<span class="number">0</span>); <span class="comment">//where id = ? and stock &gt; 0</span></span><br></pre></td></tr></table></figure><p><strong>çŸ¥è¯†å°æ‰©å±•ï¼š</strong></p><p>é’ˆå¯¹casä¸­çš„è‡ªæ—‹å‹åŠ›è¿‡å¤§ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨Longaddrè¿™ä¸ªç±»å»è§£å†³</p><p>Java8 æä¾›çš„ä¸€ä¸ªå¯¹AtomicLongæ”¹è¿›åçš„ä¸€ä¸ªç±»ï¼ŒLongAdder</p><p>å¤§é‡çº¿ç¨‹å¹¶å‘æ›´æ–°ä¸€ä¸ªåŸå­æ€§çš„æ—¶å€™ï¼Œå¤©ç„¶çš„é—®é¢˜å°±æ˜¯è‡ªæ—‹ï¼Œä¼šå¯¼è‡´å¹¶å‘æ€§é—®é¢˜ï¼Œå½“ç„¶è¿™ä¹Ÿæ¯”æˆ‘ä»¬ç›´æ¥ä½¿ç”¨synæ¥çš„å¥½</p><p>æ‰€ä»¥åˆ©ç”¨è¿™ä¹ˆä¸€ä¸ªç±»ï¼ŒLongAdderæ¥è¿›è¡Œä¼˜åŒ–</p><p>å¦‚æœè·å–æŸä¸ªå€¼ï¼Œåˆ™ä¼šå¯¹cellå’Œbaseçš„å€¼è¿›è¡Œé€’å¢ï¼Œæœ€åè¿”å›ä¸€ä¸ªå®Œæ•´çš„å€¼</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/1653370271627.png" alt="1653370271627"></p><h3 id="3-6-ä¼˜æƒ åˆ¸ç§’æ€-ä¸€äººä¸€å•">3.6 ä¼˜æƒ åˆ¸ç§’æ€-ä¸€äººä¸€å•</h3><p>éœ€æ±‚ï¼šä¿®æ”¹ç§’æ€ä¸šåŠ¡ï¼Œè¦æ±‚åŒä¸€ä¸ªä¼˜æƒ åˆ¸ï¼Œä¸€ä¸ªç”¨æˆ·åªèƒ½ä¸‹ä¸€å•</p><p><strong>ç°åœ¨çš„é—®é¢˜åœ¨äºï¼š</strong></p><p>ä¼˜æƒ å·æ˜¯ä¸ºäº†å¼•æµï¼Œä½†æ˜¯ç›®å‰çš„æƒ…å†µæ˜¯ï¼Œä¸€ä¸ªäººå¯ä»¥æ— é™åˆ¶çš„æŠ¢è¿™ä¸ªä¼˜æƒ å·ï¼Œæ‰€ä»¥æˆ‘ä»¬åº”å½“å¢åŠ ä¸€å±‚é€»è¾‘ï¼Œè®©ä¸€ä¸ªç”¨æˆ·åªèƒ½ä¸‹ä¸€ä¸ªå•ï¼Œè€Œä¸æ˜¯è®©ä¸€ä¸ªç”¨æˆ·ä¸‹å¤šä¸ªå•</p><p>å…·ä½“æ“ä½œé€»è¾‘å¦‚ä¸‹ï¼šæ¯”å¦‚æ—¶é—´æ˜¯å¦å……è¶³ï¼Œå¦‚æœæ—¶é—´å……è¶³ï¼Œåˆ™è¿›ä¸€æ­¥åˆ¤æ–­åº“å­˜æ˜¯å¦è¶³å¤Ÿï¼Œç„¶åå†æ ¹æ®ä¼˜æƒ å·idå’Œç”¨æˆ·idæŸ¥è¯¢æ˜¯å¦å·²ç»ä¸‹è¿‡è¿™ä¸ªè®¢å•ï¼Œå¦‚æœä¸‹è¿‡è¿™ä¸ªè®¢å•ï¼Œåˆ™ä¸å†ä¸‹å•ï¼Œå¦åˆ™è¿›è¡Œä¸‹å•</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/1653371854389.png" alt="1653371854389"></p><p>VoucherOrderServiceImpl</p><p><strong>åˆæ­¥ä»£ç ï¼šå¢åŠ ä¸€äººä¸€å•é€»è¾‘</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">seckillVoucher</span><span class="params">(Long voucherId)</span> &#123;</span><br><span class="line">    <span class="comment">// 1.æŸ¥è¯¢ä¼˜æƒ åˆ¸</span></span><br><span class="line">    <span class="type">SeckillVoucher</span> <span class="variable">voucher</span> <span class="operator">=</span> seckillVoucherService.getById(voucherId);</span><br><span class="line">    <span class="comment">// 2.åˆ¤æ–­ç§’æ€æ˜¯å¦å¼€å§‹</span></span><br><span class="line">    <span class="keyword">if</span> (voucher.getBeginTime().isAfter(LocalDateTime.now())) &#123;</span><br><span class="line">        <span class="comment">// å°šæœªå¼€å§‹</span></span><br><span class="line">        <span class="keyword">return</span> Result.fail(<span class="string">&quot;ç§’æ€å°šæœªå¼€å§‹ï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 3.åˆ¤æ–­ç§’æ€æ˜¯å¦å·²ç»ç»“æŸ</span></span><br><span class="line">    <span class="keyword">if</span> (voucher.getEndTime().isBefore(LocalDateTime.now())) &#123;</span><br><span class="line">        <span class="comment">// å°šæœªå¼€å§‹</span></span><br><span class="line">        <span class="keyword">return</span> Result.fail(<span class="string">&quot;ç§’æ€å·²ç»ç»“æŸï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 4.åˆ¤æ–­åº“å­˜æ˜¯å¦å……è¶³</span></span><br><span class="line">    <span class="keyword">if</span> (voucher.getStock() &lt; <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="comment">// åº“å­˜ä¸è¶³</span></span><br><span class="line">        <span class="keyword">return</span> Result.fail(<span class="string">&quot;åº“å­˜ä¸è¶³ï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 5.ä¸€äººä¸€å•é€»è¾‘</span></span><br><span class="line">    <span class="comment">// 5.1.ç”¨æˆ·id</span></span><br><span class="line">    <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> UserHolder.getUser().getId();</span><br><span class="line">    <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> query().eq(<span class="string">&quot;user_id&quot;</span>, userId).eq(<span class="string">&quot;voucher_id&quot;</span>, voucherId).count();</span><br><span class="line">    <span class="comment">// 5.2.åˆ¤æ–­æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">    <span class="keyword">if</span> (count &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// ç”¨æˆ·å·²ç»è´­ä¹°è¿‡äº†</span></span><br><span class="line">        <span class="keyword">return</span> Result.fail(<span class="string">&quot;ç”¨æˆ·å·²ç»è´­ä¹°è¿‡ä¸€æ¬¡ï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//6ï¼Œæ‰£å‡åº“å­˜</span></span><br><span class="line">    <span class="type">boolean</span> <span class="variable">success</span> <span class="operator">=</span> seckillVoucherService.update()</span><br><span class="line">            .setSql(<span class="string">&quot;stock= stock -1&quot;</span>)</span><br><span class="line">            .eq(<span class="string">&quot;voucher_id&quot;</span>, voucherId).update();</span><br><span class="line">    <span class="keyword">if</span> (!success) &#123;</span><br><span class="line">        <span class="comment">//æ‰£å‡åº“å­˜</span></span><br><span class="line">        <span class="keyword">return</span> Result.fail(<span class="string">&quot;åº“å­˜ä¸è¶³ï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//7.åˆ›å»ºè®¢å•</span></span><br><span class="line">    <span class="type">VoucherOrder</span> <span class="variable">voucherOrder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">VoucherOrder</span>();</span><br><span class="line">    <span class="comment">// 7.1.è®¢å•id</span></span><br><span class="line">    <span class="type">long</span> <span class="variable">orderId</span> <span class="operator">=</span> redisIdWorker.nextId(<span class="string">&quot;order&quot;</span>);</span><br><span class="line">    voucherOrder.setId(orderId);</span><br><span class="line">    voucherOrder.setUserId(userId);</span><br><span class="line">    <span class="comment">// 7.3.ä»£é‡‘åˆ¸id</span></span><br><span class="line">    voucherOrder.setVoucherId(voucherId);</span><br><span class="line">    save(voucherOrder);</span><br><span class="line">    <span class="keyword">return</span> Result.ok(orderId);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å­˜åœ¨é—®é¢˜</strong>:ç°åœ¨çš„é—®é¢˜è¿˜æ˜¯å’Œä¹‹å‰ä¸€æ ·ï¼Œå¹¶å‘è¿‡æ¥ï¼ŒæŸ¥è¯¢æ•°æ®åº“ï¼Œéƒ½ä¸å­˜åœ¨è®¢å•ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜æ˜¯éœ€è¦åŠ é”ï¼Œä½†æ˜¯ä¹è§‚é”æ¯”è¾ƒé€‚åˆæ›´æ–°æ•°æ®ï¼Œè€Œç°åœ¨æ˜¯æ’å…¥æ•°æ®ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä½¿ç”¨æ‚²è§‚é”æ“ä½œ</p><p>**æ³¨æ„:**åœ¨è¿™é‡Œæåˆ°äº†éå¸¸å¤šçš„é—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦æ…¢æ…¢çš„æ¥æ€è€ƒï¼Œé¦–å…ˆæˆ‘ä»¬çš„åˆå§‹æ–¹æ¡ˆæ˜¯å°è£…äº†ä¸€ä¸ªcreateVoucherOrderæ–¹æ³•ï¼ŒåŒæ—¶ä¸ºäº†ç¡®ä¿ä»–çº¿ç¨‹å®‰å…¨ï¼Œåœ¨æ–¹æ³•ä¸Šæ·»åŠ äº†ä¸€æŠŠsynchronized é”</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">synchronized</span> Result <span class="title function_">createVoucherOrder</span><span class="params">(Long voucherId)</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> UserHolder.getUser().getId();</span><br><span class="line">         <span class="comment">// 5.1.æŸ¥è¯¢è®¢å•</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> query().eq(<span class="string">&quot;user_id&quot;</span>, userId).eq(<span class="string">&quot;voucher_id&quot;</span>, voucherId).count();</span><br><span class="line">        <span class="comment">// 5.2.åˆ¤æ–­æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">        <span class="keyword">if</span> (count &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// ç”¨æˆ·å·²ç»è´­ä¹°è¿‡äº†</span></span><br><span class="line">            <span class="keyword">return</span> Result.fail(<span class="string">&quot;ç”¨æˆ·å·²ç»è´­ä¹°è¿‡ä¸€æ¬¡ï¼&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 6.æ‰£å‡åº“å­˜</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">success</span> <span class="operator">=</span> seckillVoucherService.update()</span><br><span class="line">                .setSql(<span class="string">&quot;stock = stock - 1&quot;</span>) <span class="comment">// set stock = stock - 1</span></span><br><span class="line">                .eq(<span class="string">&quot;voucher_id&quot;</span>, voucherId).gt(<span class="string">&quot;stock&quot;</span>, <span class="number">0</span>) <span class="comment">// where id = ? and stock &gt; 0</span></span><br><span class="line">                .update();</span><br><span class="line">        <span class="keyword">if</span> (!success) &#123;</span><br><span class="line">            <span class="comment">// æ‰£å‡å¤±è´¥</span></span><br><span class="line">            <span class="keyword">return</span> Result.fail(<span class="string">&quot;åº“å­˜ä¸è¶³ï¼&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 7.åˆ›å»ºè®¢å•</span></span><br><span class="line">        <span class="type">VoucherOrder</span> <span class="variable">voucherOrder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">VoucherOrder</span>();</span><br><span class="line">        <span class="comment">// 7.1.è®¢å•id</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">orderId</span> <span class="operator">=</span> redisIdWorker.nextId(<span class="string">&quot;order&quot;</span>);</span><br><span class="line">        voucherOrder.setId(orderId);</span><br><span class="line">        <span class="comment">// 7.2.ç”¨æˆ·id</span></span><br><span class="line">        voucherOrder.setUserId(userId);</span><br><span class="line">        <span class="comment">// 7.3.ä»£é‡‘åˆ¸id</span></span><br><span class="line">        voucherOrder.setVoucherId(voucherId);</span><br><span class="line">        save(voucherOrder);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 7.è¿”å›è®¢å•id</span></span><br><span class="line">        <span class="keyword">return</span> Result.ok(orderId);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ï¼Œä½†æ˜¯è¿™æ ·æ·»åŠ é”ï¼Œé”çš„ç²’åº¦å¤ªç²—äº†ï¼Œåœ¨ä½¿ç”¨é”è¿‡ç¨‹ä¸­ï¼Œæ§åˆ¶<strong>é”ç²’åº¦</strong> æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„äº‹æƒ…ï¼Œå› ä¸ºå¦‚æœé”çš„ç²’åº¦å¤ªå¤§ï¼Œä¼šå¯¼è‡´æ¯ä¸ªçº¿ç¨‹è¿›æ¥éƒ½ä¼šé”ä½ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å»æ§åˆ¶é”çš„ç²’åº¦ï¼Œä»¥ä¸‹è¿™æ®µä»£ç éœ€è¦ä¿®æ”¹ä¸ºï¼š<br>intern() è¿™ä¸ªæ–¹æ³•æ˜¯ä»å¸¸é‡æ± ä¸­æ‹¿åˆ°æ•°æ®ï¼Œå¦‚æœæˆ‘ä»¬ç›´æ¥ä½¿ç”¨userId.toString() ä»–æ‹¿åˆ°çš„å¯¹è±¡å®é™…ä¸Šæ˜¯ä¸åŒçš„å¯¹è±¡ï¼Œnewå‡ºæ¥çš„å¯¹è±¡ï¼Œæˆ‘ä»¬ä½¿ç”¨é”å¿…é¡»ä¿è¯é”å¿…é¡»æ˜¯åŒä¸€æŠŠï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä½¿ç”¨intern()æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span>  Result <span class="title function_">createVoucherOrder</span><span class="params">(Long voucherId)</span> &#123;</span><br><span class="line"><span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> UserHolder.getUser().getId();</span><br><span class="line"><span class="keyword">synchronized</span>(userId.toString().intern())&#123;</span><br><span class="line">         <span class="comment">// 5.1.æŸ¥è¯¢è®¢å•</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> query().eq(<span class="string">&quot;user_id&quot;</span>, userId).eq(<span class="string">&quot;voucher_id&quot;</span>, voucherId).count();</span><br><span class="line">        <span class="comment">// 5.2.åˆ¤æ–­æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">        <span class="keyword">if</span> (count &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// ç”¨æˆ·å·²ç»è´­ä¹°è¿‡äº†</span></span><br><span class="line">            <span class="keyword">return</span> Result.fail(<span class="string">&quot;ç”¨æˆ·å·²ç»è´­ä¹°è¿‡ä¸€æ¬¡ï¼&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 6.æ‰£å‡åº“å­˜</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">success</span> <span class="operator">=</span> seckillVoucherService.update()</span><br><span class="line">                .setSql(<span class="string">&quot;stock = stock - 1&quot;</span>) <span class="comment">// set stock = stock - 1</span></span><br><span class="line">                .eq(<span class="string">&quot;voucher_id&quot;</span>, voucherId).gt(<span class="string">&quot;stock&quot;</span>, <span class="number">0</span>) <span class="comment">// where id = ? and stock &gt; 0</span></span><br><span class="line">                .update();</span><br><span class="line">        <span class="keyword">if</span> (!success) &#123;</span><br><span class="line">            <span class="comment">// æ‰£å‡å¤±è´¥</span></span><br><span class="line">            <span class="keyword">return</span> Result.fail(<span class="string">&quot;åº“å­˜ä¸è¶³ï¼&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 7.åˆ›å»ºè®¢å•</span></span><br><span class="line">        <span class="type">VoucherOrder</span> <span class="variable">voucherOrder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">VoucherOrder</span>();</span><br><span class="line">        <span class="comment">// 7.1.è®¢å•id</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">orderId</span> <span class="operator">=</span> redisIdWorker.nextId(<span class="string">&quot;order&quot;</span>);</span><br><span class="line">        voucherOrder.setId(orderId);</span><br><span class="line">        <span class="comment">// 7.2.ç”¨æˆ·id</span></span><br><span class="line">        voucherOrder.setUserId(userId);</span><br><span class="line">        <span class="comment">// 7.3.ä»£é‡‘åˆ¸id</span></span><br><span class="line">        voucherOrder.setVoucherId(voucherId);</span><br><span class="line">        save(voucherOrder);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 7.è¿”å›è®¢å•id</span></span><br><span class="line">        <span class="keyword">return</span> Result.ok(orderId);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯ä»¥ä¸Šä»£ç è¿˜æ˜¯å­˜åœ¨é—®é¢˜ï¼Œé—®é¢˜çš„åŸå› åœ¨äºå½“å‰æ–¹æ³•è¢«springçš„äº‹åŠ¡æ§åˆ¶ï¼Œå¦‚æœä½ åœ¨æ–¹æ³•å†…éƒ¨åŠ é”ï¼Œå¯èƒ½ä¼šå¯¼è‡´å½“å‰æ–¹æ³•äº‹åŠ¡è¿˜æ²¡æœ‰æäº¤ï¼Œä½†æ˜¯é”å·²ç»é‡Šæ”¾ä¹Ÿä¼šå¯¼è‡´é—®é¢˜ï¼Œæ‰€ä»¥æˆ‘ä»¬é€‰æ‹©å°†å½“å‰æ–¹æ³•æ•´ä½“åŒ…è£¹èµ·æ¥ï¼Œç¡®ä¿äº‹åŠ¡ä¸ä¼šå‡ºç°é—®é¢˜ï¼šå¦‚ä¸‹ï¼š</p><p>åœ¨seckillVoucher æ–¹æ³•ä¸­ï¼Œæ·»åŠ ä»¥ä¸‹é€»è¾‘ï¼Œè¿™æ ·å°±èƒ½ä¿è¯äº‹åŠ¡çš„ç‰¹æ€§ï¼ŒåŒæ—¶ä¹Ÿæ§åˆ¶äº†é”çš„ç²’åº¦</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/1653373434815.png" alt="1653373434815"></p><p>ä½†æ˜¯ä»¥ä¸Šåšæ³•ä¾ç„¶æœ‰é—®é¢˜ï¼Œå› ä¸ºä½ è°ƒç”¨çš„æ–¹æ³•ï¼Œå…¶å®æ˜¯this.çš„æ–¹å¼è°ƒç”¨çš„ï¼Œäº‹åŠ¡æƒ³è¦ç”Ÿæ•ˆï¼Œè¿˜å¾—åˆ©ç”¨ä»£ç†æ¥ç”Ÿæ•ˆï¼Œæ‰€ä»¥è¿™ä¸ªåœ°æ–¹ï¼Œæˆ‘ä»¬éœ€è¦è·å¾—åŸå§‹çš„äº‹åŠ¡å¯¹è±¡ï¼Œ æ¥æ“ä½œäº‹åŠ¡</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/1653383810643.png" alt="1653383810643"></p><h3 id="3-7-é›†ç¾¤ç¯å¢ƒä¸‹çš„å¹¶å‘é—®é¢˜">3.7 é›†ç¾¤ç¯å¢ƒä¸‹çš„å¹¶å‘é—®é¢˜</h3><p>é€šè¿‡åŠ é”å¯ä»¥è§£å†³åœ¨å•æœºæƒ…å†µä¸‹çš„ä¸€äººä¸€å•å®‰å…¨é—®é¢˜ï¼Œä½†æ˜¯åœ¨é›†ç¾¤æ¨¡å¼ä¸‹å°±ä¸è¡Œäº†ã€‚</p><p>1ã€æˆ‘ä»¬å°†æœåŠ¡å¯åŠ¨ä¸¤ä»½ï¼Œç«¯å£åˆ†åˆ«ä¸º8081å’Œ8082ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/1653373887844.png" alt="1653373887844"></p><p>2ã€ç„¶åä¿®æ”¹nginxçš„confç›®å½•ä¸‹çš„nginx.confæ–‡ä»¶ï¼Œé…ç½®åå‘ä»£ç†å’Œè´Ÿè½½å‡è¡¡ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/1653373908620.png" alt="1653373908620"></p><p><strong>å…·ä½“æ“ä½œ(ç•¥)</strong></p><p><strong>æœ‰å…³é”å¤±æ•ˆåŸå› åˆ†æ</strong></p><p>ç”±äºç°åœ¨æˆ‘ä»¬éƒ¨ç½²äº†å¤šä¸ªtomcatï¼Œæ¯ä¸ªtomcatéƒ½æœ‰ä¸€ä¸ªå±äºè‡ªå·±çš„jvmï¼Œé‚£ä¹ˆå‡è®¾åœ¨æœåŠ¡å™¨Açš„tomcatå†…éƒ¨ï¼Œæœ‰ä¸¤ä¸ªçº¿ç¨‹ï¼Œè¿™ä¸¤ä¸ªçº¿ç¨‹ç”±äºä½¿ç”¨çš„æ˜¯åŒä¸€ä»½ä»£ç ï¼Œé‚£ä¹ˆä»–ä»¬çš„é”å¯¹è±¡æ˜¯åŒä¸€ä¸ªï¼Œæ˜¯å¯ä»¥å®ç°äº’æ–¥çš„ï¼Œä½†æ˜¯å¦‚æœç°åœ¨æ˜¯æœåŠ¡å™¨Bçš„tomcatå†…éƒ¨ï¼Œåˆæœ‰ä¸¤ä¸ªçº¿ç¨‹ï¼Œä½†æ˜¯ä»–ä»¬çš„é”å¯¹è±¡å†™çš„è™½ç„¶å’ŒæœåŠ¡å™¨Aä¸€æ ·ï¼Œä½†æ˜¯é”å¯¹è±¡å´ä¸æ˜¯åŒä¸€ä¸ªï¼Œæ‰€ä»¥çº¿ç¨‹3å’Œçº¿ç¨‹4å¯ä»¥å®ç°äº’æ–¥ï¼Œä½†æ˜¯å´æ— æ³•å’Œçº¿ç¨‹1å’Œçº¿ç¨‹2å®ç°äº’æ–¥ï¼Œè¿™å°±æ˜¯ é›†ç¾¤ç¯å¢ƒä¸‹ï¼Œsyné”å¤±æ•ˆçš„åŸå› ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å°±éœ€è¦ä½¿ç”¨åˆ†å¸ƒå¼é”æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/1653374044740.png" alt="1653374044740"></p><h2 id="4ã€åˆ†å¸ƒå¼é”"><strong>4ã€åˆ†å¸ƒå¼é”</strong></h2><h3 id="4-1-ã€åŸºæœ¬åŸç†å’Œå®ç°æ–¹å¼å¯¹æ¯”">4.1 ã€åŸºæœ¬åŸç†å’Œå®ç°æ–¹å¼å¯¹æ¯”</h3><p>åˆ†å¸ƒå¼é”ï¼šæ»¡è¶³åˆ†å¸ƒå¼ç³»ç»Ÿæˆ–é›†ç¾¤æ¨¡å¼ä¸‹å¤šè¿›ç¨‹å¯è§å¹¶ä¸”äº’æ–¥çš„é”ã€‚</p><p>åˆ†å¸ƒå¼é”çš„æ ¸å¿ƒæ€æƒ³å°±æ˜¯è®©å¤§å®¶éƒ½ä½¿ç”¨åŒä¸€æŠŠé”ï¼Œåªè¦å¤§å®¶ä½¿ç”¨çš„æ˜¯åŒä¸€æŠŠé”ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±èƒ½é”ä½çº¿ç¨‹ï¼Œä¸è®©çº¿ç¨‹è¿›è¡Œï¼Œè®©ç¨‹åºä¸²è¡Œæ‰§è¡Œï¼Œè¿™å°±æ˜¯åˆ†å¸ƒå¼é”çš„æ ¸å¿ƒæ€è·¯</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/1653374296906.png" alt="1653374296906"></p><p>é‚£ä¹ˆåˆ†å¸ƒå¼é”ä»–åº”è¯¥æ»¡è¶³ä¸€äº›ä»€ä¹ˆæ ·çš„æ¡ä»¶å‘¢ï¼Ÿ</p><p>å¯è§æ€§ï¼šå¤šä¸ªçº¿ç¨‹éƒ½èƒ½çœ‹åˆ°ç›¸åŒçš„ç»“æœï¼Œæ³¨æ„ï¼šè¿™ä¸ªåœ°æ–¹è¯´çš„å¯è§æ€§å¹¶ä¸æ˜¯å¹¶å‘ç¼–ç¨‹ä¸­æŒ‡çš„å†…å­˜å¯è§æ€§ï¼Œåªæ˜¯è¯´å¤šä¸ªè¿›ç¨‹ä¹‹é—´éƒ½èƒ½æ„ŸçŸ¥åˆ°å˜åŒ–çš„æ„æ€</p><p>äº’æ–¥ï¼šäº’æ–¥æ˜¯åˆ†å¸ƒå¼é”çš„æœ€åŸºæœ¬çš„æ¡ä»¶ï¼Œä½¿å¾—ç¨‹åºä¸²è¡Œæ‰§è¡Œ</p><p>é«˜å¯ç”¨ï¼šç¨‹åºä¸æ˜“å´©æºƒï¼Œæ—¶æ—¶åˆ»åˆ»éƒ½ä¿è¯è¾ƒé«˜çš„å¯ç”¨æ€§</p><p>é«˜æ€§èƒ½ï¼šç”±äºåŠ é”æœ¬èº«å°±è®©æ€§èƒ½é™ä½ï¼Œæ‰€æœ‰å¯¹äºåˆ†å¸ƒå¼é”æœ¬èº«éœ€è¦ä»–å°±è¾ƒé«˜çš„åŠ é”æ€§èƒ½å’Œé‡Šæ”¾é”æ€§èƒ½</p><p>å®‰å…¨æ€§ï¼šå®‰å…¨ä¹Ÿæ˜¯ç¨‹åºä¸­å¿…ä¸å¯å°‘çš„ä¸€ç¯</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/1653381992018.png" alt="1653381992018"></p><p>å¸¸è§çš„åˆ†å¸ƒå¼é”æœ‰ä¸‰ç§</p><p>Mysqlï¼šmysqlæœ¬èº«å°±å¸¦æœ‰é”æœºåˆ¶ï¼Œä½†æ˜¯ç”±äºmysqlæ€§èƒ½æœ¬èº«ä¸€èˆ¬ï¼Œæ‰€ä»¥é‡‡ç”¨åˆ†å¸ƒå¼é”çš„æƒ…å†µä¸‹ï¼Œå…¶å®ä½¿ç”¨mysqlä½œä¸ºåˆ†å¸ƒå¼é”æ¯”è¾ƒå°‘è§</p><p>Redisï¼šredisä½œä¸ºåˆ†å¸ƒå¼é”æ˜¯éå¸¸å¸¸è§çš„ä¸€ç§ä½¿ç”¨æ–¹å¼ï¼Œç°åœ¨ä¼ä¸šçº§å¼€å‘ä¸­åŸºæœ¬éƒ½ä½¿ç”¨redisæˆ–è€…zookeeperä½œä¸ºåˆ†å¸ƒå¼é”ï¼Œåˆ©ç”¨setnxè¿™ä¸ªæ–¹æ³•ï¼Œå¦‚æœæ’å…¥keyæˆåŠŸï¼Œåˆ™è¡¨ç¤ºè·å¾—åˆ°äº†é”ï¼Œå¦‚æœæœ‰äººæ’å…¥æˆåŠŸï¼Œå…¶ä»–äººæ’å…¥å¤±è´¥åˆ™è¡¨ç¤ºæ— æ³•è·å¾—åˆ°é”ï¼Œåˆ©ç”¨è¿™å¥—é€»è¾‘æ¥å®ç°åˆ†å¸ƒå¼é”</p><p>Zookeeperï¼šzookeeperä¹Ÿæ˜¯ä¼ä¸šçº§å¼€å‘ä¸­è¾ƒå¥½çš„ä¸€ä¸ªå®ç°åˆ†å¸ƒå¼é”çš„æ–¹æ¡ˆï¼Œç”±äºæœ¬å¥—è§†é¢‘å¹¶ä¸è®²è§£zookeeperçš„åŸç†å’Œåˆ†å¸ƒå¼é”çš„å®ç°ï¼Œæ‰€ä»¥ä¸è¿‡å¤šé˜è¿°</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/1653382219377.png" alt="1653382219377"></p><h3 id="4-2-ã€Redisåˆ†å¸ƒå¼é”çš„å®ç°æ ¸å¿ƒæ€è·¯">4.2 ã€Redisåˆ†å¸ƒå¼é”çš„å®ç°æ ¸å¿ƒæ€è·¯</h3><p>å®ç°åˆ†å¸ƒå¼é”æ—¶éœ€è¦å®ç°çš„ä¸¤ä¸ªåŸºæœ¬æ–¹æ³•ï¼š</p><ul><li><p>è·å–é”ï¼š</p><ul><li>äº’æ–¥ï¼šç¡®ä¿åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹è·å–é”</li><li>éé˜»å¡ï¼šå°è¯•ä¸€æ¬¡ï¼ŒæˆåŠŸè¿”å›trueï¼Œå¤±è´¥è¿”å›false</li></ul></li><li><p>é‡Šæ”¾é”ï¼š</p><ul><li>æ‰‹åŠ¨é‡Šæ”¾</li><li>è¶…æ—¶é‡Šæ”¾ï¼šè·å–é”æ—¶æ·»åŠ ä¸€ä¸ªè¶…æ—¶æ—¶é—´</li></ul><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/1653382669900.png" alt="1653382669900"></p></li></ul><p>æ ¸å¿ƒæ€è·¯ï¼š</p><p>æˆ‘ä»¬åˆ©ç”¨redis çš„setNx æ–¹æ³•ï¼Œå½“æœ‰å¤šä¸ªçº¿ç¨‹è¿›å…¥æ—¶ï¼Œæˆ‘ä»¬å°±åˆ©ç”¨è¯¥æ–¹æ³•ï¼Œç¬¬ä¸€ä¸ªçº¿ç¨‹è¿›å…¥æ—¶ï¼Œredis ä¸­å°±æœ‰è¿™ä¸ªkey äº†ï¼Œè¿”å›äº†1ï¼Œå¦‚æœç»“æœæ˜¯1ï¼Œåˆ™è¡¨ç¤ºä»–æŠ¢åˆ°äº†é”ï¼Œé‚£ä¹ˆä»–å»æ‰§è¡Œä¸šåŠ¡ï¼Œç„¶åå†åˆ é™¤é”ï¼Œé€€å‡ºé”é€»è¾‘ï¼Œæ²¡æœ‰æŠ¢åˆ°é”çš„å“¥ä»¬ï¼Œç­‰å¾…ä¸€å®šæ—¶é—´åé‡è¯•å³å¯</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/1653382830810.png" alt="1653382830810"></p><h3 id="4-3-å®ç°åˆ†å¸ƒå¼é”ç‰ˆæœ¬ä¸€">4.3 å®ç°åˆ†å¸ƒå¼é”ç‰ˆæœ¬ä¸€</h3><ul><li>åŠ é”é€»è¾‘</li></ul><p><strong>é”çš„åŸºæœ¬æ¥å£</strong></p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/1656079017728.png" alt="1656079017728"></p><p><strong>SimpleRedisLock</strong></p><p>åˆ©ç”¨setnxæ–¹æ³•è¿›è¡ŒåŠ é”ï¼ŒåŒæ—¶å¢åŠ è¿‡æœŸæ—¶é—´ï¼Œé˜²æ­¢æ­»é”ï¼Œæ­¤æ–¹æ³•å¯ä»¥ä¿è¯åŠ é”å’Œå¢åŠ è¿‡æœŸæ—¶é—´å…·æœ‰åŸå­æ€§</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String KEY_PREFIX=<span class="string">&quot;lock:&quot;</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">tryLock</span><span class="params">(<span class="type">long</span> timeoutSec)</span> &#123;</span><br><span class="line">    <span class="comment">// è·å–çº¿ç¨‹æ ‡ç¤º</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">threadId</span> <span class="operator">=</span> Thread.currentThread().getId()</span><br><span class="line">    <span class="comment">// è·å–é”</span></span><br><span class="line">    <span class="type">Boolean</span> <span class="variable">success</span> <span class="operator">=</span> stringRedisTemplate.opsForValue()</span><br><span class="line">            .setIfAbsent(KEY_PREFIX + name, threadId + <span class="string">&quot;&quot;</span>, timeoutSec, TimeUnit.SECONDS);</span><br><span class="line">    <span class="keyword">return</span> Boolean.TRUE.equals(success);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>é‡Šæ”¾é”é€»è¾‘</li></ul><p>SimpleRedisLock</p><p>é‡Šæ”¾é”ï¼Œé˜²æ­¢åˆ é™¤åˆ«äººçš„é”</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">unlock</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">//é€šè¿‡delåˆ é™¤é”</span></span><br><span class="line">    stringRedisTemplate.delete(KEY_PREFIX + name);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ä¿®æ”¹ä¸šåŠ¡ä»£ç </li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> Result <span class="title function_">seckillVoucher</span><span class="params">(Long voucherId)</span> &#123;</span><br><span class="line">      <span class="comment">// 1.æŸ¥è¯¢ä¼˜æƒ åˆ¸</span></span><br><span class="line">      <span class="type">SeckillVoucher</span> <span class="variable">voucher</span> <span class="operator">=</span> seckillVoucherService.getById(voucherId);</span><br><span class="line">      <span class="comment">// 2.åˆ¤æ–­ç§’æ€æ˜¯å¦å¼€å§‹</span></span><br><span class="line">      <span class="keyword">if</span> (voucher.getBeginTime().isAfter(LocalDateTime.now())) &#123;</span><br><span class="line">          <span class="comment">// å°šæœªå¼€å§‹</span></span><br><span class="line">          <span class="keyword">return</span> Result.fail(<span class="string">&quot;ç§’æ€å°šæœªå¼€å§‹ï¼&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// 3.åˆ¤æ–­ç§’æ€æ˜¯å¦å·²ç»ç»“æŸ</span></span><br><span class="line">      <span class="keyword">if</span> (voucher.getEndTime().isBefore(LocalDateTime.now())) &#123;</span><br><span class="line">          <span class="comment">// å°šæœªå¼€å§‹</span></span><br><span class="line">          <span class="keyword">return</span> Result.fail(<span class="string">&quot;ç§’æ€å·²ç»ç»“æŸï¼&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// 4.åˆ¤æ–­åº“å­˜æ˜¯å¦å……è¶³</span></span><br><span class="line">      <span class="keyword">if</span> (voucher.getStock() &lt; <span class="number">1</span>) &#123;</span><br><span class="line">          <span class="comment">// åº“å­˜ä¸è¶³</span></span><br><span class="line">          <span class="keyword">return</span> Result.fail(<span class="string">&quot;åº“å­˜ä¸è¶³ï¼&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> UserHolder.getUser().getId();</span><br><span class="line">      <span class="comment">//åˆ›å»ºé”å¯¹è±¡(æ–°å¢ä»£ç )</span></span><br><span class="line">      <span class="type">SimpleRedisLock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleRedisLock</span>(<span class="string">&quot;order:&quot;</span> + userId, stringRedisTemplate);</span><br><span class="line">      <span class="comment">//è·å–é”å¯¹è±¡</span></span><br><span class="line">      <span class="type">boolean</span> <span class="variable">isLock</span> <span class="operator">=</span> lock.tryLock(<span class="number">1200</span>);</span><br><span class="line"><span class="comment">//åŠ é”å¤±è´¥</span></span><br><span class="line">      <span class="keyword">if</span> (!isLock) &#123;</span><br><span class="line">          <span class="keyword">return</span> Result.fail(<span class="string">&quot;ä¸å…è®¸é‡å¤ä¸‹å•&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">          <span class="comment">//è·å–ä»£ç†å¯¹è±¡(äº‹åŠ¡)</span></span><br><span class="line">          <span class="type">IVoucherOrderService</span> <span class="variable">proxy</span> <span class="operator">=</span> (IVoucherOrderService) AopContext.currentProxy();</span><br><span class="line">          <span class="keyword">return</span> proxy.createVoucherOrder(voucherId);</span><br><span class="line">      &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">          <span class="comment">//é‡Šæ”¾é”</span></span><br><span class="line">          lock.unlock();</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h3 id="4-4-Redisåˆ†å¸ƒå¼é”è¯¯åˆ æƒ…å†µè¯´æ˜">4.4 Redisåˆ†å¸ƒå¼é”è¯¯åˆ æƒ…å†µè¯´æ˜</h3><p>é€»è¾‘è¯´æ˜ï¼š</p><p>æŒæœ‰é”çš„çº¿ç¨‹åœ¨é”çš„å†…éƒ¨å‡ºç°äº†é˜»å¡ï¼Œå¯¼è‡´ä»–çš„é”è‡ªåŠ¨é‡Šæ”¾ï¼Œè¿™æ—¶å…¶ä»–çº¿ç¨‹ï¼Œçº¿ç¨‹2æ¥å°è¯•è·å¾—é”ï¼Œå°±æ‹¿åˆ°äº†è¿™æŠŠé”ï¼Œç„¶åçº¿ç¨‹2åœ¨æŒæœ‰é”æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œçº¿ç¨‹1ååº”è¿‡æ¥ï¼Œç»§ç»­æ‰§è¡Œï¼Œè€Œçº¿ç¨‹1æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œèµ°åˆ°äº†åˆ é™¤é”é€»è¾‘ï¼Œæ­¤æ—¶å°±ä¼šæŠŠæœ¬åº”è¯¥å±äºçº¿ç¨‹2çš„é”è¿›è¡Œåˆ é™¤ï¼Œè¿™å°±æ˜¯è¯¯åˆ åˆ«äººé”çš„æƒ…å†µè¯´æ˜</p><p>è§£å†³æ–¹æ¡ˆï¼šè§£å†³æ–¹æ¡ˆå°±æ˜¯åœ¨æ¯ä¸ªçº¿ç¨‹é‡Šæ”¾é”çš„æ—¶å€™ï¼Œå»åˆ¤æ–­ä¸€ä¸‹å½“å‰è¿™æŠŠé”æ˜¯å¦å±äºè‡ªå·±ï¼Œå¦‚æœå±äºè‡ªå·±ï¼Œåˆ™ä¸è¿›è¡Œé”çš„åˆ é™¤ï¼Œå‡è®¾è¿˜æ˜¯ä¸Šè¾¹çš„æƒ…å†µï¼Œçº¿ç¨‹1å¡é¡¿ï¼Œé”è‡ªåŠ¨é‡Šæ”¾ï¼Œçº¿ç¨‹2è¿›å…¥åˆ°é”çš„å†…éƒ¨æ‰§è¡Œé€»è¾‘ï¼Œæ­¤æ—¶çº¿ç¨‹1ååº”è¿‡æ¥ï¼Œç„¶ååˆ é™¤é”ï¼Œä½†æ˜¯çº¿ç¨‹1ï¼Œä¸€çœ‹å½“å‰è¿™æŠŠé”ä¸æ˜¯å±äºè‡ªå·±ï¼Œäºæ˜¯ä¸è¿›è¡Œåˆ é™¤é”é€»è¾‘ï¼Œå½“çº¿ç¨‹2èµ°åˆ°åˆ é™¤é”é€»è¾‘æ—¶ï¼Œå¦‚æœæ²¡æœ‰å¡è¿‡è‡ªåŠ¨é‡Šæ”¾é”çš„æ—¶é—´ç‚¹ï¼Œåˆ™åˆ¤æ–­å½“å‰è¿™æŠŠé”æ˜¯å±äºè‡ªå·±çš„ï¼Œäºæ˜¯åˆ é™¤è¿™æŠŠé”ã€‚</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/1653385920025.png" alt="1653385920025"></p><h3 id="4-5-è§£å†³Redisåˆ†å¸ƒå¼é”è¯¯åˆ é—®é¢˜">4.5 è§£å†³Redisåˆ†å¸ƒå¼é”è¯¯åˆ é—®é¢˜</h3><p>éœ€æ±‚ï¼šä¿®æ”¹ä¹‹å‰çš„åˆ†å¸ƒå¼é”å®ç°ï¼Œæ»¡è¶³ï¼šåœ¨è·å–é”æ—¶å­˜å…¥çº¿ç¨‹æ ‡ç¤ºï¼ˆå¯ä»¥ç”¨UUIDè¡¨ç¤ºï¼‰<br>åœ¨é‡Šæ”¾é”æ—¶å…ˆè·å–é”ä¸­çš„çº¿ç¨‹æ ‡ç¤ºï¼Œåˆ¤æ–­æ˜¯å¦ä¸å½“å‰çº¿ç¨‹æ ‡ç¤ºä¸€è‡´</p><ul><li>å¦‚æœä¸€è‡´åˆ™é‡Šæ”¾é”</li><li>å¦‚æœä¸ä¸€è‡´åˆ™ä¸é‡Šæ”¾é”</li></ul><p>æ ¸å¿ƒé€»è¾‘ï¼šåœ¨å­˜å…¥é”æ—¶ï¼Œæ”¾å…¥è‡ªå·±çº¿ç¨‹çš„æ ‡è¯†ï¼Œåœ¨åˆ é™¤é”æ—¶ï¼Œåˆ¤æ–­å½“å‰è¿™æŠŠé”çš„æ ‡è¯†æ˜¯ä¸æ˜¯è‡ªå·±å­˜å…¥çš„ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™è¿›è¡Œåˆ é™¤ï¼Œå¦‚æœä¸æ˜¯ï¼Œåˆ™ä¸è¿›è¡Œåˆ é™¤ã€‚</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/1653387398820.png" alt="1653387398820"></p><p>å…·ä½“ä»£ç å¦‚ä¸‹ï¼šåŠ é”</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">ID_PREFIX</span> <span class="operator">=</span> UUID.randomUUID().toString(<span class="literal">true</span>) + <span class="string">&quot;-&quot;</span>;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">tryLock</span><span class="params">(<span class="type">long</span> timeoutSec)</span> &#123;</span><br><span class="line">   <span class="comment">// è·å–çº¿ç¨‹æ ‡ç¤º</span></span><br><span class="line">   <span class="type">String</span> <span class="variable">threadId</span> <span class="operator">=</span> ID_PREFIX + Thread.currentThread().getId();</span><br><span class="line">   <span class="comment">// è·å–é”</span></span><br><span class="line">   <span class="type">Boolean</span> <span class="variable">success</span> <span class="operator">=</span> stringRedisTemplate.opsForValue()</span><br><span class="line">                .setIfAbsent(KEY_PREFIX + name, threadId, timeoutSec, TimeUnit.SECONDS);</span><br><span class="line">   <span class="keyword">return</span> Boolean.TRUE.equals(success);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‡Šæ”¾é”</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">unlock</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// è·å–çº¿ç¨‹æ ‡ç¤º</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">threadId</span> <span class="operator">=</span> ID_PREFIX + Thread.currentThread().getId();</span><br><span class="line">    <span class="comment">// è·å–é”ä¸­çš„æ ‡ç¤º</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">id</span> <span class="operator">=</span> stringRedisTemplate.opsForValue().get(KEY_PREFIX + name);</span><br><span class="line">    <span class="comment">// åˆ¤æ–­æ ‡ç¤ºæ˜¯å¦ä¸€è‡´</span></span><br><span class="line">    <span class="keyword">if</span>(threadId.equals(id)) &#123;</span><br><span class="line">        <span class="comment">// é‡Šæ”¾é”</span></span><br><span class="line">        stringRedisTemplate.delete(KEY_PREFIX + name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æœ‰å…³ä»£ç å®æ“è¯´æ˜ï¼š</strong></p><p>åœ¨æˆ‘ä»¬ä¿®æ”¹å®Œæ­¤å¤„ä»£ç åï¼Œæˆ‘ä»¬é‡å¯å·¥ç¨‹ï¼Œç„¶åå¯åŠ¨ä¸¤ä¸ªçº¿ç¨‹ï¼Œç¬¬ä¸€ä¸ªçº¿ç¨‹æŒæœ‰é”åï¼Œæ‰‹åŠ¨é‡Šæ”¾é”ï¼Œç¬¬äºŒä¸ªçº¿ç¨‹ æ­¤æ—¶è¿›å…¥åˆ°é”å†…éƒ¨ï¼Œå†æ”¾è¡Œç¬¬ä¸€ä¸ªçº¿ç¨‹ï¼Œæ­¤æ—¶ç¬¬ä¸€ä¸ªçº¿ç¨‹ç”±äºé”çš„valueå€¼å¹¶éæ˜¯è‡ªå·±ï¼Œæ‰€ä»¥ä¸èƒ½é‡Šæ”¾é”ï¼Œä¹Ÿå°±æ— æ³•åˆ é™¤åˆ«äººçš„é”ï¼Œæ­¤æ—¶ç¬¬äºŒä¸ªçº¿ç¨‹èƒ½å¤Ÿæ­£ç¡®é‡Šæ”¾é”ï¼Œé€šè¿‡è¿™ä¸ªæ¡ˆä¾‹åˆæ­¥è¯´æ˜æˆ‘ä»¬è§£å†³äº†é”è¯¯åˆ çš„é—®é¢˜ã€‚</p><h3 id="4-6-åˆ†å¸ƒå¼é”çš„åŸå­æ€§é—®é¢˜">4.6 åˆ†å¸ƒå¼é”çš„åŸå­æ€§é—®é¢˜</h3><p>æ›´ä¸ºæç«¯çš„è¯¯åˆ é€»è¾‘è¯´æ˜ï¼š</p><p>çº¿ç¨‹1ç°åœ¨æŒæœ‰é”ä¹‹åï¼Œåœ¨æ‰§è¡Œä¸šåŠ¡é€»è¾‘è¿‡ç¨‹ä¸­ï¼Œä»–æ­£å‡†å¤‡åˆ é™¤é”ï¼Œè€Œä¸”å·²ç»èµ°åˆ°äº†æ¡ä»¶åˆ¤æ–­çš„è¿‡ç¨‹ä¸­ï¼Œæ¯”å¦‚ä»–å·²ç»æ‹¿åˆ°äº†å½“å‰è¿™æŠŠé”ç¡®å®æ˜¯å±äºä»–è‡ªå·±çš„ï¼Œæ­£å‡†å¤‡åˆ é™¤é”ï¼Œä½†æ˜¯æ­¤æ—¶ä»–çš„é”åˆ°æœŸäº†ï¼Œé‚£ä¹ˆæ­¤æ—¶çº¿ç¨‹2è¿›æ¥ï¼Œä½†æ˜¯çº¿ç¨‹1ä»–ä¼šæ¥ç€å¾€åæ‰§è¡Œï¼Œå½“ä»–å¡é¡¿ç»“æŸåï¼Œä»–ç›´æ¥å°±ä¼šæ‰§è¡Œåˆ é™¤é”é‚£è¡Œä»£ç ï¼Œç›¸å½“äºæ¡ä»¶åˆ¤æ–­å¹¶æ²¡æœ‰èµ·åˆ°ä½œç”¨ï¼Œè¿™å°±æ˜¯åˆ é”æ—¶çš„åŸå­æ€§é—®é¢˜ï¼Œä¹‹æ‰€ä»¥æœ‰è¿™ä¸ªé—®é¢˜ï¼Œæ˜¯å› ä¸ºçº¿ç¨‹1çš„æ‹¿é”ï¼Œæ¯”é”ï¼Œåˆ é”ï¼Œå®é™…ä¸Šå¹¶ä¸æ˜¯åŸå­æ€§çš„ï¼Œæˆ‘ä»¬è¦é˜²æ­¢åˆšæ‰çš„æƒ…å†µå‘ç”Ÿï¼Œ</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/1653387764938.png" alt="1653387764938"></p><h3 id="4-7-Luaè„šæœ¬è§£å†³å¤šæ¡å‘½ä»¤åŸå­æ€§é—®é¢˜">4.7 Luaè„šæœ¬è§£å†³å¤šæ¡å‘½ä»¤åŸå­æ€§é—®é¢˜</h3><p>Redisæä¾›äº†Luaè„šæœ¬åŠŸèƒ½ï¼Œåœ¨ä¸€ä¸ªè„šæœ¬ä¸­ç¼–å†™å¤šæ¡Rediså‘½ä»¤ï¼Œç¡®ä¿å¤šæ¡å‘½ä»¤æ‰§è¡Œæ—¶çš„åŸå­æ€§ã€‚Luaæ˜¯ä¸€ç§ç¼–ç¨‹è¯­è¨€ï¼Œå®ƒçš„åŸºæœ¬è¯­æ³•å¤§å®¶å¯ä»¥å‚è€ƒç½‘ç«™ï¼š<a href="https://www.runoob.com/lua/lua-tutorial.html%EF%BC%8C%E8%BF%99%E9%87%8C%E9%87%8D%E7%82%B9%E4%BB%8B%E7%BB%8DRedis%E6%8F%90%E4%BE%9B%E7%9A%84%E8%B0%83%E7%94%A8%E5%87%BD%E6%95%B0%EF%BC%8C%E6%88%91%E4%BB%AC%E5%8F%AF%E4%BB%A5%E4%BD%BF%E7%94%A8lua%E5%8E%BB%E6%93%8D%E4%BD%9Credis%EF%BC%8C%E5%8F%88%E8%83%BD%E4%BF%9D%E8%AF%81%E4%BB%96%E7%9A%84%E5%8E%9F%E5%AD%90%E6%80%A7%EF%BC%8C%E8%BF%99%E6%A0%B7%E5%B0%B1%E5%8F%AF%E4%BB%A5%E5%AE%9E%E7%8E%B0%E6%8B%BF%E9%94%81%E6%AF%94%E9%94%81%E5%88%A0%E9%94%81%E6%98%AF%E4%B8%80%E4%B8%AA%E5%8E%9F%E5%AD%90%E6%80%A7%E5%8A%A8%E4%BD%9C%E4%BA%86%EF%BC%8C%E4%BD%9C%E4%B8%BAJava%E7%A8%8B%E5%BA%8F%E5%91%98%E8%BF%99%E4%B8%80%E5%9D%97%E5%B9%B6%E4%B8%8D%E4%BD%9C%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E8%A6%81%E6%B1%82%EF%BC%8C%E5%B9%B6%E4%B8%8D%E9%9C%80%E8%A6%81%E5%A4%A7%E5%AE%B6%E8%BF%87%E4%BA%8E%E7%B2%BE%E9%80%9A%EF%BC%8C%E5%8F%AA%E9%9C%80%E8%A6%81%E7%9F%A5%E9%81%93%E4%BB%96%E6%9C%89%E4%BB%80%E4%B9%88%E4%BD%9C%E7%94%A8%E5%8D%B3%E5%8F%AF%E3%80%82">https://www.runoob.com/lua/lua-tutorial.htmlï¼Œè¿™é‡Œé‡ç‚¹ä»‹ç»Redisæä¾›çš„è°ƒç”¨å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨luaå»æ“ä½œredisï¼Œåˆèƒ½ä¿è¯ä»–çš„åŸå­æ€§ï¼Œè¿™æ ·å°±å¯ä»¥å®ç°æ‹¿é”æ¯”é”åˆ é”æ˜¯ä¸€ä¸ªåŸå­æ€§åŠ¨ä½œäº†ï¼Œä½œä¸ºJavaç¨‹åºå‘˜è¿™ä¸€å—å¹¶ä¸ä½œä¸€ä¸ªç®€å•è¦æ±‚ï¼Œå¹¶ä¸éœ€è¦å¤§å®¶è¿‡äºç²¾é€šï¼Œåªéœ€è¦çŸ¥é“ä»–æœ‰ä»€ä¹ˆä½œç”¨å³å¯ã€‚</a></p><p>è¿™é‡Œé‡ç‚¹ä»‹ç»Redisæä¾›çš„è°ƒç”¨å‡½æ•°ï¼Œè¯­æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis.call(<span class="string">&#x27;å‘½ä»¤åç§°&#x27;</span>, <span class="string">&#x27;key&#x27;</span>, <span class="string">&#x27;å…¶å®ƒå‚æ•°&#x27;</span>, ...)</span><br></pre></td></tr></table></figure><p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬è¦æ‰§è¡Œset name jackï¼Œåˆ™è„šæœ¬æ˜¯è¿™æ ·ï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># æ‰§è¡Œ set name jack</span><br><span class="line">redis.call(<span class="string">&#x27;set&#x27;</span>, <span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;jack&#x27;</span>)</span><br></pre></td></tr></table></figure><p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬è¦å…ˆæ‰§è¡Œset name Roseï¼Œå†æ‰§è¡Œget nameï¼Œåˆ™è„šæœ¬å¦‚ä¸‹ï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># å…ˆæ‰§è¡Œ set name jack</span><br><span class="line">redis.call(<span class="string">&#x27;set&#x27;</span>, <span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;Rose&#x27;</span>)</span><br><span class="line"># å†æ‰§è¡Œ get name</span><br><span class="line"><span class="keyword">local</span> name = redis.call(<span class="string">&#x27;get&#x27;</span>, <span class="string">&#x27;name&#x27;</span>)</span><br><span class="line"># è¿”å›</span><br><span class="line"><span class="keyword">return</span> name</span><br></pre></td></tr></table></figure><p>å†™å¥½è„šæœ¬ä»¥åï¼Œéœ€è¦ç”¨Rediså‘½ä»¤æ¥è°ƒç”¨è„šæœ¬ï¼Œè°ƒç”¨è„šæœ¬çš„å¸¸è§å‘½ä»¤å¦‚ä¸‹ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/1653392181413.png" alt="1653392181413"></p><p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬è¦æ‰§è¡Œ redis.call(â€˜setâ€™, â€˜nameâ€™, â€˜jackâ€™) è¿™ä¸ªè„šæœ¬ï¼Œè¯­æ³•å¦‚ä¸‹ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/1653392218531.png" alt="1653392218531"></p><p>å¦‚æœè„šæœ¬ä¸­çš„keyã€valueä¸æƒ³å†™æ­»ï¼Œå¯ä»¥ä½œä¸ºå‚æ•°ä¼ é€’ã€‚keyç±»å‹å‚æ•°ä¼šæ”¾å…¥KEYSæ•°ç»„ï¼Œå…¶å®ƒå‚æ•°ä¼šæ”¾å…¥ARGVæ•°ç»„ï¼Œåœ¨è„šæœ¬ä¸­å¯ä»¥ä»KEYSå’ŒARGVæ•°ç»„è·å–è¿™äº›å‚æ•°ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/1653392438917.png" alt="1653392438917"></p><p>æ¥ä¸‹æ¥æˆ‘ä»¬æ¥å›ä¸€ä¸‹æˆ‘ä»¬é‡Šæ”¾é”çš„é€»è¾‘ï¼š</p><p>é‡Šæ”¾é”çš„ä¸šåŠ¡æµç¨‹æ˜¯è¿™æ ·çš„</p><p>â€‹1ã€è·å–é”ä¸­çš„çº¿ç¨‹æ ‡ç¤º</p><p>â€‹2ã€åˆ¤æ–­æ˜¯å¦ä¸æŒ‡å®šçš„æ ‡ç¤ºï¼ˆå½“å‰çº¿ç¨‹æ ‡ç¤ºï¼‰ä¸€è‡´</p><p>â€‹3ã€å¦‚æœä¸€è‡´åˆ™é‡Šæ”¾é”ï¼ˆåˆ é™¤ï¼‰</p><p>â€‹4ã€å¦‚æœä¸ä¸€è‡´åˆ™ä»€ä¹ˆéƒ½ä¸åš</p><p>å¦‚æœç”¨Luaè„šæœ¬æ¥è¡¨ç¤ºåˆ™æ˜¯è¿™æ ·çš„ï¼š</p><p>æœ€ç»ˆæˆ‘ä»¬æ“ä½œredisçš„æ‹¿é”æ¯”é”åˆ é”çš„luaè„šæœ¬å°±ä¼šå˜æˆè¿™æ ·</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- è¿™é‡Œçš„ KEYS[1] å°±æ˜¯é”çš„keyï¼Œè¿™é‡Œçš„ARGV[1] å°±æ˜¯å½“å‰çº¿ç¨‹æ ‡ç¤º</span></span><br><span class="line"><span class="comment">-- è·å–é”ä¸­çš„æ ‡ç¤ºï¼Œåˆ¤æ–­æ˜¯å¦ä¸å½“å‰çº¿ç¨‹æ ‡ç¤ºä¸€è‡´</span></span><br><span class="line"><span class="keyword">if</span> (redis.call(<span class="string">&#x27;GET&#x27;</span>, KEYS[<span class="number">1</span>]) == ARGV[<span class="number">1</span>]) <span class="keyword">then</span></span><br><span class="line">  <span class="comment">-- ä¸€è‡´ï¼Œåˆ™åˆ é™¤é”</span></span><br><span class="line">  <span class="keyword">return</span> redis.call(<span class="string">&#x27;DEL&#x27;</span>, KEYS[<span class="number">1</span>])</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="comment">-- ä¸ä¸€è‡´ï¼Œåˆ™ç›´æ¥è¿”å›</span></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span></span><br></pre></td></tr></table></figure><h3 id="4-8-åˆ©ç”¨Javaä»£ç è°ƒç”¨Luaè„šæœ¬æ”¹é€ åˆ†å¸ƒå¼é”">4.8 åˆ©ç”¨Javaä»£ç è°ƒç”¨Luaè„šæœ¬æ”¹é€ åˆ†å¸ƒå¼é”</h3><p>luaè„šæœ¬æœ¬èº«å¹¶ä¸éœ€è¦å¤§å®¶èŠ±è´¹å¤ªå¤šæ—¶é—´å»ç ”ç©¶ï¼Œåªéœ€è¦çŸ¥é“å¦‚ä½•è°ƒç”¨ï¼Œå¤§è‡´æ˜¯ä»€ä¹ˆæ„æ€å³å¯ï¼Œæ‰€ä»¥åœ¨ç¬”è®°ä¸­å¹¶ä¸ä¼šè¯¦ç»†çš„å»è§£é‡Šè¿™äº›luaè¡¨è¾¾å¼çš„å«ä¹‰ã€‚</p><p>æˆ‘ä»¬çš„RedisTemplateä¸­ï¼Œå¯ä»¥åˆ©ç”¨executeæ–¹æ³•å»æ‰§è¡Œluaè„šæœ¬ï¼Œå‚æ•°å¯¹åº”å…³ç³»å°±å¦‚ä¸‹å›¾è‚¡</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/1653393304844.png" alt="1653393304844"></p><p><strong>Javaä»£ç </strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> DefaultRedisScript&lt;Long&gt; UNLOCK_SCRIPT;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        UNLOCK_SCRIPT = <span class="keyword">new</span> <span class="title class_">DefaultRedisScript</span>&lt;&gt;();</span><br><span class="line">        UNLOCK_SCRIPT.setLocation(<span class="keyword">new</span> <span class="title class_">ClassPathResource</span>(<span class="string">&quot;unlock.lua&quot;</span>));</span><br><span class="line">        UNLOCK_SCRIPT.setResultType(Long.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">unlock</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// è°ƒç”¨luaè„šæœ¬</span></span><br><span class="line">    stringRedisTemplate.execute(</span><br><span class="line">            UNLOCK_SCRIPT,</span><br><span class="line">            Collections.singletonList(KEY_PREFIX + name),</span><br><span class="line">            ID_PREFIX + Thread.currentThread().getId());</span><br><span class="line">&#125;</span><br><span class="line">ç»è¿‡ä»¥ä¸Šä»£ç æ”¹é€ åï¼Œæˆ‘ä»¬å°±èƒ½å¤Ÿå®ç° æ‹¿é”æ¯”é”åˆ é”çš„åŸå­æ€§åŠ¨ä½œäº†~</span><br></pre></td></tr></table></figure><p>å°æ€»ç»“ï¼š</p><p>åŸºäºRedisçš„åˆ†å¸ƒå¼é”å®ç°æ€è·¯ï¼š</p><ul><li>åˆ©ç”¨set nx exè·å–é”ï¼Œå¹¶è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œä¿å­˜çº¿ç¨‹æ ‡ç¤º</li><li>é‡Šæ”¾é”æ—¶å…ˆåˆ¤æ–­çº¿ç¨‹æ ‡ç¤ºæ˜¯å¦ä¸è‡ªå·±ä¸€è‡´ï¼Œä¸€è‡´åˆ™åˆ é™¤é”<ul><li>ç‰¹æ€§ï¼š<ul><li>åˆ©ç”¨set nxæ»¡è¶³äº’æ–¥æ€§</li><li>åˆ©ç”¨set exä¿è¯æ•…éšœæ—¶é”ä¾ç„¶èƒ½é‡Šæ”¾ï¼Œé¿å…æ­»é”ï¼Œæé«˜å®‰å…¨æ€§</li><li>åˆ©ç”¨Redisé›†ç¾¤ä¿è¯é«˜å¯ç”¨å’Œé«˜å¹¶å‘ç‰¹æ€§</li></ul></li></ul></li></ul><p>ç¬”è€…æ€»ç»“ï¼šæˆ‘ä»¬ä¸€è·¯èµ°æ¥ï¼Œåˆ©ç”¨æ·»åŠ è¿‡æœŸæ—¶é—´ï¼Œé˜²æ­¢æ­»é”é—®é¢˜çš„å‘ç”Ÿï¼Œä½†æ˜¯æœ‰äº†è¿‡æœŸæ—¶é—´ä¹‹åï¼Œå¯èƒ½å‡ºç°è¯¯åˆ åˆ«äººé”çš„é—®é¢˜ï¼Œè¿™ä¸ªé—®é¢˜æˆ‘ä»¬å¼€å§‹æ˜¯åˆ©ç”¨åˆ ä¹‹å‰ é€šè¿‡æ‹¿é”ï¼Œæ¯”é”ï¼Œåˆ é”è¿™ä¸ªé€»è¾‘æ¥è§£å†³çš„ï¼Œä¹Ÿå°±æ˜¯åˆ ä¹‹å‰åˆ¤æ–­ä¸€ä¸‹å½“å‰è¿™æŠŠé”æ˜¯å¦æ˜¯å±äºè‡ªå·±çš„ï¼Œä½†æ˜¯ç°åœ¨è¿˜æœ‰åŸå­æ€§é—®é¢˜ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬æ²¡æ³•ä¿è¯æ‹¿é”æ¯”é”åˆ é”æ˜¯ä¸€ä¸ªåŸå­æ€§çš„åŠ¨ä½œï¼Œæœ€åé€šè¿‡luaè¡¨è¾¾å¼æ¥è§£å†³è¿™ä¸ªé—®é¢˜</p><p>ä½†æ˜¯ç›®å‰è¿˜å‰©ä¸‹ä¸€ä¸ªé—®é¢˜é”ä¸ä½ï¼Œä»€ä¹ˆæ˜¯é”ä¸ä½å‘¢ï¼Œä½ æƒ³ä¸€æƒ³ï¼Œå¦‚æœå½“è¿‡æœŸæ—¶é—´åˆ°äº†ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥ç»™ä»–ç»­æœŸä¸€ä¸‹ï¼Œæ¯”å¦‚ç»­ä¸ª30sï¼Œå°±å¥½åƒæ˜¯ç½‘å§ä¸Šç½‘ï¼Œ ç½‘è´¹åˆ°äº†ä¹‹åï¼Œç„¶åè¯´ï¼Œæ¥ï¼Œç½‘ç®¡ï¼Œå†ç»™æˆ‘æ¥10å—çš„ï¼Œæ˜¯ä¸æ˜¯åè¾¹çš„é—®é¢˜éƒ½ä¸ä¼šå‘ç”Ÿäº†ï¼Œé‚£ä¹ˆç»­æœŸé—®é¢˜æ€ä¹ˆè§£å†³å‘¢ï¼Œå¯ä»¥ä¾èµ–äºæˆ‘ä»¬æ¥ä¸‹æ¥è¦å­¦ä¹ redissionå•¦</p><p><strong>æµ‹è¯•é€»è¾‘ï¼š</strong></p><p>ç¬¬ä¸€ä¸ªçº¿ç¨‹è¿›æ¥ï¼Œå¾—åˆ°äº†é”ï¼Œæ‰‹åŠ¨åˆ é™¤é”ï¼Œæ¨¡æ‹Ÿé”è¶…æ—¶äº†ï¼Œå…¶ä»–çº¿ç¨‹ä¼šæ‰§è¡Œluaæ¥æŠ¢é”ï¼Œå½“ç¬¬ä¸€å¤©çº¿ç¨‹åˆ©ç”¨luaåˆ é™¤é”æ—¶ï¼Œluaèƒ½ä¿è¯ä»–ä¸èƒ½åˆ é™¤ä»–çš„é”ï¼Œç¬¬äºŒä¸ªçº¿ç¨‹åˆ é™¤é”æ—¶ï¼Œåˆ©ç”¨luaåŒæ ·å¯ä»¥ä¿è¯ä¸ä¼šåˆ é™¤åˆ«äººçš„é”ï¼ŒåŒæ—¶è¿˜èƒ½ä¿è¯åŸå­æ€§ã€‚</p><h2 id="5ã€åˆ†å¸ƒå¼é”-redission"><strong>5ã€åˆ†å¸ƒå¼é”-redission</strong></h2><h3 id="5-1-åˆ†å¸ƒå¼é”-redissionåŠŸèƒ½ä»‹ç»">5.1 åˆ†å¸ƒå¼é”-redissionåŠŸèƒ½ä»‹ç»</h3><p>åŸºäºsetnxå®ç°çš„åˆ†å¸ƒå¼é”å­˜åœ¨ä¸‹é¢çš„é—®é¢˜ï¼š</p><p><strong>é‡å…¥é—®é¢˜</strong>ï¼šé‡å…¥é—®é¢˜æ˜¯æŒ‡ è·å¾—é”çš„çº¿ç¨‹å¯ä»¥å†æ¬¡è¿›å…¥åˆ°ç›¸åŒçš„é”çš„ä»£ç å—ä¸­ï¼Œå¯é‡å…¥é”çš„æ„ä¹‰åœ¨äºé˜²æ­¢æ­»é”ï¼Œæ¯”å¦‚HashTableè¿™æ ·çš„ä»£ç ä¸­ï¼Œä»–çš„æ–¹æ³•éƒ½æ˜¯ä½¿ç”¨synchronizedä¿®é¥°çš„ï¼Œå‡å¦‚ä»–åœ¨ä¸€ä¸ªæ–¹æ³•å†…ï¼Œè°ƒç”¨å¦ä¸€ä¸ªæ–¹æ³•ï¼Œé‚£ä¹ˆæ­¤æ—¶å¦‚æœæ˜¯ä¸å¯é‡å…¥çš„ï¼Œä¸å°±æ­»é”äº†å—ï¼Ÿæ‰€ä»¥å¯é‡å…¥é”ä»–çš„ä¸»è¦æ„ä¹‰æ˜¯é˜²æ­¢æ­»é”ï¼Œæˆ‘ä»¬çš„synchronizedå’ŒLocké”éƒ½æ˜¯å¯é‡å…¥çš„ã€‚</p><p><strong>ä¸å¯é‡è¯•</strong>ï¼šæ˜¯æŒ‡ç›®å‰çš„åˆ†å¸ƒå¼åªèƒ½å°è¯•ä¸€æ¬¡ï¼Œæˆ‘ä»¬è®¤ä¸ºåˆç†çš„æƒ…å†µæ˜¯ï¼šå½“çº¿ç¨‹åœ¨è·å¾—é”å¤±è´¥åï¼Œä»–åº”è¯¥èƒ½å†æ¬¡å°è¯•è·å¾—é”ã€‚</p><p>**è¶…æ—¶é‡Šæ”¾ï¼š**æˆ‘ä»¬åœ¨åŠ é”æ—¶å¢åŠ äº†è¿‡æœŸæ—¶é—´ï¼Œè¿™æ ·çš„æˆ‘ä»¬å¯ä»¥é˜²æ­¢æ­»é”ï¼Œä½†æ˜¯å¦‚æœå¡é¡¿çš„æ—¶é—´è¶…é•¿ï¼Œè™½ç„¶æˆ‘ä»¬é‡‡ç”¨äº†luaè¡¨è¾¾å¼é˜²æ­¢åˆ é”çš„æ—¶å€™ï¼Œè¯¯åˆ åˆ«äººçš„é”ï¼Œä½†æ˜¯æ¯•ç«Ÿæ²¡æœ‰é”ä½ï¼Œæœ‰å®‰å…¨éšæ‚£</p><p><strong>ä¸»ä»ä¸€è‡´æ€§ï¼š</strong> å¦‚æœRedisæä¾›äº†ä¸»ä»é›†ç¾¤ï¼Œå½“æˆ‘ä»¬å‘é›†ç¾¤å†™æ•°æ®æ—¶ï¼Œä¸»æœºéœ€è¦å¼‚æ­¥çš„å°†æ•°æ®åŒæ­¥ç»™ä»æœºï¼Œè€Œä¸‡ä¸€åœ¨åŒæ­¥è¿‡å»ä¹‹å‰ï¼Œä¸»æœºå®•æœºäº†ï¼Œå°±ä¼šå‡ºç°æ­»é”é—®é¢˜ã€‚</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/1653546070602.png" alt="1653546070602"></p><p>é‚£ä¹ˆä»€ä¹ˆæ˜¯Redissionå‘¢</p><p>Redissonæ˜¯ä¸€ä¸ªåœ¨Redisçš„åŸºç¡€ä¸Šå®ç°çš„Javaé©»å†…å­˜æ•°æ®ç½‘æ ¼ï¼ˆIn-Memory Data Gridï¼‰ã€‚å®ƒä¸ä»…æä¾›äº†ä¸€ç³»åˆ—çš„åˆ†å¸ƒå¼çš„Javaå¸¸ç”¨å¯¹è±¡ï¼Œè¿˜æä¾›äº†è®¸å¤šåˆ†å¸ƒå¼æœåŠ¡ï¼Œå…¶ä¸­å°±åŒ…å«äº†å„ç§åˆ†å¸ƒå¼é”çš„å®ç°ã€‚</p><p>Redissionæä¾›äº†åˆ†å¸ƒå¼é”çš„å¤šç§å¤šæ ·çš„åŠŸèƒ½</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/1653546736063.png" alt="1653546736063"></p><h3 id="5-2-åˆ†å¸ƒå¼é”-Redissionå¿«é€Ÿå…¥é—¨">5.2 åˆ†å¸ƒå¼é”-Redissionå¿«é€Ÿå…¥é—¨</h3><p>å¼•å…¥ä¾èµ–ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">&lt;groupId&gt;org.redisson&lt;/groupId&gt;</span><br><span class="line">&lt;artifactId&gt;redisson&lt;/artifactId&gt;</span><br><span class="line">&lt;version&gt;<span class="number">3.13</span><span class="number">.6</span>&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure><p>é…ç½®Redissonå®¢æˆ·ç«¯ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedissonConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RedissonClient <span class="title function_">redissonClient</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">// é…ç½®</span></span><br><span class="line">        <span class="type">Config</span> <span class="variable">config</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Config</span>();</span><br><span class="line">        config.useSingleServer().setAddress(<span class="string">&quot;redis://192.168.150.101:6379&quot;</span>)</span><br><span class="line">            .setPassword(<span class="string">&quot;123321&quot;</span>);</span><br><span class="line">        <span class="comment">// åˆ›å»ºRedissonClientå¯¹è±¡</span></span><br><span class="line">        <span class="keyword">return</span> Redisson.create(config);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å¦‚ä½•ä½¿ç”¨Redissionçš„åˆ†å¸ƒå¼é”</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Resource</span></span><br><span class="line"><span class="keyword">private</span> RedissionClient redissonClient;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testRedisson</span><span class="params">()</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">    <span class="comment">//è·å–é”(å¯é‡å…¥)ï¼ŒæŒ‡å®šé”çš„åç§°</span></span><br><span class="line">    <span class="type">RLock</span> <span class="variable">lock</span> <span class="operator">=</span> redissonClient.getLock(<span class="string">&quot;anyLock&quot;</span>);</span><br><span class="line">    <span class="comment">//å°è¯•è·å–é”ï¼Œå‚æ•°åˆ†åˆ«æ˜¯ï¼šè·å–é”çš„æœ€å¤§ç­‰å¾…æ—¶é—´(æœŸé—´ä¼šé‡è¯•)ï¼Œé”è‡ªåŠ¨é‡Šæ”¾æ—¶é—´ï¼Œæ—¶é—´å•ä½</span></span><br><span class="line">    <span class="type">boolean</span> <span class="variable">isLock</span> <span class="operator">=</span> lock.tryLock(<span class="number">1</span>,<span class="number">10</span>,TimeUnit.SECONDS);</span><br><span class="line">    <span class="comment">//åˆ¤æ–­è·å–é”æˆåŠŸ</span></span><br><span class="line">    <span class="keyword">if</span>(isLock)&#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;æ‰§è¡Œä¸šåŠ¡&quot;</span>);          </span><br><span class="line">        &#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">            <span class="comment">//é‡Šæ”¾é”</span></span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ VoucherOrderServiceImpl</p><p>æ³¨å…¥RedissonClient</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Resource</span></span><br><span class="line"><span class="keyword">private</span> RedissonClient redissonClient;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">seckillVoucher</span><span class="params">(Long voucherId)</span> &#123;</span><br><span class="line">        <span class="comment">// 1.æŸ¥è¯¢ä¼˜æƒ åˆ¸</span></span><br><span class="line">        <span class="type">SeckillVoucher</span> <span class="variable">voucher</span> <span class="operator">=</span> seckillVoucherService.getById(voucherId);</span><br><span class="line">        <span class="comment">// 2.åˆ¤æ–­ç§’æ€æ˜¯å¦å¼€å§‹</span></span><br><span class="line">        <span class="keyword">if</span> (voucher.getBeginTime().isAfter(LocalDateTime.now())) &#123;</span><br><span class="line">            <span class="comment">// å°šæœªå¼€å§‹</span></span><br><span class="line">            <span class="keyword">return</span> Result.fail(<span class="string">&quot;ç§’æ€å°šæœªå¼€å§‹ï¼&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 3.åˆ¤æ–­ç§’æ€æ˜¯å¦å·²ç»ç»“æŸ</span></span><br><span class="line">        <span class="keyword">if</span> (voucher.getEndTime().isBefore(LocalDateTime.now())) &#123;</span><br><span class="line">            <span class="comment">// å°šæœªå¼€å§‹</span></span><br><span class="line">            <span class="keyword">return</span> Result.fail(<span class="string">&quot;ç§’æ€å·²ç»ç»“æŸï¼&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 4.åˆ¤æ–­åº“å­˜æ˜¯å¦å……è¶³</span></span><br><span class="line">        <span class="keyword">if</span> (voucher.getStock() &lt; <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="comment">// åº“å­˜ä¸è¶³</span></span><br><span class="line">            <span class="keyword">return</span> Result.fail(<span class="string">&quot;åº“å­˜ä¸è¶³ï¼&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> UserHolder.getUser().getId();</span><br><span class="line">        <span class="comment">//åˆ›å»ºé”å¯¹è±¡ è¿™ä¸ªä»£ç ä¸ç”¨äº†ï¼Œå› ä¸ºæˆ‘ä»¬ç°åœ¨è¦ä½¿ç”¨åˆ†å¸ƒå¼é”</span></span><br><span class="line">        <span class="comment">//SimpleRedisLock lock = new SimpleRedisLock(&quot;order:&quot; + userId, stringRedisTemplate);</span></span><br><span class="line">        <span class="type">RLock</span> <span class="variable">lock</span> <span class="operator">=</span> redissonClient.getLock(<span class="string">&quot;lock:order:&quot;</span> + userId);</span><br><span class="line">        <span class="comment">//è·å–é”å¯¹è±¡</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">isLock</span> <span class="operator">=</span> lock.tryLock();</span><br><span class="line">       </span><br><span class="line"><span class="comment">//åŠ é”å¤±è´¥</span></span><br><span class="line">        <span class="keyword">if</span> (!isLock) &#123;</span><br><span class="line">            <span class="keyword">return</span> Result.fail(<span class="string">&quot;ä¸å…è®¸é‡å¤ä¸‹å•&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//è·å–ä»£ç†å¯¹è±¡(äº‹åŠ¡)</span></span><br><span class="line">            <span class="type">IVoucherOrderService</span> <span class="variable">proxy</span> <span class="operator">=</span> (IVoucherOrderService) AopContext.currentProxy();</span><br><span class="line">            <span class="keyword">return</span> proxy.createVoucherOrder(voucherId);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">//é‡Šæ”¾é”</span></span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><h3 id="5-3-åˆ†å¸ƒå¼é”-redissionå¯é‡å…¥é”åŸç†">5.3 åˆ†å¸ƒå¼é”-redissionå¯é‡å…¥é”åŸç†</h3><p>åœ¨Locké”ä¸­ï¼Œä»–æ˜¯å€ŸåŠ©äºåº•å±‚çš„ä¸€ä¸ªvoaltileçš„ä¸€ä¸ªstateå˜é‡æ¥è®°å½•é‡å…¥çš„çŠ¶æ€çš„ï¼Œæ¯”å¦‚å½“å‰æ²¡æœ‰äººæŒæœ‰è¿™æŠŠé”ï¼Œé‚£ä¹ˆstate=0ï¼Œå‡å¦‚æœ‰äººæŒæœ‰è¿™æŠŠé”ï¼Œé‚£ä¹ˆstate=1ï¼Œå¦‚æœæŒæœ‰è¿™æŠŠé”çš„äººå†æ¬¡æŒæœ‰è¿™æŠŠé”ï¼Œé‚£ä¹ˆstateå°±ä¼š+1 ï¼Œå¦‚æœæ˜¯å¯¹äºsynchronizedè€Œè¨€ï¼Œä»–åœ¨cè¯­è¨€ä»£ç ä¸­ä¼šæœ‰ä¸€ä¸ªcountï¼ŒåŸç†å’Œstateç±»ä¼¼ï¼Œä¹Ÿæ˜¯é‡å…¥ä¸€æ¬¡å°±åŠ ä¸€ï¼Œé‡Šæ”¾ä¸€æ¬¡å°±-1 ï¼Œç›´åˆ°å‡å°‘æˆ0 æ—¶ï¼Œè¡¨ç¤ºå½“å‰è¿™æŠŠé”æ²¡æœ‰è¢«äººæŒæœ‰ã€‚</p><p>åœ¨redissionä¸­ï¼Œæˆ‘ä»¬çš„ä¹Ÿæ”¯æŒæ”¯æŒå¯é‡å…¥é”</p><p>åœ¨åˆ†å¸ƒå¼é”ä¸­ï¼Œä»–é‡‡ç”¨hashç»“æ„ç”¨æ¥å­˜å‚¨é”ï¼Œå…¶ä¸­å¤§keyè¡¨ç¤ºè¡¨ç¤ºè¿™æŠŠé”æ˜¯å¦å­˜åœ¨ï¼Œç”¨å°keyè¡¨ç¤ºå½“å‰è¿™æŠŠé”è¢«å“ªä¸ªçº¿ç¨‹æŒæœ‰ï¼Œæ‰€ä»¥æ¥ä¸‹æ¥æˆ‘ä»¬ä¸€èµ·åˆ†æä¸€ä¸‹å½“å‰çš„è¿™ä¸ªluaè¡¨è¾¾å¼</p><p>è¿™ä¸ªåœ°æ–¹ä¸€å…±æœ‰3ä¸ªå‚æ•°</p><blockquote><p><strong>KEYS[1] ï¼š é”åç§°</strong></p><p><strong>ARGV[1]ï¼š  é”å¤±æ•ˆæ—¶é—´</strong></p><p><strong>ARGV[2]ï¼š  id + â€œ:â€ + threadId; é”çš„å°key</strong></p></blockquote><blockquote><ul><li>è¯´ç™½äº†ï¼Œå…ˆåˆ¤æ–­é”å­˜åœ¨ï¼Œä¸å­˜åœ¨å°±ï¼Œè¯´æ˜æ˜¯é¦–æ¬¡æ“ä½œåˆ›å»ºé”ï¼Œè‹¥ä¸»é”å­˜åœ¨ï¼Œä¸”å“ˆå¸Œè¡¨ä¸­å­˜åœ¨å½“å‰çº¿ç¨‹çš„æ ‡è¯†ï¼ˆ<code>ARGV[2]</code>ï¼‰ï¼Œè¯´æ˜æ˜¯<strong>åŒä¸€çº¿ç¨‹å†æ¬¡è¯·æ±‚é”</strong>ï¼ˆå¯é‡å…¥åœºæ™¯ï¼‰å°†é‡å…¥æ¬¡æ•°+1ï¼Œå†è®¾ç½®è¿‡æœŸæ—¶é—´ã€‚è¿”å›nilè¡¨ç¤ºé‡å…¥é”æˆåŠŸã€‚é”è¢«å…¶ä»–çº¿ç¨‹æŒæœ‰çš„æ—¶å€™ return redis.call(â€˜pttlâ€™, KEYS[1]);</li></ul></blockquote><p>exists: åˆ¤æ–­æ•°æ®æ˜¯å¦å­˜åœ¨  nameï¼šæ˜¯lockæ˜¯å¦å­˜åœ¨,å¦‚æœ==0ï¼Œå°±è¡¨ç¤ºå½“å‰è¿™æŠŠé”ä¸å­˜åœ¨</p><p>redis.call(â€˜hsetâ€™, KEYS[1], ARGV[2], 1);æ­¤æ—¶ä»–å°±å¼€å§‹å¾€redisé‡Œè¾¹å»å†™æ•°æ® ï¼Œå†™æˆä¸€ä¸ªhashç»“æ„</p><p>Lock{</p><p>â€‹    id + <strong>â€œ:â€</strong> + threadId :  1</p><p>}</p><p>å¦‚æœå½“å‰è¿™æŠŠé”å­˜åœ¨ï¼Œåˆ™ç¬¬ä¸€ä¸ªæ¡ä»¶ä¸æ»¡è¶³ï¼Œå†åˆ¤æ–­</p><p>redis.call(â€˜hexistsâ€™, KEYS[1], ARGV[2]) == 1</p><p>æ­¤æ—¶éœ€è¦é€šè¿‡å¤§key+å°keyåˆ¤æ–­å½“å‰è¿™æŠŠé”æ˜¯å¦æ˜¯å±äºè‡ªå·±çš„ï¼Œå¦‚æœæ˜¯è‡ªå·±çš„ï¼Œåˆ™è¿›è¡Œ</p><p>redis.call(â€˜hincrbyâ€™, KEYS[1], ARGV[2], 1)</p><p>å°†å½“å‰è¿™ä¸ªé”çš„valueè¿›è¡Œ+1 ï¼Œredis.call(â€˜pexpireâ€™, KEYS[1], ARGV[1]); ç„¶åå†å¯¹å…¶è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œå¦‚æœä»¥ä¸Šä¸¤ä¸ªæ¡ä»¶éƒ½ä¸æ»¡è¶³ï¼Œåˆ™è¡¨ç¤ºå½“å‰è¿™æŠŠé”æŠ¢é”å¤±è´¥ï¼Œæœ€åè¿”å›pttlï¼Œå³ä¸ºå½“å‰è¿™æŠŠé”çš„å¤±æ•ˆæ—¶é—´</p><p>å¦‚æœå°ä¼™å¸®ä»¬çœ‹äº†å‰è¾¹çš„æºç ï¼Œ ä½ ä¼šå‘ç°ä»–ä¼šå»åˆ¤æ–­å½“å‰è¿™ä¸ªæ–¹æ³•çš„è¿”å›å€¼æ˜¯å¦ä¸ºnullï¼Œå¦‚æœæ˜¯nullï¼Œåˆ™å¯¹åº”åˆ™å‰ä¸¤ä¸ªifå¯¹åº”çš„æ¡ä»¶ï¼Œé€€å‡ºæŠ¢é”é€»è¾‘ï¼Œå¦‚æœè¿”å›çš„ä¸æ˜¯nullï¼Œå³èµ°äº†ç¬¬ä¸‰ä¸ªåˆ†æ”¯ï¼Œåœ¨æºç å¤„ä¼šè¿›è¡Œwhile(true)çš„è‡ªæ—‹æŠ¢é”ã€‚</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;if (redis.call(&#x27;exists&#x27;, KEYS[1]) == 0) then &quot;</span> +</span><br><span class="line">                  <span class="string">&quot;redis.call(&#x27;hset&#x27;, KEYS[1], ARGV[2], 1); &quot;</span> +</span><br><span class="line">                  <span class="string">&quot;redis.call(&#x27;pexpire&#x27;, KEYS[1], ARGV[1]); &quot;</span> +</span><br><span class="line">                  <span class="string">&quot;return nil; &quot;</span> +</span><br><span class="line">              <span class="string">&quot;end; &quot;</span> +</span><br><span class="line">              <span class="string">&quot;if (redis.call(&#x27;hexists&#x27;, KEYS[1], ARGV[2]) == 1) then &quot;</span> +</span><br><span class="line">                  <span class="string">&quot;redis.call(&#x27;hincrby&#x27;, KEYS[1], ARGV[2], 1); &quot;</span> +</span><br><span class="line">                  <span class="string">&quot;redis.call(&#x27;pexpire&#x27;, KEYS[1], ARGV[1]); &quot;</span> +</span><br><span class="line">                  <span class="string">&quot;return nil; &quot;</span> +</span><br><span class="line">              <span class="string">&quot;end; &quot;</span> +</span><br><span class="line">              <span class="string">&quot;return redis.call(&#x27;pttl&#x27;, KEYS[1]);&quot;</span></span><br></pre></td></tr></table></figure><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/1653548087334.png" alt="1653548087334"></p><h3 id="5-4-åˆ†å¸ƒå¼é”-redissioné”é‡è¯•å’ŒWatchDogæœºåˆ¶">5.4 åˆ†å¸ƒå¼é”-redissioné”é‡è¯•å’ŒWatchDogæœºåˆ¶</h3><p><strong>è¯´æ˜</strong>ï¼šç”±äºè¯¾ç¨‹ä¸­å·²ç»è¯´æ˜äº†æœ‰å…³tryLockçš„æºç è§£æä»¥åŠå…¶çœ‹é—¨ç‹—åŸç†ï¼Œæ‰€ä»¥ç¬”è€…åœ¨è¿™é‡Œç»™å¤§å®¶åˆ†ælock()æ–¹æ³•çš„æºç è§£æï¼Œå¸Œæœ›å¤§å®¶åœ¨å­¦ä¹ è¿‡ç¨‹ä¸­ï¼Œèƒ½å¤ŸæŒæ¡æ›´å¤šçš„çŸ¥è¯†</p><p>æŠ¢é”è¿‡ç¨‹ä¸­ï¼Œè·å¾—å½“å‰çº¿ç¨‹ï¼Œé€šè¿‡tryAcquireè¿›è¡ŒæŠ¢é”ï¼Œè¯¥æŠ¢é”é€»è¾‘å’Œä¹‹å‰é€»è¾‘ç›¸åŒ</p><p>1ã€å…ˆåˆ¤æ–­å½“å‰è¿™æŠŠé”æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œæ’å…¥ä¸€æŠŠé”ï¼Œè¿”å›null</p><p>2ã€åˆ¤æ–­å½“å‰è¿™æŠŠé”æ˜¯å¦æ˜¯å±äºå½“å‰çº¿ç¨‹ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™è¿”å›null</p><p>æ‰€ä»¥å¦‚æœè¿”å›æ˜¯nullï¼Œåˆ™ä»£è¡¨ç€å½“å‰è¿™å“¥ä»¬å·²ç»æŠ¢é”å®Œæ¯•ï¼Œæˆ–è€…å¯é‡å…¥å®Œæ¯•ï¼Œä½†æ˜¯å¦‚æœä»¥ä¸Šä¸¤ä¸ªæ¡ä»¶éƒ½ä¸æ»¡è¶³ï¼Œåˆ™è¿›å…¥åˆ°ç¬¬ä¸‰ä¸ªæ¡ä»¶ï¼Œè¿”å›çš„æ˜¯é”çš„å¤±æ•ˆæ—¶é—´ï¼ŒåŒå­¦ä»¬å¯ä»¥è‡ªè¡Œå¾€ä¸‹ç¿»ä¸€ç‚¹ç‚¹ï¼Œä½ èƒ½å‘ç°æœ‰ä¸ªwhile( true) å†æ¬¡è¿›è¡ŒtryAcquireè¿›è¡ŒæŠ¢é”</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">long</span> <span class="variable">threadId</span> <span class="operator">=</span> Thread.currentThread().getId();</span><br><span class="line"><span class="type">Long</span> <span class="variable">ttl</span> <span class="operator">=</span> tryAcquire(-<span class="number">1</span>, leaseTime, unit, threadId);</span><br><span class="line"><span class="comment">// lock acquired</span></span><br><span class="line"><span class="keyword">if</span> (ttl == <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥ä¼šæœ‰ä¸€ä¸ªæ¡ä»¶åˆ†æ”¯ï¼Œå› ä¸ºlockæ–¹æ³•æœ‰é‡è½½æ–¹æ³•ï¼Œä¸€ä¸ªæ˜¯å¸¦å‚æ•°ï¼Œä¸€ä¸ªæ˜¯ä¸å¸¦å‚æ•°ï¼Œå¦‚æœå¸¦å¸¦å‚æ•°ä¼ å…¥çš„å€¼æ˜¯-1ï¼Œå¦‚æœä¼ å…¥å‚æ•°ï¼Œåˆ™leaseTimeæ˜¯ä»–æœ¬èº«ï¼Œæ‰€ä»¥å¦‚æœä¼ å…¥äº†å‚æ•°ï¼Œæ­¤æ—¶leaseTime != -1 åˆ™ä¼šè¿›å»æŠ¢é”ï¼ŒæŠ¢é”çš„é€»è¾‘å°±æ˜¯ä¹‹å‰è¯´çš„é‚£ä¸‰ä¸ªé€»è¾‘</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (leaseTime != -<span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> tryLockInnerAsync(waitTime, leaseTime, unit, threadId, RedisCommands.EVAL_LONG);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœæ˜¯æ²¡æœ‰ä¼ å…¥æ—¶é—´ï¼Œåˆ™æ­¤æ—¶ä¹Ÿä¼šè¿›è¡ŒæŠ¢é”ï¼Œ è€Œä¸”æŠ¢é”æ—¶é—´æ˜¯é»˜è®¤çœ‹é—¨ç‹—æ—¶é—´ commandExecutor.getConnectionManager().getCfg().getLockWatchdogTimeout()</p><p>ttlRemainingFuture.onComplete((ttlRemaining, e) è¿™å¥è¯ç›¸å½“äºå¯¹ä»¥ä¸ŠæŠ¢é”è¿›è¡Œäº†ç›‘å¬ï¼Œä¹Ÿå°±æ˜¯è¯´å½“ä¸Šè¾¹æŠ¢é”å®Œæ¯•åï¼Œæ­¤æ–¹æ³•ä¼šè¢«è°ƒç”¨ï¼Œå…·ä½“è°ƒç”¨çš„é€»è¾‘å°±æ˜¯å»åå°å¼€å¯ä¸€ä¸ªçº¿ç¨‹ï¼Œè¿›è¡Œç»­çº¦é€»è¾‘ï¼Œä¹Ÿå°±æ˜¯çœ‹é—¨ç‹—çº¿ç¨‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">RFuture&lt;Long&gt; ttlRemainingFuture = tryLockInnerAsync(waitTime,</span><br><span class="line">                                        commandExecutor.getConnectionManager().getCfg().getLockWatchdogTimeout(),</span><br><span class="line">                                        TimeUnit.MILLISECONDS, threadId, RedisCommands.EVAL_LONG);</span><br><span class="line">ttlRemainingFuture.onComplete((ttlRemaining, e) -&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (e != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// lock acquired</span></span><br><span class="line">    <span class="keyword">if</span> (ttlRemaining == <span class="literal">null</span>) &#123;</span><br><span class="line">        scheduleExpirationRenewal(threadId);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">return</span> ttlRemainingFuture;</span><br></pre></td></tr></table></figure><p>æ­¤é€»è¾‘å°±æ˜¯ç»­çº¦é€»è¾‘ï¼Œæ³¨æ„çœ‹commandExecutor.getConnectionManager().newTimeoutï¼ˆï¼‰ æ­¤æ–¹æ³•</p><p>Method(  <strong>new</strong> TimerTask() {},å‚æ•°2 ï¼Œå‚æ•°3  )</p><p>æŒ‡çš„æ˜¯ï¼šé€šè¿‡å‚æ•°2ï¼Œå‚æ•°3 å»æè¿°ä»€ä¹ˆæ—¶å€™å»åšå‚æ•°1çš„äº‹æƒ…ï¼Œç°åœ¨çš„æƒ…å†µæ˜¯ï¼š10sä¹‹åå»åšå‚æ•°ä¸€çš„äº‹æƒ…</p><p>å› ä¸ºé”çš„å¤±æ•ˆæ—¶é—´æ˜¯30sï¼Œå½“10sä¹‹åï¼Œæ­¤æ—¶è¿™ä¸ªtimeTask å°±è§¦å‘äº†ï¼Œä»–å°±å»è¿›è¡Œç»­çº¦ï¼ŒæŠŠå½“å‰è¿™æŠŠé”ç»­çº¦æˆ30sï¼Œå¦‚æœæ“ä½œæˆåŠŸï¼Œé‚£ä¹ˆæ­¤æ—¶å°±ä¼šé€’å½’è°ƒç”¨è‡ªå·±ï¼Œå†é‡æ–°è®¾ç½®ä¸€ä¸ªtimeTask()ï¼Œäºæ˜¯å†è¿‡10sååˆå†è®¾ç½®ä¸€ä¸ªtimerTaskï¼Œå®Œæˆä¸åœçš„ç»­çº¦</p><p>é‚£ä¹ˆå¤§å®¶å¯ä»¥æƒ³ä¸€æƒ³ï¼Œå‡è®¾æˆ‘ä»¬çš„çº¿ç¨‹å‡ºç°äº†å®•æœºä»–è¿˜ä¼šç»­çº¦å—ï¼Ÿå½“ç„¶ä¸ä¼šï¼Œå› ä¸ºæ²¡æœ‰äººå†å»è°ƒç”¨renewExpirationè¿™ä¸ªæ–¹æ³•ï¼Œæ‰€ä»¥ç­‰åˆ°æ—¶é—´ä¹‹åè‡ªç„¶å°±é‡Šæ”¾äº†ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">renewExpiration</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">ExpirationEntry</span> <span class="variable">ee</span> <span class="operator">=</span> EXPIRATION_RENEWAL_MAP.get(getEntryName());</span><br><span class="line">    <span class="keyword">if</span> (ee == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="type">Timeout</span> <span class="variable">task</span> <span class="operator">=</span> commandExecutor.getConnectionManager().newTimeout(<span class="keyword">new</span> <span class="title class_">TimerTask</span>() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">(Timeout timeout)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">            <span class="type">ExpirationEntry</span> <span class="variable">ent</span> <span class="operator">=</span> EXPIRATION_RENEWAL_MAP.get(getEntryName());</span><br><span class="line">            <span class="keyword">if</span> (ent == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">Long</span> <span class="variable">threadId</span> <span class="operator">=</span> ent.getFirstThreadId();</span><br><span class="line">            <span class="keyword">if</span> (threadId == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            RFuture&lt;Boolean&gt; future = renewExpirationAsync(threadId);</span><br><span class="line">            future.onComplete((res, e) -&gt; &#123;</span><br><span class="line">                <span class="keyword">if</span> (e != <span class="literal">null</span>) &#123;</span><br><span class="line">                    log.error(<span class="string">&quot;Can&#x27;t update lock &quot;</span> + getName() + <span class="string">&quot; expiration&quot;</span>, e);</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">if</span> (res) &#123;</span><br><span class="line">                    <span class="comment">// reschedule itself</span></span><br><span class="line">                    renewExpiration();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, internalLockLeaseTime / <span class="number">3</span>, TimeUnit.MILLISECONDS);</span><br><span class="line">    </span><br><span class="line">    ee.setTimeout(task);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5-5-åˆ†å¸ƒå¼é”-redissioné”çš„MutiLockåŸç†">5.5 åˆ†å¸ƒå¼é”-redissioné”çš„MutiLockåŸç†</h3><p>ä¸ºäº†æé«˜redisçš„å¯ç”¨æ€§ï¼Œæˆ‘ä»¬ä¼šæ­å»ºé›†ç¾¤æˆ–è€…ä¸»ä»ï¼Œç°åœ¨ä»¥ä¸»ä»ä¸ºä¾‹</p><p>æ­¤æ—¶æˆ‘ä»¬å»å†™å‘½ä»¤ï¼Œå†™åœ¨ä¸»æœºä¸Šï¼Œ ä¸»æœºä¼šå°†æ•°æ®åŒæ­¥ç»™ä»æœºï¼Œä½†æ˜¯å‡è®¾åœ¨ä¸»æœºè¿˜æ²¡æœ‰æ¥å¾—åŠæŠŠæ•°æ®å†™å…¥åˆ°ä»æœºå»çš„æ—¶å€™ï¼Œæ­¤æ—¶ä¸»æœºå®•æœºï¼Œå“¨å…µä¼šå‘ç°ä¸»æœºå®•æœºï¼Œå¹¶ä¸”é€‰ä¸¾ä¸€ä¸ªslaveå˜æˆmasterï¼Œè€Œæ­¤æ—¶æ–°çš„masterä¸­å®é™…ä¸Šå¹¶æ²¡æœ‰é”ä¿¡æ¯ï¼Œæ­¤æ—¶é”ä¿¡æ¯å°±å·²ç»ä¸¢æ‰äº†ã€‚</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/1653553998403.png" alt="1653553998403"></p><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œredissionæå‡ºæ¥äº†MutiLocké”ï¼Œä½¿ç”¨è¿™æŠŠé”å’±ä»¬å°±ä¸ä½¿ç”¨ä¸»ä»äº†ï¼Œæ¯ä¸ªèŠ‚ç‚¹çš„åœ°ä½éƒ½æ˜¯ä¸€æ ·çš„ï¼Œ è¿™æŠŠé”åŠ é”çš„é€»è¾‘éœ€è¦å†™å…¥åˆ°æ¯ä¸€ä¸ªä¸»ä¸›èŠ‚ç‚¹ä¸Šï¼Œåªæœ‰æ‰€æœ‰çš„æœåŠ¡å™¨éƒ½å†™å…¥æˆåŠŸï¼Œæ­¤æ—¶æ‰æ˜¯åŠ é”æˆåŠŸï¼Œå‡è®¾ç°åœ¨æŸä¸ªèŠ‚ç‚¹æŒ‚äº†ï¼Œé‚£ä¹ˆä»–å»è·å¾—é”çš„æ—¶å€™ï¼Œåªè¦æœ‰ä¸€ä¸ªèŠ‚ç‚¹æ‹¿ä¸åˆ°ï¼Œéƒ½ä¸èƒ½ç®—æ˜¯åŠ é”æˆåŠŸï¼Œå°±ä¿è¯äº†åŠ é”çš„å¯é æ€§ã€‚</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/1653554055048.png" alt="1653554055048"></p><p>é‚£ä¹ˆMutiLock åŠ é”åŸç†æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿç¬”è€…ç”»äº†ä¸€å¹…å›¾æ¥è¯´æ˜</p><p>å½“æˆ‘ä»¬å»è®¾ç½®äº†å¤šä¸ªé”æ—¶ï¼Œredissionä¼šå°†å¤šä¸ªé”æ·»åŠ åˆ°ä¸€ä¸ªé›†åˆä¸­ï¼Œç„¶åç”¨whileå¾ªç¯å»ä¸åœå»å°è¯•æ‹¿é”ï¼Œä½†æ˜¯ä¼šæœ‰ä¸€ä¸ªæ€»å…±çš„åŠ é”æ—¶é—´ï¼Œè¿™ä¸ªæ—¶é—´æ˜¯ç”¨éœ€è¦åŠ é”çš„ä¸ªæ•° * 1500ms ï¼Œå‡è®¾æœ‰3ä¸ªé”ï¼Œé‚£ä¹ˆæ—¶é—´å°±æ˜¯4500msï¼Œå‡è®¾åœ¨è¿™4500mså†…ï¼Œæ‰€æœ‰çš„é”éƒ½åŠ é”æˆåŠŸï¼Œ é‚£ä¹ˆæ­¤æ—¶æ‰ç®—æ˜¯åŠ é”æˆåŠŸï¼Œå¦‚æœåœ¨4500msæœ‰çº¿ç¨‹åŠ é”å¤±è´¥ï¼Œåˆ™ä¼šå†æ¬¡å»è¿›è¡Œé‡è¯•.</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/1653553093967.png" alt="1653553093967"></p><h2 id="6ã€ç§’æ€ä¼˜åŒ–"><strong>6ã€ç§’æ€ä¼˜åŒ–</strong></h2><h3 id="6-1-ç§’æ€ä¼˜åŒ–-å¼‚æ­¥ç§’æ€æ€è·¯">6.1 ç§’æ€ä¼˜åŒ–-å¼‚æ­¥ç§’æ€æ€è·¯</h3><p>æˆ‘ä»¬æ¥å›é¡¾ä¸€ä¸‹ä¸‹å•æµç¨‹</p><p>å½“ç”¨æˆ·å‘èµ·è¯·æ±‚ï¼Œæ­¤æ—¶ä¼šè¯·æ±‚nginxï¼Œnginxä¼šè®¿é—®åˆ°tomcatï¼Œè€Œtomcatä¸­çš„ç¨‹åºï¼Œä¼šè¿›è¡Œä¸²è¡Œæ“ä½œï¼Œåˆ†æˆå¦‚ä¸‹å‡ ä¸ªæ­¥éª¤</p><p>1ã€æŸ¥è¯¢ä¼˜æƒ å·</p><p>2ã€åˆ¤æ–­ç§’æ€åº“å­˜æ˜¯å¦è¶³å¤Ÿ</p><p>3ã€æŸ¥è¯¢è®¢å•</p><p>4ã€æ ¡éªŒæ˜¯å¦æ˜¯ä¸€äººä¸€å•</p><p>5ã€æ‰£å‡åº“å­˜</p><p>6ã€åˆ›å»ºè®¢å•</p><p>åœ¨è¿™å…­æ­¥æ“ä½œä¸­ï¼Œåˆæœ‰å¾ˆå¤šæ“ä½œæ˜¯è¦å»æ“ä½œæ•°æ®åº“çš„ï¼Œè€Œä¸”è¿˜æ˜¯ä¸€ä¸ªçº¿ç¨‹ä¸²è¡Œæ‰§è¡Œï¼Œ è¿™æ ·å°±ä¼šå¯¼è‡´æˆ‘ä»¬çš„ç¨‹åºæ‰§è¡Œçš„å¾ˆæ…¢ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å¼‚æ­¥ç¨‹åºæ‰§è¡Œï¼Œé‚£ä¹ˆå¦‚ä½•åŠ é€Ÿå‘¢ï¼Ÿ</p><p>åœ¨è¿™é‡Œç¬”è€…æƒ³ç»™å¤§å®¶åˆ†äº«ä¸€ä¸‹è¯¾ç¨‹å†…æ²¡æœ‰çš„æ€è·¯ï¼Œçœ‹çœ‹æœ‰æ²¡æœ‰å°ä¼™ä¼´è¿™ä¹ˆæƒ³ï¼Œæ¯”å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ä¸å¯ä»¥ä½¿ç”¨å¼‚æ­¥ç¼–æ’æ¥åšï¼Œæˆ–è€…è¯´æˆ‘å¼€å¯Nå¤šçº¿ç¨‹ï¼ŒNå¤šä¸ªçº¿ç¨‹ï¼Œä¸€ä¸ªçº¿ç¨‹æ‰§è¡ŒæŸ¥è¯¢ä¼˜æƒ å·ï¼Œä¸€ä¸ªæ‰§è¡Œåˆ¤æ–­æ‰£å‡åº“å­˜ï¼Œä¸€ä¸ªå»åˆ›å»ºè®¢å•ç­‰ç­‰ï¼Œç„¶åå†ç»Ÿä¸€åšè¿”å›ï¼Œè¿™ç§åšæ³•å’Œè¯¾ç¨‹ä¸­æœ‰å“ªç§å¥½å‘¢ï¼Ÿç­”æ¡ˆæ˜¯è¯¾ç¨‹ä¸­çš„å¥½ï¼Œå› ä¸ºå¦‚æœä½ é‡‡ç”¨æˆ‘åˆšè¯´çš„æ–¹å¼ï¼Œå¦‚æœè®¿é—®çš„äººå¾ˆå¤šï¼Œé‚£ä¹ˆçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹å¯èƒ½ä¸€ä¸‹å­å°±è¢«æ¶ˆè€—å®Œäº†ï¼Œè€Œä¸”ä½ ä½¿ç”¨ä¸Šè¿°æ–¹æ¡ˆï¼Œæœ€å¤§çš„ç‰¹ç‚¹åœ¨äºï¼Œä½ è§‰å¾—æ—¶æ•ˆæ€§ä¼šéå¸¸é‡è¦ï¼Œä½†æ˜¯ä½ æƒ³æƒ³æ˜¯å—ï¼Ÿå¹¶ä¸æ˜¯ï¼Œæ¯”å¦‚æˆ‘åªè¦ç¡®å®šä»–èƒ½åšè¿™ä»¶äº‹ï¼Œç„¶åæˆ‘åè¾¹æ…¢æ…¢åšå°±å¯ä»¥äº†ï¼Œæˆ‘å¹¶ä¸éœ€è¦ä»–ä¸€å£æ°”åšå®Œè¿™ä»¶äº‹ï¼Œæ‰€ä»¥æˆ‘ä»¬åº”å½“é‡‡ç”¨çš„æ˜¯è¯¾ç¨‹ä¸­ï¼Œç±»ä¼¼æ¶ˆæ¯é˜Ÿåˆ—çš„æ–¹å¼æ¥å®Œæˆæˆ‘ä»¬çš„éœ€æ±‚ï¼Œè€Œä¸æ˜¯ä½¿ç”¨çº¿ç¨‹æ± æˆ–è€…æ˜¯å¼‚æ­¥ç¼–æ’çš„æ–¹å¼æ¥å®Œæˆè¿™ä¸ªéœ€æ±‚</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/1653560986599.png" alt="1653560986599"></p><p>ä¼˜åŒ–æ–¹æ¡ˆï¼šæˆ‘ä»¬å°†è€—æ—¶æ¯”è¾ƒçŸ­çš„é€»è¾‘åˆ¤æ–­æ”¾å…¥åˆ°redisä¸­ï¼Œæ¯”å¦‚æ˜¯å¦åº“å­˜è¶³å¤Ÿï¼Œæ¯”å¦‚æ˜¯å¦ä¸€äººä¸€å•ï¼Œè¿™æ ·çš„æ“ä½œï¼Œåªè¦è¿™ç§é€»è¾‘å¯ä»¥å®Œæˆï¼Œå°±æ„å‘³ç€æˆ‘ä»¬æ˜¯ä¸€å®šå¯ä»¥ä¸‹å•å®Œæˆçš„ï¼Œæˆ‘ä»¬åªéœ€è¦è¿›è¡Œå¿«é€Ÿçš„é€»è¾‘åˆ¤æ–­ï¼Œæ ¹æœ¬å°±ä¸ç”¨ç­‰ä¸‹å•é€»è¾‘èµ°å®Œï¼Œæˆ‘ä»¬ç›´æ¥ç»™ç”¨æˆ·è¿”å›æˆåŠŸï¼Œ å†åœ¨åå°å¼€ä¸€ä¸ªçº¿ç¨‹ï¼Œåå°çº¿ç¨‹æ…¢æ…¢çš„å»æ‰§è¡Œqueueé‡Œè¾¹çš„æ¶ˆæ¯ï¼Œè¿™æ ·ç¨‹åºä¸å°±è¶…çº§å¿«äº†å—ï¼Ÿè€Œä¸”ä¹Ÿä¸ç”¨æ‹…å¿ƒçº¿ç¨‹æ± æ¶ˆè€—æ®†å°½çš„é—®é¢˜ï¼Œå› ä¸ºè¿™é‡Œæˆ‘ä»¬çš„ç¨‹åºä¸­å¹¶æ²¡æœ‰æ‰‹åŠ¨ä½¿ç”¨ä»»ä½•çº¿ç¨‹æ± ï¼Œå½“ç„¶è¿™é‡Œè¾¹æœ‰ä¸¤ä¸ªéš¾ç‚¹</p><p>ç¬¬ä¸€ä¸ªéš¾ç‚¹æ˜¯æˆ‘ä»¬æ€ä¹ˆåœ¨redisä¸­å»å¿«é€Ÿæ ¡éªŒä¸€äººä¸€å•ï¼Œè¿˜æœ‰åº“å­˜åˆ¤æ–­</p><p>ç¬¬äºŒä¸ªéš¾ç‚¹æ˜¯ç”±äºæˆ‘ä»¬æ ¡éªŒå’Œtomctä¸‹å•æ˜¯ä¸¤ä¸ªçº¿ç¨‹ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•çŸ¥é“åˆ°åº•å“ªä¸ªå•ä»–æœ€åæ˜¯å¦æˆåŠŸï¼Œæˆ–è€…æ˜¯ä¸‹å•å®Œæˆï¼Œä¸ºäº†å®Œæˆè¿™ä»¶äº‹æˆ‘ä»¬åœ¨redisæ“ä½œå®Œä¹‹åï¼Œæˆ‘ä»¬ä¼šå°†ä¸€äº›ä¿¡æ¯è¿”å›ç»™å‰ç«¯ï¼ŒåŒæ—¶ä¹Ÿä¼šæŠŠè¿™äº›ä¿¡æ¯ä¸¢åˆ°å¼‚æ­¥queueä¸­å»ï¼Œåç»­æ“ä½œä¸­ï¼Œå¯ä»¥é€šè¿‡è¿™ä¸ªidæ¥æŸ¥è¯¢æˆ‘ä»¬tomcatä¸­çš„ä¸‹å•é€»è¾‘æ˜¯å¦å®Œæˆäº†ã€‚</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/1653561657295.png" alt="1653561657295"></p><p>æˆ‘ä»¬ç°åœ¨æ¥çœ‹çœ‹æ•´ä½“æ€è·¯ï¼šå½“ç”¨æˆ·ä¸‹å•ä¹‹åï¼Œåˆ¤æ–­åº“å­˜æ˜¯å¦å……è¶³åªéœ€è¦å¯¼redisä¸­å»æ ¹æ®keyæ‰¾å¯¹åº”çš„valueæ˜¯å¦å¤§äº0å³å¯ï¼Œå¦‚æœä¸å……è¶³ï¼Œåˆ™ç›´æ¥ç»“æŸï¼Œå¦‚æœå……è¶³ï¼Œç»§ç»­åœ¨redisä¸­åˆ¤æ–­ç”¨æˆ·æ˜¯å¦å¯ä»¥ä¸‹å•ï¼Œå¦‚æœseté›†åˆä¸­æ²¡æœ‰è¿™æ¡æ•°æ®ï¼Œè¯´æ˜ä»–å¯ä»¥ä¸‹å•ï¼Œå¦‚æœseté›†åˆä¸­æ²¡æœ‰è¿™æ¡è®°å½•ï¼Œåˆ™å°†userIdå’Œä¼˜æƒ å·å­˜å…¥åˆ°redisä¸­ï¼Œå¹¶ä¸”è¿”å›0ï¼Œæ•´ä¸ªè¿‡ç¨‹éœ€è¦ä¿è¯æ˜¯åŸå­æ€§çš„ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨luaæ¥æ“ä½œ</p><p>å½“ä»¥ä¸Šåˆ¤æ–­é€»è¾‘èµ°å®Œä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥åˆ¤æ–­å½“å‰redisä¸­è¿”å›çš„ç»“æœæ˜¯å¦æ˜¯0 ï¼Œå¦‚æœæ˜¯0ï¼Œåˆ™è¡¨ç¤ºå¯ä»¥ä¸‹å•ï¼Œåˆ™å°†ä¹‹å‰è¯´çš„ä¿¡æ¯å­˜å…¥åˆ°åˆ°queueä¸­å»ï¼Œç„¶åè¿”å›ï¼Œç„¶åå†æ¥ä¸ªçº¿ç¨‹å¼‚æ­¥çš„ä¸‹å•ï¼Œå‰ç«¯å¯ä»¥é€šè¿‡è¿”å›çš„è®¢å•idæ¥åˆ¤æ–­æ˜¯å¦ä¸‹å•æˆåŠŸã€‚</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/1653562234886.png" alt="1653562234886"></p><h3 id="6-2-ç§’æ€ä¼˜åŒ–-Rediså®Œæˆç§’æ€èµ„æ ¼åˆ¤æ–­">6.2 ç§’æ€ä¼˜åŒ–-Rediså®Œæˆç§’æ€èµ„æ ¼åˆ¤æ–­</h3><p>éœ€æ±‚ï¼š</p><ul><li><p>æ–°å¢ç§’æ€ä¼˜æƒ åˆ¸çš„åŒæ—¶ï¼Œå°†ä¼˜æƒ åˆ¸ä¿¡æ¯ä¿å­˜åˆ°Redisä¸­</p></li><li><p>åŸºäºLuaè„šæœ¬ï¼Œåˆ¤æ–­ç§’æ€åº“å­˜ã€ä¸€äººä¸€å•ï¼Œå†³å®šç”¨æˆ·æ˜¯å¦æŠ¢è´­æˆåŠŸ</p></li><li><p>å¦‚æœæŠ¢è´­æˆåŠŸï¼Œå°†ä¼˜æƒ åˆ¸idå’Œç”¨æˆ·idå°è£…åå­˜å…¥é˜»å¡é˜Ÿåˆ—</p></li><li><p>å¼€å¯çº¿ç¨‹ä»»åŠ¡ï¼Œä¸æ–­ä»é˜»å¡é˜Ÿåˆ—ä¸­è·å–ä¿¡æ¯ï¼Œå®ç°å¼‚æ­¥ä¸‹å•åŠŸèƒ½</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/1656080546603.png" alt="1656080546603"></p></li></ul><p>VoucherServiceImpl</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addSeckillVoucher</span><span class="params">(Voucher voucher)</span> &#123;</span><br><span class="line">    <span class="comment">// ä¿å­˜ä¼˜æƒ åˆ¸</span></span><br><span class="line">    save(voucher);</span><br><span class="line">    <span class="comment">// ä¿å­˜ç§’æ€ä¿¡æ¯</span></span><br><span class="line">    <span class="type">SeckillVoucher</span> <span class="variable">seckillVoucher</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SeckillVoucher</span>();</span><br><span class="line">    seckillVoucher.setVoucherId(voucher.getId());</span><br><span class="line">    seckillVoucher.setStock(voucher.getStock());</span><br><span class="line">    seckillVoucher.setBeginTime(voucher.getBeginTime());</span><br><span class="line">    seckillVoucher.setEndTime(voucher.getEndTime());</span><br><span class="line">    seckillVoucherService.save(seckillVoucher);</span><br><span class="line">    <span class="comment">// ä¿å­˜ç§’æ€åº“å­˜åˆ°Redisä¸­</span></span><br><span class="line">    <span class="comment">//SECKILL_STOCK_KEY è¿™ä¸ªå˜é‡å®šä¹‰åœ¨RedisConstansä¸­</span></span><br><span class="line">    <span class="comment">//private static final String SECKILL_STOCK_KEY =&quot;seckill:stock:&quot;</span></span><br><span class="line">    stringRedisTemplate.opsForValue().set(SECKILL_STOCK_KEY + voucher.getId(), voucher.getStock().toString());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®Œæ•´luaè¡¨è¾¾å¼</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 1.å‚æ•°åˆ—è¡¨</span></span><br><span class="line"><span class="comment">-- 1.1.ä¼˜æƒ åˆ¸id</span></span><br><span class="line"><span class="keyword">local</span> voucherId = ARGV[<span class="number">1</span>]</span><br><span class="line"><span class="comment">-- 1.2.ç”¨æˆ·id</span></span><br><span class="line"><span class="keyword">local</span> userId = ARGV[<span class="number">2</span>]</span><br><span class="line"><span class="comment">-- 1.3.è®¢å•id</span></span><br><span class="line"><span class="keyword">local</span> orderId = ARGV[<span class="number">3</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 2.æ•°æ®key</span></span><br><span class="line"><span class="comment">-- 2.1.åº“å­˜key</span></span><br><span class="line"><span class="keyword">local</span> stockKey = <span class="string">&#x27;seckill:stock:&#x27;</span> .. voucherId</span><br><span class="line"><span class="comment">-- 2.2.è®¢å•key</span></span><br><span class="line"><span class="keyword">local</span> orderKey = <span class="string">&#x27;seckill:order:&#x27;</span> .. voucherId</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 3.è„šæœ¬ä¸šåŠ¡</span></span><br><span class="line"><span class="comment">-- 3.1.åˆ¤æ–­åº“å­˜æ˜¯å¦å……è¶³ get stockKey</span></span><br><span class="line"><span class="keyword">if</span>(<span class="built_in">tonumber</span>(redis.call(<span class="string">&#x27;get&#x27;</span>, stockKey)) &lt;= <span class="number">0</span>) <span class="keyword">then</span></span><br><span class="line">    <span class="comment">-- 3.2.åº“å­˜ä¸è¶³ï¼Œè¿”å›1</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="comment">-- 3.2.åˆ¤æ–­ç”¨æˆ·æ˜¯å¦ä¸‹å• SISMEMBER orderKey userId</span></span><br><span class="line"><span class="keyword">if</span>(redis.call(<span class="string">&#x27;sismember&#x27;</span>, orderKey, userId) == <span class="number">1</span>) <span class="keyword">then</span></span><br><span class="line">    <span class="comment">-- 3.3.å­˜åœ¨ï¼Œè¯´æ˜æ˜¯é‡å¤ä¸‹å•ï¼Œè¿”å›2</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">2</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="comment">-- 3.4.æ‰£åº“å­˜ incrby stockKey -1</span></span><br><span class="line">redis.call(<span class="string">&#x27;incrby&#x27;</span>, stockKey, <span class="number">-1</span>)</span><br><span class="line"><span class="comment">-- 3.5.ä¸‹å•ï¼ˆä¿å­˜ç”¨æˆ·ï¼‰sadd orderKey userId åˆ›å»ºseckill:order:</span></span><br><span class="line">redis.call(<span class="string">&#x27;sadd&#x27;</span>, orderKey, userId)</span><br><span class="line"><span class="comment">-- 3.6.å‘é€æ¶ˆæ¯åˆ°é˜Ÿåˆ—ä¸­ï¼Œ XADD stream.orders * k1 v1 k2 v2 ...</span></span><br><span class="line">redis.call(<span class="string">&#x27;xadd&#x27;</span>, <span class="string">&#x27;stream.orders&#x27;</span>, <span class="string">&#x27;*&#x27;</span>, <span class="string">&#x27;userId&#x27;</span>, userId, <span class="string">&#x27;voucherId&#x27;</span>, voucherId, <span class="string">&#x27;id&#x27;</span>, orderId)</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span></span><br></pre></td></tr></table></figure><p>å½“ä»¥ä¸Šluaè¡¨è¾¾å¼æ‰§è¡Œå®Œæ¯•åï¼Œå‰©ä¸‹çš„å°±æ˜¯æ ¹æ®æ­¥éª¤3,4æ¥æ‰§è¡Œæˆ‘ä»¬æ¥ä¸‹æ¥çš„ä»»åŠ¡äº†</p><p>VoucherOrderServiceImpl</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">seckillVoucher</span><span class="params">(Long voucherId)</span> &#123;</span><br><span class="line">    <span class="comment">//è·å–ç”¨æˆ·</span></span><br><span class="line">    <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> UserHolder.getUser().getId();</span><br><span class="line">    <span class="type">long</span> <span class="variable">orderId</span> <span class="operator">=</span> redisIdWorker.nextId(<span class="string">&quot;order&quot;</span>);</span><br><span class="line">    <span class="comment">// 1.æ‰§è¡Œluaè„šæœ¬</span></span><br><span class="line">    <span class="type">Long</span> <span class="variable">result</span> <span class="operator">=</span> stringRedisTemplate.execute(</span><br><span class="line">            SECKILL_SCRIPT,</span><br><span class="line">            Collections.emptyList(),</span><br><span class="line">            voucherId.toString(), userId.toString(), String.valueOf(orderId)</span><br><span class="line">    );</span><br><span class="line">    <span class="type">int</span> <span class="variable">r</span> <span class="operator">=</span> result.intValue();</span><br><span class="line">    <span class="comment">// 2.åˆ¤æ–­ç»“æœæ˜¯å¦ä¸º0</span></span><br><span class="line">    <span class="keyword">if</span> (r != <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// 2.1.ä¸ä¸º0 ï¼Œä»£è¡¨æ²¡æœ‰è´­ä¹°èµ„æ ¼</span></span><br><span class="line">        <span class="keyword">return</span> Result.fail(r == <span class="number">1</span> ? <span class="string">&quot;åº“å­˜ä¸è¶³&quot;</span> : <span class="string">&quot;ä¸èƒ½é‡å¤ä¸‹å•&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//TODO ä¿å­˜é˜»å¡é˜Ÿåˆ—</span></span><br><span class="line">    <span class="comment">// 3.è¿”å›è®¢å•id</span></span><br><span class="line">    <span class="keyword">return</span> Result.ok(orderId);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="6-3-ç§’æ€ä¼˜åŒ–-åŸºäºé˜»å¡é˜Ÿåˆ—å®ç°ç§’æ€ä¼˜åŒ–">6.3 ç§’æ€ä¼˜åŒ–-åŸºäºé˜»å¡é˜Ÿåˆ—å®ç°ç§’æ€ä¼˜åŒ–</h3><p>VoucherOrderServiceImpl</p><p>ä¿®æ”¹ä¸‹å•åŠ¨ä½œï¼Œç°åœ¨æˆ‘ä»¬å»ä¸‹å•æ—¶ï¼Œæ˜¯é€šè¿‡luaè¡¨è¾¾å¼å»åŸå­æ‰§è¡Œåˆ¤æ–­é€»è¾‘ï¼Œå¦‚æœåˆ¤æ–­æˆ‘å‡ºæ¥ä¸ä¸º0 ï¼Œåˆ™è¦ä¹ˆæ˜¯åº“å­˜ä¸è¶³ï¼Œè¦ä¹ˆæ˜¯é‡å¤ä¸‹å•ï¼Œè¿”å›é”™è¯¯ä¿¡æ¯ï¼Œå¦‚æœæ˜¯0ï¼Œåˆ™æŠŠä¸‹å•çš„é€»è¾‘ä¿å­˜åˆ°é˜Ÿåˆ—ä¸­å»ï¼Œç„¶åå¼‚æ­¥æ‰§è¡Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å¼‚æ­¥å¤„ç†çº¿ç¨‹æ± </span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">ExecutorService</span> <span class="variable">SECKILL_ORDER_EXECUTOR</span> <span class="operator">=</span> Executors.newSingleThreadExecutor();</span><br><span class="line"></span><br><span class="line"><span class="comment">//åœ¨ç±»åˆå§‹åŒ–ä¹‹åæ‰§è¡Œï¼Œå› ä¸ºå½“è¿™ä¸ªç±»åˆå§‹åŒ–å¥½äº†ä¹‹åï¼Œéšæ—¶éƒ½æ˜¯æœ‰å¯èƒ½è¦æ‰§è¡Œçš„</span></span><br><span class="line"><span class="meta">@PostConstruct</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> &#123;</span><br><span class="line">   SECKILL_ORDER_EXECUTOR.submit(<span class="keyword">new</span> <span class="title class_">VoucherOrderHandler</span>());</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ç”¨äºçº¿ç¨‹æ± å¤„ç†çš„ä»»åŠ¡</span></span><br><span class="line"><span class="comment">// å½“åˆå§‹åŒ–å®Œæ¯•åï¼Œå°±ä¼šå»ä»å¯¹åˆ—ä¸­å»æ‹¿ä¿¡æ¯</span></span><br><span class="line"> <span class="keyword">private</span> <span class="keyword">class</span> <span class="title class_">VoucherOrderHandler</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">while</span> (<span class="literal">true</span>)&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="comment">// 1.è·å–é˜Ÿåˆ—ä¸­çš„è®¢å•ä¿¡æ¯</span></span><br><span class="line">                    <span class="type">VoucherOrder</span> <span class="variable">voucherOrder</span> <span class="operator">=</span> orderTasks.take();</span><br><span class="line">                    <span class="comment">// 2.åˆ›å»ºè®¢å•</span></span><br><span class="line">                    handleVoucherOrder(voucherOrder);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                    log.error(<span class="string">&quot;å¤„ç†è®¢å•å¼‚å¸¸&quot;</span>, e);</span><br><span class="line">                &#125;</span><br><span class="line">           &#125;</span><br><span class="line">        &#125;</span><br><span class="line">     </span><br><span class="line">       <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">handleVoucherOrder</span><span class="params">(VoucherOrder voucherOrder)</span> &#123;</span><br><span class="line">            <span class="comment">//1.è·å–ç”¨æˆ·</span></span><br><span class="line">            <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> voucherOrder.getUserId();</span><br><span class="line">            <span class="comment">// 2.åˆ›å»ºé”å¯¹è±¡</span></span><br><span class="line">            <span class="type">RLock</span> <span class="variable">redisLock</span> <span class="operator">=</span> redissonClient.getLock(<span class="string">&quot;lock:order:&quot;</span> + userId);</span><br><span class="line">            <span class="comment">// 3.å°è¯•è·å–é”</span></span><br><span class="line">            <span class="type">boolean</span> <span class="variable">isLock</span> <span class="operator">=</span> redisLock.lock();</span><br><span class="line">            <span class="comment">// 4.åˆ¤æ–­æ˜¯å¦è·å¾—é”æˆåŠŸ</span></span><br><span class="line">            <span class="keyword">if</span> (!isLock) &#123;</span><br><span class="line">                <span class="comment">// è·å–é”å¤±è´¥ï¼Œç›´æ¥è¿”å›å¤±è´¥æˆ–è€…é‡è¯•</span></span><br><span class="line">                log.error(<span class="string">&quot;ä¸å…è®¸é‡å¤ä¸‹å•ï¼&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line"><span class="comment">//æ³¨æ„ï¼šç”±äºæ˜¯springçš„äº‹åŠ¡æ˜¯æ”¾åœ¨threadLocalä¸­ï¼Œæ­¤æ—¶çš„æ˜¯å¤šçº¿ç¨‹ï¼Œäº‹åŠ¡ä¼šå¤±æ•ˆ</span></span><br><span class="line">                proxy.createVoucherOrder(voucherOrder);</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                <span class="comment">// é‡Šæ”¾é”</span></span><br><span class="line">                redisLock.unlock();</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">private</span> BlockingQueue&lt;VoucherOrder&gt; orderTasks =<span class="keyword">new</span>  <span class="title class_">ArrayBlockingQueue</span>&lt;&gt;(<span class="number">1024</span> * <span class="number">1024</span>);</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">seckillVoucher</span><span class="params">(Long voucherId)</span> &#123;</span><br><span class="line">        <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> UserHolder.getUser().getId();</span><br><span class="line">        <span class="type">long</span> <span class="variable">orderId</span> <span class="operator">=</span> redisIdWorker.nextId(<span class="string">&quot;order&quot;</span>);</span><br><span class="line">        <span class="comment">// 1.æ‰§è¡Œluaè„šæœ¬</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">result</span> <span class="operator">=</span> stringRedisTemplate.execute(</span><br><span class="line">                SECKILL_SCRIPT,</span><br><span class="line">                Collections.emptyList(),</span><br><span class="line">                voucherId.toString(), userId.toString(), String.valueOf(orderId)</span><br><span class="line">        );</span><br><span class="line">        <span class="type">int</span> <span class="variable">r</span> <span class="operator">=</span> result.intValue();</span><br><span class="line">        <span class="comment">// 2.åˆ¤æ–­ç»“æœæ˜¯å¦ä¸º0</span></span><br><span class="line">        <span class="keyword">if</span> (r != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// 2.1.ä¸ä¸º0 ï¼Œä»£è¡¨æ²¡æœ‰è´­ä¹°èµ„æ ¼</span></span><br><span class="line">            <span class="keyword">return</span> Result.fail(r == <span class="number">1</span> ? <span class="string">&quot;åº“å­˜ä¸è¶³&quot;</span> : <span class="string">&quot;ä¸èƒ½é‡å¤ä¸‹å•&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">VoucherOrder</span> <span class="variable">voucherOrder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">VoucherOrder</span>();</span><br><span class="line">        voucherOrder.setId(orderId);</span><br><span class="line">        <span class="comment">// 2.4.ç”¨æˆ·id</span></span><br><span class="line">        voucherOrder.setUserId(userId);</span><br><span class="line">        <span class="comment">// 2.5.ä»£é‡‘åˆ¸id</span></span><br><span class="line">        voucherOrder.setVoucherId(voucherId);</span><br><span class="line">        <span class="comment">// 2.6.æ”¾å…¥é˜»å¡é˜Ÿåˆ—</span></span><br><span class="line">        orderTasks.add(voucherOrder);</span><br><span class="line">        <span class="comment">//3.è·å–ä»£ç†å¯¹è±¡</span></span><br><span class="line">         proxy = (IVoucherOrderService)AopContext.currentProxy();</span><br><span class="line">        <span class="comment">//4.è¿”å›è®¢å•id</span></span><br><span class="line">        <span class="keyword">return</span> Result.ok(orderId);</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">      <span class="meta">@Transactional</span></span><br><span class="line">    <span class="keyword">public</span>  <span class="keyword">void</span> <span class="title function_">createVoucherOrder</span><span class="params">(VoucherOrder voucherOrder)</span> &#123;</span><br><span class="line">        <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> voucherOrder.getUserId();</span><br><span class="line">        <span class="comment">// 5.1.æŸ¥è¯¢è®¢å•</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> query().eq(<span class="string">&quot;user_id&quot;</span>, userId).eq(<span class="string">&quot;voucher_id&quot;</span>, voucherOrder.getVoucherId()).count();</span><br><span class="line">        <span class="comment">// 5.2.åˆ¤æ–­æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">        <span class="keyword">if</span> (count &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// ç”¨æˆ·å·²ç»è´­ä¹°è¿‡äº†</span></span><br><span class="line">           log.error(<span class="string">&quot;ç”¨æˆ·å·²ç»è´­ä¹°è¿‡äº†&quot;</span>);</span><br><span class="line">           <span class="keyword">return</span> ;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 6.æ‰£å‡åº“å­˜</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">success</span> <span class="operator">=</span> seckillVoucherService.update()</span><br><span class="line">                .setSql(<span class="string">&quot;stock = stock - 1&quot;</span>) <span class="comment">// set stock = stock - 1</span></span><br><span class="line">                .eq(<span class="string">&quot;voucher_id&quot;</span>, voucherOrder.getVoucherId()).gt(<span class="string">&quot;stock&quot;</span>, <span class="number">0</span>) <span class="comment">// where id = ? and stock &gt; 0</span></span><br><span class="line">                .update();</span><br><span class="line">        <span class="keyword">if</span> (!success) &#123;</span><br><span class="line">            <span class="comment">// æ‰£å‡å¤±è´¥</span></span><br><span class="line">            log.error(<span class="string">&quot;åº“å­˜ä¸è¶³&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">        save(voucherOrder);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p><strong>å°æ€»ç»“ï¼š</strong></p><p>ç§’æ€ä¸šåŠ¡çš„ä¼˜åŒ–æ€è·¯æ˜¯ä»€ä¹ˆï¼Ÿ</p><ul><li>å…ˆåˆ©ç”¨Rediså®Œæˆåº“å­˜ä½™é‡ã€ä¸€äººä¸€å•åˆ¤æ–­ï¼Œå®ŒæˆæŠ¢å•ä¸šåŠ¡</li><li>å†å°†ä¸‹å•ä¸šåŠ¡æ”¾å…¥é˜»å¡é˜Ÿåˆ—ï¼Œåˆ©ç”¨ç‹¬ç«‹çº¿ç¨‹å¼‚æ­¥ä¸‹å•</li><li>åŸºäºé˜»å¡é˜Ÿåˆ—çš„å¼‚æ­¥ç§’æ€å­˜åœ¨å“ªäº›é—®é¢˜ï¼Ÿ<ul><li>å†…å­˜é™åˆ¶é—®é¢˜</li><li>æ•°æ®å®‰å…¨é—®é¢˜</li></ul></li></ul><h2 id="7ã€Redisæ¶ˆæ¯é˜Ÿåˆ—"><strong>7ã€Redisæ¶ˆæ¯é˜Ÿåˆ—</strong></h2><h3 id="7-1-Redisæ¶ˆæ¯é˜Ÿåˆ—-è®¤è¯†æ¶ˆæ¯é˜Ÿåˆ—">7.1 Redisæ¶ˆæ¯é˜Ÿåˆ—-è®¤è¯†æ¶ˆæ¯é˜Ÿåˆ—</h3><p>ä»€ä¹ˆæ˜¯æ¶ˆæ¯é˜Ÿåˆ—ï¼šå­—é¢æ„æ€å°±æ˜¯å­˜æ”¾æ¶ˆæ¯çš„é˜Ÿåˆ—ã€‚æœ€ç®€å•çš„æ¶ˆæ¯é˜Ÿåˆ—æ¨¡å‹åŒ…æ‹¬3ä¸ªè§’è‰²ï¼š</p><ul><li>æ¶ˆæ¯é˜Ÿåˆ—ï¼šå­˜å‚¨å’Œç®¡ç†æ¶ˆæ¯ï¼Œä¹Ÿè¢«ç§°ä¸ºæ¶ˆæ¯ä»£ç†ï¼ˆMessage Brokerï¼‰</li><li>ç”Ÿäº§è€…ï¼šå‘é€æ¶ˆæ¯åˆ°æ¶ˆæ¯é˜Ÿåˆ—</li><li>æ¶ˆè´¹è€…ï¼šä»æ¶ˆæ¯é˜Ÿåˆ—è·å–æ¶ˆæ¯å¹¶å¤„ç†æ¶ˆæ¯</li></ul><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/1653574849336.png" alt="1653574849336"></p><p>ä½¿ç”¨é˜Ÿåˆ—çš„å¥½å¤„åœ¨äº **è§£è€¦ï¼š**æ‰€è°“è§£è€¦ï¼Œä¸¾ä¸€ä¸ªç”Ÿæ´»ä¸­çš„ä¾‹å­å°±æ˜¯ï¼šå¿«é€’å‘˜(ç”Ÿäº§è€…)æŠŠå¿«é€’æ”¾åˆ°å¿«é€’æŸœé‡Œè¾¹(Message Queue)å»ï¼Œæˆ‘ä»¬(æ¶ˆè´¹è€…)ä»å¿«é€’æŸœé‡Œè¾¹å»æ‹¿ä¸œè¥¿ï¼Œè¿™å°±æ˜¯ä¸€ä¸ªå¼‚æ­¥ï¼Œå¦‚æœè€¦åˆï¼Œé‚£ä¹ˆè¿™ä¸ªå¿«é€’å‘˜ç›¸å½“äºç›´æ¥æŠŠå¿«é€’äº¤ç»™ä½ ï¼Œè¿™äº‹å›ºç„¶å¥½ï¼Œä½†æ˜¯ä¸‡ä¸€ä½ ä¸åœ¨å®¶ï¼Œé‚£ä¹ˆå¿«é€’å‘˜å°±ä¼šä¸€ç›´ç­‰ä½ ï¼Œè¿™å°±æµªè´¹äº†å¿«é€’å‘˜çš„æ—¶é—´ï¼Œæ‰€ä»¥è¿™ç§æ€æƒ³åœ¨æˆ‘ä»¬æ—¥å¸¸å¼€å‘ä¸­ï¼Œæ˜¯éå¸¸æœ‰å¿…è¦çš„ã€‚</p><p>è¿™ç§åœºæ™¯åœ¨æˆ‘ä»¬ç§’æ€ä¸­å°±å˜æˆäº†ï¼šæˆ‘ä»¬ä¸‹å•ä¹‹åï¼Œåˆ©ç”¨rediså»è¿›è¡Œæ ¡éªŒä¸‹å•æ¡ä»¶ï¼Œå†é€šè¿‡é˜Ÿåˆ—æŠŠæ¶ˆæ¯å‘é€å‡ºå»ï¼Œç„¶åå†å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹å»æ¶ˆè´¹è¿™ä¸ªæ¶ˆæ¯ï¼Œå®Œæˆè§£è€¦ï¼ŒåŒæ—¶ä¹ŸåŠ å¿«æˆ‘ä»¬çš„å“åº”é€Ÿåº¦ã€‚</p><p>è¿™é‡Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€äº›ç°æˆçš„mqï¼Œæ¯”å¦‚kafkaï¼Œrabbitmqç­‰ç­‰ï¼Œä½†æ˜¯å‘¢ï¼Œå¦‚æœæ²¡æœ‰å®‰è£…mqï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨redisæä¾›çš„mqæ–¹æ¡ˆï¼Œé™ä½æˆ‘ä»¬çš„éƒ¨ç½²å’Œå­¦ä¹ æˆæœ¬ã€‚</p><h3 id="7-2-Redisæ¶ˆæ¯é˜Ÿåˆ—-åŸºäºListå®ç°æ¶ˆæ¯é˜Ÿåˆ—">7.2 Redisæ¶ˆæ¯é˜Ÿåˆ—-åŸºäºListå®ç°æ¶ˆæ¯é˜Ÿåˆ—</h3><p><strong>åŸºäºListç»“æ„æ¨¡æ‹Ÿæ¶ˆæ¯é˜Ÿåˆ—</strong></p><p>æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆMessage Queueï¼‰ï¼Œå­—é¢æ„æ€å°±æ˜¯å­˜æ”¾æ¶ˆæ¯çš„é˜Ÿåˆ—ã€‚è€ŒRedisçš„listæ•°æ®ç»“æ„æ˜¯ä¸€ä¸ªåŒå‘é“¾è¡¨ï¼Œå¾ˆå®¹æ˜“æ¨¡æ‹Ÿå‡ºé˜Ÿåˆ—æ•ˆæœã€‚</p><p>é˜Ÿåˆ—æ˜¯å…¥å£å’Œå‡ºå£ä¸åœ¨ä¸€è¾¹ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ï¼šLPUSH ç»“åˆ RPOPã€æˆ–è€… RPUSH ç»“åˆ LPOPæ¥å®ç°ã€‚<br>ä¸è¿‡è¦æ³¨æ„çš„æ˜¯ï¼Œå½“é˜Ÿåˆ—ä¸­æ²¡æœ‰æ¶ˆæ¯æ—¶RPOPæˆ–LPOPæ“ä½œä¼šè¿”å›nullï¼Œå¹¶ä¸åƒJVMçš„é˜»å¡é˜Ÿåˆ—é‚£æ ·ä¼šé˜»å¡å¹¶ç­‰å¾…æ¶ˆæ¯ã€‚å› æ­¤è¿™é‡Œåº”è¯¥ä½¿ç”¨BRPOPæˆ–è€…BLPOPæ¥å®ç°é˜»å¡æ•ˆæœã€‚</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/1653575176451.png" alt="1653575176451"></p><p>åŸºäºListçš„æ¶ˆæ¯é˜Ÿåˆ—æœ‰å“ªäº›ä¼˜ç¼ºç‚¹ï¼Ÿ<br>ä¼˜ç‚¹ï¼š</p><ul><li>åˆ©ç”¨Rediså­˜å‚¨ï¼Œä¸å—é™äºJVMå†…å­˜ä¸Šé™</li><li>åŸºäºRedisçš„æŒä¹…åŒ–æœºåˆ¶ï¼Œæ•°æ®å®‰å…¨æ€§æœ‰ä¿è¯</li><li>å¯ä»¥æ»¡è¶³æ¶ˆæ¯æœ‰åºæ€§</li></ul><p>ç¼ºç‚¹ï¼š</p><ul><li>æ— æ³•é¿å…æ¶ˆæ¯ä¸¢å¤±</li><li>åªæ”¯æŒå•æ¶ˆè´¹è€…</li></ul><h3 id="7-3-Redisæ¶ˆæ¯é˜Ÿåˆ—-åŸºäºPubSubçš„æ¶ˆæ¯é˜Ÿåˆ—">7.3 Redisæ¶ˆæ¯é˜Ÿåˆ—-åŸºäºPubSubçš„æ¶ˆæ¯é˜Ÿåˆ—</h3><p>PubSubï¼ˆå‘å¸ƒè®¢é˜…ï¼‰æ˜¯Redis2.0ç‰ˆæœ¬å¼•å…¥çš„æ¶ˆæ¯ä¼ é€’æ¨¡å‹ã€‚é¡¾åæ€ä¹‰ï¼Œæ¶ˆè´¹è€…å¯ä»¥è®¢é˜…ä¸€ä¸ªæˆ–å¤šä¸ªchannelï¼Œç”Ÿäº§è€…å‘å¯¹åº”channelå‘é€æ¶ˆæ¯åï¼Œæ‰€æœ‰è®¢é˜…è€…éƒ½èƒ½æ”¶åˆ°ç›¸å…³æ¶ˆæ¯ã€‚</p><p>SUBSCRIBE channel [channel] ï¼šè®¢é˜…ä¸€ä¸ªæˆ–å¤šä¸ªé¢‘é“<br>PUBLISH channel msg ï¼šå‘ä¸€ä¸ªé¢‘é“å‘é€æ¶ˆæ¯<br>PSUBSCRIBE pattern[pattern] ï¼šè®¢é˜…ä¸patternæ ¼å¼åŒ¹é…çš„æ‰€æœ‰é¢‘é“</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/1653575506373.png" alt="1653575506373"></p><p>åŸºäºPubSubçš„æ¶ˆæ¯é˜Ÿåˆ—æœ‰å“ªäº›ä¼˜ç¼ºç‚¹ï¼Ÿ<br>ä¼˜ç‚¹ï¼š</p><ul><li>é‡‡ç”¨å‘å¸ƒè®¢é˜…æ¨¡å‹ï¼Œæ”¯æŒå¤šç”Ÿäº§ã€å¤šæ¶ˆè´¹</li></ul><p>ç¼ºç‚¹ï¼š</p><ul><li>ä¸æ”¯æŒæ•°æ®æŒä¹…åŒ–</li><li>æ— æ³•é¿å…æ¶ˆæ¯ä¸¢å¤±</li><li>æ¶ˆæ¯å †ç§¯æœ‰ä¸Šé™ï¼Œè¶…å‡ºæ—¶æ•°æ®ä¸¢å¤±</li></ul><h3 id="7-4-Redisæ¶ˆæ¯é˜Ÿåˆ—-åŸºäºStreamçš„æ¶ˆæ¯é˜Ÿåˆ—">7.4 Redisæ¶ˆæ¯é˜Ÿåˆ—-åŸºäºStreamçš„æ¶ˆæ¯é˜Ÿåˆ—</h3><p>Stream æ˜¯ Redis 5.0 å¼•å…¥çš„ä¸€ç§æ–°æ•°æ®ç±»å‹ï¼Œå¯ä»¥å®ç°ä¸€ä¸ªåŠŸèƒ½éå¸¸å®Œå–„çš„æ¶ˆæ¯é˜Ÿåˆ—ã€‚</p><p>å‘é€æ¶ˆæ¯çš„å‘½ä»¤ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/1653577301737.png" alt="1653577301737"></p><p>ä¾‹å¦‚ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/1653577349691.png" alt="1653577349691"></p><p>è¯»å–æ¶ˆæ¯çš„æ–¹å¼ä¹‹ä¸€ï¼šXREAD</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/1653577445413.png" alt="1653577445413"></p><p>ä¾‹å¦‚ï¼Œä½¿ç”¨XREADè¯»å–ç¬¬ä¸€ä¸ªæ¶ˆæ¯ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/1653577643629.png" alt="1653577643629"></p><p>XREADé˜»å¡æ–¹å¼ï¼Œè¯»å–æœ€æ–°çš„æ¶ˆæ¯ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/1653577659166.png" alt="1653577659166"></p><p>åœ¨ä¸šåŠ¡å¼€å‘ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å¾ªç¯çš„è°ƒç”¨XREADé˜»å¡æ–¹å¼æ¥æŸ¥è¯¢æœ€æ–°æ¶ˆæ¯ï¼Œä»è€Œå®ç°æŒç»­ç›‘å¬é˜Ÿåˆ—çš„æ•ˆæœï¼Œä¼ªä»£ç å¦‚ä¸‹</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/1653577689129.png" alt="1653577689129"></p><p>æ³¨æ„ï¼šå½“æˆ‘ä»¬æŒ‡å®šèµ·å§‹IDä¸º$æ—¶ï¼Œä»£è¡¨è¯»å–æœ€æ–°çš„æ¶ˆæ¯ï¼Œå¦‚æœæˆ‘ä»¬å¤„ç†ä¸€æ¡æ¶ˆæ¯çš„è¿‡ç¨‹ä¸­ï¼Œåˆæœ‰è¶…è¿‡1æ¡ä»¥ä¸Šçš„æ¶ˆæ¯åˆ°è¾¾é˜Ÿåˆ—ï¼Œåˆ™ä¸‹æ¬¡è·å–æ—¶ä¹Ÿåªèƒ½è·å–åˆ°æœ€æ–°çš„ä¸€æ¡ï¼Œä¼šå‡ºç°æ¼è¯»æ¶ˆæ¯çš„é—®é¢˜</p><p>STREAMç±»å‹æ¶ˆæ¯é˜Ÿåˆ—çš„XREADå‘½ä»¤ç‰¹ç‚¹ï¼š</p><ul><li>æ¶ˆæ¯å¯å›æº¯</li><li>ä¸€ä¸ªæ¶ˆæ¯å¯ä»¥è¢«å¤šä¸ªæ¶ˆè´¹è€…è¯»å–</li><li>å¯ä»¥é˜»å¡è¯»å–</li><li>æœ‰æ¶ˆæ¯æ¼è¯»çš„é£é™©</li></ul><h3 id="7-5-Redisæ¶ˆæ¯é˜Ÿåˆ—-åŸºäºStreamçš„æ¶ˆæ¯é˜Ÿåˆ—-æ¶ˆè´¹è€…ç»„">7.5 Redisæ¶ˆæ¯é˜Ÿåˆ—-åŸºäºStreamçš„æ¶ˆæ¯é˜Ÿåˆ—-æ¶ˆè´¹è€…ç»„</h3><p>æ¶ˆè´¹è€…ç»„ï¼ˆConsumer Groupï¼‰ï¼šå°†å¤šä¸ªæ¶ˆè´¹è€…åˆ’åˆ†åˆ°ä¸€ä¸ªç»„ä¸­ï¼Œç›‘å¬åŒä¸€ä¸ªé˜Ÿåˆ—ã€‚å…·å¤‡ä¸‹åˆ—ç‰¹ç‚¹ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/1653577801668.png" alt="1653577801668"></p><p>åˆ›å»ºæ¶ˆè´¹è€…ç»„ï¼š<br><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/1653577984924.png" alt="1653577984924"><br>keyï¼šé˜Ÿåˆ—åç§°<br>groupNameï¼šæ¶ˆè´¹è€…ç»„åç§°<br>IDï¼šèµ·å§‹IDæ ‡ç¤ºï¼Œ$ä»£è¡¨é˜Ÿåˆ—ä¸­æœ€åä¸€ä¸ªæ¶ˆæ¯ï¼Œ0åˆ™ä»£è¡¨é˜Ÿåˆ—ä¸­ç¬¬ä¸€ä¸ªæ¶ˆæ¯<br>MKSTREAMï¼šé˜Ÿåˆ—ä¸å­˜åœ¨æ—¶è‡ªåŠ¨åˆ›å»ºé˜Ÿåˆ—<br>å…¶å®ƒå¸¸è§å‘½ä»¤ï¼š</p><p><strong>åˆ é™¤æŒ‡å®šçš„æ¶ˆè´¹è€…ç»„</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">XGROUP DESTORY key groupName</span><br></pre></td></tr></table></figure><p><strong>ç»™æŒ‡å®šçš„æ¶ˆè´¹è€…ç»„æ·»åŠ æ¶ˆè´¹è€…</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">XGROUP CREATECONSUMER key groupname consumername</span><br></pre></td></tr></table></figure><p><strong>åˆ é™¤æ¶ˆè´¹è€…ç»„ä¸­çš„æŒ‡å®šæ¶ˆè´¹è€…</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">XGROUP DELCONSUMER key groupname consumername</span><br></pre></td></tr></table></figure><p>ä»æ¶ˆè´¹è€…ç»„è¯»å–æ¶ˆæ¯ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">XREADGROUP GROUP group consumer [COUNT count] [BLOCK milliseconds] [NOACK] STREAMS key [key ...] ID [ID ...]</span><br></pre></td></tr></table></figure><ul><li>groupï¼šæ¶ˆè´¹ç»„åç§°</li><li>consumerï¼šæ¶ˆè´¹è€…åç§°ï¼Œå¦‚æœæ¶ˆè´¹è€…ä¸å­˜åœ¨ï¼Œä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªæ¶ˆè´¹è€…</li><li>countï¼šæœ¬æ¬¡æŸ¥è¯¢çš„æœ€å¤§æ•°é‡</li><li>BLOCK millisecondsï¼šå½“æ²¡æœ‰æ¶ˆæ¯æ—¶æœ€é•¿ç­‰å¾…æ—¶é—´</li><li>NOACKï¼šæ— éœ€æ‰‹åŠ¨ACKï¼Œè·å–åˆ°æ¶ˆæ¯åè‡ªåŠ¨ç¡®è®¤</li><li>STREAMS keyï¼šæŒ‡å®šé˜Ÿåˆ—åç§°</li><li>IDï¼šè·å–æ¶ˆæ¯çš„èµ·å§‹IDï¼š</li></ul><p>â€œ&gt;â€ï¼šä»ä¸‹ä¸€ä¸ªæœªæ¶ˆè´¹çš„æ¶ˆæ¯å¼€å§‹<br>å…¶å®ƒï¼šæ ¹æ®æŒ‡å®šidä»pending-listä¸­è·å–å·²æ¶ˆè´¹ä½†æœªç¡®è®¤çš„æ¶ˆæ¯ï¼Œä¾‹å¦‚0ï¼Œæ˜¯ä»pending-listä¸­çš„ç¬¬ä¸€ä¸ªæ¶ˆæ¯å¼€å§‹</p><p>æ¶ˆè´¹è€…ç›‘å¬æ¶ˆæ¯çš„åŸºæœ¬æ€è·¯ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/1653578211854.png" alt="1653578211854">STREAMç±»å‹æ¶ˆæ¯é˜Ÿåˆ—çš„XREADGROUPå‘½ä»¤ç‰¹ç‚¹ï¼š</p><ul><li>æ¶ˆæ¯å¯å›æº¯</li><li>å¯ä»¥å¤šæ¶ˆè´¹è€…äº‰æŠ¢æ¶ˆæ¯ï¼ŒåŠ å¿«æ¶ˆè´¹é€Ÿåº¦</li><li>å¯ä»¥é˜»å¡è¯»å–</li><li>æ²¡æœ‰æ¶ˆæ¯æ¼è¯»çš„é£é™©</li><li>æœ‰æ¶ˆæ¯ç¡®è®¤æœºåˆ¶ï¼Œä¿è¯æ¶ˆæ¯è‡³å°‘è¢«æ¶ˆè´¹ä¸€æ¬¡</li></ul><p>æœ€åæˆ‘ä»¬æ¥ä¸ªå°å¯¹æ¯”</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/1653578560691.png" alt="1653578560691"></p><h3 id="7-6-åŸºäºRedisçš„Streamç»“æ„ä½œä¸ºæ¶ˆæ¯é˜Ÿåˆ—ï¼Œå®ç°å¼‚æ­¥ç§’æ€ä¸‹å•">7.6 åŸºäºRedisçš„Streamç»“æ„ä½œä¸ºæ¶ˆæ¯é˜Ÿåˆ—ï¼Œå®ç°å¼‚æ­¥ç§’æ€ä¸‹å•</h3><p>éœ€æ±‚ï¼š</p><ul><li>åˆ›å»ºä¸€ä¸ªStreamç±»å‹çš„æ¶ˆæ¯é˜Ÿåˆ—ï¼Œåä¸ºstream.orders</li><li>ä¿®æ”¹ä¹‹å‰çš„ç§’æ€ä¸‹å•Luaè„šæœ¬ï¼Œåœ¨è®¤å®šæœ‰æŠ¢è´­èµ„æ ¼åï¼Œç›´æ¥å‘stream.ordersä¸­æ·»åŠ æ¶ˆæ¯ï¼Œå†…å®¹åŒ…å«voucherIdã€userIdã€orderId</li><li>é¡¹ç›®å¯åŠ¨æ—¶ï¼Œå¼€å¯ä¸€ä¸ªçº¿ç¨‹ä»»åŠ¡ï¼Œå°è¯•è·å–stream.ordersä¸­çš„æ¶ˆæ¯ï¼Œå®Œæˆä¸‹å•\</li></ul><p>ä¿®æ”¹luaè¡¨è¾¾å¼,æ–°å¢3.6</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/1656082824939.png" alt="1656082824939"></p><p>VoucherOrderServiceImpl</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">class</span> <span class="title class_">VoucherOrderHandler</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// 1.è·å–æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„è®¢å•ä¿¡æ¯ XREADGROUP GROUP g1 c1 COUNT 1 BLOCK 2000 STREAMS s1 &gt;</span></span><br><span class="line">                List&lt;MapRecord&lt;String, Object, Object&gt;&gt; list = stringRedisTemplate.opsForStream().read(</span><br><span class="line">                    Consumer.from(<span class="string">&quot;g1&quot;</span>, <span class="string">&quot;c1&quot;</span>),</span><br><span class="line">                    StreamReadOptions.empty().count(<span class="number">1</span>).block(Duration.ofSeconds(<span class="number">2</span>)),</span><br><span class="line">                    StreamOffset.create(<span class="string">&quot;stream.orders&quot;</span>, ReadOffset.lastConsumed())</span><br><span class="line">                );</span><br><span class="line">                <span class="comment">// 2.åˆ¤æ–­è®¢å•ä¿¡æ¯æ˜¯å¦ä¸ºç©º</span></span><br><span class="line">                <span class="keyword">if</span> (list == <span class="literal">null</span> || list.isEmpty()) &#123;</span><br><span class="line">                    <span class="comment">// å¦‚æœä¸ºnullï¼Œè¯´æ˜æ²¡æœ‰æ¶ˆæ¯ï¼Œç»§ç»­ä¸‹ä¸€æ¬¡å¾ªç¯</span></span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// è§£ææ•°æ®</span></span><br><span class="line">                MapRecord&lt;String, Object, Object&gt; record = list.get(<span class="number">0</span>);</span><br><span class="line">                Map&lt;Object, Object&gt; value = record.getValue();</span><br><span class="line">                <span class="type">VoucherOrder</span> <span class="variable">voucherOrder</span> <span class="operator">=</span> BeanUtil.fillBeanWithMap(value, <span class="keyword">new</span> <span class="title class_">VoucherOrder</span>(), <span class="literal">true</span>);</span><br><span class="line">                <span class="comment">// 3.åˆ›å»ºè®¢å•</span></span><br><span class="line">                createVoucherOrder(voucherOrder);</span><br><span class="line">                <span class="comment">// 4.ç¡®è®¤æ¶ˆæ¯ XACK</span></span><br><span class="line">                stringRedisTemplate.opsForStream().acknowledge(<span class="string">&quot;s1&quot;</span>, <span class="string">&quot;g1&quot;</span>, record.getId());</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                log.error(<span class="string">&quot;å¤„ç†è®¢å•å¼‚å¸¸&quot;</span>, e);</span><br><span class="line">                <span class="comment">//å¤„ç†å¼‚å¸¸æ¶ˆæ¯</span></span><br><span class="line">                handlePendingList();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">handlePendingList</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// 1.è·å–pending-listä¸­çš„è®¢å•ä¿¡æ¯ XREADGROUP GROUP g1 c1 COUNT 1 BLOCK 2000 STREAMS s1 0</span></span><br><span class="line">                List&lt;MapRecord&lt;String, Object, Object&gt;&gt; list = stringRedisTemplate.opsForStream().read(</span><br><span class="line">                    Consumer.from(<span class="string">&quot;g1&quot;</span>, <span class="string">&quot;c1&quot;</span>),</span><br><span class="line">                    StreamReadOptions.empty().count(<span class="number">1</span>),</span><br><span class="line">                    StreamOffset.create(<span class="string">&quot;stream.orders&quot;</span>, ReadOffset.from(<span class="string">&quot;0&quot;</span>))</span><br><span class="line">                );</span><br><span class="line">                <span class="comment">// 2.åˆ¤æ–­è®¢å•ä¿¡æ¯æ˜¯å¦ä¸ºç©º</span></span><br><span class="line">                <span class="keyword">if</span> (list == <span class="literal">null</span> || list.isEmpty()) &#123;</span><br><span class="line">                    <span class="comment">// å¦‚æœä¸ºnullï¼Œè¯´æ˜æ²¡æœ‰å¼‚å¸¸æ¶ˆæ¯ï¼Œç»“æŸå¾ªç¯</span></span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// è§£ææ•°æ®</span></span><br><span class="line">                MapRecord&lt;String, Object, Object&gt; record = list.get(<span class="number">0</span>);</span><br><span class="line">                Map&lt;Object, Object&gt; value = record.getValue();</span><br><span class="line">                <span class="type">VoucherOrder</span> <span class="variable">voucherOrder</span> <span class="operator">=</span> BeanUtil.fillBeanWithMap(value, <span class="keyword">new</span> <span class="title class_">VoucherOrder</span>(), <span class="literal">true</span>);</span><br><span class="line">                <span class="comment">// 3.åˆ›å»ºè®¢å•</span></span><br><span class="line">                createVoucherOrder(voucherOrder);</span><br><span class="line">                <span class="comment">// 4.ç¡®è®¤æ¶ˆæ¯ XACK</span></span><br><span class="line">                stringRedisTemplate.opsForStream().acknowledge(<span class="string">&quot;s1&quot;</span>, <span class="string">&quot;g1&quot;</span>, record.getId());</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                log.error(<span class="string">&quot;å¤„ç†penddingè®¢å•å¼‚å¸¸&quot;</span>, e);</span><br><span class="line">                <span class="keyword">try</span>&#123;</span><br><span class="line">                    Thread.sleep(<span class="number">20</span>);</span><br><span class="line">                &#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="8ã€è¾¾äººæ¢åº—">8ã€è¾¾äººæ¢åº—</h2><h3 id="8-1ã€è¾¾äººæ¢åº—-å‘å¸ƒæ¢åº—ç¬”è®°">8.1ã€è¾¾äººæ¢åº—-å‘å¸ƒæ¢åº—ç¬”è®°</h3><p>å‘å¸ƒæ¢åº—ç¬”è®°</p><p>æ¢åº—ç¬”è®°ç±»ä¼¼ç‚¹è¯„ç½‘ç«™çš„è¯„ä»·ï¼Œå¾€å¾€æ˜¯å›¾æ–‡ç»“åˆã€‚å¯¹åº”çš„è¡¨æœ‰ä¸¤ä¸ªï¼š<br>tb_blogï¼šæ¢åº—ç¬”è®°è¡¨ï¼ŒåŒ…å«ç¬”è®°ä¸­çš„æ ‡é¢˜ã€æ–‡å­—ã€å›¾ç‰‡ç­‰<br>tb_blog_commentsï¼šå…¶ä»–ç”¨æˆ·å¯¹æ¢åº—ç¬”è®°çš„è¯„ä»·</p><p><strong>å…·ä½“å‘å¸ƒæµç¨‹</strong></p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/1653578992639.png" alt="1653578992639"></p><p>ä¸Šä¼ æ¥å£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;upload&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UploadController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;blog&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">uploadImage</span><span class="params">(<span class="meta">@RequestParam(&quot;file&quot;)</span> MultipartFile image)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// è·å–åŸå§‹æ–‡ä»¶åç§°</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">originalFilename</span> <span class="operator">=</span> image.getOriginalFilename();</span><br><span class="line">            <span class="comment">// ç”Ÿæˆæ–°æ–‡ä»¶å</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> createNewFileName(originalFilename);</span><br><span class="line">            <span class="comment">// ä¿å­˜æ–‡ä»¶</span></span><br><span class="line">            image.transferTo(<span class="keyword">new</span> <span class="title class_">File</span>(SystemConstants.IMAGE_UPLOAD_DIR, fileName));</span><br><span class="line">            <span class="comment">// è¿”å›ç»“æœ</span></span><br><span class="line">            log.debug(<span class="string">&quot;æ–‡ä»¶ä¸Šä¼ æˆåŠŸï¼Œ&#123;&#125;&quot;</span>, fileName);</span><br><span class="line">            <span class="keyword">return</span> Result.ok(fileName);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;æ–‡ä»¶ä¸Šä¼ å¤±è´¥&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼šåŒå­¦ä»¬åœ¨æ“ä½œæ—¶ï¼Œéœ€è¦ä¿®æ”¹SystemConstants.IMAGE_UPLOAD_DIR è‡ªå·±å›¾ç‰‡æ‰€åœ¨çš„åœ°å€ï¼Œåœ¨å®é™…å¼€å‘ä¸­å›¾ç‰‡ä¸€èˆ¬ä¼šæ”¾åœ¨nginxä¸Šæˆ–è€…æ˜¯äº‘å­˜å‚¨ä¸Šã€‚</p><p>BlogController</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/blog&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BlogController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> IBlogService blogService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">saveBlog</span><span class="params">(<span class="meta">@RequestBody</span> Blog blog)</span> &#123;</span><br><span class="line">        <span class="comment">//è·å–ç™»å½•ç”¨æˆ·</span></span><br><span class="line">        <span class="type">UserDTO</span> <span class="variable">user</span> <span class="operator">=</span> UserHolder.getUser();</span><br><span class="line">        blog.setUpdateTime(user.getId());</span><br><span class="line">        <span class="comment">//ä¿å­˜æ¢åº—åšæ–‡</span></span><br><span class="line">        blogService.saveBlog(blog);</span><br><span class="line">        <span class="comment">//è¿”å›id</span></span><br><span class="line">        <span class="keyword">return</span> Result.ok(blog.getId());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="8-2-è¾¾äººæ¢åº—-æŸ¥çœ‹æ¢åº—ç¬”è®°">8.2 è¾¾äººæ¢åº—-æŸ¥çœ‹æ¢åº—ç¬”è®°</h3><p>å®ç°æŸ¥çœ‹å‘å¸ƒæ¢åº—ç¬”è®°çš„æ¥å£</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/1653579931626.png" alt="1653579931626"></p><p>å®ç°ä»£ç ï¼š</p><p>BlogServiceImpl</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">queryBlogById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">    <span class="comment">// 1.æŸ¥è¯¢blog</span></span><br><span class="line">    <span class="type">Blog</span> <span class="variable">blog</span> <span class="operator">=</span> getById(id);</span><br><span class="line">    <span class="keyword">if</span> (blog == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> Result.fail(<span class="string">&quot;ç¬”è®°ä¸å­˜åœ¨ï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 2.æŸ¥è¯¢blogæœ‰å…³çš„ç”¨æˆ·</span></span><br><span class="line">    queryBlogUser(blog);</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">return</span> Result.ok(blog);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="8-3-è¾¾äººæ¢åº—-ç‚¹èµåŠŸèƒ½">8.3 è¾¾äººæ¢åº—-ç‚¹èµåŠŸèƒ½</h3><p>åˆå§‹ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/likes/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">queryBlogLikes</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span> &#123;</span><br><span class="line">    <span class="comment">//ä¿®æ”¹ç‚¹èµæ•°é‡</span></span><br><span class="line">    blogService.update().setSql(<span class="string">&quot;liked = liked +1 &quot;</span>).eq(<span class="string">&quot;id&quot;</span>,id).update();</span><br><span class="line">    <span class="keyword">return</span> Result.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é—®é¢˜åˆ†æï¼šè¿™ç§æ–¹å¼ä¼šå¯¼è‡´ä¸€ä¸ªç”¨æˆ·æ— é™ç‚¹èµï¼Œæ˜æ˜¾æ˜¯ä¸åˆç†çš„</p><p>é€ æˆè¿™ä¸ªé—®é¢˜çš„åŸå› æ˜¯ï¼Œæˆ‘ä»¬ç°åœ¨çš„é€»è¾‘ï¼Œå‘èµ·è¯·æ±‚åªæ˜¯ç»™æ•°æ®åº“+1ï¼Œæ‰€ä»¥æ‰ä¼šå‡ºç°è¿™ä¸ªé—®é¢˜</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/1653581590453.png" alt="1653581590453"></p><p>å®Œå–„ç‚¹èµåŠŸèƒ½</p><p>éœ€æ±‚ï¼š</p><ul><li>åŒä¸€ä¸ªç”¨æˆ·åªèƒ½ç‚¹èµä¸€æ¬¡ï¼Œå†æ¬¡ç‚¹å‡»åˆ™å–æ¶ˆç‚¹èµ</li><li>å¦‚æœå½“å‰ç”¨æˆ·å·²ç»ç‚¹èµï¼Œåˆ™ç‚¹èµæŒ‰é’®é«˜äº®æ˜¾ç¤ºï¼ˆå‰ç«¯å·²å®ç°ï¼Œåˆ¤æ–­å­—æ®µBlogç±»çš„isLikeå±æ€§ï¼‰</li></ul><p>å®ç°æ­¥éª¤ï¼š</p><ul><li>ç»™Blogç±»ä¸­æ·»åŠ ä¸€ä¸ªisLikeå­—æ®µï¼Œæ ‡ç¤ºæ˜¯å¦è¢«å½“å‰ç”¨æˆ·ç‚¹èµ</li><li>ä¿®æ”¹ç‚¹èµåŠŸèƒ½ï¼Œåˆ©ç”¨Redisçš„seté›†åˆåˆ¤æ–­æ˜¯å¦ç‚¹èµè¿‡ï¼Œæœªç‚¹èµè¿‡åˆ™ç‚¹èµæ•°+1ï¼Œå·²ç‚¹èµè¿‡åˆ™ç‚¹èµæ•°-1</li><li>ä¿®æ”¹æ ¹æ®idæŸ¥è¯¢Blogçš„ä¸šåŠ¡ï¼Œåˆ¤æ–­å½“å‰ç™»å½•ç”¨æˆ·æ˜¯å¦ç‚¹èµè¿‡ï¼Œèµ‹å€¼ç»™isLikeå­—æ®µ</li><li>ä¿®æ”¹åˆ†é¡µæŸ¥è¯¢Blogä¸šåŠ¡ï¼Œåˆ¤æ–­å½“å‰ç™»å½•ç”¨æˆ·æ˜¯å¦ç‚¹èµè¿‡ï¼Œèµ‹å€¼ç»™isLikeå­—æ®µ</li></ul><p>ä¸ºä»€ä¹ˆé‡‡ç”¨seté›†åˆï¼š</p><p>å› ä¸ºæˆ‘ä»¬çš„æ•°æ®æ˜¯ä¸èƒ½é‡å¤çš„ï¼Œå½“ç”¨æˆ·æ“ä½œè¿‡ä¹‹åï¼Œæ— è®ºä»–æ€ä¹ˆæ“ä½œï¼Œéƒ½æ˜¯</p><p>å…·ä½“æ­¥éª¤ï¼š</p><p>1ã€åœ¨Blog æ·»åŠ ä¸€ä¸ªå­—æ®µ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@TableField(exist = false)</span></span><br><span class="line"><span class="keyword">private</span> Boolean isLike;</span><br></pre></td></tr></table></figure><p>2ã€ä¿®æ”¹ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> Result <span class="title function_">likeBlog</span><span class="params">(Long id)</span>&#123;</span><br><span class="line">       <span class="comment">// 1.è·å–ç™»å½•ç”¨æˆ·</span></span><br><span class="line">       <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> UserHolder.getUser().getId();</span><br><span class="line">       <span class="comment">// 2.åˆ¤æ–­å½“å‰ç™»å½•ç”¨æˆ·æ˜¯å¦å·²ç»ç‚¹èµ</span></span><br><span class="line">       <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> BLOG_LIKED_KEY + id;</span><br><span class="line">       <span class="type">Boolean</span> <span class="variable">isMember</span> <span class="operator">=</span> stringRedisTemplate.opsForSet().isMember(key, userId.toString());</span><br><span class="line">       <span class="keyword">if</span>(BooleanUtil.isFalse(isMember))&#123;</span><br><span class="line">            <span class="comment">//3.å¦‚æœæœªç‚¹èµï¼Œå¯ä»¥ç‚¹èµ</span></span><br><span class="line">           <span class="comment">//3.1 æ•°æ®åº“ç‚¹èµæ•°+1</span></span><br><span class="line">           <span class="type">boolean</span> <span class="variable">isSuccess</span> <span class="operator">=</span> update().setSql(<span class="string">&quot;liked = liked + 1&quot;</span>).eq(<span class="string">&quot;id&quot;</span>, id).update();</span><br><span class="line">           <span class="comment">//3.2 ä¿å­˜ç”¨æˆ·åˆ°Redisçš„seté›†åˆ</span></span><br><span class="line">           <span class="keyword">if</span>(isSuccess)&#123;</span><br><span class="line">               stringRedisTemplate.opsForSet().add(key,userId.toString());</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">//4.å¦‚æœå·²ç‚¹èµï¼Œå–æ¶ˆç‚¹èµ</span></span><br><span class="line">           <span class="comment">//4.1 æ•°æ®åº“ç‚¹èµæ•°-1</span></span><br><span class="line">           <span class="type">boolean</span> <span class="variable">isSuccess</span> <span class="operator">=</span> update().setSql(<span class="string">&quot;liked = liked - 1&quot;</span>).eq(<span class="string">&quot;id&quot;</span>, id).update();</span><br><span class="line">           <span class="comment">//4.2 æŠŠç”¨æˆ·ä»Redisçš„seté›†åˆç§»é™¤</span></span><br><span class="line">           <span class="keyword">if</span>(isSuccess)&#123;</span><br><span class="line">               stringRedisTemplate.opsForSet().remove(key,userId.toString());</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br></pre></td></tr></table></figure><h3 id="8-4-è¾¾äººæ¢åº—-ç‚¹èµæ’è¡Œæ¦œ">8.4 è¾¾äººæ¢åº—-ç‚¹èµæ’è¡Œæ¦œ</h3><p>åœ¨æ¢åº—ç¬”è®°çš„è¯¦æƒ…é¡µé¢ï¼Œåº”è¯¥æŠŠç»™è¯¥ç¬”è®°ç‚¹èµçš„äººæ˜¾ç¤ºå‡ºæ¥ï¼Œæ¯”å¦‚æœ€æ—©ç‚¹èµçš„TOP5ï¼Œå½¢æˆç‚¹èµæ’è¡Œæ¦œï¼š</p><p>ä¹‹å‰çš„ç‚¹èµæ˜¯æ”¾åˆ°seté›†åˆï¼Œä½†æ˜¯seté›†åˆæ˜¯ä¸èƒ½æ’åºçš„ï¼Œæ‰€ä»¥è¿™ä¸ªæ—¶å€™ï¼Œå’±ä»¬å¯ä»¥é‡‡ç”¨ä¸€ä¸ªå¯ä»¥æ’åºçš„seté›†åˆï¼Œå°±æ˜¯å’±ä»¬çš„sortedSet</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/1653805077118.png" alt="1653805077118"></p><p>æˆ‘ä»¬æ¥ä¸‹æ¥æ¥å¯¹æ¯”ä¸€ä¸‹è¿™äº›é›†åˆçš„åŒºåˆ«æ˜¯ä»€ä¹ˆ</p><p>æ‰€æœ‰ç‚¹èµçš„äººï¼Œéœ€è¦æ˜¯å”¯ä¸€çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬åº”å½“ä½¿ç”¨setæˆ–è€…æ˜¯sortedSet</p><p>å…¶æ¬¡æˆ‘ä»¬éœ€è¦æ’åºï¼Œå°±å¯ä»¥ç›´æ¥é”å®šä½¿ç”¨sortedSetå•¦</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/1653805203758.png" alt="1653805203758"></p><p>ä¿®æ”¹ä»£ç </p><p>BlogServiceImpl</p><p>ç‚¹èµé€»è¾‘ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"> <span class="keyword">public</span> Result <span class="title function_">likeBlog</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">     <span class="comment">// 1.è·å–ç™»å½•ç”¨æˆ·</span></span><br><span class="line">     <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> UserHolder.getUser().getId();</span><br><span class="line">     <span class="comment">// 2.åˆ¤æ–­å½“å‰ç™»å½•ç”¨æˆ·æ˜¯å¦å·²ç»ç‚¹èµ</span></span><br><span class="line">     <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> BLOG_LIKED_KEY + id;</span><br><span class="line">     <span class="type">Double</span> <span class="variable">score</span> <span class="operator">=</span> stringRedisTemplate.opsForZSet().score(key, userId.toString());</span><br><span class="line">     <span class="keyword">if</span> (score == <span class="literal">null</span>) &#123;</span><br><span class="line">         <span class="comment">// 3.å¦‚æœæœªç‚¹èµï¼Œå¯ä»¥ç‚¹èµ</span></span><br><span class="line">         <span class="comment">// 3.1.æ•°æ®åº“ç‚¹èµæ•° + 1</span></span><br><span class="line">         <span class="type">boolean</span> <span class="variable">isSuccess</span> <span class="operator">=</span> update().setSql(<span class="string">&quot;liked = liked + 1&quot;</span>).eq(<span class="string">&quot;id&quot;</span>, id).update();</span><br><span class="line">         <span class="comment">// 3.2.ä¿å­˜ç”¨æˆ·åˆ°Redisçš„seté›†åˆ  zadd key value score</span></span><br><span class="line">         <span class="keyword">if</span> (isSuccess) &#123;</span><br><span class="line">             stringRedisTemplate.opsForZSet().add(key, userId.toString(), System.currentTimeMillis());</span><br><span class="line">         &#125;</span><br><span class="line">     &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">         <span class="comment">// 4.å¦‚æœå·²ç‚¹èµï¼Œå–æ¶ˆç‚¹èµ</span></span><br><span class="line">         <span class="comment">// 4.1.æ•°æ®åº“ç‚¹èµæ•° -1</span></span><br><span class="line">         <span class="type">boolean</span> <span class="variable">isSuccess</span> <span class="operator">=</span> update().setSql(<span class="string">&quot;liked = liked - 1&quot;</span>).eq(<span class="string">&quot;id&quot;</span>, id).update();</span><br><span class="line">         <span class="comment">// 4.2.æŠŠç”¨æˆ·ä»Redisçš„seté›†åˆç§»é™¤</span></span><br><span class="line">         <span class="keyword">if</span> (isSuccess) &#123;</span><br><span class="line">             stringRedisTemplate.opsForZSet().remove(key, userId.toString());</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">return</span> Result.ok();</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">isBlogLiked</span><span class="params">(Blog blog)</span> &#123;</span><br><span class="line">     <span class="comment">// 1.è·å–ç™»å½•ç”¨æˆ·</span></span><br><span class="line">     <span class="type">UserDTO</span> <span class="variable">user</span> <span class="operator">=</span> UserHolder.getUser();</span><br><span class="line">     <span class="keyword">if</span> (user == <span class="literal">null</span>) &#123;</span><br><span class="line">         <span class="comment">// ç”¨æˆ·æœªç™»å½•ï¼Œæ— éœ€æŸ¥è¯¢æ˜¯å¦ç‚¹èµ</span></span><br><span class="line">         <span class="keyword">return</span>;</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> user.getId();</span><br><span class="line">     <span class="comment">// 2.åˆ¤æ–­å½“å‰ç™»å½•ç”¨æˆ·æ˜¯å¦å·²ç»ç‚¹èµ</span></span><br><span class="line">     <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> <span class="string">&quot;blog:liked:&quot;</span> + blog.getId();</span><br><span class="line">     <span class="type">Double</span> <span class="variable">score</span> <span class="operator">=</span> stringRedisTemplate.opsForZSet().score(key, userId.toString());</span><br><span class="line">     blog.setIsLike(score != <span class="literal">null</span>);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>ç‚¹èµåˆ—è¡¨æŸ¥è¯¢åˆ—è¡¨</p><p>BlogController</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/likes/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">queryBlogLikes</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> blogService.queryBlogLikes(id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>BlogService</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">queryBlogLikes</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> BLOG_LIKED_KEY + id;</span><br><span class="line">    <span class="comment">// 1.æŸ¥è¯¢top5çš„ç‚¹èµç”¨æˆ· zrange key 0 4</span></span><br><span class="line">    Set&lt;String&gt; top5 = stringRedisTemplate.opsForZSet().range(key, <span class="number">0</span>, <span class="number">4</span>);</span><br><span class="line">    <span class="keyword">if</span> (top5 == <span class="literal">null</span> || top5.isEmpty()) &#123;</span><br><span class="line">        <span class="keyword">return</span> Result.ok(Collections.emptyList());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 2.è§£æå‡ºå…¶ä¸­çš„ç”¨æˆ·id</span></span><br><span class="line">    List&lt;Long&gt; ids = top5.stream().map(Long::valueOf).collect(Collectors.toList());</span><br><span class="line">    <span class="type">String</span> <span class="variable">idStr</span> <span class="operator">=</span> StrUtil.join(<span class="string">&quot;,&quot;</span>, ids);</span><br><span class="line">    <span class="comment">// 3.æ ¹æ®ç”¨æˆ·idæŸ¥è¯¢ç”¨æˆ· WHERE id IN ( 5 , 1 ) ORDER BY FIELD(id, 5, 1)</span></span><br><span class="line">    List&lt;UserDTO&gt; userDTOS = userService.query()</span><br><span class="line">            .in(<span class="string">&quot;id&quot;</span>, ids).last(<span class="string">&quot;ORDER BY FIELD(id,&quot;</span> + idStr + <span class="string">&quot;)&quot;</span>).list()</span><br><span class="line">            .stream()</span><br><span class="line">            .map(user -&gt; BeanUtil.copyProperties(user, UserDTO.class))</span><br><span class="line">            .collect(Collectors.toList());</span><br><span class="line">    <span class="comment">// 4.è¿”å›</span></span><br><span class="line">    <span class="keyword">return</span> Result.ok(userDTOS);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="9ã€å¥½å‹å…³æ³¨">9ã€å¥½å‹å…³æ³¨</h2><h3 id="9-1-å¥½å‹å…³æ³¨-å…³æ³¨å’Œå–æ¶ˆå…³æ³¨">9.1 å¥½å‹å…³æ³¨-å…³æ³¨å’Œå–æ¶ˆå…³æ³¨</h3><p>é’ˆå¯¹ç”¨æˆ·çš„æ“ä½œï¼šå¯ä»¥å¯¹ç”¨æˆ·è¿›è¡Œå…³æ³¨å’Œå–æ¶ˆå…³æ³¨åŠŸèƒ½ã€‚</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/1653806140822.png" alt="1653806140822"></p><p>å®ç°æ€è·¯ï¼š</p><p>éœ€æ±‚ï¼šåŸºäºè¯¥è¡¨æ•°æ®ç»“æ„ï¼Œå®ç°ä¸¤ä¸ªæ¥å£ï¼š</p><ul><li>å…³æ³¨å’Œå–å…³æ¥å£</li><li>åˆ¤æ–­æ˜¯å¦å…³æ³¨çš„æ¥å£</li></ul><p>å…³æ³¨æ˜¯Userä¹‹é—´çš„å…³ç³»ï¼Œæ˜¯åšä¸»ä¸ç²‰ä¸çš„å…³ç³»ï¼Œæ•°æ®åº“ä¸­æœ‰ä¸€å¼ tb_followè¡¨æ¥æ ‡ç¤ºï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/1653806253817.png" alt="1653806253817"></p><p>æ³¨æ„: è¿™é‡Œéœ€è¦æŠŠä¸»é”®ä¿®æ”¹ä¸ºè‡ªå¢é•¿ï¼Œç®€åŒ–å¼€å‘ã€‚</p><p>FollowController</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å…³æ³¨</span></span><br><span class="line"><span class="meta">@PutMapping(&quot;/&#123;id&#125;/&#123;isFollow&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">follow</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long followUserId, <span class="meta">@PathVariable(&quot;isFollow&quot;)</span> Boolean isFollow)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> followService.follow(followUserId, isFollow);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å–æ¶ˆå…³æ³¨</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/or/not/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">isFollow</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long followUserId)</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> followService.isFollow(followUserId);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>FollowService</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">å–æ¶ˆå…³æ³¨service</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">isFollow</span><span class="params">(Long followUserId)</span> &#123;</span><br><span class="line">        <span class="comment">// 1.è·å–ç™»å½•ç”¨æˆ·</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> UserHolder.getUser().getId();</span><br><span class="line">        <span class="comment">// 2.æŸ¥è¯¢æ˜¯å¦å…³æ³¨ select count(*) from tb_follow where user_id = ? and follow_user_id = ?</span></span><br><span class="line">        <span class="type">Integer</span> <span class="variable">count</span> <span class="operator">=</span> query().eq(<span class="string">&quot;user_id&quot;</span>, userId).eq(<span class="string">&quot;follow_user_id&quot;</span>, followUserId).count();</span><br><span class="line">        <span class="comment">// 3.åˆ¤æ–­</span></span><br><span class="line">        <span class="keyword">return</span> Result.ok(count &gt; <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"> å…³æ³¨service</span><br><span class="line"> <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">follow</span><span class="params">(Long followUserId, Boolean isFollow)</span> &#123;</span><br><span class="line">        <span class="comment">// 1.è·å–ç™»å½•ç”¨æˆ·</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> UserHolder.getUser().getId();</span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> <span class="string">&quot;follows:&quot;</span> + userId;</span><br><span class="line">        <span class="comment">// 1.åˆ¤æ–­åˆ°åº•æ˜¯å…³æ³¨è¿˜æ˜¯å–å…³</span></span><br><span class="line">        <span class="keyword">if</span> (isFollow) &#123;</span><br><span class="line">            <span class="comment">// 2.å…³æ³¨ï¼Œæ–°å¢æ•°æ®</span></span><br><span class="line">            <span class="type">Follow</span> <span class="variable">follow</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Follow</span>();</span><br><span class="line">            follow.setUserId(userId);</span><br><span class="line">            follow.setFollowUserId(followUserId);</span><br><span class="line">            <span class="type">boolean</span> <span class="variable">isSuccess</span> <span class="operator">=</span> save(follow);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 3.å–å…³ï¼Œåˆ é™¤ delete from tb_follow where user_id = ? and follow_user_id = ?</span></span><br><span class="line">            remove(<span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;Follow&gt;()</span><br><span class="line">                    .eq(<span class="string">&quot;user_id&quot;</span>, userId).eq(<span class="string">&quot;follow_user_id&quot;</span>, followUserId));</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> Result.ok();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="9-2-å¥½å‹å…³æ³¨-å…±åŒå…³æ³¨">9.2 å¥½å‹å…³æ³¨-å…±åŒå…³æ³¨</h3><p>æƒ³è¦å»çœ‹å…±åŒå…³æ³¨çš„å¥½å‹ï¼Œéœ€è¦é¦–å…ˆè¿›å…¥åˆ°è¿™ä¸ªé¡µé¢ï¼Œè¿™ä¸ªé¡µé¢ä¼šå‘èµ·ä¸¤ä¸ªè¯·æ±‚</p><p>1ã€å»æŸ¥è¯¢ç”¨æˆ·çš„è¯¦æƒ…</p><p>2ã€å»æŸ¥è¯¢ç”¨æˆ·çš„ç¬”è®°</p><p>ä»¥ä¸Šä¸¤ä¸ªåŠŸèƒ½å’Œå…±åŒå…³æ³¨æ²¡æœ‰ä»€ä¹ˆå…³ç³»ï¼Œå¤§å®¶å¯ä»¥è‡ªè¡Œå°†ç¬”è®°ä¸­çš„ä»£ç æ‹·è´åˆ°ideaä¸­å°±å¯ä»¥å®ç°è¿™ä¸¤ä¸ªåŠŸèƒ½äº†ï¼Œæˆ‘ä»¬çš„é‡ç‚¹åœ¨äºå…±åŒå…³æ³¨åŠŸèƒ½ã€‚</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/1653806706296.png" alt="1653806706296"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// UserController æ ¹æ®idæŸ¥è¯¢ç”¨æˆ·</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">queryUserById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long userId)</span>&#123;</span><br><span class="line"><span class="comment">// æŸ¥è¯¢è¯¦æƒ…</span></span><br><span class="line"><span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userService.getById(userId);</span><br><span class="line"><span class="keyword">if</span> (user == <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> Result.ok();</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">UserDTO</span> <span class="variable">userDTO</span> <span class="operator">=</span> BeanUtil.copyProperties(user, UserDTO.class);</span><br><span class="line"><span class="comment">// è¿”å›</span></span><br><span class="line"><span class="keyword">return</span> Result.ok(userDTO);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// BlogController  æ ¹æ®idæŸ¥è¯¢åšä¸»çš„æ¢åº—ç¬”è®°</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/of/user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">queryBlogByUserId</span><span class="params">(</span></span><br><span class="line"><span class="params"><span class="meta">@RequestParam(value = &quot;current&quot;, defaultValue = &quot;1&quot;)</span> Integer current,</span></span><br><span class="line"><span class="params"><span class="meta">@RequestParam(&quot;id&quot;)</span> Long id)</span> &#123;</span><br><span class="line"><span class="comment">// æ ¹æ®ç”¨æˆ·æŸ¥è¯¢</span></span><br><span class="line">Page&lt;Blog&gt; page = blogService.query()</span><br><span class="line">.eq(<span class="string">&quot;user_id&quot;</span>, id).page(<span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(current, SystemConstants.MAX_PAGE_SIZE));</span><br><span class="line"><span class="comment">// è·å–å½“å‰é¡µæ•°æ®</span></span><br><span class="line">List&lt;Blog&gt; records = page.getRecords();</span><br><span class="line"><span class="keyword">return</span> Result.ok(records);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹çœ‹å…±åŒå…³æ³¨å¦‚ä½•å®ç°ï¼š</p><p>éœ€æ±‚ï¼šåˆ©ç”¨Redisä¸­æ°å½“çš„æ•°æ®ç»“æ„ï¼Œå®ç°å…±åŒå…³æ³¨åŠŸèƒ½ã€‚åœ¨åšä¸»ä¸ªäººé¡µé¢å±•ç¤ºå‡ºå½“å‰ç”¨æˆ·ä¸åšä¸»çš„å…±åŒå…³æ³¨å‘¢ã€‚</p><p>å½“ç„¶æ˜¯ä½¿ç”¨æˆ‘ä»¬ä¹‹å‰å­¦ä¹ è¿‡çš„seté›†åˆå’¯ï¼Œåœ¨seté›†åˆä¸­ï¼Œæœ‰äº¤é›†å¹¶é›†è¡¥é›†çš„apiï¼Œæˆ‘ä»¬å¯ä»¥æŠŠä¸¤äººçš„å…³æ³¨çš„äººåˆ†åˆ«æ”¾å…¥åˆ°ä¸€ä¸ªseté›†åˆä¸­ï¼Œç„¶åå†é€šè¿‡apiå»æŸ¥çœ‹è¿™ä¸¤ä¸ªseté›†åˆä¸­çš„äº¤é›†æ•°æ®ã€‚</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/1653806973212.png" alt="1653806973212"></p><p>æˆ‘ä»¬å…ˆæ¥æ”¹é€ å½“å‰çš„å…³æ³¨åˆ—è¡¨</p><p>æ”¹é€ åŸå› æ˜¯å› ä¸ºæˆ‘ä»¬éœ€è¦åœ¨ç”¨æˆ·å…³æ³¨äº†æŸä½ç”¨æˆ·åï¼Œéœ€è¦å°†æ•°æ®æ”¾å…¥åˆ°seté›†åˆä¸­ï¼Œæ–¹ä¾¿åç»­è¿›è¡Œå…±åŒå…³æ³¨ï¼ŒåŒæ—¶å½“å–æ¶ˆå…³æ³¨æ—¶ï¼Œä¹Ÿéœ€è¦ä»seté›†åˆä¸­è¿›è¡Œåˆ é™¤</p><p>FollowServiceImpl</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">follow</span><span class="params">(Long followUserId, Boolean isFollow)</span> &#123;</span><br><span class="line">    <span class="comment">// 1.è·å–ç™»å½•ç”¨æˆ·</span></span><br><span class="line">    <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> UserHolder.getUser().getId();</span><br><span class="line">    <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> <span class="string">&quot;follows:&quot;</span> + userId;</span><br><span class="line">    <span class="comment">// 1.åˆ¤æ–­åˆ°åº•æ˜¯å…³æ³¨è¿˜æ˜¯å–å…³</span></span><br><span class="line">    <span class="keyword">if</span> (isFollow) &#123;</span><br><span class="line">        <span class="comment">// 2.å…³æ³¨ï¼Œæ–°å¢æ•°æ®</span></span><br><span class="line">        <span class="type">Follow</span> <span class="variable">follow</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Follow</span>();</span><br><span class="line">        follow.setUserId(userId);</span><br><span class="line">        follow.setFollowUserId(followUserId);</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">isSuccess</span> <span class="operator">=</span> save(follow);</span><br><span class="line">        <span class="keyword">if</span> (isSuccess) &#123;</span><br><span class="line">            <span class="comment">// æŠŠå…³æ³¨ç”¨æˆ·çš„idï¼Œæ”¾å…¥redisçš„seté›†åˆ sadd userId followerUserId</span></span><br><span class="line">            stringRedisTemplate.opsForSet().add(key, followUserId.toString());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 3.å–å…³ï¼Œåˆ é™¤ delete from tb_follow where user_id = ? and follow_user_id = ?</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">isSuccess</span> <span class="operator">=</span> remove(<span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;Follow&gt;()</span><br><span class="line">                .eq(<span class="string">&quot;user_id&quot;</span>, userId).eq(<span class="string">&quot;follow_user_id&quot;</span>, followUserId));</span><br><span class="line">        <span class="keyword">if</span> (isSuccess) &#123;</span><br><span class="line">            <span class="comment">// æŠŠå…³æ³¨ç”¨æˆ·çš„idä»Redisé›†åˆä¸­ç§»é™¤</span></span><br><span class="line">            stringRedisTemplate.opsForSet().remove(key, followUserId.toString());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> Result.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å…·ä½“çš„å…³æ³¨ä»£ç ï¼š</strong></p><p>FollowServiceImpl</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">followCommons</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">    <span class="comment">// 1.è·å–å½“å‰ç”¨æˆ·</span></span><br><span class="line">    <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> UserHolder.getUser().getId();</span><br><span class="line">    <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> <span class="string">&quot;follows:&quot;</span> + userId;</span><br><span class="line">    <span class="comment">// 2.æ±‚äº¤é›†</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">key2</span> <span class="operator">=</span> <span class="string">&quot;follows:&quot;</span> + id;</span><br><span class="line">    Set&lt;String&gt; intersect = stringRedisTemplate.opsForSet().intersect(key, key2);</span><br><span class="line">    <span class="keyword">if</span> (intersect == <span class="literal">null</span> || intersect.isEmpty()) &#123;</span><br><span class="line">        <span class="comment">// æ— äº¤é›†</span></span><br><span class="line">        <span class="keyword">return</span> Result.ok(Collections.emptyList());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 3.è§£æidé›†åˆ</span></span><br><span class="line">    List&lt;Long&gt; ids = intersect.stream().map(Long::valueOf).collect(Collectors.toList());</span><br><span class="line">    <span class="comment">// 4.æŸ¥è¯¢ç”¨æˆ·</span></span><br><span class="line">    List&lt;UserDTO&gt; users = userService.listByIds(ids)</span><br><span class="line">            .stream()</span><br><span class="line">            .map(user -&gt; BeanUtil.copyProperties(user, UserDTO.class))</span><br><span class="line">            .collect(Collectors.toList());</span><br><span class="line">    <span class="keyword">return</span> Result.ok(users);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="9-3-å¥½å‹å…³æ³¨-Feedæµå®ç°æ–¹æ¡ˆ">9.3 å¥½å‹å…³æ³¨-Feedæµå®ç°æ–¹æ¡ˆ</h3><p>å½“æˆ‘ä»¬å…³æ³¨äº†ç”¨æˆ·åï¼Œè¿™ä¸ªç”¨æˆ·å‘äº†åŠ¨æ€ï¼Œé‚£ä¹ˆæˆ‘ä»¬åº”è¯¥æŠŠè¿™äº›æ•°æ®æ¨é€ç»™ç”¨æˆ·ï¼Œè¿™ä¸ªéœ€æ±‚ï¼Œå…¶å®æˆ‘ä»¬åˆæŠŠä»–å«åšFeedæµï¼Œå…³æ³¨æ¨é€ä¹Ÿå«åšFeedæµï¼Œç›´è¯‘ä¸ºæŠ•å–‚ã€‚ä¸ºç”¨æˆ·æŒç»­çš„æä¾›â€œæ²‰æµ¸å¼â€çš„ä½“éªŒï¼Œé€šè¿‡æ— é™ä¸‹æ‹‰åˆ·æ–°è·å–æ–°çš„ä¿¡æ¯ã€‚</p><p>å¯¹äºä¼ ç»Ÿçš„æ¨¡å¼çš„å†…å®¹è§£é”ï¼šæˆ‘ä»¬æ˜¯éœ€è¦ç”¨æˆ·å»é€šè¿‡æœç´¢å¼•æ“æˆ–è€…æ˜¯å…¶ä»–çš„æ–¹å¼å»è§£é”æƒ³è¦çœ‹çš„å†…å®¹</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/1653808641260.png" alt="1653808641260"></p><p>å¯¹äºæ–°å‹çš„Feedæµçš„çš„æ•ˆæœï¼šä¸éœ€è¦æˆ‘ä»¬ç”¨æˆ·å†å»æ¨é€ä¿¡æ¯ï¼Œè€Œæ˜¯ç³»ç»Ÿåˆ†æç”¨æˆ·åˆ°åº•æƒ³è¦ä»€ä¹ˆï¼Œç„¶åç›´æ¥æŠŠå†…å®¹æ¨é€ç»™ç”¨æˆ·ï¼Œä»è€Œä½¿ç”¨æˆ·èƒ½å¤Ÿæ›´åŠ çš„èŠ‚çº¦æ—¶é—´ï¼Œä¸ç”¨ä¸»åŠ¨å»å¯»æ‰¾ã€‚</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/1653808993693.png" alt="1653808993693"></p><p>Feedæµçš„å®ç°æœ‰ä¸¤ç§æ¨¡å¼ï¼š</p><p>Feedæµäº§å“æœ‰ä¸¤ç§å¸¸è§æ¨¡å¼ï¼š<br>Timelineï¼šä¸åšå†…å®¹ç­›é€‰ï¼Œç®€å•çš„æŒ‰ç…§å†…å®¹å‘å¸ƒæ—¶é—´æ’åºï¼Œå¸¸ç”¨äºå¥½å‹æˆ–å…³æ³¨ã€‚ä¾‹å¦‚æœ‹å‹åœˆ</p><ul><li>ä¼˜ç‚¹ï¼šä¿¡æ¯å…¨é¢ï¼Œä¸ä¼šæœ‰ç¼ºå¤±ã€‚å¹¶ä¸”å®ç°ä¹Ÿç›¸å¯¹ç®€å•</li><li>ç¼ºç‚¹ï¼šä¿¡æ¯å™ªéŸ³è¾ƒå¤šï¼Œç”¨æˆ·ä¸ä¸€å®šæ„Ÿå…´è¶£ï¼Œå†…å®¹è·å–æ•ˆç‡ä½</li></ul><p>æ™ºèƒ½æ’åºï¼šåˆ©ç”¨æ™ºèƒ½ç®—æ³•å±è”½æ‰è¿è§„çš„ã€ç”¨æˆ·ä¸æ„Ÿå…´è¶£çš„å†…å®¹ã€‚æ¨é€ç”¨æˆ·æ„Ÿå…´è¶£ä¿¡æ¯æ¥å¸å¼•ç”¨æˆ·</p><ul><li>ä¼˜ç‚¹ï¼šæŠ•å–‚ç”¨æˆ·æ„Ÿå…´è¶£ä¿¡æ¯ï¼Œç”¨æˆ·ç²˜åº¦å¾ˆé«˜ï¼Œå®¹æ˜“æ²‰è¿·</li><li>ç¼ºç‚¹ï¼šå¦‚æœç®—æ³•ä¸ç²¾å‡†ï¼Œå¯èƒ½èµ·åˆ°åä½œç”¨<br>æœ¬ä¾‹ä¸­çš„ä¸ªäººé¡µé¢ï¼Œæ˜¯åŸºäºå…³æ³¨çš„å¥½å‹æ¥åšFeedæµï¼Œå› æ­¤é‡‡ç”¨Timelineçš„æ¨¡å¼ã€‚è¯¥æ¨¡å¼çš„å®ç°æ–¹æ¡ˆæœ‰ä¸‰ç§ï¼š</li></ul><p>æˆ‘ä»¬æœ¬æ¬¡é’ˆå¯¹å¥½å‹çš„æ“ä½œï¼Œé‡‡ç”¨çš„å°±æ˜¯Timelineçš„æ–¹å¼ï¼Œåªéœ€è¦æ‹¿åˆ°æˆ‘ä»¬å…³æ³¨ç”¨æˆ·çš„ä¿¡æ¯ï¼Œç„¶åæŒ‰ç…§æ—¶é—´æ’åºå³å¯</p><p>ï¼Œå› æ­¤é‡‡ç”¨Timelineçš„æ¨¡å¼ã€‚è¯¥æ¨¡å¼çš„å®ç°æ–¹æ¡ˆæœ‰ä¸‰ç§ï¼š</p><ul><li>æ‹‰æ¨¡å¼</li><li>æ¨æ¨¡å¼</li><li>æ¨æ‹‰ç»“åˆ</li></ul><p><strong>æ‹‰æ¨¡å¼</strong>ï¼šä¹Ÿå«åšè¯»æ‰©æ•£</p><p>è¯¥æ¨¡å¼çš„æ ¸å¿ƒå«ä¹‰å°±æ˜¯ï¼šå½“å¼ ä¸‰å’Œæå››å’Œç‹äº”å‘äº†æ¶ˆæ¯åï¼Œéƒ½ä¼šä¿å­˜åœ¨è‡ªå·±çš„é‚®ç®±ä¸­ï¼Œå‡è®¾èµµå…­è¦è¯»å–ä¿¡æ¯ï¼Œé‚£ä¹ˆä»–ä¼šä»è¯»å–ä»–è‡ªå·±çš„æ”¶ä»¶ç®±ï¼Œæ­¤æ—¶ç³»ç»Ÿä¼šä»ä»–å…³æ³¨çš„äººç¾¤ä¸­ï¼ŒæŠŠä»–å…³æ³¨äººçš„ä¿¡æ¯å…¨éƒ¨éƒ½è¿›è¡Œæ‹‰å–ï¼Œç„¶ååœ¨è¿›è¡Œæ’åº</p><p>ä¼˜ç‚¹ï¼šæ¯”è¾ƒèŠ‚çº¦ç©ºé—´ï¼Œå› ä¸ºèµµå…­åœ¨è¯»ä¿¡æ¯æ—¶ï¼Œå¹¶æ²¡æœ‰é‡å¤è¯»å–ï¼Œè€Œä¸”è¯»å–å®Œä¹‹åå¯ä»¥æŠŠä»–çš„æ”¶ä»¶ç®±è¿›è¡Œæ¸…æ¥šã€‚</p><p>ç¼ºç‚¹ï¼šæ¯”è¾ƒå»¶è¿Ÿï¼Œå½“ç”¨æˆ·è¯»å–æ•°æ®æ—¶æ‰å»å…³æ³¨çš„äººé‡Œè¾¹å»è¯»å–æ•°æ®ï¼Œå‡è®¾ç”¨æˆ·å…³æ³¨äº†å¤§é‡çš„ç”¨æˆ·ï¼Œé‚£ä¹ˆæ­¤æ—¶å°±ä¼šæ‹‰å–æµ·é‡çš„å†…å®¹ï¼Œå¯¹æœåŠ¡å™¨å‹åŠ›å·¨å¤§ã€‚</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/1653809450816.png" alt="1653809450816"></p><p><strong>æ¨æ¨¡å¼</strong>ï¼šä¹Ÿå«åšå†™æ‰©æ•£ã€‚</p><p>æ¨æ¨¡å¼æ˜¯æ²¡æœ‰å†™é‚®ç®±çš„ï¼Œå½“å¼ ä¸‰å†™äº†ä¸€ä¸ªå†…å®¹ï¼Œæ­¤æ—¶ä¼šä¸»åŠ¨çš„æŠŠå¼ ä¸‰å†™çš„å†…å®¹å‘é€åˆ°ä»–çš„ç²‰ä¸æ”¶ä»¶ç®±ä¸­å»ï¼Œå‡è®¾æ­¤æ—¶æå››å†æ¥è¯»å–ï¼Œå°±ä¸ç”¨å†å»ä¸´æ—¶æ‹‰å–äº†</p><p>ä¼˜ç‚¹ï¼šæ—¶æ•ˆå¿«ï¼Œä¸ç”¨ä¸´æ—¶æ‹‰å–</p><p>ç¼ºç‚¹ï¼šå†…å­˜å‹åŠ›å¤§ï¼Œå‡è®¾ä¸€ä¸ªå¤§Vå†™ä¿¡æ¯ï¼Œå¾ˆå¤šäººå…³æ³¨ä»–ï¼Œ å°±ä¼šå†™å¾ˆå¤šåˆ†æ•°æ®åˆ°ç²‰ä¸é‚£è¾¹å»</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/1653809875208.png" alt="1653809875208"></p><p><strong>æ¨æ‹‰ç»“åˆæ¨¡å¼</strong>ï¼šä¹Ÿå«åšè¯»å†™æ··åˆï¼Œå…¼å…·æ¨å’Œæ‹‰ä¸¤ç§æ¨¡å¼çš„ä¼˜ç‚¹ã€‚</p><p>æ¨æ‹‰æ¨¡å¼æ˜¯ä¸€ä¸ªæŠ˜ä¸­çš„æ–¹æ¡ˆï¼Œç«™åœ¨å‘ä»¶äººè¿™ä¸€æ®µï¼Œå¦‚æœæ˜¯ä¸ªæ™®é€šçš„äººï¼Œé‚£ä¹ˆæˆ‘ä»¬é‡‡ç”¨å†™æ‰©æ•£çš„æ–¹å¼ï¼Œç›´æ¥æŠŠæ•°æ®å†™å…¥åˆ°ä»–çš„ç²‰ä¸ä¸­å»ï¼Œå› ä¸ºæ™®é€šçš„äººä»–çš„ç²‰ä¸å…³æ³¨é‡æ¯”è¾ƒå°ï¼Œæ‰€ä»¥è¿™æ ·åšæ²¡æœ‰å‹åŠ›ï¼Œå¦‚æœæ˜¯å¤§Vï¼Œé‚£ä¹ˆä»–æ˜¯ç›´æ¥å°†æ•°æ®å…ˆå†™å…¥åˆ°ä¸€ä»½åˆ°å‘ä»¶ç®±é‡Œè¾¹å»ï¼Œç„¶åå†ç›´æ¥å†™ä¸€ä»½åˆ°æ´»è·ƒç²‰ä¸æ”¶ä»¶ç®±é‡Œè¾¹å»ï¼Œç°åœ¨ç«™åœ¨æ”¶ä»¶äººè¿™ç«¯æ¥çœ‹ï¼Œå¦‚æœæ˜¯æ´»è·ƒç²‰ä¸ï¼Œé‚£ä¹ˆå¤§Vå’Œæ™®é€šçš„äººå‘çš„éƒ½ä¼šç›´æ¥å†™å…¥åˆ°è‡ªå·±æ”¶ä»¶ç®±é‡Œè¾¹æ¥ï¼Œè€Œå¦‚æœæ˜¯æ™®é€šçš„ç²‰ä¸ï¼Œç”±äºä»–ä»¬ä¸Šçº¿ä¸æ˜¯å¾ˆé¢‘ç¹ï¼Œæ‰€ä»¥ç­‰ä»–ä»¬ä¸Šçº¿æ—¶ï¼Œå†ä»å‘ä»¶ç®±é‡Œè¾¹å»æ‹‰ä¿¡æ¯ã€‚</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/1653812346852.png" alt="1653812346852"></p><h3 id="9-4-å¥½å‹å…³æ³¨-æ¨é€åˆ°ç²‰ä¸æ”¶ä»¶ç®±">9.4 å¥½å‹å…³æ³¨-æ¨é€åˆ°ç²‰ä¸æ”¶ä»¶ç®±</h3><p>éœ€æ±‚ï¼š</p><ul><li>ä¿®æ”¹æ–°å¢æ¢åº—ç¬”è®°çš„ä¸šåŠ¡ï¼Œåœ¨ä¿å­˜blogåˆ°æ•°æ®åº“çš„åŒæ—¶ï¼Œæ¨é€åˆ°ç²‰ä¸çš„æ”¶ä»¶ç®±</li><li>æ”¶ä»¶ç®±æ»¡è¶³å¯ä»¥æ ¹æ®æ—¶é—´æˆ³æ’åºï¼Œå¿…é¡»ç”¨Redisçš„æ•°æ®ç»“æ„å®ç°</li><li>æŸ¥è¯¢æ”¶ä»¶ç®±æ•°æ®æ—¶ï¼Œå¯ä»¥å®ç°åˆ†é¡µæŸ¥è¯¢</li></ul><p>Feedæµä¸­çš„æ•°æ®ä¼šä¸æ–­æ›´æ–°ï¼Œæ‰€ä»¥æ•°æ®çš„è§’æ ‡ä¹Ÿåœ¨å˜åŒ–ï¼Œå› æ­¤ä¸èƒ½é‡‡ç”¨ä¼ ç»Ÿçš„åˆ†é¡µæ¨¡å¼ã€‚</p><p>ä¼ ç»Ÿäº†åˆ†é¡µåœ¨feedæµæ˜¯ä¸é€‚ç”¨çš„ï¼Œå› ä¸ºæˆ‘ä»¬çš„æ•°æ®ä¼šéšæ—¶å‘ç”Ÿå˜åŒ–</p><p>å‡è®¾åœ¨t1 æ—¶åˆ»ï¼Œæˆ‘ä»¬å»è¯»å–ç¬¬ä¸€é¡µï¼Œæ­¤æ—¶page = 1 ï¼Œsize = 5 ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ‹¿åˆ°çš„å°±æ˜¯10~6 è¿™å‡ æ¡è®°å½•ï¼Œå‡è®¾ç°åœ¨t2æ—¶å€™åˆå‘å¸ƒäº†ä¸€æ¡è®°å½•ï¼Œæ­¤æ—¶t3 æ—¶åˆ»ï¼Œæˆ‘ä»¬æ¥è¯»å–ç¬¬äºŒé¡µï¼Œè¯»å–ç¬¬äºŒé¡µä¼ å…¥çš„å‚æ•°æ˜¯page=2 ï¼Œsize=5 ï¼Œé‚£ä¹ˆæ­¤æ—¶è¯»å–åˆ°çš„ç¬¬äºŒé¡µå®é™…ä¸Šæ˜¯ä»6 å¼€å§‹ï¼Œç„¶åæ˜¯6~2 ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±è¯»å–åˆ°äº†é‡å¤çš„æ•°æ®ï¼Œæ‰€ä»¥feedæµçš„åˆ†é¡µï¼Œä¸èƒ½é‡‡ç”¨åŸå§‹æ–¹æ¡ˆæ¥åšã€‚</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/1653813047671.png" alt="1653813047671"></p><p>Feedæµçš„æ»šåŠ¨åˆ†é¡µ</p><p>æˆ‘ä»¬éœ€è¦è®°å½•æ¯æ¬¡æ“ä½œçš„æœ€åä¸€æ¡ï¼Œç„¶åä»è¿™ä¸ªä½ç½®å¼€å§‹å»è¯»å–æ•°æ®</p><p>ä¸¾ä¸ªä¾‹å­ï¼šæˆ‘ä»¬ä»t1æ—¶åˆ»å¼€å§‹ï¼Œæ‹¿ç¬¬ä¸€é¡µæ•°æ®ï¼Œæ‹¿åˆ°äº†10~6ï¼Œç„¶åè®°å½•ä¸‹å½“å‰æœ€åä¸€æ¬¡æ‹¿å–çš„è®°å½•ï¼Œå°±æ˜¯6ï¼Œt2æ—¶åˆ»å‘å¸ƒäº†æ–°çš„è®°å½•ï¼Œæ­¤æ—¶è¿™ä¸ª11æ”¾åˆ°æœ€é¡¶ä¸Šï¼Œä½†æ˜¯ä¸ä¼šå½±å“æˆ‘ä»¬ä¹‹å‰è®°å½•çš„6ï¼Œæ­¤æ—¶t3æ—¶åˆ»æ¥æ‹¿ç¬¬äºŒé¡µï¼Œç¬¬äºŒé¡µè¿™ä¸ªæ—¶å€™æ‹¿æ•°æ®ï¼Œè¿˜æ˜¯ä»6åä¸€ç‚¹çš„5å»æ‹¿ï¼Œå°±æ‹¿åˆ°äº†5-1çš„è®°å½•ã€‚æˆ‘ä»¬è¿™ä¸ªåœ°æ–¹å¯ä»¥é‡‡ç”¨sortedSetæ¥åšï¼Œå¯ä»¥è¿›è¡ŒèŒƒå›´æŸ¥è¯¢ï¼Œå¹¶ä¸”è¿˜å¯ä»¥è®°å½•å½“å‰è·å–æ•°æ®æ—¶é—´æˆ³æœ€å°å€¼ï¼Œå°±å¯ä»¥å®ç°æ»šåŠ¨åˆ†é¡µäº†</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/1653813462834.png" alt="1653813462834"></p><p>æ ¸å¿ƒçš„æ„æ€ï¼šå°±æ˜¯æˆ‘ä»¬åœ¨ä¿å­˜å®Œæ¢åº—ç¬”è®°åï¼Œè·å¾—åˆ°å½“å‰ç¬”è®°çš„ç²‰ä¸ï¼Œç„¶åæŠŠæ•°æ®æ¨é€åˆ°ç²‰ä¸çš„redisä¸­å»ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">saveBlog</span><span class="params">(Blog blog)</span> &#123;</span><br><span class="line">    <span class="comment">// 1.è·å–ç™»å½•ç”¨æˆ·</span></span><br><span class="line">    <span class="type">UserDTO</span> <span class="variable">user</span> <span class="operator">=</span> UserHolder.getUser();</span><br><span class="line">    blog.setUserId(user.getId());</span><br><span class="line">    <span class="comment">// 2.ä¿å­˜æ¢åº—ç¬”è®°</span></span><br><span class="line">    <span class="type">boolean</span> <span class="variable">isSuccess</span> <span class="operator">=</span> save(blog);</span><br><span class="line">    <span class="keyword">if</span>(!isSuccess)&#123;</span><br><span class="line">        <span class="keyword">return</span> Result.fail(<span class="string">&quot;æ–°å¢ç¬”è®°å¤±è´¥!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 3.æŸ¥è¯¢ç¬”è®°ä½œè€…çš„æ‰€æœ‰ç²‰ä¸ select * from tb_follow where follow_user_id = ?</span></span><br><span class="line">    List&lt;Follow&gt; follows = followService.query().eq(<span class="string">&quot;follow_user_id&quot;</span>, user.getId()).list();</span><br><span class="line">    <span class="comment">// 4.æ¨é€ç¬”è®°idç»™æ‰€æœ‰ç²‰ä¸</span></span><br><span class="line">    <span class="keyword">for</span> (Follow follow : follows) &#123;</span><br><span class="line">        <span class="comment">// 4.1.è·å–ç²‰ä¸id</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> follow.getUserId();</span><br><span class="line">        <span class="comment">// 4.2.æ¨é€</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> FEED_KEY + userId;</span><br><span class="line">        stringRedisTemplate.opsForZSet().add(key, blog.getId().toString(), System.currentTimeMillis());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 5.è¿”å›id</span></span><br><span class="line">    <span class="keyword">return</span> Result.ok(blog.getId());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="9-5å¥½å‹å…³æ³¨-å®ç°åˆ†é¡µæŸ¥è¯¢æ”¶é‚®ç®±">9.5å¥½å‹å…³æ³¨-å®ç°åˆ†é¡µæŸ¥è¯¢æ”¶é‚®ç®±</h3><p>éœ€æ±‚ï¼šåœ¨ä¸ªäººä¸»é¡µçš„â€œå…³æ³¨â€å¡ç‰‡ä¸­ï¼ŒæŸ¥è¯¢å¹¶å±•ç¤ºæ¨é€çš„Blogä¿¡æ¯ï¼š</p><p>å…·ä½“æ“ä½œå¦‚ä¸‹ï¼š</p><p>1ã€æ¯æ¬¡æŸ¥è¯¢å®Œæˆåï¼Œæˆ‘ä»¬è¦åˆ†æå‡ºæŸ¥è¯¢å‡ºæ•°æ®çš„æœ€å°æ—¶é—´æˆ³ï¼Œè¿™ä¸ªå€¼ä¼šä½œä¸ºä¸‹ä¸€æ¬¡æŸ¥è¯¢çš„æ¡ä»¶</p><p>2ã€æˆ‘ä»¬éœ€è¦æ‰¾åˆ°ä¸ä¸Šä¸€æ¬¡æŸ¥è¯¢ç›¸åŒçš„æŸ¥è¯¢ä¸ªæ•°ä½œä¸ºåç§»é‡ï¼Œä¸‹æ¬¡æŸ¥è¯¢æ—¶ï¼Œè·³è¿‡è¿™äº›æŸ¥è¯¢è¿‡çš„æ•°æ®ï¼Œæ‹¿åˆ°æˆ‘ä»¬éœ€è¦çš„æ•°æ®</p><p>ç»¼ä¸Šï¼šæˆ‘ä»¬çš„è¯·æ±‚å‚æ•°ä¸­å°±éœ€è¦æºå¸¦ lastIdï¼šä¸Šä¸€æ¬¡æŸ¥è¯¢çš„æœ€å°æ—¶é—´æˆ³ å’Œåç§»é‡è¿™ä¸¤ä¸ªå‚æ•°ã€‚</p><p>è¿™ä¸¤ä¸ªå‚æ•°ç¬¬ä¸€æ¬¡ä¼šç”±å‰ç«¯æ¥æŒ‡å®šï¼Œä»¥åçš„æŸ¥è¯¢å°±æ ¹æ®åå°ç»“æœä½œä¸ºæ¡ä»¶ï¼Œå†æ¬¡ä¼ é€’åˆ°åå°ã€‚</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/1653819821591.png" alt="1653819821591"></p><p>ä¸€ã€å®šä¹‰å‡ºæ¥å…·ä½“çš„è¿”å›å€¼å®ä½“ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ScrollResult</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;?&gt; list;</span><br><span class="line">    <span class="keyword">private</span> Long minTime;</span><br><span class="line">    <span class="keyword">private</span> Integer offset;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>BlogController</p><p>æ³¨æ„ï¼šRequestParam è¡¨ç¤ºæ¥å—urlåœ°å€æ ä¼ å‚çš„æ³¨è§£ï¼Œå½“æ–¹æ³•ä¸Šå‚æ•°çš„åç§°å’Œurlåœ°å€æ ä¸ç›¸åŒæ—¶ï¼Œå¯ä»¥é€šè¿‡RequestParam æ¥è¿›è¡ŒæŒ‡å®š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/of/follow&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">queryBlogOfFollow</span><span class="params">(</span></span><br><span class="line"><span class="params">    <span class="meta">@RequestParam(&quot;lastId&quot;)</span> Long max, <span class="meta">@RequestParam(value = &quot;offset&quot;, defaultValue = &quot;0&quot;)</span> Integer offset)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> blogService.queryBlogOfFollow(max, offset);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>BlogServiceImpl</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">queryBlogOfFollow</span><span class="params">(Long max, Integer offset)</span> &#123;</span><br><span class="line">    <span class="comment">// 1.è·å–å½“å‰ç”¨æˆ·</span></span><br><span class="line">    <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> UserHolder.getUser().getId();</span><br><span class="line">    <span class="comment">// 2.æŸ¥è¯¢æ”¶ä»¶ç®± ZREVRANGEBYSCORE key Max Min LIMIT offset count</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> FEED_KEY + userId;</span><br><span class="line">    Set&lt;ZSetOperations.TypedTuple&lt;String&gt;&gt; typedTuples = stringRedisTemplate.opsForZSet()</span><br><span class="line">        .reverseRangeByScoreWithScores(key, <span class="number">0</span>, max, offset, <span class="number">2</span>);</span><br><span class="line">    <span class="comment">// 3.éç©ºåˆ¤æ–­</span></span><br><span class="line">    <span class="keyword">if</span> (typedTuples == <span class="literal">null</span> || typedTuples.isEmpty()) &#123;</span><br><span class="line">        <span class="keyword">return</span> Result.ok();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 4.è§£ææ•°æ®ï¼šblogIdã€minTimeï¼ˆæ—¶é—´æˆ³ï¼‰ã€offset</span></span><br><span class="line">    List&lt;Long&gt; ids = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(typedTuples.size());</span><br><span class="line">    <span class="type">long</span> <span class="variable">minTime</span> <span class="operator">=</span> <span class="number">0</span>; <span class="comment">// 2</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">os</span> <span class="operator">=</span> <span class="number">1</span>; <span class="comment">// 2</span></span><br><span class="line">    <span class="keyword">for</span> (ZSetOperations.TypedTuple&lt;String&gt; tuple : typedTuples) &#123; <span class="comment">// 5 4 4 2 2</span></span><br><span class="line">        <span class="comment">// 4.1.è·å–id</span></span><br><span class="line">        ids.add(Long.valueOf(tuple.getValue()));</span><br><span class="line">        <span class="comment">// 4.2.è·å–åˆ†æ•°(æ—¶é—´æˆ³ï¼‰</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">time</span> <span class="operator">=</span> tuple.getScore().longValue();</span><br><span class="line">        <span class="keyword">if</span>(time == minTime)&#123;</span><br><span class="line">            os++;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            minTime = time;</span><br><span class="line">            os = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">os = minTime == max ? os : os + offset;</span><br><span class="line">    <span class="comment">// 5.æ ¹æ®idæŸ¥è¯¢blog</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">idStr</span> <span class="operator">=</span> StrUtil.join(<span class="string">&quot;,&quot;</span>, ids);</span><br><span class="line">    List&lt;Blog&gt; blogs = query().in(<span class="string">&quot;id&quot;</span>, ids).last(<span class="string">&quot;ORDER BY FIELD(id,&quot;</span> + idStr + <span class="string">&quot;)&quot;</span>).list();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (Blog blog : blogs) &#123;</span><br><span class="line">        <span class="comment">// 5.1.æŸ¥è¯¢blogæœ‰å…³çš„ç”¨æˆ·</span></span><br><span class="line">        queryBlogUser(blog);</span><br><span class="line">        <span class="comment">// 5.2.æŸ¥è¯¢blogæ˜¯å¦è¢«ç‚¹èµ</span></span><br><span class="line">        isBlogLiked(blog);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 6.å°è£…å¹¶è¿”å›</span></span><br><span class="line">    <span class="type">ScrollResult</span> <span class="variable">r</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ScrollResult</span>();</span><br><span class="line">    r.setList(blogs);</span><br><span class="line">    r.setOffset(os);</span><br><span class="line">    r.setMinTime(minTime);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> Result.ok(r);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="10ã€é™„è¿‘å•†æˆ·">10ã€é™„è¿‘å•†æˆ·</h2><h3 id="10-1ã€é™„è¿‘å•†æˆ·-GEOæ•°æ®ç»“æ„çš„åŸºæœ¬ç”¨æ³•">10.1ã€é™„è¿‘å•†æˆ·-GEOæ•°æ®ç»“æ„çš„åŸºæœ¬ç”¨æ³•</h3><p>GEOå°±æ˜¯Geolocationçš„ç®€å†™å½¢å¼ï¼Œä»£è¡¨åœ°ç†åæ ‡ã€‚Redisåœ¨3.2ç‰ˆæœ¬ä¸­åŠ å…¥äº†å¯¹GEOçš„æ”¯æŒï¼Œå…è®¸å­˜å‚¨åœ°ç†åæ ‡ä¿¡æ¯ï¼Œå¸®åŠ©æˆ‘ä»¬æ ¹æ®ç»çº¬åº¦æ¥æ£€ç´¢æ•°æ®ã€‚å¸¸è§çš„å‘½ä»¤æœ‰ï¼š</p><ul><li>GEOADDï¼šæ·»åŠ ä¸€ä¸ªåœ°ç†ç©ºé—´ä¿¡æ¯ï¼ŒåŒ…å«ï¼šç»åº¦ï¼ˆlongitudeï¼‰ã€çº¬åº¦ï¼ˆlatitudeï¼‰ã€å€¼ï¼ˆmemberï¼‰</li><li>GEODISTï¼šè®¡ç®—æŒ‡å®šçš„ä¸¤ä¸ªç‚¹ä¹‹é—´çš„è·ç¦»å¹¶è¿”å›</li><li>GEOHASHï¼šå°†æŒ‡å®šmemberçš„åæ ‡è½¬ä¸ºhashå­—ç¬¦ä¸²å½¢å¼å¹¶è¿”å›</li><li>GEOPOSï¼šè¿”å›æŒ‡å®šmemberçš„åæ ‡</li><li>GEORADIUSï¼šæŒ‡å®šåœ†å¿ƒã€åŠå¾„ï¼Œæ‰¾åˆ°è¯¥åœ†å†…åŒ…å«çš„æ‰€æœ‰memberï¼Œå¹¶æŒ‰ç…§ä¸åœ†å¿ƒä¹‹é—´çš„è·ç¦»æ’åºåè¿”å›ã€‚6.ä»¥åå·²åºŸå¼ƒ</li><li>GEOSEARCHï¼šåœ¨æŒ‡å®šèŒƒå›´å†…æœç´¢memberï¼Œå¹¶æŒ‰ç…§ä¸æŒ‡å®šç‚¹ä¹‹é—´çš„è·ç¦»æ’åºåè¿”å›ã€‚èŒƒå›´å¯ä»¥æ˜¯åœ†å½¢æˆ–çŸ©å½¢ã€‚6.2.æ–°åŠŸèƒ½</li><li>GEOSEARCHSTOREï¼šä¸GEOSEARCHåŠŸèƒ½ä¸€è‡´ï¼Œä¸è¿‡å¯ä»¥æŠŠç»“æœå­˜å‚¨åˆ°ä¸€ä¸ªæŒ‡å®šçš„keyã€‚ 6.2.æ–°åŠŸèƒ½</li></ul><h3 id="10-2ã€-é™„è¿‘å•†æˆ·-å¯¼å…¥åº—é“ºæ•°æ®åˆ°GEO">10.2ã€ é™„è¿‘å•†æˆ·-å¯¼å…¥åº—é“ºæ•°æ®åˆ°GEO</h3><p>å…·ä½“åœºæ™¯è¯´æ˜ï¼š</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/1653822036941.png" alt="1653822036941"></p><p>å½“æˆ‘ä»¬ç‚¹å‡»ç¾é£Ÿä¹‹åï¼Œä¼šå‡ºç°ä¸€ç³»åˆ—çš„å•†å®¶ï¼Œå•†å®¶ä¸­å¯ä»¥æŒ‰ç…§å¤šç§æ’åºæ–¹å¼ï¼Œæˆ‘ä»¬æ­¤æ—¶å…³æ³¨çš„æ˜¯è·ç¦»ï¼Œè¿™ä¸ªåœ°æ–¹å°±éœ€è¦ä½¿ç”¨åˆ°æˆ‘ä»¬çš„GEOï¼Œå‘åå°ä¼ å…¥å½“å‰appæ”¶é›†çš„åœ°å€(æˆ‘ä»¬æ­¤å¤„æ˜¯å†™æ­»çš„) ï¼Œä»¥å½“å‰åæ ‡ä½œä¸ºåœ†å¿ƒï¼ŒåŒæ—¶ç»‘å®šç›¸åŒçš„åº—å®¶ç±»å‹typeï¼Œä»¥åŠåˆ†é¡µä¿¡æ¯ï¼ŒæŠŠè¿™å‡ ä¸ªæ¡ä»¶ä¼ å…¥åå°ï¼Œåå°æŸ¥è¯¢å‡ºå¯¹åº”çš„æ•°æ®å†è¿”å›ã€‚</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/1653822021827.png" alt="1653822021827"></p><p>æˆ‘ä»¬è¦åšçš„äº‹æƒ…æ˜¯ï¼šå°†æ•°æ®åº“è¡¨ä¸­çš„æ•°æ®å¯¼å…¥åˆ°redisä¸­å»ï¼Œredisä¸­çš„GEOï¼ŒGEOåœ¨redisä¸­å°±ä¸€ä¸ªmenberå’Œä¸€ä¸ªç»çº¬åº¦ï¼Œæˆ‘ä»¬æŠŠxå’Œyè½´ä¼ å…¥åˆ°redisåšçš„ç»çº¬åº¦ä½ç½®å»ï¼Œä½†æˆ‘ä»¬ä¸èƒ½æŠŠæ‰€æœ‰çš„æ•°æ®éƒ½æ”¾å…¥åˆ°menberä¸­å»ï¼Œæ¯•ç«Ÿä½œä¸ºredisæ˜¯ä¸€ä¸ªå†…å­˜çº§æ•°æ®åº“ï¼Œå¦‚æœå­˜æµ·é‡æ•°æ®ï¼Œredisè¿˜æ˜¯åŠ›ä¸ä»å¿ƒï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨è¿™ä¸ªåœ°æ–¹å­˜å‚¨ä»–çš„idå³å¯ã€‚</p><p>ä½†æ˜¯è¿™ä¸ªæ—¶å€™è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯åœ¨redisä¸­å¹¶æ²¡æœ‰å­˜å‚¨typeï¼Œæ‰€ä»¥æˆ‘ä»¬æ— æ³•æ ¹æ®typeæ¥å¯¹æ•°æ®è¿›è¡Œç­›é€‰ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æŒ‰ç…§å•†æˆ·ç±»å‹åšåˆ†ç»„ï¼Œç±»å‹ç›¸åŒçš„å•†æˆ·ä½œä¸ºåŒä¸€ç»„ï¼Œä»¥typeIdä¸ºkeyå­˜å…¥åŒä¸€ä¸ªGEOé›†åˆä¸­å³å¯</p><p>ä»£ç </p><p>HmDianPingApplicationTests</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">loadShopData</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// 1.æŸ¥è¯¢åº—é“ºä¿¡æ¯</span></span><br><span class="line">    List&lt;Shop&gt; list = shopService.list();</span><br><span class="line">    <span class="comment">// 2.æŠŠåº—é“ºåˆ†ç»„ï¼ŒæŒ‰ç…§typeIdåˆ†ç»„ï¼ŒtypeIdä¸€è‡´çš„æ”¾åˆ°ä¸€ä¸ªé›†åˆ</span></span><br><span class="line">    Map&lt;Long, List&lt;Shop&gt;&gt; map = list.stream().collect(Collectors.groupingBy(Shop::getTypeId));</span><br><span class="line">    <span class="comment">// 3.åˆ†æ‰¹å®Œæˆå†™å…¥Redis</span></span><br><span class="line">    <span class="keyword">for</span> (Map.Entry&lt;Long, List&lt;Shop&gt;&gt; entry : map.entrySet()) &#123;</span><br><span class="line">        <span class="comment">// 3.1.è·å–ç±»å‹id</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">typeId</span> <span class="operator">=</span> entry.getKey();</span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> SHOP_GEO_KEY + typeId;</span><br><span class="line">        <span class="comment">// 3.2.è·å–åŒç±»å‹çš„åº—é“ºçš„é›†åˆ</span></span><br><span class="line">        List&lt;Shop&gt; value = entry.getValue();</span><br><span class="line">        List&lt;RedisGeoCommands.GeoLocation&lt;String&gt;&gt; locations = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(value.size());</span><br><span class="line">        <span class="comment">// 3.3.å†™å…¥redis GEOADD key ç»åº¦ çº¬åº¦ member</span></span><br><span class="line">        <span class="keyword">for</span> (Shop shop : value) &#123;</span><br><span class="line">            <span class="comment">// stringRedisTemplate.opsForGeo().add(key, new Point(shop.getX(), shop.getY()), shop.getId().toString());</span></span><br><span class="line">            locations.add(<span class="keyword">new</span> <span class="title class_">RedisGeoCommands</span>.GeoLocation&lt;&gt;(</span><br><span class="line">                    shop.getId().toString(),</span><br><span class="line">                    <span class="keyword">new</span> <span class="title class_">Point</span>(shop.getX(), shop.getY())</span><br><span class="line">            ));</span><br><span class="line">        &#125;</span><br><span class="line">        stringRedisTemplate.opsForGeo().add(key, locations);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="10-3-é™„è¿‘å•†æˆ·-å®ç°é™„è¿‘å•†æˆ·åŠŸèƒ½">10.3 é™„è¿‘å•†æˆ·-å®ç°é™„è¿‘å•†æˆ·åŠŸèƒ½</h3><p>SpringDataRedisçš„2.3.9ç‰ˆæœ¬å¹¶ä¸æ”¯æŒRedis 6.2æä¾›çš„GEOSEARCHå‘½ä»¤ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦æç¤ºå…¶ç‰ˆæœ¬ï¼Œä¿®æ”¹è‡ªå·±çš„POM</p><p>ç¬¬ä¸€æ­¥ï¼šå¯¼å…¥pom</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;</span><br><span class="line">    &lt;exclusions&gt;</span><br><span class="line">        &lt;exclusion&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-data-redis&lt;/artifactId&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.data&lt;/groupId&gt;</span><br><span class="line">        &lt;/exclusion&gt;</span><br><span class="line">        &lt;exclusion&gt;</span><br><span class="line">            &lt;artifactId&gt;lettuce-core&lt;/artifactId&gt;</span><br><span class="line">            &lt;groupId&gt;io.lettuce&lt;/groupId&gt;</span><br><span class="line">        &lt;/exclusion&gt;</span><br><span class="line">    &lt;/exclusions&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.data&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-data-redis&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;<span class="number">2.6</span><span class="number">.2</span>&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;io.lettuce&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;lettuce-core&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;<span class="number">6.1</span><span class="number">.6</span>.RELEASE&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure><p>ç¬¬äºŒæ­¥ï¼š</p><p>ShopController</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/of/type&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">queryShopByType</span><span class="params">(</span></span><br><span class="line"><span class="params">        <span class="meta">@RequestParam(&quot;typeId&quot;)</span> Integer typeId,</span></span><br><span class="line"><span class="params">        <span class="meta">@RequestParam(value = &quot;current&quot;, defaultValue = &quot;1&quot;)</span> Integer current,</span></span><br><span class="line"><span class="params">        <span class="meta">@RequestParam(value = &quot;x&quot;, required = false)</span> Double x,</span></span><br><span class="line"><span class="params">        <span class="meta">@RequestParam(value = &quot;y&quot;, required = false)</span> Double y</span></span><br><span class="line"><span class="params">)</span> &#123;</span><br><span class="line">   <span class="keyword">return</span> shopService.queryShopByType(typeId, current, x, y);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ShopServiceImpl</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">queryShopByType</span><span class="params">(Integer typeId, Integer current, Double x, Double y)</span> &#123;</span><br><span class="line">        <span class="comment">// 1.åˆ¤æ–­æ˜¯å¦éœ€è¦æ ¹æ®åæ ‡æŸ¥è¯¢</span></span><br><span class="line">        <span class="keyword">if</span> (x == <span class="literal">null</span> || y == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">// ä¸éœ€è¦åæ ‡æŸ¥è¯¢ï¼ŒæŒ‰æ•°æ®åº“æŸ¥è¯¢</span></span><br><span class="line">            Page&lt;Shop&gt; page = query()</span><br><span class="line">                    .eq(<span class="string">&quot;type_id&quot;</span>, typeId)</span><br><span class="line">                    .page(<span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(current, SystemConstants.DEFAULT_PAGE_SIZE));</span><br><span class="line">            <span class="comment">// è¿”å›æ•°æ®</span></span><br><span class="line">            <span class="keyword">return</span> Result.ok(page.getRecords());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2.è®¡ç®—åˆ†é¡µå‚æ•°</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">from</span> <span class="operator">=</span> (current - <span class="number">1</span>) * SystemConstants.DEFAULT_PAGE_SIZE;</span><br><span class="line">        <span class="type">int</span> <span class="variable">end</span> <span class="operator">=</span> current * SystemConstants.DEFAULT_PAGE_SIZE;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3.æŸ¥è¯¢redisã€æŒ‰ç…§è·ç¦»æ’åºã€åˆ†é¡µã€‚ç»“æœï¼šshopIdã€distance</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> SHOP_GEO_KEY + typeId;</span><br><span class="line">        GeoResults&lt;RedisGeoCommands.GeoLocation&lt;String&gt;&gt; results = stringRedisTemplate.opsForGeo() <span class="comment">// GEOSEARCH key BYLONLAT x y BYRADIUS 10 WITHDISTANCE</span></span><br><span class="line">                .search(</span><br><span class="line">                        key,</span><br><span class="line">                        GeoReference.fromCoordinate(x, y),</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">Distance</span>(<span class="number">5000</span>),</span><br><span class="line">                        RedisGeoCommands.GeoSearchCommandArgs.newGeoSearchArgs().includeDistance().limit(end)</span><br><span class="line">                );</span><br><span class="line">        <span class="comment">// 4.è§£æå‡ºid</span></span><br><span class="line">        <span class="keyword">if</span> (results == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> Result.ok(Collections.emptyList());</span><br><span class="line">        &#125;</span><br><span class="line">        List&lt;GeoResult&lt;RedisGeoCommands.GeoLocation&lt;String&gt;&gt;&gt; list = results.getContent();</span><br><span class="line">        <span class="keyword">if</span> (list.size() &lt;= from) &#123;</span><br><span class="line">            <span class="comment">// æ²¡æœ‰ä¸‹ä¸€é¡µäº†ï¼Œç»“æŸ</span></span><br><span class="line">            <span class="keyword">return</span> Result.ok(Collections.emptyList());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 4.1.æˆªå– from ~ endçš„éƒ¨åˆ†</span></span><br><span class="line">        List&lt;Long&gt; ids = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(list.size());</span><br><span class="line">        Map&lt;String, Distance&gt; distanceMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;(list.size());</span><br><span class="line">        list.stream().skip(from).forEach(result -&gt; &#123;</span><br><span class="line">            <span class="comment">// 4.2.è·å–åº—é“ºid</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">shopIdStr</span> <span class="operator">=</span> result.getContent().getName();</span><br><span class="line">            ids.add(Long.valueOf(shopIdStr));</span><br><span class="line">            <span class="comment">// 4.3.è·å–è·ç¦»</span></span><br><span class="line">            <span class="type">Distance</span> <span class="variable">distance</span> <span class="operator">=</span> result.getDistance();</span><br><span class="line">            distanceMap.put(shopIdStr, distance);</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// 5.æ ¹æ®idæŸ¥è¯¢Shop</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">idStr</span> <span class="operator">=</span> StrUtil.join(<span class="string">&quot;,&quot;</span>, ids);</span><br><span class="line">        List&lt;Shop&gt; shops = query().in(<span class="string">&quot;id&quot;</span>, ids).last(<span class="string">&quot;ORDER BY FIELD(id,&quot;</span> + idStr + <span class="string">&quot;)&quot;</span>).list();</span><br><span class="line">        <span class="keyword">for</span> (Shop shop : shops) &#123;</span><br><span class="line">            shop.setDistance(distanceMap.get(shop.getId().toString()).getValue());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 6.è¿”å›</span></span><br><span class="line">        <span class="keyword">return</span> Result.ok(shops);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2 id="11ã€ç”¨æˆ·ç­¾åˆ°">11ã€ç”¨æˆ·ç­¾åˆ°</h2><h4 id="11-1ã€ç”¨æˆ·ç­¾åˆ°-BitMapåŠŸèƒ½æ¼”ç¤º">11.1ã€ç”¨æˆ·ç­¾åˆ°-BitMapåŠŸèƒ½æ¼”ç¤º</h4><p>æˆ‘ä»¬é’ˆå¯¹ç­¾åˆ°åŠŸèƒ½å®Œå…¨å¯ä»¥é€šè¿‡mysqlæ¥å®Œæˆï¼Œæ¯”å¦‚è¯´ä»¥ä¸‹è¿™å¼ è¡¨</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/1653823145495.png" alt="1653823145495"></p><p>ç”¨æˆ·ä¸€æ¬¡ç­¾åˆ°ï¼Œå°±æ˜¯ä¸€æ¡è®°å½•ï¼Œå‡å¦‚æœ‰1000ä¸‡ç”¨æˆ·ï¼Œå¹³å‡æ¯äººæ¯å¹´ç­¾åˆ°æ¬¡æ•°ä¸º10æ¬¡ï¼Œåˆ™è¿™å¼ è¡¨ä¸€å¹´çš„æ•°æ®é‡ä¸º 1äº¿æ¡</p><p>æ¯ç­¾åˆ°ä¸€æ¬¡éœ€è¦ä½¿ç”¨ï¼ˆ8 + 8 + 1 + 1 + 3 + 1ï¼‰å…±22 å­—èŠ‚çš„å†…å­˜ï¼Œä¸€ä¸ªæœˆåˆ™æœ€å¤šéœ€è¦600å¤šå­—èŠ‚</p><p>æˆ‘ä»¬å¦‚ä½•èƒ½å¤Ÿç®€åŒ–ä¸€ç‚¹å‘¢ï¼Ÿå…¶å®å¯ä»¥è€ƒè™‘å°æ—¶å€™ä¸€ä¸ªæŒºå¸¸è§çš„æ–¹æ¡ˆï¼Œå°±æ˜¯å°æ—¶å€™ï¼Œå’±ä»¬å‡†å¤‡ä¸€å¼ å°å°çš„å¡ç‰‡ï¼Œä½ åªè¦ç­¾åˆ°å°±æ‰“ä¸Šä¸€ä¸ªå‹¾ï¼Œæˆ‘æœ€ååˆ¤æ–­ä½ æ˜¯å¦ç­¾åˆ°ï¼Œå…¶å®åªéœ€è¦åˆ°å°å¡ç‰‡ä¸Šçœ‹ä¸€çœ‹å°±çŸ¥é“äº†</p><p>æˆ‘ä»¬å¯ä»¥é‡‡ç”¨ç±»ä¼¼è¿™æ ·çš„æ–¹æ¡ˆæ¥å®ç°æˆ‘ä»¬çš„ç­¾åˆ°éœ€æ±‚ã€‚</p><p>æˆ‘ä»¬æŒ‰æœˆæ¥ç»Ÿè®¡ç”¨æˆ·ç­¾åˆ°ä¿¡æ¯ï¼Œç­¾åˆ°è®°å½•ä¸º1ï¼Œæœªç­¾åˆ°åˆ™è®°å½•ä¸º0.</p><p>æŠŠæ¯ä¸€ä¸ªbitä½å¯¹åº”å½“æœˆçš„æ¯ä¸€å¤©ï¼Œå½¢æˆäº†æ˜ å°„å…³ç³»ã€‚ç”¨0å’Œ1æ ‡ç¤ºä¸šåŠ¡çŠ¶æ€ï¼Œè¿™ç§æ€è·¯å°±ç§°ä¸ºä½å›¾ï¼ˆBitMapï¼‰ã€‚è¿™æ ·æˆ‘ä»¬å°±ç”¨æå°çš„ç©ºé—´ï¼Œæ¥å®ç°äº†å¤§é‡æ•°æ®çš„è¡¨ç¤º</p><p>Redisä¸­æ˜¯åˆ©ç”¨stringç±»å‹æ•°æ®ç»“æ„å®ç°BitMapï¼Œå› æ­¤æœ€å¤§ä¸Šé™æ˜¯512Mï¼Œè½¬æ¢ä¸ºbitåˆ™æ˜¯ 2^32ä¸ªbitä½ã€‚</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/1653824498278.png" alt="1653824498278"></p><p>BitMapçš„æ“ä½œå‘½ä»¤æœ‰ï¼š</p><ul><li>SETBITï¼šå‘æŒ‡å®šä½ç½®ï¼ˆoffsetï¼‰å­˜å…¥ä¸€ä¸ª0æˆ–1</li><li>GETBIT ï¼šè·å–æŒ‡å®šä½ç½®ï¼ˆoffsetï¼‰çš„bitå€¼</li><li>BITCOUNT ï¼šç»Ÿè®¡BitMapä¸­å€¼ä¸º1çš„bitä½çš„æ•°é‡</li><li>BITFIELD ï¼šæ“ä½œï¼ˆæŸ¥è¯¢ã€ä¿®æ”¹ã€è‡ªå¢ï¼‰BitMapä¸­bitæ•°ç»„ä¸­çš„æŒ‡å®šä½ç½®ï¼ˆoffsetï¼‰çš„å€¼</li><li>BITFIELD_RO ï¼šè·å–BitMapä¸­bitæ•°ç»„ï¼Œå¹¶ä»¥åè¿›åˆ¶å½¢å¼è¿”å›</li><li>BITOP ï¼šå°†å¤šä¸ªBitMapçš„ç»“æœåšä½è¿ç®—ï¼ˆä¸ ã€æˆ–ã€å¼‚æˆ–ï¼‰</li><li>BITPOS ï¼šæŸ¥æ‰¾bitæ•°ç»„ä¸­æŒ‡å®šèŒƒå›´å†…ç¬¬ä¸€ä¸ª0æˆ–1å‡ºç°çš„ä½ç½®</li></ul><h4 id="11-2-ã€ç”¨æˆ·ç­¾åˆ°-å®ç°ç­¾åˆ°åŠŸèƒ½">11.2 ã€ç”¨æˆ·ç­¾åˆ°-å®ç°ç­¾åˆ°åŠŸèƒ½</h4><p>éœ€æ±‚ï¼šå®ç°ç­¾åˆ°æ¥å£ï¼Œå°†å½“å‰ç”¨æˆ·å½“å¤©ç­¾åˆ°ä¿¡æ¯ä¿å­˜åˆ°Redisä¸­</p><p>æ€è·¯ï¼šæˆ‘ä»¬å¯ä»¥æŠŠå¹´å’Œæœˆä½œä¸ºbitMapçš„keyï¼Œç„¶åä¿å­˜åˆ°ä¸€ä¸ªbitMapä¸­ï¼Œæ¯æ¬¡ç­¾åˆ°å°±åˆ°å¯¹åº”çš„ä½ä¸ŠæŠŠæ•°å­—ä»0å˜æˆ1ï¼Œåªè¦å¯¹åº”æ˜¯1ï¼Œå°±è¡¨æ˜è¯´æ˜è¿™ä¸€å¤©å·²ç»ç­¾åˆ°äº†ï¼Œåä¹‹åˆ™æ²¡æœ‰ç­¾åˆ°ã€‚</p><p>æˆ‘ä»¬é€šè¿‡æ¥å£æ–‡æ¡£å‘ç°ï¼Œæ­¤æ¥å£å¹¶æ²¡æœ‰ä¼ é€’ä»»ä½•çš„å‚æ•°ï¼Œæ²¡æœ‰å‚æ•°æ€ä¹ˆç¡®å®æ˜¯å“ªä¸€å¤©ç­¾åˆ°å‘¢ï¼Ÿè¿™ä¸ªå¾ˆå®¹æ˜“ï¼Œå¯ä»¥é€šè¿‡åå°ä»£ç ç›´æ¥è·å–å³å¯ï¼Œç„¶ååˆ°å¯¹åº”çš„åœ°å€ä¸Šå»ä¿®æ”¹bitMapã€‚</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/1653833970361.png" alt="1653833970361"></p><p><strong>ä»£ç </strong></p><p>UserController</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/sign&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">sign</span><span class="params">()</span>&#123;</span><br><span class="line">   <span class="keyword">return</span> userService.sign();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>UserServiceImpl</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">sign</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// 1.è·å–å½“å‰ç™»å½•ç”¨æˆ·</span></span><br><span class="line">    <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> UserHolder.getUser().getId();</span><br><span class="line">    <span class="comment">// 2.è·å–æ—¥æœŸ</span></span><br><span class="line">    <span class="type">LocalDateTime</span> <span class="variable">now</span> <span class="operator">=</span> LocalDateTime.now();</span><br><span class="line">    <span class="comment">// 3.æ‹¼æ¥key</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">keySuffix</span> <span class="operator">=</span> now.format(DateTimeFormatter.ofPattern(<span class="string">&quot;:yyyyMM&quot;</span>));</span><br><span class="line">    <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> USER_SIGN_KEY + userId + keySuffix;</span><br><span class="line">    <span class="comment">// 4.è·å–ä»Šå¤©æ˜¯æœ¬æœˆçš„ç¬¬å‡ å¤©</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">dayOfMonth</span> <span class="operator">=</span> now.getDayOfMonth();</span><br><span class="line">    <span class="comment">// 5.å†™å…¥Redis SETBIT key offset 1</span></span><br><span class="line">    stringRedisTemplate.opsForValue().setBit(key, dayOfMonth - <span class="number">1</span>, <span class="literal">true</span>);</span><br><span class="line">    <span class="keyword">return</span> Result.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="11-3-ç”¨æˆ·ç­¾åˆ°-ç­¾åˆ°ç»Ÿè®¡">11.3 ç”¨æˆ·ç­¾åˆ°-ç­¾åˆ°ç»Ÿè®¡</h4><p>**é—®é¢˜1ï¼š**ä»€ä¹ˆå«åšè¿ç»­ç­¾åˆ°å¤©æ•°ï¼Ÿ<br>ä»æœ€åä¸€æ¬¡ç­¾åˆ°å¼€å§‹å‘å‰ç»Ÿè®¡ï¼Œç›´åˆ°é‡åˆ°ç¬¬ä¸€æ¬¡æœªç­¾åˆ°ä¸ºæ­¢ï¼Œè®¡ç®—æ€»çš„ç­¾åˆ°æ¬¡æ•°ï¼Œå°±æ˜¯è¿ç»­ç­¾åˆ°å¤©æ•°ã€‚</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/1653834455899.png" alt="1653834455899"></p><p>Javaé€»è¾‘ä»£ç ï¼šè·å¾—å½“å‰è¿™ä¸ªæœˆçš„æœ€åä¸€æ¬¡ç­¾åˆ°æ•°æ®ï¼Œå®šä¹‰ä¸€ä¸ªè®¡æ•°å™¨ï¼Œç„¶åä¸åœçš„å‘å‰ç»Ÿè®¡ï¼Œç›´åˆ°è·å¾—ç¬¬ä¸€ä¸ªé0çš„æ•°å­—å³å¯ï¼Œæ¯å¾—åˆ°ä¸€ä¸ªé0çš„æ•°å­—è®¡æ•°å™¨+1ï¼Œç›´åˆ°éå†å®Œæ‰€æœ‰çš„æ•°æ®ï¼Œå°±å¯ä»¥è·å¾—å½“å‰æœˆçš„ç­¾åˆ°æ€»å¤©æ•°äº†</p><p>**é—®é¢˜2ï¼š**å¦‚ä½•å¾—åˆ°æœ¬æœˆåˆ°ä»Šå¤©ä¸ºæ­¢çš„æ‰€æœ‰ç­¾åˆ°æ•°æ®ï¼Ÿ</p><p>BITFIELD key GET u[dayOfMonth] 0</p><p>å‡è®¾ä»Šå¤©æ˜¯10å·ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ä»å½“å‰æœˆçš„ç¬¬ä¸€å¤©å¼€å§‹ï¼Œè·å¾—åˆ°å½“å‰è¿™ä¸€å¤©çš„ä½æ•°ï¼Œæ˜¯10å·ï¼Œé‚£ä¹ˆå°±æ˜¯10ä½ï¼Œå»æ‹¿è¿™æ®µæ—¶é—´çš„æ•°æ®ï¼Œå°±èƒ½æ‹¿åˆ°æ‰€æœ‰çš„æ•°æ®äº†ï¼Œé‚£ä¹ˆè¿™10å¤©é‡Œè¾¹ç­¾åˆ°äº†å¤šå°‘æ¬¡å‘¢ï¼Ÿç»Ÿè®¡æœ‰å¤šå°‘ä¸ª1å³å¯ã€‚</p><p><strong>é—®é¢˜3ï¼šå¦‚ä½•ä»åå‘å‰éå†æ¯ä¸ªbitä½ï¼Ÿ</strong></p><p>æ³¨æ„ï¼šbitMapè¿”å›çš„æ•°æ®æ˜¯10è¿›åˆ¶ï¼Œå“ªå‡å¦‚è¯´è¿”å›ä¸€ä¸ªæ•°å­—8ï¼Œé‚£ä¹ˆæˆ‘å“ªå„¿çŸ¥é“åˆ°åº•å“ªäº›æ˜¯0ï¼Œå“ªäº›æ˜¯1å‘¢ï¼Ÿæˆ‘ä»¬åªéœ€è¦è®©å¾—åˆ°çš„10è¿›åˆ¶æ•°å­—å’Œ1åšä¸è¿ç®—å°±å¯ä»¥äº†ï¼Œå› ä¸º1åªæœ‰é‡è§1 æ‰æ˜¯1ï¼Œå…¶ä»–æ•°å­—éƒ½æ˜¯0 ï¼Œæˆ‘ä»¬æŠŠç­¾åˆ°ç»“æœå’Œ1è¿›è¡Œä¸æ“ä½œï¼Œæ¯ä¸ä¸€æ¬¡ï¼Œå°±æŠŠç­¾åˆ°ç»“æœå‘å³ç§»åŠ¨ä¸€ä½ï¼Œä¾æ¬¡å†…æ¨ï¼Œæˆ‘ä»¬å°±èƒ½å®Œæˆé€ä¸ªéå†çš„æ•ˆæœäº†ã€‚</p><p>éœ€æ±‚ï¼šå®ç°ä¸‹é¢æ¥å£ï¼Œç»Ÿè®¡å½“å‰ç”¨æˆ·æˆªæ­¢å½“å‰æ—¶é—´åœ¨æœ¬æœˆçš„è¿ç»­ç­¾åˆ°å¤©æ•°</p><p>æœ‰ç”¨æˆ·æœ‰æ—¶é—´æˆ‘ä»¬å°±å¯ä»¥ç»„ç»‡å‡ºå¯¹åº”çš„keyï¼Œæ­¤æ—¶å°±èƒ½æ‰¾åˆ°è¿™ä¸ªç”¨æˆ·æˆªæ­¢è¿™å¤©çš„æ‰€æœ‰ç­¾åˆ°è®°å½•ï¼Œå†æ ¹æ®è¿™å¥—ç®—æ³•ï¼Œå°±èƒ½ç»Ÿè®¡å‡ºæ¥ä»–è¿ç»­ç­¾åˆ°çš„æ¬¡æ•°äº†</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/1653835784444.png" alt="1653835784444"></p><p>ä»£ç </p><p><strong>UserController</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/sign/count&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">signCount</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> userService.signCount();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>UserServiceImpl</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">signCount</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// 1.è·å–å½“å‰ç™»å½•ç”¨æˆ·</span></span><br><span class="line">    <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> UserHolder.getUser().getId();</span><br><span class="line">    <span class="comment">// 2.è·å–æ—¥æœŸ</span></span><br><span class="line">    <span class="type">LocalDateTime</span> <span class="variable">now</span> <span class="operator">=</span> LocalDateTime.now();</span><br><span class="line">    <span class="comment">// 3.æ‹¼æ¥key</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">keySuffix</span> <span class="operator">=</span> now.format(DateTimeFormatter.ofPattern(<span class="string">&quot;:yyyyMM&quot;</span>));</span><br><span class="line">    <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> USER_SIGN_KEY + userId + keySuffix;</span><br><span class="line">    <span class="comment">// 4.è·å–ä»Šå¤©æ˜¯æœ¬æœˆçš„ç¬¬å‡ å¤©</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">dayOfMonth</span> <span class="operator">=</span> now.getDayOfMonth();</span><br><span class="line">    <span class="comment">// 5.è·å–æœ¬æœˆæˆªæ­¢ä»Šå¤©ä¸ºæ­¢çš„æ‰€æœ‰çš„ç­¾åˆ°è®°å½•ï¼Œè¿”å›çš„æ˜¯ä¸€ä¸ªåè¿›åˆ¶çš„æ•°å­— BITFIELD sign:5:202203 GET u14 0</span></span><br><span class="line">    List&lt;Long&gt; result = stringRedisTemplate.opsForValue().bitField(</span><br><span class="line">            key,</span><br><span class="line">            BitFieldSubCommands.create()</span><br><span class="line">                    .get(BitFieldSubCommands.BitFieldType.unsigned(dayOfMonth)).valueAt(<span class="number">0</span>)</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">if</span> (result == <span class="literal">null</span> || result.isEmpty()) &#123;</span><br><span class="line">        <span class="comment">// æ²¡æœ‰ä»»ä½•ç­¾åˆ°ç»“æœ</span></span><br><span class="line">        <span class="keyword">return</span> Result.ok(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">Long</span> <span class="variable">num</span> <span class="operator">=</span> result.get(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> (num == <span class="literal">null</span> || num == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> Result.ok(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 6.å¾ªç¯éå†</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">        <span class="comment">// 6.1.è®©è¿™ä¸ªæ•°å­—ä¸1åšä¸è¿ç®—ï¼Œå¾—åˆ°æ•°å­—çš„æœ€åä¸€ä¸ªbitä½  // åˆ¤æ–­è¿™ä¸ªbitä½æ˜¯å¦ä¸º0</span></span><br><span class="line">        <span class="keyword">if</span> ((num &amp; <span class="number">1</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// å¦‚æœä¸º0ï¼Œè¯´æ˜æœªç­¾åˆ°ï¼Œç»“æŸ</span></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// å¦‚æœä¸ä¸º0ï¼Œè¯´æ˜å·²ç­¾åˆ°ï¼Œè®¡æ•°å™¨+1</span></span><br><span class="line">            count++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// æŠŠæ•°å­—å³ç§»ä¸€ä½ï¼ŒæŠ›å¼ƒæœ€åä¸€ä¸ªbitä½ï¼Œç»§ç»­ä¸‹ä¸€ä¸ªbitä½</span></span><br><span class="line">        num &gt;&gt;&gt;= <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> Result.ok(count);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="11-4-é¢å¤–åŠ é¤-å…³äºä½¿ç”¨bitmapæ¥è§£å†³ç¼“å­˜ç©¿é€çš„æ–¹æ¡ˆ">11.4 é¢å¤–åŠ é¤-å…³äºä½¿ç”¨bitmapæ¥è§£å†³ç¼“å­˜ç©¿é€çš„æ–¹æ¡ˆ</h4><p>å›é¡¾<strong>ç¼“å­˜ç©¿é€</strong>ï¼š</p><p>å‘èµ·äº†ä¸€ä¸ªæ•°æ®åº“ä¸å­˜åœ¨çš„ï¼Œredisé‡Œè¾¹ä¹Ÿä¸å­˜åœ¨çš„æ•°æ®ï¼Œé€šå¸¸ä½ å¯ä»¥æŠŠä»–çœ‹æˆä¸€ä¸ªæ”»å‡»</p><p>è§£å†³æ–¹æ¡ˆï¼š</p><ul><li><p>åˆ¤æ–­id&lt;0</p></li><li><p>å¦‚æœæ•°æ®åº“æ˜¯ç©ºï¼Œé‚£ä¹ˆå°±å¯ä»¥ç›´æ¥å¾€redisé‡Œè¾¹æŠŠè¿™ä¸ªç©ºæ•°æ®ç¼“å­˜èµ·æ¥</p></li></ul><p>ç¬¬ä¸€ç§è§£å†³æ–¹æ¡ˆï¼šé‡åˆ°çš„é—®é¢˜æ˜¯å¦‚æœç”¨æˆ·è®¿é—®çš„æ˜¯idä¸å­˜åœ¨çš„æ•°æ®ï¼Œåˆ™æ­¤æ—¶å°±æ— æ³•ç”Ÿæ•ˆ</p><p>ç¬¬äºŒç§è§£å†³æ–¹æ¡ˆï¼šé‡åˆ°çš„é—®é¢˜æ˜¯ï¼šå¦‚æœæ˜¯ä¸åŒçš„idé‚£å°±å¯ä»¥é˜²æ­¢ä¸‹æ¬¡è¿‡æ¥ç›´å‡»æ•°æ®</p><p>æ‰€ä»¥æˆ‘ä»¬å¦‚ä½•è§£å†³å‘¢ï¼Ÿ</p><p>æˆ‘ä»¬å¯ä»¥å°†æ•°æ®åº“çš„æ•°æ®ï¼Œæ‰€å¯¹åº”çš„idå†™å…¥åˆ°ä¸€ä¸ªlisté›†åˆä¸­ï¼Œå½“ç”¨æˆ·è¿‡æ¥è®¿é—®çš„æ—¶å€™ï¼Œæˆ‘ä»¬ç›´æ¥å»åˆ¤æ–­listä¸­æ˜¯å¦åŒ…å«å½“å‰çš„è¦æŸ¥è¯¢çš„æ•°æ®ï¼Œå¦‚æœè¯´ç”¨æˆ·è¦æŸ¥è¯¢çš„idæ•°æ®å¹¶ä¸åœ¨listé›†åˆä¸­ï¼Œåˆ™ç›´æ¥è¿”å›ï¼Œå¦‚æœlistä¸­åŒ…å«å¯¹åº”æŸ¥è¯¢çš„idæ•°æ®ï¼Œåˆ™è¯´æ˜ä¸æ˜¯ä¸€æ¬¡ç¼“å­˜ç©¿é€æ•°æ®ï¼Œåˆ™ç›´æ¥æ”¾è¡Œã€‚</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/1653836416586.png" alt="1653836416586"></p><p>ç°åœ¨çš„é—®é¢˜æ˜¯è¿™ä¸ªä¸»é”®å…¶å®å¹¶æ²¡æœ‰é‚£ä¹ˆçŸ­ï¼Œè€Œæ˜¯å¾ˆé•¿çš„ä¸€ä¸ª ä¸»é”®</p><p>å“ªæ€•ä½ å•ç‹¬å»æå–è¿™ä¸ªä¸»é”®ï¼Œä½†æ˜¯åœ¨11å¹´å·¦å³ï¼Œæ·˜å®çš„å•†å“æ€»é‡å°±å·²ç»è¶…è¿‡10äº¿ä¸ª</p><p>æ‰€ä»¥å¦‚æœé‡‡ç”¨ä»¥ä¸Šæ–¹æ¡ˆï¼Œè¿™ä¸ªlistä¹Ÿä¼šå¾ˆå¤§ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨bitmapæ¥å‡å°‘listçš„å­˜å‚¨ç©ºé—´</p><p>æˆ‘ä»¬å¯ä»¥æŠŠlistæ•°æ®æŠ½è±¡æˆä¸€ä¸ªéå¸¸å¤§çš„bitmapï¼Œæˆ‘ä»¬ä¸å†ä½¿ç”¨listï¼Œè€Œæ˜¯å°†dbä¸­çš„idæ•°æ®åˆ©ç”¨å“ˆå¸Œæ€æƒ³ï¼Œæ¯”å¦‚ï¼š</p><p>id % bitmap.size  = ç®—å‡ºå½“å‰è¿™ä¸ªidå¯¹åº”åº”è¯¥è½åœ¨bitmapçš„å“ªä¸ªç´¢å¼•ä¸Šï¼Œç„¶åå°†è¿™ä¸ªå€¼ä»0å˜æˆ1ï¼Œç„¶åå½“ç”¨æˆ·æ¥æŸ¥è¯¢æ•°æ®æ—¶ï¼Œæ­¤æ—¶å·²ç»æ²¡æœ‰äº†listï¼Œè®©ç”¨æˆ·ç”¨ä»–æŸ¥è¯¢çš„idå»ç”¨ç›¸åŒçš„å“ˆå¸Œç®—æ³•ï¼Œ ç®—å‡ºæ¥å½“å‰è¿™ä¸ªidåº”å½“è½åœ¨bitmapçš„å“ªä¸€ä½ï¼Œç„¶ååˆ¤æ–­è¿™ä¸€ä½æ˜¯0ï¼Œè¿˜æ˜¯1ï¼Œå¦‚æœæ˜¯0åˆ™è¡¨æ˜è¿™ä¸€ä½ä¸Šçš„æ•°æ®ä¸€å®šä¸å­˜åœ¨ï¼Œ  é‡‡ç”¨è¿™ç§æ–¹å¼æ¥å¤„ç†ï¼Œéœ€è¦é‡ç‚¹è€ƒè™‘ä¸€ä¸ªäº‹æƒ…ï¼Œå°±æ˜¯è¯¯å·®ç‡ï¼Œæ‰€è°“çš„è¯¯å·®ç‡å°±æ˜¯æŒ‡å½“å‘ç”Ÿå“ˆå¸Œå†²çªçš„æ—¶å€™ï¼Œäº§ç”Ÿçš„è¯¯å·®ã€‚</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/1653836578970.png" alt="1653836578970"></p><p>12ã€UVç»Ÿè®¡</p><h3 id="12-1-ã€UVç»Ÿè®¡-HyperLogLog">12.1 ã€UVç»Ÿè®¡-HyperLogLog</h3><p>é¦–å…ˆæˆ‘ä»¬ææ‡‚ä¸¤ä¸ªæ¦‚å¿µï¼š</p><ul><li>UVï¼šå…¨ç§°Unique Visitorï¼Œä¹Ÿå«ç‹¬ç«‹è®¿å®¢é‡ï¼Œæ˜¯æŒ‡é€šè¿‡äº’è”ç½‘è®¿é—®ã€æµè§ˆè¿™ä¸ªç½‘é¡µçš„è‡ªç„¶äººã€‚1å¤©å†…åŒä¸€ä¸ªç”¨æˆ·å¤šæ¬¡è®¿é—®è¯¥ç½‘ç«™ï¼Œåªè®°å½•1æ¬¡ã€‚</li><li>PVï¼šå…¨ç§°Page Viewï¼Œä¹Ÿå«é¡µé¢è®¿é—®é‡æˆ–ç‚¹å‡»é‡ï¼Œç”¨æˆ·æ¯è®¿é—®ç½‘ç«™çš„ä¸€ä¸ªé¡µé¢ï¼Œè®°å½•1æ¬¡PVï¼Œç”¨æˆ·å¤šæ¬¡æ‰“å¼€é¡µé¢ï¼Œåˆ™è®°å½•å¤šæ¬¡PVã€‚å¾€å¾€ç”¨æ¥è¡¡é‡ç½‘ç«™çš„æµé‡ã€‚</li></ul><p>é€šå¸¸æ¥è¯´UVä¼šæ¯”PVå¤§å¾ˆå¤šï¼Œæ‰€ä»¥è¡¡é‡åŒä¸€ä¸ªç½‘ç«™çš„è®¿é—®é‡ï¼Œæˆ‘ä»¬éœ€è¦ç»¼åˆè€ƒè™‘å¾ˆå¤šå› ç´ ï¼Œæ‰€ä»¥æˆ‘ä»¬åªæ˜¯å•çº¯çš„æŠŠè¿™ä¸¤ä¸ªå€¼ä½œä¸ºä¸€ä¸ªå‚è€ƒå€¼</p><p>UVç»Ÿè®¡åœ¨æœåŠ¡ç«¯åšä¼šæ¯”è¾ƒéº»çƒ¦ï¼Œå› ä¸ºè¦åˆ¤æ–­è¯¥ç”¨æˆ·æ˜¯å¦å·²ç»ç»Ÿè®¡è¿‡äº†ï¼Œéœ€è¦å°†ç»Ÿè®¡è¿‡çš„ç”¨æˆ·ä¿¡æ¯ä¿å­˜ã€‚ä½†æ˜¯å¦‚æœæ¯ä¸ªè®¿é—®çš„ç”¨æˆ·éƒ½ä¿å­˜åˆ°Redisä¸­ï¼Œæ•°æ®é‡ä¼šéå¸¸ææ€–ï¼Œé‚£æ€ä¹ˆå¤„ç†å‘¢ï¼Ÿ</p><p>Hyperloglog(HLL)æ˜¯ä»Loglogç®—æ³•æ´¾ç”Ÿçš„æ¦‚ç‡ç®—æ³•ï¼Œç”¨äºç¡®å®šéå¸¸å¤§çš„é›†åˆçš„åŸºæ•°ï¼Œè€Œä¸éœ€è¦å­˜å‚¨å…¶æ‰€æœ‰å€¼ã€‚ç›¸å…³ç®—æ³•åŸç†å¤§å®¶å¯ä»¥å‚è€ƒï¼š<a href="https://juejin.cn/post/6844903785744056333#heading-0">https://juejin.cn/post/6844903785744056333#heading-0</a><br>Redisä¸­çš„HLLæ˜¯åŸºäºstringç»“æ„å®ç°çš„ï¼Œå•ä¸ªHLLçš„å†…å­˜<strong>æ°¸è¿œå°äº16kb</strong>ï¼Œ<strong>å†…å­˜å ç”¨ä½</strong>çš„ä»¤äººå‘æŒ‡ï¼ä½œä¸ºä»£ä»·ï¼Œå…¶æµ‹é‡ç»“æœæ˜¯æ¦‚ç‡æ€§çš„ï¼Œ<strong>æœ‰å°äº0.81ï¼…çš„è¯¯å·®</strong>ã€‚ä¸è¿‡å¯¹äºUVç»Ÿè®¡æ¥è¯´ï¼Œè¿™å®Œå…¨å¯ä»¥å¿½ç•¥ã€‚</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/1653837988985.png" alt="1653837988985"></p><h3 id="12-2-UVç»Ÿè®¡-æµ‹è¯•ç™¾ä¸‡æ•°æ®çš„ç»Ÿè®¡">12.2 UVç»Ÿè®¡-æµ‹è¯•ç™¾ä¸‡æ•°æ®çš„ç»Ÿè®¡</h3><p>æµ‹è¯•æ€è·¯ï¼šæˆ‘ä»¬ç›´æ¥åˆ©ç”¨å•å…ƒæµ‹è¯•ï¼Œå‘HyperLogLogä¸­æ·»åŠ 100ä¸‡æ¡æ•°æ®ï¼Œçœ‹çœ‹å†…å­˜å ç”¨å’Œç»Ÿè®¡æ•ˆæœå¦‚ä½•</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/1653838053608.png" alt="1653838053608"></p><p>ç»è¿‡æµ‹è¯•ï¼šæˆ‘ä»¬ä¼šå‘ç”Ÿä»–çš„è¯¯å·®æ˜¯åœ¨å…è®¸èŒƒå›´å†…ï¼Œå¹¶ä¸”å†…å­˜å ç”¨æå°</p>]]></content>
    
    
    <summary type="html">å­¦ä¹ é¡¹ç›®ä»0-1</summary>
    
    
    
    <category term="é¡¹ç›®" scheme="https://u7u7.top/categories/%E9%A1%B9%E7%9B%AE/"/>
    
    
    <category term="Java" scheme="https://u7u7.top/tags/Java/"/>
    
    <category term="é¡¹ç›®" scheme="https://u7u7.top/tags/%E9%A1%B9%E7%9B%AE/"/>
    
    <category term="SpringBoot" scheme="https://u7u7.top/tags/SpringBoot/"/>
    
    <category term="Mysql" scheme="https://u7u7.top/tags/Mysql/"/>
    
    <category term="Redis" scheme="https://u7u7.top/tags/Redis/"/>
    
    <category term="Mybatis-plus" scheme="https://u7u7.top/tags/Mybatis-plus/"/>
    
    <category term="Mybatis" scheme="https://u7u7.top/tags/Mybatis/"/>
    
  </entry>
  
  <entry>
    <title>ç®—æ³•é¢˜</title>
    <link href="https://u7u7.top/posts/suanfaProject.html"/>
    <id>https://u7u7.top/posts/suanfaProject.html</id>
    <published>2025-07-27T14:16:25.000Z</published>
    <updated>2025-08-12T01:08:44.188Z</updated>
    
    <content type="html"><![CDATA[<h1 id="C-ç®—æ³•é¢˜">C++ç®—æ³•é¢˜</h1><h2 id="åè¿›åˆ¶è½¬å…«è¿›åˆ¶">åè¿›åˆ¶è½¬å…«è¿›åˆ¶</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">eightSystem</span><span class="params">(<span class="type">int</span> num)</span> </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (num &lt; <span class="number">8</span>)</span><br><span class="line">&#123;</span><br><span class="line">cout &lt;&lt; num; <span class="comment">//è¿›åˆ¶å‡ æ¬¡</span></span><br><span class="line"><span class="keyword">return</span>; <span class="comment">//åœæ­¢é€’å½’</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">eightSystem</span>(num / <span class="number">8</span>); <span class="comment">//æ•´é™¤å†è¿›å…¥å‡½æ•°ä½“</span></span><br><span class="line">cout &lt;&lt; num % <span class="number">8</span>; <span class="comment">//è¾“å‡ºä½™æ•°</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="type">int</span> a;</span><br><span class="line">cin &gt;&gt; a;</span><br><span class="line"><span class="built_in">eightSystem</span>(a);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="äºŒçš„å¹‚æ¬¡æ–¹">äºŒçš„å¹‚æ¬¡æ–¹</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;math.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">two</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line"><span class="type">int</span> i = <span class="number">14</span>;</span><br><span class="line"><span class="keyword">while</span> (i &gt;= <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">pow</span>(<span class="number">2</span>, i) &lt;= x) <span class="comment">//æ‰¾åˆ°æœ€æ¥è¿‘ç›®æ ‡å€¼çš„2çš„æ¬¡æ•°</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (i == <span class="number">1</span>) cout &lt;&lt; <span class="string">&quot;2&quot;</span>; <span class="comment">//å‰©ä¸‹ä¸€ä¸ª2</span></span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (i == <span class="number">0</span>) cout &lt;&lt; <span class="string">&quot;2(0)&quot;</span>; <span class="comment">//å‰©ä¸‹ä¸€ä¸ª1</span></span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;2(&quot;</span>; </span><br><span class="line"><span class="built_in">two</span>(i);  <span class="comment">//ç»§ç»­é€’å½’</span></span><br><span class="line">cout &lt;&lt; <span class="string">&quot;)&quot;</span>; </span><br><span class="line">&#125;</span><br><span class="line">x -= <span class="built_in">pow</span>(<span class="number">2</span>, i);</span><br><span class="line"><span class="keyword">if</span> (x != <span class="number">0</span>) cout &lt;&lt; <span class="string">&quot;+&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">i--;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="built_in">two</span>(<span class="number">137</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç¥ç‰›æœ">ç¥ç‰›æœ</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">int</span>  a[<span class="number">10000</span>] = &#123;&#125;; <span class="comment">//å­˜æ”¾ç‰›çš„è‚šé‡</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="type">int</span> n; <span class="comment">//ç‰›çš„æ•°é‡</span></span><br><span class="line">cin &gt;&gt; n;</span><br><span class="line"><span class="type">int</span> b=<span class="number">0</span>; <span class="comment">//å­˜æ”¾æ¯ç»„ç‰›çš„æ•°é‡</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">&#123;</span><br><span class="line">cin &gt;&gt; a[i];</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">sort</span>(a, a + n); <span class="comment">//æ’åº 1 2 5 8  1+8 2+5</span></span><br><span class="line"><span class="comment">//æ­é… æœ€å¤§çš„å’Œæœ€å°çš„æ­é…</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n/<span class="number">2</span>; i++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (b &lt; a[i] + a[n - i - <span class="number">1</span>])</span><br><span class="line">&#123;</span><br><span class="line">b = a[i] + a[n - i - <span class="number">1</span>];<span class="comment">//å­˜æ”¾å’Œ</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">cout &lt;&lt; b;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç¬¨å°å­©">ç¬¨å°å­©</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">int</span>  a[<span class="number">10000</span>];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="type">int</span> n, x,time=<span class="number">0</span>;</span><br><span class="line">cin &gt;&gt; n &gt;&gt; x;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">&#123;</span><br><span class="line">cin &gt;&gt; a[i]; <span class="comment">// å­˜æ”¾æ¯é—¨è¯¾</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">sort</span>(a, a + n);</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">&#123;</span><br><span class="line">time += x * a[i]; <span class="comment">//æ¯é—¨è¯¾èŠ±è´¹çš„æ—¶é—´</span></span><br><span class="line"><span class="comment">//å­¦å®Œä¸€é—¨è¯¾ èŠ±çš„æ—¶é—´å˜å¿«</span></span><br><span class="line"><span class="keyword">if</span> (x != <span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line">x--;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">cout &lt;&lt; time;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç¾å…ƒæ±‡ç‡">ç¾å…ƒæ±‡ç‡</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="type">int</span> k=<span class="number">1</span>;<span class="comment">//å½“å¤©æ˜¯ç¾å…ƒè¿˜æ˜¯é©¬å…‹</span></span><br><span class="line"><span class="type">int</span> n; <span class="comment">//å¤©æ•°</span></span><br><span class="line"><span class="type">int</span> a[<span class="number">101</span>] = &#123;&#125;; <span class="comment">//å­˜æ”¾æ±‡ç‡</span></span><br><span class="line">cin &gt;&gt; n;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">&#123;</span><br><span class="line">cin &gt;&gt; a[i]; <span class="comment">// å­˜æ”¾æ¯å¤©çš„æ±‡ç‡ </span></span><br><span class="line">&#125;</span><br><span class="line"><span class="type">double</span> x=<span class="number">100</span>; <span class="comment">//æ‰‹é‡Œçš„é’±</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//å¦‚æœæ‰‹é‡Œæ˜¯ç¾å…ƒ </span></span><br><span class="line"><span class="keyword">if</span>(k==<span class="number">1</span>)&#123;</span><br><span class="line"><span class="comment">//ç¬¬äºŒå¤©æ±‡ç‡å°äºç¬¬ä¸€å¤©æ¢æˆé©¬å…‹ </span></span><br><span class="line"><span class="keyword">if</span>(a[i+<span class="number">1</span>] &lt; a[i])&#123;</span><br><span class="line"><span class="comment">// 100 400   400=100*(400 / 100)</span></span><br><span class="line">x = x * (a[i] / <span class="number">100</span>);</span><br><span class="line">k=<span class="number">0</span>; <span class="comment">//å˜æˆé©¬å…‹ </span></span><br><span class="line">&#125; </span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å¦‚æœæ‰‹é‡Œæ˜¯é©¬å…‹</span></span><br><span class="line"><span class="keyword">if</span>(k==<span class="number">0</span>) &#123;</span><br><span class="line"><span class="keyword">if</span>(a[i+<span class="number">1</span>] &gt; a[i])&#123;</span><br><span class="line">x = x /a[i] * <span class="number">100</span>;</span><br><span class="line">k=<span class="number">1</span>; <span class="comment">//å˜æˆç¾å…ƒ </span></span><br><span class="line">&#125; </span><br><span class="line">&#125;</span><br><span class="line">&#125; </span><br><span class="line"><span class="comment">//æœ€åä¸€å¤©ä¸€å®šè¦æ˜¯ç¾å…ƒ æœ€åä¸€é¡¹ </span></span><br><span class="line"><span class="keyword">if</span>(k==<span class="number">0</span>)  x = x /a[n<span class="number">-1</span>] * <span class="number">100</span>;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%.2lf\n&quot;</span>,x);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="åŠ›æ‰£ç®—æ³•åˆ·é¢˜">åŠ›æ‰£ç®—æ³•åˆ·é¢˜</h1><h2 id="leetcodeç®—æ³•é¢˜">leetcodeç®—æ³•é¢˜</h2><blockquote><p>ä¹‹å‰åšäº†å¾ˆå¤šç®—æ³•é¢˜ï¼Œä½†æ˜¯å› ä¸ºæ²¡æœ‰å†™ç¬”è®°çš„åŸå› ï¼Œæ•ˆæœä¸å¤ªå¥½ï¼Œå…ˆæŠŠä¹‹å‰å†™çš„ç®—æ³•é¢˜çš„ä»£ç éƒ½æ”¾ä¸Šæ¥ã€‚ä»¥åå†™çš„ç®—æ³•é¢˜ï¼Œè¦åšå¥½ç¬”è®°ã€‚å› ä¸ºåŠ›æ‰£åšé¢˜éƒ½æ˜¯ç»™ä½ ä¸€ä¸ªå‡½æ•°çš„æ¨¡ç‰ˆè®©ä½ å†™é¢˜ç›®ï¼Œä¸€èˆ¬éƒ½æ˜¯æœ‰è¿”å›å€¼çš„ï¼Œæ‰€ä»¥éƒ½å¯ä»¥æ”¾ä¸€ä¸ªä»£ç ä¸­å»ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> December;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.rmi.CORBA.Util;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Solution</span> <span class="variable">solution</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Solution</span>();</span><br><span class="line">        <span class="type">int</span>[] arr = <span class="keyword">new</span> <span class="title class_">int</span>[]&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>&#125;;</span><br><span class="line">        runningSum(arr);</span><br><span class="line">        canConstruct(<span class="string">&quot;aab&quot;</span>,<span class="string">&quot;baa&quot;</span>);</span><br><span class="line">        solution.minOperations(<span class="string">&quot;110&quot;</span>);</span><br><span class="line">        System.out.println(solution.secondHighest(<span class="string">&quot;ck077&quot;</span>));</span><br><span class="line">        <span class="type">int</span>[] arr1 = <span class="keyword">new</span> <span class="title class_">int</span>[]&#123;-<span class="number">1</span>,<span class="number">0</span>,<span class="number">3</span>,<span class="number">9</span>,<span class="number">11</span>,<span class="number">13</span>,<span class="number">22</span>,<span class="number">27</span>,<span class="number">33</span>,<span class="number">57</span>,<span class="number">66</span>,<span class="number">77</span>&#125;;</span><br><span class="line"><span class="comment">//        int[] arr = new int[]&#123;-1,0,3,9,11,13,22,27,33,57,66,77&#125;;</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> searchInsert(arr1, <span class="number">1</span>);</span><br><span class="line">        System.out.println(i);</span><br><span class="line">        <span class="type">int</span>[] nums  = <span class="keyword">new</span> <span class="title class_">int</span>[]&#123;-<span class="number">2</span>,<span class="number">1</span>,-<span class="number">3</span>,<span class="number">4</span>,-<span class="number">1</span>,<span class="number">2</span>,<span class="number">1</span>,-<span class="number">5</span>,<span class="number">4</span>&#125;;</span><br><span class="line">        solution.twoSum(nums,<span class="number">8</span>);</span><br><span class="line">        solution.maxSubArray(nums);</span><br><span class="line">        solution.lengthOfLongestSubstring(<span class="string">&quot;pwwkep&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;123456789&quot;</span>.substring(<span class="number">2</span>, <span class="number">4</span>));</span><br><span class="line">        <span class="type">String</span> <span class="variable">s1</span> <span class="operator">=</span> <span class="string">&quot;ab&quot;</span>,s2 = <span class="string">&quot;eidboaoo&quot;</span>;</span><br><span class="line">        solution.checkInclusion(s1, s2);</span><br><span class="line">        solution.mostCompetitive(<span class="keyword">new</span> <span class="title class_">int</span>[]&#123;<span class="number">2</span>,<span class="number">4</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">4</span>,<span class="number">9</span>,<span class="number">6</span>&#125;,<span class="number">4</span>);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//    åŠ›æ‰£P1673è´ªå¿ƒç®—æ³• è‡ªå·±åŠæš´åŠ›åšå‡ºæ¥çš„ é¢˜è§£éƒ½ç”¨äº†æ•°æ®æ ˆ æ‰€ä»¥88ä¸ªç‚¹åªè¿‡äº†86ä¸ª åé¢å­¦æ•°æ®æ ˆå›å¤´å†æ¥åšä¸€ä¸‹</span></span><br><span class="line"><span class="comment">//    public int[] mostCompetitive(int[] nums, int k) &#123;</span></span><br><span class="line"><span class="comment">//        int len  = nums.length;</span></span><br><span class="line"><span class="comment">//        int[] ints = new int[k];</span></span><br><span class="line"><span class="comment">//        int min=0;</span></span><br><span class="line"><span class="comment">//        int start = 0;</span></span><br><span class="line"><span class="comment">//        for (int x = 0;x&lt;k;x++)&#123;</span></span><br><span class="line"><span class="comment">//            for (int n = start; n &lt; len-k+x;n++)&#123;</span></span><br><span class="line"><span class="comment">//                if (nums[min] &gt; nums[n+1])&#123;</span></span><br><span class="line"><span class="comment">//                    min = n+1;</span></span><br><span class="line"><span class="comment">//                &#125;</span></span><br><span class="line"><span class="comment">//            &#125;</span></span><br><span class="line"><span class="comment">//            ints[x] = nums[min];</span></span><br><span class="line"><span class="comment">//            start = min;</span></span><br><span class="line"><span class="comment">//            min +=1 ;</span></span><br><span class="line"><span class="comment">//        &#125;</span></span><br><span class="line"><span class="comment">//        return ints;</span></span><br><span class="line"><span class="comment">//    &#125;</span></span><br><span class="line">    <span class="comment">//æ­£ç¡®è§£</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span>[] mostCompetitive(<span class="type">int</span>[] nums, <span class="type">int</span> k) &#123;</span><br><span class="line">        ArrayList&lt;Integer&gt; stack = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Integer&gt;();</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> nums.length;</span><br><span class="line">        <span class="type">int</span> <span class="variable">last</span> <span class="operator">=</span> n-k;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i ++) &#123;</span><br><span class="line">            <span class="keyword">while</span> (stack.size()&gt;<span class="number">0</span> &amp;&amp; last&gt;<span class="number">0</span> &amp;&amp; stack.get(stack.size()-<span class="number">1</span>)&gt;nums[i]) &#123;</span><br><span class="line">                stack.remove(stack.size()-<span class="number">1</span>);</span><br><span class="line">                last --;</span><br><span class="line">            &#125;</span><br><span class="line">            stack.add(nums[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span>[] res = <span class="keyword">new</span> <span class="title class_">int</span>[k];</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; k; i++)&#123;</span><br><span class="line">            res[i] = stack.get(i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//P567 å­—ç¬¦ä¸²æ’åºä¼˜è§£</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">checkInclusion</span><span class="params">(String s1, String s2)</span> &#123;</span><br><span class="line">        <span class="type">int</span> n1=s1.length(),n2=s2.length();</span><br><span class="line">        <span class="keyword">if</span> (n1&gt;n2) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="type">int</span>[] cnt = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">26</span>];</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> <span class="number">0</span>;x&lt;n1;x++)&#123;</span><br><span class="line">            cnt[s1.charAt(x) - <span class="string">&#x27;a&#x27;</span>] -= <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> <span class="variable">left</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n2; i++) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">str</span> <span class="operator">=</span> s2.charAt(i) - <span class="string">&#x27;a&#x27;</span>;</span><br><span class="line">            cnt[str] += <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">while</span> (cnt[str] &gt; <span class="number">0</span>)&#123;</span><br><span class="line">                cnt[s2.charAt(left) - <span class="string">&#x27;a&#x27;</span>] -= <span class="number">1</span>;</span><br><span class="line">                left++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (i-left+<span class="number">1</span> == n1)&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//åŠ›æ‰£P1480</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span>[] runningSum(<span class="type">int</span>[] nums) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; nums.length; i++) &#123;</span><br><span class="line">            nums[i] += nums[i-<span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> nums;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//    public boolean checkInclusion(String s1, String s2) &#123;</span></span><br><span class="line"><span class="comment">//        int n = s1.length(), m = s2.length();</span></span><br><span class="line"><span class="comment">//        if (n &gt; m) &#123;</span></span><br><span class="line"><span class="comment">//            return false;</span></span><br><span class="line"><span class="comment">//        &#125;</span></span><br><span class="line"><span class="comment">//        int[] cnt = new int[26];</span></span><br><span class="line"><span class="comment">//        for (int i = 0; i &lt; n; ++i) &#123;</span></span><br><span class="line"><span class="comment">//            --cnt[s1.charAt(i) - &#x27;a&#x27;];</span></span><br><span class="line"><span class="comment">//        &#125;</span></span><br><span class="line"><span class="comment">//        int left = 0;</span></span><br><span class="line"><span class="comment">//        for (int right = 0; right &lt; m; ++right) &#123;</span></span><br><span class="line"><span class="comment">//            int x = s2.charAt(right) - &#x27;a&#x27;;</span></span><br><span class="line"><span class="comment">//            ++cnt[x];</span></span><br><span class="line"><span class="comment">//            while (cnt[x] &gt; 0) &#123;</span></span><br><span class="line"><span class="comment">//                --cnt[s2.charAt(left) - &#x27;a&#x27;];</span></span><br><span class="line"><span class="comment">//                ++left;</span></span><br><span class="line"><span class="comment">//            &#125;</span></span><br><span class="line"><span class="comment">//            if (right - left + 1 == n) &#123;</span></span><br><span class="line"><span class="comment">//                return true;</span></span><br><span class="line"><span class="comment">//            &#125;</span></span><br><span class="line"><span class="comment">//        &#125;</span></span><br><span class="line"><span class="comment">//        return false;</span></span><br><span class="line"><span class="comment">//    &#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//åŠ›æ‰£P383</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">canConstruct</span><span class="params">(String ransomNote, String magazine)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(ransomNote.length() &gt; magazine.length()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span>[] cnt = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">26</span>];</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">char</span> c : magazine.toCharArray()) &#123;</span><br><span class="line">            cnt[c - <span class="string">&#x27;a&#x27;</span>] ++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">char</span> c : ransomNote.toCharArray()) &#123;</span><br><span class="line">            cnt[c - <span class="string">&#x27;a&#x27;</span>] --;</span><br><span class="line">            <span class="keyword">if</span>(cnt[c - <span class="string">&#x27;a&#x27;</span>] &lt; <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//åŠ›æ‰£P412</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;String&gt; <span class="title function_">fizzBuzz</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">        ArrayList&lt;String&gt; arrayList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (i % <span class="number">3</span> == <span class="number">0</span> &amp;&amp; i % <span class="number">5</span> == <span class="number">0</span>)&#123;</span><br><span class="line">                arrayList.add(<span class="string">&quot;FizzBuzz&quot;</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span> (i % <span class="number">3</span> ==<span class="number">0</span>)&#123;</span><br><span class="line">                arrayList.add(<span class="string">&quot;Fizz&quot;</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span> (i % <span class="number">5</span> == <span class="number">0</span>)&#123;</span><br><span class="line">                arrayList.add(<span class="string">&quot;Buzz&quot;</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                arrayList.add(String.valueOf(i));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> arrayList;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//P876 é“¾è¡¨ä¸­é—´èŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">public</span> ListNode <span class="title function_">middleNode</span><span class="params">(ListNode head)</span> &#123;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">slow</span> <span class="operator">=</span> head;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">fast</span> <span class="operator">=</span> head;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (fast != <span class="literal">null</span> &amp;&amp; fast.next != <span class="literal">null</span>)&#123;</span><br><span class="line">            slow = slow.next;</span><br><span class="line">            fast = fast.next.next;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> slow;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//P1769</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span>[] minOperations(String boxes) &#123;</span><br><span class="line">        String[] split = boxes.split(<span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="type">int</span>[] ints = <span class="keyword">new</span> <span class="title class_">int</span>[split.length];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;split.length;i++)&#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> x=<span class="number">0</span>;x&lt;split.length;x++)&#123;</span><br><span class="line">                <span class="keyword">if</span> (split[x].equals(<span class="string">&quot;1&quot;</span>))&#123;</span><br><span class="line">                    count += Math.abs(x-i);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            ints[i] = count;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ints;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//åŠ›æ‰£P1796</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">secondHighest</span><span class="params">(String s)</span> &#123;</span><br><span class="line">        ArrayList&lt;Integer&gt; ay = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">char</span> i : s.toCharArray())&#123;</span><br><span class="line">            <span class="keyword">if</span> (i &gt; <span class="number">47</span> &amp;&amp; i &lt;  <span class="number">58</span>)&#123;</span><br><span class="line">                <span class="keyword">if</span> (!ay.contains(i - <span class="number">48</span>))&#123;</span><br><span class="line">                    ay.add(i-<span class="number">48</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        Collections.sort(ay);</span><br><span class="line">        <span class="keyword">if</span> (ay.size()&gt;<span class="number">1</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> ay.get(ay.size()-<span class="number">2</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//P35ä¼˜è§£ åŒæŒ‡é’ˆ</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">searchInsert</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> target)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">left</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">right</span> <span class="operator">=</span> nums.length -<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (left &lt;= right)&#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">middle</span> <span class="operator">=</span> left + (right - left) / <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">if</span> (nums[middle] &gt; target)&#123;</span><br><span class="line">                right = middle -<span class="number">1</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span> (nums[middle] &lt; target)&#123;</span><br><span class="line">                left = middle + <span class="number">1</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> middle;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> right+<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//P704äºŒåˆ†æŸ¥æ‰¾</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">search</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> target)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">left</span> <span class="operator">=</span> <span class="number">0</span>, right = nums.length - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (left &lt;= right) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">mid</span> <span class="operator">=</span> (right - left) / <span class="number">2</span> + left;</span><br><span class="line">            <span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> nums[mid];</span><br><span class="line">            <span class="keyword">if</span> (num == target) &#123;</span><br><span class="line">                <span class="keyword">return</span> mid;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (num &gt; target) &#123;</span><br><span class="line">                right = mid - <span class="number">1</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                left = mid + <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//P977 è¾“å…¥ä¸€ä¸ªå‡åºçš„æ•°ç»„ï¼Œç„¶åè¿”å›ä¸€ä¸ªæ•°æ®å„ä½ç½®å¹³æ–¹ï¼Œä¹Ÿæ˜¯å‡åº</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span>[] sortedSquares(<span class="type">int</span>[] nums) &#123;</span><br><span class="line">        <span class="comment">//ç¬¬ä¸€ç§ è‡ªå·±å°±æ˜¯ç›´æ¥æ¯ä½å¹³æ–¹å†é‡æ–°æ’åº æ‰§è¡Œæ—¶é—´5ms</span></span><br><span class="line">        <span class="comment">//for (int i = 0; i &lt; nums.length; i++) &#123;</span></span><br><span class="line">        <span class="comment">//    nums[i] = nums[i]*nums[i];</span></span><br><span class="line">        <span class="comment">//&#125;</span></span><br><span class="line">        <span class="comment">//Arrays.parallelSort(nums);</span></span><br><span class="line">        <span class="comment">//return nums;</span></span><br><span class="line">        <span class="comment">//ä¸‹é¢æ˜¯åŒæŒ‡é’ˆ</span></span><br><span class="line">        <span class="comment">//æ€è·¯ å› ä¸ºæ˜¯å‡åºï¼Œæ‰€ä»¥æ•°çš„å¹³æ–¹çš„æœ€å¤§å€¼ä¸€å®šæ˜¯ä¸¤è¾¹,æŠŠè¿™ä¸ªå¤§çš„æ•° æ”¾æ–°æ•°ç»„å³è¾¹ ç„¶åä¸¤ç•Œé™å¾€å†…å¤¹</span></span><br><span class="line">        <span class="type">int</span>[] result  = <span class="keyword">new</span> <span class="title class_">int</span>[nums.length];</span><br><span class="line">        <span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> result.length-<span class="number">1</span>; <span class="comment">//ç»™resultå€’ç€æ’å…¥çš„ä¸‹æ ‡</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">right</span> <span class="operator">=</span> result.length-<span class="number">1</span>; <span class="comment">//å³ç•Œé™</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">left</span> <span class="operator">=</span> <span class="number">0</span>; <span class="comment">//å·¦ç•Œé™</span></span><br><span class="line">        <span class="keyword">while</span>(left &lt;= right)&#123; <span class="comment">//å½“å·¦è¾¹ç­‰äºå³è¾¹ åœæ­¢</span></span><br><span class="line">            <span class="keyword">if</span> (nums[left]*nums[left] &lt; nums[right]*nums[right])&#123; <span class="comment">//ä¸¤è¾¹åˆ¤æ–­å¤§å° å³è¾¹å¤§</span></span><br><span class="line">                result[k--] = nums[right]*nums[right]; <span class="comment">//å¤§çš„æ’å…¥æœ€æ–°æ•°ç»„å³è¾¹ å³è¾¹ä¸‹æ ‡-1</span></span><br><span class="line">                right--; <span class="comment">//å³ç•Œé™å¾€å†…ç§»1</span></span><br><span class="line">            &#125;<span class="keyword">else</span>&#123; <span class="comment">//å·¦è¾¹å¤§</span></span><br><span class="line">                result[k--] = nums[left]*nums[left]; <span class="comment">//å¤§çš„æ’å…¥æœ€æ–°æ•°ç»„å³è¾¹ å·¦è¾¹ä¸‹æ ‡-1</span></span><br><span class="line">                left++; <span class="comment">//å·¦ç•Œé™å¾€å†…ç§»1</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//P189 è½®è½¬æ•°ç»„</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">rotate</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> k)</span> &#123;</span><br><span class="line">        <span class="comment">//int count = nums.length;</span></span><br><span class="line">        <span class="comment">//int newNums[] = new int[count];</span></span><br><span class="line">        <span class="comment">//for (int i = 0; i &lt; count; i++) &#123;</span></span><br><span class="line">        <span class="comment">//    newNums[(i+k) % count] = nums[i];</span></span><br><span class="line">        <span class="comment">//&#125;</span></span><br><span class="line">        <span class="comment">//System.arraycopy(newNums, 0, nums, 0, count); //æ‰“å°</span></span><br><span class="line">        reversal(nums,<span class="number">0</span>,nums.length-<span class="number">1</span>);</span><br><span class="line">        reversal(nums,<span class="number">0</span>,k-<span class="number">1</span>);</span><br><span class="line">        reversal(nums,k,nums.length-<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//åè½¬ ä¸‹æ ‡ä¸ºstart å’Œ end é—´çš„åè½¬</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span>[] reversal(<span class="type">int</span>[] nums,<span class="type">int</span> start,<span class="type">int</span> end)&#123;</span><br><span class="line">        <span class="keyword">while</span> (start&lt;end)&#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">temp</span> <span class="operator">=</span> nums[start];</span><br><span class="line">            nums[start] = nums[end];</span><br><span class="line">            nums[end] = temp;</span><br><span class="line">            start++;</span><br><span class="line">            end--;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> nums;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//P283ç§»åŠ¨ã€‡</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">moveZeroes</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> nums.length,left = <span class="number">0</span>,right = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (right &lt; n) &#123;</span><br><span class="line">            <span class="keyword">if</span>(nums[right] != <span class="number">0</span>)&#123;</span><br><span class="line">                res(nums,left,right);</span><br><span class="line">                left++;</span><br><span class="line">            &#125;</span><br><span class="line">            right++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">res</span><span class="params">(<span class="type">int</span>[] nums,<span class="type">int</span> x,<span class="type">int</span> y)</span>&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">temp</span> <span class="operator">=</span> nums[x];</span><br><span class="line">        nums[x] = nums[y];</span><br><span class="line">        nums[y] = temp;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//p344 åè½¬å­—ç¬¦ä¸²</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">reverseString</span><span class="params">(<span class="type">char</span>[] s)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">left</span> <span class="operator">=</span> <span class="number">0</span>,right = s.length-<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span>(left &lt;= right)&#123;</span><br><span class="line">            <span class="type">char</span> <span class="variable">temp</span> <span class="operator">=</span> s[left];</span><br><span class="line">            s[left] = s[right];</span><br><span class="line">            s[right] = temp;</span><br><span class="line">            left++;</span><br><span class="line">            right--;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//åŠ›æ‰£P1832 å…¨å­—æ¯å¥</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">checkIfPangram</span><span class="params">(String sentence)</span> &#123;</span><br><span class="line">        <span class="type">boolean</span>[] booleans = <span class="keyword">new</span> <span class="title class_">boolean</span>[<span class="number">26</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; sentence.length(); i++) &#123;</span><br><span class="line">            <span class="type">char</span> <span class="variable">c</span> <span class="operator">=</span> sentence.charAt(i);</span><br><span class="line">            booleans[c - <span class="string">&#x27;a&#x27;</span>] = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">boolean</span> x : booleans)&#123;</span><br><span class="line">            <span class="keyword">if</span> (!x)&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//åŠ›æ‰£217</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">containsDuplicate</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        Set&lt;Integer&gt; set = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;Integer&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> x : nums) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!set.add(x)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//p1 ä¸¤æ•°ä¹‹å’Œä¼˜è§£</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span>[] twoSum(<span class="type">int</span>[] nums, <span class="type">int</span> target) &#123;</span><br><span class="line">        Map&lt;Integer, Integer&gt; hashtable = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;Integer, Integer&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; nums.length; ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span> (hashtable.containsKey(target - nums[i])) &#123; <span class="comment">//æ˜¯å¦æœ‰è¯¥key</span></span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">int</span>[]&#123;hashtable.get(target - nums[i]), i&#125;;</span><br><span class="line">            &#125;</span><br><span class="line">            hashtable.put(nums[i], i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//P3 æ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">lengthOfLongestSubstring</span><span class="params">(String s)</span> &#123;</span><br><span class="line">        HashMap&lt;Character, Integer&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="type">int</span> <span class="variable">max</span> <span class="operator">=</span> <span class="number">0</span>, start = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">end</span> <span class="operator">=</span> <span class="number">0</span>; end &lt; s.length(); end++) &#123;</span><br><span class="line">            <span class="type">char</span> <span class="variable">ch</span> <span class="operator">=</span> s.charAt(end);</span><br><span class="line">            <span class="keyword">if</span> (map.containsKey(ch))&#123;</span><br><span class="line">                start = Math.max(map.get(ch)+<span class="number">1</span>,start);</span><br><span class="line">            &#125;</span><br><span class="line">            max = Math.max(max,end - start + <span class="number">1</span>);</span><br><span class="line">            map.put(ch,end);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> max;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//p53æœ€å¤§æ•°ç»„</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maxSubArray</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> nums[<span class="number">0</span>], previous = nums[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i :nums)&#123;</span><br><span class="line">            previous = Math.max(previous+i, i);</span><br><span class="line">            ans = Math.max(previous, ans);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//p88</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">merge</span><span class="params">(<span class="type">int</span>[] nums1, <span class="type">int</span> m, <span class="type">int</span>[] nums2, <span class="type">int</span> n)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">p1</span> <span class="operator">=</span> m -<span class="number">1</span>,p2 = n -<span class="number">1</span>,length = m + n -<span class="number">1</span>,i;</span><br><span class="line">        <span class="keyword">while</span> (p1&gt;=<span class="number">0</span> || p2 &gt;= <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span> (p1 == -<span class="number">1</span>)&#123;</span><br><span class="line">                i = nums2[p2--];</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(p2 == -<span class="number">1</span>)&#123;</span><br><span class="line">                i = nums1[p1--];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (nums1[p1] &lt; nums2[p2])&#123;</span><br><span class="line">                i = nums2[p2--];</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                i = nums1[p1--];</span><br><span class="line">            &#125;</span><br><span class="line">            nums1[length--] = i;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">reverseWords</span><span class="params">(String x)</span> &#123;</span><br><span class="line">        String[] s = x.split(<span class="string">&quot; &quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; s.length; i++) &#123;</span><br><span class="line">            <span class="type">StringBuffer</span> <span class="variable">stringBuffer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuffer</span>(s[i]);</span><br><span class="line">            s[i] = stringBuffer.reverse().toString();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> String.join(<span class="string">&quot; &quot;</span>,s);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//P19 åˆ é™¤é“¾è¡¨å€’æ•°ç¬¬Nä¸ªç»“ç‚¹</span></span><br><span class="line">    <span class="keyword">public</span> ListNode <span class="title function_">removeNthFromEnd</span><span class="params">(ListNode head, <span class="type">int</span> n)</span> &#123;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">dummy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ListNode</span>(<span class="number">0</span>, head);</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">first</span> <span class="operator">=</span> head;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">second</span> <span class="operator">=</span> dummy;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; ++i) &#123;</span><br><span class="line">            first = first.next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span> (first != <span class="literal">null</span>) &#123;</span><br><span class="line">            first = first.next;</span><br><span class="line">            second = second.next;</span><br><span class="line">        &#125;</span><br><span class="line">        second.next = second.next.next;</span><br><span class="line">        <span class="keyword">return</span> dummy.next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//åŠ›æ‰£P1672</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maximumWealth</span><span class="params">(<span class="type">int</span>[][] accounts)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">max</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span>[] i: accounts)&#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">max1</span> <span class="operator">=</span><span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> k : i)&#123;</span><br><span class="line">                max1 += k;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (max1 &gt; max)&#123;</span><br><span class="line">                max = max1;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> max;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿˜æ²¡æ€ä¹ˆå­¦ä¹ çš„é“¾è¡¨é¢˜ç›®ä¸­ä¹Ÿæœ‰å‡ é“ï¼Œåé¢å­¦æ•°æ®ç»“æ„çš„æ—¶å€™å†å·©å›ºä¸€ä¸‹ è‡ªå®šä¹‰é“¾è¡¨ä»£ç å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> December;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ListNode</span> &#123;</span><br><span class="line">    <span class="type">int</span> val;</span><br><span class="line">    ListNode next;</span><br><span class="line">    ListNode() &#123;&#125;</span><br><span class="line">    ListNode(<span class="type">int</span> val) &#123; <span class="built_in">this</span>.val = val; &#125;</span><br><span class="line">    ListNode(<span class="type">int</span> val, ListNode next) &#123; <span class="built_in">this</span>.val = val; <span class="built_in">this</span>.next = next; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åŠ›æ‰£é¢˜è®°">åŠ›æ‰£é¢˜è®°</h2><h3 id="åŠ›æ‰£P1673è´ªå¿ƒç®—æ³•">åŠ›æ‰£P1673è´ªå¿ƒç®—æ³•</h3><ul><li>è‡ªå·±åŠæš´åŠ›åšå‡ºæ¥çš„ é¢˜è§£éƒ½ç”¨äº†æ•°æ®æ ˆ æ‰€ä»¥88ä¸ªç‚¹åªè¿‡äº†86ä¸ª åé¢å­¦æ•°æ®æ ˆå›å¤´å†æ¥åšä¸€ä¸‹</li></ul><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/image-20230109223549100.png" alt="image-20230109223549100"></p><ul><li>æ²¡è¿‡çš„åŸå› è‡ªå·±ä¹ŸçŸ¥é“ï¼Œå› ä¸ºè‡ªå·±ç©ºé—´å¤æ‚åº¦æ˜¯k*nums.lengthä¹Ÿå°±æ˜¯æ‰€éœ€è¦çš„æ•°ç»„é•¿åº¦å’ŒåŸæ•°ç»„çš„é•¿åº¦çš„å¾ªç¯æ¬¡æ•° ä¸‹é¢æ˜¯è‡ªå·±çš„ä»£ç </li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span>[] mostCompetitive(<span class="type">int</span>[] nums, <span class="type">int</span> k) &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">len</span>  <span class="operator">=</span> nums.length;</span><br><span class="line">    <span class="type">int</span>[] ints = <span class="keyword">new</span> <span class="title class_">int</span>[k];</span><br><span class="line">    <span class="type">int</span> min=<span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">start</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="comment">//æ€è·¯:ä»å€’æ•°kä¹‹å‰å…ˆæ‰¾æœ€å°å€¼(é˜²æ­¢kå–ä¸å¤Ÿ) ç„¶åä»è¯¥ç´¢å¼•å†å¼€å§‹ å–çš„ä½ç½®å¯ä»¥å¾€åç§»ä¸€æ ¼ ä»¥æ­¤ç±»æ¨</span></span><br><span class="line"> </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> <span class="number">0</span>;x&lt;k;x++)&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> start; n &lt; len-k+x;n++)&#123;</span><br><span class="line">            <span class="keyword">if</span> (nums[min] &gt; nums[n+<span class="number">1</span>])&#123;</span><br><span class="line">                min = n+<span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        ints[x] = nums[min];</span><br><span class="line">        start = min;</span><br><span class="line">        min +=<span class="number">1</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ints;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ä½†æ˜¯pythonä¸­ä¼¼ä¹æ¯”è¾ƒç®€å•ï¼Œå› ä¸ºå¯ä»¥ä»å°¾éƒ¨åˆ é™¤ï¼Œæˆ‘ç”¨javaæ¨¡ä»¿çš„è¯ï¼Œæ¨¡ä»¿å‡ºæ¥éœ€è¦æ–°å»ºä¸€ä¸ªarrayList</li><li>é¢˜è§£åŸç†ï¼šçœ‹äº†å¾ˆä¹…æ‰æ˜ç™½é¢˜è§£ä»£ç çš„å·§å¦™ä¹‹å¤„å…ˆæŠŠæ•°ç»„ä¸­å€¼åŠ ä¸€ä¸ªåˆ°åˆ—è¡¨ï¼Œç„¶åå¦‚æœè¯¥å€¼ä¸æ»¡è¶³ä¸‰ä¸ªä»»ä½•æ¡ä»¶ä¸­ä¸€ä¸ª(ä»£ç ä¸­æœ‰)ï¼Œå°±å†å¾€åˆ—è¡¨åŠ å…¥ä¸€ä¸ªæ•°ç»„çš„å€¼ï¼Œå†æŠŠæ–°åŠ å…¥çš„å€¼å’Œåé¢çš„æ•°ç»„çš„å€¼æ¯”ï¼Œå¦‚æœæ¯”åé¢çš„å¤§å°±åˆ é™¤ã€‚å¦‚æ­¤ä¸€ç›´ï¼Œç›´åˆ°åˆ é™¤çš„æ•°å¤Ÿäº†(æ¯”å¦‚æ•°ç»„é•¿åº¦æ˜¯10ï¼Œæˆ‘éœ€è¦æ•°ç»„é•¿åº¦ä¸º3çš„æœ€å…·ç«äº‰åŠ›çš„ï¼Œé‚£æˆ‘éœ€è¦æŠŠåŸæ•°ç»„çš„å€¼åˆ é™¤7æ¬¡ï¼Œåªè¦3ä¸ªå€¼)ï¼Œéœ€è¦çš„æœ€å…·ç«äº‰åŠ›çš„æ•°ç»„ä¹Ÿå¤Ÿäº†ã€‚</li></ul><blockquote><p>ä¸‹é¢æ˜¯pythonå’Œjavaå¯¹è¯¥é¢˜ä½¿ç”¨å•è°ƒæ ˆçš„ä»£ç å¯¹æ¯”</p></blockquote><div class="tabs" id="contrast"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#contrast-1">pythonä»£ç </button></li><li class="tab"><button type="button" data-href="#contrast-2">javaä»£ç </button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="contrast-1"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">mostCompetitive</span>(<span class="params">self, nums, k</span>):</span><br><span class="line">        stack = []</span><br><span class="line">        n = <span class="built_in">len</span>(nums)</span><br><span class="line">        last = n-k</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">            <span class="keyword">while</span> stack <span class="keyword">and</span> last <span class="keyword">and</span> stack[-<span class="number">1</span>] &gt; nums[i]:</span><br><span class="line">                stack.pop()</span><br><span class="line">                last -= <span class="number">1</span></span><br><span class="line">            stack.append(nums[i])</span><br><span class="line">        <span class="keyword">return</span> stack[:k]</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="contrast-2"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span>[] mostCompetitive(<span class="type">int</span>[] nums, <span class="type">int</span> k) &#123;</span><br><span class="line">        ArrayList&lt;Integer&gt; stack = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Integer&gt;();</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> nums.length;</span><br><span class="line">        <span class="type">int</span> <span class="variable">last</span> <span class="operator">=</span> n-k;</span><br><span class="line">        <span class="comment">//æ ¸å¿ƒä»£ç æ˜¯ä¸‹é¢çš„å¾ªç¯</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i ++) &#123;</span><br><span class="line">            <span class="keyword">while</span> (stack.size()&gt;<span class="number">0</span> &amp;&amp; last&gt;<span class="number">0</span> &amp;&amp; stack.get(stack.size()-<span class="number">1</span>)&gt;nums[i]) &#123;</span><br><span class="line">                stack.remove(stack.size()-<span class="number">1</span>);</span><br><span class="line">                last --;</span><br><span class="line">            &#125;</span><br><span class="line">            stack.add(nums[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span>[] res = <span class="keyword">new</span> <span class="title class_">int</span>[k];</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; k; i++)&#123;</span><br><span class="line">            res[i] = stack.get(i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h3 id="åŠ›æ‰£P136-å¼‚æˆ–ç®—æ³•">åŠ›æ‰£P136 å¼‚æˆ–ç®—æ³•</h3><blockquote><p>é¢˜ç›®ä¸éš¾ ç®€å•æ¥è¯´å°±æ˜¯æ‰¾å‡ºæ•°ç»„ä¸­åªå­˜åœ¨ä¸€ä¸ªçš„æ•° å…¶ä»–çš„æ•°å­—éƒ½æ˜¯å‡ºç°è¿‡ä¸¤æ¬¡ æ‰¾åªå‡ºç°è¿‡ä¸€æ¬¡çš„é‚£ä¸ªæ•°                      åˆ©ç”¨åˆ°äº†  å¼‚æˆ–ä¸­çš„äº¤æ¢å¾‹ æ•°ç»„ä¸­æ‰€æœ‰çš„æ•°éƒ½å¼‚æˆ– æœ‰ä¸¤ä¸ªçš„ éƒ½ä¼šå˜æˆ0 æœ€ååªä¼šå‰©ä¸‹å‡ºç°è¿‡ä¸€æ¬¡çš„æ•°</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">singleNumber</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;nums.length;i++)&#123;</span><br><span class="line">              nums[<span class="number">0</span>] ^= nums[i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> nums[<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åŠ›æ‰£P15-åŒæŒ‡é’ˆ">åŠ›æ‰£P15 åŒæŒ‡é’ˆ</h3><blockquote><p>é¢˜ç›®ä¸ºç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ <code>nums</code> ï¼Œåˆ¤æ–­æ˜¯å¦å­˜åœ¨ä¸‰å…ƒç»„ <code>[nums[i], nums[j], nums[k]]</code> æ»¡è¶³ <code>i != j</code>ã€<code>i != k</code> ä¸” <code>j != k</code> ï¼ŒåŒæ—¶è¿˜æ»¡è¶³ <code>nums[i] + nums[j] + nums[k] == 0</code> ã€‚è¯·ä½ è¿”å›æ‰€æœ‰å’Œä¸º <code>0</code> ä¸”ä¸é‡å¤çš„ä¸‰å…ƒç»„ã€‚</p><p>éš¾ç‚¹åœ¨é˜²æ­¢é‡å¤çš„åœ°æ–¹  ä»£ç è®²è§£ç‚¹éƒ½åœ¨ä»£ç ä¸­äº†</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">threeSum</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">    Arrays.sort(nums); <span class="comment">//å…ˆæ’åº</span></span><br><span class="line">    List&lt;List&lt;Integer&gt;&gt; res = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(); <span class="comment">//åˆ›å»ºä¸€ä¸ªlisté‡Œé¢å¥½æ·»åŠ éœ€è¦çš„æ•°æ®</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> <span class="number">0</span>; x &lt; nums.length - <span class="number">2</span>; x++) &#123; <span class="comment">//å¾ªç¯ç›´åˆ°å€’æ•°ç¬¬ä¸‰ä¸ª</span></span><br><span class="line">        <span class="keyword">if</span> (nums[x] &gt; <span class="number">0</span>) <span class="keyword">break</span>; <span class="comment">//å¦‚æœç¬¬ä¸€ä½å¤§äº0 æ€»å’Œå°±æ°¸è¿œä¸ä¼šå°äº0</span></span><br><span class="line">        <span class="keyword">if</span> (x &gt; <span class="number">0</span> &amp;&amp; nums[x] == nums[x - <span class="number">1</span>]) <span class="keyword">continue</span>; <span class="comment">//å¦‚æœè¯¥æ•°å’Œå‰ä¸€ä½ç›¸åŒ æš‚åœæœ¬æ¬¡å¾ªç¯ é˜²æ­¢é‡å¤æ•°æ®</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">y</span> <span class="operator">=</span> x + <span class="number">1</span>, z = nums.length - <span class="number">1</span>;  <span class="comment">//è®¾ç½®å·¦å’Œå³æŒ‡é’ˆ</span></span><br><span class="line">        <span class="keyword">while</span> (y &lt; z) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> nums[x] + nums[y] + nums[z]; <span class="comment">//ç›¸åŠ çš„æ€»å’Œå€¼</span></span><br><span class="line">            <span class="keyword">if</span> (sum &lt; <span class="number">0</span>) &#123; <span class="comment">//å°äº0 å·¦æŒ‡é’ˆ å‘å³</span></span><br><span class="line">                y++;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (sum &gt; <span class="number">0</span>) &#123; <span class="comment">//å¤§äº0 å³æŒ‡é’ˆå‘å·¦</span></span><br><span class="line">                z--;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                res.add(<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Integer&gt;(Arrays.asList(nums[x], nums[y], nums[z])));</span><br><span class="line">                <span class="keyword">while</span> (y &lt; z &amp;&amp; nums[y] == nums[++y]) ; <span class="comment">//å½“æ¡ä»¶æ»¡è¶³æ—¶ ä¸ºæ»¡è¶³ä¸é‡å¤çš„ä¸‰å…ƒç»„ å·¦å³æŒ‡é’ˆçš„å€¼å°±ä¸èƒ½è·ŸåŸæ¥ä¸€æ ·äº† åŠ å…¥whileå¾ªç¯ ç›´åˆ°æŒ‡é’ˆåŒºé—´çš„ä¸¤è¾¹ è·Ÿæ»¡è¶³æ¡ä»¶çš„æ—¶å€™ä¸åŒ</span></span><br><span class="line">                <span class="keyword">while</span> (y &lt; z &amp;&amp; nums[z] == nums[--z]) ;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="è“æ¡¥æ¯é¢˜åº“">è“æ¡¥æ¯é¢˜åº“</h2><h3 id="ç¼–å·2120">ç¼–å·2120</h3><p>é¢˜ç›®ä¸éš¾ï¼Œæ‰¾åˆ°è§„å¾‹å°±è¡Œäº†ã€‚</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/image-20230315093825402.png" alt="image-20230315093825402"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">Scanner</span> <span class="variable">scan</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">    <span class="comment">//åœ¨æ­¤è¾“å…¥æ‚¨çš„ä»£ç ...</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">Ax</span> <span class="operator">=</span> scan.nextLine();</span><br><span class="line">    <span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> Integer.parseInt(Ax.substring(<span class="number">1</span>));</span><br><span class="line">    <span class="type">int</span>[] a = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">6</span>]; <span class="comment">//A9è¶…å‡º æ‰€ä»¥è®¾ç½®6ä¸ª</span></span><br><span class="line">    <span class="type">int</span>[] b = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">5</span>];</span><br><span class="line">    <span class="type">int</span> <span class="variable">aNumOne</span> <span class="operator">=</span> <span class="number">1189</span>; <span class="comment">//å®šä¹‰åˆå§‹å€¼</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">bNumOne</span> <span class="operator">=</span> <span class="number">841</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;i&lt;<span class="number">6</span>;i++)&#123;</span><br><span class="line">        a[i] = aNumOne;</span><br><span class="line">        aNumOne = aNumOne / <span class="number">2</span>; <span class="comment">//å–æ•´æ·»åŠ </span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>;j&lt;<span class="number">5</span>;j++)&#123;</span><br><span class="line">        b[j] = bNumOne;</span><br><span class="line">        bNumOne = bNumOne / <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(num%<span class="number">2</span>==<span class="number">0</span>)&#123;</span><br><span class="line">        System.out.println(a[num/<span class="number">2</span>]);<span class="comment">//å¶æ•°æŒ‰ç´¢å¼•å–æ•°ç»„</span></span><br><span class="line">        System.out.println(b[num/<span class="number">2</span>]);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        System.out.println(b[(num-<span class="number">1</span>)/<span class="number">2</span>]);<span class="comment">//å¥‡æ•°æ•°å‰åå–å¤´</span></span><br><span class="line">        System.out.println(a[(num+<span class="number">1</span>)/<span class="number">2</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    scan.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ç¼–å·468">ç¼–å·468</h3><p>å›æ–‡æ—¥æœŸ</p><blockquote><p>é¢˜ç›®å¾ˆæ¸…æ™°æ˜äº†ï¼Œä½†æ˜¯éœ€è¦è®¨è®ºçš„ç‰¹æ®Šæ¡ä»¶æ¯”è¾ƒå¤šã€‚å°±æ˜¯æ—¥æœŸè§„èŒƒæ€§ï¼Œæ¯ä¸ªæœˆæ¯ä¸ªå¤©æ•°ä¸ä¸€æ ·ï¼Œè¿˜æœ‰æ—¥æœŸå¼€å¤´ä¸ä¸º0ï¼Œå­¦ä»½12æœˆä»¥å†…ï¼Œä¸å¯ä¸º0ï¼Œç­‰ç­‰ã€‚åœ¨æˆ‘æœ€åˆçš„ç‰ˆæœ¬éƒ½æ˜¯æœ‰ä¸€æ¡ä¸€æ¡ifè§„èŒƒå‡ºæ¥çš„ã€‚åæ¥ä¼˜åŒ–ç®—æ³•çš„æ—¶å€™ï¼Œå‘ç°æœ‰äº›æµ‹è¯•ç‚¹ï¼Œè“æ¡¥æ¯æ˜¯æ²¡æœ‰è®¾ç½®ä¸€äº›ç‰¹æ®Šæ£€æŸ¥ç‚¹çš„æ‰€ä»¥åƒ30å¤©å’Œ28 29è¿™ç§ç‰¹æ®Šæœˆã€‚æ‰€ä»¥åé¢é—°æœˆå’Œ2æœˆéƒ½æ²¡ç”¨æ·»åŠ åˆ¤æ–­è¯­å¥ï¼Œä½†æ˜¯ä¹Ÿé¡ºåˆ©é€šè¿‡äº†ï¼Œè€—æ—¶æœ‰ç‚¹ä¹…ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="comment">// 1:æ— éœ€package</span></span><br><span class="line"><span class="comment">// 2: ç±»åå¿…é¡»Main, ä¸å¯ä¿®æ”¹</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">scan</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">        <span class="comment">//åœ¨æ­¤è¾“å…¥æ‚¨çš„ä»£ç ...</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">N</span> <span class="operator">=</span> scan.nextInt();</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> N+<span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">res</span> <span class="operator">=</span> <span class="number">99999999</span>;</span><br><span class="line">        <span class="keyword">while</span>(i&lt;=<span class="number">99999999</span>)&#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">num</span> <span class="operator">=</span> i+<span class="string">&quot;&quot;</span>;</span><br><span class="line">            <span class="type">int</span> <span class="variable">yearage</span>  <span class="operator">=</span> i/<span class="number">1000000</span>;</span><br><span class="line">            <span class="type">int</span> <span class="variable">fanzhuanyearage</span> <span class="operator">=</span> yearage/<span class="number">10</span>+yearage%<span class="number">10</span>*<span class="number">10</span>;<span class="comment">//åè½¬day</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">yearlaster</span>  <span class="operator">=</span> i%<span class="number">1000000</span>/<span class="number">10000</span>;</span><br><span class="line">            <span class="type">int</span> <span class="variable">fanzhuanyearlaster</span>  <span class="operator">=</span> yearlaster/<span class="number">10</span>+yearlaster%<span class="number">10</span>*<span class="number">10</span>; <span class="comment">//åè½¬month</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">month</span> <span class="operator">=</span> i%<span class="number">10000</span>/<span class="number">100</span>;</span><br><span class="line">            <span class="type">int</span> <span class="variable">day</span>   <span class="operator">=</span> i%<span class="number">100</span>;</span><br><span class="line">            <span class="type">int</span> <span class="variable">lastday</span> <span class="operator">=</span> i%<span class="number">10</span>; <span class="comment">//æœ€åä¸€å¤©ä¸èƒ½ä¸º0 å› ä¸ºåè½¬ä»¥åé¦–ä¸ä¸º0</span></span><br><span class="line">            <span class="keyword">if</span>(month &lt;= <span class="number">12</span> &amp;&amp;  day &lt;= <span class="number">31</span> &amp;&amp;  lastday != <span class="number">0</span> &amp;&amp; fanzhuanyearage&lt;=<span class="number">31</span> &amp;&amp; fanzhuanyearlaster&lt;=<span class="number">12</span> &amp;&amp; fanzhuanyearlaster != <span class="number">0</span>)&#123;</span><br><span class="line">              <span class="keyword">if</span>(huiwen(num))&#123;</span><br><span class="line">                 <span class="comment">//è®¾ç½®å›æ–‡ ä¸ºç¬¬ä¸€ä¸ª  </span></span><br><span class="line">                <span class="keyword">if</span>(res &gt; Integer.parseInt(num))&#123;</span><br><span class="line">                    res = Integer.parseInt(num);</span><br><span class="line">                    System.out.println(num);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//å¦‚æœä¸ºABå›æ–‡ç›´æ¥åœæ­¢</span></span><br><span class="line">                <span class="keyword">if</span>(ABhuiwen(num))&#123;</span><br><span class="line">                    System.out.println(num);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            i++;</span><br><span class="line">        &#125;</span><br><span class="line">        scan.close();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//åˆ¤æ–­é—°å¹´</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">ruiyear</span><span class="params">(String num)</span>&#123;</span><br><span class="line">      <span class="type">int</span> <span class="variable">year</span> <span class="operator">=</span> Integer.parseInt(num);</span><br><span class="line">      <span class="keyword">return</span> (year % <span class="number">4</span> == <span class="number">0</span> &amp;&amp; year % <span class="number">100</span> != <span class="number">0</span>) || year % <span class="number">400</span> == <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//åˆ¤æ–­å›æ–‡æ•°</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">huiwen</span><span class="params">(String num)</span>&#123;</span><br><span class="line">      <span class="type">char</span>[] c  = num.toCharArray();</span><br><span class="line">      <span class="keyword">return</span> c[<span class="number">0</span>] == c[<span class="number">7</span>] &amp;&amp; c[<span class="number">1</span>] == c[<span class="number">6</span>] &amp;&amp; c[<span class="number">2</span>] == c[<span class="number">5</span>] &amp;&amp; c[<span class="number">3</span>] == c[<span class="number">4</span>];</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//åˆ¤æ–­ABå›æ–‡æ•°</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">ABhuiwen</span><span class="params">(String num)</span>&#123;</span><br><span class="line">      <span class="type">char</span>[] c  = num.toCharArray();</span><br><span class="line">      <span class="keyword">return</span> c[<span class="number">0</span>] == c[<span class="number">2</span>] &amp;&amp; c[<span class="number">2</span>] == c[<span class="number">5</span>] &amp;&amp; c[<span class="number">5</span>] == c[<span class="number">7</span>] &amp;&amp; c[<span class="number">1</span>] == c[<span class="number">3</span>] &amp;&amp; c[<span class="number">3</span>] == c[<span class="number">4</span>] &amp;&amp; c[<span class="number">4</span>] == c[<span class="number">6</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ä»Šæ—¥å°çˆ¬è™«">ä»Šæ—¥å°çˆ¬è™«</h2><p>1æœˆ27å· æŠ–éŸ³åˆ·åˆ°ä¸€ä¸ªJavaçˆ¬è™«çš„æ¡ˆä¾‹ è‡ªå·±è¯•ç€æ›´æ”¹æ•²äº†ä¸€é</p><blockquote><p>éš¾ç‚¹åœ¨ä¸¤æ¬¡è¿æ¥ æ‰€è¦å®ç°çš„ä»£ç åŠŸèƒ½ä¸º åˆ©ç”¨javaçˆ¬è™«çˆ¬å–è¯¥é¡µé¢ä¸­ï¼Œç‚¹å‡»å›¾ç‰‡åè·³è½¬çš„é“¾æ¥ä¸­çš„é«˜æ¸…èƒŒæ™¯å›¾</p></blockquote><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/image-20230127143522704.png" alt="image-20230127143522704"></p><blockquote><p>è·³è½¬åçš„é¡µé¢ æˆ‘æ‹¿èµµæ€€çœŸä¸¾ä¾‹ æ£€æŸ¥ä¸­åˆ©ç”¨æ ‡ç­¾å¦‚ä½•ä½¿ç”¨ å·²ç»å†™åœ¨å›¾ç‰‡ä¸­äº†</p></blockquote><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/image-20230127144106376.png" alt="image-20230127144106376"></p><p>ä½¿ç”¨IDEA éœ€è¦å¯¼å…¥jsoupåŒ…</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> htmlPhoto;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.jsoup.Connection;</span><br><span class="line"><span class="keyword">import</span> org.jsoup.Jsoup;</span><br><span class="line"><span class="keyword">import</span> org.jsoup.nodes.Document;</span><br><span class="line"><span class="keyword">import</span> org.jsoup.nodes.Element;</span><br><span class="line"><span class="keyword">import</span> org.jsoup.select.Elements;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.FileOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.net.URL;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">htmlPhoto</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">//Javaçˆ¬è™«</span></span><br><span class="line">        <span class="comment">//1.å»ºç«‹è¿æ¥</span></span><br><span class="line">        <span class="comment">//ç½‘é¡µé“¾æ¥ https://pvp.qq.com/web201605/herolist.shtml</span></span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> Jsoup.connect(<span class="string">&quot;https://pvp.qq.com/web201605/herolist.shtml&quot;</span>);</span><br><span class="line">        <span class="comment">//é€šè¿‡é“¾æ¥è·å– Documentå¯¹è±¡</span></span><br><span class="line">        <span class="type">Document</span> <span class="variable">document</span> <span class="operator">=</span> connection.get();</span><br><span class="line">        <span class="comment">//2.æ‰¾åˆ°ulæ ‡ç­¾å¯¹è±¡</span></span><br><span class="line">        <span class="comment">//é€šè¿‡Documentå¯¹è±¡ æ‰¾classä¸º herolist clearfixçš„ul</span></span><br><span class="line">        <span class="type">Element</span> <span class="variable">elementUl</span> <span class="operator">=</span> document.selectFirst(<span class="string">&quot;[class=herolist clearfix]&quot;</span>);</span><br><span class="line">        <span class="comment">//æ‰¾ulä¸­çš„li</span></span><br><span class="line">        <span class="keyword">assert</span> elementUl != <span class="literal">null</span>;</span><br><span class="line">        <span class="type">Elements</span> <span class="variable">elementLis</span> <span class="operator">=</span> elementUl.select(<span class="string">&quot;li&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3.for å¾ªç¯è¯»å–lié›†åˆ</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">countHero</span> <span class="operator">=</span> <span class="number">0</span>; <span class="comment">//å…±è®¡ä¸‹è½½çš„å›¾ç‰‡æ•°é‡</span></span><br><span class="line">        <span class="keyword">for</span> (Element elementLi:elementLis)&#123;</span><br><span class="line">            <span class="comment">//å¾—åˆ°liä¸­çš„a-hrefçš„è·¯å¾„</span></span><br><span class="line">            <span class="type">Element</span> <span class="variable">elementA</span> <span class="operator">=</span> elementLi.selectFirst(<span class="string">&quot;a&quot;</span>);</span><br><span class="line">            <span class="comment">//aæ ‡ç­¾ä¸­é—´çš„åå­—</span></span><br><span class="line">            <span class="keyword">assert</span> elementA != <span class="literal">null</span>;</span><br><span class="line">            <span class="type">String</span> <span class="variable">heroName</span> <span class="operator">=</span> elementA.text();</span><br><span class="line">            <span class="comment">//è·å–hrefçš„å†…å®¹ ç„¶åæ‹¼æ¥å‰é¢çš„é“¾æ¥</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">hrefUrl</span> <span class="operator">=</span> elementA.attr(<span class="string">&quot;href&quot;</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">path</span> <span class="operator">=</span> <span class="string">&quot;https://pvp.qq.com/web201605/&quot;</span> + hrefUrl;</span><br><span class="line">            <span class="comment">//åˆ›å»ºæ–°çš„è¿æ¥</span></span><br><span class="line">            <span class="type">Connection</span> <span class="variable">connect</span> <span class="operator">=</span> Jsoup.connect(path);</span><br><span class="line">            <span class="comment">//æ ¹æ®é“¾æ¥åˆ›å»ºæ–°çš„documentå¯¹è±¡</span></span><br><span class="line">            <span class="type">Document</span> <span class="variable">newDocument</span> <span class="operator">=</span> connect.get();</span><br><span class="line">            <span class="type">Element</span> <span class="variable">elementDiv</span> <span class="operator">=</span> newDocument.selectFirst(<span class="string">&quot;[class=zk-con1 zk-con]&quot;</span>);</span><br><span class="line">            <span class="comment">//è·å–elementä¸­çš„styleå±æ€§</span></span><br><span class="line">            <span class="keyword">assert</span> elementDiv != <span class="literal">null</span>;</span><br><span class="line">            <span class="type">String</span> <span class="variable">backgroundURL</span> <span class="operator">=</span> elementDiv.attr(<span class="string">&quot;style&quot;</span>);</span><br><span class="line">            <span class="comment">//background:url(&#x27;//game.gtimg.cn/images/yxzj/img201606/skin/hero-info/545/545-bigskin-1.jpg&#x27;) center 0</span></span><br><span class="line">            <span class="comment">//è£å‡ºéœ€è¦çš„å›¾ç‰‡åœ°å€ ä¸¤ä¸ªå•å¼•å·ä¸­é—´</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">left</span> <span class="operator">=</span> backgroundURL.indexOf(<span class="string">&quot;&#x27;&quot;</span>);</span><br><span class="line">            <span class="type">int</span> <span class="variable">right</span> <span class="operator">=</span> backgroundURL.lastIndexOf(<span class="string">&quot;&#x27;&quot;</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">photoURL</span> <span class="operator">=</span> backgroundURL.substring(left + <span class="number">1</span>, right);</span><br><span class="line">            <span class="type">URL</span> <span class="variable">url</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">URL</span>(<span class="string">&quot;https:&quot;</span> + photoURL);</span><br><span class="line">            <span class="comment">//å·²ç»è·å–åˆ°äº†å›¾ç‰‡çš„è·¯å¾„ urläº† åªéœ€è¦é€šè¿‡IOæµè¿›è¡Œä¸‹è½½å³å¯</span></span><br><span class="line">            System.out.println(<span class="string">&quot;ä¸‹è½½&quot;</span> + heroName+<span class="string">&quot;çš„é«˜æ¸…1080På›¾ç‰‡...&quot;</span>);</span><br><span class="line">            <span class="comment">//è¾“å…¥æµ è¯»å–åˆšåˆšçš„å›¾ç‰‡</span></span><br><span class="line">            <span class="type">InputStream</span> <span class="variable">is</span> <span class="operator">=</span> url.openStream();</span><br><span class="line">            <span class="comment">//è¾“å‡ºæµ ä¸‹è½½åˆ°æœ¬åœ°</span></span><br><span class="line">            <span class="type">FileOutputStream</span> <span class="variable">fos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;E://IOTest/wzImg/&quot;</span> + heroName + <span class="string">&quot;.jpg&quot;</span>);</span><br><span class="line">            <span class="comment">//ä¸‹è½½å›¾ç‰‡</span></span><br><span class="line">            <span class="type">byte</span>[] bytes = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>];</span><br><span class="line">            <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> is.read(bytes);</span><br><span class="line">            <span class="keyword">while</span> (count!=-<span class="number">1</span>)&#123;</span><br><span class="line">                fos.write(bytes,<span class="number">0</span>,count);</span><br><span class="line">                fos.flush();</span><br><span class="line">                count = is.read(bytes);</span><br><span class="line">            &#125;</span><br><span class="line">            is.close();</span><br><span class="line">            fos.close();</span><br><span class="line">            countHero+=<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;å…±è®¡&quot;</span>+countHero+<span class="string">&quot;ä½è‹±é›„å›¾ç‰‡å…¨éƒ¨ä¸‹è½½å®Œæˆ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ©ç”¨è¯¥æ¡ˆä¾‹ä»¥åŠæ–¹æ³•çš„ä½¿ç”¨ï¼Œå¯ä»¥ç”¨javaçˆ¬è™«åˆ°å¾ˆå¤šä¸åŠ å¯†ç½‘ç«™çš„å›¾ç‰‡æˆ–è€…è§†é¢‘é“¾æ¥ è¿›è¡Œä¸‹è½½ å¦‚å›¾å·²ä¸‹è½½åˆ°è¯¥æ–‡ä»¶å¤¹</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/image-20230127185113640.png" alt="image-20230127185113640"></p><h3 id="BUGç‚¹">BUGç‚¹</h3><p>ç½‘é¡µçš„ä¸€ä¸ªBUGï¼Œæˆ‘çœ‹ç½‘é¡µä¸­113ä¸ªè‹±é›„ï¼Œä¸‹è½½åªæœ‰93ä¸ªã€‚æˆ‘è‡ªå·±çš„ä»£ç æ˜¯æ²¡ä»€ä¹ˆé—®é¢˜çš„ï¼Œç„¶åæ£€æŸ¥ä¸­ä¹Ÿæ˜¯113ä¸ªæ ‡ç­¾ï¼Œå½“æˆ‘ä¸çŸ¥æ‰€æªçš„æ—¶å€™ï¼Œæˆ‘ç‚¹å¼€äº†ç½‘é¡µçš„æºä»£ç ã€‚å‘ç°å…¶ä¸­æ˜¯ä»äº‘ä¸­å›å¼€å§‹çš„ï¼Œä¹Ÿå°±æ˜¯æºä»£ç ä¸­åªæœ‰93è‹±é›„ï¼Œä½†æ˜¯æ£€æŸ¥ä¸­çš„ç¡®è‹±é›„æ•°é‡æ˜¯é½å…¨çš„ï¼Œæ‰€ä»¥åº”è¯¥æ˜¯ä»–ç½‘é¡µçš„ä¸€äº›é—®é¢˜ï¼Œä½†ä¸ºä»€ä¹ˆè¿™æ ·æˆ‘ä¹Ÿä¸æ¸…æ¥šï¼Œæ£€æŸ¥å’Œæºä»£ç ä¸ä¸€æ ·ï¼Œé¡µé¢æ˜¾ç¤ºçš„æ•ˆæœç«Ÿç„¶å’Œæºä»£ç ä¸ä¸€æ ·ã€‚ä½†æ˜¯é—®é¢˜ä¸å¤§ï¼Œæ€è·¯å·²ç»æ¸…æ¥šäº†ã€‚</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/image-20230131191045116.png" alt="image-20230131191045116"></p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/image-20230131191214943.png" alt="image-20230131191214943"></p>]]></content>
    
    
    <summary type="html">ç®—æ³•åˆ·é¢˜</summary>
    
    
    
    <category term="ç®—æ³•" scheme="https://u7u7.top/categories/%E7%AE%97%E6%B3%95/"/>
    
    
    <category term="Java" scheme="https://u7u7.top/tags/Java/"/>
    
    <category term="C++" scheme="https://u7u7.top/tags/C/"/>
    
    <category term="Python" scheme="https://u7u7.top/tags/Python/"/>
    
    <category term="ç®—æ³•" scheme="https://u7u7.top/tags/%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>è™šæ‹Ÿæœºé…ç½®</title>
    <link href="https://u7u7.top/posts/Vm.html"/>
    <id>https://u7u7.top/posts/Vm.html</id>
    <published>2025-06-29T05:00:25.000Z</published>
    <updated>2025-08-03T12:24:07.507Z</updated>
    
    <content type="html"><![CDATA[<h1 id="VMè™šæ‹Ÿæœºcentos7è”ç½‘">VMè™šæ‹Ÿæœºcentos7è”ç½‘</h1><p>æ­£å¸¸åˆ›å»ºcentos7è™šæ‹Ÿæœºè¿›å…¥å‘½ä»¤è¡Œ</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/image-20240820110048592.png" alt="image-20240820110048592"></p><h2 id="DHCPè‡ªåŠ¨è·å–IP">DHCPè‡ªåŠ¨è·å–IP</h2><p>1.é€šè¿‡é•œåƒåˆ›å»ºcentos7çš„æ—¶å€™ç½‘ç»œé€‰æ‹©NATæ¡¥æ¥</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/image-20240820120910717.png" alt="image-20240820120910717"></p><p>2ã€åœ¨VMwareç•Œé¢ï¼ˆç®¡ç†å‘˜æ–¹å¼å¯åŠ¨ï¼‰ç‚¹å‡»â€œç¼–è¾‘â€é‡Œé¢çš„â€œè™šæ‹Ÿç½‘ç»œç¼–è¾‘å™¨â€ï¼Œç¡®è®¤å‹¾é€‰DHCPæœåŠ¡å°†IPåœ°å€åˆ†é…ç»™<a href="https://so.csdn.net/so/search?q=%E8%99%9A%E6%8B%9F%E6%9C%BA&amp;spm=1001.2101.3001.7020">è™šæ‹Ÿæœº</a>ï¼Œå¹¶è®¾ç½®å­ç½‘IP(é»˜è®¤å°±å¥½)ã€‚</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/image-20240820121136836.png" alt="image-20240820121136836"></p><p>3ã€ç‚¹å‡»NATæ¨¡å¼æ—è¾¹çš„â€œNATè®¾ç½®â€ï¼Œç„¶åä¿®æ”¹ä¸å­ç½‘IPåŒç½‘æ®µä¸‹çš„ç½‘å…³IPï¼Œå°±æ˜¯å‰ä¸‰ä½å¿…é¡»ç›¸åŒï¼Œ</p><p>å³192.168.100è¦ç›¸åŒï¼Œæœ€åä¸€ä½æ•°ä¸ç›¸åŒå³å¯ï¼ˆè‡ªåŠ¨è®¾ç½®ï¼Œé»˜è®¤okï¼‰ï¼Œæœ€åç‚¹å‡»â€œç¡®è®¤â€ä¿å­˜è®¾ç½®ã€‚</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/image-20240820121216587.png" alt="image-20240820121216587"></p><p>4.å‘½ä»¤è¡Œï¼Œè¿›ç½‘ç»œé…ç½®æ–‡ä»¶ç›®å½•:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@xxx~]<span class="comment"># cd /etc/sysconfig/network-scripts/ #è¿›ç›®å½•</span></span><br><span class="line">[root@xxx~]<span class="comment"># vi ifcfg-ens33 #ä¿®æ”¹ç½‘ç»œé…ç½®</span></span><br></pre></td></tr></table></figure><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/image-20240820121406202.png" alt="image-20240820121406202"></p><p>5.ç¼–è¾‘ifcfg-ens33æ–‡ä»¶</p><ul><li>ä¿®æ”¹ONBOOT=yeså³å¯</li></ul><p>6<a href="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/image-20240820121528268.png">6!</a></p><p>6.é‡å¯ç½‘å¡åˆ·æ–°ç½‘ç»œé…ç½®</p><p>æ–¹å¼ä¸€:é‡å¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@xxx ~]<span class="comment"># reboot</span></span><br></pre></td></tr></table></figure><p>æ–¹å¼äºŒ:é‡å¯ç½‘å¡</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@192 network-scripts]<span class="comment"># service network restart</span></span><br></pre></td></tr></table></figure><p>7.pingå¤–ç½‘æ£€æŸ¥</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/image-20240820121848247.png" alt="image-20240820121848247"></p>]]></content>
    
    
    <summary type="html">centos7è”ç½‘</summary>
    
    
    
    <category term="æ‚é¡¹" scheme="https://u7u7.top/categories/%E6%9D%82%E9%A1%B9/"/>
    
    
    <category term="é—®é¢˜è§£å†³" scheme="https://u7u7.top/tags/%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3/"/>
    
  </entry>
  
  <entry>
    <title>GoCå›½èµ›ç‰¹è®­(äºŒ)</title>
    <link href="https://u7u7.top/posts/goc02.html"/>
    <id>https://u7u7.top/posts/goc02.html</id>
    <published>2024-07-05T07:34:19.502Z</published>
    <updated>2025-08-20T03:06:52.088Z</updated>
    
    <content type="html"><![CDATA[<h1 id="7æœˆ9æ—¥ç¬¬äºŒæ¬¡è®­ç»ƒé¢˜">7æœˆ9æ—¥ç¬¬äºŒæ¬¡è®­ç»ƒé¢˜</h1><div class="site-card-group"><a class="site-card" href="https://vip.51goc.com/static/gocWebNet/gocWebNet.html?submitBt=0&insert=0&ra=60&winName=20200413"><div class="img"><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/20240629094929.png"/></div><div class="info"><img src=" https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/chengguo.jpg"/><span class="title">gocç¼–è¯‘ç¯å¢ƒ</span><span class="desc">webç«¯</span></div></a></div>  <h2 id="2365çŸ©å½¢å¤–æ¡†B">2365çŸ©å½¢å¤–æ¡†B</h2><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/image-20240623180651332.png" alt="image-20240623180651332"></p><h2 id="2369è…¾å›¾">2369è…¾å›¾</h2><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/image-20240623174555103.png" alt="image-20240623174555103"></p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/image-20240628165336683.png" alt="image-20240628165336683"></p><h2 id="2370å˜åŒ–çš„ç«‹æ–¹ä½“">2370å˜åŒ–çš„ç«‹æ–¹ä½“</h2><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/image-20240623175645692.png" alt="image-20240623175645692"></p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/image-20240623175654138.png" alt="image-20240623175654138"></p><h1 id="6æœˆ29æ—¥è¯¾å ‚ç¬”è®°">6æœˆ29æ—¥è¯¾å ‚ç¬”è®°</h1><h2 id="åæ ‡">åæ ‡</h2><h3 id="ä»€ä¹ˆæ˜¯åæ ‡">ä»€ä¹ˆæ˜¯åæ ‡</h3><p>åæ ‡ç”±ä¸¤ä¸ªæ•°ï¼Œé€šå¸¸æ˜¯(x, y)ï¼Œè¡¨ç¤ºä¸€ä¸ªç‚¹åœ¨æ°´å¹³ å’Œå‚ç›´æ–¹å‘ä¸Šçš„è·ç¦»ã€‚å¦‚å›¾çº¢ç‚¹æ‰€åœ¨çš„ä½ç½®ã€‚æˆ‘ä»¬å°†ç”»xè½´å’Œyè½´çš„äº¤ç‚¹åæ ‡è®¾ç½®ä¸º(0,0)</p><p><strong>çº¢ç‚¹ç¦»yè½´çš„è·ç¦»æ˜¯xè½´åæ ‡ï¼Œçº¢ç‚¹ç¦»xè½´çš„è·ç¦»æ˜¯yè½´åæ ‡</strong></p><p>å› æ­¤çº¢ç‚¹çš„åæ ‡(x,y)ä¸º(2,3)</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/image-20240629165446863.png" alt="image-20240629165446863"></p><h3 id="gocå…³äºåæ ‡çš„å‘½ä»¤">gocå…³äºåæ ‡çš„å‘½ä»¤</h3><table><thead><tr><th>åæ ‡å‘½ä»¤</th><th>åŠŸèƒ½</th><th>è¯´æ˜</th><th></th></tr></thead><tbody><tr><td><strong>åç§°</strong>ï¼šè·å–Xåæ ‡ï¼šgetX( )</td><td>è·å¾—ç¬”å½“å‰ä½ç½®çš„Xåæ ‡å€¼ï¼Œå¹¶è¿”å›è¿™ä¸ªå€¼ã€‚</td><td>getX( )æ²¡æœ‰å‚æ•°ï¼Œä½†ä¼šè¿”å›Xåæ ‡å€¼ï¼Œæ˜¯å‡½æ•°å‹å‘½ä»¤ã€‚æ ¼å¼å¯ä»¥ä¸ç”¨â€œpen.â€å¼€å¤´ã€‚</td><td></td></tr><tr><td><strong>åç§°</strong>ï¼šè·å–Yåæ ‡ï¼šgetY( )</td><td>è·å¾—ç¬”å½“å‰ä½ç½®çš„Yåæ ‡å€¼ï¼Œå¹¶è¿”å›è¿™ä¸ªå€¼ã€‚</td><td>getY( )æ²¡æœ‰å‚æ•°ä½†ä¼šè¿”å›Yåæ ‡å€¼ï¼Œæ˜¯å‡½æ•°å‹å‘½ä»¤ã€‚æ ¼å¼å¯ä»¥ä¸ç”¨â€œpen.â€å¼€å¤´ã€‚</td><td></td></tr><tr><td><strong>åç§°</strong>ï¼šè·å–è§’åº¦ï¼šgetAngle( )</td><td>è·å¾—ç¬”å½“å‰çš„æ–¹å‘è§’åº¦å€¼ï¼Œå¹¶è¿”å›è¿™ä¸ªå€¼ã€‚</td><td>getAngle( )æ²¡æœ‰å‚æ•°ä½†ä¼šè¿”å›è§’åº¦å€¼ï¼Œæ˜¯å‡½æ•°å‹å‘½ä»¤ã€‚æ ¼å¼å¯ä»¥ä¸ç”¨â€œpen.â€å¼€å¤´ã€‚</td><td></td></tr><tr><td><strong>åç§°</strong>ï¼šè®¾ç½®è§’åº¦ï¼špen.setAngle( a )</td><td>ç›´æ¥è®¾ç½®ç¬”çš„æ–¹å‘ä¸ºæŒ‡å®šçš„è§’åº¦ã€‚</td><td>setAngleå‘½ä»¤ä¸ç®¡ç°åœ¨ç¬”çš„æ–¹å‘ï¼Œç›´æ¥å®šä½åˆ°è§’åº¦aã€‚</td><td></td></tr><tr><td><strong>åç§°</strong>ï¼šè¿çº¿ï¼špen.lineTo( x,y )</td><td>ç¬”çš„ä½ç½®ç§»åŠ¨åˆ°æŒ‡å®šçš„åæ ‡ï¼Œå¹¶ç”»å‡ºçº¿æ®µã€‚</td><td>lineToå‘½ä»¤ä¼šç”»å‡ºçº¿æ¡ï¼Œä½†ç¬”çš„æ–¹å‘ä¸æ”¹å˜ã€‚</td><td></td></tr><tr><td><strong>åç§°</strong>ï¼šç§»åŠ¨ pen.moveTo( x, y )</td><td>ç›´æ¥æŠŠç¬”çš„ä½ç½®ç§»åŠ¨åˆ°æŒ‡å®šçš„åæ ‡ï¼Œä½†ä¸ç”»å›¾ã€‚</td><td>moveToå‘½ä»¤ä¸ä¼šç”»å‡ºçº¿æ¡ï¼Œç¬”çš„æ–¹å‘ä¹Ÿä¸ä¼šæ”¹å˜ã€‚</td><td></td></tr></tbody></table><h2 id="å‹¾è‚¡å®šç†">å‹¾è‚¡å®šç†</h2><p>å‡è®¾ç»™å®šä¸€ä¸ªç›´è§’ä¸‰è§’å½¢ï¼Œç›´è§’ç›¸é‚»çš„ä¸¤ä¸ªè¾¹ä¸ºa,bã€‚æœ€é•¿çš„è¾¹ä¸ºc,æˆ‘ä»¬å¯ä»¥çŸ¥é“å¦‚ä¸‹å…¬å¼:<br>$$<br>a^2+b^2=c^2<br>$$<br>å¦‚æœæƒ³çŸ¥é“cçš„é•¿åº¦ï¼Œå¯ä»¥ä½¿ç”¨sqrtå‡½æ•°ï¼Œä»£è¡¨å¼€æ ¹ï¼Œsqrt(16)=4,sqrt(4)=2<br>$$<br>c=\sqrt{a^2+b^2}=sqrt(a<em>a+b</em>b)<br>$$</p><p>å½“æˆ‘ä»¬ä¸çŸ¥é“æŸä¸ªè¾¹çš„é•¿åº¦æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡getY() è®¡ç®—å‡ºé•¿åº¦ã€‚</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/image-20240629172121147.png" alt="image-20240629172121147"></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">//å‹¾è‚¡å®šç† ä¸¤ä¸ªç›´è§’è¾¹çš„å¹³æ–¹å’Œ=æ–œè¾¹çš„å¹³æ–¹</span></span><br><span class="line">    <span class="comment">//30 60çš„ç›´è§’ä¸‰è§’å½¢ ç›´è§’è¾¹100  æ–œè¾¹200</span></span><br><span class="line">    p.<span class="built_in">lt</span>(<span class="number">90</span>).<span class="built_in">fd</span>(<span class="number">100</span>);</span><br><span class="line">    p.<span class="built_in">setAngle</span>(<span class="number">30</span>).<span class="built_in">fd</span>(<span class="number">200</span>).<span class="built_in">setAngle</span>(<span class="number">180</span>);</span><br><span class="line">    p.<span class="built_in">fd</span>(<span class="built_in">getY</span>()).<span class="built_in">hide</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">é’ç§‘èµ›ç‰¹è®­ç¬¬äºŒæ¬¡</summary>
    
    
    
    <category term="æ‚é¡¹" scheme="https://u7u7.top/categories/%E6%9D%82%E9%A1%B9/"/>
    
    
    <category term="C++" scheme="https://u7u7.top/tags/C/"/>
    
  </entry>
  
  <entry>
    <title>6æœˆæ€»ç»“</title>
    <link href="https://u7u7.top/posts/23conclusion06.html"/>
    <id>https://u7u7.top/posts/23conclusion06.html</id>
    <published>2024-07-01T06:00:25.000Z</published>
    <updated>2024-07-01T06:00:25.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="23å¹´æ€»ç»“6æœˆæ€»ç»“">23å¹´æ€»ç»“6æœˆæ€»ç»“</h1><h2 id="ä¸€ã€çŸ¥è¯†ç‚¹æ±‡æ€»">ä¸€ã€çŸ¥è¯†ç‚¹æ±‡æ€»</h2><h3 id="6-1-6-9">6.1-6.9</h3><ul><li><p><strong>è¿™å‘¨çš„å†…å®¹</strong> ï¼šç»¼åˆæŒ‡æ ‡æ¨èç®—æ³•  æ¸…æ´—æ•´åˆ ç¼ºå¤±å€¼é¢„æµ‹ sparkä»£ç æœåŠ¡å™¨è¿è¡Œ sparkè½¬pyæ¸…æ´—æ•°æ®</p></li><li><p><strong>éš¾ç‚¹</strong>ï¼š pyæ¸…æ´—æ•°æ®  éšæœºæ£®æ—å¯¹å­—æ®µé¢„æµ‹</p></li></ul><p>â€‹<strong>ä¸ªäººç†è§£</strong>:</p><ul><li><p>è¿™å‘¨å¾ˆç³Ÿç³•å•Šï¼Œæ–°çš„æ•°æ®ä¸€å‡ºæ¥ï¼Œå°±æœ‰å¾ˆå¤šå›°éš¾ä¸€ä¸‹å­æ‘†åœ¨è‡ªå·±é¢å‰ï¼Œä½†æ˜¯æ—¶é—´å·²ç»è¦æ¥ä¸åŠäº†ï¼Œé¦–å…ˆæ˜¯æˆ‘å°†sparkæ¸…æ´—è¿›æ•°æ®åº“ï¼ŒèŠ±è´¹äº†40åˆ†é’Ÿä¸€æ¬¡ï¼Œè™½è¯´æ˜¯åªç”¨ä¸€æ¬¡ï¼Œä½†æ˜¯æœ‰å¾ˆå¤šåœ°æ–¹æ˜¯éœ€è¦è°ƒæ•™çš„ã€‚è€Œä¸”sparkå¹¶ä¸æ˜¯å¯¼å…¥ä¸€æ¬¡å°±ç®—äº†ï¼Œä¸€äº›é¢„æµ‹å’Œæ¨èç®—æ³•æ˜¯è¦ä½¿ç”¨pythonçš„ã€‚åŸæœ¬è‡ªå·±sparkæ¸…æ´—å°±ç”¨äº†javaå¤„ç†ioï¼Œsparkå¤„ç†å…¶ä»–ï¼Œæ•ˆç‡æ˜¯ç›¸å½“æ…¢ï¼Œæ¨èæ¥å£åˆéœ€è¦ç”¨pyå†™ã€‚æ›´å¤¸å¼ çš„æ˜¯æ–°æ•°æ®ä¸€ç»™ï¼Œwebç«¯å¤§è‡´çœ‹äº†ä¸€ä¸‹æ•°æ®ï¼Œ50wæ¡ï¼Œè€Œä¸”è·Ÿä¹‹å‰çš„ç»“æ„æœ‰å¾ˆå¤§çš„åŒºåˆ«ï¼Œè¿™æ ·ä¸çŸ¥é“sparkçš„ä»£ç è¦æ¸…æ´—åˆ°ä»€ä¹ˆæ—¶å€™ï¼Œå°±æ‰“ç®—å…¨éƒ¨è½¬pythonäº†ï¼Œæ¸…æ´—å’Œæ¥å£éƒ½ç”¨pyã€‚ç›¸å½“äºä¹‹å‰ä¸€ä¸ªæœˆæ¸…æ´—çš„ä»£ç åŸºæœ¬æŠ¥åºŸï¼Œåªæœ‰æ€è·¯æ˜¯åœ¨çš„ã€‚æˆ‘å…ˆè¯•äº†ä¸€ä¸‹pysparkå†™ï¼Œå‘ç°ä¹Ÿå¾ˆæ…¢ï¼Œåé¢ç›´æ¥æ²¡æœ‰ç”¨sparkï¼Œå•ç‹¬ç”¨pythonå¤„ç†æ•°æ®çš„pandasï¼Œå‘ç°æ¯”sparkå¿«äº†å‡ åå€å•Šã€‚æœç´¢å‘ç°å°æ•°æ®è¿˜æ˜¯pythonå ä¼˜ï¼Œä½†æ˜¯æ•°æ®ä¸€å¤§ï¼Œå†…å­˜ä¼šé¡¶ä¸ä½ã€‚å› ä¸ºæ˜¯ä½¿ç”¨å†…å­˜å¤„ç†æ•°æ®çš„ï¼Œæ‰€ä»¥ä¼šå¿«å¾ˆå¤šã€‚å› ä¸ºä¹‹å‰ä½¿ç”¨è¿‡pandaså¸®åˆ«äººåšè¿‡å¾ˆå¤šä½œä¸šï¼ŒèŠ±äº†ä¸€å¤©å°±ä¸Šæ‰‹äº†ï¼Œå…ˆæŠŠhdfsçš„æ•°æ®ä¸‹è½½ä¸‹æ¥ï¼Œä¸€ä¸ªæ–‡ä»¶å¤¹ä¸‹ä¸¤ä¸‰ä¸ªï¼Œåé¢è¯»æ–‡ä»¶çš„éƒ¨åˆ†æ›¿æ¢æˆhdfså°±å¥½äº†ã€‚å¤§è‡´ä¸‰ç§æ–‡ä»¶å››ç§æ•°æ®æ ¼å¼ï¼Œä¸€å¤©èƒ½è§£å†³ä¸€ç§ã€‚</p></li><li><p>éšæœºæ£®æ—æ˜¯ä¸€ç§æœºå™¨å­¦ä¹ ç®—æ³•å§ï¼Œå®ƒåŸºäºå¤šæ£µå†³ç­–æ ‘çš„é›†æˆã€‚æ¯ä¸ªå†³ç­–æ ‘éƒ½ä¼šç”¨ä¸€éƒ¨åˆ†æ•°æ®è¿›è¡Œè®­ç»ƒï¼Œå¹¶ä¸ºæ¯ä¸ªæ ·æœ¬ç”Ÿæˆä¸€ä¸ªé¢„æµ‹ç»“æœã€‚ç„¶åï¼Œé€šè¿‡å¤šä¸ªå†³ç­–æ ‘çš„é¢„æµ‹ç»“æœçš„æŠ•ç¥¨æˆ–å¹³å‡å€¼æ¥å¾—å‡ºæœ€ç»ˆçš„é¢„æµ‹ç»“æœã€‚åœ¨è¿›è¡Œé¢„æµ‹æ—¶ï¼Œå¦‚æœè¾“å…¥æ ·æœ¬å­˜åœ¨ç¼ºå¤±å€¼ï¼Œéšæœºæ£®æ—ä¼šæ ¹æ®å·²æœ‰çš„å†³ç­–æ ‘æ¨¡å‹è¿›è¡Œé¢„æµ‹ã€‚å¯¹äºæœ‰ç¼ºå¤±ç‰¹å¾çš„æ ·æœ¬ï¼Œåœ¨æ¯æ£µå†³ç­–æ ‘ä¸­å¯¹åº”çš„ç‰¹å¾éƒ½ä¼šè¢«è®¾ç½®ä¸ºç¼ºå¤±å€¼ï¼Œç„¶åæ ¹æ®å·²æœ‰æ¨¡å‹è¿›è¡Œé¢„æµ‹ã€‚æœ€åï¼Œé€šè¿‡æ±‡æ€»æ‰€æœ‰å†³ç­–æ ‘çš„é¢„æµ‹ç»“æœï¼Œå¾—åˆ°æœ€ç»ˆçš„é¢„æµ‹ç»“æœã€‚è¯´ç™½äº†å°±æ˜¯æ ¹æ®æ²¡æœ‰ç¼ºå¤±å€¼çš„è¡Œï¼Œæ¨æµ‹å‡ºæœ‰ç¼ºå¤±å€¼çš„è¡Œçš„ç¼ºå¤±å€¼çš„å€¼ï¼Œè¿™ç§ç®—æ³•æ¯”çº¿æ€§å›å½’ä¼šç§‘å­¦äººæ€§åŒ–å¾ˆå¤šï¼Œç„¶è€Œåœ¨æˆ‘çš„æ•°æ®é›†æ¯”è¾ƒå°‘çš„æƒ…å†µä¸‹ï¼Œç¼ºå¤±å€¼hotä¼šè¶‹å‘äºå¹³å‡å€¼ï¼Œç„¶è€Œè¿™é‡Œæ˜¯ä½¿ç”¨çš„sparkMlï¼Œæˆ‘å·²ç»æ‰“ç®—å¼ƒç”¨sparkäº†ï¼Œæ‰€ä»¥è¿™éƒ¨åˆ†çš„é¢„æµ‹ç®—æ³•ç™½å­¦äº†ï¼Œåˆè¦å»ä½¿ç”¨æ–°çš„ï¼Œæ„Ÿè§‰çº¿æ€§å›å½’åº”è¯¥å¯¹äºæ™¯åŒºhoté¢„æµ‹æ˜¯æ²¡ä»€ä¹ˆé—®é¢˜çš„ã€‚</p></li></ul><h3 id="6-12-6-20">6.12-6.20</h3><ul><li><p><strong>è¿™å‘¨çš„å­¦ä¹ å†…å®¹</strong> ï¼šè¯»å–hdfsæ–‡ä»¶ ä¼˜åŒ–pandasè¯»å–æ–‡ä»¶æ•ˆç‡ æœåŠ¡å™¨é…ç½®å®‰è£… æ•°æ®å¯¼å…¥è¾¾æ¢¦ æ¥å£ä¿®æ”¹ æ³¨é‡Šæ·»åŠ </p></li><li><p><strong>éš¾ç‚¹</strong>ï¼šè¯»å–hdfsæ–‡ä»¶ ä¿®è¾¾æ¢¦æ•°æ®åº“çš„BUG  çº¿æ€§å›å½’ç®—æ³•</p></li></ul><p>â€‹<strong>ä¸ªäººç†è§£</strong>:</p><ul><li>è¯»hdfsæ–‡ä»¶è¿™è¾¹ï¼ŒèŠ±è´¹äº†å¤§é‡æ—¶é—´ä½¿ç”¨ä¸€ç§æ— çº¿BUGçš„æ–¹æ³•ï¼Œhdfs3æ¨¡å—çœŸä¸çŸ¥é“ä¸ºä»€ä¹ˆä¼šè¯´ä¸€ç›´æ‰¾ä¸åˆ°è¿™ä¸ªæ‰¾ä¸åˆ°é‚£ä¸ªï¼Œä½†æ˜¯åœ¨pythonåŒ…ä¸‹é¢éƒ½æ˜¯æœ‰çš„ï¼Œä½¿ç”¨sysæŒ‡å®šéƒ½æ²¡ç”¨ã€‚åé¢ä½¿ç”¨hdfsï¼Œä¹Ÿä¼šæŠ¥é”™ï¼Œä½†æ˜¯æŠ¥é”™ä¿¡æ¯ä¸ä¸€æ ·ï¼Œä¸€ç›´æ˜¯è¿æ¥ä¸åˆ°webä»€ä¹ˆçš„ï¼Œhdfs3ä¿®å¥½ä»¥åä¹Ÿæ˜¯è¿™æ ·ï¼Œè€ƒè™‘åˆ°æœåŠ¡å™¨å¯èƒ½è¿˜è¦é‡è£…å‡ æ¬¡ï¼Œå°±å¼ƒç”¨hdfs3è¿™ä¸ªæ¨¡å—äº†ï¼Œä½¿ç”¨hdfsï¼Œåˆšå¼€å§‹æ¯”èµ›æ–¹æä¾›çš„æ˜¯ä¸€ä¸ªæ˜ å°„åŸŸå+9000ç«¯å£ï¼Œæˆ‘å»å¹³å°å¼€äº†å°è™šæ‹Ÿæœºï¼Œpingä»–æä¾›çš„è¿™ä¸ªæ˜ å°„åŸŸåï¼Œä¼šè¿”å›ä¸€ä¸ªIPåœ°å€çš„ï¼Œæˆ‘è‡ªå·±ç”µè„‘pingäº†ä¸€ä¸‹ç«Ÿç„¶èƒ½pingé€šï¼Œé‚£è¿™ä¸ªå°±æ˜¯å…¬ç½‘äº†ï¼Œæ ¹æœ¬ä¸ç”¨å¹³å°çš„æœºå­ä¹Ÿèƒ½æ‹¿åˆ°ï¼Œä½†æ˜¯è¿˜æ˜¯ä¸€ç›´æŠ¥conncatï¼Œwebä¹‹ç±»çš„ï¼Œåæ­£å°±æ˜¯è¿æ¥ä¸åˆ°ï¼Œæ¢æˆ50070å…¶ä»–ç«¯å£ä¼šç›´æ¥æŠ¥ç«¯å£é”™è¯¯ï¼Œæˆ‘åˆå»æµ‹è¯•è‡ªå·±è™šæ‹Ÿæœºä¸Šé¢çš„hdfsï¼Œå‘ç°èƒ½å–åˆ°ï¼Œæœç´¢è¯´æ˜¯hadoopçš„é…ç½®æ–‡ä»¶éœ€è¦æŸ¥çœ‹ï¼Œä½†æ˜¯æ•°æ®æ˜¯æ¯”èµ›æ–¹æä¾›çš„ï¼Œæˆ‘ä»¬åˆä¸èƒ½æ“ä½œä»–ä»¬çš„æœºå­ã€‚é—®è¾¾æ¢¦çš„äººç»™æˆ‘ç­”éæ‰€é—®ï¼Œçªç„¶æ— æ„ä¸­æ¢æˆäº†9870ç«¯å£ï¼Œå‘ç°æ²¡æŠ¥é”™äº†ï¼Œlistæµ‹è¯•ç«Ÿç„¶æœ‰äº†ã€‚èŠ±äº†ä¸¤å¤©æ—¶é—´ï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯æˆ‘æ˜¨å¤©åœ¨ç¾¤é‡Œè¯´äº†æ˜¯å…¬ç½‘çš„é—®é¢˜ï¼Œä»–è¯´ä¸æ˜¯ï¼Œç»“æœç¬¬äºŒå¤©å°±å…³äº†ï¼Œpingä¸é€šäº†ï¼Œçœ‹æ¥ä¹‹å‰çš„ç¡®æ˜¯å…¬ç½‘ã€‚</li><li>è¿™è¾¾æ¢¦æ•°æ®åº“çš„bugçœŸçš„å¾ˆå¤šï¼Œè«åå…¶å¦™çš„ï¼Œä¸€æ¨¡ä¸€æ ·çš„æ­¥éª¤å°±è¦çœ‹è¿æ°”ï¼Œä¼šå‡ºç°ä¸åŒçš„æŠ¥é”™ï¼Œåœ¨ä¸åŒçš„æœåŠ¡å™¨ä¼šå‡ºç°å¾ˆå¤šæŠ¥é”™ã€‚ç„¶åå°±æ˜¯dmPythonå’Œsqlalchemy_dmï¼Œè¿™ä¸¤ä¸ªå®‰è£…ä»¥åä¹Ÿä¼šå‡ºç°æ‰¾ä¸åˆ°ä»€ä¹ˆåŒ…ä¹‹ç±»çš„é—®é¢˜ï¼Œå…‰è§£å†³è¿™äº›é—®é¢˜ï¼Œä¸€ä¸ªæœåŠ¡å™¨æ­å»ºå°±è¦èŠ±è´¹å‡ ä¸ªå°æ—¶ï¼Œå…³é”®ä»–å¹³å°çš„é€Ÿåº¦è¿˜è´¼æ…¢ï¼Œä¸è®©ä½¿ç”¨ä¸­å›½é•œåƒçœŸæ²¡ææ‡‚100kbçš„é€Ÿåº¦è¿™æ ·å¼„æ¥æ˜¯ä»€ä¹ˆæ„æ€ã€‚</li><li>ä¹‹å‰sparkmlçš„éšæœºæ£®æ—æ›¿æ¢æˆçº¿æ€§å›å½’äº†ï¼Œçº¿æ€§å›å½’å¯¹è®­ç»ƒæ•°æ®ä¼šæ¯”è¾ƒä¾èµ–ã€‚å¤§è‡´è®²ä¸€ä¸‹åŸç†å§ã€‚æŒºå¥½ç†è§£çš„ï¼Œå°±æ¯”å¦‚æˆ‘ç”¨åˆ°çº¿æ€§å›å½’çš„å…¶ä¸­ä¸€ä¸ªåœ°æ–¹ï¼Œé¢„æµ‹hotå­—æ®µï¼Œæ™¯åŒºå½±å“hotçš„æœ‰å“ªäº›å­—æ®µï¼Œgradeå’Œqtyï¼Œé‚£æˆ‘å°±æ ¹æ®åŒæ—¶æœ‰hot grade qtyçš„æ•°æ®ï¼Œè®¡ç®—å‡ºä¸‰è€…çš„æ¨¡ç³Šå…³ç³»ï¼Œä¸ºä»€ä¹ˆæ˜¯æ¨¡ç³Šçš„å…³ç³»å‘¢ï¼Œå› ä¸ºå­˜åœ¨çš„æ•°æ®ä¸‰è€…å…³ç³»ä¹Ÿä¸æ˜¯å›ºå®šçš„ã€‚æ‰“ä¸ªæ¯”æ–¹ï¼Œy=kx+bè¿™æ ·ä¸€ä¸ªä¸€å…ƒä¸€æ¬¡æ–¹ç¨‹(å®é™…å¹¶ä¸æ˜¯),ä¸åŒçš„æ•°æ®ä¼šæœ‰å¾ˆå¤šç§kå’Œbã€‚çº¿æ€§å›å½’ç®—æ³•çš„ç›®æ ‡æ˜¯é€šè¿‡æ±‚è§£kå’Œbçš„æœ€ä½³ç»„åˆï¼Œä½¿å¾—å»ºç«‹çš„çº¿æ€§æ¨¡å‹ä¸çœŸå®çš„æ•°æ®å°½å¯èƒ½åœ°æ¥è¿‘ã€‚å…·ä½“è€Œè¨€ï¼Œå®ƒä¼šé€šè¿‡æœ€å°åŒ–é¢„æµ‹å€¼ä¸çœŸå®å€¼ä¹‹é—´çš„è¯¯å·®ï¼Œæ¥æ‰¾åˆ°æœ€ä¼˜çš„æ–œç‡å’Œæˆªè·ã€‚è®¡ç®—åŸç†æ˜¯è¿™æ ·ï¼Œè®¾è®¡åŸç†æ˜¯ç›¸å…³å€¼ä¹‹é—´æ˜¯ä¸€ä¸ªç›¸äº’çš„å…³ç³»ï¼Œå°±æ¯”å¦‚åˆ·æŠ–éŸ³ï¼Œä½ ç»™æŸä¸ªè§†é¢‘ç‚¹äº†èµï¼Œè§†é¢‘ä¹Ÿä¼šè®°å½•ä½ å–œæ¬¢è¿™ä¸ªè§†é¢‘ï¼Œå°±èƒ½é€šè¿‡ä½ ç‚¹èµçš„æ•°æ®æ¨æµ‹å‡ºä½ å–œæ¬¢çš„è§†é¢‘ï¼Œä¹Ÿèƒ½å°†æŸä¸ªè§†é¢‘ï¼Œæ¨èç»™ç»å¸¸ç»™è¯¥ç±»è§†é¢‘ç‚¹èµçš„äººã€‚çº¿æ€§å›å½’çš„æ¨¡å‹å¥—èµ·æ¥è¿˜æ˜¯ç®€å•çš„ï¼Œå› ä¸ºè¿™æ¨¡å‹ä¸èƒ½è®­ç»ƒçš„ï¼Œæ˜¯ä¸€æ¬¡æ€§çš„ï¼Œæ‰€ä»¥åå·®å€¼ä¸ä¼šå¾ˆå¤§ï¼Œå‡†ç¡®æ€§åªèƒ½è¯´ä¸­è§„ä¸­çŸ©ã€‚</li></ul><h2 id="äºŒ-å°ç»„é¡¹ç›®æ€»ç»“">äºŒ:å°ç»„é¡¹ç›®æ€»ç»“:</h2><ul><li>åœ¨è¿™æ¬¡æ¯”èµ›é¡¹ç›®ä¸­ï¼Œä½œä¸ºé˜Ÿé•¿ï¼Œæˆ‘ä¸ä»…éœ€è¦å®Œæˆè‡ªå·±è´Ÿè´£çš„æ¨¡å—éƒ¨åˆ†ï¼Œæ›´é‡è¦çš„æ˜¯è´Ÿè´£ç»„ç»‡å’Œå®‰æ’å°ç»„æˆå‘˜çš„å·¥ä½œã€‚å›é¡¾ç›®å‰é¡¹ç›®åˆ¶ä½œè¿‡ç¨‹ï¼Œæˆ‘è®¤ä¸ºæˆ‘åœ¨å·¥ä½œå®‰æ’æ–¹é¢æœ‰ä»¥ä¸‹å‡ ç‚¹åæ€å’Œæ”¹è¿›çš„åœ°æ–¹ã€‚é¦–å…ˆï¼Œæˆ‘å‘ç°æœ‰æ—¶å€™æˆ‘åªæ˜¯ç®€å•åœ°å‘Šè¯‰ä»–ä»¬å®ŒæˆæŸä¸ªä»»åŠ¡ï¼Œè€Œæ²¡æœ‰å…·ä½“è¯´æ˜è¦è¾¾åˆ°çš„ç›®æ ‡å’Œæ—¶é—´è¦æ±‚ã€‚è¿™å¯¼è‡´ä¸€äº›æƒ…å†µä¸‹å‰åç«¯é…åˆæ„Ÿåˆ°å›°æƒ‘ï¼Œå¹¶ä¸”æ— æ³•é«˜æ•ˆåœ°å®Œæˆä»»åŠ¡ã€‚ä»¥åéœ€è¦æ›´åŠ æ¸…æ™°åœ°ä¼ è¾¾ä»»åŠ¡çš„ç›®æ ‡å’Œè¦æ±‚ï¼Œæä¾›æ˜ç¡®çš„æ—¶é—´è¡¨å’Œè¡¡é‡æŒ‡æ ‡ï¼Œä½¿æ¯ä¸ªæˆå‘˜èƒ½å¤Ÿæ¸…æ¥šåœ°çŸ¥é“ä»–ä»¬éœ€è¦åšä»€ä¹ˆï¼Œå¹¶åœ¨è§„å®šçš„æ—¶é—´å†…å®Œæˆã€‚</li><li>ä¹‹å‰åšçš„ä»»åŠ¡è¡¨å…¶å®æ˜¯æœ‰æ—¶é—´å®‰æ’çš„ï¼Œä½†æ˜¯è®¡åˆ’è·Ÿç€å˜åŒ–èµ°ï¼Œé‚£ä¸ªè¡¨ä¹Ÿå°±æ²¡ä»€ä¹ˆç”¨äº†ã€‚æˆ‘è§‰å¾—æˆ‘ä»¬ç»„çš„å®åŠ›åœ¨å·¥ä½œå®¤å„ä¸ªé¢†åŸŸéƒ½è¿˜æ˜¯æŒºå¼ºçš„ï¼Œé—®é¢˜æœ€å¤§çš„åœ°æ–¹åœ¨äºæ²Ÿé€šï¼Œåœ¨å¹³å°å‡ºæ¥ä¹‹å‰ï¼Œå› ä¸ºæˆ‘é‚£éƒ¨åˆ†åŸºæœ¬éƒ½è§£å†³äº†ï¼Œæ‰€ä»¥åŸºæœ¬æ¯å¤©éƒ½ä¼šé—®ä¸€ä¸‹ä»–ä»¬çš„è¿›åº¦ï¼Œå“ªäº›åœ°æ–¹éœ€è¦æ€æ ·çš„æ¥å£ï¼Œç„¶åå†è·Ÿåç«¯è®²ï¼Œè¿™æ ·çš„æ²Ÿé€šæ–¹å¼å…¶å®è¿˜æ˜¯å¯ä»¥çš„ï¼Œå› ä¸ºå‰ç«¯å¯èƒ½åªçŸ¥é“è‡ªå·±éœ€è¦å®ç°ä»€ä¹ˆæ ·çš„åŠŸèƒ½ï¼Œæˆ‘ä¼šå»è¯¢é—®ï¼Œç„¶åå•†é‡éœ€è¦ä»€ä¹ˆæ ·çš„æ•°æ®ï¼Œæˆ‘åœ¨å‘Šè¯‰åç«¯å“ªäº›åŠŸèƒ½æœ‰ï¼Œè¦å†™ä»€ä¹ˆæ ·çš„æ¥å£ï¼Œsqlæ–¹é¢èƒ½å¸®åŠ©çš„è¿˜ä¼šæä¾›ä¸€ä¸‹å¸®åŠ©ã€‚</li><li>å¹³å°å‡ºæ¥ä»¥åï¼Œå› ä¸ºä¸Šä¸ªæœˆçš„åŠªåŠ›åŸºæœ¬ç™½è´¹äº†ï¼Œæœ¬æ¥æƒ³ç€æ•°æ®æ˜¯å·®ä¸å¤šäº†ï¼Œä¸€å¤©ä¸¤å¤©æ—¶é—´æä¸€ä¸‹å°±è¡Œäº†ï¼Œå°±èƒ½å¸®å‰åç«¯å†™å†™ä»£ç ï¼Œæˆ–è€…å†™æ–‡æ¡£äº†ã€‚ç»“æœå·®è¿™ä¹ˆå¤šï¼Œé‚£å‡ å¤©åˆæ‹…å¿ƒæ¥ä¸åŠï¼Œéƒ½åœ¨è‡ªå·±åŸ‹å¤´æŠŠæ•°æ®å¤„ç†äº†ï¼Œæ•°æ®æˆ‘ä¹Ÿæœ‰è·Ÿå°ç»„æˆå‘˜è¯´è¿‡æ•°æ®ç»“æ„å’Œå˜åŠ¨ï¼Œæœ‰å˜åŠ¨å…¶å®ä¸å¤šï¼Œè¦æ”¹çš„æ¥å£å’ŒåŠŸèƒ½æ˜¯ä¸å¤šçš„ï¼Œå³ä½¿æ²¡æœ‰æ•°æ®ä¹Ÿæ˜¯èƒ½è¿›è¡Œçš„ï¼Œä½†æ˜¯ä»–ä»¬éƒ½æ˜¯åœ¨ç­‰æˆ‘æå¥½æ•°æ®ï¼Œå¯¼è‡´å·¥ä½œè¿›åº¦æ•ˆç‡å˜æ…¢äº†å‡ å¤©ï¼Œæ–°æ•°æ®ç¡®å®åŠ ä¸Šè¡¥å……ç¼ºå¤±å€¼å’Œratingè®¡ç®—åŠ ä¸Šäº†å¾ˆå¤šåŠŸèƒ½ï¼Œä¹‹å‰å¾ˆå¤šnullçš„å€¼ï¼Œæˆ‘éƒ½å¤„ç†æ‰äº†ï¼Œæ–°æ•°æ®æäº†å¯èƒ½ä¸€ä¸ªæ˜ŸæœŸå§ã€‚è¿™æ®µæ—¶é—´æ²¡æœ‰æ€ä¹ˆè®©å‰åç«¯æ²Ÿé€šï¼Œç¡®å®æ˜¯æœ‰ç‚¹å¿™ä¸è¿‡æ¥äº†ã€‚ç„¶åæœ‰å¾ˆå¤šåœ°æ–¹çš„æ¥å£éƒ½æ˜¯è¿˜æ²¡å†™çš„ï¼Œä¹‹å‰æˆ‘å…¶å®æ˜¯æœ‰æ³¨æ„åˆ°çš„ï¼Œé‚£éƒ¨åˆ†åŠŸèƒ½éœ€è¦æ–°æ•°æ®æ‰èƒ½ç”¨ï¼Œå°±å…ˆè®©ä»–ä»¬å°†å…¶ä»–åœ°æ–¹è¯¥èƒ½å†™å¥½çš„åœ°æ–¹å†™å¥½äº†ï¼Œå°±æ„è¯†åˆ°è‡ªå·±æ•°æ®æçš„è¶Šæ…¢é¡¹ç›®å°±å¿«ä¸èµ·æ¥ï¼ŒåŠ äº†å‡ å¤©ç­ç»ˆäºæŠŠæ•°æ®æå¥½äº†ï¼Œæœ€è¿‘å‡ å¤©çš„æ•ˆç‡æ˜¯ä¹‹å‰æ²¡æ•°æ®çš„å¾ˆå¤šå€ï¼Œå¯èƒ½æ˜¯æ²¡æ•°æ®æ¥å£é‚£è¾¹ä¸å¤ªå¥½æ„Ÿè§‰å§ï¼Œå› ä¸ºæ²¡æ³•æµ‹è¯•ã€‚æ€»çš„æ¥è¯´ï¼Œé€šè¿‡åæ€å’Œæ€»ç»“è¿™æ¬¡æ¯”èµ›é¡¹ç›®ä¸­å¯¹è‡ªå·±å°ç»„å·¥ä½œå®‰æ’çš„ç»éªŒï¼Œæˆ‘çŸ¥é“è‡ªå·±æœ‰å¾ˆå¤šåœ°æ–¹è¿˜æ˜¯éœ€è¦åŠ å¼ºæ”¹è¿›çš„ï¼Œåº”è¯¥ç£ä¿ƒå‰åç«¯åŠ å¼ºè‡ªä¸»æ²Ÿé€šï¼Œè€Œä¸æ˜¯è‡ªå·±å½“ä¼ è¯ç­’ï¼Œèƒ½å¤Ÿæ›´å¥½åœ°å‘æŒ¥é˜Ÿé•¿çš„èŒè´£ï¼Œæå‡å°ç»„çš„å·¥ä½œæ•ˆç‡å’Œè´¨é‡ï¼Œå–å¾—æ›´å¥½çš„æˆç»©ã€‚</li><li>è¿™å¤§åŠä¸ªæœˆæ˜¯èµ°å…¥é¡¹ç›®çš„æœ«å°¾äº†ï¼Œè‡ªå·±è´Ÿè´£çš„ä»£ç éƒ¨åˆ†åŸºæœ¬å®Œæˆäº†ï¼Œä¸ºä»€ä¹ˆæ˜¯åŸºæœ¬å®Œæˆï¼Œå¯èƒ½æœ‰äº›åœ°æ–¹æ¥å£è¦æ·»åŠ æˆ–è€…è¦ä¿®æ”¹ä¸€ä¸‹ã€‚ä½†æ˜¯æ˜¯å°äº‹æƒ…çš„äº†ï¼Œæ¥ä¸‹æ¥çš„æ—¶é—´å°±å¼€å§‹ä¸»æ”»æ–‡æ¡£äº†ï¼Œæ–‡æ¡£æ–¹é¢å› ä¸ºå€Ÿé‰´çš„ä¸å¤šï¼Œæ‰€ä»¥æ„Ÿè§‰è¿˜æ˜¯è¦èŠ±è´¹ä¸€äº›åŠŸå¤«çš„ã€‚è¿™ä¸ªæœˆåˆšå¼€å§‹æ¥å¹³å°å’Œæ•°æ®çš„æ—¶å€™çœŸæ˜¯æŠŠæˆ‘å“ä¸€äº†è·³ï¼Œæ•°æ®å¤šäº†è¿™ä¹ˆå¤šï¼Œè¿˜æ ¼å¼ä¸ä¸€æ ·ï¼Œæ¸…æ´—æ•°æ®éƒ¨åˆ†ä¹‹å‰çš„æ—¶é—´çœŸéƒ½ç™½çäº†ã€‚å¹³å° ä¹Ÿä¸æ˜¯æ•´çš„å¾ˆæ˜ç™½å…¶å®ï¼Œå¥½åœ¨ç£•ç£•ç»Šç»Šçš„éƒ½è§£å†³äº†ï¼Œé¡¹ç›®å¼€å‘ä¹Ÿæ­¥å…¥äº†æ­£è½¨äº†ã€‚</li></ul>]]></content>
    
    
    <summary type="html">23å¹´åˆ›æ–°å·¥ä½œå®¤6æœˆæ€»ç»“</summary>
    
    
    
    <category term="å·¥ä½œæœˆæ€»ç»“" scheme="https://u7u7.top/categories/%E5%B7%A5%E4%BD%9C%E6%9C%88%E6%80%BB%E7%BB%93/"/>
    
    
    <category term="æ€»ç»“" scheme="https://u7u7.top/tags/%E6%80%BB%E7%BB%93/"/>
    
  </entry>
  
  <entry>
    <title>GoCå›½èµ›ç‰¹è®­(ä¸€)</title>
    <link href="https://u7u7.top/posts/goc01.html"/>
    <id>https://u7u7.top/posts/goc01.html</id>
    <published>2024-06-28T09:17:25.000Z</published>
    <updated>2025-08-20T03:07:10.738Z</updated>
    
    <content type="html"><![CDATA[<h1 id="7æœˆ6æ—¥ç¬¬ä¸€æ¬¡è®­ç»ƒé¢˜">7æœˆ6æ—¥ç¬¬ä¸€æ¬¡è®­ç»ƒé¢˜</h1><div class="site-card-group"><a class="site-card" href="https://vip.51goc.com/static/gocWebNet/gocWebNet.html?submitBt=0&insert=0&ra=60&winName=20200413"><div class="img"><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/20240629094929.png"/></div><div class="info"><img src=" https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/chengguo.jpg"/><span class="title">gocç¼–è¯‘ç¯å¢ƒ</span><span class="desc">webç«¯</span></div></a></div>  <h2 id="2358å¶æ•°è½¦è¾†å’Œ">2358å¶æ•°è½¦è¾†å’Œ</h2><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/image-20240623174050751.png" alt="image-20240623174050751"></p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/image-20240623174057642.png" alt="image-20240623174057642"></p><h2 id="2361é»‘è‰²å°è®°">2361é»‘è‰²å°è®°</h2><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/image-20240628154114419.png" alt="image-20240628154114419"></p><h2 id="2362æŒ‘é€‰æ—¥æœŸ">2362æŒ‘é€‰æ—¥æœŸ</h2><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/image-20240623174130144.png" alt="image-20240623174130144"></p><h2 id="2363è½¦è¾†ç»Ÿè®¡">2363è½¦è¾†ç»Ÿè®¡</h2><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/image-20240623175620853.png" alt="image-20240623175620853"></p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/image-20240623175632380.png" alt="image-20240623175632380"></p><h2 id="2365çŸ©å½¢å¤–æ¡†B">2365çŸ©å½¢å¤–æ¡†B</h2><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/image-20240623180651332.png" alt="image-20240623180651332"></p><h1 id="7æœˆ6æ—¥è¯¾å ‚ç¬”è®°">7æœˆ6æ—¥è¯¾å ‚ç¬”è®°</h1><h2 id="åæ ‡">åæ ‡</h2><h3 id="ä»€ä¹ˆæ˜¯åæ ‡">ä»€ä¹ˆæ˜¯åæ ‡</h3><p>åæ ‡ç”±ä¸¤ä¸ªæ•°ï¼Œé€šå¸¸æ˜¯(x, y)ï¼Œè¡¨ç¤ºä¸€ä¸ªç‚¹åœ¨æ°´å¹³ å’Œå‚ç›´æ–¹å‘ä¸Šçš„è·ç¦»ã€‚å¦‚å›¾çº¢ç‚¹æ‰€åœ¨çš„ä½ç½®ã€‚æˆ‘ä»¬å°†ç”»xè½´å’Œyè½´çš„äº¤ç‚¹åæ ‡è®¾ç½®ä¸º(0,0)</p><p><strong>çº¢ç‚¹ç¦»yè½´çš„è·ç¦»æ˜¯xè½´åæ ‡ï¼Œçº¢ç‚¹ç¦»xè½´çš„è·ç¦»æ˜¯yè½´åæ ‡</strong></p><p>å› æ­¤çº¢ç‚¹çš„åæ ‡(x,y)ä¸º(2,3)</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/image-20240629165446863.png" alt="image-20240629165446863"></p><h3 id="gocå…³äºåæ ‡çš„å‘½ä»¤">gocå…³äºåæ ‡çš„å‘½ä»¤</h3><table><thead><tr><th>åæ ‡å‘½ä»¤</th><th>åŠŸèƒ½</th><th>è¯´æ˜</th><th></th></tr></thead><tbody><tr><td><strong>åç§°</strong>ï¼šè·å–Xåæ ‡ï¼šgetX( )</td><td>è·å¾—ç¬”å½“å‰ä½ç½®çš„Xåæ ‡å€¼ï¼Œå¹¶è¿”å›è¿™ä¸ªå€¼ã€‚</td><td>getX( )æ²¡æœ‰å‚æ•°ï¼Œä½†ä¼šè¿”å›Xåæ ‡å€¼ï¼Œæ˜¯å‡½æ•°å‹å‘½ä»¤ã€‚æ ¼å¼å¯ä»¥ä¸ç”¨â€œpen.â€å¼€å¤´ã€‚</td><td></td></tr><tr><td><strong>åç§°</strong>ï¼šè·å–Yåæ ‡ï¼šgetY( )</td><td>è·å¾—ç¬”å½“å‰ä½ç½®çš„Yåæ ‡å€¼ï¼Œå¹¶è¿”å›è¿™ä¸ªå€¼ã€‚</td><td>getY( )æ²¡æœ‰å‚æ•°ä½†ä¼šè¿”å›Yåæ ‡å€¼ï¼Œæ˜¯å‡½æ•°å‹å‘½ä»¤ã€‚æ ¼å¼å¯ä»¥ä¸ç”¨â€œpen.â€å¼€å¤´ã€‚</td><td></td></tr><tr><td><strong>åç§°</strong>ï¼šè·å–è§’åº¦ï¼šgetAngle( )</td><td>è·å¾—ç¬”å½“å‰çš„æ–¹å‘è§’åº¦å€¼ï¼Œå¹¶è¿”å›è¿™ä¸ªå€¼ã€‚</td><td>getAngle( )æ²¡æœ‰å‚æ•°ä½†ä¼šè¿”å›è§’åº¦å€¼ï¼Œæ˜¯å‡½æ•°å‹å‘½ä»¤ã€‚æ ¼å¼å¯ä»¥ä¸ç”¨â€œpen.â€å¼€å¤´ã€‚</td><td></td></tr><tr><td><strong>åç§°</strong>ï¼šè®¾ç½®è§’åº¦ï¼špen.setAngle( a )</td><td>ç›´æ¥è®¾ç½®ç¬”çš„æ–¹å‘ä¸ºæŒ‡å®šçš„è§’åº¦ã€‚</td><td>setAngleå‘½ä»¤ä¸ç®¡ç°åœ¨ç¬”çš„æ–¹å‘ï¼Œç›´æ¥å®šä½åˆ°è§’åº¦aã€‚</td><td></td></tr><tr><td><strong>åç§°</strong>ï¼šè¿çº¿ï¼špen.lineTo( x,y )</td><td>ç¬”çš„ä½ç½®ç§»åŠ¨åˆ°æŒ‡å®šçš„åæ ‡ï¼Œå¹¶ç”»å‡ºçº¿æ®µã€‚</td><td>lineToå‘½ä»¤ä¼šç”»å‡ºçº¿æ¡ï¼Œä½†ç¬”çš„æ–¹å‘ä¸æ”¹å˜ã€‚</td><td></td></tr><tr><td><strong>åç§°</strong>ï¼šç§»åŠ¨ pen.moveTo( x, y )</td><td>ç›´æ¥æŠŠç¬”çš„ä½ç½®ç§»åŠ¨åˆ°æŒ‡å®šçš„åæ ‡ï¼Œä½†ä¸ç”»å›¾ã€‚</td><td>moveToå‘½ä»¤ä¸ä¼šç”»å‡ºçº¿æ¡ï¼Œç¬”çš„æ–¹å‘ä¹Ÿä¸ä¼šæ”¹å˜ã€‚</td><td></td></tr></tbody></table><h2 id="å‹¾è‚¡å®šç†">å‹¾è‚¡å®šç†</h2><p>å‡è®¾ç»™å®šä¸€ä¸ªç›´è§’ä¸‰è§’å½¢ï¼Œç›´è§’ç›¸é‚»çš„ä¸¤ä¸ªè¾¹ä¸ºa,bã€‚æœ€é•¿çš„è¾¹ä¸ºc,æˆ‘ä»¬å¯ä»¥çŸ¥é“å¦‚ä¸‹å…¬å¼:<br>$$<br>a^2+b^2=c^2<br>$$<br>å¦‚æœæƒ³çŸ¥é“cçš„é•¿åº¦ï¼Œå¯ä»¥ä½¿ç”¨sqrtå‡½æ•°ï¼Œä»£è¡¨å¼€æ ¹ï¼Œsqrt(16)=4,sqrt(4)=2<br>$$<br>c=\sqrt{a^2+b^2}=sqrt(a<em>a+b</em>b)<br>$$</p><p>å½“æˆ‘ä»¬ä¸çŸ¥é“æŸä¸ªè¾¹çš„é•¿åº¦æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡getY() è®¡ç®—å‡ºé•¿åº¦ã€‚</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/image-20240629172121147.png" alt="image-20240629172121147"></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">//å‹¾è‚¡å®šç† ä¸¤ä¸ªç›´è§’è¾¹çš„å¹³æ–¹å’Œ=æ–œè¾¹çš„å¹³æ–¹</span></span><br><span class="line">    <span class="comment">//30 60çš„ç›´è§’ä¸‰è§’å½¢ ç›´è§’è¾¹100  æ–œè¾¹200</span></span><br><span class="line">    p.<span class="built_in">lt</span>(<span class="number">90</span>).<span class="built_in">fd</span>(<span class="number">100</span>);</span><br><span class="line">    p.<span class="built_in">setAngle</span>(<span class="number">30</span>).<span class="built_in">fd</span>(<span class="number">200</span>).<span class="built_in">setAngle</span>(<span class="number">180</span>);</span><br><span class="line">    p.<span class="built_in">fd</span>(<span class="built_in">getY</span>()).<span class="built_in">hide</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">é’ç§‘èµ›ç‰¹è®­ç¬¬ä¸€æ¬¡</summary>
    
    
    
    <category term="æ‚é¡¹" scheme="https://u7u7.top/categories/%E6%9D%82%E9%A1%B9/"/>
    
    
    <category term="C++" scheme="https://u7u7.top/tags/C/"/>
    
  </entry>
  
  <entry>
    <title>GoCå›½èµ›ç‰¹è®­</title>
    <link href="https://u7u7.top/posts/goc00.html"/>
    <id>https://u7u7.top/posts/goc00.html</id>
    <published>2024-06-28T08:00:25.000Z</published>
    <updated>2025-07-28T03:31:53.464Z</updated>
    
    <content type="html"><![CDATA[<h1 id="GOCå›½èµ›ç‰¹è®­åŠç­”æ¡ˆ">GOCå›½èµ›ç‰¹è®­åŠç­”æ¡ˆ</h1><h2 id="2356ä¸¤ä¸ªå…«åˆ†éŸ³ç¬¦">2356ä¸¤ä¸ªå…«åˆ†éŸ³ç¬¦</h2><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/image-20240623173955916.png" alt="image-20240623173955916"></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    p.<span class="built_in">c</span>(<span class="number">0</span>);</span><br><span class="line">    p.<span class="built_in">oo</span>(<span class="number">20</span>);</span><br><span class="line">    p.<span class="built_in">rt</span>(<span class="number">90</span>).<span class="built_in">fd</span>(<span class="number">20</span>).<span class="built_in">lt</span>(<span class="number">90</span>).<span class="built_in">size</span>(<span class="number">4</span>).<span class="built_in">fd</span>(<span class="number">100</span>);</span><br><span class="line">    p.<span class="built_in">rt</span>(<span class="number">70</span>).<span class="built_in">size</span>(<span class="number">10</span>).<span class="built_in">fd</span>(<span class="number">100</span>).<span class="built_in">rt</span>(<span class="number">110</span>).<span class="built_in">size</span>(<span class="number">4</span>).<span class="built_in">fd</span>(<span class="number">100</span>);</span><br><span class="line">    p.<span class="built_in">rt</span>(<span class="number">90</span>).<span class="built_in">fd</span>(<span class="number">20</span>).<span class="built_in">oo</span>(<span class="number">20</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2357å˜åŒ–çš„æ­£ä¸‰è§’å½¢">2357å˜åŒ–çš„æ­£ä¸‰è§’å½¢</h2><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/image-20240628153145817.png" alt="image-20240628153145817"></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">5</span>;i++)&#123;</span><br><span class="line">        p.<span class="built_in">lt</span>(<span class="number">30</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;<span class="number">4</span>;j++)&#123;</span><br><span class="line">            p.<span class="built_in">fd</span>(<span class="number">100</span><span class="number">-10</span>*i).<span class="built_in">rt</span>(<span class="number">120</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        p.<span class="built_in">fd</span>(<span class="number">50</span><span class="number">-5</span>*i).<span class="built_in">lt</span>(<span class="number">60</span>+<span class="number">10</span>*i); </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2358å¶æ•°è½¦è¾†å’Œ">2358å¶æ•°è½¦è¾†å’Œ</h2><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/image-20240623174050751.png" alt="image-20240623174050751"></p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/image-20240623174057642.png" alt="image-20240623174057642"></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> n,a[<span class="number">10</span>],sum;</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line">        cin &gt;&gt; a[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line">        p.<span class="built_in">moveTo</span>(<span class="number">40</span>*i,a[i]/<span class="number">2.0</span>);</span><br><span class="line">        <span class="keyword">if</span>(a[i] % <span class="number">2</span>==<span class="number">0</span>)&#123;</span><br><span class="line">            sum += a[i]*<span class="number">20</span>;</span><br><span class="line">            p.<span class="built_in">rr</span>(<span class="number">20</span>,a[i],<span class="number">1</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            p.<span class="built_in">rr</span>(<span class="number">20</span>,a[i],<span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//çº¢é¢ç§¯ sum</span></span><br><span class="line">    <span class="comment">//é•¿(2*n-1)*20=40n-20</span></span><br><span class="line">    p.<span class="built_in">moveTo</span>(<span class="number">20</span>*n<span class="number">-20</span>,<span class="number">-1</span>*sum/(<span class="number">80</span>*n<span class="number">-40</span>));</span><br><span class="line">    p.<span class="built_in">rr</span>(<span class="number">40</span>*n<span class="number">-20</span>,sum/(<span class="number">40</span>*n<span class="number">-20</span>),<span class="number">3</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2359çŸ©å½¢å¤–æ¡†A">2359çŸ©å½¢å¤–æ¡†A</h2><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/image-20240628153308344.png" alt="image-20240628153308344"></p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/image-20240628153357201.png" alt="image-20240628153357201"></p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/image-20240628153409419.png" alt="image-20240628153409419"></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">myMax</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(a&gt;b) <span class="keyword">return</span> a;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> a[<span class="number">4</span>],X,Y,max,res;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">4</span>;i++)&#123;</span><br><span class="line">        cin &gt;&gt; a[i];</span><br><span class="line">        <span class="keyword">if</span>(max&lt;a[i]) max=a[i];</span><br><span class="line">    &#125;</span><br><span class="line">    p.<span class="built_in">r</span>(<span class="number">100</span>,<span class="number">100</span>).<span class="built_in">up</span>();</span><br><span class="line">    p.<span class="built_in">moveTo</span>(<span class="number">-50</span>,<span class="number">50</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">4</span>;i++)&#123;</span><br><span class="line">        p.<span class="built_in">rt</span>(<span class="number">90</span>).<span class="built_in">o</span>(a[i]);</span><br><span class="line">        <span class="keyword">if</span>(a[i]==max)&#123;</span><br><span class="line">            X=<span class="built_in">getX</span>();</span><br><span class="line">            Y=<span class="built_in">getY</span>();</span><br><span class="line">            res=i;</span><br><span class="line">        &#125;</span><br><span class="line">        p.<span class="built_in">fd</span>(<span class="number">100</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(a[res]&gt;a[(res+<span class="number">1</span>)%<span class="number">4</span>]+<span class="number">100</span> &amp;&amp; a[res]&gt;a[(res+<span class="number">2</span>)%<span class="number">4</span>]+<span class="number">100</span>&amp;&amp;a[res]&gt;a[(res+<span class="number">3</span>)%<span class="number">4</span>]+<span class="number">100</span>)&#123;<span class="comment">//æœ€å¤§å€¼å¾ˆå¤§</span></span><br><span class="line">        p.<span class="built_in">moveTo</span>(X,Y);</span><br><span class="line">        p.<span class="built_in">r</span>(max*<span class="number">2</span>,max*<span class="number">2</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(a[(res+<span class="number">1</span>)%<span class="number">4</span>]&lt;a[(res+<span class="number">2</span>)%<span class="number">4</span>] &amp;&amp; a[(res+<span class="number">2</span>)%<span class="number">4</span>] &gt; a[(res+<span class="number">3</span>)%<span class="number">4</span>])&#123;<span class="comment">//å¯¹è§’çº¿</span></span><br><span class="line">            cout &lt;&lt; <span class="string">&quot;å¯¹è§’çº¿&quot;</span>;</span><br><span class="line">            p.<span class="built_in">moveTo</span>(X/<span class="built_in">abs</span>(X)*(<span class="number">50</span>+max-(a[res]+a[(res+<span class="number">2</span>)%<span class="number">4</span>]+<span class="number">100</span>)/<span class="number">2.0</span>),Y/<span class="built_in">abs</span>(Y)*(<span class="number">50</span>+max-(a[res]+a[(res+<span class="number">2</span>)%<span class="number">4</span>]+<span class="number">100</span>)/<span class="number">2.0</span>));</span><br><span class="line">            p.<span class="built_in">r</span>((a[res]+a[(res+<span class="number">2</span>)%<span class="number">4</span>]+<span class="number">100</span>),(a[res]+a[(res+<span class="number">2</span>)%<span class="number">4</span>]+<span class="number">100</span>));</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">//é•¿ä¸ºé•¿ çŸ­ä¸ºå®½</span></span><br><span class="line">            <span class="keyword">if</span>((res%<span class="number">2</span>==<span class="number">0</span>&amp;&amp;a[(res+<span class="number">1</span>)%<span class="number">4</span>]&gt;a[(res+<span class="number">2</span>)%<span class="number">4</span>] &amp;&amp; a[(res+<span class="number">1</span>)%<span class="number">4</span>] &gt; a[(res+<span class="number">3</span>)%<span class="number">4</span>])||(res%<span class="number">2</span>==<span class="number">1</span>&amp;&amp;a[(res+<span class="number">3</span>)%<span class="number">4</span>]&gt;a[(res+<span class="number">1</span>)%<span class="number">4</span>] &amp;&amp; a[(res+<span class="number">3</span>)%<span class="number">4</span>] &gt; a[(res+<span class="number">2</span>)%<span class="number">4</span>]))&#123;</span><br><span class="line">                p.<span class="built_in">moveTo</span>(X/<span class="built_in">abs</span>(X)*(<span class="number">50</span>+max-(max+a[(res+<span class="number">1</span>+<span class="number">2</span>*(res%<span class="number">2</span>))%<span class="number">4</span>]+<span class="number">100</span>)/<span class="number">2.0</span>),Y/<span class="built_in">abs</span>(Y)*(<span class="number">50</span>+max-(max+<span class="built_in">myMax</span>(a[(res+<span class="number">2</span>-res%<span class="number">2</span>)%<span class="number">4</span>],a[(res+<span class="number">3</span>-res%<span class="number">2</span>)%<span class="number">4</span>])+<span class="number">100</span>)/<span class="number">2.0</span>));</span><br><span class="line">                p.<span class="built_in">r</span>(max+a[(res+<span class="number">1</span>+<span class="number">2</span>*(res%<span class="number">2</span>))%<span class="number">4</span>]+<span class="number">100</span>,max+<span class="built_in">myMax</span>(a[(res+<span class="number">2</span>-res%<span class="number">2</span>)%<span class="number">4</span>],a[(res+<span class="number">3</span>-res%<span class="number">2</span>)%<span class="number">4</span>])+<span class="number">100</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="comment">//é•¿ä¸ºå®½ çŸ­ä¸ºé•¿</span></span><br><span class="line">                p.<span class="built_in">moveTo</span>(X/<span class="built_in">abs</span>(X)*(<span class="number">50</span>+max-(max+<span class="built_in">myMax</span>(a[(res+<span class="number">1</span>+res%<span class="number">2</span>)%<span class="number">4</span>],a[(res+<span class="number">2</span>+res%<span class="number">2</span>)%<span class="number">4</span>])+<span class="number">100</span>)/<span class="number">2.0</span>),Y/<span class="built_in">abs</span>(Y)*(<span class="number">50</span>+max-(max+a[(res+<span class="number">3</span><span class="number">-2</span>*(res%<span class="number">2</span>))%<span class="number">4</span>]+<span class="number">100</span>)/<span class="number">2.0</span>));</span><br><span class="line">                p.<span class="built_in">r</span>(max+<span class="built_in">myMax</span>(a[(res+<span class="number">1</span>+res%<span class="number">2</span>)%<span class="number">4</span>],a[(res+<span class="number">2</span>+res%<span class="number">2</span>)%<span class="number">4</span>])+<span class="number">100</span>,max+a[(res+<span class="number">3</span><span class="number">-2</span>*(res%<span class="number">2</span>))%<span class="number">4</span>]+<span class="number">100</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2360ç»¿è‰²æ­£ä¸‰è§’å½¢">2360ç»¿è‰²æ­£ä¸‰è§’å½¢</h2><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/image-20240623174108830.png" alt="image-20240623174108830"></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    p.<span class="built_in">c</span>(<span class="number">10</span>).<span class="built_in">rt</span>(<span class="number">30</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">6</span>;i++) &#123;</span><br><span class="line">        <span class="keyword">if</span>(i==<span class="number">3</span>)&#123;</span><br><span class="line">           p.<span class="built_in">rt</span>(<span class="number">60</span>).<span class="built_in">fd</span>(<span class="number">75</span>).<span class="built_in">lt</span>(<span class="number">120</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        p.<span class="built_in">fd</span>(<span class="number">150</span>).<span class="built_in">rt</span>(<span class="number">120</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2361é»‘è‰²å°è®°">2361é»‘è‰²å°è®°</h2><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/image-20240628154114419.png" alt="image-20240628154114419"></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    p.<span class="built_in">picU</span>(<span class="number">0</span>).<span class="built_in">up</span>();</span><br><span class="line">    p.<span class="built_in">oo</span>(<span class="number">283</span>,<span class="number">0</span>);</span><br><span class="line">    p.<span class="built_in">rr</span>(<span class="number">400</span>,<span class="number">400</span>,<span class="number">15</span>);</span><br><span class="line">    p.<span class="built_in">rt</span>(<span class="number">45</span>).<span class="built_in">rr</span>(<span class="number">400</span>,<span class="number">400</span>,<span class="number">15</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">8</span>;i++)&#123;</span><br><span class="line">        p.<span class="built_in">fd</span>(<span class="number">150</span>).<span class="built_in">rt</span>(<span class="number">45</span>).<span class="built_in">rr</span>(<span class="number">90</span>,<span class="number">90</span>,<span class="number">0</span>).<span class="built_in">lt</span>(<span class="number">45</span>).<span class="built_in">bk</span>(<span class="number">150</span>);</span><br><span class="line">        p.<span class="built_in">rt</span>(<span class="number">45</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2362æŒ‘é€‰æ—¥æœŸ">2362æŒ‘é€‰æ—¥æœŸ</h2><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/image-20240623174130144.png" alt="image-20240623174130144"></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    p.<span class="built_in">rt</span>(<span class="number">90</span>).<span class="built_in">up</span>();</span><br><span class="line">    <span class="type">int</span> a[<span class="number">5</span>];</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">5</span>;i++)&#123;</span><br><span class="line">        cin &gt;&gt; a[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">5</span>;i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>((a[i]+<span class="number">1</span>)%<span class="number">7</span>==<span class="number">6</span>)&#123;</span><br><span class="line">            p.<span class="built_in">oo</span>(<span class="number">20</span>,<span class="number">3</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>((a[i]+<span class="number">1</span>)%<span class="number">7</span>==<span class="number">0</span>)&#123;</span><br><span class="line">            p.<span class="built_in">oo</span>(<span class="number">20</span>,<span class="number">4</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            p.<span class="built_in">oo</span>(<span class="number">20</span>,<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        p.<span class="built_in">fd</span>(<span class="number">40</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2363è½¦è¾†ç»Ÿè®¡">2363è½¦è¾†ç»Ÿè®¡</h2><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/image-20240623175620853.png" alt="image-20240623175620853"></p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/image-20240623175632380.png" alt="image-20240623175632380"></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">double</span> avg,sum=<span class="number">0</span>,n,a[<span class="number">10</span>],max=<span class="number">0</span>;</span><br><span class="line">    p.<span class="built_in">hide</span>().<span class="built_in">speed</span>(<span class="number">9</span>);</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line">        cin &gt;&gt; a[i];</span><br><span class="line">        sum += a[i];</span><br><span class="line">        <span class="keyword">if</span>(max &lt; a[i]) max=a[i];</span><br><span class="line">    &#125;</span><br><span class="line">    avg = sum / n;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line">        p.<span class="built_in">moveTo</span>(<span class="number">20</span>*i,<span class="number">0</span>).<span class="built_in">fd</span>(a[i]);</span><br><span class="line">        <span class="keyword">if</span>(max==a[i]) p.<span class="built_in">up</span>().<span class="built_in">fd</span>(<span class="number">20</span>).<span class="built_in">o</span>(<span class="number">20</span>,<span class="number">1</span>).<span class="built_in">down</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    p.<span class="built_in">moveTo</span>(<span class="number">0</span>,avg).<span class="built_in">rt</span>(<span class="number">90</span>).<span class="built_in">c</span>(<span class="number">1</span>).<span class="built_in">fd</span>(<span class="number">20</span>*n<span class="number">-20</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2364ç»Ÿè®¡æ’æ°´é‡">2364ç»Ÿè®¡æ’æ°´é‡</h2><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/image-20240628154344906.png" alt="image-20240628154344906"></p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/image-20240628154553404.png" alt="image-20240628154553404"></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">double</span> sum=<span class="number">0</span>,n,a[<span class="number">15</span>],max=<span class="number">0</span>;</span><br><span class="line">    p.<span class="built_in">hide</span>().<span class="built_in">speed</span>(<span class="number">9</span>);</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line">        cin &gt;&gt; a[i];</span><br><span class="line">        <span class="keyword">if</span>(max &lt; a[i]) max=a[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line">        p.<span class="built_in">moveTo</span>(<span class="number">20</span>*i,a[i]/max*<span class="number">150</span>).<span class="built_in">r</span>(<span class="number">20</span>,a[i]/max*<span class="number">300</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2365çŸ©å½¢å¤–æ¡†B">2365çŸ©å½¢å¤–æ¡†B</h2><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/image-20240623180651332.png" alt="image-20240623180651332"></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">myMax</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(a&gt;b) <span class="keyword">return</span> a;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> a[<span class="number">4</span>],X,Y,max,res;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">4</span>;i++)&#123;</span><br><span class="line">        cin &gt;&gt; a[i];</span><br><span class="line">        <span class="keyword">if</span>(max&lt;a[i]) max=a[i];</span><br><span class="line">    &#125;</span><br><span class="line">    p.<span class="built_in">r</span>(<span class="number">100</span>,<span class="number">100</span>).<span class="built_in">up</span>();</span><br><span class="line">    p.<span class="built_in">moveTo</span>(<span class="number">-50</span>,<span class="number">50</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">4</span>;i++)&#123;</span><br><span class="line">        p.<span class="built_in">rt</span>(<span class="number">90</span>).<span class="built_in">o</span>(a[i]);</span><br><span class="line">        <span class="keyword">if</span>(a[i]==max)&#123;</span><br><span class="line">            X=<span class="built_in">getX</span>();</span><br><span class="line">            Y=<span class="built_in">getY</span>();</span><br><span class="line">            res=i;</span><br><span class="line">        &#125;</span><br><span class="line">        p.<span class="built_in">fd</span>(<span class="number">100</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(a[res]&gt;a[(res+<span class="number">1</span>)%<span class="number">4</span>]+<span class="number">100</span> &amp;&amp; a[res]&gt;a[(res+<span class="number">2</span>)%<span class="number">4</span>]+<span class="number">100</span>&amp;&amp;a[res]&gt;a[(res+<span class="number">3</span>)%<span class="number">4</span>]+<span class="number">100</span>)&#123;<span class="comment">//æœ€å¤§å€¼å¾ˆå¤§</span></span><br><span class="line">        p.<span class="built_in">moveTo</span>(X,Y);</span><br><span class="line">        p.<span class="built_in">r</span>(max*<span class="number">2</span>,max*<span class="number">2</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(a[(res+<span class="number">1</span>)%<span class="number">4</span>]&lt;a[(res+<span class="number">2</span>)%<span class="number">4</span>] &amp;&amp; a[(res+<span class="number">2</span>)%<span class="number">4</span>] &gt; a[(res+<span class="number">3</span>)%<span class="number">4</span>])&#123;<span class="comment">//å¯¹è§’çº¿</span></span><br><span class="line">            p.<span class="built_in">moveTo</span>(X/<span class="built_in">abs</span>(X)*(<span class="number">50</span>+max-(a[res]+a[(res+<span class="number">2</span>)%<span class="number">4</span>]+<span class="number">100</span>)/<span class="number">2.0</span>),Y/<span class="built_in">abs</span>(Y)*(<span class="number">50</span>+max-(a[res]+a[(res+<span class="number">2</span>)%<span class="number">4</span>]+<span class="number">100</span>)/<span class="number">2.0</span>));</span><br><span class="line">            p.<span class="built_in">r</span>((a[res]+a[(res+<span class="number">2</span>)%<span class="number">4</span>]+<span class="number">100</span>),(a[res]+a[(res+<span class="number">2</span>)%<span class="number">4</span>]+<span class="number">100</span>));</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">//é•¿ä¸ºé•¿ çŸ­ä¸ºå®½</span></span><br><span class="line">            <span class="keyword">if</span>((res%<span class="number">2</span>==<span class="number">0</span>&amp;&amp;a[(res+<span class="number">1</span>)%<span class="number">4</span>]&gt;a[(res+<span class="number">2</span>)%<span class="number">4</span>] &amp;&amp; a[(res+<span class="number">1</span>)%<span class="number">4</span>] &gt; a[(res+<span class="number">3</span>)%<span class="number">4</span>])||(res%<span class="number">2</span>==<span class="number">1</span>&amp;&amp;a[(res+<span class="number">3</span>)%<span class="number">4</span>]&gt;a[(res+<span class="number">1</span>)%<span class="number">4</span>] &amp;&amp; a[(res+<span class="number">3</span>)%<span class="number">4</span>] &gt; a[(res+<span class="number">2</span>)%<span class="number">4</span>]))&#123;</span><br><span class="line">                p.<span class="built_in">moveTo</span>(X/<span class="built_in">abs</span>(X)*(<span class="number">50</span>+max-(max+a[(res+<span class="number">1</span>+<span class="number">2</span>*(res%<span class="number">2</span>))%<span class="number">4</span>]+<span class="number">100</span>)/<span class="number">2.0</span>),Y/<span class="built_in">abs</span>(Y)*(<span class="number">50</span>+max-(max+<span class="built_in">myMax</span>(a[(res+<span class="number">2</span>-res%<span class="number">2</span>)%<span class="number">4</span>],a[(res+<span class="number">3</span>-res%<span class="number">2</span>)%<span class="number">4</span>])+<span class="number">100</span>)/<span class="number">2.0</span>));</span><br><span class="line">                p.<span class="built_in">r</span>(max+a[(res+<span class="number">1</span>+<span class="number">2</span>*(res%<span class="number">2</span>))%<span class="number">4</span>]+<span class="number">100</span>,max+<span class="built_in">myMax</span>(a[(res+<span class="number">2</span>-res%<span class="number">2</span>)%<span class="number">4</span>],a[(res+<span class="number">3</span>-res%<span class="number">2</span>)%<span class="number">4</span>])+<span class="number">100</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="comment">//é•¿ä¸ºå®½ çŸ­ä¸ºé•¿</span></span><br><span class="line">                p.<span class="built_in">moveTo</span>(X/<span class="built_in">abs</span>(X)*(<span class="number">50</span>+max-(max+<span class="built_in">myMax</span>(a[(res+<span class="number">1</span>+res%<span class="number">2</span>)%<span class="number">4</span>],a[(res+<span class="number">2</span>+res%<span class="number">2</span>)%<span class="number">4</span>])+<span class="number">100</span>)/<span class="number">2.0</span>),Y/<span class="built_in">abs</span>(Y)*(<span class="number">50</span>+max-(max+a[(res+<span class="number">3</span><span class="number">-2</span>*(res%<span class="number">2</span>))%<span class="number">4</span>]+<span class="number">100</span>)/<span class="number">2.0</span>));</span><br><span class="line">                p.<span class="built_in">r</span>(max+<span class="built_in">myMax</span>(a[(res+<span class="number">1</span>+res%<span class="number">2</span>)%<span class="number">4</span>],a[(res+<span class="number">2</span>+res%<span class="number">2</span>)%<span class="number">4</span>])+<span class="number">100</span>,max+a[(res+<span class="number">3</span><span class="number">-2</span>*(res%<span class="number">2</span>))%<span class="number">4</span>]+<span class="number">100</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2366å½©è‰²èŠ±æœµ">2366å½©è‰²èŠ±æœµ</h2><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/image-20240628155229283.png" alt="image-20240628155229283"></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    p.<span class="built_in">picU</span>(<span class="number">0</span>); <span class="comment">//å¼€å¯å›¾å½¢æŒ‰ç…§ç¬”æ–¹å‘ç”»</span></span><br><span class="line">    p.<span class="built_in">up</span>();</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">9</span>;i++)&#123;</span><br><span class="line">        p.<span class="built_in">fd</span>(<span class="number">130</span>).<span class="built_in">ee</span>(<span class="number">20</span>,<span class="number">100</span>,<span class="number">13</span>).<span class="built_in">bk</span>(<span class="number">130</span>).<span class="built_in">rt</span>(<span class="number">40</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    p.<span class="built_in">rt</span>(<span class="number">20</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">9</span>;i++)&#123;</span><br><span class="line">        p.<span class="built_in">fd</span>(<span class="number">110</span>).<span class="built_in">ee</span>(<span class="number">30</span>,<span class="number">80</span>,<span class="number">14</span>).<span class="built_in">bk</span>(<span class="number">110</span>).<span class="built_in">rt</span>(<span class="number">40</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2367å˜åŒ–çš„æ­£æ–¹å½¢">2367å˜åŒ–çš„æ­£æ–¹å½¢</h2><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/image-20240628151021609.png" alt="image-20240628151021609"></p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/image-20240628150954532.png" alt="image-20240628150954532"></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line">        p.<span class="built_in">c</span>(i);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;<span class="number">6</span>;j++)&#123;</span><br><span class="line">            p.<span class="built_in">fd</span>(<span class="number">200</span><span class="number">-20</span>*i).<span class="built_in">lt</span>(<span class="number">90</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2368å½©è‰²å›¾å½¢">2368å½©è‰²å›¾å½¢</h2><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/image-20240628150229616.png" alt="image-20240628150229616"></p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/image-20240628150316832.png" alt="image-20240628150316832"></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    p.<span class="built_in">moveTo</span>(<span class="number">-300</span>,<span class="number">300</span>).<span class="built_in">up</span>().<span class="built_in">hide</span>().<span class="built_in">rt</span>(<span class="number">90</span>);</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=i;j&lt;n+i;j++)&#123; <span class="comment">// 4 5 6 7 8</span></span><br><span class="line">            <span class="keyword">if</span>(j&gt;n<span class="number">-1</span>)&#123;</span><br><span class="line">                p.<span class="built_in">oo</span>(<span class="number">20</span>,(j<span class="number">-1</span>)%(n<span class="number">-1</span>));</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                p.<span class="built_in">oo</span>(<span class="number">20</span>,j);</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">            p.<span class="built_in">fd</span>(<span class="number">40</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        p.<span class="built_in">moveTo</span>(<span class="number">-300</span>,<span class="number">260</span><span class="number">-40</span>*i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2369è…¾å›¾">2369è…¾å›¾</h2><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/image-20240623174555103.png" alt="image-20240623174555103"></p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/image-20240628165336683.png" alt="image-20240628165336683"></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    p.<span class="built_in">c</span>(<span class="number">12</span>).<span class="built_in">speed</span>(<span class="number">9</span>).<span class="built_in">hide</span>();</span><br><span class="line">    <span class="type">int</span> n,a,b,o;</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">6</span>;i++)&#123;</span><br><span class="line">        p.<span class="built_in">fd</span>(n).<span class="built_in">rt</span>(<span class="number">60</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    p.<span class="built_in">rt</span>(<span class="number">90</span>);</span><br><span class="line">    a = <span class="number">2</span>*<span class="built_in">sqrt</span>(n*n-(n/<span class="number">2.0</span>)*(n/<span class="number">2.0</span>));</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">3</span>;i++)&#123;</span><br><span class="line">        p.<span class="built_in">fd</span>(a).<span class="built_in">lt</span>(<span class="number">120</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    b = a /<span class="number">2.0</span>;</span><br><span class="line">    p.<span class="built_in">fd</span>(b).<span class="built_in">lt</span>(<span class="number">60</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">3</span>;i++)&#123;</span><br><span class="line">        p.<span class="built_in">fd</span>(b).<span class="built_in">rt</span>(<span class="number">30</span>).<span class="built_in">fd</span>(n/<span class="number">2.0</span>).<span class="built_in">bk</span>(n/<span class="number">2.0</span>).<span class="built_in">lt</span>(<span class="number">150</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    o = b/<span class="number">2.0</span>/<span class="built_in">sqrt</span>(<span class="number">3</span>);</span><br><span class="line">    p.<span class="built_in">up</span>().<span class="built_in">fd</span>(b/<span class="number">2.0</span>).<span class="built_in">lt</span>(<span class="number">90</span>).<span class="built_in">fd</span>(o).<span class="built_in">o</span>(o);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2370å˜åŒ–çš„ç«‹æ–¹ä½“">2370å˜åŒ–çš„ç«‹æ–¹ä½“</h2><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/image-20240623175645692.png" alt="image-20240623175645692"></p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/image-20240623175654138.png" alt="image-20240623175654138"></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å‡½æ•°ï¼šè®¡ç®—ä¸¤ä¸ªæ•°çš„æœ€å¤§å…¬çº¦æ•°</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">gcd</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (b != <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="type">int</span> temp = a % b;</span><br><span class="line">        a = b;</span><br><span class="line">        b = temp;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> a;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‡½æ•°ï¼šè®¡ç®—ä¸‰ä¸ªæ•°çš„æœ€å¤§å…¬çº¦æ•°</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">gcdOfThree</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b, <span class="type">int</span> c)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// å…ˆè®¡ç®—å‰ä¸¤ä¸ªæ•°çš„GCD</span></span><br><span class="line">    <span class="type">int</span> gcdAB = <span class="built_in">gcd</span>(a, b);</span><br><span class="line">    <span class="comment">// å†ç”¨è¿™ä¸ªç»“æœä¸ç¬¬ä¸‰ä¸ªæ•°è®¡ç®—GCD</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">gcd</span>(gcdAB, c);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> a[<span class="number">3</span>],b;</span><br><span class="line">    p.<span class="built_in">speed</span>(<span class="number">6</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">3</span>;i++)&#123;</span><br><span class="line">        cin &gt;&gt; a[i];</span><br><span class="line">    &#125;</span><br><span class="line">    b=<span class="built_in">gcdOfThree</span>(a[<span class="number">0</span>],a[<span class="number">1</span>],a[<span class="number">2</span>]);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;=a[<span class="number">0</span>]/b;i++)&#123;</span><br><span class="line">        p.<span class="built_in">moveTo</span>(-b*i,-a[<span class="number">2</span>]);</span><br><span class="line">        p.<span class="built_in">fd</span>(a[<span class="number">2</span>]).<span class="built_in">rt</span>(<span class="number">45</span>).<span class="built_in">fd</span>(a[<span class="number">1</span>]).<span class="built_in">lt</span>(<span class="number">45</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    p.<span class="built_in">rt</span>(<span class="number">90</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;=a[<span class="number">1</span>]/b;i++)&#123;</span><br><span class="line">        p.<span class="built_in">fd</span>(a[<span class="number">0</span>]).<span class="built_in">rt</span>(<span class="number">90</span>).<span class="built_in">fd</span>(a[<span class="number">2</span>]);</span><br><span class="line">        p.<span class="built_in">up</span>().<span class="built_in">bk</span>(a[<span class="number">2</span>]).<span class="built_in">rt</span>(<span class="number">90</span>).<span class="built_in">fd</span>(a[<span class="number">0</span>]).<span class="built_in">lt</span>(<span class="number">45</span>).<span class="built_in">fd</span>(b).<span class="built_in">lt</span>(<span class="number">135</span>).<span class="built_in">down</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;a[<span class="number">2</span>]/b;i++)&#123;</span><br><span class="line">        p.<span class="built_in">moveTo</span>(-a[<span class="number">0</span>],-b*i-b);</span><br><span class="line">        p.<span class="built_in">fd</span>(a[<span class="number">0</span>]).<span class="built_in">lt</span>(<span class="number">45</span>).<span class="built_in">fd</span>(a[<span class="number">1</span>]).<span class="built_in">rt</span>(<span class="number">45</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2371çŸ©å½¢å¤–æ¡†C">2371çŸ©å½¢å¤–æ¡†C</h2><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/image-20240628152010556.png" alt="image-20240628152010556"></p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/image-20240628152027315.png" alt="image-20240628152027315"></p>]]></content>
    
    
    <summary type="html">2023é’ç§‘èµ›ç‰¹è®­é¢˜ä»¥åŠç­”æ¡ˆ</summary>
    
    
    
    <category term="æ‚é¡¹" scheme="https://u7u7.top/categories/%E6%9D%82%E9%A1%B9/"/>
    
    
    <category term="C++" scheme="https://u7u7.top/tags/C/"/>
    
  </entry>
  
  <entry>
    <title>æ—…ç‰›ç½‘ v1.0.0</title>
    <link href="https://u7u7.top/posts/traval.html"/>
    <id>https://u7u7.top/posts/traval.html</id>
    <published>2024-06-20T08:30:25.000Z</published>
    <updated>2025-08-25T01:41:06.524Z</updated>
    
    <content type="html"><![CDATA[<h1 id="æ—…ç‰›ç½‘">æ—…ç‰›ç½‘</h1><blockquote><p>v1.0.0</p></blockquote><p>Base URLs:</p><ul><li><a href="http://127.0.0.1:80">æµ‹è¯•ç¯å¢ƒ: http://127.0.0.1:80</a></li></ul><h1 id="Default">Default</h1><h2 id="GET-flaskæµ‹è¯•">GET flaskæµ‹è¯•</h2><p>GET /</p><h3 id="è¯·æ±‚å‚æ•°">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>æˆåŠŸ</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="string">&quot;å“ˆå“ˆå“ˆ&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td>Inline</td></tr></tbody></table><h3 id="è¿”å›æ•°æ®ç»“æ„">è¿”å›æ•°æ®ç»“æ„</h3><p>çŠ¶æ€ç  <strong>200</strong></p><table><thead><tr><th>åç§°</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>çº¦æŸ</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Â» data</td><td>string</td><td>true</td><td>none</td><td></td><td>none</td></tr></tbody></table><h1 id="æ—…ç‰›ç½‘-åŸå¸‚Controller">æ—…ç‰›ç½‘/åŸå¸‚Controller</h1><h2 id="GET-çƒ­é—¨åŸå¸‚-xä¸ºçœä»½-yä¸ºåŸå¸‚-zä¸ºçƒ­åº¦å€¼">GET çƒ­é—¨åŸå¸‚(xä¸ºçœä»½ yä¸ºåŸå¸‚ zä¸ºçƒ­åº¦å€¼)</h2><p>GET /city/hot</p><h3 id="è¯·æ±‚å‚æ•°-2">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>æˆåŠŸ</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-2">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td><a href="#schemaajaxresult">AjaxResult</a></td></tr></tbody></table><h2 id="GET-åŸå¸‚åˆ—è¡¨">GET åŸå¸‚åˆ—è¡¨</h2><p>GET /city/cityList</p><h3 id="è¯·æ±‚å‚æ•°-3">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>æˆåŠŸ</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-3">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td><a href="#schemaajaxresult">AjaxResult</a></td></tr></tbody></table><h2 id="GET-çœä»½åŸå¸‚æ™¯åŒºåˆ—è¡¨">GET çœä»½åŸå¸‚æ™¯åŒºåˆ—è¡¨</h2><p>GET /city/provinceCityList</p><p>è¿”å›æ‰€æœ‰å·²çŸ¥çœä»½çš„å·²çŸ¥åŸå¸‚çš„å·²çŸ¥æ™¯ç‚¹</p><h3 id="è¯·æ±‚å‚æ•°-4">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>æˆåŠŸ</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-4">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td><a href="#schemaajaxresult">AjaxResult</a></td></tr></tbody></table><h2 id="GET-è¯¥åŸå¸‚æœ‰å‡ ä¸ªæ™¯ç‚¹">GET è¯¥åŸå¸‚æœ‰å‡ ä¸ªæ™¯ç‚¹</h2><p>GET /city/peopleCityList</p><h3 id="è¯·æ±‚å‚æ•°-5">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>æˆåŠŸ</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-5">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td><a href="#schemaajaxresult">AjaxResult</a></td></tr></tbody></table><h2 id="GET-åŸå¸‚æ™¯ç‚¹æ€»æ•°å¹³å‡å€¼">GET åŸå¸‚æ™¯ç‚¹æ€»æ•°å¹³å‡å€¼</h2><p>GET /city/citySpotAvgRating</p><h3 id="è¯·æ±‚å‚æ•°-6">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>æˆåŠŸ</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-6">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td><a href="#schemaajaxresult">AjaxResult</a></td></tr></tbody></table><h1 id="æ—…ç‰›ç½‘-çœä»½Controller">æ—…ç‰›ç½‘/çœä»½Controller</h1><h2 id="GET-çƒ­é—¨çœä»½">GET çƒ­é—¨çœä»½</h2><p>GET /province/hotTop</p><h3 id="è¯·æ±‚å‚æ•°-7">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>æˆåŠŸ</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-7">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td><a href="#schemaajaxresult">AjaxResult</a></td></tr></tbody></table><h2 id="GET-è¿”å›æ‰€æœ‰çš„çœä»½å">GET è¿”å›æ‰€æœ‰çš„çœä»½å</h2><p>GET /province/provinceList</p><h3 id="è¯·æ±‚å‚æ•°-8">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>æˆåŠŸ</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-8">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td><a href="#schemaajaxresult">AjaxResult</a></td></tr></tbody></table><h2 id="POST-è¿”å›æŒ‡å®šçœä»½çš„æ‰€æœ‰åŸå¸‚">POST è¿”å›æŒ‡å®šçœä»½çš„æ‰€æœ‰åŸå¸‚</h2><p>POST /province/provincePointCity</p><h3 id="è¯·æ±‚å‚æ•°-9">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>provinceName</td><td>query</td><td>string</td><td>å¦</td><td>none</td></tr><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>æˆåŠŸ</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-9">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td><a href="#schemaajaxresult">AjaxResult</a></td></tr></tbody></table><h1 id="æ—…ç‰›ç½‘-æ™¯ç‚¹Controller">æ—…ç‰›ç½‘/æ™¯ç‚¹Controller</h1><h2 id="GET-æŸ¥è¯¢å…¨éƒ¨">GET æŸ¥è¯¢å…¨éƒ¨</h2><p>GET /spot/all</p><h3 id="è¯·æ±‚å‚æ•°-10">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>æˆåŠŸ</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-10">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td><a href="#schemaajaxresult">AjaxResult</a></td></tr></tbody></table><h2 id="GET-è¿”å›ä¸€ä¸ªæŒ‡å®šæ™¯åŒºçš„ä¿¡æ¯">GET è¿”å›ä¸€ä¸ªæŒ‡å®šæ™¯åŒºçš„ä¿¡æ¯</h2><p>GET /spot/spot/item/{spotid}</p><h3 id="è¯·æ±‚å‚æ•°-11">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>spotid</td><td>path</td><td>string</td><td>æ˜¯</td><td>æ™¯åŒºID</td></tr><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>æˆåŠŸ</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-11">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td><a href="#schemaajaxresult">AjaxResult</a></td></tr></tbody></table><h2 id="GET-æ¥å£æµ‹è¯•">GET æ¥å£æµ‹è¯•</h2><p>GET /spot/test</p><h3 id="è¯·æ±‚å‚æ•°-12">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>æˆåŠŸ</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-12">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td><a href="#schemaajaxresult">AjaxResult</a></td></tr></tbody></table><h2 id="GET-ç‚¹è¯„æœ€å¤š-æŒ‰ç…§æ™¯åŒºè¡¨çš„SUM">GET ç‚¹è¯„æœ€å¤š(æŒ‰ç…§æ™¯åŒºè¡¨çš„SUM)</h2><p>GET /spot/spotBySum</p><h3 id="è¯·æ±‚å‚æ•°-13">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>æˆåŠŸ</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-13">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td><a href="#schemaajaxresult">AjaxResult</a></td></tr></tbody></table><h2 id="GET-å­£èŠ‚æœ€çƒ­é—¨æ™¯åŒº-xè½´-å­£èŠ‚-yè½´-æ™¯åŒº-zè½´-è¯¥å­£åº¦æ€»è¯„è®ºæ•°">GET å­£èŠ‚æœ€çƒ­é—¨æ™¯åŒº(xè½´ å­£èŠ‚ yè½´ æ™¯åŒº  zè½´ è¯¥å­£åº¦æ€»è¯„è®ºæ•°)</h2><p>GET /spot/seasonSpotSumInfo</p><h3 id="è¯·æ±‚å‚æ•°-14">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>æˆåŠŸ</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-14">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td><a href="#schemaajaxresult">AjaxResult</a></td></tr></tbody></table><h2 id="GET-æ™¯åŒºæœç´¢æ ">GET æ™¯åŒºæœç´¢æ </h2><p>GET /spot/spotInfoSearch</p><h3 id="è¯·æ±‚å‚æ•°-15">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>æˆåŠŸ</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-15">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td><a href="#schemaajaxresult">AjaxResult</a></td></tr></tbody></table><h2 id="GET-å„æ™¯åŒºè¯„è®ºæ•°">GET å„æ™¯åŒºè¯„è®ºæ•°</h2><p>GET /spot/spotComInfo</p><h3 id="è¯·æ±‚å‚æ•°-16">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>æˆåŠŸ</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-16">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td><a href="#schemaajaxresult">AjaxResult</a></td></tr></tbody></table><h2 id="GET-å•ä¸ªæ™¯ç‚¹çš„å„é¡¹æŒ‡æ ‡">GET å•ä¸ªæ™¯ç‚¹çš„å„é¡¹æŒ‡æ ‡</h2><p>GET /spot/spotFiveInfo/{spotId}</p><h3 id="è¯·æ±‚å‚æ•°-17">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>spotId</td><td>path</td><td>string</td><td>æ˜¯</td><td>æ™¯ç‚¹ID</td></tr><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>æˆåŠŸ</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-17">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td><a href="#schemaajaxresult">AjaxResult</a></td></tr></tbody></table><h2 id="GET-å…¨éƒ¨æ™¯ç‚¹çš„å¹³å‡å„é¡¹æŒ‡æ ‡">GET å…¨éƒ¨æ™¯ç‚¹çš„å¹³å‡å„é¡¹æŒ‡æ ‡</h2><p>GET /spot/spotAllFiveInfo</p><h3 id="è¯·æ±‚å‚æ•°-18">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>æˆåŠŸ</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-18">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td><a href="#schemaajaxresult">AjaxResult</a></td></tr></tbody></table><h2 id="GET-å„æœˆæ™¯ç‚¹è¯„è®ºå’Œå¹³å‡å£ç¢‘">GET å„æœˆæ™¯ç‚¹è¯„è®ºå’Œå¹³å‡å£ç¢‘</h2><p>GET /spot/stringListHashMap</p><h3 id="è¯·æ±‚å‚æ•°-19">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>æˆåŠŸ</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-19">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td><a href="#schemaajaxresult">AjaxResult</a></td></tr></tbody></table><h2 id="GET-æŸä¸ªæ™¯åŒºæ¥è‡ªå„ä¸ªçœçš„æ¸¸å®¢æ•°">GET æŸä¸ªæ™¯åŒºæ¥è‡ªå„ä¸ªçœçš„æ¸¸å®¢æ•°</h2><p>GET /spot/spotProvincePeopleNum/{spotId}</p><h3 id="è¯·æ±‚å‚æ•°-20">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>spotId</td><td>path</td><td>string</td><td>æ˜¯</td><td>none</td></tr><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>æˆåŠŸ</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-20">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td><a href="#schemaajaxresult">AjaxResult</a></td></tr></tbody></table><h2 id="GET-çƒ­åº¦å‰åçš„æ™¯ç‚¹">GET çƒ­åº¦å‰åçš„æ™¯ç‚¹</h2><p>GET /spot/hotTop10</p><h3 id="è¯·æ±‚å‚æ•°-21">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>æˆåŠŸ</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-21">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td><a href="#schemaajaxresult">AjaxResult</a></td></tr></tbody></table><h2 id="GET-æ˜Ÿè¯„å‰åçš„æ™¯ç‚¹">GET æ˜Ÿè¯„å‰åçš„æ™¯ç‚¹</h2><p>GET /spot/gradeTop10</p><h3 id="è¯·æ±‚å‚æ•°-22">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>æˆåŠŸ</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-22">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td><a href="#schemaajaxresult">AjaxResult</a></td></tr></tbody></table><h2 id="GET-æ¨èæŒ‡æ•°å‰åçš„æ™¯ç‚¹">GET æ¨èæŒ‡æ•°å‰åçš„æ™¯ç‚¹</h2><p>GET /spot/ratingTop10</p><h3 id="è¯·æ±‚å‚æ•°-23">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>æˆåŠŸ</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-23">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td><a href="#schemaajaxresult">AjaxResult</a></td></tr></tbody></table><h2 id="GET-ratingå‰åæ™¯åŒºçš„å„æœˆè¯„è®ºæ•°">GET ratingå‰åæ™¯åŒºçš„å„æœˆè¯„è®ºæ•°</h2><p>GET /spot/ratingTop10CntInfo</p><h3 id="è¯·æ±‚å‚æ•°-24">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>æˆåŠŸ</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-24">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td><a href="#schemaajaxresult">AjaxResult</a></td></tr></tbody></table><h2 id="GET-ratingå‰åæ™¯åŒºçš„å„çœçš„äººæ•°">GET ratingå‰åæ™¯åŒºçš„å„çœçš„äººæ•°</h2><p>GET /spot/ratingTop10ProvinceInfo</p><h3 id="è¯·æ±‚å‚æ•°-25">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>æˆåŠŸ</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-25">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td><a href="#schemaajaxresult">AjaxResult</a></td></tr></tbody></table><h2 id="GET-å­£èŠ‚å‰åè¯„è®ºæ•°çš„æ™¯åŒº">GET å­£èŠ‚å‰åè¯„è®ºæ•°çš„æ™¯åŒº</h2><p>GET /spot/seasonSpot10SumInfo</p><h3 id="è¯·æ±‚å‚æ•°-26">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>æˆåŠŸ</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-26">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td><a href="#schemaajaxresult">AjaxResult</a></td></tr></tbody></table><h2 id="GET-æ™¯åŒºç­‰çº§æ•°é‡">GET æ™¯åŒºç­‰çº§æ•°é‡</h2><p>GET /spot/SpotLevelCnt</p><h3 id="è¯·æ±‚å‚æ•°-27">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>æˆåŠŸ</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-27">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td><a href="#schemaajaxresult">AjaxResult</a></td></tr></tbody></table><h1 id="æ—…ç‰›ç½‘-ç”¨æˆ·ç›¸å…³æ¥å£">æ—…ç‰›ç½‘/ç”¨æˆ·ç›¸å…³æ¥å£</h1><h2 id="POST-æ³¨å†Œç”¨æˆ·">POST æ³¨å†Œç”¨æˆ·</h2><p>POST /user/enroll</p><blockquote><p>Body è¯·æ±‚å‚æ•°</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;userid&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;username&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;password&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¯·æ±‚å‚æ•°-28">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td>none</td></tr><tr><td>body</td><td>body</td><td><a href="#schemauserinfo">UserInfo</a></td><td>å¦</td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>æˆåŠŸ</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-28">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td><a href="#schemaajaxresult">AjaxResult</a></td></tr></tbody></table><h2 id="GET-ç”ŸæˆéªŒè¯ç ">GET ç”ŸæˆéªŒè¯ç </h2><p>GET /user/code/image</p><h3 id="è¯·æ±‚å‚æ•°-29">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>200 Response</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-29">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td>Inline</td></tr></tbody></table><h3 id="è¿”å›æ•°æ®ç»“æ„-2">è¿”å›æ•°æ®ç»“æ„</h3><h2 id="POST-ç™»å½•">POST ç™»å½•</h2><p>POST /user/login</p><blockquote><p>Body è¯·æ±‚å‚æ•°</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;username&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;password&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;shearCaptcha&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;userid&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¯·æ±‚å‚æ•°-30">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td>none</td></tr><tr><td>body</td><td>body</td><td><a href="#schemauserlogindto">UserLoginDTO</a></td><td>å¦</td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>æˆåŠŸ</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-30">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td><a href="#schemaajaxresult">AjaxResult</a></td></tr></tbody></table><h2 id="POST-é‡ç½®å¯†ç ">POST é‡ç½®å¯†ç </h2><p>POST /user/fixp</p><blockquote><p>Body è¯·æ±‚å‚æ•°</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;username&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;password&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;shearCaptcha&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;userid&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¯·æ±‚å‚æ•°-31">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td>none</td></tr><tr><td>body</td><td>body</td><td><a href="#schemauserlogindto">UserLoginDTO</a></td><td>å¦</td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>æˆåŠŸ</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-31">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td><a href="#schemaajaxresult">AjaxResult</a></td></tr></tbody></table><h2 id="POST-é‡ç½®ç”¨æˆ·å">POST é‡ç½®ç”¨æˆ·å</h2><p>POST /user/fixu</p><h3 id="è¯·æ±‚å‚æ•°-32">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>userName</td><td>query</td><td>string</td><td>å¦</td><td>none</td></tr><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>æˆåŠŸ</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-32">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td><a href="#schemaajaxresult">AjaxResult</a></td></tr></tbody></table><h2 id="GET-ç”¨æˆ·æ”¶è—">GET ç”¨æˆ·æ”¶è—</h2><p>GET /user/userCollection</p><h3 id="è¯·æ±‚å‚æ•°-33">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>æˆåŠŸ</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-33">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td><a href="#schemaajaxresult">AjaxResult</a></td></tr></tbody></table><h2 id="GET-æ·»åŠ è¶³è¿¹">GET æ·»åŠ è¶³è¿¹</h2><p>GET /user/spotFootPrint/add</p><blockquote><p>Body è¯·æ±‚å‚æ•°</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;userId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;provinceName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;cityName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;spotName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¯·æ±‚å‚æ•°-34">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td>none</td></tr><tr><td>body</td><td>body</td><td><a href="#schemauserfootprint">UserFootPrint</a></td><td>å¦</td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>æˆåŠŸ</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-34">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td><a href="#schemaajaxresult">AjaxResult</a></td></tr></tbody></table><h2 id="POST-æ·»åŠ è¶³è¿¹">POST æ·»åŠ è¶³è¿¹</h2><p>POST /user/spotFootPrint/add</p><blockquote><p>Body è¯·æ±‚å‚æ•°</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;userId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;provinceName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;cityName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;spotName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¯·æ±‚å‚æ•°-35">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td>none</td></tr><tr><td>body</td><td>body</td><td><a href="#schemauserfootprint">UserFootPrint</a></td><td>å¦</td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>æˆåŠŸ</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-35">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td><a href="#schemaajaxresult">AjaxResult</a></td></tr></tbody></table><h2 id="GET-è¶³è¿¹åˆ—è¡¨">GET è¶³è¿¹åˆ—è¡¨</h2><p>GET /user/spotFootPrintList</p><h3 id="è¯·æ±‚å‚æ•°-36">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>æˆåŠŸ</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-36">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td><a href="#schemaajaxresult">AjaxResult</a></td></tr></tbody></table><h2 id="GET-è¶³è¿¹çœä»½">GET è¶³è¿¹çœä»½</h2><p>GET /user/spotFootPrintProvinceList</p><h3 id="è¯·æ±‚å‚æ•°-37">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>æˆåŠŸ</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-37">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td><a href="#schemaajaxresult">AjaxResult</a></td></tr></tbody></table><h2 id="GET-è¶³è¿¹åŸå¸‚">GET è¶³è¿¹åŸå¸‚</h2><p>GET /user/spotFootPrintCityList</p><h3 id="è¯·æ±‚å‚æ•°-38">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>province</td><td>query</td><td>string</td><td>å¦</td><td>none</td></tr><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>æˆåŠŸ</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-38">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td><a href="#schemaajaxresult">AjaxResult</a></td></tr></tbody></table><h2 id="GET-æ£€æŸ¥è¿™ä¸ªæ™¯ç‚¹æ˜¯å¦è¢«æ”¶è—è¿‡">GET æ£€æŸ¥è¿™ä¸ªæ™¯ç‚¹æ˜¯å¦è¢«æ”¶è—è¿‡</h2><p>GET /user/checkCollection/{spotId}</p><h3 id="è¯·æ±‚å‚æ•°-39">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>spotId</td><td>path</td><td>string</td><td>æ˜¯</td><td>none</td></tr><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>æˆåŠŸ</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-39">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td><a href="#schemaajaxresult">AjaxResult</a></td></tr></tbody></table><h2 id="GET-æ·»åŠ æ”¶è—æˆ–è€…å–æ¶ˆæ”¶è—æŸæ™¯ç‚¹">GET æ·»åŠ æ”¶è—æˆ–è€…å–æ¶ˆæ”¶è—æŸæ™¯ç‚¹</h2><p>GET /user/addOrDeleteUserCollection/{spotId}</p><p>flag 0æ˜¯å–æ¶ˆ1æ˜¯å°è¯•æ”¶è—</p><h3 id="è¯·æ±‚å‚æ•°-40">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>spotId</td><td>path</td><td>string</td><td>æ˜¯</td><td>none</td></tr><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>æˆåŠŸ</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-40">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td><a href="#schemaajaxresult">AjaxResult</a></td></tr></tbody></table><h1 id="æ—…ç‰›ç½‘-æ¨èä¸šåŠ¡">æ—…ç‰›ç½‘/æ¨èä¸šåŠ¡</h1><h2 id="POST-æ™¯åŒºæœç´¢æ æ¨èLEVEL-SPOT-NAME">POST æ™¯åŒºæœç´¢æ æ¨èLEVEL,SPOT_NAME</h2><p>POST /recommend/spotInfoSearch</p><h3 id="è¯·æ±‚å‚æ•°-41">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>level</td><td>query</td><td>string</td><td>å¦</td><td>none</td></tr><tr><td>spotName</td><td>query</td><td>string</td><td>å¦</td><td>none</td></tr><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>æˆåŠŸ</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-41">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td><a href="#schemaajaxresult">AjaxResult</a></td></tr></tbody></table><h2 id="POST-æ™ºèƒ½æ™¯åŒºæœç´¢æ æ¨è">POST æ™ºèƒ½æ™¯åŒºæœç´¢æ æ¨è</h2><p>POST /recommend/AISpotInfoSearch</p><blockquote><p>Body è¯·æ±‚å‚æ•°</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;provinceList&quot;</span><span class="punctuation">:</span> <span class="string">&quot;new ArrayList&lt;&gt;()&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;cityList&quot;</span><span class="punctuation">:</span> <span class="string">&quot;new ArrayList&lt;&gt;()&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;typeList&quot;</span><span class="punctuation">:</span> <span class="string">&quot;new ArrayList&lt;&gt;()&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;levelList&quot;</span><span class="punctuation">:</span> <span class="string">&quot;new ArrayList&lt;&gt;()&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¯·æ±‚å‚æ•°-42">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td>none</td></tr><tr><td>body</td><td>body</td><td><a href="#schemarecommendsearch">RecommendSearch</a></td><td>å¦</td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>æˆåŠŸ</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-42">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td><a href="#schemaajaxresult">AjaxResult</a></td></tr></tbody></table><h1 id="æ—…ç‰›ç½‘-pythonä¸­è½¬">æ—…ç‰›ç½‘/pythonä¸­è½¬</h1><h2 id="GET-æŸ¥è¯¢å„çœæ¥è®¿äººæ•°">GET æŸ¥è¯¢å„çœæ¥è®¿äººæ•°</h2><p>GET /api/keyword/spot/peopleCount/</p><h3 id="è¯·æ±‚å‚æ•°-43">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>æˆåŠŸ</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-43">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td><a href="#schemaobject">Object</a></td></tr></tbody></table><h2 id="GET-æ™¯åŒºè¯„è®ºåŒºå¥½è¯„ä¸€èˆ¬å·®è¯„æ•°">GET æ™¯åŒºè¯„è®ºåŒºå¥½è¯„ä¸€èˆ¬å·®è¯„æ•°</h2><p>GET /api/keyword/spot/commentTypes/{spot_id}</p><h3 id="è¯·æ±‚å‚æ•°-44">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>spot_id</td><td>path</td><td>string</td><td>æ˜¯</td><td>none</td></tr><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>æˆåŠŸ</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-44">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td><a href="#schemaobject">Object</a></td></tr></tbody></table><h2 id="GET-æŸ¥è¯¢å¯¹åº”æ™¯åŒºæ‰€æœ‰è¯„è®º">GET æŸ¥è¯¢å¯¹åº”æ™¯åŒºæ‰€æœ‰è¯„è®º</h2><p>GET /api/keyword/spot/commentAll/{spot_id}</p><h3 id="è¯·æ±‚å‚æ•°-45">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>spot_id</td><td>path</td><td>string</td><td>æ˜¯</td><td>none</td></tr><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>æˆåŠŸ</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-45">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td><a href="#schemaobject">Object</a></td></tr></tbody></table><h2 id="POST-æ™¯åŒºè·Ÿé«˜é¢‘è¯æœ‰å…³çš„è¯„è®º">POST æ™¯åŒºè·Ÿé«˜é¢‘è¯æœ‰å…³çš„è¯„è®º</h2><p>POST /api/keyword/spot/comments/{spot_id}</p><h3 id="è¯·æ±‚å‚æ•°-46">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>spot_id</td><td>path</td><td>string</td><td>æ˜¯</td><td>none</td></tr><tr><td>keyWord</td><td>query</td><td>string</td><td>å¦</td><td>none</td></tr><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>æˆåŠŸ</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-46">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td><a href="#schemaobject">Object</a></td></tr></tbody></table><h2 id="GET-æŸ¥è¯¢å¯¹åº”æ™¯åŒºçš„é«˜é¢‘è¯">GET æŸ¥è¯¢å¯¹åº”æ™¯åŒºçš„é«˜é¢‘è¯</h2><p>GET /api/keyword/spot/comment/{spot_id}</p><h3 id="è¯·æ±‚å‚æ•°-47">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>spot_id</td><td>path</td><td>string</td><td>æ˜¯</td><td>none</td></tr><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>æˆåŠŸ</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-47">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td><a href="#schemaobject">Object</a></td></tr></tbody></table><h1 id="pyæ¨è">pyæ¨è</h1><h2 id="GET-æŸ¥è¯¢å¯¹åº”æ™¯åŒºçš„é«˜é¢‘è¯-2">GET æŸ¥è¯¢å¯¹åº”æ™¯åŒºçš„é«˜é¢‘è¯</h2><p>GET /spot/comment/{spot_id}</p><h3 id="è¯·æ±‚å‚æ•°-48">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>spot_id</td><td>path</td><td>integer</td><td>æ˜¯</td><td>æ™¯åŒºid</td></tr><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>200 Response</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-48">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td>Inline</td></tr></tbody></table><h3 id="è¿”å›æ•°æ®ç»“æ„-3">è¿”å›æ•°æ®ç»“æ„</h3><h2 id="POST-æ™¯åŒºè·Ÿé«˜é¢‘è¯æœ‰å…³çš„è¯„è®º-2">POST æ™¯åŒºè·Ÿé«˜é¢‘è¯æœ‰å…³çš„è¯„è®º</h2><p>POST /spot/comments/{spot_id}</p><h3 id="è¯·æ±‚å‚æ•°-49">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>spot_id</td><td>path</td><td>string</td><td>æ˜¯</td><td>none</td></tr><tr><td>keyWord</td><td>query</td><td>string</td><td>å¦</td><td>none</td></tr><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>200 Response</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-49">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td>Inline</td></tr></tbody></table><h3 id="è¿”å›æ•°æ®ç»“æ„-4">è¿”å›æ•°æ®ç»“æ„</h3><h2 id="GET-æŸ¥è¯¢å¯¹åº”æ™¯åŒºæ‰€æœ‰è¯„è®º-2">GET æŸ¥è¯¢å¯¹åº”æ™¯åŒºæ‰€æœ‰è¯„è®º</h2><p>GET /spot/commentAll/{spot_id}</p><h3 id="è¯·æ±‚å‚æ•°-50">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>spot_id</td><td>path</td><td>integer</td><td>æ˜¯</td><td>none</td></tr><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>è®°å½•ä¸å­˜åœ¨</p></blockquote><h3 id="è¿”å›ç»“æœ-50">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>404</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.5.4">Not Found</a></td><td>è®°å½•ä¸å­˜åœ¨</td><td>Inline</td></tr></tbody></table><h3 id="è¿”å›æ•°æ®ç»“æ„-5">è¿”å›æ•°æ®ç»“æ„</h3><h2 id="GET-æ™¯åŒºè¯„è®ºåŒºå¥½è¯„ä¸€èˆ¬å·®è¯„æ•°-2">GET æ™¯åŒºè¯„è®ºåŒºå¥½è¯„ä¸€èˆ¬å·®è¯„æ•°</h2><p>GET /spot/commentTypes/{spot_id}/</p><h3 id="è¯·æ±‚å‚æ•°-51">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>spot_id</td><td>path</td><td>string</td><td>æ˜¯</td><td>none</td></tr><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>æˆåŠŸ</p></blockquote><h3 id="è¿”å›ç»“æœ-51">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td>Inline</td></tr></tbody></table><h3 id="è¿”å›æ•°æ®ç»“æ„-6">è¿”å›æ•°æ®ç»“æ„</h3><h2 id="GET-æŸ¥è¯¢å„çœæ¥è®¿äººæ•°-2">GET æŸ¥è¯¢å„çœæ¥è®¿äººæ•°</h2><p>GET /spot/peopleCount/</p><p>æŸ¥è¯¢æ¯ä¸ªçœçš„æ¥è®¿äººæ•°</p><h3 id="è¯·æ±‚å‚æ•°-52">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>æˆåŠŸ</p></blockquote><h3 id="è¿”å›ç»“æœ-52">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td>Inline</td></tr></tbody></table><h3 id="è¿”å›æ•°æ®ç»“æ„-7">è¿”å›æ•°æ®ç»“æ„</h3><h1 id="è‹ç©¹ç®¡ç†ç«¯-åˆ†ç±»ç›¸å…³æ¥å£">è‹ç©¹ç®¡ç†ç«¯/åˆ†ç±»ç›¸å…³æ¥å£</h1><h2 id="PUT-ä¿®æ”¹åˆ†ç±»">PUT ä¿®æ”¹åˆ†ç±»</h2><p>PUT /admin/category</p><blockquote><p>Body è¯·æ±‚å‚æ•°</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;sort&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¯·æ±‚å‚æ•°-53">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Content-Type</td><td>header</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr><tr><td>body</td><td>body</td><td>object</td><td>å¦</td><td>CategoryDTO</td><td>none</td></tr><tr><td>Â» id</td><td>body</td><td>integer(int64)</td><td>æ˜¯</td><td></td><td>åˆ†ç±»id</td></tr><tr><td>Â» name</td><td>body</td><td>string</td><td>æ˜¯</td><td></td><td>åˆ†ç±»åç§°</td></tr><tr><td>Â» sort</td><td>body</td><td>integer(int32)</td><td>æ˜¯</td><td></td><td>æ’åº</td></tr><tr><td>Â» type</td><td>body</td><td>integer(int32)</td><td>æ˜¯</td><td></td><td>åˆ†ç±»ç±»å‹</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>200 Response</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-53">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td>Inline</td></tr></tbody></table><h3 id="è¿”å›æ•°æ®ç»“æ„-8">è¿”å›æ•°æ®ç»“æ„</h3><p>çŠ¶æ€ç  <strong>200</strong></p><p><em>RÂ«stringÂ»</em></p><table><thead><tr><th>åç§°</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>çº¦æŸ</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Â» code</td><td>integer(int32)</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» data</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» msg</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr></tbody></table><h2 id="POST-æ–°å¢åˆ†ç±»">POST æ–°å¢åˆ†ç±»</h2><p>POST /admin/category</p><blockquote><p>Body è¯·æ±‚å‚æ•°</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;sort&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¯·æ±‚å‚æ•°-54">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Content-Type</td><td>header</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr><tr><td>body</td><td>body</td><td>object</td><td>å¦</td><td>CategoryDTO</td><td>none</td></tr><tr><td>Â» id</td><td>body</td><td>integer(int64)</td><td>å¦</td><td></td><td>none</td></tr><tr><td>Â» name</td><td>body</td><td>string</td><td>æ˜¯</td><td></td><td>åˆ†ç±»åç§°</td></tr><tr><td>Â» sort</td><td>body</td><td>integer(int32)</td><td>æ˜¯</td><td></td><td>æ’åºï¼ŒæŒ‰ç…§å‡åºæ’åº</td></tr><tr><td>Â» type</td><td>body</td><td>integer(int32)</td><td>æ˜¯</td><td></td><td>åˆ†ç±»ç±»å‹ï¼š1ä¸ºèœå“åˆ†ç±»ï¼Œ2ä¸ºå¥—é¤åˆ†ç±»</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>200 Response</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-54">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td>Inline</td></tr></tbody></table><h3 id="è¿”å›æ•°æ®ç»“æ„-9">è¿”å›æ•°æ®ç»“æ„</h3><p>çŠ¶æ€ç  <strong>200</strong></p><p><em>RÂ«stringÂ»</em></p><table><thead><tr><th>åç§°</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>çº¦æŸ</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Â» code</td><td>integer(int32)</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» data</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» msg</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr></tbody></table><h2 id="DELETE-æ ¹æ®idåˆ é™¤åˆ†ç±»">DELETE æ ¹æ®idåˆ é™¤åˆ†ç±»</h2><p>DELETE /admin/category</p><blockquote><p>Body è¯·æ±‚å‚æ•°</p></blockquote><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">string</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="è¯·æ±‚å‚æ•°-55">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>id</td><td>query</td><td>string</td><td>æ˜¯</td><td></td><td>åˆ†ç±»id</td></tr><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr><tr><td>body</td><td>body</td><td>string</td><td>å¦</td><td></td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>200 Response</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-55">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td>Inline</td></tr></tbody></table><h3 id="è¿”å›æ•°æ®ç»“æ„-10">è¿”å›æ•°æ®ç»“æ„</h3><p>çŠ¶æ€ç  <strong>200</strong></p><p><em>RÂ«stringÂ»</em></p><table><thead><tr><th>åç§°</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>çº¦æŸ</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Â» code</td><td>integer(int32)</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» data</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» msg</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr></tbody></table><h2 id="GET-åˆ†ç±»åˆ†é¡µæŸ¥è¯¢">GET åˆ†ç±»åˆ†é¡µæŸ¥è¯¢</h2><p>GET /admin/category/page</p><h3 id="è¯·æ±‚å‚æ•°-56">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>name</td><td>query</td><td>string</td><td>å¦</td><td></td><td>åˆ†ç±»åç§°</td></tr><tr><td>page</td><td>query</td><td>string</td><td>æ˜¯</td><td></td><td>é¡µç </td></tr><tr><td>pageSize</td><td>query</td><td>string</td><td>æ˜¯</td><td></td><td>æ¯é¡µè®°å½•æ•°</td></tr><tr><td>type</td><td>query</td><td>string</td><td>å¦</td><td></td><td>åˆ†ç±»ç±»å‹ï¼š1ä¸ºèœå“åˆ†ç±»ï¼Œ2ä¸ºå¥—é¤åˆ†ç±»</td></tr><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>200 Response</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;total&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;records&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;sort&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;status&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;createTime&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;updateTime&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;createUser&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;updateUser&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-56">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td>Inline</td></tr></tbody></table><h3 id="è¿”å›æ•°æ®ç»“æ„-11">è¿”å›æ•°æ®ç»“æ„</h3><p>çŠ¶æ€ç  <strong>200</strong></p><table><thead><tr><th>åç§°</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>çº¦æŸ</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Â» code</td><td>number</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» msg</td><td>null</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» data</td><td>object</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» total</td><td>number</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» records</td><td>[object]</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» id</td><td>number</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» type</td><td>number</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» name</td><td>string</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» sort</td><td>number</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» status</td><td>number</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» createTime</td><td>string</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» updateTime</td><td>string</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» createUser</td><td>number</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» updateUser</td><td>number</td><td>true</td><td>none</td><td></td><td>none</td></tr></tbody></table><h2 id="POST-å¯ç”¨ã€ç¦ç”¨åˆ†ç±»">POST å¯ç”¨ã€ç¦ç”¨åˆ†ç±»</h2><p>POST /admin/category/status/{status}</p><blockquote><p>Body è¯·æ±‚å‚æ•°</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¯·æ±‚å‚æ•°-57">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>status</td><td>path</td><td>string</td><td>æ˜¯</td><td></td><td>1ä¸ºå¯ç”¨ï¼Œ0ä¸ºç¦ç”¨</td></tr><tr><td>id</td><td>query</td><td>string</td><td>æ˜¯</td><td></td><td>åˆ†ç±»id</td></tr><tr><td>Content-Type</td><td>header</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr><tr><td>body</td><td>body</td><td>object</td><td>å¦</td><td></td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>200 Response</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-57">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td>Inline</td></tr></tbody></table><h3 id="è¿”å›æ•°æ®ç»“æ„-12">è¿”å›æ•°æ®ç»“æ„</h3><p>çŠ¶æ€ç  <strong>200</strong></p><p><em>RÂ«stringÂ»</em></p><table><thead><tr><th>åç§°</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>çº¦æŸ</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Â» code</td><td>integer(int32)</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» data</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» msg</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr></tbody></table><h2 id="GET-æ ¹æ®ç±»å‹æŸ¥è¯¢åˆ†ç±»">GET æ ¹æ®ç±»å‹æŸ¥è¯¢åˆ†ç±»</h2><p>GET /admin/category/list</p><h3 id="è¯·æ±‚å‚æ•°-58">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>type</td><td>query</td><td>string</td><td>å¦</td><td></td><td>åˆ†ç±»ç±»å‹ï¼š1ä¸ºèœå“åˆ†ç±»ï¼Œ2ä¸ºå¥—é¤åˆ†ç±»</td></tr><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>200 Response</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;createTime&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2019-08-24T14:15:22Z&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;createUser&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;sort&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;status&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;updateTime&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2019-08-24T14:15:22Z&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;updateUser&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-58">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td>Inline</td></tr></tbody></table><h3 id="è¿”å›æ•°æ®ç»“æ„-13">è¿”å›æ•°æ®ç»“æ„</h3><p>çŠ¶æ€ç  <strong>200</strong></p><p><em>RÂ«ListÂ«CategoryÂ»Â»</em></p><table><thead><tr><th>åç§°</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>çº¦æŸ</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Â» code</td><td>integer(int32)</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» data</td><td>[object]</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» Category</td><td>object</td><td>false</td><td>none</td><td>Category</td><td>none</td></tr><tr><td>Â»Â»Â» createTime</td><td>string(date-time)</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» createUser</td><td>integer(int64)</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» id</td><td>integer(int64)</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» name</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» sort</td><td>integer(int32)</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» status</td><td>integer(int32)</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» type</td><td>integer(int32)</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» updateTime</td><td>string(date-time)</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» updateUser</td><td>integer(int64)</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» msg</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr></tbody></table><h1 id="è‹ç©¹ç®¡ç†ç«¯-å‘˜å·¥ç›¸å…³æ¥å£">è‹ç©¹ç®¡ç†ç«¯/å‘˜å·¥ç›¸å…³æ¥å£</h1><h2 id="PUT-ä¿®æ”¹å¯†ç ">PUT ä¿®æ”¹å¯†ç </h2><p>PUT /admin/employee/editPassword</p><blockquote><p>Body è¯·æ±‚å‚æ•°</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;empId&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;newPassword&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;oldPassword&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¯·æ±‚å‚æ•°-59">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Content-Type</td><td>header</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr><tr><td>body</td><td>body</td><td>object</td><td>å¦</td><td>PasswordEditDTO</td><td>none</td></tr><tr><td>Â» empId</td><td>body</td><td>integer(int64)</td><td>æ˜¯</td><td></td><td>å‘˜å·¥id</td></tr><tr><td>Â» newPassword</td><td>body</td><td>string</td><td>æ˜¯</td><td></td><td>æ–°å¯†ç </td></tr><tr><td>Â» oldPassword</td><td>body</td><td>string</td><td>æ˜¯</td><td></td><td>æ—§å¯†ç </td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>200 Response</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-59">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td>Inline</td></tr></tbody></table><h3 id="è¿”å›æ•°æ®ç»“æ„-14">è¿”å›æ•°æ®ç»“æ„</h3><p>çŠ¶æ€ç  <strong>200</strong></p><p><em>RÂ«stringÂ»</em></p><table><thead><tr><th>åç§°</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>çº¦æŸ</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Â» code</td><td>integer(int32)</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» data</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» msg</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr></tbody></table><h2 id="POST-å¯ç”¨ã€ç¦ç”¨å‘˜å·¥è´¦å·">POST å¯ç”¨ã€ç¦ç”¨å‘˜å·¥è´¦å·</h2><p>POST /admin/employee/status/{status}</p><blockquote><p>Body è¯·æ±‚å‚æ•°</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¯·æ±‚å‚æ•°-60">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>status</td><td>path</td><td>string</td><td>æ˜¯</td><td></td><td>çŠ¶æ€ï¼Œ1ä¸ºå¯ç”¨ 0ä¸ºç¦ç”¨</td></tr><tr><td>id</td><td>query</td><td>string</td><td>æ˜¯</td><td></td><td>å‘˜å·¥id</td></tr><tr><td>Content-Type</td><td>header</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr><tr><td>body</td><td>body</td><td>object</td><td>å¦</td><td></td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>200 Response</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-60">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td>Inline</td></tr></tbody></table><h3 id="è¿”å›æ•°æ®ç»“æ„-15">è¿”å›æ•°æ®ç»“æ„</h3><p>çŠ¶æ€ç  <strong>200</strong></p><p><em>RÂ«stringÂ»</em></p><table><thead><tr><th>åç§°</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>çº¦æŸ</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Â» code</td><td>integer(int32)</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» data</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» msg</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr></tbody></table><h2 id="GET-å‘˜å·¥åˆ†é¡µæŸ¥è¯¢">GET å‘˜å·¥åˆ†é¡µæŸ¥è¯¢</h2><p>GET /admin/employee/page</p><h3 id="è¯·æ±‚å‚æ•°-61">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>name</td><td>query</td><td>string</td><td>å¦</td><td></td><td>å‘˜å·¥å§“å</td></tr><tr><td>page</td><td>query</td><td>string</td><td>æ˜¯</td><td></td><td>é¡µç </td></tr><tr><td>pageSize</td><td>query</td><td>string</td><td>æ˜¯</td><td></td><td>æ¯é¡µè®°å½•æ•°</td></tr><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>200 Response</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;total&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;records&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;username&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;password&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;phone&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;sex&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;idNumber&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;status&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;createTime&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;updateTime&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;createUser&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;updateUser&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-61">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td>Inline</td></tr></tbody></table><h3 id="è¿”å›æ•°æ®ç»“æ„-16">è¿”å›æ•°æ®ç»“æ„</h3><p>çŠ¶æ€ç  <strong>200</strong></p><table><thead><tr><th>åç§°</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>çº¦æŸ</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Â» code</td><td>number</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» msg</td><td>null</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» data</td><td>object</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» total</td><td>number</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» records</td><td>[object]</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» id</td><td>number</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» username</td><td>string</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» name</td><td>string</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» password</td><td>string</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» phone</td><td>string</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» sex</td><td>string</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» idNumber</td><td>string</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» status</td><td>number</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» createTime</td><td>stringÂ¦null</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» updateTime</td><td>string</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» createUser</td><td>numberÂ¦null</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» updateUser</td><td>number</td><td>true</td><td>none</td><td></td><td>none</td></tr></tbody></table><h2 id="POST-å‘˜å·¥ç™»å½•">POST å‘˜å·¥ç™»å½•</h2><p>POST /admin/employee/login</p><blockquote><p>Body è¯·æ±‚å‚æ•°</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;password&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;username&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¯·æ±‚å‚æ•°-62">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Content-Type</td><td>header</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr><tr><td>body</td><td>body</td><td>object</td><td>å¦</td><td>EmployeeLoginDTO</td><td>none</td></tr><tr><td>Â» password</td><td>body</td><td>string</td><td>æ˜¯</td><td></td><td>å¯†ç </td></tr><tr><td>Â» username</td><td>body</td><td>string</td><td>æ˜¯</td><td></td><td>ç”¨æˆ·å</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>200 Response</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;token&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;userName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-62">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td>Inline</td></tr></tbody></table><h3 id="è¿”å›æ•°æ®ç»“æ„-17">è¿”å›æ•°æ®ç»“æ„</h3><p>çŠ¶æ€ç  <strong>200</strong></p><p><em>RÂ«EmployeeLoginVOÂ»</em></p><table><thead><tr><th>åç§°</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>çº¦æŸ</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Â» code</td><td>integer(int32)</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» data</td><td>object</td><td>false</td><td>none</td><td>EmployeeLoginVO</td><td>å‘˜å·¥ç™»å½•è¿”å›çš„æ•°æ®æ ¼å¼</td></tr><tr><td>Â»Â» id</td><td>integer(int64)</td><td>false</td><td>none</td><td></td><td>ä¸»é”®å€¼</td></tr><tr><td>Â»Â» name</td><td>string</td><td>false</td><td>none</td><td></td><td>å§“å</td></tr><tr><td>Â»Â» token</td><td>string</td><td>false</td><td>none</td><td></td><td>jwtä»¤ç‰Œ</td></tr><tr><td>Â»Â» userName</td><td>string</td><td>false</td><td>none</td><td></td><td>ç”¨æˆ·å</td></tr><tr><td>Â» msg</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr></tbody></table><h2 id="POST-æ–°å¢å‘˜å·¥">POST æ–°å¢å‘˜å·¥</h2><p>POST /admin/employee</p><blockquote><p>Body è¯·æ±‚å‚æ•°</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;idNumber&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;phone&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;sex&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;username&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¯·æ±‚å‚æ•°-63">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Content-Type</td><td>header</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr><tr><td>body</td><td>body</td><td>object</td><td>å¦</td><td>EmployeeDTO</td><td>none</td></tr><tr><td>Â» id</td><td>body</td><td>integer(int64)</td><td>å¦</td><td></td><td>å‘˜å·¥id</td></tr><tr><td>Â» idNumber</td><td>body</td><td>string</td><td>æ˜¯</td><td></td><td>èº«ä»½è¯</td></tr><tr><td>Â» name</td><td>body</td><td>string</td><td>æ˜¯</td><td></td><td>å§“å</td></tr><tr><td>Â» phone</td><td>body</td><td>string</td><td>æ˜¯</td><td></td><td>æ‰‹æœºå·</td></tr><tr><td>Â» sex</td><td>body</td><td>string</td><td>æ˜¯</td><td></td><td>æ€§åˆ«</td></tr><tr><td>Â» username</td><td>body</td><td>string</td><td>æ˜¯</td><td></td><td>ç”¨æˆ·å</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>200 Response</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-63">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td>Inline</td></tr></tbody></table><h3 id="è¿”å›æ•°æ®ç»“æ„-18">è¿”å›æ•°æ®ç»“æ„</h3><p>çŠ¶æ€ç  <strong>200</strong></p><p><em>R</em></p><table><thead><tr><th>åç§°</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>çº¦æŸ</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Â» code</td><td>integer(int32)</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» data</td><td>object</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» msg</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr></tbody></table><h2 id="PUT-ç¼–è¾‘å‘˜å·¥ä¿¡æ¯">PUT ç¼–è¾‘å‘˜å·¥ä¿¡æ¯</h2><p>PUT /admin/employee</p><blockquote><p>Body è¯·æ±‚å‚æ•°</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;idNumber&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;phone&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;sex&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;username&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¯·æ±‚å‚æ•°-64">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Content-Type</td><td>header</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr><tr><td>body</td><td>body</td><td>object</td><td>å¦</td><td>EmployeeDTO</td><td>none</td></tr><tr><td>Â» id</td><td>body</td><td>integer(int64)</td><td>æ˜¯</td><td></td><td>none</td></tr><tr><td>Â» idNumber</td><td>body</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr><tr><td>Â» name</td><td>body</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr><tr><td>Â» phone</td><td>body</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr><tr><td>Â» sex</td><td>body</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr><tr><td>Â» username</td><td>body</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>200 Response</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-64">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td>Inline</td></tr></tbody></table><h3 id="è¿”å›æ•°æ®ç»“æ„-19">è¿”å›æ•°æ®ç»“æ„</h3><p>çŠ¶æ€ç  <strong>200</strong></p><p><em>RÂ«stringÂ»</em></p><table><thead><tr><th>åç§°</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>çº¦æŸ</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Â» code</td><td>integer(int32)</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» data</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» msg</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr></tbody></table><h2 id="GET-æ ¹æ®idæŸ¥è¯¢å‘˜å·¥">GET æ ¹æ®idæŸ¥è¯¢å‘˜å·¥</h2><p>GET /admin/employee/{id}</p><h3 id="è¯·æ±‚å‚æ•°-65">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>id</td><td>path</td><td>string</td><td>æ˜¯</td><td></td><td>å‘˜å·¥id</td></tr><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>200 Response</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;createTime&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2019-08-24T14:15:22Z&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;createUser&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;idNumber&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;password&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;phone&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;sex&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;status&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;updateTime&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2019-08-24T14:15:22Z&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;updateUser&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;username&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-65">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td>Inline</td></tr></tbody></table><h3 id="è¿”å›æ•°æ®ç»“æ„-20">è¿”å›æ•°æ®ç»“æ„</h3><p>çŠ¶æ€ç  <strong>200</strong></p><p><em>RÂ«EmployeeÂ»</em></p><table><thead><tr><th>åç§°</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>çº¦æŸ</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Â» code</td><td>integer(int32)</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» data</td><td>object</td><td>true</td><td>none</td><td>Employee</td><td>none</td></tr><tr><td>Â»Â» createTime</td><td>string(date-time)</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» createUser</td><td>integer(int64)</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» id</td><td>integer(int64)</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» idNumber</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» name</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» password</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» phone</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» sex</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» status</td><td>integer(int32)</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» updateTime</td><td>string(date-time)</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» updateUser</td><td>integer(int64)</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» username</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» msg</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr></tbody></table><h2 id="POST-é€€å‡ºç™»å½•">POST é€€å‡ºç™»å½•</h2><p>POST /admin/employee/logout</p><blockquote><p>Body è¯·æ±‚å‚æ•°</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¯·æ±‚å‚æ•°-66">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Content-Type</td><td>header</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr><tr><td>body</td><td>body</td><td>object</td><td>å¦</td><td>empty object</td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>200 Response</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-66">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td>Inline</td></tr></tbody></table><h3 id="è¿”å›æ•°æ®ç»“æ„-21">è¿”å›æ•°æ®ç»“æ„</h3><p>çŠ¶æ€ç  <strong>200</strong></p><p><em>RÂ«stringÂ»</em></p><table><thead><tr><th>åç§°</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>çº¦æŸ</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Â» code</td><td>integer(int32)</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» data</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» msg</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr></tbody></table><h1 id="è‹ç©¹ç®¡ç†ç«¯-å¥—é¤ç›¸å…³æ¥å£">è‹ç©¹ç®¡ç†ç«¯/å¥—é¤ç›¸å…³æ¥å£</h1><h2 id="PUT-ä¿®æ”¹å¥—é¤">PUT ä¿®æ”¹å¥—é¤</h2><p>PUT /admin/setmeal</p><blockquote><p>Body è¯·æ±‚å‚æ•°</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;categoryId&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;image&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;price&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;setmealDishes&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;copies&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;dishId&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;price&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;setmealId&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;status&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¯·æ±‚å‚æ•°-67">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Content-Type</td><td>header</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr><tr><td>body</td><td>body</td><td>object</td><td>å¦</td><td>SetmealDTO</td><td>none</td></tr><tr><td>Â» categoryId</td><td>body</td><td>integer(int64)</td><td>æ˜¯</td><td></td><td>åˆ†ç±»id</td></tr><tr><td>Â» description</td><td>body</td><td>string</td><td>å¦</td><td></td><td>å¥—é¤æè¿°</td></tr><tr><td>Â» id</td><td>body</td><td>integer(int64)</td><td>æ˜¯</td><td></td><td>å¥—é¤id</td></tr><tr><td>Â» image</td><td>body</td><td>string</td><td>æ˜¯</td><td></td><td>å¥—é¤å›¾ç‰‡è·¯å¾„</td></tr><tr><td>Â» name</td><td>body</td><td>string</td><td>æ˜¯</td><td></td><td>å¥—é¤åç§°</td></tr><tr><td>Â» price</td><td>body</td><td>number</td><td>æ˜¯</td><td></td><td>å¥—é¤ä»·æ ¼</td></tr><tr><td>Â» setmealDishes</td><td>body</td><td>[object]</td><td>æ˜¯</td><td></td><td>å¥—é¤å’Œèœå“å…³è”å…³ç³»</td></tr><tr><td>Â»Â» SetmealDish</td><td>body</td><td>object</td><td>å¦</td><td>SetmealDish</td><td>none</td></tr><tr><td>Â»Â»Â» copies</td><td>body</td><td>integer(int32)</td><td>æ˜¯</td><td></td><td>èœå“ä»½æ•°</td></tr><tr><td>Â»Â»Â» dishId</td><td>body</td><td>integer(int64)</td><td>æ˜¯</td><td></td><td>èœå“id</td></tr><tr><td>Â»Â»Â» id</td><td>body</td><td>integer(int64)</td><td>å¦</td><td></td><td>å…³ç³»è¡¨ä¸»é”®å€¼</td></tr><tr><td>Â»Â»Â» name</td><td>body</td><td>string</td><td>æ˜¯</td><td></td><td>èœå“åç§°</td></tr><tr><td>Â»Â»Â» price</td><td>body</td><td>number</td><td>æ˜¯</td><td></td><td>èœå“ä»·æ ¼</td></tr><tr><td>Â»Â»Â» setmealId</td><td>body</td><td>integer(int64)</td><td>å¦</td><td></td><td>å¥—é¤id</td></tr><tr><td>Â» status</td><td>body</td><td>integer(int32)</td><td>å¦</td><td></td><td>å¥—é¤èµ·å”®çŠ¶æ€</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>200 Response</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-67">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td>Inline</td></tr></tbody></table><h3 id="è¿”å›æ•°æ®ç»“æ„-22">è¿”å›æ•°æ®ç»“æ„</h3><p>çŠ¶æ€ç  <strong>200</strong></p><p><em>R</em></p><table><thead><tr><th>åç§°</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>çº¦æŸ</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Â» code</td><td>integer(int32)</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» data</td><td>object</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» msg</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr></tbody></table><h2 id="DELETE-æ‰¹é‡åˆ é™¤å¥—é¤">DELETE æ‰¹é‡åˆ é™¤å¥—é¤</h2><p>DELETE /admin/setmeal</p><blockquote><p>Body è¯·æ±‚å‚æ•°</p></blockquote><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">string</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="è¯·æ±‚å‚æ•°-68">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>ids</td><td>query</td><td>string</td><td>æ˜¯</td><td></td><td>ids</td></tr><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr><tr><td>body</td><td>body</td><td>string</td><td>å¦</td><td></td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>200 Response</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-68">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td>Inline</td></tr></tbody></table><h3 id="è¿”å›æ•°æ®ç»“æ„-23">è¿”å›æ•°æ®ç»“æ„</h3><p>çŠ¶æ€ç  <strong>200</strong></p><p><em>R</em></p><table><thead><tr><th>åç§°</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>çº¦æŸ</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Â» code</td><td>integer(int32)</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» data</td><td>object</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» msg</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr></tbody></table><h2 id="POST-æ–°å¢å¥—é¤">POST æ–°å¢å¥—é¤</h2><p>POST /admin/setmeal</p><blockquote><p>Body è¯·æ±‚å‚æ•°</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;categoryId&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;image&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;price&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;setmealDishes&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;copies&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;dishId&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;price&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;setmealId&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;status&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¯·æ±‚å‚æ•°-69">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Content-Type</td><td>header</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr><tr><td>body</td><td>body</td><td>object</td><td>å¦</td><td>SetmealDTO</td><td>none</td></tr><tr><td>Â» categoryId</td><td>body</td><td>integer(int64)</td><td>æ˜¯</td><td></td><td>åˆ†ç±»id</td></tr><tr><td>Â» description</td><td>body</td><td>string</td><td>å¦</td><td></td><td>å¥—é¤æè¿°</td></tr><tr><td>Â» id</td><td>body</td><td>integer(int64)</td><td>å¦</td><td></td><td>å¥—é¤id</td></tr><tr><td>Â» image</td><td>body</td><td>string</td><td>æ˜¯</td><td></td><td>å¥—é¤å›¾ç‰‡</td></tr><tr><td>Â» name</td><td>body</td><td>string</td><td>æ˜¯</td><td></td><td>å¥—é¤åç§°</td></tr><tr><td>Â» price</td><td>body</td><td>number</td><td>æ˜¯</td><td></td><td>å¥—é¤ä»·æ ¼</td></tr><tr><td>Â» setmealDishes</td><td>body</td><td>[object]</td><td>æ˜¯</td><td></td><td>å¥—é¤åŒ…å«çš„èœå“</td></tr><tr><td>Â»Â» SetmealDish</td><td>body</td><td>object</td><td>å¦</td><td>SetmealDish</td><td>none</td></tr><tr><td>Â»Â»Â» copies</td><td>body</td><td>integer(int32)</td><td>æ˜¯</td><td></td><td>ä»½æ•°</td></tr><tr><td>Â»Â»Â» dishId</td><td>body</td><td>integer(int64)</td><td>æ˜¯</td><td></td><td>èœå“id</td></tr><tr><td>Â»Â»Â» id</td><td>body</td><td>integer(int64)</td><td>å¦</td><td></td><td>å¥—é¤å’Œèœå“å…³ç³»id</td></tr><tr><td>Â»Â»Â» name</td><td>body</td><td>string</td><td>æ˜¯</td><td></td><td>èœå“åç§°</td></tr><tr><td>Â»Â»Â» price</td><td>body</td><td>number</td><td>æ˜¯</td><td></td><td>èœå“ä»·æ ¼</td></tr><tr><td>Â»Â»Â» setmealId</td><td>body</td><td>integer(int64)</td><td>æ˜¯</td><td></td><td>å¥—é¤id</td></tr><tr><td>Â» status</td><td>body</td><td>integer(int32)</td><td>æ˜¯</td><td></td><td>å¥—é¤çŠ¶æ€ï¼š1ä½èµ·å”® 0ä¸ºåœå”®</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>200 Response</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-69">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td>Inline</td></tr></tbody></table><h3 id="è¿”å›æ•°æ®ç»“æ„-24">è¿”å›æ•°æ®ç»“æ„</h3><p>çŠ¶æ€ç  <strong>200</strong></p><p><em>R</em></p><table><thead><tr><th>åç§°</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>çº¦æŸ</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Â» code</td><td>integer(int32)</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» data</td><td>object</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» msg</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr></tbody></table><h2 id="GET-åˆ†é¡µæŸ¥è¯¢">GET åˆ†é¡µæŸ¥è¯¢</h2><p>GET /admin/setmeal/page</p><h3 id="è¯·æ±‚å‚æ•°-70">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>categoryId</td><td>query</td><td>string</td><td>å¦</td><td></td><td>åˆ†ç±»id</td></tr><tr><td>name</td><td>query</td><td>string</td><td>å¦</td><td></td><td>å¥—é¤åç§°</td></tr><tr><td>page</td><td>query</td><td>string</td><td>æ˜¯</td><td></td><td>é¡µç </td></tr><tr><td>pageSize</td><td>query</td><td>string</td><td>æ˜¯</td><td></td><td>æ¯é¡µè®°å½•æ•°</td></tr><tr><td>status</td><td>query</td><td>string</td><td>å¦</td><td></td><td>å¥—é¤èµ·å”®çŠ¶æ€</td></tr><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>200 Response</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;total&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;records&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;categoryId&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;price&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;status&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;image&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;updateTime&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;categoryName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-70">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td>Inline</td></tr></tbody></table><h3 id="è¿”å›æ•°æ®ç»“æ„-25">è¿”å›æ•°æ®ç»“æ„</h3><p>çŠ¶æ€ç  <strong>200</strong></p><table><thead><tr><th>åç§°</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>çº¦æŸ</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Â» code</td><td>number</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» msg</td><td>null</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» data</td><td>object</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» total</td><td>number</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» records</td><td>[object]</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» id</td><td>number</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» categoryId</td><td>number</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» name</td><td>string</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» price</td><td>number</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» status</td><td>number</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» description</td><td>string</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» image</td><td>string</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» updateTime</td><td>string</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» categoryName</td><td>string</td><td>true</td><td>none</td><td></td><td>none</td></tr></tbody></table><h2 id="POST-å¥—é¤èµ·å”®ã€åœå”®">POST å¥—é¤èµ·å”®ã€åœå”®</h2><p>POST /admin/setmeal/status/{status}</p><blockquote><p>Body è¯·æ±‚å‚æ•°</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¯·æ±‚å‚æ•°-71">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>status</td><td>path</td><td>string</td><td>æ˜¯</td><td></td><td>å¥—é¤çŠ¶æ€ï¼Œ1è¡¨ç¤ºèµ·å”®ï¼Œ0è¡¨ç¤ºåœå”®</td></tr><tr><td>id</td><td>query</td><td>string</td><td>æ˜¯</td><td></td><td>å¥—é¤id</td></tr><tr><td>Content-Type</td><td>header</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr><tr><td>body</td><td>body</td><td>object</td><td>å¦</td><td></td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>200 Response</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-71">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td>Inline</td></tr></tbody></table><h3 id="è¿”å›æ•°æ®ç»“æ„-26">è¿”å›æ•°æ®ç»“æ„</h3><p>çŠ¶æ€ç  <strong>200</strong></p><p><em>R</em></p><table><thead><tr><th>åç§°</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>çº¦æŸ</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Â» code</td><td>integer(int32)</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» data</td><td>object</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» msg</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr></tbody></table><h2 id="GET-æ ¹æ®idæŸ¥è¯¢å¥—é¤">GET æ ¹æ®idæŸ¥è¯¢å¥—é¤</h2><p>GET /admin/setmeal/{id}</p><h3 id="è¯·æ±‚å‚æ•°-72">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>id</td><td>path</td><td>string</td><td>æ˜¯</td><td></td><td>å¥—é¤id</td></tr><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>200 Response</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;categoryId&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;categoryName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;image&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;price&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;setmealDishes&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;copies&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;dishId&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;price&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;setmealId&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;status&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;updateTime&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2019-08-24T14:15:22Z&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-72">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td>Inline</td></tr></tbody></table><h3 id="è¿”å›æ•°æ®ç»“æ„-27">è¿”å›æ•°æ®ç»“æ„</h3><p>çŠ¶æ€ç  <strong>200</strong></p><p><em>RÂ«SetmealVOÂ»</em></p><table><thead><tr><th>åç§°</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>çº¦æŸ</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Â» code</td><td>integer(int32)</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» data</td><td>object</td><td>true</td><td>none</td><td>SetmealVO</td><td>none</td></tr><tr><td>Â»Â» categoryId</td><td>integer(int64)</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» categoryName</td><td>string</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» description</td><td>string</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» id</td><td>integer(int64)</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» image</td><td>string</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» name</td><td>string</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» price</td><td>number</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» setmealDishes</td><td>[object]</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» SetmealDish</td><td>object</td><td>false</td><td>none</td><td>SetmealDish</td><td>none</td></tr><tr><td>Â»Â»Â»Â» copies</td><td>integer(int32)</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â»Â» dishId</td><td>integer(int64)</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â»Â» id</td><td>integer(int64)</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â»Â» name</td><td>string</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â»Â» price</td><td>number</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â»Â» setmealId</td><td>integer(int64)</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» status</td><td>integer(int32)</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» updateTime</td><td>string(date-time)</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» msg</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr></tbody></table><h1 id="è‹ç©¹ç®¡ç†ç«¯-å·¥ä½œå°æ¥å£">è‹ç©¹ç®¡ç†ç«¯/å·¥ä½œå°æ¥å£</h1><h2 id="GET-æŸ¥è¯¢ä»Šæ—¥è¿è¥æ•°æ®">GET æŸ¥è¯¢ä»Šæ—¥è¿è¥æ•°æ®</h2><p>GET /admin/workspace/businessData</p><h3 id="è¯·æ±‚å‚æ•°-73">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>200 Response</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;newUsers&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;orderCompletionRate&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;turnover&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;unitPrice&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;validOrderCount&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-73">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td>Inline</td></tr></tbody></table><h3 id="è¿”å›æ•°æ®ç»“æ„-28">è¿”å›æ•°æ®ç»“æ„</h3><p>çŠ¶æ€ç  <strong>200</strong></p><p><em>RÂ«BusinessDataVOÂ»</em></p><table><thead><tr><th>åç§°</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>çº¦æŸ</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Â» code</td><td>integer(int32)</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» data</td><td>object</td><td>true</td><td>none</td><td>BusinessDataVO</td><td>none</td></tr><tr><td>Â»Â» newUsers</td><td>integer(int32)</td><td>true</td><td>none</td><td></td><td>æ–°å¢ç”¨æˆ·æ•°</td></tr><tr><td>Â»Â» orderCompletionRate</td><td>number(double)</td><td>true</td><td>none</td><td></td><td>è®¢å•å®Œæˆç‡</td></tr><tr><td>Â»Â» turnover</td><td>number(double)</td><td>true</td><td>none</td><td></td><td>è¥ä¸šé¢</td></tr><tr><td>Â»Â» unitPrice</td><td>number(double)</td><td>true</td><td>none</td><td></td><td>å¹³å‡å®¢å•ä»·</td></tr><tr><td>Â»Â» validOrderCount</td><td>integer(int32)</td><td>true</td><td>none</td><td></td><td>æœ‰æ•ˆè®¢å•æ•°</td></tr><tr><td>Â» msg</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr></tbody></table><h2 id="GET-æŸ¥è¯¢å¥—é¤æ€»è§ˆ">GET æŸ¥è¯¢å¥—é¤æ€»è§ˆ</h2><p>GET /admin/workspace/overviewSetmeals</p><h3 id="è¯·æ±‚å‚æ•°-74">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>200 Response</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;discontinued&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;sold&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-74">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td>Inline</td></tr></tbody></table><h3 id="è¿”å›æ•°æ®ç»“æ„-29">è¿”å›æ•°æ®ç»“æ„</h3><p>çŠ¶æ€ç  <strong>200</strong></p><p><em>RÂ«SetmealOverViewVOÂ»</em></p><table><thead><tr><th>åç§°</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>çº¦æŸ</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Â» code</td><td>integer(int32)</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» data</td><td>object</td><td>true</td><td>none</td><td>SetmealOverViewVO</td><td>none</td></tr><tr><td>Â»Â» discontinued</td><td>integer(int32)</td><td>true</td><td>none</td><td></td><td>å·²åœå”®å¥—é¤æ•°é‡</td></tr><tr><td>Â»Â» sold</td><td>integer(int32)</td><td>true</td><td>none</td><td></td><td>å·²å¯å”®å¥—é¤æ•°é‡</td></tr><tr><td>Â» msg</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr></tbody></table><h2 id="GET-æŸ¥è¯¢èœå“æ€»è§ˆ">GET æŸ¥è¯¢èœå“æ€»è§ˆ</h2><p>GET /admin/workspace/overviewDishes</p><h3 id="è¯·æ±‚å‚æ•°-75">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>200 Response</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;discontinued&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;sold&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-75">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td>Inline</td></tr></tbody></table><h3 id="è¿”å›æ•°æ®ç»“æ„-30">è¿”å›æ•°æ®ç»“æ„</h3><p>çŠ¶æ€ç  <strong>200</strong></p><p><em>RÂ«DishOverViewVOÂ»</em></p><table><thead><tr><th>åç§°</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>çº¦æŸ</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Â» code</td><td>integer(int32)</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» data</td><td>object</td><td>true</td><td>none</td><td>DishOverViewVO</td><td>none</td></tr><tr><td>Â»Â» discontinued</td><td>integer(int32)</td><td>true</td><td>none</td><td></td><td>å·²åœå”®èœå“æ•°é‡</td></tr><tr><td>Â»Â» sold</td><td>integer(int32)</td><td>true</td><td>none</td><td></td><td>å·²å¯å”®èœå“æ•°é‡</td></tr><tr><td>Â» msg</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr></tbody></table><h2 id="GET-æŸ¥è¯¢è®¢å•ç®¡ç†æ•°æ®">GET æŸ¥è¯¢è®¢å•ç®¡ç†æ•°æ®</h2><p>GET /admin/workspace/overviewOrders</p><h3 id="è¯·æ±‚å‚æ•°-76">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>200 Response</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;allOrders&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;cancelledOrders&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;completedOrders&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;deliveredOrders&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;waitingOrders&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-76">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td>Inline</td></tr></tbody></table><h3 id="è¿”å›æ•°æ®ç»“æ„-31">è¿”å›æ•°æ®ç»“æ„</h3><p>çŠ¶æ€ç  <strong>200</strong></p><p><em>RÂ«OrderOverViewVOÂ»</em></p><table><thead><tr><th>åç§°</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>çº¦æŸ</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Â» code</td><td>integer(int32)</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» data</td><td>object</td><td>true</td><td>none</td><td>OrderOverViewVO</td><td>none</td></tr><tr><td>Â»Â» allOrders</td><td>integer(int32)</td><td>true</td><td>none</td><td></td><td>å…¨éƒ¨è®¢å•</td></tr><tr><td>Â»Â» cancelledOrders</td><td>integer(int32)</td><td>true</td><td>none</td><td></td><td>å·²å–æ¶ˆæ•°é‡</td></tr><tr><td>Â»Â» completedOrders</td><td>integer(int32)</td><td>true</td><td>none</td><td></td><td>å·²å®Œæˆæ•°é‡</td></tr><tr><td>Â»Â» deliveredOrders</td><td>integer(int32)</td><td>true</td><td>none</td><td></td><td>å¾…æ´¾é€æ•°é‡</td></tr><tr><td>Â»Â» waitingOrders</td><td>integer(int32)</td><td>true</td><td>none</td><td></td><td>å¾…æ¥å•æ•°é‡</td></tr><tr><td>Â» msg</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr></tbody></table><h1 id="è‹ç©¹ç®¡ç†ç«¯-åº—é“ºæ“ä½œæ¥å£">è‹ç©¹ç®¡ç†ç«¯/åº—é“ºæ“ä½œæ¥å£</h1><h2 id="GET-è·å–è¥ä¸šçŠ¶æ€">GET è·å–è¥ä¸šçŠ¶æ€</h2><p>GET /admin/shop/status</p><h3 id="è¯·æ±‚å‚æ•°-77">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>200 Response</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-77">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td>Inline</td></tr></tbody></table><h3 id="è¿”å›æ•°æ®ç»“æ„-32">è¿”å›æ•°æ®ç»“æ„</h3><p>çŠ¶æ€ç  <strong>200</strong></p><p><em>RÂ«intÂ»</em></p><table><thead><tr><th>åç§°</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>çº¦æŸ</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Â» code</td><td>integer(int32)</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» data</td><td>integer(int32)</td><td>true</td><td>none</td><td></td><td>åº—é“ºè¥ä¸šçŠ¶æ€ï¼š1ä¸ºè¥ä¸šï¼Œ0ä¸ºæ‰“çƒŠ</td></tr><tr><td>Â» msg</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr></tbody></table><h2 id="PUT-è®¾ç½®è¥ä¸šçŠ¶æ€">PUT è®¾ç½®è¥ä¸šçŠ¶æ€</h2><p>PUT /admin/shop/{status}</p><blockquote><p>Body è¯·æ±‚å‚æ•°</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¯·æ±‚å‚æ•°-78">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>status</td><td>path</td><td>string</td><td>æ˜¯</td><td></td><td>åº—é“ºè¥ä¸šçŠ¶æ€ï¼š1ä¸ºè¥ä¸šï¼Œ0ä¸ºæ‰“çƒŠ</td></tr><tr><td>Content-Type</td><td>header</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr><tr><td>body</td><td>body</td><td>object</td><td>å¦</td><td></td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>200 Response</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-78">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td>Inline</td></tr></tbody></table><h3 id="è¿”å›æ•°æ®ç»“æ„-33">è¿”å›æ•°æ®ç»“æ„</h3><p>çŠ¶æ€ç  <strong>200</strong></p><p><em>RÂ«stringÂ»</em></p><table><thead><tr><th>åç§°</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>çº¦æŸ</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Â» code</td><td>integer(int32)</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» data</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» msg</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr></tbody></table><h1 id="è‹ç©¹ç®¡ç†ç«¯-æ•°æ®ç»Ÿè®¡ç›¸å…³æ¥å£">è‹ç©¹ç®¡ç†ç«¯/æ•°æ®ç»Ÿè®¡ç›¸å…³æ¥å£</h1><h2 id="GET-å¯¼å‡ºExcelæŠ¥è¡¨æ¥å£">GET å¯¼å‡ºExcelæŠ¥è¡¨æ¥å£</h2><p>GET /admin/report/export</p><h3 id="è¯·æ±‚å‚æ•°-79">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>200 Response</p></blockquote><h3 id="è¿”å›ç»“æœ-79">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td>Inline</td></tr></tbody></table><h3 id="è¿”å›æ•°æ®ç»“æ„-34">è¿”å›æ•°æ®ç»“æ„</h3><h2 id="GET-æŸ¥è¯¢é”€é‡æ’åtop10æ¥å£">GET æŸ¥è¯¢é”€é‡æ’åtop10æ¥å£</h2><p>GET /admin/report/top10</p><h3 id="è¯·æ±‚å‚æ•°-80">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>begin</td><td>query</td><td>string</td><td>æ˜¯</td><td></td><td>å¼€å§‹æ—¥æœŸ</td></tr><tr><td>end</td><td>query</td><td>string</td><td>æ˜¯</td><td></td><td>ç»“æŸæ—¥æœŸ</td></tr><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>200 Response</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;nameList&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;numberList&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-80">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td>Inline</td></tr></tbody></table><h3 id="è¿”å›æ•°æ®ç»“æ„-35">è¿”å›æ•°æ®ç»“æ„</h3><p>çŠ¶æ€ç  <strong>200</strong></p><p><em>RÂ«SalesTop10ReportVOÂ»</em></p><table><thead><tr><th>åç§°</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>çº¦æŸ</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Â» code</td><td>integer(int32)</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» data</td><td>object</td><td>true</td><td>none</td><td>SalesTop10ReportVO</td><td>none</td></tr><tr><td>Â»Â» nameList</td><td>string</td><td>true</td><td>none</td><td></td><td>å•†å“åç§°åˆ—è¡¨ï¼Œä»¥é€—å·åˆ†éš”</td></tr><tr><td>Â»Â» numberList</td><td>string</td><td>true</td><td>none</td><td></td><td>é”€é‡åˆ—è¡¨ï¼Œä»¥é€—å·åˆ†éš”</td></tr><tr><td>Â» msg</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr></tbody></table><h2 id="GET-ç”¨æˆ·ç»Ÿè®¡æ¥å£">GET ç”¨æˆ·ç»Ÿè®¡æ¥å£</h2><p>GET /admin/report/userStatistics</p><h3 id="è¯·æ±‚å‚æ•°-81">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>begin</td><td>query</td><td>string</td><td>æ˜¯</td><td></td><td>å¼€å§‹æ—¥æœŸ</td></tr><tr><td>end</td><td>query</td><td>string</td><td>æ˜¯</td><td></td><td>ç»“æŸæ—¥æœŸ</td></tr><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>200 Response</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;dateList&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;newUserList&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;totalUserList&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-81">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td>Inline</td></tr></tbody></table><h3 id="è¿”å›æ•°æ®ç»“æ„-36">è¿”å›æ•°æ®ç»“æ„</h3><p>çŠ¶æ€ç  <strong>200</strong></p><p><em>RÂ«UserReportVOÂ»</em></p><table><thead><tr><th>åç§°</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>çº¦æŸ</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Â» code</td><td>integer(int32)</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» data</td><td>object</td><td>true</td><td>none</td><td>UserReportVO</td><td>none</td></tr><tr><td>Â»Â» dateList</td><td>string</td><td>true</td><td>none</td><td></td><td>æ—¥æœŸåˆ—è¡¨ï¼Œä»¥é€—å·åˆ†éš”</td></tr><tr><td>Â»Â» newUserList</td><td>string</td><td>true</td><td>none</td><td></td><td>æ–°å¢ç”¨æˆ·æ•°åˆ—è¡¨ï¼Œä»¥é€—å·åˆ†éš”</td></tr><tr><td>Â»Â» totalUserList</td><td>string</td><td>true</td><td>none</td><td></td><td>æ€»ç”¨æˆ·é‡åˆ—è¡¨ï¼Œä»¥é€—å·åˆ†éš”</td></tr><tr><td>Â» msg</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr></tbody></table><h2 id="GET-è¥ä¸šé¢ç»Ÿè®¡æ¥å£">GET è¥ä¸šé¢ç»Ÿè®¡æ¥å£</h2><p>GET /admin/report/turnoverStatistics</p><h3 id="è¯·æ±‚å‚æ•°-82">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>begin</td><td>query</td><td>string</td><td>æ˜¯</td><td></td><td>å¼€å§‹æ—¥æœŸ</td></tr><tr><td>end</td><td>query</td><td>string</td><td>æ˜¯</td><td></td><td>ç»“æŸæ—¥æœŸ</td></tr><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>200 Response</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;dateList&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;turnoverList&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-82">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td>Inline</td></tr></tbody></table><h3 id="è¿”å›æ•°æ®ç»“æ„-37">è¿”å›æ•°æ®ç»“æ„</h3><p>çŠ¶æ€ç  <strong>200</strong></p><p><em>RÂ«TurnoverReportVOÂ»</em></p><table><thead><tr><th>åç§°</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>çº¦æŸ</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Â» code</td><td>integer(int32)</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» data</td><td>object</td><td>true</td><td>none</td><td>TurnoverReportVO</td><td>none</td></tr><tr><td>Â»Â» dateList</td><td>string</td><td>true</td><td>none</td><td></td><td>æ—¥æœŸåˆ—è¡¨ï¼Œæ—¥æœŸä¹‹é—´ä»¥é€—å·åˆ†éš”</td></tr><tr><td>Â»Â» turnoverList</td><td>string</td><td>true</td><td>none</td><td></td><td>è¥ä¸šé¢åˆ—è¡¨ï¼Œè¥ä¸šé¢ä¹‹é—´ä»¥é€—å·åˆ†éš”</td></tr><tr><td>Â» msg</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr></tbody></table><h2 id="GET-è®¢å•ç»Ÿè®¡æ¥å£">GET è®¢å•ç»Ÿè®¡æ¥å£</h2><p>GET /admin/report/ordersStatistics</p><h3 id="è¯·æ±‚å‚æ•°-83">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>begin</td><td>query</td><td>string</td><td>æ˜¯</td><td></td><td>å¼€å§‹æ—¥æœŸ</td></tr><tr><td>end</td><td>query</td><td>string</td><td>æ˜¯</td><td></td><td>ç»“æŸæ—¥æœŸ</td></tr><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>200 Response</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;dateList&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;orderCompletionRate&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;orderCountList&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;totalOrderCount&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;validOrderCount&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;validOrderCountList&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-83">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td>Inline</td></tr></tbody></table><h3 id="è¿”å›æ•°æ®ç»“æ„-38">è¿”å›æ•°æ®ç»“æ„</h3><p>çŠ¶æ€ç  <strong>200</strong></p><p><em>RÂ«OrderReportVOÂ»</em></p><table><thead><tr><th>åç§°</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>çº¦æŸ</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Â» code</td><td>integer(int32)</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» data</td><td>object</td><td>true</td><td>none</td><td>OrderReportVO</td><td>none</td></tr><tr><td>Â»Â» dateList</td><td>string</td><td>true</td><td>none</td><td></td><td>æ—¥æœŸåˆ—è¡¨ï¼Œä»¥é€—å·åˆ†éš”</td></tr><tr><td>Â»Â» orderCompletionRate</td><td>number(double)</td><td>true</td><td>none</td><td></td><td>è®¢å•å®Œæˆç‡</td></tr><tr><td>Â»Â» orderCountList</td><td>string</td><td>true</td><td>none</td><td></td><td>è®¢å•æ•°åˆ—è¡¨ï¼Œä»¥é€—å·åˆ†éš”</td></tr><tr><td>Â»Â» totalOrderCount</td><td>integer(int32)</td><td>true</td><td>none</td><td></td><td>è®¢å•æ€»æ•°</td></tr><tr><td>Â»Â» validOrderCount</td><td>integer(int32)</td><td>true</td><td>none</td><td></td><td>æœ‰æ•ˆè®¢å•æ•°</td></tr><tr><td>Â»Â» validOrderCountList</td><td>string</td><td>true</td><td>none</td><td></td><td>æœ‰æ•ˆè®¢å•æ•°åˆ—è¡¨ï¼Œä»¥é€—å·åˆ†éš”</td></tr><tr><td>Â» msg</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr></tbody></table><h1 id="è‹ç©¹ç®¡ç†ç«¯-èœå“ç›¸å…³æ¥å£">è‹ç©¹ç®¡ç†ç«¯/èœå“ç›¸å…³æ¥å£</h1><h2 id="PUT-ä¿®æ”¹èœå“">PUT ä¿®æ”¹èœå“</h2><p>PUT /admin/dish</p><blockquote><p>Body è¯·æ±‚å‚æ•°</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;categoryId&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;flavors&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;dishId&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;image&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;price&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;status&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¯·æ±‚å‚æ•°-84">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Content-Type</td><td>header</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr><tr><td>body</td><td>body</td><td>object</td><td>å¦</td><td>DishDTO</td><td>none</td></tr><tr><td>Â» categoryId</td><td>body</td><td>integer(int64)</td><td>æ˜¯</td><td></td><td>none</td></tr><tr><td>Â» description</td><td>body</td><td>string</td><td>å¦</td><td></td><td>none</td></tr><tr><td>Â» flavors</td><td>body</td><td>[object]</td><td>å¦</td><td></td><td>none</td></tr><tr><td>Â»Â» DishFlavor</td><td>body</td><td>object</td><td>å¦</td><td>DishFlavor</td><td>none</td></tr><tr><td>Â»Â»Â» dishId</td><td>body</td><td>integer(int64)</td><td>å¦</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» id</td><td>body</td><td>integer(int64)</td><td>å¦</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» name</td><td>body</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» value</td><td>body</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr><tr><td>Â» id</td><td>body</td><td>integer(int64)</td><td>æ˜¯</td><td></td><td>none</td></tr><tr><td>Â» image</td><td>body</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr><tr><td>Â» name</td><td>body</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr><tr><td>Â» price</td><td>body</td><td>number</td><td>æ˜¯</td><td></td><td>none</td></tr><tr><td>Â» status</td><td>body</td><td>integer(int32)</td><td>å¦</td><td></td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>200 Response</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-84">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td>Inline</td></tr></tbody></table><h3 id="è¿”å›æ•°æ®ç»“æ„-39">è¿”å›æ•°æ®ç»“æ„</h3><p>çŠ¶æ€ç  <strong>200</strong></p><p><em>RÂ«stringÂ»</em></p><table><thead><tr><th>åç§°</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>çº¦æŸ</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Â» code</td><td>integer(int32)</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» data</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» msg</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr></tbody></table><h2 id="DELETE-æ‰¹é‡åˆ é™¤èœå“">DELETE æ‰¹é‡åˆ é™¤èœå“</h2><p>DELETE /admin/dish</p><blockquote><p>Body è¯·æ±‚å‚æ•°</p></blockquote><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">string</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="è¯·æ±‚å‚æ•°-85">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>ids</td><td>query</td><td>string</td><td>æ˜¯</td><td></td><td>èœå“idï¼Œä¹‹é—´ç”¨é€—å·åˆ†éš”</td></tr><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr><tr><td>body</td><td>body</td><td>string</td><td>å¦</td><td></td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>200 Response</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-85">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td>Inline</td></tr></tbody></table><h3 id="è¿”å›æ•°æ®ç»“æ„-40">è¿”å›æ•°æ®ç»“æ„</h3><p>çŠ¶æ€ç  <strong>200</strong></p><p><em>RÂ«stringÂ»</em></p><table><thead><tr><th>åç§°</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>çº¦æŸ</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Â» code</td><td>integer(int32)</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» data</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» msg</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr></tbody></table><h2 id="POST-æ–°å¢èœå“">POST æ–°å¢èœå“</h2><p>POST /admin/dish</p><blockquote><p>Body è¯·æ±‚å‚æ•°</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;categoryId&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;flavors&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;dishId&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;image&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;price&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;status&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¯·æ±‚å‚æ•°-86">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Content-Type</td><td>header</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr><tr><td>body</td><td>body</td><td>object</td><td>å¦</td><td>DishDTO</td><td>none</td></tr><tr><td>Â» categoryId</td><td>body</td><td>integer(int64)</td><td>æ˜¯</td><td></td><td>åˆ†ç±»id</td></tr><tr><td>Â» description</td><td>body</td><td>string</td><td>å¦</td><td></td><td>èœå“æè¿°</td></tr><tr><td>Â» flavors</td><td>body</td><td>[object]</td><td>å¦</td><td></td><td>å£å‘³</td></tr><tr><td>Â»Â» DishFlavor</td><td>body</td><td>object</td><td>å¦</td><td>DishFlavor</td><td>none</td></tr><tr><td>Â»Â»Â» dishId</td><td>body</td><td>integer(int64)</td><td>å¦</td><td></td><td>èœå“id</td></tr><tr><td>Â»Â»Â» id</td><td>body</td><td>integer(int64)</td><td>å¦</td><td></td><td>å£å‘³id</td></tr><tr><td>Â»Â»Â» name</td><td>body</td><td>string</td><td>æ˜¯</td><td></td><td>å£å‘³åç§°</td></tr><tr><td>Â»Â»Â» value</td><td>body</td><td>string</td><td>æ˜¯</td><td></td><td>å£å‘³å€¼</td></tr><tr><td>Â» id</td><td>body</td><td>integer(int64)</td><td>å¦</td><td></td><td>èœå“id</td></tr><tr><td>Â» image</td><td>body</td><td>string</td><td>æ˜¯</td><td></td><td>èœå“å›¾ç‰‡è·¯å¾„</td></tr><tr><td>Â» name</td><td>body</td><td>string</td><td>æ˜¯</td><td></td><td>èœå“åç§°</td></tr><tr><td>Â» price</td><td>body</td><td>number</td><td>æ˜¯</td><td></td><td>èœå“ä»·æ ¼</td></tr><tr><td>Â» status</td><td>body</td><td>integer(int32)</td><td>å¦</td><td></td><td>èœå“çŠ¶æ€ï¼š1ä¸ºèµ·å”®ï¼Œ0ä¸ºåœå”®</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>200 Response</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-86">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td>Inline</td></tr></tbody></table><h3 id="è¿”å›æ•°æ®ç»“æ„-41">è¿”å›æ•°æ®ç»“æ„</h3><p>çŠ¶æ€ç  <strong>200</strong></p><p><em>RÂ«stringÂ»</em></p><table><thead><tr><th>åç§°</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>çº¦æŸ</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Â» code</td><td>integer(int32)</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» data</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» msg</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr></tbody></table><h2 id="GET-æ ¹æ®idæŸ¥è¯¢èœå“">GET æ ¹æ®idæŸ¥è¯¢èœå“</h2><p>GET /admin/dish/{id}</p><h3 id="è¯·æ±‚å‚æ•°-87">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>id</td><td>path</td><td>string</td><td>æ˜¯</td><td></td><td>èœå“id</td></tr><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>200 Response</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;categoryId&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;categoryName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;flavors&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;dishId&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;image&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;price&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;status&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;updateTime&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2019-08-24T14:15:22Z&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-87">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td>Inline</td></tr></tbody></table><h3 id="è¿”å›æ•°æ®ç»“æ„-42">è¿”å›æ•°æ®ç»“æ„</h3><p>çŠ¶æ€ç  <strong>200</strong></p><p><em>RÂ«DishVOÂ»</em></p><table><thead><tr><th>åç§°</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>çº¦æŸ</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Â» code</td><td>integer(int32)</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» data</td><td>object</td><td>true</td><td>none</td><td>DishVO</td><td>none</td></tr><tr><td>Â»Â» categoryId</td><td>integer(int64)</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» categoryName</td><td>string</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» description</td><td>string</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» flavors</td><td>[object]</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» DishFlavor</td><td>object</td><td>false</td><td>none</td><td>DishFlavor</td><td>none</td></tr><tr><td>Â»Â»Â»Â» dishId</td><td>integer(int64)</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â»Â» id</td><td>integer(int64)</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â»Â» name</td><td>string</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â»Â» value</td><td>string</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» id</td><td>integer(int64)</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» image</td><td>string</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» name</td><td>string</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» price</td><td>number</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» status</td><td>integer(int32)</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» updateTime</td><td>string(date-time)</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» msg</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr></tbody></table><h2 id="GET-æ ¹æ®åˆ†ç±»idæŸ¥è¯¢èœå“">GET æ ¹æ®åˆ†ç±»idæŸ¥è¯¢èœå“</h2><p>GET /admin/dish/list</p><h3 id="è¯·æ±‚å‚æ•°-88">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>categoryId</td><td>query</td><td>string</td><td>æ˜¯</td><td></td><td>åˆ†ç±»id</td></tr><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>200 Response</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;categoryId&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;createTime&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2019-08-24T14:15:22Z&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;createUser&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;image&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;price&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;status&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;updateTime&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2019-08-24T14:15:22Z&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;updateUser&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-88">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td>Inline</td></tr></tbody></table><h3 id="è¿”å›æ•°æ®ç»“æ„-43">è¿”å›æ•°æ®ç»“æ„</h3><p>çŠ¶æ€ç  <strong>200</strong></p><p><em>RÂ«ListÂ«DishÂ»Â»</em></p><table><thead><tr><th>åç§°</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>çº¦æŸ</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Â» code</td><td>integer(int32)</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» data</td><td>[object]</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» Dish</td><td>object</td><td>false</td><td>none</td><td>Dish</td><td>none</td></tr><tr><td>Â»Â»Â» categoryId</td><td>integer(int64)</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» createTime</td><td>string(date-time)</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» createUser</td><td>integer(int64)</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» description</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» id</td><td>integer(int64)</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» image</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» name</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» price</td><td>number</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» status</td><td>integer(int32)</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» updateTime</td><td>string(date-time)</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» updateUser</td><td>integer(int64)</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» msg</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr></tbody></table><h2 id="GET-èœå“åˆ†é¡µæŸ¥è¯¢">GET èœå“åˆ†é¡µæŸ¥è¯¢</h2><p>GET /admin/dish/page</p><h3 id="è¯·æ±‚å‚æ•°-89">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>categoryId</td><td>query</td><td>string</td><td>å¦</td><td></td><td>åˆ†ç±»id</td></tr><tr><td>name</td><td>query</td><td>string</td><td>å¦</td><td></td><td>èœå“åç§°</td></tr><tr><td>page</td><td>query</td><td>string</td><td>æ˜¯</td><td></td><td>é¡µç </td></tr><tr><td>pageSize</td><td>query</td><td>string</td><td>æ˜¯</td><td></td><td>æ¯é¡µè®°å½•æ•°</td></tr><tr><td>status</td><td>query</td><td>string</td><td>å¦</td><td></td><td>åˆ†ç±»çŠ¶æ€</td></tr><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>200 Response</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;total&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;records&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;categoryId&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;price&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;image&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;status&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;updateTime&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;categoryName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-89">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td>Inline</td></tr></tbody></table><h3 id="è¿”å›æ•°æ®ç»“æ„-44">è¿”å›æ•°æ®ç»“æ„</h3><p>çŠ¶æ€ç  <strong>200</strong></p><table><thead><tr><th>åç§°</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>çº¦æŸ</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Â» code</td><td>number</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» msg</td><td>null</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» data</td><td>object</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» total</td><td>number</td><td>true</td><td>none</td><td></td><td>æ€»è®°å½•æ•°</td></tr><tr><td>Â»Â» records</td><td>[object]</td><td>true</td><td>none</td><td></td><td>å½“å‰é¡µæ•°æ®</td></tr><tr><td>Â»Â»Â» id</td><td>number</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» name</td><td>string</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» categoryId</td><td>number</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» price</td><td>number</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» image</td><td>string</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» description</td><td>string</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» status</td><td>number</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» updateTime</td><td>string</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» categoryName</td><td>string</td><td>true</td><td>none</td><td></td><td>åˆ†ç±»åç§°</td></tr></tbody></table><h2 id="POST-èœå“èµ·å”®ã€åœå”®">POST èœå“èµ·å”®ã€åœå”®</h2><p>POST /admin/dish/status/{status}</p><blockquote><p>Body è¯·æ±‚å‚æ•°</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¯·æ±‚å‚æ•°-90">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>status</td><td>path</td><td>string</td><td>æ˜¯</td><td></td><td>èœå“çŠ¶æ€ï¼š1ä¸ºèµ·å”®ï¼Œ0ä¸ºåœå”®</td></tr><tr><td>id</td><td>query</td><td>string</td><td>æ˜¯</td><td></td><td>èœå“id</td></tr><tr><td>Content-Type</td><td>header</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr><tr><td>body</td><td>body</td><td>object</td><td>å¦</td><td></td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>200 Response</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-90">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td>Inline</td></tr></tbody></table><h3 id="è¿”å›æ•°æ®ç»“æ„-45">è¿”å›æ•°æ®ç»“æ„</h3><p>çŠ¶æ€ç  <strong>200</strong></p><p><em>RÂ«stringÂ»</em></p><table><thead><tr><th>åç§°</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>çº¦æŸ</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Â» code</td><td>integer(int32)</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» data</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» msg</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr></tbody></table><h1 id="è‹ç©¹ç®¡ç†ç«¯-è®¢å•ç®¡ç†æ¥å£">è‹ç©¹ç®¡ç†ç«¯/è®¢å•ç®¡ç†æ¥å£</h1><h2 id="PUT-å–æ¶ˆè®¢å•">PUT å–æ¶ˆè®¢å•</h2><p>PUT /admin/order/cancel</p><blockquote><p>Body è¯·æ±‚å‚æ•°</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;cancelReason&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¯·æ±‚å‚æ•°-91">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Content-Type</td><td>header</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr><tr><td>body</td><td>body</td><td>object</td><td>å¦</td><td>OrdersCancelDTO</td><td>none</td></tr><tr><td>Â» cancelReason</td><td>body</td><td>string</td><td>æ˜¯</td><td></td><td>è®¢å•å–æ¶ˆåŸå› </td></tr><tr><td>Â» id</td><td>body</td><td>integer(int64)</td><td>æ˜¯</td><td></td><td>è®¢å•id</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>200 Response</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-91">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td>Inline</td></tr></tbody></table><h3 id="è¿”å›æ•°æ®ç»“æ„-46">è¿”å›æ•°æ®ç»“æ„</h3><p>çŠ¶æ€ç  <strong>200</strong></p><p><em>R</em></p><table><thead><tr><th>åç§°</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>çº¦æŸ</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Â» code</td><td>integer(int32)</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» data</td><td>object</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» msg</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr></tbody></table><h2 id="GET-å„ä¸ªçŠ¶æ€çš„è®¢å•æ•°é‡ç»Ÿè®¡">GET å„ä¸ªçŠ¶æ€çš„è®¢å•æ•°é‡ç»Ÿè®¡</h2><p>GET /admin/order/statistics</p><h3 id="è¯·æ±‚å‚æ•°-92">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>200 Response</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;confirmed&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;deliveryInProgress&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;toBeConfirmed&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-92">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td>Inline</td></tr></tbody></table><h3 id="è¿”å›æ•°æ®ç»“æ„-47">è¿”å›æ•°æ®ç»“æ„</h3><p>çŠ¶æ€ç  <strong>200</strong></p><p><em>RÂ«OrderStatisticsVOÂ»</em></p><table><thead><tr><th>åç§°</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>çº¦æŸ</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Â» code</td><td>integer(int32)</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» data</td><td>object</td><td>true</td><td>none</td><td>OrderStatisticsVO</td><td>none</td></tr><tr><td>Â»Â» confirmed</td><td>integer(int32)</td><td>true</td><td>none</td><td></td><td>å¾…æ´¾é€æ•°é‡</td></tr><tr><td>Â»Â» deliveryInProgress</td><td>integer(int32)</td><td>true</td><td>none</td><td></td><td>æ´¾é€ä¸­æ•°é‡</td></tr><tr><td>Â»Â» toBeConfirmed</td><td>integer(int32)</td><td>true</td><td>none</td><td></td><td>å¾…æ¥å•æ•°é‡</td></tr><tr><td>Â» msg</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr></tbody></table><h2 id="PUT-å®Œæˆè®¢å•">PUT å®Œæˆè®¢å•</h2><p>PUT /admin/order/complete/{id}</p><blockquote><p>Body è¯·æ±‚å‚æ•°</p></blockquote><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">string</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="è¯·æ±‚å‚æ•°-93">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>id</td><td>path</td><td>string</td><td>æ˜¯</td><td></td><td>è®¢å•id</td></tr><tr><td>Content-Type</td><td>header</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr><tr><td>body</td><td>body</td><td>string</td><td>å¦</td><td></td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>200 Response</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-93">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td>Inline</td></tr></tbody></table><h3 id="è¿”å›æ•°æ®ç»“æ„-48">è¿”å›æ•°æ®ç»“æ„</h3><p>çŠ¶æ€ç  <strong>200</strong></p><p><em>R</em></p><table><thead><tr><th>åç§°</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>çº¦æŸ</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Â» code</td><td>integer(int32)</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» data</td><td>object</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» msg</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr></tbody></table><h2 id="PUT-æ‹’å•">PUT æ‹’å•</h2><p>PUT /admin/order/rejection</p><blockquote><p>Body è¯·æ±‚å‚æ•°</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;rejectionReason&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¯·æ±‚å‚æ•°-94">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Content-Type</td><td>header</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr><tr><td>body</td><td>body</td><td>object</td><td>å¦</td><td>OrdersRejectionDTO</td><td>none</td></tr><tr><td>Â» id</td><td>body</td><td>integer(int64)</td><td>æ˜¯</td><td></td><td>è®¢å•id</td></tr><tr><td>Â» rejectionReason</td><td>body</td><td>string</td><td>æ˜¯</td><td></td><td>æ‹’å•åŸå› </td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>200 Response</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-94">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td>Inline</td></tr></tbody></table><h3 id="è¿”å›æ•°æ®ç»“æ„-49">è¿”å›æ•°æ®ç»“æ„</h3><p>çŠ¶æ€ç  <strong>200</strong></p><p><em>R</em></p><table><thead><tr><th>åç§°</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>çº¦æŸ</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Â» code</td><td>integer(int32)</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» data</td><td>object</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» msg</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr></tbody></table><h2 id="PUT-æ¥å•">PUT æ¥å•</h2><p>PUT /admin/order/confirm</p><blockquote><p>Body è¯·æ±‚å‚æ•°</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¯·æ±‚å‚æ•°-95">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Content-Type</td><td>header</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr><tr><td>body</td><td>body</td><td>object</td><td>å¦</td><td>OrdersConfirmDTO</td><td>none</td></tr><tr><td>Â» id</td><td>body</td><td>integer(int64)</td><td>æ˜¯</td><td></td><td>è®¢å•id</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>200 Response</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-95">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td>Inline</td></tr></tbody></table><h3 id="è¿”å›æ•°æ®ç»“æ„-50">è¿”å›æ•°æ®ç»“æ„</h3><p>çŠ¶æ€ç  <strong>200</strong></p><p><em>R</em></p><table><thead><tr><th>åç§°</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>çº¦æŸ</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Â» code</td><td>integer(int32)</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» data</td><td>object</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» msg</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr></tbody></table><h2 id="GET-æŸ¥è¯¢è®¢å•è¯¦æƒ…">GET æŸ¥è¯¢è®¢å•è¯¦æƒ…</h2><p>GET /admin/order/details/{id}</p><h3 id="è¯·æ±‚å‚æ•°-96">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>id</td><td>path</td><td>string</td><td>æ˜¯</td><td></td><td>è®¢å•id</td></tr><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>200 Response</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;address&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;addressBookId&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;amount&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;cancelReason&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;cancelTime&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2019-08-24T14:15:22Z&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;checkoutTime&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2019-08-24T14:15:22Z&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;consignee&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;deliveryStatus&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;deliveryTime&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2019-08-24T14:15:22Z&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;estimatedDeliveryTime&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2019-08-24T14:15:22Z&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;number&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;orderDetailList&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;amount&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;dishFlavor&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;dishId&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;image&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;number&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;orderId&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;setmealId&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;orderDishes&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;orderTime&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2019-08-24T14:15:22Z&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;packAmount&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;payMethod&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;payStatus&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;phone&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;rejectionReason&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;remark&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;status&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;tablewareNumber&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;tablewareStatus&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;userId&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;userName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-96">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td>Inline</td></tr></tbody></table><h3 id="è¿”å›æ•°æ®ç»“æ„-51">è¿”å›æ•°æ®ç»“æ„</h3><p>çŠ¶æ€ç  <strong>200</strong></p><p><em>RÂ«OrderVOÂ»</em></p><table><thead><tr><th>åç§°</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>çº¦æŸ</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Â» code</td><td>integer(int32)</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» data</td><td>object</td><td>false</td><td>none</td><td>OrderVO</td><td>none</td></tr><tr><td>Â»Â» address</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» addressBookId</td><td>integer(int64)</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» amount</td><td>number</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» cancelReason</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» cancelTime</td><td>string(date-time)</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» checkoutTime</td><td>string(date-time)</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» consignee</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» deliveryStatus</td><td>integer(int32)</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» deliveryTime</td><td>string(date-time)</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» estimatedDeliveryTime</td><td>string(date-time)</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» id</td><td>integer(int64)</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» number</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» orderDetailList</td><td>[object]</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» OrderDetail</td><td>object</td><td>false</td><td>none</td><td>OrderDetail</td><td>none</td></tr><tr><td>Â»Â»Â»Â» amount</td><td>number</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â»Â» dishFlavor</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â»Â» dishId</td><td>integer(int64)</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â»Â» id</td><td>integer(int64)</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â»Â» image</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â»Â» name</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â»Â» number</td><td>integer(int32)</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â»Â» orderId</td><td>integer(int64)</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â»Â» setmealId</td><td>integer(int64)</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» orderDishes</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» orderTime</td><td>string(date-time)</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» packAmount</td><td>integer(int32)</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» payMethod</td><td>integer(int32)</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» payStatus</td><td>integer(int32)</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» phone</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» rejectionReason</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» remark</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» status</td><td>integer(int32)</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» tablewareNumber</td><td>integer(int32)</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» tablewareStatus</td><td>integer(int32)</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» userId</td><td>integer(int64)</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» userName</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» msg</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr></tbody></table><h2 id="PUT-æ´¾é€è®¢å•">PUT æ´¾é€è®¢å•</h2><p>PUT /admin/order/delivery/{id}</p><blockquote><p>Body è¯·æ±‚å‚æ•°</p></blockquote><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">string</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="è¯·æ±‚å‚æ•°-97">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>id</td><td>path</td><td>string</td><td>æ˜¯</td><td></td><td>è®¢å•id</td></tr><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr><tr><td>body</td><td>body</td><td>string</td><td>å¦</td><td></td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>200 Response</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-97">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td>Inline</td></tr></tbody></table><h3 id="è¿”å›æ•°æ®ç»“æ„-52">è¿”å›æ•°æ®ç»“æ„</h3><p>çŠ¶æ€ç  <strong>200</strong></p><p><em>R</em></p><table><thead><tr><th>åç§°</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>çº¦æŸ</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Â» code</td><td>integer(int32)</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» data</td><td>object</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» msg</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr></tbody></table><h2 id="GET-è®¢å•æœç´¢">GET è®¢å•æœç´¢</h2><p>GET /admin/order/conditionSearch</p><h3 id="è¯·æ±‚å‚æ•°-98">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>beginTime</td><td>query</td><td>string</td><td>å¦</td><td></td><td>beginTime</td></tr><tr><td>endTime</td><td>query</td><td>string</td><td>å¦</td><td></td><td>endTime</td></tr><tr><td>number</td><td>query</td><td>string</td><td>å¦</td><td></td><td>number</td></tr><tr><td>page</td><td>query</td><td>string</td><td>æ˜¯</td><td></td><td>page</td></tr><tr><td>pageSize</td><td>query</td><td>string</td><td>æ˜¯</td><td></td><td>pageSize</td></tr><tr><td>phone</td><td>query</td><td>string</td><td>å¦</td><td></td><td>phone</td></tr><tr><td>status</td><td>query</td><td>string</td><td>å¦</td><td></td><td>status</td></tr><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>200 Response</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;total&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;records&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;number&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;status&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;userId&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;addressBookId&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;orderTime&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;checkoutTime&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;payMethod&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;payStatus&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;amount&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;remark&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;userName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;phone&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;address&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;consignee&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;cancelReason&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;rejectionReason&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;cancelTime&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;estimatedDeliveryTime&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;deliveryStatus&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;deliveryTime&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;packAmount&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;tablewareNumber&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;tablewareStatus&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;orderDishes&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-98">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td>Inline</td></tr></tbody></table><h3 id="è¿”å›æ•°æ®ç»“æ„-53">è¿”å›æ•°æ®ç»“æ„</h3><p>çŠ¶æ€ç  <strong>200</strong></p><table><thead><tr><th>åç§°</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>çº¦æŸ</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Â» code</td><td>number</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» msg</td><td>null</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» data</td><td>object</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» total</td><td>number</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» records</td><td>[object]</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» id</td><td>number</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» number</td><td>string</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» status</td><td>number</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» userId</td><td>number</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» addressBookId</td><td>number</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» orderTime</td><td>string</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» checkoutTime</td><td>nullÂ¦null</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» payMethod</td><td>number</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» payStatus</td><td>number</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» amount</td><td>number</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» remark</td><td>string</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» userName</td><td>string</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» phone</td><td>string</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» address</td><td>string</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» consignee</td><td>string</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» cancelReason</td><td>string</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» rejectionReason</td><td>string</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» cancelTime</td><td>string</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» estimatedDeliveryTime</td><td>string</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» deliveryStatus</td><td>number</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» deliveryTime</td><td>string</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» packAmount</td><td>number</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» tablewareNumber</td><td>number</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» tablewareStatus</td><td>number</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» orderDishes</td><td>string</td><td>true</td><td>none</td><td></td><td>è®¢å•åŒ…å«çš„èœå“ï¼Œä»¥å­—ç¬¦ä¸²å½¢å¼å±•ç¤º</td></tr></tbody></table><h1 id="è‹ç©¹ç®¡ç†ç«¯-é€šç”¨æ¥å£">è‹ç©¹ç®¡ç†ç«¯/é€šç”¨æ¥å£</h1><h2 id="POST-æ–‡ä»¶ä¸Šä¼ ">POST æ–‡ä»¶ä¸Šä¼ </h2><p>POST /admin/common/upload</p><blockquote><p>Body è¯·æ±‚å‚æ•°</p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">file:</span> <span class="string">string</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="è¯·æ±‚å‚æ•°-99">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Content-Type</td><td>header</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr><tr><td>body</td><td>body</td><td>object</td><td>å¦</td><td></td><td>none</td></tr><tr><td>Â» file</td><td>body</td><td>string(binary)</td><td>æ˜¯</td><td></td><td>æ–‡ä»¶</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>200 Response</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-99">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td>Inline</td></tr></tbody></table><h3 id="è¿”å›æ•°æ®ç»“æ„-54">è¿”å›æ•°æ®ç»“æ„</h3><p>çŠ¶æ€ç  <strong>200</strong></p><p><em>RÂ«stringÂ»</em></p><table><thead><tr><th>åç§°</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>çº¦æŸ</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Â» code</td><td>integer(int32)</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» data</td><td>string</td><td>true</td><td>none</td><td></td><td>æ–‡ä»¶ä¸Šä¼ è·¯å¾„</td></tr><tr><td>Â» msg</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr></tbody></table><h1 id="è‹ç©¹ç”¨æˆ·ç«¯-Cç«¯-åˆ†ç±»æ¥å£">è‹ç©¹ç”¨æˆ·ç«¯/Cç«¯-åˆ†ç±»æ¥å£</h1><h2 id="GET-æ¡ä»¶æŸ¥è¯¢">GET æ¡ä»¶æŸ¥è¯¢</h2><p>GET /user/category/list</p><h3 id="è¯·æ±‚å‚æ•°-100">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>type</td><td>query</td><td>string</td><td>å¦</td><td></td><td>åˆ†ç±»ç±»å‹ï¼š1 èœå“åˆ†ç±» 2 å¥—é¤åˆ†ç±»</td></tr><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>200 Response</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;createTime&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2019-08-24T14:15:22Z&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;createUser&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;sort&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;status&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;updateTime&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2019-08-24T14:15:22Z&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;updateUser&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-100">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td>Inline</td></tr></tbody></table><h3 id="è¿”å›æ•°æ®ç»“æ„-55">è¿”å›æ•°æ®ç»“æ„</h3><p>çŠ¶æ€ç  <strong>200</strong></p><p><em>RÂ«ListÂ«CategoryÂ»Â»</em></p><table><thead><tr><th>åç§°</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>çº¦æŸ</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Â» code</td><td>integer(int32)</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» data</td><td>[object]</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» Category</td><td>object</td><td>false</td><td>none</td><td>Category</td><td>none</td></tr><tr><td>Â»Â»Â» createTime</td><td>string(date-time)</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» createUser</td><td>integer(int64)</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» id</td><td>integer(int64)</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» name</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» sort</td><td>integer(int32)</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» status</td><td>integer(int32)</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» type</td><td>integer(int32)</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» updateTime</td><td>string(date-time)</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» updateUser</td><td>integer(int64)</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» msg</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr></tbody></table><h1 id="è‹ç©¹ç”¨æˆ·ç«¯-Cç«¯-åœ°å€ç°¿æ¥å£">è‹ç©¹ç”¨æˆ·ç«¯/Cç«¯-åœ°å€ç°¿æ¥å£</h1><h2 id="POST-æ–°å¢åœ°å€">POST æ–°å¢åœ°å€</h2><p>POST /user/addressBook</p><blockquote><p>Body è¯·æ±‚å‚æ•°</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;cityCode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;cityName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;consignee&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;detail&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;districtCode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;districtName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;isDefault&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;label&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;phone&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;provinceCode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;provinceName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;sex&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;userId&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¯·æ±‚å‚æ•°-101">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Content-Type</td><td>header</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr><tr><td>body</td><td>body</td><td>object</td><td>å¦</td><td>AddressBook</td><td>none</td></tr><tr><td>Â» cityCode</td><td>body</td><td>string</td><td>å¦</td><td></td><td>none</td></tr><tr><td>Â» cityName</td><td>body</td><td>string</td><td>å¦</td><td></td><td>none</td></tr><tr><td>Â» consignee</td><td>body</td><td>string</td><td>å¦</td><td></td><td>none</td></tr><tr><td>Â» detail</td><td>body</td><td>string</td><td>æ˜¯</td><td></td><td>è¯¦ç»†åœ°å€</td></tr><tr><td>Â» districtCode</td><td>body</td><td>string</td><td>å¦</td><td></td><td>none</td></tr><tr><td>Â» districtName</td><td>body</td><td>string</td><td>å¦</td><td></td><td>none</td></tr><tr><td>Â» id</td><td>body</td><td>integer(int64)</td><td>å¦</td><td></td><td>none</td></tr><tr><td>Â» isDefault</td><td>body</td><td>integer(int32)</td><td>å¦</td><td></td><td>none</td></tr><tr><td>Â» label</td><td>body</td><td>string</td><td>å¦</td><td></td><td>none</td></tr><tr><td>Â» phone</td><td>body</td><td>string</td><td>æ˜¯</td><td></td><td>æ‰‹æœºå·</td></tr><tr><td>Â» provinceCode</td><td>body</td><td>string</td><td>å¦</td><td></td><td>none</td></tr><tr><td>Â» provinceName</td><td>body</td><td>string</td><td>å¦</td><td></td><td>none</td></tr><tr><td>Â» sex</td><td>body</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr><tr><td>Â» userId</td><td>body</td><td>integer(int64)</td><td>å¦</td><td></td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>200 Response</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-101">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td>Inline</td></tr></tbody></table><h3 id="è¿”å›æ•°æ®ç»“æ„-56">è¿”å›æ•°æ®ç»“æ„</h3><p>çŠ¶æ€ç  <strong>200</strong></p><p><em>R</em></p><table><thead><tr><th>åç§°</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>çº¦æŸ</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Â» code</td><td>integer(int32)</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» data</td><td>object</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» msg</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr></tbody></table><h2 id="PUT-æ ¹æ®idä¿®æ”¹åœ°å€">PUT æ ¹æ®idä¿®æ”¹åœ°å€</h2><p>PUT /user/addressBook</p><blockquote><p>Body è¯·æ±‚å‚æ•°</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;cityCode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;cityName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;consignee&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;detail&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;districtCode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;districtName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;isDefault&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;label&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;phone&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;provinceCode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;provinceName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;sex&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;userId&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¯·æ±‚å‚æ•°-102">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Content-Type</td><td>header</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr><tr><td>body</td><td>body</td><td>object</td><td>å¦</td><td>AddressBook</td><td>none</td></tr><tr><td>Â» cityCode</td><td>body</td><td>string</td><td>å¦</td><td></td><td>none</td></tr><tr><td>Â» cityName</td><td>body</td><td>string</td><td>å¦</td><td></td><td>none</td></tr><tr><td>Â» consignee</td><td>body</td><td>string</td><td>å¦</td><td></td><td>none</td></tr><tr><td>Â» detail</td><td>body</td><td>string</td><td>æ˜¯</td><td></td><td>è¯¦ç»†åœ°å€</td></tr><tr><td>Â» districtCode</td><td>body</td><td>string</td><td>å¦</td><td></td><td>none</td></tr><tr><td>Â» districtName</td><td>body</td><td>string</td><td>å¦</td><td></td><td>none</td></tr><tr><td>Â» id</td><td>body</td><td>integer(int64)</td><td>æ˜¯</td><td></td><td>ä¸»é”®å€¼</td></tr><tr><td>Â» isDefault</td><td>body</td><td>integer(int32)</td><td>å¦</td><td></td><td>none</td></tr><tr><td>Â» label</td><td>body</td><td>string</td><td>å¦</td><td></td><td>none</td></tr><tr><td>Â» phone</td><td>body</td><td>string</td><td>æ˜¯</td><td></td><td>æ‰‹æœºå·</td></tr><tr><td>Â» provinceCode</td><td>body</td><td>string</td><td>å¦</td><td></td><td>none</td></tr><tr><td>Â» provinceName</td><td>body</td><td>string</td><td>å¦</td><td></td><td>none</td></tr><tr><td>Â» sex</td><td>body</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr><tr><td>Â» userId</td><td>body</td><td>integer(int64)</td><td>å¦</td><td></td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>200 Response</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-102">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td>Inline</td></tr></tbody></table><h3 id="è¿”å›æ•°æ®ç»“æ„-57">è¿”å›æ•°æ®ç»“æ„</h3><p>çŠ¶æ€ç  <strong>200</strong></p><p><em>R</em></p><table><thead><tr><th>åç§°</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>çº¦æŸ</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Â» code</td><td>integer(int32)</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» data</td><td>object</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» msg</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr></tbody></table><h2 id="DELETE-æ ¹æ®idåˆ é™¤åœ°å€">DELETE æ ¹æ®idåˆ é™¤åœ°å€</h2><p>DELETE /user/addressBook</p><blockquote><p>Body è¯·æ±‚å‚æ•°</p></blockquote><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">string</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="è¯·æ±‚å‚æ•°-103">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>id</td><td>query</td><td>string</td><td>æ˜¯</td><td></td><td>åœ°å€id</td></tr><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr><tr><td>body</td><td>body</td><td>string</td><td>å¦</td><td></td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>200 Response</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-103">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td>Inline</td></tr></tbody></table><h3 id="è¿”å›æ•°æ®ç»“æ„-58">è¿”å›æ•°æ®ç»“æ„</h3><p>çŠ¶æ€ç  <strong>200</strong></p><p><em>R</em></p><table><thead><tr><th>åç§°</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>çº¦æŸ</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Â» code</td><td>integer(int32)</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» data</td><td>object</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» msg</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr></tbody></table><h2 id="GET-æŸ¥è¯¢å½“å‰ç™»å½•ç”¨æˆ·çš„æ‰€æœ‰åœ°å€ä¿¡æ¯">GET æŸ¥è¯¢å½“å‰ç™»å½•ç”¨æˆ·çš„æ‰€æœ‰åœ°å€ä¿¡æ¯</h2><p>GET /user/addressBook/list</p><h3 id="è¯·æ±‚å‚æ•°-104">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>200 Response</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;userId&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;consignee&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;phone&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;sex&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;provinceCode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;provinceName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;cityCode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;cityName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;districtCode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;districtName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;detail&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;label&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;isDefault&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-104">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td>Inline</td></tr></tbody></table><h3 id="è¿”å›æ•°æ®ç»“æ„-59">è¿”å›æ•°æ®ç»“æ„</h3><p>çŠ¶æ€ç  <strong>200</strong></p><p><em>R</em></p><table><thead><tr><th>åç§°</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>çº¦æŸ</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Â» code</td><td>integer(int32)</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» data</td><td>object</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» id</td><td>number</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» userId</td><td>number</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» consignee</td><td>string</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» phone</td><td>string</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» sex</td><td>string</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» provinceCode</td><td>string</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» provinceName</td><td>string</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» cityCode</td><td>string</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» cityName</td><td>string</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» districtCode</td><td>string</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» districtName</td><td>string</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» detail</td><td>string</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» label</td><td>string</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» isDefault</td><td>number</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» msg</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr></tbody></table><h2 id="GET-æŸ¥è¯¢é»˜è®¤åœ°å€">GET æŸ¥è¯¢é»˜è®¤åœ°å€</h2><p>GET /user/addressBook/default</p><h3 id="è¯·æ±‚å‚æ•°-105">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>200 Response</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;cityCode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;cityName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;consignee&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;detail&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;districtCode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;districtName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;isDefault&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;label&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;phone&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;provinceCode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;provinceName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;sex&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;userId&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-105">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td>Inline</td></tr></tbody></table><h3 id="è¿”å›æ•°æ®ç»“æ„-60">è¿”å›æ•°æ®ç»“æ„</h3><p>çŠ¶æ€ç  <strong>200</strong></p><p><em>RÂ«AddressBookÂ»</em></p><table><thead><tr><th>åç§°</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>çº¦æŸ</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Â» code</td><td>integer(int32)</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» data</td><td>object</td><td>false</td><td>none</td><td>AddressBook</td><td>none</td></tr><tr><td>Â»Â» cityCode</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» cityName</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» consignee</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» detail</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» districtCode</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» districtName</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» id</td><td>integer(int64)</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» isDefault</td><td>integer(int32)</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» label</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» phone</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» provinceCode</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» provinceName</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» sex</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» userId</td><td>integer(int64)</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» msg</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr></tbody></table><h2 id="PUT-è®¾ç½®é»˜è®¤åœ°å€">PUT è®¾ç½®é»˜è®¤åœ°å€</h2><p>PUT /user/addressBook/default</p><blockquote><p>Body è¯·æ±‚å‚æ•°</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¯·æ±‚å‚æ•°-106">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Content-Type</td><td>header</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr><tr><td>body</td><td>body</td><td>object</td><td>å¦</td><td>AddressBook</td><td>none</td></tr><tr><td>Â» id</td><td>body</td><td>integer(int64)</td><td>æ˜¯</td><td></td><td>åœ°å€id</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>200 Response</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-106">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td>Inline</td></tr></tbody></table><h3 id="è¿”å›æ•°æ®ç»“æ„-61">è¿”å›æ•°æ®ç»“æ„</h3><p>çŠ¶æ€ç  <strong>200</strong></p><p><em>R</em></p><table><thead><tr><th>åç§°</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>çº¦æŸ</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Â» code</td><td>integer(int32)</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» data</td><td>object</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» msg</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr></tbody></table><h2 id="GET-æ ¹æ®idæŸ¥è¯¢åœ°å€">GET æ ¹æ®idæŸ¥è¯¢åœ°å€</h2><p>GET /user/addressBook/{id}</p><h3 id="è¯·æ±‚å‚æ•°-107">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>id</td><td>path</td><td>string</td><td>æ˜¯</td><td></td><td>åœ°å€id</td></tr><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>200 Response</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;phone&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;consignee&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;userId&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;cityCode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;provinceName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;provinceCode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;sex&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;districtName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;districtCode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;cityName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;isDefault&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;label&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;detail&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-107">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td>Inline</td></tr></tbody></table><h3 id="è¿”å›æ•°æ®ç»“æ„-62">è¿”å›æ•°æ®ç»“æ„</h3><p>çŠ¶æ€ç  <strong>200</strong></p><table><thead><tr><th>åç§°</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>çº¦æŸ</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Â» code</td><td>number</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» data</td><td>object</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» id</td><td>number</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» phone</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» consignee</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» userId</td><td>number</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» cityCode</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» provinceName</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» provinceCode</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» sex</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» districtName</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» districtCode</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» cityName</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» isDefault</td><td>number</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» label</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» detail</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» msg</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr></tbody></table><h1 id="è‹ç©¹ç”¨æˆ·ç«¯-Cç«¯-å¥—é¤æµè§ˆæ¥å£">è‹ç©¹ç”¨æˆ·ç«¯/Cç«¯-å¥—é¤æµè§ˆæ¥å£</h1><h2 id="GET-æ ¹æ®åˆ†ç±»idæŸ¥è¯¢å¥—é¤">GET æ ¹æ®åˆ†ç±»idæŸ¥è¯¢å¥—é¤</h2><p>GET /user/setmeal/list</p><h3 id="è¯·æ±‚å‚æ•°-108">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>categoryId</td><td>query</td><td>string</td><td>æ˜¯</td><td></td><td>åˆ†ç±»id</td></tr><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>200 Response</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;categoryId&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;createTime&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2019-08-24T14:15:22Z&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;createUser&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;image&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;price&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;status&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;updateTime&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2019-08-24T14:15:22Z&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;updateUser&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-108">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td>Inline</td></tr></tbody></table><h3 id="è¿”å›æ•°æ®ç»“æ„-63">è¿”å›æ•°æ®ç»“æ„</h3><p>çŠ¶æ€ç  <strong>200</strong></p><p><em>RÂ«ListÂ«SetmealÂ»Â»</em></p><table><thead><tr><th>åç§°</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>çº¦æŸ</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Â» code</td><td>integer(int32)</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» data</td><td>[object]</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» Setmeal</td><td>object</td><td>false</td><td>none</td><td>Setmeal</td><td>none</td></tr><tr><td>Â»Â»Â» categoryId</td><td>integer(int64)</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» createTime</td><td>string(date-time)</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» createUser</td><td>integer(int64)</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» description</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» id</td><td>integer(int64)</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» image</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» name</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» price</td><td>number</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» status</td><td>integer(int32)</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» updateTime</td><td>string(date-time)</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» updateUser</td><td>integer(int64)</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» msg</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr></tbody></table><h2 id="GET-æ ¹æ®å¥—é¤idæŸ¥è¯¢åŒ…å«çš„èœå“">GET æ ¹æ®å¥—é¤idæŸ¥è¯¢åŒ…å«çš„èœå“</h2><p>GET /user/setmeal/dish/{id}</p><h3 id="è¯·æ±‚å‚æ•°-109">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>id</td><td>path</td><td>string</td><td>æ˜¯</td><td></td><td>å¥—é¤id</td></tr><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>200 Response</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;copies&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;image&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-109">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td>Inline</td></tr></tbody></table><h3 id="è¿”å›æ•°æ®ç»“æ„-64">è¿”å›æ•°æ®ç»“æ„</h3><p>çŠ¶æ€ç  <strong>200</strong></p><p><em>RÂ«ListÂ«DishItemVOÂ»Â»</em></p><table><thead><tr><th>åç§°</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>çº¦æŸ</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Â» code</td><td>integer(int32)</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» data</td><td>[object]</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» DishItemVO</td><td>object</td><td>false</td><td>none</td><td>DishItemVO</td><td>none</td></tr><tr><td>Â»Â»Â» copies</td><td>integer(int32)</td><td>true</td><td>none</td><td></td><td>ä»½æ•°</td></tr><tr><td>Â»Â»Â» description</td><td>string</td><td>true</td><td>none</td><td></td><td>èœå“æè¿°</td></tr><tr><td>Â»Â»Â» image</td><td>string</td><td>true</td><td>none</td><td></td><td>èœå“å›¾ç‰‡è·¯å¾„</td></tr><tr><td>Â»Â»Â» name</td><td>string</td><td>true</td><td>none</td><td></td><td>èœå“åç§°</td></tr><tr><td>Â» msg</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr></tbody></table><h1 id="è‹ç©¹ç”¨æˆ·ç«¯-Cç«¯-åº—é“ºæ“ä½œæ¥å£">è‹ç©¹ç”¨æˆ·ç«¯/Cç«¯-åº—é“ºæ“ä½œæ¥å£</h1><h2 id="GET-è·å–è¥ä¸šçŠ¶æ€-2">GET è·å–è¥ä¸šçŠ¶æ€</h2><p>GET /user/shop/status</p><h3 id="è¯·æ±‚å‚æ•°-110">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>200 Response</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-110">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td>Inline</td></tr></tbody></table><h3 id="è¿”å›æ•°æ®ç»“æ„-65">è¿”å›æ•°æ®ç»“æ„</h3><p>çŠ¶æ€ç  <strong>200</strong></p><p><em>RÂ«intÂ»</em></p><table><thead><tr><th>åç§°</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>çº¦æŸ</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Â» code</td><td>integer(int32)</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» data</td><td>integer(int32)</td><td>true</td><td>none</td><td></td><td>åº—é“ºçŠ¶æ€ï¼š1ä¸ºè¥ä¸šï¼Œ0ä¸ºæ‰“çƒŠ</td></tr><tr><td>Â» msg</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr></tbody></table><h1 id="è‹ç©¹ç”¨æˆ·ç«¯-Cç«¯-ç”¨æˆ·æ¥å£">è‹ç©¹ç”¨æˆ·ç«¯/Cç«¯-ç”¨æˆ·æ¥å£</h1><h2 id="POST-ç™»å½•-2">POST ç™»å½•</h2><p>POST /user/user/login</p><blockquote><p>Body è¯·æ±‚å‚æ•°</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¯·æ±‚å‚æ•°-111">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Content-Type</td><td>header</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr><tr><td>body</td><td>body</td><td>object</td><td>å¦</td><td>UserLoginDTO</td><td>none</td></tr><tr><td>Â» code</td><td>body</td><td>string</td><td>æ˜¯</td><td></td><td>å¾®ä¿¡æˆæƒç </td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>200 Response</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;openid&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;token&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-111">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td>Inline</td></tr></tbody></table><h3 id="è¿”å›æ•°æ®ç»“æ„-66">è¿”å›æ•°æ®ç»“æ„</h3><p>çŠ¶æ€ç  <strong>200</strong></p><p><em>RÂ«UserLoginVOÂ»</em></p><table><thead><tr><th>åç§°</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>çº¦æŸ</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Â» code</td><td>integer(int32)</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» data</td><td>object</td><td>true</td><td>none</td><td>UserLoginVO</td><td>none</td></tr><tr><td>Â»Â» id</td><td>integer(int64)</td><td>true</td><td>none</td><td></td><td>ç”¨æˆ·id</td></tr><tr><td>Â»Â» openid</td><td>string</td><td>true</td><td>none</td><td></td><td>å¾®ä¿¡ç”¨æˆ·openid</td></tr><tr><td>Â»Â» token</td><td>string</td><td>true</td><td>none</td><td></td><td>jwtä»¤ç‰Œ</td></tr><tr><td>Â» msg</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr></tbody></table><h2 id="POST-é€€å‡º">POST é€€å‡º</h2><p>POST /user/user/logout</p><blockquote><p>Body è¯·æ±‚å‚æ•°</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¯·æ±‚å‚æ•°-112">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Content-Type</td><td>header</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr><tr><td>body</td><td>body</td><td>object</td><td>å¦</td><td>empty object</td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>200 Response</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-112">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td>Inline</td></tr></tbody></table><h3 id="è¿”å›æ•°æ®ç»“æ„-67">è¿”å›æ•°æ®ç»“æ„</h3><p>çŠ¶æ€ç  <strong>200</strong></p><p><em>R</em></p><table><thead><tr><th>åç§°</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>çº¦æŸ</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Â» code</td><td>integer(int32)</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» data</td><td>object</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» msg</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr></tbody></table><h1 id="è‹ç©¹ç”¨æˆ·ç«¯-Cç«¯-èœå“æµè§ˆæ¥å£">è‹ç©¹ç”¨æˆ·ç«¯/Cç«¯-èœå“æµè§ˆæ¥å£</h1><h2 id="GET-æ ¹æ®åˆ†ç±»idæŸ¥è¯¢èœå“-2">GET æ ¹æ®åˆ†ç±»idæŸ¥è¯¢èœå“</h2><p>GET /user/dish/list</p><h3 id="è¯·æ±‚å‚æ•°-113">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>categoryId</td><td>query</td><td>string</td><td>æ˜¯</td><td></td><td>åˆ†ç±»id</td></tr><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>200 Response</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;categoryId&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;categoryName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;flavors&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;dishId&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;image&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;price&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;status&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;updateTime&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2019-08-24T14:15:22Z&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-113">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td>Inline</td></tr></tbody></table><h3 id="è¿”å›æ•°æ®ç»“æ„-68">è¿”å›æ•°æ®ç»“æ„</h3><p>çŠ¶æ€ç  <strong>200</strong></p><p><em>RÂ«ListÂ«DishVOÂ»Â»</em></p><table><thead><tr><th>åç§°</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>çº¦æŸ</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Â» code</td><td>integer(int32)</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» data</td><td>[object]</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» DishVO</td><td>object</td><td>false</td><td>none</td><td>DishVO</td><td>none</td></tr><tr><td>Â»Â»Â» categoryId</td><td>integer(int64)</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» categoryName</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» description</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» flavors</td><td>[object]</td><td>false</td><td>none</td><td></td><td>èœå“å£å‘³</td></tr><tr><td>Â»Â»Â»Â» DishFlavor</td><td>object</td><td>false</td><td>none</td><td>DishFlavor</td><td>none</td></tr><tr><td>Â»Â»Â»Â»Â» dishId</td><td>integer(int64)</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â»Â»Â» id</td><td>integer(int64)</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â»Â»Â» name</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â»Â»Â» value</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» id</td><td>integer(int64)</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» image</td><td>string</td><td>false</td><td>none</td><td></td><td>èœå“å›¾ç‰‡è·¯å¾„</td></tr><tr><td>Â»Â»Â» name</td><td>string</td><td>false</td><td>none</td><td></td><td>èœå“åç§°</td></tr><tr><td>Â»Â»Â» price</td><td>number</td><td>false</td><td>none</td><td></td><td>ä»·æ ¼</td></tr><tr><td>Â»Â»Â» status</td><td>integer(int32)</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» updateTime</td><td>string(date-time)</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» msg</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr></tbody></table><h1 id="è‹ç©¹ç”¨æˆ·ç«¯-Cç«¯-è®¢å•æ¥å£">è‹ç©¹ç”¨æˆ·ç«¯/Cç«¯-è®¢å•æ¥å£</h1><h2 id="GET-å‚¬å•">GET å‚¬å•</h2><p>GET /user/order/reminder/{id}</p><h3 id="è¯·æ±‚å‚æ•°-114">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>id</td><td>path</td><td>string</td><td>æ˜¯</td><td></td><td>è®¢å•id</td></tr><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>200 Response</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-114">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td>Inline</td></tr></tbody></table><h3 id="è¿”å›æ•°æ®ç»“æ„-69">è¿”å›æ•°æ®ç»“æ„</h3><p>çŠ¶æ€ç  <strong>200</strong></p><p><em>R</em></p><table><thead><tr><th>åç§°</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>çº¦æŸ</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Â» code</td><td>integer(int32)</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» data</td><td>object</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» msg</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr></tbody></table><h2 id="POST-å†æ¥ä¸€å•">POST å†æ¥ä¸€å•</h2><p>POST /user/order/repetition/{id}</p><blockquote><p>Body è¯·æ±‚å‚æ•°</p></blockquote><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">string</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="è¯·æ±‚å‚æ•°-115">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>id</td><td>path</td><td>string</td><td>æ˜¯</td><td></td><td>è®¢å•id</td></tr><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr><tr><td>body</td><td>body</td><td>string</td><td>å¦</td><td></td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>200 Response</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-115">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td>Inline</td></tr></tbody></table><h3 id="è¿”å›æ•°æ®ç»“æ„-70">è¿”å›æ•°æ®ç»“æ„</h3><p>çŠ¶æ€ç  <strong>200</strong></p><p><em>R</em></p><table><thead><tr><th>åç§°</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>çº¦æŸ</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Â» code</td><td>integer(int32)</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» data</td><td>object</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» msg</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr></tbody></table><h2 id="GET-å†å²è®¢å•æŸ¥è¯¢">GET å†å²è®¢å•æŸ¥è¯¢</h2><p>GET /user/order/historyOrders</p><h3 id="è¯·æ±‚å‚æ•°-116">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>page</td><td>query</td><td>string</td><td>æ˜¯</td><td></td><td>é¡µé¢</td></tr><tr><td>pageSize</td><td>query</td><td>string</td><td>æ˜¯</td><td></td><td>æ¯é¡µè®°å½•æ•°</td></tr><tr><td>status</td><td>query</td><td>string</td><td>å¦</td><td></td><td>è®¢å•çŠ¶æ€</td></tr><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>200 Response</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;total&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;records&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;number&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;status&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;userId&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;addressBookId&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;orderTime&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;checkoutTime&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;payMethod&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;payStatus&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;amount&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;remark&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;userName&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;phone&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;address&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;consignee&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;cancelReason&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;rejectionReason&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;cancelTime&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;estimatedDeliveryTime&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;deliveryStatus&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;deliveryTime&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;packAmount&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;tablewareNumber&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;tablewareStatus&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;orderDetailList&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">          <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;orderId&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;dishId&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;setmealId&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;dishFlavor&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;number&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;amount&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;image&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">]</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-116">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td>Inline</td></tr></tbody></table><h3 id="è¿”å›æ•°æ®ç»“æ„-71">è¿”å›æ•°æ®ç»“æ„</h3><p>çŠ¶æ€ç  <strong>200</strong></p><table><thead><tr><th>åç§°</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>çº¦æŸ</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Â» code</td><td>number</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» msg</td><td>null</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» data</td><td>object</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» total</td><td>number</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» records</td><td>[object]</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» id</td><td>number</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» number</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» status</td><td>number</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» userId</td><td>number</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» addressBookId</td><td>number</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» orderTime</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» checkoutTime</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» payMethod</td><td>number</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» payStatus</td><td>number</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» amount</td><td>number</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» remark</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» userName</td><td>null</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» phone</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» address</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» consignee</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» cancelReason</td><td>null</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» rejectionReason</td><td>null</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» cancelTime</td><td>null</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» estimatedDeliveryTime</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» deliveryStatus</td><td>number</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» deliveryTime</td><td>null</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» packAmount</td><td>number</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» tablewareNumber</td><td>number</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» tablewareStatus</td><td>number</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» orderDetailList</td><td>[object]</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â»Â» id</td><td>number</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â»Â» name</td><td>string</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â»Â» orderId</td><td>number</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â»Â» dishId</td><td>number</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â»Â» setmealId</td><td>null</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â»Â» dishFlavor</td><td>nullÂ¦null</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â»Â» number</td><td>number</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â»Â» amount</td><td>number</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â»Â» image</td><td>string</td><td>true</td><td>none</td><td></td><td>none</td></tr></tbody></table><h2 id="PUT-å–æ¶ˆè®¢å•-2">PUT å–æ¶ˆè®¢å•</h2><p>PUT /user/order/cancel/{id}</p><blockquote><p>Body è¯·æ±‚å‚æ•°</p></blockquote><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">string</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="è¯·æ±‚å‚æ•°-117">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>id</td><td>path</td><td>string</td><td>æ˜¯</td><td></td><td>è®¢å•id</td></tr><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr><tr><td>body</td><td>body</td><td>string</td><td>å¦</td><td></td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>200 Response</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-117">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td>Inline</td></tr></tbody></table><h3 id="è¿”å›æ•°æ®ç»“æ„-72">è¿”å›æ•°æ®ç»“æ„</h3><p>çŠ¶æ€ç  <strong>200</strong></p><p><em>R</em></p><table><thead><tr><th>åç§°</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>çº¦æŸ</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Â» code</td><td>integer(int32)</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» data</td><td>object</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» msg</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr></tbody></table><h2 id="GET-æŸ¥è¯¢è®¢å•è¯¦æƒ…-2">GET æŸ¥è¯¢è®¢å•è¯¦æƒ…</h2><p>GET /user/order/orderDetail/{id}</p><h3 id="è¯·æ±‚å‚æ•°-118">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>id</td><td>path</td><td>string</td><td>æ˜¯</td><td></td><td>è®¢å•id</td></tr><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>200 Response</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;address&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;addressBookId&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;amount&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;cancelReason&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;cancelTime&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2019-08-24T14:15:22Z&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;checkoutTime&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2019-08-24T14:15:22Z&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;consignee&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;deliveryStatus&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;deliveryTime&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2019-08-24T14:15:22Z&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;estimatedDeliveryTime&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2019-08-24T14:15:22Z&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;number&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;orderDetailList&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;amount&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;dishFlavor&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;dishId&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;image&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;number&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;orderId&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;setmealId&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;orderTime&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2019-08-24T14:15:22Z&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;packAmount&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;payMethod&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;payStatus&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;phone&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;rejectionReason&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;remark&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;status&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;tablewareNumber&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;tablewareStatus&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;userId&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;userName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-118">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td>Inline</td></tr></tbody></table><h3 id="è¿”å›æ•°æ®ç»“æ„-73">è¿”å›æ•°æ®ç»“æ„</h3><p>çŠ¶æ€ç  <strong>200</strong></p><p><em>RÂ«OrderVOÂ»</em></p><table><thead><tr><th>åç§°</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>çº¦æŸ</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Â» code</td><td>integer(int32)</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» data</td><td>object</td><td>false</td><td>none</td><td>OrderVO</td><td>none</td></tr><tr><td>Â»Â» address</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» addressBookId</td><td>integer(int64)</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» amount</td><td>number</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» cancelReason</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» cancelTime</td><td>string(date-time)</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» checkoutTime</td><td>string(date-time)</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» consignee</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» deliveryStatus</td><td>integer(int32)</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» deliveryTime</td><td>string(date-time)</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» estimatedDeliveryTime</td><td>string(date-time)</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» id</td><td>integer(int64)</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» number</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» orderDetailList</td><td>[object]</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» OrderDetail</td><td>object</td><td>false</td><td>none</td><td>OrderDetail</td><td>none</td></tr><tr><td>Â»Â»Â»Â» amount</td><td>number</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â»Â» dishFlavor</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â»Â» dishId</td><td>integer(int64)</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â»Â» id</td><td>integer(int64)</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â»Â» image</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â»Â» name</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â»Â» number</td><td>integer(int32)</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â»Â» orderId</td><td>integer(int64)</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â»Â» setmealId</td><td>integer(int64)</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» orderTime</td><td>string(date-time)</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» packAmount</td><td>integer(int32)</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» payMethod</td><td>integer(int32)</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» payStatus</td><td>integer(int32)</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» phone</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» rejectionReason</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» remark</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» status</td><td>integer(int32)</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» tablewareNumber</td><td>integer(int32)</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» tablewareStatus</td><td>integer(int32)</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» userId</td><td>integer(int64)</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» userName</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» msg</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr></tbody></table><h2 id="POST-ç”¨æˆ·ä¸‹å•">POST ç”¨æˆ·ä¸‹å•</h2><p>POST /user/order/submit</p><blockquote><p>Body è¯·æ±‚å‚æ•°</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;addressBookId&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;amount&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;deliveryStatus&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;estimatedDeliveryTime&quot;</span><span class="punctuation">:</span> <span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;packAmount&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;payMethod&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;remark&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;tablewareNumber&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;tablewareStatus&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¯·æ±‚å‚æ•°-119">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Content-Type</td><td>header</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr><tr><td>body</td><td>body</td><td>object</td><td>å¦</td><td>OrdersSubmitDTO</td><td>none</td></tr><tr><td>Â» addressBookId</td><td>body</td><td>integer(int64)</td><td>æ˜¯</td><td></td><td>åœ°å€ç°¿id</td></tr><tr><td>Â» amount</td><td>body</td><td>number</td><td>æ˜¯</td><td></td><td>æ€»é‡‘é¢</td></tr><tr><td>Â» deliveryStatus</td><td>body</td><td>integer(int32)</td><td>æ˜¯</td><td></td><td>é…é€çŠ¶æ€ï¼š  1ç«‹å³é€å‡º  0é€‰æ‹©å…·ä½“æ—¶é—´</td></tr><tr><td>Â» estimatedDeliveryTime</td><td>body</td><td>string</td><td>æ˜¯</td><td></td><td>é¢„è®¡é€è¾¾æ—¶é—´</td></tr><tr><td>Â» packAmount</td><td>body</td><td>integer(int32)</td><td>æ˜¯</td><td></td><td>æ‰“åŒ…è´¹</td></tr><tr><td>Â» payMethod</td><td>body</td><td>integer(int32)</td><td>æ˜¯</td><td></td><td>ä»˜æ¬¾æ–¹å¼</td></tr><tr><td>Â» remark</td><td>body</td><td>string</td><td>æ˜¯</td><td></td><td>å¤‡æ³¨</td></tr><tr><td>Â» tablewareNumber</td><td>body</td><td>integer(int32)</td><td>æ˜¯</td><td></td><td>é¤å…·æ•°é‡</td></tr><tr><td>Â» tablewareStatus</td><td>body</td><td>integer(int32)</td><td>æ˜¯</td><td></td><td>é¤å…·æ•°é‡çŠ¶æ€  1æŒ‰é¤é‡æä¾›  0é€‰æ‹©å…·ä½“æ•°é‡</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>200 Response</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;orderAmount&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;orderNumber&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;orderTime&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2019-08-24T14:15:22Z&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-119">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td>Inline</td></tr></tbody></table><h3 id="è¿”å›æ•°æ®ç»“æ„-74">è¿”å›æ•°æ®ç»“æ„</h3><p>çŠ¶æ€ç  <strong>200</strong></p><p><em>RÂ«OrderSubmitVOÂ»</em></p><table><thead><tr><th>åç§°</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>çº¦æŸ</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Â» code</td><td>integer(int32)</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» data</td><td>object</td><td>true</td><td>none</td><td>OrderSubmitVO</td><td>none</td></tr><tr><td>Â»Â» id</td><td>integer(int64)</td><td>true</td><td>none</td><td></td><td>è®¢å•id</td></tr><tr><td>Â»Â» orderAmount</td><td>number</td><td>true</td><td>none</td><td></td><td>è®¢å•é‡‘é¢</td></tr><tr><td>Â»Â» orderNumber</td><td>string</td><td>true</td><td>none</td><td></td><td>è®¢å•å·</td></tr><tr><td>Â»Â» orderTime</td><td>string(date-time)</td><td>true</td><td>none</td><td></td><td>ä¸‹å•æ—¶é—´</td></tr><tr><td>Â» msg</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr></tbody></table><h2 id="PUT-è®¢å•æ”¯ä»˜">PUT è®¢å•æ”¯ä»˜</h2><p>PUT /user/order/payment</p><blockquote><p>Body è¯·æ±‚å‚æ•°</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;orderNumber&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;payMethod&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¯·æ±‚å‚æ•°-120">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Content-Type</td><td>header</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr><tr><td>body</td><td>body</td><td>object</td><td>å¦</td><td>OrdersPaymentDTO</td><td>none</td></tr><tr><td>Â» orderNumber</td><td>body</td><td>string</td><td>æ˜¯</td><td></td><td>è®¢å•å·</td></tr><tr><td>Â» payMethod</td><td>body</td><td>integer(int32)</td><td>æ˜¯</td><td></td><td>æ”¯ä»˜æ–¹å¼</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>200 Response</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;nonceStr&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2019-08-24T14:15:22Z&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;paySign&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;timeStamp&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;signType&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;packageStr&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-120">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td>Inline</td></tr></tbody></table><h3 id="è¿”å›æ•°æ®ç»“æ„-75">è¿”å›æ•°æ®ç»“æ„</h3><p>çŠ¶æ€ç  <strong>200</strong></p><p><em>RÂ«OrderPaymentVOÂ»</em></p><table><thead><tr><th>åç§°</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>çº¦æŸ</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Â» code</td><td>integer(int32)</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» data</td><td>object</td><td>true</td><td>none</td><td>OrderPaymentVO</td><td>none</td></tr><tr><td>Â»Â» nonceStr</td><td>string(date-time)</td><td>true</td><td>none</td><td></td><td>éšæœºå­—ç¬¦ä¸²</td></tr><tr><td>Â»Â» paySign</td><td>string</td><td>true</td><td>none</td><td></td><td>ç­¾å</td></tr><tr><td>Â»Â» timeStamp</td><td>string</td><td>true</td><td>none</td><td></td><td>æ—¶é—´æˆ³</td></tr><tr><td>Â»Â» signType</td><td>string</td><td>true</td><td>none</td><td></td><td>ç­¾åç®—æ³•</td></tr><tr><td>Â»Â» packageStr</td><td>string</td><td>true</td><td>none</td><td></td><td>ç»Ÿä¸€ä¸‹å•æ¥å£è¿”å›çš„ prepay_id å‚æ•°å€¼</td></tr><tr><td>Â» msg</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr></tbody></table><h1 id="è‹ç©¹ç”¨æˆ·ç«¯-Cç«¯-è´­ç‰©è½¦æ¥å£">è‹ç©¹ç”¨æˆ·ç«¯/Cç«¯-è´­ç‰©è½¦æ¥å£</h1><h2 id="POST-åˆ é™¤è´­ç‰©è½¦ä¸­ä¸€ä¸ªå•†å“">POST åˆ é™¤è´­ç‰©è½¦ä¸­ä¸€ä¸ªå•†å“</h2><p>POST /user/shoppingCart/sub</p><blockquote><p>Body è¯·æ±‚å‚æ•°</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;dishFlavor&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;dishId&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;setmealId&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¯·æ±‚å‚æ•°-121">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Content-Type</td><td>header</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr><tr><td>body</td><td>body</td><td>object</td><td>å¦</td><td>ShoppingCartDTO</td><td>none</td></tr><tr><td>Â» dishFlavor</td><td>body</td><td>string</td><td>å¦</td><td></td><td>å£å‘³</td></tr><tr><td>Â» dishId</td><td>body</td><td>integer(int64)</td><td>å¦</td><td></td><td>èœå“id</td></tr><tr><td>Â» setmealId</td><td>body</td><td>integer(int64)</td><td>å¦</td><td></td><td>å¥—é¤id</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>200 Response</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-121">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td>Inline</td></tr></tbody></table><h3 id="è¿”å›æ•°æ®ç»“æ„-76">è¿”å›æ•°æ®ç»“æ„</h3><p>çŠ¶æ€ç  <strong>200</strong></p><p><em>RÂ«stringÂ»</em></p><table><thead><tr><th>åç§°</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>çº¦æŸ</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Â» code</td><td>integer(int32)</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» data</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» msg</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr></tbody></table><h2 id="GET-æŸ¥çœ‹è´­ç‰©è½¦">GET æŸ¥çœ‹è´­ç‰©è½¦</h2><p>GET /user/shoppingCart/list</p><h3 id="è¯·æ±‚å‚æ•°-122">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>200 Response</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;amount&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;createTime&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2019-08-24T14:15:22Z&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;dishFlavor&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;dishId&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;image&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;number&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;setmealId&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;userId&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-122">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td>Inline</td></tr></tbody></table><h3 id="è¿”å›æ•°æ®ç»“æ„-77">è¿”å›æ•°æ®ç»“æ„</h3><p>çŠ¶æ€ç  <strong>200</strong></p><p><em>RÂ«ListÂ«ShoppingCartÂ»Â»</em></p><table><thead><tr><th>åç§°</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>çº¦æŸ</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Â» code</td><td>integer(int32)</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» data</td><td>[object]</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â» ShoppingCart</td><td>object</td><td>false</td><td>none</td><td>ShoppingCart</td><td>none</td></tr><tr><td>Â»Â»Â» amount</td><td>number</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» createTime</td><td>string(date-time)</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» dishFlavor</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» dishId</td><td>integer(int64)</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» id</td><td>integer(int64)</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» image</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» name</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» number</td><td>integer(int32)</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» setmealId</td><td>integer(int64)</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â»Â»Â» userId</td><td>integer(int64)</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» msg</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr></tbody></table><h2 id="POST-æ·»åŠ è´­ç‰©è½¦">POST æ·»åŠ è´­ç‰©è½¦</h2><p>POST /user/shoppingCart/add</p><blockquote><p>Body è¯·æ±‚å‚æ•°</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;dishFlavor&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;dishId&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;setmealId&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¯·æ±‚å‚æ•°-123">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Content-Type</td><td>header</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr><tr><td>body</td><td>body</td><td>object</td><td>å¦</td><td>ShoppingCartDTO</td><td>none</td></tr><tr><td>Â» dishFlavor</td><td>body</td><td>string</td><td>å¦</td><td></td><td>å£å‘³</td></tr><tr><td>Â» dishId</td><td>body</td><td>integer(int64)</td><td>å¦</td><td></td><td>èœå“id</td></tr><tr><td>Â» setmealId</td><td>body</td><td>integer(int64)</td><td>å¦</td><td></td><td>å¥—é¤id</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>200 Response</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-123">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td>Inline</td></tr></tbody></table><h3 id="è¿”å›æ•°æ®ç»“æ„-78">è¿”å›æ•°æ®ç»“æ„</h3><p>çŠ¶æ€ç  <strong>200</strong></p><p><em>RÂ«stringÂ»</em></p><table><thead><tr><th>åç§°</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>çº¦æŸ</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Â» code</td><td>integer(int32)</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» data</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» msg</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr></tbody></table><h2 id="DELETE-æ¸…ç©ºè´­ç‰©è½¦">DELETE æ¸…ç©ºè´­ç‰©è½¦</h2><p>DELETE /user/shoppingCart/clean</p><blockquote><p>Body è¯·æ±‚å‚æ•°</p></blockquote><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">string</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="è¯·æ±‚å‚æ•°-124">è¯·æ±‚å‚æ•°</h3><table><thead><tr><th>åç§°</th><th>ä½ç½®</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>token</td><td>header</td><td>string</td><td>æ˜¯</td><td></td><td>none</td></tr><tr><td>body</td><td>body</td><td>string</td><td>å¦</td><td></td><td>none</td></tr></tbody></table><blockquote><p>è¿”å›ç¤ºä¾‹</p></blockquote><blockquote><p>200 Response</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ-124">è¿”å›ç»“æœ</h3><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€ç å«ä¹‰</th><th>è¯´æ˜</th><th>æ•°æ®æ¨¡å‹</th></tr></thead><tbody><tr><td>200</td><td><a href="https://tools.ietf.org/html/rfc7231#section-6.3.1">OK</a></td><td>æˆåŠŸ</td><td>Inline</td></tr></tbody></table><h3 id="è¿”å›æ•°æ®ç»“æ„-79">è¿”å›æ•°æ®ç»“æ„</h3><p>çŠ¶æ€ç  <strong>200</strong></p><p><em>RÂ«stringÂ»</em></p><table><thead><tr><th>åç§°</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>çº¦æŸ</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Â» code</td><td>integer(int32)</td><td>true</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» data</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>Â» msg</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr></tbody></table><h1 id="æ•°æ®æ¨¡å‹">æ•°æ®æ¨¡å‹</h1><h2 id="tocS_RecommendSearch">RecommendSearch</h2><p><a id="schemarecommendsearch"></a><br><a id="schema_RecommendSearch"></a><br><a id="tocSrecommendsearch"></a><br><a id="tocsrecommendsearch"></a></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;provinceList&quot;</span><span class="punctuation">:</span> <span class="string">&quot;new ArrayList&lt;&gt;()&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;cityList&quot;</span><span class="punctuation">:</span> <span class="string">&quot;new ArrayList&lt;&gt;()&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;typeList&quot;</span><span class="punctuation">:</span> <span class="string">&quot;new ArrayList&lt;&gt;()&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;levelList&quot;</span><span class="punctuation">:</span> <span class="string">&quot;new ArrayList&lt;&gt;()&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="å±æ€§">å±æ€§</h3><table><thead><tr><th>åç§°</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>çº¦æŸ</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>provinceList</td><td>[string]</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>cityList</td><td>[string]</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>typeList</td><td>[string]</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>levelList</td><td>[string]</td><td>false</td><td>none</td><td></td><td>none</td></tr></tbody></table><h2 id="tocS_UserFootPrint">UserFootPrint</h2><p><a id="schemauserfootprint"></a><br><a id="schema_UserFootPrint"></a><br><a id="tocSuserfootprint"></a><br><a id="tocsuserfootprint"></a></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;userId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;provinceName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;cityName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;spotName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="å±æ€§-2">å±æ€§</h3><table><thead><tr><th>åç§°</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>çº¦æŸ</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>userId</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>provinceName</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>cityName</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>spotName</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr></tbody></table><h2 id="tocS_UserLoginDTO">UserLoginDTO</h2><p><a id="schemauserlogindto"></a><br><a id="schema_UserLoginDTO"></a><br><a id="tocSuserlogindto"></a><br><a id="tocsuserlogindto"></a></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;username&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;password&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;shearCaptcha&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;userid&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="å±æ€§-3">å±æ€§</h3><table><thead><tr><th>åç§°</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>çº¦æŸ</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>username</td><td>string</td><td>false</td><td>none</td><td></td><td>ç”¨æˆ·è´¦å·ï¼Œç”¨æˆ·å</td></tr><tr><td>password</td><td>string</td><td>false</td><td>none</td><td></td><td>ç”¨æˆ·è´¦å·å¯†ç </td></tr><tr><td>shearCaptcha</td><td>string</td><td>false</td><td>none</td><td></td><td>éªŒè¯ç </td></tr><tr><td>userid</td><td>string</td><td>false</td><td>none</td><td></td><td>ç”¨æˆ·ä¸»é”®</td></tr></tbody></table><h2 id="tocS_Object">Object</h2><p><a id="schemaobject"></a><br><a id="schema_Object"></a><br><a id="tocSobject"></a><br><a id="tocsobject"></a></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="å±æ€§-4">å±æ€§</h3><p><em>None</em></p><h2 id="tocS_UserInfo">UserInfo</h2><p><a id="schemauserinfo"></a><br><a id="schema_UserInfo"></a><br><a id="tocSuserinfo"></a><br><a id="tocsuserinfo"></a></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;userid&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;username&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;password&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="å±æ€§-5">å±æ€§</h3><table><thead><tr><th>åç§°</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>çº¦æŸ</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>userid</td><td>string</td><td>false</td><td>none</td><td></td><td>ç”¨æˆ·ä¸»é”®</td></tr><tr><td>username</td><td>string</td><td>false</td><td>none</td><td></td><td>ç”¨æˆ·è´¦å·ï¼Œç”¨æˆ·å</td></tr><tr><td>password</td><td>string</td><td>false</td><td>none</td><td></td><td>ç”¨æˆ·è´¦å·å¯†ç </td></tr></tbody></table><h2 id="tocS_Student">Student</h2><p><a id="schemastudent"></a><br><a id="schema_Student"></a><br><a id="tocSstudent"></a><br><a id="tocsstudent"></a></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;money&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;place&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="å±æ€§-6">å±æ€§</h3><table><thead><tr><th>åç§°</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>çº¦æŸ</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>id</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>name</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>money</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr><tr><td>place</td><td>string</td><td>false</td><td>none</td><td></td><td>none</td></tr></tbody></table><h2 id="tocS_AjaxResult">AjaxResult</h2><p><a id="schemaajaxresult"></a><br><a id="schema_AjaxResult"></a><br><a id="tocSajaxresult"></a><br><a id="tocsajaxresult"></a></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;key&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="å±æ€§-7">å±æ€§</h3><table><thead><tr><th>åç§°</th><th>ç±»å‹</th><th>å¿…é€‰</th><th>çº¦æŸ</th><th>ä¸­æ–‡å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>key</td><td>object</td><td>false</td><td>none</td><td></td><td>none</td></tr></tbody></table>]]></content>
    
    
    <summary type="html">æ—…ç‰›ç½‘æ¥å£æ–‡æ¡£</summary>
    
    
    
    <category term="é¡¹ç›®" scheme="https://u7u7.top/categories/%E9%A1%B9%E7%9B%AE/"/>
    
    
    <category term="shell" scheme="https://u7u7.top/tags/shell/"/>
    
    <category term="http" scheme="https://u7u7.top/tags/http/"/>
    
    <category term="javascript" scheme="https://u7u7.top/tags/javascript/"/>
    
    <category term="ruby" scheme="https://u7u7.top/tags/ruby/"/>
    
    <category term="python" scheme="https://u7u7.top/tags/python/"/>
    
    <category term="php" scheme="https://u7u7.top/tags/php/"/>
    
    <category term="java" scheme="https://u7u7.top/tags/java/"/>
    
  </entry>
  
  <entry>
    <title>GoC</title>
    <link href="https://u7u7.top/posts/Goc.html"/>
    <id>https://u7u7.top/posts/Goc.html</id>
    <published>2024-06-06T05:00:25.000Z</published>
    <updated>2025-08-20T03:10:46.747Z</updated>
    
    <content type="html"><![CDATA[<h1 id="GOCç»ƒä¹ é¢˜">GOCç»ƒä¹ é¢˜</h1><h2 id="5æœˆ17å·è®­ç»ƒ">5æœˆ17å·è®­ç»ƒ</h2><h3 id="æ­£äº”è¾¹å½¢">æ­£äº”è¾¹å½¢</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    p.<span class="built_in">hide</span>().<span class="built_in">c</span>(<span class="number">14</span>).<span class="built_in">size</span>(<span class="number">5</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">5</span>;i++)&#123;</span><br><span class="line">        p. <span class="built_in">fd</span>(<span class="number">100</span>).<span class="built_in">rt</span>(<span class="number">72</span>);</span><br><span class="line">    &#125;      </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åäºŒè¾¹å½¢">åäºŒè¾¹å½¢</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    p.<span class="built_in">c</span>(<span class="number">14</span>).<span class="built_in">size</span>(<span class="number">5</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">12</span>;i++)&#123;</span><br><span class="line">        p.<span class="built_in">fd</span>(<span class="number">100</span>).<span class="built_in">rt</span>(<span class="number">30</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">12</span>;i++)&#123;</span><br><span class="line">        p.<span class="built_in">lt</span>(<span class="number">60</span>).<span class="built_in">fd</span>(<span class="number">100</span>).<span class="built_in">rt</span>(<span class="number">120</span>).<span class="built_in">fd</span>(<span class="number">100</span>);</span><br><span class="line">        p.<span class="built_in">lt</span>(<span class="number">30</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="äº”è§’æ˜Ÿ">äº”è§’æ˜Ÿ</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    p. <span class="built_in">hide</span>().<span class="built_in">c</span>(<span class="number">14</span>).<span class="built_in">size</span>(<span class="number">5</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">5</span>;i++)&#123;</span><br><span class="line">        p.<span class="built_in">fd</span>(<span class="number">100</span>).<span class="built_in">rt</span>(<span class="number">144</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ç©ºå¿ƒäº”è§’æ˜Ÿ">ç©ºå¿ƒäº”è§’æ˜Ÿ</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    p. <span class="built_in">hide</span>().<span class="built_in">c</span>(<span class="number">14</span>).<span class="built_in">size</span>(<span class="number">5</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">5</span>;i++)&#123;</span><br><span class="line">        p.<span class="built_in">fd</span>(<span class="number">100</span>).<span class="built_in">rt</span>(<span class="number">144</span>).<span class="built_in">fd</span>(<span class="number">100</span>).<span class="built_in">lt</span>(<span class="number">72</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ç©ºå¿ƒåè§’æ˜Ÿ">ç©ºå¿ƒåè§’æ˜Ÿ</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    p. <span class="built_in">hide</span>().<span class="built_in">c</span>(<span class="number">14</span>).<span class="built_in">size</span>(<span class="number">5</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">10</span>;i++)&#123;</span><br><span class="line">        p.<span class="built_in">fd</span>(<span class="number">100</span>).<span class="built_in">rt</span>(<span class="number">72</span>).<span class="built_in">fd</span>(<span class="number">100</span>).<span class="built_in">lt</span>(<span class="number">36</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åäº”è‰²åäº”è¾¹å½¢">åäº”è‰²åäº”è¾¹å½¢</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    p. <span class="built_in">hide</span>().<span class="built_in">size</span>(<span class="number">5</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">15</span>;i++)&#123;</span><br><span class="line">        p.<span class="built_in">c</span>(i).<span class="built_in">fd</span>(<span class="number">50</span>).<span class="built_in">rt</span>(<span class="number">24</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åäº”è‰²é’ˆ">åäº”è‰²é’ˆ</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    p. <span class="built_in">hide</span>().<span class="built_in">size</span>(<span class="number">5</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">15</span>;i++)&#123;</span><br><span class="line">        p. <span class="built_in">down</span>().<span class="built_in">c</span>(i).<span class="built_in">fd</span>(<span class="number">100</span>).<span class="built_in">up</span>();</span><br><span class="line">        p.<span class="built_in">bk</span>(<span class="number">100</span>).<span class="built_in">rt</span>(<span class="number">24</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å½©è‰²å›æ–‡">å½©è‰²å›æ–‡</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    p. <span class="built_in">hide</span>().<span class="built_in">size</span>(<span class="number">5</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">15</span>;i++)&#123;</span><br><span class="line">        p.<span class="built_in">c</span>(i).<span class="built_in">fd</span>(i*<span class="number">10</span>+<span class="number">10</span>).<span class="built_in">rt</span>(<span class="number">90</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="èŠ±æœµ">èŠ±æœµ</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    p. <span class="built_in">speed</span>(<span class="number">9</span>).<span class="built_in">picU</span>(<span class="number">0</span>).<span class="built_in">up</span>();<span class="comment">//è®¾ç½®ç”»å›¾æ–¹å‘éšç€ç¬”å¤´</span></span><br><span class="line">    p.<span class="built_in">rt</span>(<span class="number">90</span>).<span class="built_in">a</span>(<span class="number">100</span>,<span class="number">180</span>,<span class="number">1</span>);</span><br><span class="line">    <span class="comment">//ç”»å¶äºä¸‹åŠéƒ¨åˆ†</span></span><br><span class="line">    p.<span class="built_in">moveTo</span>(<span class="number">0</span>,<span class="number">-100</span>).<span class="built_in">lt</span>(<span class="number">90</span>).<span class="built_in">a</span>(<span class="number">100</span>,<span class="number">90</span>,<span class="number">0</span>);</span><br><span class="line">    <span class="comment">//å®Œæˆå³è¾¹å¶å­ä¸ŠåŠéƒ¨åˆ† 1/4ä¸ªåœ†</span></span><br><span class="line">    p.<span class="built_in">moveTo</span>(<span class="number">-100</span>,<span class="number">-100</span>).<span class="built_in">a</span>(<span class="number">100</span>,<span class="number">90</span>,<span class="number">1</span>);</span><br><span class="line">    <span class="comment">//å®Œæˆå·¦è¾¹å¶äºä¸ŠåŠéƒ¨åˆ†</span></span><br><span class="line">    p.<span class="built_in">moveTo</span>(<span class="number">0</span>,<span class="number">-200</span>).<span class="built_in">down</span>().<span class="built_in">fd</span>(<span class="number">300</span>).<span class="built_in">hide</span>();</span><br><span class="line">    <span class="comment">//ç§»åŠ¨åˆ°èŠ±çš„å°¾ç«¯å‘ä¸Šç”»èŒ</span></span><br><span class="line">    <span class="comment">//ç”»èŠ±æœµ åäºŒä¸ªæ­£åäºŒè¾¹å½¢</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">12</span>;i++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;<span class="number">12</span>;j++)&#123;</span><br><span class="line">            p. <span class="built_in">fd</span>(<span class="number">25</span>).<span class="built_in">rt</span>(<span class="number">30</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        p.<span class="built_in">rt</span>(<span class="number">30</span>);<span class="comment">//æ¯ä¸ªæ­£åäºŒè¾¹å½¢å·®è§’</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="5æœˆ23å·è®­ç»ƒ">5æœˆ23å·è®­ç»ƒ</h2><h3 id="32968-å†™æ•°å­—"><strong>32968.å†™æ•°å­—</strong></h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    p.<span class="built_in">hide</span>().<span class="built_in">size</span>(<span class="number">20</span>);</span><br><span class="line">    p.<span class="built_in">lt</span>(<span class="number">90</span>).<span class="built_in">c</span>(<span class="number">7</span>).<span class="built_in">fd</span>(<span class="number">50</span>).<span class="built_in">rt</span>(<span class="number">90</span>);</span><br><span class="line">    p.<span class="built_in">c</span>(<span class="number">9</span>).<span class="built_in">fd</span>(<span class="number">50</span>).<span class="built_in">rt</span>(<span class="number">90</span>).<span class="built_in">c</span>(<span class="number">11</span>).<span class="built_in">fd</span>(<span class="number">50</span>);</span><br><span class="line">    p.<span class="built_in">lt</span>(<span class="number">90</span>).<span class="built_in">c</span>(<span class="number">8</span>).<span class="built_in">fd</span>(<span class="number">50</span>).<span class="built_in">lt</span>(<span class="number">90</span>).<span class="built_in">c</span>(<span class="number">4</span>).<span class="built_in">fd</span>(<span class="number">50</span>);</span><br><span class="line">    p.<span class="built_in">up</span>().<span class="built_in">bk</span>(<span class="number">100</span>).<span class="built_in">rt</span>(<span class="number">90</span>).<span class="built_in">down</span>().<span class="built_in">c</span>(<span class="number">13</span>).<span class="built_in">bk</span>(<span class="number">100</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="79208-æœ‰è‰²æ­£å¤šè¾¹å½¢"><strong>79208.æœ‰è‰²æ­£å¤šè¾¹å½¢</strong></h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> a,b;</span><br><span class="line">    cin &gt;&gt; a&gt;&gt;b;</span><br><span class="line">    p.<span class="built_in">hide</span>().<span class="built_in">c</span>(b);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;a;i++)&#123;</span><br><span class="line">        p.<span class="built_in">rt</span>(<span class="number">360.0</span>/a).<span class="built_in">fd</span>(<span class="number">100</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="32971-åœ†å †å †"><strong>32971.åœ†å †å †</strong></h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    p.<span class="built_in">rt</span>(<span class="number">90</span>).<span class="built_in">up</span>().<span class="built_in">size</span>(<span class="number">10</span>).<span class="built_in">hide</span>();</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">3</span>;i&gt;<span class="number">0</span>;i--)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;i;j++)&#123;</span><br><span class="line">            p.<span class="built_in">fd</span>(<span class="number">50</span>).<span class="built_in">c</span>(<span class="number">3</span>-i).<span class="built_in">o</span>(<span class="number">50</span>).<span class="built_in">fd</span>(<span class="number">50</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        p.<span class="built_in">bk</span>(i*<span class="number">100</span>).<span class="built_in">lt</span>(<span class="number">60</span>).<span class="built_in">fd</span>(<span class="number">100</span>).<span class="built_in">rt</span>(<span class="number">60</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="32972-å†°å£¶åœºåœ°"><strong>32972.å†°å£¶åœºåœ°</strong></h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    p.<span class="built_in">r</span>(<span class="number">600</span>,<span class="number">140</span>,<span class="number">1</span>).<span class="built_in">text</span>(<span class="string">&quot;æˆ‘çˆ±ç¼–ç¨‹&quot;</span>,<span class="number">2</span>,<span class="number">50</span>).<span class="built_in">hide</span>();</span><br><span class="line">    p. <span class="built_in">moveTo</span>(<span class="number">450</span>/<span class="number">2</span>,<span class="number">0</span>);</span><br><span class="line">    p. <span class="built_in">oo</span>(<span class="number">40</span>).<span class="built_in">oo</span>(<span class="number">30</span>, <span class="number">15</span>).<span class="built_in">oo</span>(<span class="number">22</span>,<span class="number">1</span>).<span class="built_in">oo</span>(<span class="number">12</span>,<span class="number">15</span>);</span><br><span class="line">    p.<span class="built_in">moveTo</span>(<span class="number">-450</span>/<span class="number">2</span>,<span class="number">0</span>);</span><br><span class="line">    p.<span class="built_in">oo</span>(<span class="number">40</span>).<span class="built_in">oo</span>(<span class="number">30</span>, <span class="number">15</span>).<span class="built_in">oo</span>(<span class="number">22</span>,<span class="number">1</span>).<span class="built_in">oo</span>(<span class="number">12</span>,<span class="number">15</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> a,b;</span><br><span class="line">    <span class="type">double</span> c;</span><br><span class="line">    cin&gt;&gt;a&gt;&gt;b;</span><br><span class="line">    c = a*a+b*b;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=<span class="number">4</span>;i++)&#123;</span><br><span class="line">        p.<span class="built_in">fd</span>(a).<span class="built_in">lt</span>(<span class="number">90</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    p.<span class="built_in">rt</span>(<span class="number">90</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=<span class="number">4</span>;i++)&#123;</span><br><span class="line">        p.<span class="built_in">fd</span>(b).<span class="built_in">rt</span>(<span class="number">90</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//åˆ¤æ–­Cæ˜¯å¦ä¸ºæ­£æ•´æ•°</span></span><br><span class="line">    <span class="type">int</span> res =<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=<span class="number">150</span>;i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(c/i==i) res=<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(res==<span class="number">1</span>)&#123;</span><br><span class="line">        p.<span class="built_in">fd</span>(b).<span class="built_in">lineTo</span>(<span class="number">0</span>,a).<span class="built_in">lineTo</span>(a,a+b).<span class="built_in">lineTo</span>(a+b,b).<span class="built_in">lineTo</span>(b,<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="7811-å˜è‰²èŠ±"><strong>7811.å˜è‰²èŠ±</strong></h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    p.<span class="built_in">picU</span>(<span class="number">0</span>).<span class="built_in">hide</span>();</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">4</span>;i++)&#123;</span><br><span class="line">        p.<span class="built_in">ee</span>(<span class="number">30</span>,<span class="number">80</span>,<span class="number">14</span>).<span class="built_in">rt</span>(<span class="number">45</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    p.<span class="built_in">oo</span>(<span class="number">50</span>,<span class="number">6</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="32977-æŸ±çŠ¶æˆç»©å•"><strong>32977.æŸ±çŠ¶æˆç»©å•</strong></h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> score[<span class="number">8</span>],max;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=<span class="number">8</span>;i++)&#123;</span><br><span class="line">        cin&gt;&gt;score[i];</span><br><span class="line">        <span class="keyword">if</span>(max&lt;score[i]) max=score[i]; <span class="comment">//æ‰¾åˆ°æœ€å¤§å€¼</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=<span class="number">8</span>;i++)&#123;</span><br><span class="line">        p.<span class="built_in">moveTo</span>(<span class="number">-80</span>*<span class="number">4</span>+<span class="number">80</span>*(i<span class="number">-1</span>),score[i]/<span class="number">2</span>);<span class="comment">//ç§»åŠ¨åˆ°æŸ±çŠ¶å›¾æœ€ä¸­é—´ç”»çŸ©å½¢</span></span><br><span class="line">        <span class="comment">//score&gt;=180 ç»¿</span></span><br><span class="line">        <span class="keyword">if</span>(score[i] &gt;= <span class="number">180</span>)&#123;</span><br><span class="line">            p.<span class="built_in">rr</span>(<span class="number">50</span>,score[i],<span class="number">12</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            p.<span class="built_in">rr</span>(<span class="number">50</span>,score[i],<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(score[i] == max)&#123;</span><br><span class="line">            p.<span class="built_in">up</span>().<span class="built_in">fd</span>(score[i]/<span class="number">2</span>+<span class="number">30</span>).<span class="built_in">oo</span>(<span class="number">30</span>,<span class="number">12</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-4å¹´çº§è®­ç»ƒ">3-4å¹´çº§è®­ç»ƒ</h2><h3 id="7744-æ³¢æµªçº¿"><strong>7744.æ³¢æµªçº¿</strong></h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    p.<span class="built_in">rt</span>(<span class="number">60</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">11</span>;i++)&#123;</span><br><span class="line">        p.<span class="built_in">fd</span>(<span class="number">20</span>).<span class="built_in">rt</span>(<span class="number">60</span>).<span class="built_in">fd</span>(<span class="number">20</span>).<span class="built_in">lt</span>(<span class="number">60</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="7751-å½©è‰²çº¿æ¡"><strong>7751.å½©è‰²çº¿æ¡</strong></h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">13</span>;i++)&#123;</span><br><span class="line">        p.<span class="built_in">moveTo</span>(<span class="number">30</span>*i,<span class="number">0</span>);</span><br><span class="line">        p.<span class="built_in">c</span>(i).<span class="built_in">size</span>(i+<span class="number">1</span>).<span class="built_in">fd</span>(<span class="number">150</span>).<span class="built_in">bk</span>(<span class="number">150</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="7835-é¢œè‰²å¤šå˜çš„ç¯ç¬¼"><strong>7835.é¢œè‰²å¤šå˜çš„ç¯ç¬¼</strong></h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> a;</span><br><span class="line">    cin &gt;&gt; a;</span><br><span class="line">    p.<span class="built_in">up</span>();</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">5</span>;i++)&#123;</span><br><span class="line">        p.<span class="built_in">fd</span>(<span class="number">10</span>).<span class="built_in">oo</span>(<span class="number">10</span>,a).<span class="built_in">fd</span>(<span class="number">10</span>);</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="8356-æ­£åå…­è¾¹å½¢çš„èŠ±"><strong>8356.æ­£åå…­è¾¹å½¢çš„èŠ±</strong></h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    p.<span class="built_in">c</span>(<span class="number">9</span>).<span class="built_in">size</span>(<span class="number">4</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">16</span>;i++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;<span class="number">3</span>;j++)&#123;</span><br><span class="line">            p.<span class="built_in">fd</span>(<span class="number">50</span>).<span class="built_in">lt</span>(<span class="number">120</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        p.<span class="built_in">fd</span>(<span class="number">50</span>).<span class="built_in">rt</span>(<span class="number">360</span>/<span class="number">16.0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    p.<span class="built_in">moveTo</span>(<span class="number">125</span>,<span class="number">25</span>);</span><br><span class="line">    p.<span class="built_in">text</span>(<span class="string">&quot;æˆ‘çˆ±ç¼–ç¨‹&quot;</span>,<span class="number">9</span>,<span class="number">30</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="6674-æ’æ’è›‹"><strong>6674.æ’æ’è›‹</strong></h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    p.<span class="built_in">rt</span>(<span class="number">90</span>).<span class="built_in">up</span>().<span class="built_in">moveTo</span>(<span class="number">-300</span>,<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">6</span>;i++)&#123;</span><br><span class="line">        p.<span class="built_in">fd</span>(<span class="number">50</span>).<span class="built_in">ee</span>(<span class="number">50</span>,<span class="number">30</span>,<span class="number">5</span>).<span class="built_in">oo</span>(<span class="number">15</span>,<span class="number">1</span>).<span class="built_in">fd</span>(<span class="number">50</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="6376-å½©è‰²æ‘©å¤©è½®"><strong>6376.å½©è‰²æ‘©å¤©è½®</strong></h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">15</span>;i++)&#123;</span><br><span class="line">        p.<span class="built_in">c</span>(i).<span class="built_in">fd</span>(<span class="number">200</span>).<span class="built_in">oo</span>(<span class="number">40</span>).<span class="built_in">bk</span>(<span class="number">200</span>).<span class="built_in">rt</span>(<span class="number">360</span>/<span class="number">15.0</span>);</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="5-6å¹´çº§è®­ç»ƒ">5-6å¹´çº§è®­ç»ƒ</h2><h3 id="6007-å½©è‰²çš„é˜¶æ¢¯"><strong>6007.å½©è‰²çš„é˜¶æ¢¯</strong></h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">10</span>;i++)&#123;</span><br><span class="line">        p.<span class="built_in">c</span>(i).<span class="built_in">fd</span>(<span class="number">10</span>+<span class="number">5</span>*i).<span class="built_in">rt</span>(<span class="number">90</span>).<span class="built_in">fd</span>(<span class="number">10</span>+<span class="number">5</span>*i).<span class="built_in">lt</span>(<span class="number">90</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="7750-æ©™ç‰‡"><strong>7750.æ©™ç‰‡</strong></h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    p.<span class="built_in">oo</span>(<span class="number">100</span>,<span class="number">14</span>).<span class="built_in">oo</span>(<span class="number">90</span>,<span class="number">13</span>).<span class="built_in">size</span>(<span class="number">5</span>).<span class="built_in">c</span>(<span class="number">14</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">10</span>;i++)&#123;</span><br><span class="line">        p.<span class="built_in">fd</span>(<span class="number">90</span>).<span class="built_in">bk</span>(<span class="number">90</span>).<span class="built_in">rt</span>(<span class="number">36</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    p.<span class="built_in">up</span>();</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">5</span>;i++)&#123;</span><br><span class="line">        p.<span class="built_in">rt</span>(<span class="number">18</span>).<span class="built_in">fd</span>(<span class="number">55</span>).<span class="built_in">oo</span>(<span class="number">5</span>,<span class="number">15</span>).<span class="built_in">bk</span>(<span class="number">55</span>);</span><br><span class="line">        p.<span class="built_in">rt</span>(<span class="number">54</span>);</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="225-å½©è‰²èŠ±æœµ"><strong>225.å½©è‰²èŠ±æœµ</strong></h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    p.<span class="built_in">picU</span>(<span class="number">0</span>); <span class="comment">//å¼€å¯å›¾å½¢æŒ‰ç…§ç¬”æ–¹å‘ç”»</span></span><br><span class="line">    p.<span class="built_in">up</span>();</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">9</span>;i++)&#123;</span><br><span class="line">        p.<span class="built_in">fd</span>(<span class="number">130</span>).<span class="built_in">ee</span>(<span class="number">20</span>,<span class="number">100</span>,<span class="number">13</span>).<span class="built_in">bk</span>(<span class="number">130</span>).<span class="built_in">rt</span>(<span class="number">40</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    p.<span class="built_in">rt</span>(<span class="number">20</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">9</span>;i++)&#123;</span><br><span class="line">        p.<span class="built_in">fd</span>(<span class="number">110</span>).<span class="built_in">ee</span>(<span class="number">30</span>,<span class="number">80</span>,<span class="number">14</span>).<span class="built_in">bk</span>(<span class="number">110</span>).<span class="built_in">rt</span>(<span class="number">40</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5013-é™é€Ÿ60æ ‡å¿—"><strong>5013.é™é€Ÿ60æ ‡å¿—</strong></h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    p.<span class="built_in">oo</span>(<span class="number">150</span>,<span class="number">15</span>).<span class="built_in">oo</span>(<span class="number">140</span>,<span class="number">1</span>).<span class="built_in">oo</span>(<span class="number">120</span>,<span class="number">15</span>);</span><br><span class="line">    p.<span class="built_in">text</span>(<span class="string">&quot;60&quot;</span>,<span class="number">0</span>,<span class="number">180</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="6041-ä¸‰è§’é­”æ–¹"><strong>6041.ä¸‰è§’é­”æ–¹</strong></h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">5</span>;i++)&#123;</span><br><span class="line">        p.<span class="built_in">lt</span>(<span class="number">30</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;<span class="number">4</span>;j++)&#123;</span><br><span class="line">            p.<span class="built_in">fd</span>(<span class="number">100</span><span class="number">-10</span>*i).<span class="built_in">rt</span>(<span class="number">120</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        p.<span class="built_in">fd</span>(<span class="number">50</span><span class="number">-5</span>*i).<span class="built_in">lt</span>(<span class="number">60</span>+<span class="number">10</span>*i);</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åˆä¸­è®­ç»ƒ">åˆä¸­è®­ç»ƒ</h2><h3 id="6041-ä¸‰è§’é­”æ–¹-2"><strong>6041.ä¸‰è§’é­”æ–¹</strong></h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    p.<span class="built_in">rt</span>(<span class="number">30</span>).<span class="built_in">speed</span>(<span class="number">8</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">9</span>;i++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;<span class="number">3</span>;j++)&#123;</span><br><span class="line">            p.<span class="built_in">fd</span>(<span class="number">30</span>).<span class="built_in">rt</span>(<span class="number">120</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        p.<span class="built_in">rt</span>(<span class="number">60</span>).<span class="built_in">fd</span>(<span class="number">30</span>).<span class="built_in">lt</span>(<span class="number">60</span>);</span><br><span class="line">    &#125; </span><br><span class="line">    p.<span class="built_in">lt</span>(<span class="number">60</span>).<span class="built_in">fd</span>(<span class="number">30</span>).<span class="built_in">lt</span>(<span class="number">60</span>).<span class="built_in">fd</span>(<span class="number">240</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5013-é™é€Ÿ60æ ‡å¿—-2"><strong>5013.é™é€Ÿ60æ ‡å¿—</strong></h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    p.<span class="built_in">oo</span>(<span class="number">150</span>,<span class="number">15</span>).<span class="built_in">oo</span>(<span class="number">140</span>,<span class="number">1</span>).<span class="built_in">oo</span>(<span class="number">120</span>,<span class="number">15</span>);</span><br><span class="line">    p.<span class="built_in">text</span>(<span class="string">&quot;60&quot;</span>,<span class="number">0</span>,<span class="number">180</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="6685-æ”¶é›†è½å¶"><strong>6685.æ”¶é›†è½å¶</strong></h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    p.<span class="built_in">c</span>(<span class="number">6</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">4</span>;i++)&#123;</span><br><span class="line">        p.<span class="built_in">moveTo</span>(<span class="number">70</span>*i,<span class="number">0</span>);</span><br><span class="line">        p.<span class="built_in">ee</span>(<span class="number">30</span>,<span class="number">100</span>,<span class="number">13</span>);</span><br><span class="line">        p.<span class="built_in">fd</span>(<span class="number">100</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;<span class="number">4</span>;j++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(j%<span class="number">2</span>==<span class="number">0</span>)&#123;</span><br><span class="line">               p.<span class="built_in">bk</span>(<span class="number">40</span>).<span class="built_in">lt</span>(<span class="number">30</span>).<span class="built_in">fd</span>(<span class="number">30</span>).<span class="built_in">bk</span>(<span class="number">30</span>).<span class="built_in">rt</span>(<span class="number">30</span>); </span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">               p.<span class="built_in">bk</span>(<span class="number">40</span>).<span class="built_in">rt</span>(<span class="number">30</span>).<span class="built_in">fd</span>(<span class="number">30</span>).<span class="built_in">bk</span>(<span class="number">30</span>).<span class="built_in">lt</span>(<span class="number">30</span>); </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        p.<span class="built_in">bk</span>(<span class="number">70</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4992-åä¸€è¾¹å½¢èŠ±ç¯"><strong>4992.åä¸€è¾¹å½¢èŠ±ç¯</strong></h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    p.<span class="built_in">c</span>(<span class="number">9</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">11</span>;i++)&#123;</span><br><span class="line">        p.<span class="built_in">fd</span>(<span class="number">80</span>).<span class="built_in">oo</span>(<span class="number">15</span>,<span class="number">5</span>).<span class="built_in">bk</span>(<span class="number">40</span>).<span class="built_in">rt</span>(<span class="number">360</span>/<span class="number">11.0</span>);</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2369-è…¾å›¾"><strong>2369.è…¾å›¾</strong></h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    p.<span class="built_in">c</span>(<span class="number">12</span>).<span class="built_in">speed</span>(<span class="number">9</span>).<span class="built_in">hide</span>();</span><br><span class="line">    <span class="type">int</span> n,a,b,o;</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">6</span>;i++)&#123;</span><br><span class="line">        p.<span class="built_in">fd</span>(n).<span class="built_in">rt</span>(<span class="number">60</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    p.<span class="built_in">rt</span>(<span class="number">90</span>);</span><br><span class="line">    a = <span class="number">2</span>*<span class="built_in">sqrt</span>(n*n-(n/<span class="number">2.0</span>)*(n/<span class="number">2.0</span>));</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">3</span>;i++)&#123;</span><br><span class="line">        p.<span class="built_in">fd</span>(a).<span class="built_in">lt</span>(<span class="number">120</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    b = a /<span class="number">2.0</span>;</span><br><span class="line">    p.<span class="built_in">fd</span>(b).<span class="built_in">lt</span>(<span class="number">60</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">3</span>;i++)&#123;</span><br><span class="line">        p.<span class="built_in">fd</span>(b).<span class="built_in">rt</span>(<span class="number">30</span>).<span class="built_in">fd</span>(n/<span class="number">2.0</span>).<span class="built_in">bk</span>(n/<span class="number">2.0</span>).<span class="built_in">lt</span>(<span class="number">150</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    o = b/<span class="number">2.0</span>/<span class="built_in">sqrt</span>(<span class="number">3</span>);</span><br><span class="line">    p.<span class="built_in">up</span>().<span class="built_in">fd</span>(b/<span class="number">2.0</span>).<span class="built_in">lt</span>(<span class="number">90</span>).<span class="built_in">fd</span>(o).<span class="built_in">o</span>(o);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="7674-ä¸¤ç§‘æˆç»©">7674. ä¸¤ç§‘æˆç»©</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> f[<span class="number">20</span>],g[<span class="number">20</span>],h[<span class="number">20</span>];</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line">        cin &gt;&gt; f[i] &gt;&gt; g[i];</span><br><span class="line">    &#125;</span><br><span class="line">    p.<span class="built_in">rt</span>(<span class="number">90</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line">        <span class="type">int</span> max,maxxb;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;n;j++)&#123;</span><br><span class="line">            <span class="type">int</span> sum =f[j]+g[j];</span><br><span class="line">            <span class="keyword">if</span>(max &lt; sum || (sum == max &amp;&amp; f[j] &gt; f[maxxb]))&#123;</span><br><span class="line">               max = f[j]+g[j]; </span><br><span class="line">               maxxb=j; </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        p.<span class="built_in">moveTo</span>(<span class="number">0</span>,<span class="number">-20</span>*i);</span><br><span class="line">        p.<span class="built_in">c</span>(<span class="number">14</span>).<span class="built_in">fd</span>(f[maxxb]).<span class="built_in">c</span>(<span class="number">11</span>).<span class="built_in">fd</span>(g[maxxb]);</span><br><span class="line">        f[maxxb]=g[maxxb]=<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="6æœˆ5å·è®­ç»ƒ">6æœˆ5å·è®­ç»ƒ</h2><h3 id="34079-æ•°æ®ç»Ÿè®¡"><strong>34079.æ•°æ®ç»Ÿè®¡</strong></h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> n,x,a[<span class="number">5</span>];</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    p.<span class="built_in">hide</span>();</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line">        cin &gt;&gt; x;</span><br><span class="line">        <span class="keyword">if</span>(x&gt;=<span class="number">90</span>) a[<span class="number">0</span>]++;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(x&gt;=<span class="number">80</span>) a[<span class="number">1</span>]++;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(x&gt;=<span class="number">70</span>) a[<span class="number">2</span>]++;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(x&gt;=<span class="number">60</span>) a[<span class="number">3</span>]++;</span><br><span class="line">        <span class="keyword">else</span>  a[<span class="number">4</span>]++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">5</span>;i++)&#123;</span><br><span class="line">        p.<span class="built_in">moveTo</span>(<span class="number">20</span>*i,a[i]*<span class="number">5</span>).<span class="built_in">rr</span>(<span class="number">20</span>,a[i]*<span class="number">10</span>,i+<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="12512-å† çŠ¶ç—…æ¯’"><strong>12512.å† çŠ¶ç—…æ¯’</strong></h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    p.<span class="built_in">oo</span>(<span class="number">80</span>,<span class="number">3</span>).<span class="built_in">o</span>(<span class="number">100</span>).<span class="built_in">picU</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(i%<span class="number">2</span>==<span class="number">0</span>)&#123;</span><br><span class="line">            p.<span class="built_in">up</span>().<span class="built_in">fd</span>(<span class="number">100</span>).<span class="built_in">down</span>().<span class="built_in">fd</span>(<span class="number">20</span>).<span class="built_in">ee</span>(<span class="number">20</span>,<span class="number">10</span>,<span class="number">1</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            p.<span class="built_in">up</span>().<span class="built_in">fd</span>(<span class="number">100</span>).<span class="built_in">down</span>().<span class="built_in">fd</span>(<span class="number">40</span>).<span class="built_in">ee</span>(<span class="number">20</span>,<span class="number">10</span>,<span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        p.<span class="built_in">moveTo</span>(<span class="number">0</span>,<span class="number">0</span>).<span class="built_in">rt</span>(<span class="number">360.0</span>/n);</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="20857-å¤šä¸ªæ­£å¤šè¾¹å½¢"><strong>20857.å¤šä¸ªæ­£å¤šè¾¹å½¢</strong></h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// nå¤šè¾¹å½¢æ•°é‡ k æ­£å¤šè¾¹å½¢</span></span><br><span class="line">    p.<span class="built_in">speed</span>(<span class="number">9</span>);</span><br><span class="line">    <span class="type">int</span> n,k;</span><br><span class="line">    cin &gt;&gt; n &gt;&gt; k;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i++) &#123;</span><br><span class="line">        p.<span class="built_in">fd</span>(<span class="number">100</span>);</span><br><span class="line">        <span class="comment">//å†…è§’å’Œ 180*(k-2) å†…è§’ 180*(k-2) / k</span></span><br><span class="line">        p.<span class="built_in">lt</span>(<span class="number">90.0</span>*(k<span class="number">-2</span>)/k); <span class="comment">//è½¬è§’çš„ä¸€åŠ</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;k;j++)&#123;</span><br><span class="line">            p.<span class="built_in">fd</span>(<span class="number">30</span>).<span class="built_in">rt</span>(<span class="number">360.0</span>/k);</span><br><span class="line">        &#125;</span><br><span class="line">        p.<span class="built_in">rt</span>(<span class="number">90.0</span>*(k<span class="number">-2</span>)/k).<span class="built_in">moveTo</span>(<span class="number">0</span>,<span class="number">0</span>).<span class="built_in">rt</span>(<span class="number">360.0</span>/n);  </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="398-å±±å³°">398.å±±å³°</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> n,a[<span class="number">11</span>];</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line">        cin &gt;&gt; a[i];</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; a[n];</span><br><span class="line">    p.<span class="built_in">moveTo</span>(<span class="number">0</span>,a[<span class="number">0</span>]/<span class="number">2.0</span>).<span class="built_in">r</span>(<span class="number">20</span>,a[<span class="number">0</span>]);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;n;i++)&#123;</span><br><span class="line">        <span class="comment">//å±±å³°ä¸ä¸ºé¦–ä¸ªå’Œæœ€åä¸€ä¸ª</span></span><br><span class="line">        <span class="keyword">if</span>(a[i]&gt;a[i+<span class="number">1</span>] &amp;&amp; a[i]&gt;a[i<span class="number">-1</span>] &amp;&amp; i!=n<span class="number">-1</span>)&#123;</span><br><span class="line">            p.<span class="built_in">moveTo</span>(<span class="number">20</span>*i,a[i]/<span class="number">2.0</span>).<span class="built_in">rr</span>(<span class="number">20</span>,a[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        p.<span class="built_in">moveTo</span>(<span class="number">20</span>*i,a[i]/<span class="number">2.0</span>).<span class="built_in">r</span>(<span class="number">20</span>,a[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="585-æ•°å­—è¡¨ç¤º"><strong>585.æ•°å­—è¡¨ç¤º</strong></h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> n,m;</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    <span class="comment">//è®¡ç®—æ•°å­—é•¿åº¦ m</span></span><br><span class="line">    p.<span class="built_in">lt</span>(<span class="number">90</span>).<span class="built_in">up</span>().<span class="built_in">hide</span>();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i=n; i &gt; <span class="number">0</span>; i = i/ <span class="number">10</span>) &#123;</span><br><span class="line">        m++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;m;i++)&#123;</span><br><span class="line">        p.<span class="built_in">oo</span>(<span class="number">20</span>,n%<span class="number">10</span>).<span class="built_in">fd</span>(<span class="number">40</span>);</span><br><span class="line">        n = n / <span class="number">10</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="394-ç»‡é±¼ç½‘"><strong>394.ç»‡é±¼ç½‘</strong></h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> m,n;</span><br><span class="line">    cin &gt;&gt;m &gt;&gt;n;</span><br><span class="line">    p.<span class="built_in">rt</span>(<span class="number">45</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;m;i++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;<span class="number">2</span>*n;j++)&#123;</span><br><span class="line">            <span class="comment">//1ç”»ä¸Šæ³¢æµª</span></span><br><span class="line">            p. <span class="built_in">fd</span>(<span class="number">50</span>).<span class="built_in">rt</span> (<span class="number">90</span>).<span class="built_in">fd</span>(<span class="number">50</span>).<span class="built_in">lt</span> (<span class="number">90</span>);</span><br><span class="line">            <span class="comment">//æ—‹è½¬ç”»ä¸‹æ³¢æµª</span></span><br><span class="line">            <span class="keyword">if</span>(j==n<span class="number">-1</span>) p.<span class="built_in">rt</span>(<span class="number">180</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//å›åˆ°ç”»æ­£æ–¹å½¢ç»„çš„åˆå§‹ä½ç½®å†æ¬¡å¾ªç¯</span></span><br><span class="line">        p.<span class="built_in">up</span>().<span class="built_in">lt</span>(<span class="number">90</span>).<span class="built_in">fd</span>(<span class="number">50</span>).<span class="built_in">rt</span>(<span class="number">90</span>).<span class="built_in">fd</span>(<span class="number">50</span>).<span class="built_in">lt</span>(<span class="number">180</span>).<span class="built_in">down</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2023å¹´é’ç§‘èµ›çœŸé¢˜">2023å¹´é’ç§‘èµ›çœŸé¢˜</h2><h3 id="2356ä¸¤ä¸ªå…«åˆ†éŸ³ç¬¦">2356ä¸¤ä¸ªå…«åˆ†éŸ³ç¬¦</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    p.<span class="built_in">c</span>(<span class="number">0</span>);</span><br><span class="line">    p.<span class="built_in">oo</span>(<span class="number">20</span>);</span><br><span class="line">    p.<span class="built_in">rt</span>(<span class="number">90</span>).<span class="built_in">fd</span>(<span class="number">20</span>).<span class="built_in">lt</span>(<span class="number">90</span>).<span class="built_in">size</span>(<span class="number">4</span>).<span class="built_in">fd</span>(<span class="number">100</span>);</span><br><span class="line">    p.<span class="built_in">rt</span>(<span class="number">70</span>).<span class="built_in">size</span>(<span class="number">10</span>).<span class="built_in">fd</span>(<span class="number">100</span>).<span class="built_in">rt</span>(<span class="number">110</span>).<span class="built_in">size</span>(<span class="number">4</span>).<span class="built_in">fd</span>(<span class="number">100</span>);</span><br><span class="line">    p.<span class="built_in">rt</span>(<span class="number">90</span>).<span class="built_in">fd</span>(<span class="number">20</span>).<span class="built_in">oo</span>(<span class="number">20</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2357å˜åŒ–çš„æ­£ä¸‰è§’å½¢">2357å˜åŒ–çš„æ­£ä¸‰è§’å½¢</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">5</span>;i++)&#123;</span><br><span class="line">        p.<span class="built_in">lt</span>(<span class="number">30</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;<span class="number">4</span>;j++)&#123;</span><br><span class="line">            p.<span class="built_in">fd</span>(<span class="number">100</span><span class="number">-10</span>*i).<span class="built_in">rt</span>(<span class="number">120</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        p.<span class="built_in">fd</span>(<span class="number">50</span><span class="number">-5</span>*i).<span class="built_in">lt</span>(<span class="number">60</span>+<span class="number">10</span>*i); </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2358å¶æ•°è½¦è¾†å’Œ">2358å¶æ•°è½¦è¾†å’Œ</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> n,a[<span class="number">10</span>],sum;</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line">        cin &gt;&gt; a[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line">        p.<span class="built_in">moveTo</span>(<span class="number">40</span>*i,a[i]/<span class="number">2.0</span>);</span><br><span class="line">        <span class="keyword">if</span>(a[i] % <span class="number">2</span>==<span class="number">0</span>)&#123;</span><br><span class="line">            sum += a[i]*<span class="number">20</span>;</span><br><span class="line">            p.<span class="built_in">rr</span>(<span class="number">20</span>,a[i],<span class="number">1</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            p.<span class="built_in">rr</span>(<span class="number">20</span>,a[i],<span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//çº¢é¢ç§¯ sum</span></span><br><span class="line">    <span class="comment">//é•¿(2*n-1)*20=40n-20</span></span><br><span class="line">    p.<span class="built_in">moveTo</span>(<span class="number">20</span>*n<span class="number">-20</span>,<span class="number">-1</span>*sum/(<span class="number">80</span>*n<span class="number">-40</span>));</span><br><span class="line">    p.<span class="built_in">rr</span>(<span class="number">40</span>*n<span class="number">-20</span>,sum/(<span class="number">40</span>*n<span class="number">-20</span>),<span class="number">3</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2359çŸ©å½¢å¤–æ¡†A">2359çŸ©å½¢å¤–æ¡†A</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">myMax</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(a&gt;b) <span class="keyword">return</span> a;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> a[<span class="number">4</span>],X,Y,max,res;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">4</span>;i++)&#123;</span><br><span class="line">        cin &gt;&gt; a[i];</span><br><span class="line">        <span class="keyword">if</span>(max&lt;a[i]) max=a[i];</span><br><span class="line">    &#125;</span><br><span class="line">    p.<span class="built_in">r</span>(<span class="number">100</span>,<span class="number">100</span>).<span class="built_in">up</span>();</span><br><span class="line">    p.<span class="built_in">moveTo</span>(<span class="number">-50</span>,<span class="number">50</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">4</span>;i++)&#123;</span><br><span class="line">        p.<span class="built_in">rt</span>(<span class="number">90</span>).<span class="built_in">o</span>(a[i]);</span><br><span class="line">        <span class="keyword">if</span>(a[i]==max)&#123;</span><br><span class="line">            X=<span class="built_in">getX</span>();</span><br><span class="line">            Y=<span class="built_in">getY</span>();</span><br><span class="line">            res=i;</span><br><span class="line">        &#125;</span><br><span class="line">        p.<span class="built_in">fd</span>(<span class="number">100</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(a[res]&gt;a[(res+<span class="number">1</span>)%<span class="number">4</span>]+<span class="number">100</span> &amp;&amp; a[res]&gt;a[(res+<span class="number">2</span>)%<span class="number">4</span>]+<span class="number">100</span>&amp;&amp;a[res]&gt;a[(res+<span class="number">3</span>)%<span class="number">4</span>]+<span class="number">100</span>)&#123;<span class="comment">//æœ€å¤§å€¼å¾ˆå¤§</span></span><br><span class="line">        p.<span class="built_in">moveTo</span>(X,Y);</span><br><span class="line">        p.<span class="built_in">r</span>(max*<span class="number">2</span>,max*<span class="number">2</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(a[(res+<span class="number">1</span>)%<span class="number">4</span>]&lt;a[(res+<span class="number">2</span>)%<span class="number">4</span>] &amp;&amp; a[(res+<span class="number">2</span>)%<span class="number">4</span>] &gt; a[(res+<span class="number">3</span>)%<span class="number">4</span>])&#123;<span class="comment">//å¯¹è§’çº¿</span></span><br><span class="line">            cout &lt;&lt; <span class="string">&quot;å¯¹è§’çº¿&quot;</span>;</span><br><span class="line">            p.<span class="built_in">moveTo</span>(X/<span class="built_in">abs</span>(X)*(<span class="number">50</span>+max-(a[res]+a[(res+<span class="number">2</span>)%<span class="number">4</span>]+<span class="number">100</span>)/<span class="number">2.0</span>),Y/<span class="built_in">abs</span>(Y)*(<span class="number">50</span>+max-(a[res]+a[(res+<span class="number">2</span>)%<span class="number">4</span>]+<span class="number">100</span>)/<span class="number">2.0</span>));</span><br><span class="line">            p.<span class="built_in">r</span>((a[res]+a[(res+<span class="number">2</span>)%<span class="number">4</span>]+<span class="number">100</span>),(a[res]+a[(res+<span class="number">2</span>)%<span class="number">4</span>]+<span class="number">100</span>));</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">//é•¿ä¸ºé•¿ çŸ­ä¸ºå®½</span></span><br><span class="line">            <span class="keyword">if</span>((res%<span class="number">2</span>==<span class="number">0</span>&amp;&amp;a[(res+<span class="number">1</span>)%<span class="number">4</span>]&gt;a[(res+<span class="number">2</span>)%<span class="number">4</span>] &amp;&amp; a[(res+<span class="number">1</span>)%<span class="number">4</span>] &gt; a[(res+<span class="number">3</span>)%<span class="number">4</span>])||(res%<span class="number">2</span>==<span class="number">1</span>&amp;&amp;a[(res+<span class="number">3</span>)%<span class="number">4</span>]&gt;a[(res+<span class="number">1</span>)%<span class="number">4</span>] &amp;&amp; a[(res+<span class="number">3</span>)%<span class="number">4</span>] &gt; a[(res+<span class="number">2</span>)%<span class="number">4</span>]))&#123;</span><br><span class="line">                p.<span class="built_in">moveTo</span>(X/<span class="built_in">abs</span>(X)*(<span class="number">50</span>+max-(max+a[(res+<span class="number">1</span>+<span class="number">2</span>*(res%<span class="number">2</span>))%<span class="number">4</span>]+<span class="number">100</span>)/<span class="number">2.0</span>),Y/<span class="built_in">abs</span>(Y)*(<span class="number">50</span>+max-(max+<span class="built_in">myMax</span>(a[(res+<span class="number">2</span>-res%<span class="number">2</span>)%<span class="number">4</span>],a[(res+<span class="number">3</span>-res%<span class="number">2</span>)%<span class="number">4</span>])+<span class="number">100</span>)/<span class="number">2.0</span>));</span><br><span class="line">                p.<span class="built_in">r</span>(max+a[(res+<span class="number">1</span>+<span class="number">2</span>*(res%<span class="number">2</span>))%<span class="number">4</span>]+<span class="number">100</span>,max+<span class="built_in">myMax</span>(a[(res+<span class="number">2</span>-res%<span class="number">2</span>)%<span class="number">4</span>],a[(res+<span class="number">3</span>-res%<span class="number">2</span>)%<span class="number">4</span>])+<span class="number">100</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="comment">//é•¿ä¸ºå®½ çŸ­ä¸ºé•¿</span></span><br><span class="line">                p.<span class="built_in">moveTo</span>(X/<span class="built_in">abs</span>(X)*(<span class="number">50</span>+max-(max+<span class="built_in">myMax</span>(a[(res+<span class="number">1</span>+res%<span class="number">2</span>)%<span class="number">4</span>],a[(res+<span class="number">2</span>+res%<span class="number">2</span>)%<span class="number">4</span>])+<span class="number">100</span>)/<span class="number">2.0</span>),Y/<span class="built_in">abs</span>(Y)*(<span class="number">50</span>+max-(max+a[(res+<span class="number">3</span><span class="number">-2</span>*(res%<span class="number">2</span>))%<span class="number">4</span>]+<span class="number">100</span>)/<span class="number">2.0</span>));</span><br><span class="line">                p.<span class="built_in">r</span>(max+<span class="built_in">myMax</span>(a[(res+<span class="number">1</span>+res%<span class="number">2</span>)%<span class="number">4</span>],a[(res+<span class="number">2</span>+res%<span class="number">2</span>)%<span class="number">4</span>])+<span class="number">100</span>,max+a[(res+<span class="number">3</span><span class="number">-2</span>*(res%<span class="number">2</span>))%<span class="number">4</span>]+<span class="number">100</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2360ç»¿è‰²æ­£ä¸‰è§’å½¢">2360ç»¿è‰²æ­£ä¸‰è§’å½¢</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    p.<span class="built_in">c</span>(<span class="number">10</span>).<span class="built_in">rt</span>(<span class="number">30</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">6</span>;i++) &#123;</span><br><span class="line">        <span class="keyword">if</span>(i==<span class="number">3</span>)&#123;</span><br><span class="line">           p.<span class="built_in">rt</span>(<span class="number">60</span>).<span class="built_in">fd</span>(<span class="number">75</span>).<span class="built_in">lt</span>(<span class="number">120</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        p.<span class="built_in">fd</span>(<span class="number">150</span>).<span class="built_in">rt</span>(<span class="number">120</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2361é»‘è‰²å°è®°">2361é»‘è‰²å°è®°</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    p.<span class="built_in">picU</span>(<span class="number">0</span>).<span class="built_in">up</span>();</span><br><span class="line">    p.<span class="built_in">oo</span>(<span class="number">283</span>,<span class="number">0</span>);</span><br><span class="line">    p.<span class="built_in">rr</span>(<span class="number">400</span>,<span class="number">400</span>,<span class="number">15</span>);</span><br><span class="line">    p.<span class="built_in">rt</span>(<span class="number">45</span>).<span class="built_in">rr</span>(<span class="number">400</span>,<span class="number">400</span>,<span class="number">15</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">8</span>;i++)&#123;</span><br><span class="line">        p.<span class="built_in">fd</span>(<span class="number">150</span>).<span class="built_in">rt</span>(<span class="number">45</span>).<span class="built_in">rr</span>(<span class="number">90</span>,<span class="number">90</span>,<span class="number">0</span>).<span class="built_in">lt</span>(<span class="number">45</span>).<span class="built_in">bk</span>(<span class="number">150</span>);</span><br><span class="line">        p.<span class="built_in">rt</span>(<span class="number">45</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2362æŒ‘é€‰æ—¥æœŸ">2362æŒ‘é€‰æ—¥æœŸ</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    p.<span class="built_in">rt</span>(<span class="number">90</span>).<span class="built_in">up</span>();</span><br><span class="line">    <span class="type">int</span> a[<span class="number">5</span>];</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">5</span>;i++)&#123;</span><br><span class="line">        cin &gt;&gt; a[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">5</span>;i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>((a[i]+<span class="number">1</span>)%<span class="number">7</span>==<span class="number">6</span>)&#123;</span><br><span class="line">            p.<span class="built_in">oo</span>(<span class="number">20</span>,<span class="number">3</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>((a[i]+<span class="number">1</span>)%<span class="number">7</span>==<span class="number">0</span>)&#123;</span><br><span class="line">            p.<span class="built_in">oo</span>(<span class="number">20</span>,<span class="number">4</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            p.<span class="built_in">oo</span>(<span class="number">20</span>,<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        p.<span class="built_in">fd</span>(<span class="number">40</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2363è½¦è¾†ç»Ÿè®¡">2363è½¦è¾†ç»Ÿè®¡</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">double</span> avg,sum=<span class="number">0</span>,n,a[<span class="number">10</span>],max=<span class="number">0</span>;</span><br><span class="line">    p.<span class="built_in">hide</span>().<span class="built_in">speed</span>(<span class="number">9</span>);</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line">        cin &gt;&gt; a[i];</span><br><span class="line">        sum += a[i];</span><br><span class="line">        <span class="keyword">if</span>(max &lt; a[i]) max=a[i];</span><br><span class="line">    &#125;</span><br><span class="line">    avg = sum / n;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line">        p.<span class="built_in">moveTo</span>(<span class="number">20</span>*i,<span class="number">0</span>).<span class="built_in">fd</span>(a[i]);</span><br><span class="line">        <span class="keyword">if</span>(max==a[i]) p.<span class="built_in">up</span>().<span class="built_in">fd</span>(<span class="number">20</span>).<span class="built_in">o</span>(<span class="number">20</span>,<span class="number">1</span>).<span class="built_in">down</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    p.<span class="built_in">moveTo</span>(<span class="number">0</span>,avg).<span class="built_in">rt</span>(<span class="number">90</span>).<span class="built_in">c</span>(<span class="number">1</span>).<span class="built_in">fd</span>(<span class="number">20</span>*n<span class="number">-20</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2364ç»Ÿè®¡æ’æ°´é‡">2364ç»Ÿè®¡æ’æ°´é‡</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">double</span> sum=<span class="number">0</span>,n,a[<span class="number">15</span>],max=<span class="number">0</span>;</span><br><span class="line">    p.<span class="built_in">hide</span>().<span class="built_in">speed</span>(<span class="number">9</span>);</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line">        cin &gt;&gt; a[i];</span><br><span class="line">        <span class="keyword">if</span>(max &lt; a[i]) max=a[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line">        p.<span class="built_in">moveTo</span>(<span class="number">20</span>*i,a[i]/max*<span class="number">150</span>).<span class="built_in">r</span>(<span class="number">20</span>,a[i]/max*<span class="number">300</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2365çŸ©å½¢å¤–æ¡†B">2365çŸ©å½¢å¤–æ¡†B</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">myMax</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(a&gt;b) <span class="keyword">return</span> a;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> a[<span class="number">4</span>],X,Y,max,res;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">4</span>;i++)&#123;</span><br><span class="line">        cin &gt;&gt; a[i];</span><br><span class="line">        <span class="keyword">if</span>(max&lt;a[i]) max=a[i];</span><br><span class="line">    &#125;</span><br><span class="line">    p.<span class="built_in">r</span>(<span class="number">100</span>,<span class="number">100</span>).<span class="built_in">up</span>();</span><br><span class="line">    p.<span class="built_in">moveTo</span>(<span class="number">-50</span>,<span class="number">50</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">4</span>;i++)&#123;</span><br><span class="line">        p.<span class="built_in">rt</span>(<span class="number">90</span>).<span class="built_in">o</span>(a[i]);</span><br><span class="line">        <span class="keyword">if</span>(a[i]==max)&#123;</span><br><span class="line">            X=<span class="built_in">getX</span>();</span><br><span class="line">            Y=<span class="built_in">getY</span>();</span><br><span class="line">            res=i;</span><br><span class="line">        &#125;</span><br><span class="line">        p.<span class="built_in">fd</span>(<span class="number">100</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(a[res]&gt;a[(res+<span class="number">1</span>)%<span class="number">4</span>]+<span class="number">100</span> &amp;&amp; a[res]&gt;a[(res+<span class="number">2</span>)%<span class="number">4</span>]+<span class="number">100</span>&amp;&amp;a[res]&gt;a[(res+<span class="number">3</span>)%<span class="number">4</span>]+<span class="number">100</span>)&#123;<span class="comment">//æœ€å¤§å€¼å¾ˆå¤§</span></span><br><span class="line">        p.<span class="built_in">moveTo</span>(X,Y);</span><br><span class="line">        p.<span class="built_in">r</span>(max*<span class="number">2</span>,max*<span class="number">2</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(a[(res+<span class="number">1</span>)%<span class="number">4</span>]&lt;a[(res+<span class="number">2</span>)%<span class="number">4</span>] &amp;&amp; a[(res+<span class="number">2</span>)%<span class="number">4</span>] &gt; a[(res+<span class="number">3</span>)%<span class="number">4</span>])&#123;<span class="comment">//å¯¹è§’çº¿</span></span><br><span class="line">            p.<span class="built_in">moveTo</span>(X/<span class="built_in">abs</span>(X)*(<span class="number">50</span>+max-(a[res]+a[(res+<span class="number">2</span>)%<span class="number">4</span>]+<span class="number">100</span>)/<span class="number">2.0</span>),Y/<span class="built_in">abs</span>(Y)*(<span class="number">50</span>+max-(a[res]+a[(res+<span class="number">2</span>)%<span class="number">4</span>]+<span class="number">100</span>)/<span class="number">2.0</span>));</span><br><span class="line">            p.<span class="built_in">r</span>((a[res]+a[(res+<span class="number">2</span>)%<span class="number">4</span>]+<span class="number">100</span>),(a[res]+a[(res+<span class="number">2</span>)%<span class="number">4</span>]+<span class="number">100</span>));</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">//é•¿ä¸ºé•¿ çŸ­ä¸ºå®½</span></span><br><span class="line">            <span class="keyword">if</span>((res%<span class="number">2</span>==<span class="number">0</span>&amp;&amp;a[(res+<span class="number">1</span>)%<span class="number">4</span>]&gt;a[(res+<span class="number">2</span>)%<span class="number">4</span>] &amp;&amp; a[(res+<span class="number">1</span>)%<span class="number">4</span>] &gt; a[(res+<span class="number">3</span>)%<span class="number">4</span>])||(res%<span class="number">2</span>==<span class="number">1</span>&amp;&amp;a[(res+<span class="number">3</span>)%<span class="number">4</span>]&gt;a[(res+<span class="number">1</span>)%<span class="number">4</span>] &amp;&amp; a[(res+<span class="number">3</span>)%<span class="number">4</span>] &gt; a[(res+<span class="number">2</span>)%<span class="number">4</span>]))&#123;</span><br><span class="line">                p.<span class="built_in">moveTo</span>(X/<span class="built_in">abs</span>(X)*(<span class="number">50</span>+max-(max+a[(res+<span class="number">1</span>+<span class="number">2</span>*(res%<span class="number">2</span>))%<span class="number">4</span>]+<span class="number">100</span>)/<span class="number">2.0</span>),Y/<span class="built_in">abs</span>(Y)*(<span class="number">50</span>+max-(max+<span class="built_in">myMax</span>(a[(res+<span class="number">2</span>-res%<span class="number">2</span>)%<span class="number">4</span>],a[(res+<span class="number">3</span>-res%<span class="number">2</span>)%<span class="number">4</span>])+<span class="number">100</span>)/<span class="number">2.0</span>));</span><br><span class="line">                p.<span class="built_in">r</span>(max+a[(res+<span class="number">1</span>+<span class="number">2</span>*(res%<span class="number">2</span>))%<span class="number">4</span>]+<span class="number">100</span>,max+<span class="built_in">myMax</span>(a[(res+<span class="number">2</span>-res%<span class="number">2</span>)%<span class="number">4</span>],a[(res+<span class="number">3</span>-res%<span class="number">2</span>)%<span class="number">4</span>])+<span class="number">100</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="comment">//é•¿ä¸ºå®½ çŸ­ä¸ºé•¿</span></span><br><span class="line">                p.<span class="built_in">moveTo</span>(X/<span class="built_in">abs</span>(X)*(<span class="number">50</span>+max-(max+<span class="built_in">myMax</span>(a[(res+<span class="number">1</span>+res%<span class="number">2</span>)%<span class="number">4</span>],a[(res+<span class="number">2</span>+res%<span class="number">2</span>)%<span class="number">4</span>])+<span class="number">100</span>)/<span class="number">2.0</span>),Y/<span class="built_in">abs</span>(Y)*(<span class="number">50</span>+max-(max+a[(res+<span class="number">3</span><span class="number">-2</span>*(res%<span class="number">2</span>))%<span class="number">4</span>]+<span class="number">100</span>)/<span class="number">2.0</span>));</span><br><span class="line">                p.<span class="built_in">r</span>(max+<span class="built_in">myMax</span>(a[(res+<span class="number">1</span>+res%<span class="number">2</span>)%<span class="number">4</span>],a[(res+<span class="number">2</span>+res%<span class="number">2</span>)%<span class="number">4</span>])+<span class="number">100</span>,max+a[(res+<span class="number">3</span><span class="number">-2</span>*(res%<span class="number">2</span>))%<span class="number">4</span>]+<span class="number">100</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2366å½©è‰²èŠ±æœµ">2366å½©è‰²èŠ±æœµ</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    p.<span class="built_in">picU</span>(<span class="number">0</span>); <span class="comment">//å¼€å¯å›¾å½¢æŒ‰ç…§ç¬”æ–¹å‘ç”»</span></span><br><span class="line">    p.<span class="built_in">up</span>();</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">9</span>;i++)&#123;</span><br><span class="line">        p.<span class="built_in">fd</span>(<span class="number">130</span>).<span class="built_in">ee</span>(<span class="number">20</span>,<span class="number">100</span>,<span class="number">13</span>).<span class="built_in">bk</span>(<span class="number">130</span>).<span class="built_in">rt</span>(<span class="number">40</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    p.<span class="built_in">rt</span>(<span class="number">20</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">9</span>;i++)&#123;</span><br><span class="line">        p.<span class="built_in">fd</span>(<span class="number">110</span>).<span class="built_in">ee</span>(<span class="number">30</span>,<span class="number">80</span>,<span class="number">14</span>).<span class="built_in">bk</span>(<span class="number">110</span>).<span class="built_in">rt</span>(<span class="number">40</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2367å˜åŒ–çš„æ­£æ–¹å½¢">2367å˜åŒ–çš„æ­£æ–¹å½¢</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line">        p.<span class="built_in">c</span>(i);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;<span class="number">6</span>;j++)&#123;</span><br><span class="line">            p.<span class="built_in">fd</span>(<span class="number">200</span><span class="number">-20</span>*i).<span class="built_in">lt</span>(<span class="number">90</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2368å½©è‰²å›¾å½¢">2368å½©è‰²å›¾å½¢</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    p.<span class="built_in">moveTo</span>(<span class="number">-300</span>,<span class="number">300</span>).<span class="built_in">up</span>().<span class="built_in">hide</span>().<span class="built_in">rt</span>(<span class="number">90</span>);</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=i;j&lt;n+i;j++)&#123; <span class="comment">// 4 5 6 7 8</span></span><br><span class="line">            <span class="keyword">if</span>(j&gt;n<span class="number">-1</span>)&#123;</span><br><span class="line">                p.<span class="built_in">oo</span>(<span class="number">20</span>,(j<span class="number">-1</span>)%(n<span class="number">-1</span>));</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                p.<span class="built_in">oo</span>(<span class="number">20</span>,j);</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">            p.<span class="built_in">fd</span>(<span class="number">40</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        p.<span class="built_in">moveTo</span>(<span class="number">-300</span>,<span class="number">260</span><span class="number">-40</span>*i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2369è…¾å›¾">2369è…¾å›¾</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    p.<span class="built_in">c</span>(<span class="number">12</span>).<span class="built_in">speed</span>(<span class="number">9</span>).<span class="built_in">hide</span>();</span><br><span class="line">    <span class="type">int</span> n,a,b,o;</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">6</span>;i++)&#123;</span><br><span class="line">        p.<span class="built_in">fd</span>(n).<span class="built_in">rt</span>(<span class="number">60</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    p.<span class="built_in">rt</span>(<span class="number">90</span>);</span><br><span class="line">    a = <span class="number">2</span>*<span class="built_in">sqrt</span>(n*n-(n/<span class="number">2.0</span>)*(n/<span class="number">2.0</span>));</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">3</span>;i++)&#123;</span><br><span class="line">        p.<span class="built_in">fd</span>(a).<span class="built_in">lt</span>(<span class="number">120</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    b = a /<span class="number">2.0</span>;</span><br><span class="line">    p.<span class="built_in">fd</span>(b).<span class="built_in">lt</span>(<span class="number">60</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">3</span>;i++)&#123;</span><br><span class="line">        p.<span class="built_in">fd</span>(b).<span class="built_in">rt</span>(<span class="number">30</span>).<span class="built_in">fd</span>(n/<span class="number">2.0</span>).<span class="built_in">bk</span>(n/<span class="number">2.0</span>).<span class="built_in">lt</span>(<span class="number">150</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    o = b/<span class="number">2.0</span>/<span class="built_in">sqrt</span>(<span class="number">3</span>);</span><br><span class="line">    p.<span class="built_in">up</span>().<span class="built_in">fd</span>(b/<span class="number">2.0</span>).<span class="built_in">lt</span>(<span class="number">90</span>).<span class="built_in">fd</span>(o).<span class="built_in">o</span>(o);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2370å˜åŒ–çš„ç«‹æ–¹ä½“">2370å˜åŒ–çš„ç«‹æ–¹ä½“</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å‡½æ•°ï¼šè®¡ç®—ä¸¤ä¸ªæ•°çš„æœ€å¤§å…¬çº¦æ•°</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">gcd</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (b != <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="type">int</span> temp = a % b;</span><br><span class="line">        a = b;</span><br><span class="line">        b = temp;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> a;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‡½æ•°ï¼šè®¡ç®—ä¸‰ä¸ªæ•°çš„æœ€å¤§å…¬çº¦æ•°</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">gcdOfThree</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b, <span class="type">int</span> c)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// å…ˆè®¡ç®—å‰ä¸¤ä¸ªæ•°çš„GCD</span></span><br><span class="line">    <span class="type">int</span> gcdAB = <span class="built_in">gcd</span>(a, b);</span><br><span class="line">    <span class="comment">// å†ç”¨è¿™ä¸ªç»“æœä¸ç¬¬ä¸‰ä¸ªæ•°è®¡ç®—GCD</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">gcd</span>(gcdAB, c);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> a[<span class="number">3</span>],b;</span><br><span class="line">    p.<span class="built_in">speed</span>(<span class="number">6</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">3</span>;i++)&#123;</span><br><span class="line">        cin &gt;&gt; a[i];</span><br><span class="line">    &#125;</span><br><span class="line">    b=<span class="built_in">gcdOfThree</span>(a[<span class="number">0</span>],a[<span class="number">1</span>],a[<span class="number">2</span>]);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;=a[<span class="number">0</span>]/b;i++)&#123;</span><br><span class="line">        p.<span class="built_in">moveTo</span>(-b*i,-a[<span class="number">2</span>]);</span><br><span class="line">        p.<span class="built_in">fd</span>(a[<span class="number">2</span>]).<span class="built_in">rt</span>(<span class="number">45</span>).<span class="built_in">fd</span>(a[<span class="number">1</span>]).<span class="built_in">lt</span>(<span class="number">45</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    p.<span class="built_in">rt</span>(<span class="number">90</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;=a[<span class="number">1</span>]/b;i++)&#123;</span><br><span class="line">        p.<span class="built_in">fd</span>(a[<span class="number">0</span>]).<span class="built_in">rt</span>(<span class="number">90</span>).<span class="built_in">fd</span>(a[<span class="number">2</span>]);</span><br><span class="line">        p.<span class="built_in">up</span>().<span class="built_in">bk</span>(a[<span class="number">2</span>]).<span class="built_in">rt</span>(<span class="number">90</span>).<span class="built_in">fd</span>(a[<span class="number">0</span>]).<span class="built_in">lt</span>(<span class="number">45</span>).<span class="built_in">fd</span>(b).<span class="built_in">lt</span>(<span class="number">135</span>).<span class="built_in">down</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;a[<span class="number">2</span>]/b;i++)&#123;</span><br><span class="line">        p.<span class="built_in">moveTo</span>(-a[<span class="number">0</span>],-b*i-b);</span><br><span class="line">        p.<span class="built_in">fd</span>(a[<span class="number">0</span>]).<span class="built_in">lt</span>(<span class="number">45</span>).<span class="built_in">fd</span>(a[<span class="number">1</span>]).<span class="built_in">rt</span>(<span class="number">45</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2371çŸ©å½¢å¤–æ¡†C">2371çŸ©å½¢å¤–æ¡†C</h3><h2 id="å†å²è®­ç»ƒé¢˜">å†å²è®­ç»ƒé¢˜</h2><h3 id="32979å‹¾è‚¡å®šç†">32979å‹¾è‚¡å®šç†</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> a,b;</span><br><span class="line">    <span class="type">double</span> c;</span><br><span class="line">    cin&gt;&gt;a&gt;&gt;b;</span><br><span class="line">    c = a*a+b*b;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=<span class="number">4</span>;i++)&#123;</span><br><span class="line">        p.<span class="built_in">fd</span>(a).<span class="built_in">lt</span>(<span class="number">90</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    p.<span class="built_in">rt</span>(<span class="number">90</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=<span class="number">4</span>;i++)&#123;</span><br><span class="line">        p.<span class="built_in">fd</span>(b).<span class="built_in">rt</span>(<span class="number">90</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//åˆ¤æ–­Cæ˜¯å¦ä¸ºæ­£æ•´æ•°</span></span><br><span class="line">    <span class="type">int</span> res =<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=<span class="number">150</span>;i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(c/i==i) res=<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(res==<span class="number">1</span>)&#123;</span><br><span class="line">        p.<span class="built_in">fd</span>(b).<span class="built_in">lineTo</span>(<span class="number">0</span>,a).<span class="built_in">lineTo</span>(a,a+b).<span class="built_in">lineTo</span>(a+b,b).<span class="built_in">lineTo</span>(b,<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5815æœ€å¤šè¾¹çš„å¤šè¾¹å½¢">5815æœ€å¤šè¾¹çš„å¤šè¾¹å½¢</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> in[<span class="number">100</span>],n;</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line">        cin &gt;&gt; in[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> index =<span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> index2 = <span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> num = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> count = <span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> countTemp = <span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> temp=in[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">while</span> (index&lt;n<span class="number">-1</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span> ((in[index] != num &amp;&amp; ((in[index2] != temp &amp;&amp; in[index] != temp) || index==<span class="number">0</span>)) || index2==n<span class="number">-1</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span> (in[index] == in[index2])&#123;</span><br><span class="line">                <span class="keyword">if</span>(index!=<span class="number">0</span>) in[index2] = temp;</span><br><span class="line">                countTemp++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (index2==n<span class="number">-1</span>)&#123;</span><br><span class="line">                <span class="keyword">if</span> (count &lt; countTemp)&#123;</span><br><span class="line">                    count = countTemp;</span><br><span class="line">                    num=in[index];</span><br><span class="line">                &#125;</span><br><span class="line">                index++;</span><br><span class="line">                index2 = index +<span class="number">1</span>;</span><br><span class="line">                countTemp = <span class="number">1</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                index2++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (in[index] == temp)&#123;</span><br><span class="line">                index++;</span><br><span class="line">                index2 = index + <span class="number">1</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                index2++;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;count;i++)&#123;</span><br><span class="line">        p.<span class="built_in">fd</span>(num).<span class="built_in">rt</span>(<span class="number">360.0</span>/count);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="21815æ­£å¤šè¾¹å½¢">21815æ­£å¤šè¾¹å½¢</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(i%<span class="number">2</span>==<span class="number">0</span>)&#123;</span><br><span class="line">           p.<span class="built_in">fd</span>(<span class="number">50</span>).<span class="built_in">lt</span>(<span class="number">120</span>);</span><br><span class="line">           p.<span class="built_in">fd</span>(<span class="number">50</span>).<span class="built_in">lt</span>(<span class="number">120</span>);</span><br><span class="line">           p.<span class="built_in">fd</span>(<span class="number">50</span>).<span class="built_in">lt</span>(<span class="number">120</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">           p.<span class="built_in">fd</span>(<span class="number">50</span>).<span class="built_in">lt</span>(<span class="number">90</span>);</span><br><span class="line">           p.<span class="built_in">fd</span>(<span class="number">50</span>).<span class="built_in">lt</span>(<span class="number">90</span>);</span><br><span class="line">           p.<span class="built_in">fd</span>(<span class="number">50</span>).<span class="built_in">lt</span>(<span class="number">90</span>);</span><br><span class="line">           p.<span class="built_in">fd</span>(<span class="number">50</span>).<span class="built_in">lt</span>(<span class="number">90</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        p.<span class="built_in">fd</span>(<span class="number">50</span>).<span class="built_in">rt</span>(<span class="number">360.0</span>/n);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="391èºæ—‹çº¿">391èºæ—‹çº¿</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    p.<span class="built_in">oo</span>(<span class="number">5</span>,<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;i+<span class="number">1</span>;j++)&#123;</span><br><span class="line">           p.<span class="built_in">fd</span>(<span class="number">20</span>).<span class="built_in">oo</span>(<span class="number">5</span>,<span class="number">1</span>); </span><br><span class="line">        &#125; </span><br><span class="line">        p.<span class="built_in">rt</span>(<span class="number">90</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="114è½®å»“">114è½®å»“</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> a[<span class="number">10</span>];</span><br><span class="line">    p.<span class="built_in">speed</span>(<span class="number">5</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">10</span>;i++)&#123;</span><br><span class="line">        cin &gt;&gt; a[i];</span><br><span class="line">    &#125; </span><br><span class="line">    p.<span class="built_in">fd</span>(a[<span class="number">0</span>]).<span class="built_in">rt</span>(<span class="number">90</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">9</span>;i++)&#123;</span><br><span class="line">        p.<span class="built_in">fd</span>(<span class="number">20</span>);</span><br><span class="line">        p.<span class="built_in">lt</span>(<span class="number">90</span>).<span class="built_in">fd</span>(a[i+<span class="number">1</span>]-a[i]).<span class="built_in">rt</span>(<span class="number">90</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    p.<span class="built_in">fd</span>(<span class="number">20</span>).<span class="built_in">rt</span>(<span class="number">90</span>).<span class="built_in">fd</span>(a[<span class="number">9</span>]);</span><br><span class="line">    p.<span class="built_in">rt</span>(<span class="number">90</span>).<span class="built_in">fd</span>(<span class="number">200</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="20860æŠ˜çº¿å›¾">20860æŠ˜çº¿å›¾</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> a[<span class="number">40</span>],n;</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line">        cin &gt;&gt; a[i];</span><br><span class="line">    &#125;</span><br><span class="line">    p.<span class="built_in">moveTo</span>(<span class="number">0</span>,a[<span class="number">0</span>]).<span class="built_in">oo</span>(<span class="number">5</span>,<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;n;i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(a[i]&lt;a[i<span class="number">-1</span>])&#123;</span><br><span class="line">            p.<span class="built_in">c</span>(<span class="number">3</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            p.<span class="built_in">c</span>(<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        p.<span class="built_in">lineTo</span>(<span class="number">20</span>*i,a[i]).<span class="built_in">oo</span>(<span class="number">5</span>,<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    p.<span class="built_in">moveTo</span>(<span class="number">0</span>,a[<span class="number">0</span>]).<span class="built_in">oo</span>(<span class="number">5</span>,<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;n;i++)&#123;</span><br><span class="line">        p.<span class="built_in">moveTo</span>(<span class="number">20</span>*i,a[i]).<span class="built_in">oo</span>(<span class="number">5</span>,<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="151å·§å…‹åŠ›ç”œåº¦">151å·§å…‹åŠ›ç”œåº¦</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> n,s,a[<span class="number">100</span>];</span><br><span class="line">    cin &gt;&gt; n &gt;&gt; s;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line">        cin &gt;&gt; a[i];</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n<span class="number">-1</span>; i++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; n-i<span class="number">-1</span>; j++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (a[j] &gt; a[j+<span class="number">1</span>])</span><br><span class="line">&#123;</span><br><span class="line"><span class="type">int</span> temp = a[j];</span><br><span class="line">                a[j] = a[j+<span class="number">1</span>];</span><br><span class="line">                a[j+<span class="number">1</span>] = temp;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">    <span class="type">int</span> i=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(s-a[i]&gt;=<span class="number">0</span>)&#123;</span><br><span class="line">        s-= a[i];</span><br><span class="line">        i++;</span><br><span class="line">    &#125;</span><br><span class="line">    p.<span class="built_in">rr</span>(i*<span class="number">5</span>,i*<span class="number">5</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><h3 id="178é è¿‘">178é è¿‘</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">myMax</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(a&gt;b) <span class="keyword">return</span> a;</span><br><span class="line">    <span class="keyword">return</span> b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">myMin</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(a&lt;b) <span class="keyword">return</span> a;</span><br><span class="line">    <span class="keyword">return</span> b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    p.<span class="built_in">up</span>().<span class="built_in">hide</span>();</span><br><span class="line">    <span class="type">int</span> a,b,c,d;</span><br><span class="line">    cin &gt;&gt; a&gt;&gt;b&gt;&gt;c&gt;&gt;d;</span><br><span class="line">    p.<span class="built_in">fd</span>(b/<span class="number">2.0</span>).<span class="built_in">rr</span>(b,b,<span class="number">0</span>);<span class="comment">//é»‘</span></span><br><span class="line">    p.<span class="built_in">fd</span>(b/<span class="number">2.0</span>+a/<span class="number">2.0</span>).<span class="built_in">rr</span>(a,a,<span class="number">1</span>);<span class="comment">//çº¢</span></span><br><span class="line">    p.<span class="built_in">moveTo</span>(<span class="number">0</span>,<span class="number">0</span>).<span class="built_in">rt</span>(<span class="number">90</span>);</span><br><span class="line">    <span class="comment">//1.ç´«å’Œç»¿ç›¸åŠ å°äºé»‘</span></span><br><span class="line">    <span class="keyword">if</span>(c+d&lt;=b)&#123;</span><br><span class="line">        p.<span class="built_in">fd</span>(b/<span class="number">2.0</span>+<span class="built_in">myMax</span>(c,d)/<span class="number">2.0</span>).<span class="built_in">lt</span>(<span class="number">90</span>);</span><br><span class="line">        <span class="comment">//ç”»ç»¿</span></span><br><span class="line">        p.<span class="built_in">fd</span>(d/<span class="number">2.0</span>).<span class="built_in">rr</span>(d,d,<span class="number">10</span>);</span><br><span class="line">        <span class="comment">//ç”»ç´«</span></span><br><span class="line">        p.<span class="built_in">fd</span>(c/<span class="number">2.0</span>+d/<span class="number">2.0</span>).<span class="built_in">rr</span>(c,c,<span class="number">11</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="comment">//é»‘è‰²å°äºç»¿è‰²</span></span><br><span class="line">        <span class="keyword">if</span>(b&lt;=d &amp;&amp; c&lt;=d || b&lt;a &amp;&amp; d&lt;c)&#123;</span><br><span class="line">            p.<span class="built_in">fd</span>(<span class="built_in">myMax</span>(c,d)/<span class="number">2.0</span>+<span class="built_in">myMax</span>(a,b)/<span class="number">2.0</span>).<span class="built_in">lt</span>(<span class="number">90</span>);</span><br><span class="line">            p.<span class="built_in">fd</span>(d/<span class="number">2.0</span>).<span class="built_in">rr</span>(d,d,<span class="number">10</span>);</span><br><span class="line">            p.<span class="built_in">fd</span>(c/<span class="number">2.0</span>+d/<span class="number">2.0</span>).<span class="built_in">rr</span>(c,c,<span class="number">11</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(b&lt;=d &amp;&amp; c&gt;d)&#123;</span><br><span class="line">            p.<span class="built_in">fd</span>(c/<span class="number">2.0</span>+<span class="built_in">myMin</span>(a,b)/<span class="number">2.0</span>).<span class="built_in">lt</span>(<span class="number">90</span>);</span><br><span class="line">            p.<span class="built_in">fd</span>(d/<span class="number">2.0</span>).<span class="built_in">rr</span>(d,d,<span class="number">10</span>);</span><br><span class="line">            p.<span class="built_in">fd</span>(c/<span class="number">2.0</span>+d/<span class="number">2.0</span>).<span class="built_in">rr</span>(c,c,<span class="number">11</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            p.<span class="built_in">fd</span>(<span class="built_in">myMin</span>(c,d)/<span class="number">2.0</span>+<span class="built_in">myMax</span>(a,b)/<span class="number">2.0</span>).<span class="built_in">lt</span>(<span class="number">90</span>);</span><br><span class="line">            p.<span class="built_in">fd</span>(d/<span class="number">2.0</span>).<span class="built_in">rr</span>(d,d,<span class="number">10</span>);</span><br><span class="line">            p.<span class="built_in">fd</span>(c/<span class="number">2.0</span>+d/<span class="number">2.0</span>).<span class="built_in">rr</span>(c,c,<span class="number">11</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="631å¯»å®æ¸¸æˆ">631å¯»å®æ¸¸æˆ</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> n,m,a[<span class="number">100</span>];</span><br><span class="line">    cin &gt;&gt; n&gt;&gt;m;</span><br><span class="line">    <span class="type">int</span> cc=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">        a[cc]=<span class="number">1</span>;</span><br><span class="line">        cc = cc+ m+<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(cc&gt;n) cc=cc%n;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">        p.<span class="built_in">up</span>().<span class="built_in">fd</span>(<span class="number">200</span>);</span><br><span class="line">        <span class="keyword">if</span>(a[i]==<span class="number">1</span>)&#123;</span><br><span class="line">            p.<span class="built_in">oo</span>(<span class="number">30</span>,<span class="number">1</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            p.<span class="built_in">o</span>(<span class="number">30</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        p.<span class="built_in">bk</span>(<span class="number">200</span>).<span class="built_in">rt</span>(<span class="number">360.0</span>/n);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="527åèˆ¹">527åèˆ¹</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> n,w,s=<span class="number">0</span>,t=<span class="number">0</span>,a[<span class="number">50</span>];</span><br><span class="line">    cin&gt;&gt;n&gt;&gt;w;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line">        cin&gt;&gt;a[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>((s+a[i])&lt;=w)&#123;</span><br><span class="line">            s+=a[i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            p.<span class="built_in">moveTo</span>(s/<span class="number">2.0</span>,t*<span class="number">-40</span>).<span class="built_in">rr</span>(s,<span class="number">20</span>);</span><br><span class="line">            t++;</span><br><span class="line">            s=<span class="number">0</span>;</span><br><span class="line">            s+=a[i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    p.<span class="built_in">moveTo</span>(s/<span class="number">2.0</span>,t*<span class="number">-40</span>).<span class="built_in">rr</span>(s,<span class="number">20</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>565é£è¶Šå¤ªç©ºå±±</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> n,a[<span class="number">100</span>];</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line">        cin &gt;&gt; a[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> count=<span class="number">1</span>;<span class="comment">//æ»¡åä¸ºä¸€è¶Ÿ</span></span><br><span class="line">    <span class="type">int</span> people=<span class="number">0</span>; <span class="comment">//æ»¡åæ¸…0</span></span><br><span class="line">    <span class="comment">//7 20 18 15 14 5 30 21 25 10 50 25 26 </span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(a[i]&gt;=<span class="number">10</span>*count)&#123;</span><br><span class="line">            people++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(people==<span class="number">10</span>)&#123;</span><br><span class="line">            people=<span class="number">0</span>;</span><br><span class="line">            count++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; people;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">10</span>;i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(i%<span class="number">2</span>==<span class="number">0</span>)&#123;</span><br><span class="line">            p.<span class="built_in">moveTo</span>(<span class="number">-50</span>*(i/<span class="number">2</span>),<span class="number">0</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            p.<span class="built_in">moveTo</span>(<span class="number">-50</span>*((i<span class="number">-1</span>)/<span class="number">2</span>),<span class="number">-50</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(i==people)&#123;</span><br><span class="line">            p.<span class="built_in">oo</span>(<span class="number">20</span>,<span class="number">1</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            p.<span class="built_in">o</span>(<span class="number">20</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        p.<span class="built_in">r</span>(<span class="number">50</span>,<span class="number">50</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="399æ°´æ¯">399æ°´æ¯</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> a,b,c;</span><br><span class="line">    cin &gt;&gt; a&gt;&gt;b&gt;&gt;c;</span><br><span class="line">    p.<span class="built_in">moveTo</span>(<span class="number">0</span>,a/<span class="number">2.0</span>).<span class="built_in">r</span>(<span class="number">50</span>,a,<span class="number">1</span>);</span><br><span class="line">    p.<span class="built_in">moveTo</span>(<span class="number">60</span>,b/<span class="number">2.0</span>).<span class="built_in">r</span>(<span class="number">50</span>,b,<span class="number">3</span>);</span><br><span class="line">    p.<span class="built_in">moveTo</span>(<span class="number">120</span>,c/<span class="number">2.0</span>).<span class="built_in">r</span>(<span class="number">50</span>,c,<span class="number">4</span>);</span><br><span class="line">    a -= b; <span class="comment">//çº¢è‰²æ°´å‡ç»¿è‰²æ°´</span></span><br><span class="line">    <span class="keyword">if</span>(a&gt;<span class="number">0</span>)&#123;<span class="comment">//çº¢è‰²æ°´æ¯”ç»¿è‰²å¤š å‰©ä¸‹çš„ç»™è“è‰²</span></span><br><span class="line">        p.<span class="built_in">moveTo</span>(<span class="number">60</span>,b/<span class="number">2.0</span>).<span class="built_in">rr</span>(<span class="number">50</span>,b,<span class="number">3</span>);</span><br><span class="line">        <span class="comment">//çº¢è‰²æ¯”ç»¿è‰²åŠ è“è‰²éƒ½å¤š</span></span><br><span class="line">        <span class="keyword">if</span>(a&gt;c)&#123;</span><br><span class="line">            p.<span class="built_in">moveTo</span>(<span class="number">120</span>,c/<span class="number">2.0</span>).<span class="built_in">rr</span>(<span class="number">50</span>,c,<span class="number">4</span>);</span><br><span class="line">            a-=c;</span><br><span class="line">            p.<span class="built_in">moveTo</span>(<span class="number">0</span>,a/<span class="number">2.0</span>).<span class="built_in">rr</span>(<span class="number">50</span>,a,<span class="number">1</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">//å‰©ä¸‹çš„ç»™è“è‰²åˆšå¥½å¤Ÿ</span></span><br><span class="line">            p.<span class="built_in">moveTo</span>(<span class="number">120</span>,a/<span class="number">2.0</span>).<span class="built_in">rr</span>(<span class="number">50</span>,a,<span class="number">4</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="comment">//çº¢è‰²æ¯”ç»¿è‰²å°‘ï¼Œæ‰€æœ‰çš„éƒ½ç»™ç»¿è‰²</span></span><br><span class="line">       p.<span class="built_in">moveTo</span>(<span class="number">60</span>,(a+b)/<span class="number">2.0</span>).<span class="built_in">rr</span>(<span class="number">50</span>,a+b,<span class="number">3</span>); </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="386å±±æ´">386å±±æ´</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> n,a[<span class="number">100</span>],t=<span class="number">1</span>;</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">        a[i]=<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    a[<span class="number">1</span>]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>;i&lt;=<span class="number">51</span>;i++)&#123;</span><br><span class="line">        <span class="keyword">while</span>(t&gt;=n)&#123;</span><br><span class="line">            t%=n;</span><br><span class="line">        &#125;</span><br><span class="line">        t+=i;</span><br><span class="line">        a[t]=<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(a[i]==<span class="number">0</span>) p.<span class="built_in">down</span>().<span class="built_in">fd</span>(<span class="number">100</span>).<span class="built_in">up</span>().<span class="built_in">fd</span>(<span class="number">20</span>).<span class="built_in">oo</span>(<span class="number">20</span>,i).<span class="built_in">bk</span>(<span class="number">120</span>).<span class="built_in">rt</span>(<span class="number">360.0</span>/n);</span><br><span class="line">        <span class="keyword">else</span> p.<span class="built_in">down</span>().<span class="built_in">fd</span>(<span class="number">100</span>).<span class="built_in">up</span>().<span class="built_in">fd</span>(<span class="number">20</span>).<span class="built_in">o</span>(<span class="number">20</span>,i).<span class="built_in">bk</span>(<span class="number">120</span>).<span class="built_in">rt</span>(<span class="number">360.0</span>/n);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="185ç –å¤´">185ç –å¤´</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    <span class="keyword">if</span>(n&lt;<span class="number">90</span>)&#123;</span><br><span class="line">        p.<span class="built_in">rt</span>(<span class="number">90</span>).<span class="built_in">fd</span>(<span class="number">100</span>);    </span><br><span class="line">        p.<span class="built_in">rt</span>(<span class="number">90</span>).<span class="built_in">fd</span>(<span class="number">100</span>);</span><br><span class="line">        p.<span class="built_in">rt</span>(<span class="number">90</span>).<span class="built_in">fd</span>(<span class="number">100</span>);</span><br><span class="line">        p.<span class="built_in">rt</span>(<span class="number">90</span>).<span class="built_in">fd</span>(<span class="number">100</span>);</span><br><span class="line">        p.<span class="built_in">rt</span>(<span class="number">90</span>-n).<span class="built_in">fd</span>(<span class="number">100</span>);</span><br><span class="line">        p.<span class="built_in">rt</span>(n).<span class="built_in">fd</span>(<span class="number">100</span>);</span><br><span class="line">        p.<span class="built_in">rt</span>(<span class="number">180</span>-n).<span class="built_in">fd</span>(<span class="number">100</span>);</span><br><span class="line">        p.<span class="built_in">lt</span>(<span class="number">90</span>-n).<span class="built_in">fd</span>(<span class="number">100</span>);</span><br><span class="line">        p.<span class="built_in">rt</span>(<span class="number">90</span>-n).<span class="built_in">bk</span>(<span class="number">100</span>);</span><br><span class="line">        p.<span class="built_in">lt</span>(<span class="number">90</span>-n).<span class="built_in">bk</span>(<span class="number">100</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        p.<span class="built_in">lt</span>(<span class="number">90</span>).<span class="built_in">fd</span>(<span class="number">100</span>);    </span><br><span class="line">        p.<span class="built_in">lt</span>(<span class="number">90</span>).<span class="built_in">fd</span>(<span class="number">100</span>);</span><br><span class="line">        p.<span class="built_in">lt</span>(<span class="number">90</span>).<span class="built_in">fd</span>(<span class="number">100</span>);</span><br><span class="line">        p.<span class="built_in">lt</span>(<span class="number">90</span>).<span class="built_in">fd</span>(<span class="number">100</span>);</span><br><span class="line">        p.<span class="built_in">rt</span>(<span class="number">90</span>-n).<span class="built_in">fd</span>(<span class="number">100</span>);</span><br><span class="line">        p.<span class="built_in">lt</span>(<span class="number">180</span>-n).<span class="built_in">fd</span>(<span class="number">100</span>);</span><br><span class="line">        p.<span class="built_in">rt</span>(<span class="number">180</span>-n).<span class="built_in">bk</span>(<span class="number">100</span>);</span><br><span class="line">        p.<span class="built_in">lt</span>(<span class="number">90</span>-n).<span class="built_in">bk</span>(<span class="number">100</span>);</span><br><span class="line">        p.<span class="built_in">rt</span>(<span class="number">90</span>-n).<span class="built_in">fd</span>(<span class="number">100</span>);</span><br><span class="line">        p.<span class="built_in">lt</span>(<span class="number">90</span>-n).<span class="built_in">fd</span>(<span class="number">100</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="115åŒå¿ƒåœ†">115åŒå¿ƒåœ†</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> a[<span class="number">10</span>],max;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">10</span>;i++)&#123;</span><br><span class="line">        cin &gt;&gt; a[i];</span><br><span class="line">        <span class="keyword">if</span>(max&lt;a[i]) max=a[i];</span><br><span class="line">    &#125;</span><br><span class="line">    p.<span class="built_in">oo</span>(max,<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">10</span>;i++)&#123;</span><br><span class="line">        p.<span class="built_in">o</span>(a[i],<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="116æ‰‹æœºå·ç ">116æ‰‹æœºå·ç </h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> N,S,T;</span><br><span class="line">    cin &gt;&gt; N &gt;&gt; S&gt;&gt;T;</span><br><span class="line">    string a=<span class="string">&quot;13300303003&quot;</span>;</span><br><span class="line">    <span class="type">int</span> x = (T/<span class="number">11</span>-S/<span class="number">11</span><span class="number">-1</span>)*<span class="number">5</span>;</span><br><span class="line">    <span class="comment">//èµ·å§‹å€¼ä¸è¢«åä¸€æ•´é™¤</span></span><br><span class="line">    <span class="keyword">if</span>(S%<span class="number">11</span>==<span class="number">0</span>)&#123;</span><br><span class="line">        x++;</span><br><span class="line">        x+=<span class="number">5</span>;<span class="comment">//ä¸­é—´é‡å¤å·ç ä¼šå°‘1</span></span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="comment">//èµ·å§‹å€¼æœ€è¿‘çš„11å€æ•°å¤´åˆ°å°¾</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = S%<span class="number">11</span><span class="number">-1</span>; i &lt;<span class="number">11</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (a[i] == <span class="string">&#x27;3&#x27;</span>) x++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//ç»“å°¾å€¼æœ€è¿‘çš„11å€æ•°å¤´åˆ°å°¾</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;=T%<span class="number">11</span><span class="number">-1</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (a[i] == <span class="string">&#x27;3&#x27;</span>) x++;</span><br><span class="line">    &#125;</span><br><span class="line">    p.<span class="built_in">oo</span>(<span class="number">20</span>+x%<span class="number">199</span>,x%<span class="number">15</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2745å å¥—çš„å¤šè¾¹å½¢">2745å å¥—çš„å¤šè¾¹å½¢</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">6</span>;i++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;i+<span class="number">3</span>;j++)&#123;</span><br><span class="line">            p.<span class="built_in">fd</span>(<span class="number">100</span>).<span class="built_in">rt</span>(<span class="number">360.0</span>/(i+<span class="number">3</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="378æ‰¾è§„å¾‹">378æ‰¾è§„å¾‹</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//378</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">plus</span><span class="params">(<span class="type">int</span> n)</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> sum=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;n;i++) sum=sum+i;</span><br><span class="line">    <span class="keyword">return</span> sum;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    cin&gt;&gt;n;</span><br><span class="line">    p.<span class="built_in">oo</span>(<span class="number">50</span>,<span class="built_in">plus</span>(n)%<span class="number">16</span>);   </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="172æ‹¼å›¾">172æ‹¼å›¾</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> n,i,max=<span class="number">0</span>,min=<span class="number">114514</span>;</span><br><span class="line">    cin&gt;&gt;n;</span><br><span class="line">    <span class="type">int</span> a[n],b[n];</span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line">        cin&gt;&gt;a[i];</span><br><span class="line">        <span class="keyword">if</span>(a[i]&lt;min)min=a[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line">        cin&gt;&gt;b[i];</span><br><span class="line">        <span class="keyword">if</span>(b[i]&gt;max)max=b[i];</span><br><span class="line">    &#125;</span><br><span class="line">    p.<span class="built_in">rr</span>(min,min,<span class="number">10</span>).<span class="built_in">moveTo</span>(<span class="number">0</span>,min/<span class="number">2</span>+max).<span class="built_in">oo</span>(max,<span class="number">11</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2024å¹´é’ç§‘èµ›å‹è½´é¢˜">2024å¹´é’ç§‘èµ›å‹è½´é¢˜</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è®¡ç®—ä¸¤æ•°çš„å·®(æ­£æ•°)</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">cha</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(a-b&gt;<span class="number">0</span>) <span class="keyword">return</span> a-b;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> b-a;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//300 100 250 0</span></span><br><span class="line"><span class="comment">//-200 300 250 -100</span></span><br><span class="line"><span class="comment">//300 -100 -100 -200</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> a,b,y1,y2,jd;</span><br><span class="line">    cin &gt;&gt; a&gt;&gt;b&gt;&gt;y1&gt;&gt;y2;</span><br><span class="line">    p.<span class="built_in">moveTo</span>(<span class="number">0</span>,y1).<span class="built_in">lineTo</span>(<span class="number">0</span>,y2).<span class="built_in">c</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="comment">//ä¸¤ç‚¹è¿æ¥ï¼Œè®¡ç®—ç»è¿‡yè½´æ—¶å€™çš„äº¤ç‚¹</span></span><br><span class="line">    <span class="comment">//äº¤ç‚¹åœ¨y1~y2çš„èŒƒå›´åˆ™éœ€è¦ç»•ç€èµ°ï¼Œä¸ç„¶ç›´æ¥è¿æ¥ä¸¤ç‚¹</span></span><br><span class="line">    jd=a-(a-b)/<span class="number">2.0</span>;<span class="comment">//Aç‚¹å’ŒBç‚¹è¿æ¥çº¿ç»è¿‡yè½´çš„äº¤ç‚¹çš„yè½´ç‚¹</span></span><br><span class="line">    <span class="keyword">if</span>(jd&gt;y2&amp;&amp;jd&lt;y1)&#123;<span class="comment">//æœ‰æŒ¡æ¿</span></span><br><span class="line">        <span class="comment">//è®¡ç®—è¿‡ä¸Šç«¯ç‚¹è·ç¦» å‹¾è‚¡å®šç†</span></span><br><span class="line">        <span class="type">double</span> julis = <span class="built_in">sqrt</span>(<span class="built_in">cha</span>(a,y1)*<span class="built_in">cha</span>(a,y1)+<span class="number">300</span>*<span class="number">300</span>)+<span class="built_in">sqrt</span>(<span class="built_in">cha</span>(b,y1)*<span class="built_in">cha</span>(b,y1)+<span class="number">300</span>*<span class="number">300</span>);</span><br><span class="line">        cout &lt;&lt; julis&lt;&lt;endl;</span><br><span class="line">        <span class="comment">//è®¡ç®—è¿‡ä¸‹ç«¯ç‚¹è·ç¦»</span></span><br><span class="line">        <span class="type">double</span> julix = <span class="built_in">sqrt</span>(<span class="built_in">cha</span>(a,y2)*<span class="built_in">cha</span>(a,y2)+<span class="number">300</span>*<span class="number">300</span>)+<span class="built_in">sqrt</span>(<span class="built_in">cha</span>(b,y2)*<span class="built_in">cha</span>(b,y2)+<span class="number">300</span>*<span class="number">300</span>);</span><br><span class="line">        cout &lt;&lt; julix;</span><br><span class="line">        <span class="comment">//èµ°ä¸Šç«¯ç‚¹</span></span><br><span class="line">        <span class="keyword">if</span>(julix&gt;julis)&#123;</span><br><span class="line">            p.<span class="built_in">moveTo</span>(<span class="number">-300</span>,a).<span class="built_in">lineTo</span>(<span class="number">0</span>,y1).<span class="built_in">lineTo</span>(<span class="number">300</span>,b);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">//èµ°ä¸‹ç«¯ç‚¹</span></span><br><span class="line">            p.<span class="built_in">moveTo</span>(<span class="number">-300</span>,a).<span class="built_in">lineTo</span>(<span class="number">0</span>,y2).<span class="built_in">lineTo</span>(<span class="number">300</span>,b);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        p.<span class="built_in">moveTo</span>(<span class="number">-300</span>,a).<span class="built_in">lineTo</span>(<span class="number">300</span>,b);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">GoCè®­ç»ƒé¢˜</summary>
    
    
    
    <category term="æ‚é¡¹" scheme="https://u7u7.top/categories/%E6%9D%82%E9%A1%B9/"/>
    
    
    <category term="C++" scheme="https://u7u7.top/tags/C/"/>
    
  </entry>
  
  <entry>
    <title>ä¸­è½¯æ¯24å¹´6æœˆç¬”è®°</title>
    <link href="https://u7u7.top/posts/23biji06.html"/>
    <id>https://u7u7.top/posts/23biji06.html</id>
    <published>2024-06-01T08:30:25.000Z</published>
    <updated>2024-06-20T06:30:25.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="æ¨¡ç‰ˆ">æ¨¡ç‰ˆ</h1><h2 id="å­¦ä¹ æ—¥æœŸ">å­¦ä¹ æ—¥æœŸ:</h2><h2 id="é¡¹ç›®ä»»åŠ¡">é¡¹ç›®ä»»åŠ¡</h2><h2 id="BUG">BUG</h2><h2 id="æ—¥æ€»ç»“">æ—¥æ€»ç»“</h2><blockquote></blockquote><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;% tabs åˆ†æ %&#125;</span><br><span class="line">&lt;!-- tab BUG1@fas fa-bomb --&gt;</span><br><span class="line">Any content (support inline tags too).</span><br><span class="line">&lt;!-- endtab --&gt;</span><br><span class="line">&lt;!-- tab BUG2@fas fa-bomb --&gt;</span><br><span class="line">Any content (support inline tags too).</span><br><span class="line">&lt;!-- endtab --&gt;</span><br><span class="line">&#123;% endtabs %&#125;</span><br></pre></td></tr></table></figure><h1 id="Pyç»¼åˆæ¨èæŒ‡æ ‡ç®—æ³•">Pyç»¼åˆæ¨èæŒ‡æ ‡ç®—æ³•</h1><h2 id="å­¦ä¹ æ—¥æœŸ-6-1">å­¦ä¹ æ—¥æœŸ: 6.1</h2><h2 id="é¡¹ç›®ä»»åŠ¡-2">é¡¹ç›®ä»»åŠ¡</h2><h3 id="ç»¼åˆæŒ‡æ ‡è®¡ç®—">ç»¼åˆæŒ‡æ ‡è®¡ç®—</h3><p>â€‹é»˜è®¤æ¨èæŒ‡æ ‡æ•°ï¼Œå› ä¸ºè¿˜æ²¡æƒ³å¥½éœ€è¦æ¨èçš„å­—æ®µï¼Œæœ‰å“ªäº›ï¼Œæ‰€ä»¥å°±å…ˆæŠŠç»“åˆå’Œæ™¯åŒºæœ‰å…³çš„æ‰€æœ‰å­—æ®µæ‰¾å‡ºè¿›è¡ŒåŠ æƒå¤„ç†ï¼Œç®—å‡ºä¸€ä¸ªæ¯”è¾ƒåˆé€‚çš„ratingæ¨èæŒ‡æ ‡ç³»æ•°ï¼Œå°†è¯¥ç³»æ•°å­˜æ”¾åˆ°spotè¡¨ä¸­</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">from</span> pyspark.sql.types <span class="keyword">import</span> StructType, StructField, StringType, IntegerType, DoubleType</span><br><span class="line"><span class="keyword">from</span> commentDmTest.DmConnect <span class="keyword">import</span> *</span><br><span class="line">os.environ[<span class="string">&quot;PYSPARK_PYTHON&quot;</span>] = <span class="string">&quot;E:\\software\\anaconda3\\envs\\pyspark\\python.exe&quot;</span></span><br><span class="line"><span class="comment"># å»ºç«‹è¿æ¥</span></span><br><span class="line">conn = connDm()</span><br><span class="line">cur = conn.cursor()  <span class="comment"># è·å–æ¸¸æ ‡</span></span><br><span class="line"><span class="comment"># å¾—åˆ°æ™¯åŒºçš„å„æŒ‡æ ‡ä¿¡æ¯ï¼Œæ–¹ä¾¿æ¨èåŠ æƒå¤„ç†</span></span><br><span class="line">cur.execute(<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">with t1 as</span></span><br><span class="line"><span class="string">         (select SPOT_ID, round(avg(FEEL_SCORE), 3) as avgScore</span></span><br><span class="line"><span class="string">          from COMMENT_INFO_NLP</span></span><br><span class="line"><span class="string">          group by SPOT_ID)</span></span><br><span class="line"><span class="string">select SPOT_NAME, GRADE, HOT, t2.SPOT_ID,</span></span><br><span class="line"><span class="string">       replace(SUM, substring(SUM, locate(&#x27;æ¡&#x27;, SUM)), &#x27;&#x27;) as sum,</span></span><br><span class="line"><span class="string">       avgScore</span></span><br><span class="line"><span class="string">from SPOT_INFO t2</span></span><br><span class="line"><span class="string">join t1 on t1.SPOT_ID=t2.SPOT_ID</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span>)</span><br><span class="line">spot_info_df = pd.DataFrame(cur.fetchall(), columns=[<span class="string">&#x27;SPOT_NAME&#x27;</span>, <span class="string">&#x27;GRADE&#x27;</span>, <span class="string">&#x27;HOT&#x27;</span>, <span class="string">&#x27;SPOT_ID&#x27;</span>, <span class="string">&#x27;SUM&#x27;</span>, <span class="string">&#x27;AVG&#x27;</span>])</span><br><span class="line"><span class="comment"># ç®—å‡ºå„ä¸ªæ™¯åŒºçš„æ€»è¯„è®ºæ•°çš„ä¸­ä½æ•° å¡«å……ä¸ºsumä¸ºnalçš„è¡Œ</span></span><br><span class="line">cur.execute(<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">select MEDIAN(convert(int,t1.sum)) avgCommentSum</span></span><br><span class="line"><span class="string">from (select replace(SUM, substring(SUM, locate(&#x27;æ¡&#x27;, SUM)), &#x27;&#x27;) as sum</span></span><br><span class="line"><span class="string">      from SPOT_INFO) t1</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span>)</span><br><span class="line"><span class="comment"># å¾—åˆ°å¹³å‡å€¼decimalç±»å‹çš„</span></span><br><span class="line">avg_comment_sum = cur.fetchall()[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line"><span class="comment"># ä¿®æ”¹sumåˆ—çš„æ•°æ®ç±»å‹è½¬ä¸ºfloatæ‰èƒ½ä½¿ç”¨maxæ–¹æ³•</span></span><br><span class="line">spot_info_df[<span class="string">&#x27;SUM&#x27;</span>] = spot_info_df[<span class="string">&#x27;SUM&#x27;</span>].apply(pd.to_numeric)</span><br><span class="line"><span class="comment"># å¾—åˆ°æœ€å¤§å€¼decimalç±»å‹çš„</span></span><br><span class="line">max_comment_sum = spot_info_df[<span class="string">&#x27;SUM&#x27;</span>].<span class="built_in">max</span>()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯¹sparkçš„dataframeåŠ æƒå¤„ç†</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">process_row</span>(<span class="params">r</span>):</span><br><span class="line">    <span class="comment"># å¤„ç†æ¯ä¸€è¡Œæ•°æ®ï¼šrè¡¨ç¤ºrowå¯¹è±¡</span></span><br><span class="line">    <span class="comment"># æ³¨æ„è¿™é‡Œè¦å…¨éƒ¨è®¾ä¸ºæµ®ç‚¹æ•°ï¼Œsparkè¿ç®—æ—¶å¯¹ç±»å‹æ¯”è¾ƒæ•æ„Ÿï¼Œè¦ä¿æŒæ•°æ®ç±»å‹éƒ½ä¸€è‡´</span></span><br><span class="line">    grade_count = r.GRADE <span class="keyword">if</span> r.GRADE <span class="keyword">else</span> <span class="number">0.0</span></span><br><span class="line">    hot_count = r.HOT <span class="keyword">if</span> r.HOT <span class="keyword">else</span> <span class="number">0.0</span></span><br><span class="line">    sum_count = r.SUM <span class="keyword">if</span> r.SUM <span class="keyword">else</span> avg_comment_sum  <span class="comment"># å¦‚æœä¸ºç©º ä½¿ç”¨å¹³å‡å€¼å¡«å……</span></span><br><span class="line">    avg_count = r.AVG <span class="keyword">if</span> r.AVG <span class="keyword">else</span> <span class="number">0.0</span></span><br><span class="line"></span><br><span class="line">    grade_score = <span class="number">0.2</span> * grade_count / <span class="number">5</span> * <span class="number">100</span> <span class="keyword">if</span> grade_count &lt;= <span class="number">5</span> <span class="keyword">else</span> <span class="number">20.0</span></span><br><span class="line">    hit_score = <span class="number">0.4</span> * hot_count / <span class="number">10</span> * <span class="number">100</span> <span class="keyword">if</span> hot_count &lt;= <span class="number">10</span> <span class="keyword">else</span> <span class="number">40.0</span></span><br><span class="line">    sum_score = <span class="number">0.2</span> * sum_count / max_comment_sum * <span class="number">100</span> <span class="keyword">if</span> sum_count &lt;= max_comment_sum <span class="keyword">else</span> <span class="number">20</span></span><br><span class="line">    avg_score = <span class="number">0.2</span> * avg_count / <span class="number">5</span> * <span class="number">100</span> <span class="keyword">if</span> avg_count &lt;= <span class="number">5</span> <span class="keyword">else</span> <span class="number">20.0</span></span><br><span class="line"></span><br><span class="line">    rating = <span class="built_in">round</span>(grade_score, <span class="number">2</span>) + <span class="built_in">round</span>(hit_score, <span class="number">2</span>) + <span class="built_in">round</span>(sum_score, <span class="number">2</span>) + <span class="built_in">round</span>(avg_score, <span class="number">2</span>)</span><br><span class="line">    <span class="comment"># è¿”å›ç”¨æˆ·IDã€åˆ†ç±»IDã€ç”¨æˆ·å¯¹åˆ†ç±»çš„åå¥½æ‰“åˆ†</span></span><br><span class="line">    <span class="keyword">return</span> r.SPOT_ID, r.SPOT_NAME, <span class="built_in">round</span>(rating, <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºsparkç±»</span></span><br><span class="line">spark = connSpark()</span><br><span class="line"><span class="comment"># pandasè½¬pysparkéœ€è¦è®¾ç½®ç±»å‹</span></span><br><span class="line">schema = StructType([</span><br><span class="line">    StructField(<span class="string">&quot;SPOT_NAME&quot;</span>, StringType(), <span class="literal">True</span>),</span><br><span class="line">    StructField(<span class="string">&quot;GRADE&quot;</span>, DoubleType(), <span class="literal">True</span>),</span><br><span class="line">    StructField(<span class="string">&quot;HOT&quot;</span>, DoubleType(), <span class="literal">True</span>),</span><br><span class="line">    StructField(<span class="string">&quot;SPOT_ID&quot;</span>, IntegerType(), <span class="literal">True</span>),</span><br><span class="line">    StructField(<span class="string">&quot;SUM&quot;</span>, DoubleType(), <span class="literal">True</span>),</span><br><span class="line">    StructField(<span class="string">&quot;AVG&quot;</span>, DoubleType(), <span class="literal">True</span>),</span><br><span class="line">])</span><br><span class="line"><span class="comment"># åˆ›å»ºsparkçš„dataframeç±»</span></span><br><span class="line">spot_info_df_spark = spark.createDataFrame(spot_info_df, schema=schema)</span><br><span class="line"><span class="comment"># å±•ç¤ºdfçš„æ¶æ„</span></span><br><span class="line">spot_info_df_spark.printSchema()</span><br><span class="line"><span class="comment"># åˆ›å»ºrddå¯¹è±¡æ‰§è¡Œ æŒ‡æ ‡åŠ æƒ</span></span><br><span class="line">rating_rdd = spot_info_df_spark.rdd.<span class="built_in">map</span>(process_row)</span><br><span class="line"><span class="comment"># å¯¹rddçš„ç±»å‹è¿›è¡Œè½¬æ¢ é˜²æ­¢toDFä¼šæŠ¥é”™</span></span><br><span class="line">rating_rdd = rating_rdd.<span class="built_in">map</span>(<span class="keyword">lambda</span> x: (<span class="built_in">int</span>(x[<span class="number">0</span>]), <span class="built_in">str</span>(x[<span class="number">1</span>]), <span class="built_in">float</span>(x[<span class="number">2</span>])))</span><br><span class="line"><span class="comment"># rddè½¬å›dataframe</span></span><br><span class="line">rating_df = rating_rdd.toDF([<span class="string">&quot;spot_id_rat&quot;</span>, <span class="string">&quot;spot_name_rat&quot;</span>, <span class="string">&quot;RATING&quot;</span>])</span><br><span class="line"><span class="comment"># è¯»å–æ™¯åŒºè¡¨è¿›è¡Œè¿æ¥ ç»™æ™¯åŒºè¡¨æ·»åŠ RATINGå­—æ®µ</span></span><br><span class="line">spot_into = dmRead(spark, <span class="string">&quot;SPOT_INFO&quot;</span>)</span><br><span class="line"><span class="comment"># è·å–spot_infoè¡¨çš„æ‰€æœ‰åˆ—å æ–¹ä¾¿è¿æ¥ä»¥åå–å€¼</span></span><br><span class="line">need_col: <span class="built_in">list</span> = spot_into.toPandas().columns.values.tolist()</span><br><span class="line"><span class="comment"># æ·»åŠ RATINGåˆ—</span></span><br><span class="line">need_col.append(<span class="string">&quot;RATING&quot;</span>)</span><br><span class="line"><span class="comment"># joinè¿æ¥æ ¹æ®spot_id åªè¦åŸæ¥æ™¯åŒºè¡¨çš„å­—æ®µ+æ–°çš„ratingå­—æ®µ</span></span><br><span class="line">spot_final = rating_df.join(spot_into, rating_df.spot_id_rat == spot_into.SPOT_ID) \</span><br><span class="line">    .selectExpr(need_col)</span><br><span class="line"><span class="comment"># å†™å…¥SPOT_INFOè¡¨ (æ·»åŠ äº†ratingå­—æ®µ)</span></span><br><span class="line">dmWrite(spot_final, <span class="string">&quot;SPOT_INFO&quot;</span>)</span><br></pre></td></tr></table></figure><h3 id="æ ¹æ®å…³é”®å­—æ‰¾å¯¹åº”çš„è¯„è®º">æ ¹æ®å…³é”®å­—æ‰¾å¯¹åº”çš„è¯„è®º</h3><h4 id="æŸ¥è¯¢æ–¹æ³•">æŸ¥è¯¢æ–¹æ³•</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¸€ä¸ªsqlå°±èƒ½è§£å†³ï¼Œæ•ˆç‡å’Œæ•ˆæœéƒ½èƒ½è¾¾åˆ°é¢„æœŸè¦æ±‚</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">keyWordFindComment</span>(<span class="params">spot_id, comment_key_word</span>):</span><br><span class="line">    cur.execute(<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    select spot_id, evaluation, evaluation_grade, evaluation_time, feel_score, feel from COMMENT_INFO_NLP</span></span><br><span class="line"><span class="string">    where</span></span><br><span class="line"><span class="string">        SPOT_ID=&#123;&#125;</span></span><br><span class="line"><span class="string">    and</span></span><br><span class="line"><span class="string">        EVALUATION like &#x27;%&#123;&#125;%&#x27;</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span>.<span class="built_in">format</span>(spot_id, comment_key_word))</span><br><span class="line">    list_test = cur.fetchall()</span><br><span class="line">    df_test = pd.DataFrame(list_test, columns=[<span class="string">&quot;spot_id&quot;</span>, <span class="string">&quot;evaluation&quot;</span>, <span class="string">&quot;evaluation_grade&quot;</span>,</span><br><span class="line">                                               <span class="string">&quot;evaluation_time&quot;</span>, <span class="string">&quot;feel_score&quot;</span>, <span class="string">&quot;feel&quot;</span>])</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">eval</span>(df_test.to_json(orient=<span class="string">&#x27;records&#x27;</span>, force_ascii=<span class="literal">False</span>).replace(<span class="string">&quot;null&quot;</span>, <span class="string">&quot;&#x27;æœªå¡«&#x27;&quot;</span>))</span><br></pre></td></tr></table></figure><h4 id="æ¥å£">æ¥å£</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/spot/comment/&lt;spot_id&gt;&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>, <span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">spot_comments_high_word_find</span>(<span class="params">spot_id</span>):</span><br><span class="line">    <span class="keyword">if</span> request.method != <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> json.dumps(&#123;<span class="string">&#x27;msg&#x27;</span>: <span class="string">&#x27;æŸ¥è¯¢å¤±è´¥,è¯·ä½¿ç”¨POSTä¼ å‚&#x27;</span>, <span class="string">&#x27;code&#x27;</span>: <span class="number">500</span>, <span class="string">&#x27;data&#x27;</span>: <span class="string">&#x27;null&#x27;</span>&#125;, ensure_ascii=<span class="literal">False</span>)</span><br><span class="line">    <span class="comment"># è·å–postä¸­ä¼ é€’çš„å€¼</span></span><br><span class="line">    keyWord = request.args.to_dict()</span><br><span class="line">    data = dmToDfpkuseg.keyWordFindComment(<span class="built_in">eval</span>(spot_id), keyWord.get(<span class="string">&#x27;keyWord&#x27;</span>))</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(data) == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> json.dumps(&#123;<span class="string">&#x27;msg&#x27;</span>: <span class="string">&#x27;æŸ¥è¯¢å¤±è´¥,æ²¡æœ‰è¯¥æ™¯åŒºå…³é”®å­—å¯¹åº”çš„è¯„è®º&#x27;</span>, <span class="string">&#x27;code&#x27;</span>: <span class="number">500</span>, <span class="string">&#x27;data&#x27;</span>: <span class="string">&#x27;null&#x27;</span>&#125;,</span><br><span class="line">                          ensure_ascii=<span class="literal">False</span>)</span><br><span class="line">    <span class="keyword">return</span> json.dumps(&#123;<span class="string">&#x27;msg&#x27;</span>: <span class="string">&#x27;æŸ¥è¯¢æˆåŠŸ&#x27;</span>, <span class="string">&#x27;code&#x27;</span>: <span class="number">200</span>, <span class="string">&#x27;data&#x27;</span>: data&#125;, ensure_ascii=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure><h2 id="BUG-2">BUG</h2><p>â€‹è¿™ä¸ªæ˜¯flaskä¸­ä¸€ä¸ªserser.pyä¸­çš„æ–¹æ³•ä¸èƒ½è¿‡å¤šï¼Œæˆ‘ä¹‹å‰æ˜¯æœ‰ä¸¤ä¸ªæ–¹æ³•åçš„å­˜åœ¨ï¼Œè€Œä¸”èƒ½æ­£å¸¸ä½¿ç”¨çš„æƒ…å†µçš„ï¼Œä¸çŸ¥é“ä¸ºä»€ä¹ˆç°åœ¨ä¸è¡Œï¼Œåé¢ç»è¿‡æˆ‘æµ‹è¯•ï¼Œå‘ç°æ–¹æ³•æœ€å¤šå­˜åœ¨ä¸¤ä¸ªï¼Œè€Œä¸”éœ€è¦ä¸€ä¸ªæœ‰å‚ä¸€ä¸ªæ— å‚çš„ï¼Œä¸èƒ½ä¸¤ä¸ªæœ‰å‚çš„ï¼Œå³ä½¿å‚æ•°çš„æ•°é‡å’Œç±»å‹ä¸ä¸€æ ·ä¹Ÿä¸è¢«å…è®¸ã€‚</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/image-20250820102540595.png" alt="image-20250820102540595"></p><p>â€‹æˆ‘ä½¿ç”¨pysparkè¿æ¥dmæ•°æ®åº“çš„æ—¶å€™æŠ¥é”™ï¼Œçœ‹æ ·å­æ˜¯æ‰¾ä¸åˆ°driverï¼Œæœç´¢äº†æ–¹æ³•ï¼Œå‘ç°å…¶å®è·Ÿä¹‹å‰MySQLè¿æ¥sparkå·®ä¸å¤šï¼Œéœ€è¦æŠŠdriverçš„jaråŒ…æ”¾å…¥sparkçš„ç¯å¢ƒä¸‹é¢ï¼Œå°†dmçš„jaråŒ…æ”¾åˆ°pysparkçš„jarsåŒ…ä¸‹é¢é—®é¢˜è§£å†³ã€‚</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/image-20250820102547110.png" alt="image-20250820102547110"></p><h2 id="æ—¥æ€»ç»“-2">æ—¥æ€»ç»“</h2><blockquote><p>â€‹ä»Šå¤©å®Œæˆçš„ä»»åŠ¡è¿˜æ˜¯æŒºå¤šçš„ï¼Œè€Œä¸”æ¢³ç†å¥½äº†åé¢å‡ å¤©çš„è®¡åˆ’ï¼Œåå‡ å¤©æ‰“ç®—æŠŠé¢„æµ‹å­¦ä¼šï¼Œçœ‹èƒ½ä¸èƒ½ä¸¾ä¸€åä¸‰æŠŠæ™ºèƒ½æ¨èéƒ¨åˆ†è§£å†³äº†ï¼Œè¿™å‡ å¤©è¿˜éœ€è¦æƒ³ä¸‹æ¨èéƒ¨åˆ†éœ€è¦ä»€ä¹ˆæ ·çš„ç­›é€‰æ¡ä»¶ã€‚ä»Šå¤©çš„ä»»åŠ¡ä¸»è¦æœ‰ä¸¤ä¸ªï¼Œæ ¹æ®å…³é”®å­—æ‰¾åˆ°ç›¸å…³çš„è¯„è®ºï¼Œç„¶åå¥—åŠ æƒç®—æ³•æŠŠratingï¼Œä¹Ÿå°±æ˜¯æ™¯åŒºçš„ç»¼åˆæ¨èåº¦è®¡ç®—å‡ºæ¥ï¼Œå¹¶æ”¾å…¥æ•°æ®åº“ä¸­ï¼Œæœ¬æ¥æ˜¯æ‰“ç®—å†™æˆæ¥å£çš„ï¼Œä½†æ˜¯sparkæ¥å£å“åº”å®åœ¨æ˜¯å¤ªæ…¢äº†ï¼Œç›´æ¥å­˜å…¥æ•°æ®åº“ä¸­äº†ï¼Œå¦‚æœsparkå†™å…¥æ¥å£ä¸€ç›´éƒ½å¾ˆæ…¢çš„è¯ï¼Œå¯èƒ½åæœŸè¦å¼ƒç”¨sparkå†™æ¨èç®—æ³•ï¼Œè¦ç”¨pandaså’Œnumpyã€‚</p></blockquote><h1 id="æ•°æ®æ¸…æ´—æ–¹æ³•æ•´åˆ">æ•°æ®æ¸…æ´—æ–¹æ³•æ•´åˆ</h1><h2 id="å­¦ä¹ æ—¥æœŸ-6-2">å­¦ä¹ æ—¥æœŸ: 6.2</h2><h2 id="é¡¹ç›®ä»»åŠ¡-3">é¡¹ç›®ä»»åŠ¡</h2><h3 id="èµ·å› ">èµ·å› </h3><p>â€‹å› ä¸ºæ•°æ®æœ‰äº›ç¼ºå¤±å€¼æ˜¯æ²¡æœ‰è¡¥çš„ï¼Œæœ‰äº›åªèƒ½pythonè¿›è¡Œå¡«è¡¥ï¼Œæœ‰éƒ¨åˆ†æ˜¯è¦sparkè¡¥çš„ï¼Œä½†æ˜¯ä¸€èˆ¬è‡ªå·±å¤„ç†å®Œä¸€éƒ¨åˆ†ç›´æ¥å­˜å…¥æ•°æ®åº“ï¼Œè¿™æ ·æˆ‘è¦é¡ºåˆ©æ¸…æ´—å®Œï¼Œéœ€è¦è·‘å¥½å‡ ä¸ªjaråŒ…ï¼Œæ‰“ç®—åˆ©ç”¨sparkä¸´æ—¶è¡¨çš„ç‰¹æ€§ï¼Œå°½é‡æŠŠè¿è¡Œèµ·æ¥ï¼Œåªéœ€è¦ä¸¤ä¸‰ä¸ªjaråŒ…å°±èƒ½æŠŠæ•°æ®æå¥½ã€‚</p><h3 id="å¯¼å…¥">å¯¼å…¥</h3><p>â€‹æ­¥éª¤ä»¥åŠæ€è·¯:ç°å°†æä¾›çš„æ‰€æœ‰æ–‡ä»¶ä¼ é€åˆ°ä¸€ä¸ªè¡¨ä¸­ï¼Œä»£ç ä¹Ÿè¿›è¡Œäº†å¾ˆå¤§çš„ä¼˜åŒ–ï¼Œå‰æœŸå‡†å¤‡å·¥ä½œä¸€ä¸ªscalaä»£ç å°±èƒ½è§£å†³ï¼Œæœ¬æ¥æ˜¯å› ä¸ºtxtæ–‡ä»¶æ˜¯æœ‰javaè·‘çš„ï¼Œä½†æ˜¯å…¶å®å¯ä»¥ç”¨scalaè°ƒjavaçš„mainæ–¹æ³•ï¼Œè¿™æ ·å°±å¯ä»¥æ”¾ä¸€ä¸ªæ–‡ä»¶ä¸­ã€‚</p><h4 id="finalClearOne">finalClearOne</h4><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> clearDf</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> clearDf.<span class="type">Utils</span>.&#123;dmWriterOverwrite, getSpark&#125;</span><br><span class="line"><span class="keyword">import</span> clearDf.fileClearTest.&#123;csvToDf, xlsxToDf&#125;</span><br><span class="line"><span class="keyword">import</span> org.apache.spark.sql.functions._</span><br><span class="line"><span class="keyword">import</span> org.apache.spark.sql.types.<span class="type">IntegerType</span></span><br><span class="line"><span class="keyword">import</span> org.apache.spark.sql.&#123;<span class="type">DataFrame</span>, <span class="type">SparkSession</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">finalClearOne</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="keyword">val</span> spark: <span class="type">SparkSession</span> = getSpark</span><br><span class="line">    <span class="keyword">import</span> spark.implicits._</span><br><span class="line">    <span class="keyword">import</span> spark.sql</span><br><span class="line">    sql(<span class="string">&quot; set spark.executor.processTreeMetrics=true&quot;</span>) <span class="comment">//è§£å†³æŠ¥é”™è­¦å‘Šå¯¼è‡´ä»£ç è·‘ä¸å‡ºæ¥</span></span><br><span class="line">    <span class="keyword">val</span> frame2: <span class="type">DataFrame</span> = csvToDf(spark, <span class="string">&quot;E:\\study\\ä¸­è½¯æ¯\\æ ·æ•°æ®\\1679624200845105\\åˆå§‹æ—…æ¸¸æ•°æ®\\2.csv&quot;</span>)</span><br><span class="line">    <span class="keyword">val</span> frame3: <span class="type">DataFrame</span> = xlsxToDf(spark, <span class="string">&quot;E:\\study\\ä¸­è½¯æ¯\\æ ·æ•°æ®\\1679624200845105\\åˆå§‹æ—…æ¸¸æ•°æ®\\3.xlsx&quot;</span>)</span><br><span class="line">    <span class="keyword">val</span> frame4: <span class="type">DataFrame</span> = csvToDf(spark, <span class="string">&quot;E:\\study\\ä¸­è½¯æ¯\\æ ·æ•°æ®\\1679624200845105\\åˆå§‹æ—…æ¸¸æ•°æ®\\4.csv&quot;</span>)</span><br><span class="line">    <span class="comment">//ç¼ºå¤±å­—æ®µ  PHONE INTRO HOT COMMENT_TIME COMMENT_GRADE</span></span><br><span class="line">    <span class="keyword">val</span> frameSmallFill: <span class="type">DataFrame</span> = frame2.unionByName(frame3)</span><br><span class="line">      .withColumn(<span class="string">&quot;GRADE&quot;</span>,round(substring($<span class="string">&quot;GRADE&quot;</span>,<span class="number">1</span>,<span class="number">2</span>).cast(<span class="type">IntegerType</span>) / <span class="number">20</span>,<span class="number">1</span>))</span><br><span class="line">      <span class="comment">//è¡¥å……ç¼ºå¤±å­—æ®µ</span></span><br><span class="line">      .withColumn(<span class="string">&quot;PHONE&quot;</span>,lit(<span class="string">&quot;&quot;</span>))</span><br><span class="line">      .withColumn(<span class="string">&quot;INTRO&quot;</span>,lit(<span class="string">&quot;&quot;</span>))</span><br><span class="line">      .withColumn(<span class="string">&quot;HOT&quot;</span>,lit(<span class="string">&quot;&quot;</span>))</span><br><span class="line">      .withColumn(<span class="string">&quot;COMMENT_GRADE&quot;</span>,lit(<span class="string">&quot;&quot;</span>))</span><br><span class="line">      .withColumn(<span class="string">&quot;COMMENT_TIME&quot;</span>,lit(<span class="string">&quot;&quot;</span>))</span><br><span class="line">    <span class="keyword">val</span> frameAllData:<span class="type">DataFrame</span> = frame4.unionByName(frameSmallFill)</span><br><span class="line"></span><br><span class="line">    dmWriterOverwrite(frameAllData,<span class="string">&quot;U7U7.All_TEMP&quot;</span>)</span><br><span class="line">    <span class="comment">//éœ€è¦å…ˆjavaæŠŠtxtä¿å­˜å…¥all_tempè¡¨</span></span><br><span class="line">    <span class="keyword">import</span> clearTxt.txtClearArrayList</span><br><span class="line">    txtClearArrayList.txtIntoDmData.main()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="BUG-3">BUG</h2><p>å¾ˆå›°éš¾è§£å†³çš„bugæ²¡æœ‰å‡ºç°</p><h2 id="æ—¥æ€»ç»“-3">æ—¥æ€»ç»“</h2><blockquote><p>â€‹å› ä¸ºæ®è¯´ä¸‹å‘¨æœåŠ¡å™¨å¹³å°å°±ä¼šå‘æ”¾äº†ï¼Œä¸ºäº†å¤„ç†å¹³å°å¯èƒ½æä¾›çš„hdfsçš„æ–°æ•°æ®ï¼Œæ‰“ç®—å°†è‡ªå·±ä¹‹å‰æ•°æ®å¤„ç†çš„ä»£ç æ•´åˆä¸€ä¸‹ï¼Œæ”¾åˆ°ä¸€ä¸ªjaråŒ…ä¸­ï¼Œæ–¹æ³•éƒ½è®¾ç½®å‚æ•°é€šç”¨ï¼Œè¿™æ ·åœ¨å¹³å°æ‰§è¡Œï¼Œä¹Ÿåªéœ€è¦ä¸¤ä¸ªsparkæäº¤å³å¯ã€‚æ²¡ä»€ä¹ˆå›°éš¾çš„ï¼Œåé¢æ•´åˆè¡¨æŠ½å–éƒ¨åˆ†æ•°æ®ä»¥åŠæŒ‚joinåŸå¸‚è¡¨æŒ‚idè¿™ç±»çš„æ–¹æ³•ï¼Œé‡æ–°æ¢³ç†å¥½æ–¹æ³•å¯èƒ½ä¼šéº»çƒ¦ä¸€äº›ï¼Œéœ€è¦æŠŠä»£ç éƒ½ç†æ¸…æ¥šã€‚</p></blockquote><h1 id="æ¸…æ´—æ–¹æ³•æ•´åˆall">æ¸…æ´—æ–¹æ³•æ•´åˆall</h1><h2 id="å­¦ä¹ æ—¥æœŸ-6-5">å­¦ä¹ æ—¥æœŸ: 6.5</h2><h2 id="é¡¹ç›®ä»»åŠ¡-4">é¡¹ç›®ä»»åŠ¡</h2><h3 id="ä»»åŠ¡">ä»»åŠ¡</h3><p>å°†csvå’Œtxtæ–‡ä»¶è¯»å–ä»¥åçš„all_tempåˆ†è¡¨å¤„ç†ï¼Œå…ˆæ˜¯å¯¹è‡ªå·±ç”µè„‘ä¸Šå¯¹dmæ·»åŠ æ•°æ®ï¼Œç„¶åç§»æ¤åˆ°äº†æœåŠ¡å™¨ä¸­ã€‚ç„¶åä½¿ç”¨äººå·¥æ™ºèƒ½è¿™å—å¯¹ç¼ºå¤±çš„æ•°æ®é¢„æµ‹æ‰ã€‚</p><h3 id="ä»£ç å¦‚ä¸‹">ä»£ç å¦‚ä¸‹</h3><p>å…¨éƒ¨æ•´åˆäº†åˆ†è¡¨çš„ä»£ç ï¼Œå¹¶åˆ©ç”¨sparkmlå°†hotå­—æ®µè¿›è¡Œç¼ºå¤±å€¼å¡«å……ã€‚æœºå™¨å­¦ä¹ è¿™éƒ¨åˆ†æˆ‘ä½¿ç”¨äº†éšæœºæ£®æ—ç®—æ³•ï¼Œä¾æ®hotçš„çš®å¹³å‡å€¼ï¼Œå’Œå¯¹åº”çš„gradeå’Œsumå­—æ®µï¼Œæ¨ç®—å‡ºå¯èƒ½çš„hotå€¼</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> clearDf</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> clearDf.<span class="type">Utils</span>.&#123;dmRead, dmWriterOverwrite, getSpark&#125;</span><br><span class="line"><span class="keyword">import</span> org.apache.spark.ml.feature.<span class="type">VectorAssembler</span></span><br><span class="line"><span class="keyword">import</span> org.apache.spark.ml.regression.&#123;<span class="type">RandomForestRegressionModel</span>, <span class="type">RandomForestRegressor</span>&#125;</span><br><span class="line"><span class="keyword">import</span> org.apache.spark.sql.expressions.&#123;<span class="type">Window</span>, <span class="type">WindowSpec</span>&#125;</span><br><span class="line"><span class="keyword">import</span> org.apache.spark.sql.functions._</span><br><span class="line"><span class="keyword">import</span> org.apache.spark.sql.types.<span class="type">DoubleType</span></span><br><span class="line"><span class="keyword">import</span> org.apache.spark.sql.&#123;<span class="type">DataFrame</span>, <span class="type">SparkSession</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">finalClearTwo</span> </span>&#123;</span><br><span class="line">  <span class="keyword">val</span> spark: <span class="type">SparkSession</span> = getSpark</span><br><span class="line"></span><br><span class="line">  <span class="keyword">import</span> spark.implicits._</span><br><span class="line">  <span class="keyword">import</span> spark.sql</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="comment">// å°†æ‰€æœ‰æ–‡ä»¶éƒ½å¯¼å…¥åˆ°all_tempè¡¨</span></span><br><span class="line">    finalClearOne.main(args)</span><br><span class="line">    <span class="comment">//å¯¹all_tempè¡¨è¿›è¡Œå¤„ç†</span></span><br><span class="line">    <span class="keyword">val</span> all_data: <span class="type">DataFrame</span> = dmRead(spark, <span class="string">&quot;ALL_TEMP&quot;</span>)</span><br><span class="line">      .withColumn(<span class="string">&quot;SPOT&quot;</span>, regexp_replace($<span class="string">&quot;SPOT&quot;</span>, <span class="string">&quot;\\?&quot;</span>, <span class="string">&quot;&quot;</span>)) <span class="comment">//å°†è„æ•°æ®ä¸­æ™¯åŒºåå¸¦ï¼Ÿçš„å»æ‰</span></span><br><span class="line">      .where(<span class="string">&quot;SPOT &lt;&gt; &#x27;null&#x27;&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//åˆ›å»ºæ™¯åŒºdataframeå¯¼å…¥æ™¯åŒºè¡¨</span></span><br><span class="line">    <span class="keyword">val</span> spot_info: <span class="type">DataFrame</span> = spotInfoClear(all_data)</span><br><span class="line">    <span class="comment">//åˆ›å»ºå¹¶å¯¼å…¥è¯„è®ºè¡¨ (åpythonè¿˜éœ€è¦å¤„ç†)</span></span><br><span class="line">    <span class="keyword">val</span> comment_info: <span class="type">DataFrame</span> = commentWithSpot(all_data, spot_info)</span><br><span class="line">    println(comment_info.count())</span><br><span class="line"><span class="comment">//    dmWriterOverwrite(comment_info,&quot;comment_temp&quot;)</span></span><br><span class="line">    <span class="comment">//ä¸´æ—¶çš„åŸå¸‚è¡¨(ä¸å¸¦çœä»½)</span></span><br><span class="line">    <span class="keyword">val</span> city_temp:<span class="type">DataFrame</span> = cityInfoClear(spot_info)</span><br><span class="line">    <span class="comment">//å…ˆå¯¼å…¥ æ–¹ä¾¿javaè¯»å–</span></span><br><span class="line">    dmWriterOverwrite(city_temp,<span class="string">&quot;city_info_temp&quot;</span>)</span><br><span class="line">    <span class="keyword">val</span> spot_info_temp: <span class="type">DataFrame</span> = spotWithCityId(spot_info, city_temp) <span class="comment">//å¸¦åŸå¸‚idçš„æ™¯åŒºè¡¨</span></span><br><span class="line">    <span class="comment">//åˆ›å»ºåŸå¸‚ç©ºè¡¨  æ·»åŠ çœä»½å­—æ®µ</span></span><br><span class="line">    <span class="keyword">val</span> create_temp_city: <span class="type">DataFrame</span> = city_temp</span><br><span class="line">      .withColumn(<span class="string">&quot;PROVINCE_NAME&quot;</span>, lit(<span class="string">&quot;&quot;</span>))</span><br><span class="line">      .where(<span class="string">&quot;CITY_ID=0&quot;</span>)</span><br><span class="line">    dmWriterOverwrite(create_temp_city,<span class="string">&quot;CITY_TEMP&quot;</span>) <span class="comment">//ç©ºè¡¨ç»“æ„åˆ°dm</span></span><br><span class="line">    <span class="comment">//æ‰§è¡Œjavaä¸­æ ¹æ®åŸå¸‚ååˆ¤æ–­çœä»½ä»£ç </span></span><br><span class="line">    <span class="keyword">import</span> clearTxt.jsTest.jsonToDataTest</span><br><span class="line">    jsonToDataTest.provinceNameIntoCity()</span><br><span class="line">    <span class="comment">//è¯»å–åŸå¸‚è¡¨(çœä»½å)</span></span><br><span class="line">    <span class="keyword">val</span> city_temp_two:<span class="type">DataFrame</span> = dmRead(spark, <span class="string">&quot;CITY_TEMP&quot;</span>)</span><br><span class="line">    <span class="comment">//æ ¹æ®åŸå¸‚è¡¨(çœä»½å) åˆ›å»ºçœä»½è¡¨(å®Œæ•´ç‰ˆ)</span></span><br><span class="line">    <span class="keyword">val</span> province_data: <span class="type">DataFrame</span> = createToProvince(city_temp_two)</span><br><span class="line">    dmWriterOverwrite(province_data,<span class="string">&quot;PROVINCE_INFO&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å°†åŸå¸‚è¡¨çš„çœä»½åæ›¿æ¢ä¸ºid å¹¶å¯¼å…¥dm(å®Œæ•´ç‰ˆ)</span></span><br><span class="line">    <span class="keyword">val</span> city_info_final:<span class="type">DataFrame</span> = cityJoinProvince(city_temp_two,province_data)</span><br><span class="line">    dmWriterOverwrite(city_info_final,<span class="string">&quot;CITY_INFO&quot;</span>)</span><br><span class="line">    <span class="comment">//hotå­—æ®µå¡«å…… æ™¯åŒºè¡¨å¯¼å…¥ è¿˜éœ€è¦pythoné…ratingå­—æ®µ</span></span><br><span class="line">    <span class="keyword">val</span> spot_Prediction: <span class="type">DataFrame</span> = spotPredictionFinalTable(spot_info_temp)</span><br><span class="line">    dmWriterOverwrite(spot_Prediction, <span class="string">&quot;spot_info_temp&quot;</span>) <span class="comment">//å¯¼å…¥dm</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//éšæœºæ£®æ— hotçš„nullå¡«å……</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">spotPredictionFinalTable</span></span>(spot_info_temp: <span class="type">DataFrame</span>): <span class="type">DataFrame</span> =&#123;</span><br><span class="line">    <span class="comment">// è¯»å–æ•°æ®</span></span><br><span class="line">    <span class="keyword">val</span> data: <span class="type">DataFrame</span> = spot_info_temp.selectExpr(<span class="string">&quot;SPOT_ID&quot;</span>,<span class="string">&quot;GRADE&quot;</span>,<span class="string">&quot;HOT&quot;</span>,<span class="string">&quot;SUM&quot;</span>)</span><br><span class="line">      .withColumn(<span class="string">&quot;GRADE&quot;</span>,$<span class="string">&quot;GRADE&quot;</span>.cast(<span class="type">DoubleType</span>))</span><br><span class="line">      .withColumn(<span class="string">&quot;HOT&quot;</span>,$<span class="string">&quot;HOT&quot;</span>.cast(<span class="type">DoubleType</span>))</span><br><span class="line">      .withColumn(<span class="string">&quot;SUM&quot;</span>,regexp_extract($<span class="string">&quot;SUM&quot;</span>,<span class="string">&quot;[^æ¡]+()&quot;</span>,<span class="number">0</span>).cast(<span class="type">DoubleType</span>))</span><br><span class="line">    <span class="keyword">val</span> data2: <span class="type">DataFrame</span> = spot_info_temp</span><br><span class="line">      .withColumn(<span class="string">&quot;HOT&quot;</span>,$<span class="string">&quot;HOT&quot;</span>.cast(<span class="type">DoubleType</span>))</span><br><span class="line">    <span class="keyword">val</span> meanValues: <span class="type">Double</span> = data.agg(round(avg(col(<span class="string">&quot;HOT&quot;</span>)),<span class="number">1</span>)).head().getDouble(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">val</span> filledData: <span class="type">DataFrame</span> = data.na.fill(meanValues, <span class="type">Seq</span>(<span class="string">&quot;HOT&quot;</span>))</span><br><span class="line">    <span class="comment">// å°†ç‰¹å¾è½¬åŒ–ä¸ºå‘é‡</span></span><br><span class="line">    <span class="keyword">val</span> assembler: <span class="type">VectorAssembler</span> = <span class="keyword">new</span> <span class="type">VectorAssembler</span>()</span><br><span class="line">      .setInputCols(<span class="type">Array</span>(<span class="string">&quot;GRADE&quot;</span>, <span class="string">&quot;SUM&quot;</span>))</span><br><span class="line">      .setOutputCol(<span class="string">&quot;features&quot;</span>)</span><br><span class="line">    <span class="keyword">val</span> assembledData: <span class="type">DataFrame</span> = assembler.transform(filledData)</span><br><span class="line">    <span class="comment">// åˆ›å»ºéšæœºæ£®æ—å›å½’æ¨¡å‹</span></span><br><span class="line">    <span class="keyword">val</span> rf: <span class="type">RandomForestRegressor</span> = <span class="keyword">new</span> <span class="type">RandomForestRegressor</span>()</span><br><span class="line">      .setLabelCol(<span class="string">&quot;HOT&quot;</span>)</span><br><span class="line">      .setFeaturesCol(<span class="string">&quot;features&quot;</span>)</span><br><span class="line">    <span class="comment">// æ‹Ÿåˆæ¨¡å‹</span></span><br><span class="line">    <span class="keyword">val</span> model: <span class="type">RandomForestRegressionModel</span> = rf.fit(assembledData)</span><br><span class="line">    <span class="comment">// ä½¿ç”¨æ¨¡å‹å¡«å……ç¼ºå¤±å€¼</span></span><br><span class="line">    <span class="keyword">val</span> predictedData: <span class="type">DataFrame</span> = data.na.fill(meanValues, <span class="type">Seq</span>(<span class="string">&quot;HOT&quot;</span>))</span><br><span class="line">    <span class="keyword">val</span> assembledPredictedData: <span class="type">DataFrame</span> = assembler.transform(predictedData)</span><br><span class="line">    <span class="keyword">val</span> filledPredictedData: <span class="type">DataFrame</span> = model.transform(assembledPredictedData)</span><br><span class="line">      .withColumn(<span class="string">&quot;prediction&quot;</span>, round(col(<span class="string">&quot;prediction&quot;</span>), <span class="number">1</span>))</span><br><span class="line">    <span class="comment">//æ‰€æœ‰æ™¯åŒºçš„hoté¢„æµ‹</span></span><br><span class="line">    <span class="keyword">val</span> predict: <span class="type">DataFrame</span> = filledPredictedData.selectExpr(<span class="string">&quot;SPOT_ID&quot;</span>,<span class="string">&quot;prediction&quot;</span>).withColumnRenamed(<span class="string">&quot;SPOT_ID&quot;</span>,<span class="string">&quot;id&quot;</span>)</span><br><span class="line">    <span class="comment">//å°†hotçš„é¢„æµ‹å€¼ å¡«å……null å¹¶å°†hotå’Œgradeç±»å‹è½¬æ¢æˆdouble</span></span><br><span class="line">    data2.join(predict,predict(<span class="string">&quot;id&quot;</span>) === data2(<span class="string">&quot;SPOT_ID&quot;</span>))</span><br><span class="line">      .withColumn(<span class="string">&quot;HOT&quot;</span>,</span><br><span class="line">        when(col(<span class="string">&quot;HOT&quot;</span>).isNull, col(<span class="string">&quot;prediction&quot;</span>)).otherwise(col(<span class="string">&quot;hot&quot;</span>)))</span><br><span class="line">      .withColumn(<span class="string">&quot;HOT&quot;</span>,round($<span class="string">&quot;HOT&quot;</span>,<span class="number">1</span>))</span><br><span class="line">      .withColumn(<span class="string">&quot;GRADE&quot;</span>,round($<span class="string">&quot;GRADE&quot;</span>,<span class="number">1</span>))</span><br><span class="line">      .drop(<span class="string">&quot;id&quot;</span>,<span class="string">&quot;prediction&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//TODO å°†åŸå¸‚è¡¨çš„çœä»½åæ¢æˆçœä»½id</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">cityJoinProvince</span></span>(city_data:<span class="type">DataFrame</span>,province_data:<span class="type">DataFrame</span>): <span class="type">DataFrame</span> =&#123;</span><br><span class="line">    <span class="comment">//ä¸¤è¡¨è¿æ¥å–å‡ºéœ€è¦çš„å­—æ®µ</span></span><br><span class="line">    <span class="keyword">val</span> city_temp: <span class="type">DataFrame</span> = city_data.join(province_data, city_data(<span class="string">&quot;PROVINCE_NAME&quot;</span>) === province_data(<span class="string">&quot;NAME&quot;</span>))</span><br><span class="line">          .selectExpr(<span class="string">&quot;CITY_NAME&quot;</span>, <span class="string">&quot;CITY_ID&quot;</span>, <span class="string">&quot;PROVINCE_ID&quot;</span>)</span><br><span class="line">    <span class="comment">//æŠŠæ•°æ®å…ˆæ”¾ä¸´æ—¶è¡¨</span></span><br><span class="line">    city_temp</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//TODO åˆ›å»ºçœä»½è¡¨</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">createToProvince</span></span>(city_data:<span class="type">DataFrame</span>): <span class="type">DataFrame</span> =&#123;</span><br><span class="line">    <span class="comment">//è¯»å–çœä»½è¡¨å¹¶å»é‡  é€’å¢æŒ‚ä¸Šçœä»½id</span></span><br><span class="line">    <span class="keyword">val</span> province_data: <span class="type">DataFrame</span> = city_data</span><br><span class="line">      .selectExpr(<span class="string">&quot;PROVINCE_NAME&quot;</span>)</span><br><span class="line">      .distinct()</span><br><span class="line">      .withColumnRenamed(<span class="string">&quot;PROVINCE_NAME&quot;</span>, <span class="string">&quot;NAME&quot;</span>)</span><br><span class="line">      .withColumn(<span class="string">&quot;PROVINCE_ID&quot;</span>, row_number() over <span class="type">Window</span>.orderBy($<span class="string">&quot;NAME&quot;</span>))</span><br><span class="line">    <span class="comment">//ä¼ å…¥çœä»½è¡¨</span></span><br><span class="line">    province_data</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//æ™¯åŒºè¡¨</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">spotInfoClear</span></span>(all_data: <span class="type">DataFrame</span>): <span class="type">DataFrame</span> = &#123;</span><br><span class="line">    <span class="keyword">val</span> <span class="type">SPOT_ID_ORDER</span>: <span class="type">WindowSpec</span> = <span class="type">Window</span>.orderBy($<span class="string">&quot;SPOT_NAME&quot;</span>.desc)</span><br><span class="line">    <span class="keyword">val</span> spot_info_temp: <span class="type">DataFrame</span> = all_data <span class="comment">//æ™¯åŒºåä¸ä¸ºnull</span></span><br><span class="line">      .withColumnRenamed(<span class="string">&quot;SPOT&quot;</span>, <span class="string">&quot;SPOT_NAME&quot;</span>) <span class="comment">//ä¿®æ”¹å­—æ®µå SPOT ä¸º SPOT_NAME</span></span><br><span class="line">      <span class="comment">//åˆ é™¤ä¸éœ€è¦çš„å­—æ®µ</span></span><br><span class="line">      .drop(<span class="string">&quot;COMMENT&quot;</span>)</span><br><span class="line">      .drop(<span class="string">&quot;COMMENT_GRADE&quot;</span>)</span><br><span class="line">      .drop(<span class="string">&quot;COMMENT_TIME&quot;</span>)</span><br><span class="line">      .distinct() <span class="comment">//å»é‡</span></span><br><span class="line">      .withColumn(<span class="string">&quot;SPOT_ID&quot;</span>, row_number() over <span class="type">SPOT_ID_ORDER</span>)</span><br><span class="line">      .where(<span class="string">&quot;SPOT_ID&lt;&gt;9&quot;</span>) <span class="comment">//å› ä¸ºtxtä¸­å’Œcsvä¸­éƒ½æœ‰æ­¦å½“å±±æ™¯åŒºï¼Œä½†æ˜¯ä»‹ç»å¤šäº†ç©ºæ ¼ï¼Œæ‰€ä»¥ä¹Ÿè¦å»é‡</span></span><br><span class="line">      .withColumn(<span class="string">&quot;SPOT_ID&quot;</span>, row_number() over <span class="type">SPOT_ID_ORDER</span>) <span class="comment">//å»é‡ä»¥åé‡æ–°å¢åŠ åˆ—</span></span><br><span class="line">    spot_info_temp</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//è¯„è®ºè¡¨</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">commentWithSpot</span></span>(all_data: <span class="type">DataFrame</span>, spot_data: <span class="type">DataFrame</span>): <span class="type">DataFrame</span> = &#123;</span><br><span class="line">    <span class="keyword">val</span> comment_info_temp: <span class="type">DataFrame</span> = all_data.join(spot_data, all_data(<span class="string">&quot;SPOT&quot;</span>) === spot_data(<span class="string">&quot;SPOT_NAME&quot;</span>))</span><br><span class="line">      .selectExpr(<span class="string">&quot;SPOT_ID&quot;</span>, <span class="string">&quot;COMMENT&quot;</span>, <span class="string">&quot;COMMENT_GRADE&quot;</span>, <span class="string">&quot;COMMENT_TIME&quot;</span>)</span><br><span class="line">      .withColumnRenamed(<span class="string">&quot;COMMENT&quot;</span>, <span class="string">&quot;EVALUATION&quot;</span>)</span><br><span class="line">      .withColumnRenamed(<span class="string">&quot;COMMENT_GRADE&quot;</span>, <span class="string">&quot;EVALUATION_GRADE&quot;</span>)</span><br><span class="line">      .withColumnRenamed(<span class="string">&quot;COMMENT_TIME&quot;</span>, <span class="string">&quot;EVALUATION_TIME&quot;</span>)</span><br><span class="line">      .where(<span class="string">&quot;EVALUATION&lt;&gt;&#x27;NULL&#x27;&quot;</span>).distinct()</span><br><span class="line">      .withColumn(<span class="string">&quot;EVALUATION_ID&quot;</span>, row_number() over <span class="type">Window</span>.orderBy($<span class="string">&quot;SPOT_ID&quot;</span>)) <span class="comment">//å»é‡ä»¥åé‡æ–°å¢åŠ åˆ—</span></span><br><span class="line">    comment_info_temp</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">cityInfoClear</span></span>(spot_info:<span class="type">DataFrame</span>): <span class="type">DataFrame</span> =&#123;</span><br><span class="line">    spot_info.createOrReplaceTempView(<span class="string">&quot;spot_info&quot;</span>)</span><br><span class="line">    <span class="comment">//[\u4e00-\u9fa5]&#123;2&#125;(?=å¸‚)+å¸‚</span></span><br><span class="line">    <span class="keyword">val</span> city_final_frame: <span class="type">DataFrame</span> = sql(</span><br><span class="line">      <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        |select</span></span><br><span class="line"><span class="string">        |if(locate(&#x27;å¸‚&#x27;,LOCATION)&lt;&gt;&#x27;0&#x27;,regexp_extract(LOCATION,&quot;([^å¸‚]&#123;2&#125;()+å¸‚)&quot;),regexp_extract(LOCATION,&quot;([^çœ]+çœ)?([^è‡ªæ²»å·]+è‡ªæ²»å·)&quot;, 2)) as CITY_NAME</span></span><br><span class="line"><span class="string">        |from</span></span><br><span class="line"><span class="string">        |spot_info</span></span><br><span class="line"><span class="string">        |&quot;&quot;&quot;</span>.stripMargin)</span><br><span class="line">      .distinct()</span><br><span class="line">      <span class="comment">//å¡«å……CITY_Id</span></span><br><span class="line">      .withColumn(<span class="string">&quot;CITY_ID&quot;</span>, row_number() over <span class="type">Window</span>.orderBy($<span class="string">&quot;CITY_NAME&quot;</span>.desc))</span><br><span class="line">    city_final_frame</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//æ™¯åŒºè¡¨æŒ‚åŸå¸‚id</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">spotWithCityId</span></span>(spot_info:<span class="type">DataFrame</span>,city_temp:<span class="type">DataFrame</span>): <span class="type">DataFrame</span> =&#123;</span><br><span class="line">    spot_info.createOrReplaceTempView(<span class="string">&quot;spot_info&quot;</span>)</span><br><span class="line">    city_temp.createOrReplaceTempView(<span class="string">&quot;city_info&quot;</span>)</span><br><span class="line">    <span class="keyword">val</span> spot_test: <span class="type">DataFrame</span> = sql(</span><br><span class="line">      <span class="string">s&quot;&quot;</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">         |with t1 as (</span></span><br><span class="line"><span class="string">         |select</span></span><br><span class="line"><span class="string">         |*,</span></span><br><span class="line"><span class="string">         |if(locate(&#x27;å¸‚&#x27;,LOCATION)&lt;&gt;&#x27;0&#x27;,regexp_extract(LOCATION,&quot;</span>([^å¸‚]&#123;<span class="number">2</span>&#125;()+å¸‚)<span class="string">&quot;),regexp_extract(LOCATION,&quot;</span>([^çœ]+çœ)?([^è‡ªæ²»å·]+è‡ªæ²»å·)<span class="string">&quot;, 2)) as NAME</span></span><br><span class="line"><span class="string">         |from</span></span><br><span class="line"><span class="string">         |spot_info)</span></span><br><span class="line"><span class="string">         |select</span></span><br><span class="line"><span class="string">         |t1.*,</span></span><br><span class="line"><span class="string">         |ci.CITY_ID</span></span><br><span class="line"><span class="string">         |from</span></span><br><span class="line"><span class="string">         |t1</span></span><br><span class="line"><span class="string">         |join city_info ci on ci.CITY_NAME = t1.NAME</span></span><br><span class="line"><span class="string">         |&quot;</span><span class="string">&quot;&quot;</span>.stripMargin).drop(<span class="string">&quot;NAME&quot;</span>)</span><br><span class="line">    spot_test</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="éšæœºæ£®æ—å¯¹hotå¡«å……">éšæœºæ£®æ—å¯¹hotå¡«å……</h3><p>è¿™å—è‡ªå·±ç ”ç©¶äº†ä¸€ä¸‹åˆ+ä¸€æ™šä¸Šæ‰æå®š</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//éšæœºæ£®æ— hotçš„nullå¡«å……</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">spotPredictionFinalTable</span></span>(spot_info_temp: <span class="type">DataFrame</span>): <span class="type">DataFrame</span> =&#123;</span><br><span class="line">    <span class="comment">// è¯»å–æ•°æ®</span></span><br><span class="line">    <span class="keyword">val</span> data: <span class="type">DataFrame</span> = spot_info_temp.selectExpr(<span class="string">&quot;SPOT_ID&quot;</span>,<span class="string">&quot;GRADE&quot;</span>,<span class="string">&quot;HOT&quot;</span>,<span class="string">&quot;SUM&quot;</span>)</span><br><span class="line">    .withColumn(<span class="string">&quot;GRADE&quot;</span>,$<span class="string">&quot;GRADE&quot;</span>.cast(<span class="type">DoubleType</span>))</span><br><span class="line">    .withColumn(<span class="string">&quot;HOT&quot;</span>,$<span class="string">&quot;HOT&quot;</span>.cast(<span class="type">DoubleType</span>))</span><br><span class="line">    .withColumn(<span class="string">&quot;SUM&quot;</span>,regexp_extract($<span class="string">&quot;SUM&quot;</span>,<span class="string">&quot;[^æ¡]+()&quot;</span>,<span class="number">0</span>).cast(<span class="type">DoubleType</span>))</span><br><span class="line">    <span class="keyword">val</span> data2: <span class="type">DataFrame</span> = spot_info_temp</span><br><span class="line">    .withColumn(<span class="string">&quot;HOT&quot;</span>,$<span class="string">&quot;HOT&quot;</span>.cast(<span class="type">DoubleType</span>))</span><br><span class="line">    <span class="keyword">val</span> meanValues: <span class="type">Double</span> = data.agg(round(avg(col(<span class="string">&quot;HOT&quot;</span>)),<span class="number">1</span>)).head().getDouble(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">val</span> filledData: <span class="type">DataFrame</span> = data.na.fill(meanValues, <span class="type">Seq</span>(<span class="string">&quot;HOT&quot;</span>))</span><br><span class="line">    <span class="comment">// å°†ç‰¹å¾è½¬åŒ–ä¸ºå‘é‡</span></span><br><span class="line">    <span class="keyword">val</span> assembler: <span class="type">VectorAssembler</span> = <span class="keyword">new</span> <span class="type">VectorAssembler</span>()</span><br><span class="line">    .setInputCols(<span class="type">Array</span>(<span class="string">&quot;GRADE&quot;</span>, <span class="string">&quot;SUM&quot;</span>))</span><br><span class="line">    .setOutputCol(<span class="string">&quot;features&quot;</span>)</span><br><span class="line">    <span class="keyword">val</span> assembledData: <span class="type">DataFrame</span> = assembler.transform(filledData)</span><br><span class="line">    <span class="comment">// åˆ›å»ºéšæœºæ£®æ—å›å½’æ¨¡å‹</span></span><br><span class="line">    <span class="keyword">val</span> rf: <span class="type">RandomForestRegressor</span> = <span class="keyword">new</span> <span class="type">RandomForestRegressor</span>()</span><br><span class="line">    .setLabelCol(<span class="string">&quot;HOT&quot;</span>)</span><br><span class="line">    .setFeaturesCol(<span class="string">&quot;features&quot;</span>)</span><br><span class="line">    <span class="comment">// æ‹Ÿåˆæ¨¡å‹</span></span><br><span class="line">    <span class="keyword">val</span> model: <span class="type">RandomForestRegressionModel</span> = rf.fit(assembledData)</span><br><span class="line">    <span class="comment">// ä½¿ç”¨æ¨¡å‹å¡«å……ç¼ºå¤±å€¼</span></span><br><span class="line">    <span class="keyword">val</span> predictedData: <span class="type">DataFrame</span> = data.na.fill(meanValues, <span class="type">Seq</span>(<span class="string">&quot;HOT&quot;</span>))</span><br><span class="line">    <span class="keyword">val</span> assembledPredictedData: <span class="type">DataFrame</span> = assembler.transform(predictedData)</span><br><span class="line">    <span class="keyword">val</span> filledPredictedData: <span class="type">DataFrame</span> = model.transform(assembledPredictedData)</span><br><span class="line">    .withColumn(<span class="string">&quot;prediction&quot;</span>, round(col(<span class="string">&quot;prediction&quot;</span>), <span class="number">1</span>))</span><br><span class="line">    <span class="comment">//æ‰€æœ‰æ™¯åŒºçš„hoté¢„æµ‹</span></span><br><span class="line">    <span class="keyword">val</span> predict: <span class="type">DataFrame</span> = filledPredictedData.selectExpr(<span class="string">&quot;SPOT_ID&quot;</span>,<span class="string">&quot;prediction&quot;</span>).withColumnRenamed(<span class="string">&quot;SPOT_ID&quot;</span>,<span class="string">&quot;id&quot;</span>)</span><br><span class="line">    <span class="comment">//å°†hotçš„é¢„æµ‹å€¼ å¡«å……null å¹¶å°†hotå’Œgradeç±»å‹è½¬æ¢æˆdouble</span></span><br><span class="line">    data2.join(predict,predict(<span class="string">&quot;id&quot;</span>) === data2(<span class="string">&quot;SPOT_ID&quot;</span>))</span><br><span class="line">    .withColumn(<span class="string">&quot;HOT&quot;</span>,</span><br><span class="line">                when(col(<span class="string">&quot;HOT&quot;</span>).isNull, col(<span class="string">&quot;prediction&quot;</span>)).otherwise(col(<span class="string">&quot;hot&quot;</span>)))</span><br><span class="line">    .withColumn(<span class="string">&quot;HOT&quot;</span>,round($<span class="string">&quot;HOT&quot;</span>,<span class="number">1</span>))</span><br><span class="line">    .withColumn(<span class="string">&quot;GRADE&quot;</span>,round($<span class="string">&quot;GRADE&quot;</span>,<span class="number">1</span>))</span><br><span class="line">    .drop(<span class="string">&quot;id&quot;</span>,<span class="string">&quot;prediction&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="BUG-4">BUG</h2><p>â€‹é¢„æµ‹è¿™è¾¹çš„æŠ¥é”™è¿˜æ˜¯æŒºå¤šçš„ï¼Œä½†æ˜¯ä¸»è¦æŠ¥é”™éƒ½æ˜¯è‡ªå·±è®¾ç½®æ¨¡å‹çš„æ—¶å€™å­—æ®µæ²¡çœ‹æ¸…æ¥šï¼Œéƒ½æ˜¯xxxå­—æ®µä¸å­˜åœ¨ä¹‹ç±»çš„ï¼Œæ…¢æ…¢ä¿®æ”¹ä»¥åå‘ç°é¢„æµ‹æ•ˆæœè¿˜å¯ä»¥ã€‚</p><h2 id="æ—¥æ€»ç»“-4">æ—¥æ€»ç»“</h2><blockquote><p>â€‹ä»Šå¤©çš„ä»»åŠ¡è¿˜æ˜¯æ•´åˆå’Œé¢„æµ‹å¡«å……ï¼Œæœ¬æ¥æ‰“ç®—ç”¨ä¸­ä½æ•°æˆ–è€…avgå¹³å‡å€¼å¡«å……çš„ï¼Œä½†æ˜¯æ•°æ®å±•ç¤ºçš„è¯ï¼Œä¸€è¡Œå¹³çš„ä¸å¤ªå¥½çœ‹ï¼Œæ‰€ä»¥ä½¿ç”¨äº†é¢„æµ‹ï¼Œé¢„æµ‹é‚£å—è¿˜æ˜¯æŒºéš¾æ‡‚çš„ï¼Œç®€å•è¯´å°±æ˜¯åˆ©ç”¨å·²çŸ¥çš„ä¼šå½±å“ç¼ºå¤±å€¼çš„æ•°æ®ï¼Œåšæ¨¡å‹çš„æ”¯æ’‘æ•°æ®ï¼Œç®—å‡ºç¼ºå¤±çš„hotã€‚åŸç†å°±æ˜¯å›å½’ç®—æ³•ï¼Œç®€å•è¯´å°±æ˜¯ä½ å¯¹ä¸€ä¸ªæ•°æ®æ‰“åˆ†äº†ï¼Œæ•°æ®å…¶å®ä¹Ÿä¼šåæ˜ å‡ºä½ çš„ä¹ æƒ¯ä¹‹ç±»çš„ï¼Œæ˜¯ä¸€ä¸ªç›¸äº’çš„è¿‡ç¨‹ï¼Œéšæœºæ£®æ—å°±æ˜¯åˆ©ç”¨è¿™ç‚¹ï¼Œåå‘æ¨æµ‹å‡ºæ•°æ®ã€‚</p></blockquote><h1 id="pythonè¯„è®ºè¡¨ä¼˜åŒ–">pythonè¯„è®ºè¡¨ä¼˜åŒ–</h1><h2 id="å­¦ä¹ æ—¥æœŸ-6-6">å­¦ä¹ æ—¥æœŸ: 6.6</h2><h2 id="é¡¹ç›®ä»»åŠ¡-5">é¡¹ç›®ä»»åŠ¡</h2><h3 id="èµ·å› -2">èµ·å› </h3><p>â€‹å› ä¸ºè¯„è®ºè¡¨ä¸­gradeå­—æ®µå¾ˆå¤šæ˜¯ç¼ºå¤±çš„ï¼Œåˆå› ä¸ºä¹‹å‰è‡ªå·±æ˜¯å¯¹è¯­è¨€è¿›è¡Œè¿‡æƒ…ç»ªåˆ†åˆ†æçš„æ‰€ä»¥ï¼Œå¯¹äºè¿™éƒ¨åˆ†ç¼ºå¤±å€¼å¯ä»¥å¡«å……ï¼Œç„¶åå°±æ˜¯ipä»¥åŠæ—¶é—´äº†ï¼Œå‘ç°äº†ä¸€ä¸ªå¾ˆå¥½ç”¨çš„ç±»fakerï¼Œä»–å¯ä»¥éšæœºç”Ÿæˆçœä»½ä»¥åŠåœ°å€ï¼Œåˆå› ä¸ºå…¶ä»–æ•°æ®çš„çœä»½å¥½åƒéƒ½æ˜¯ä¸¤å­—è€Œä¸”ä¸å¸¦çœå’Œè‡ªæ²»å·è¿™äº›çš„ï¼Œå°±ç¨åŠ å¤„ç†äº†ä¸€ä¸‹ç”¨äº†é€’å½’ã€‚</p><h3 id="ä»£ç å¦‚ä¸‹-2">ä»£ç å¦‚ä¸‹</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> radar</span><br><span class="line"><span class="keyword">from</span> faker <span class="keyword">import</span> Faker</span><br><span class="line"><span class="keyword">from</span> finalMain.DmConnect <span class="keyword">import</span> connDm</span><br><span class="line"><span class="keyword">from</span> snownlp <span class="keyword">import</span> SnowNLP</span><br><span class="line"><span class="keyword">from</span> snownlp <span class="keyword">import</span> sentiment</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> sqlalchemy <span class="keyword">import</span> create_engine</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">provinceRandom</span>() -&gt; <span class="built_in">str</span>:</span><br><span class="line">    f = Faker(<span class="string">&#x27;zh_CN&#x27;</span>)</span><br><span class="line">    province = f.province()</span><br><span class="line">    <span class="keyword">if</span> province.find(<span class="string">&quot;çœ&quot;</span>) != -<span class="number">1</span> <span class="keyword">or</span> province.find(<span class="string">&quot;å¸‚&quot;</span>) != -<span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> province[<span class="number">0</span>:-<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">return</span> provinceRandom()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">provinceList</span>():</span><br><span class="line">    province_list = []</span><br><span class="line">    <span class="keyword">while</span> <span class="built_in">len</span>(province_list) &lt;= <span class="number">26</span>:</span><br><span class="line">        province = provinceRandom()</span><br><span class="line">        <span class="keyword">if</span> province <span class="keyword">not</span> <span class="keyword">in</span> province_list:</span><br><span class="line">            province_list.append(province)</span><br><span class="line">    <span class="keyword">return</span> province_list</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ¤æ–­æƒ…ç»ªè¯„åˆ† å¹¶è¿”å›ç›¸å¯¹åº”çš„å€¼</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">scoreSnow</span>(<span class="params">sentiments</span>):</span><br><span class="line">    <span class="comment"># sentiments = SnowNLP(comment).sentiments</span></span><br><span class="line">    <span class="keyword">if</span> <span class="number">0.9</span> &lt;= sentiments &lt;= <span class="number">1</span>:</span><br><span class="line">        feelMood = <span class="string">&quot;è¶…æ£’&quot;</span></span><br><span class="line">    <span class="keyword">elif</span> <span class="number">0.8</span> &lt;= sentiments &lt;= <span class="number">0.9</span>:</span><br><span class="line">        feelMood = <span class="string">&quot;æ»¡æ„&quot;</span></span><br><span class="line">    <span class="keyword">elif</span> <span class="number">0.5</span> &lt;= sentiments &lt;= <span class="number">0.8</span>:</span><br><span class="line">        feelMood = <span class="string">&quot;ä¸é”™&quot;</span></span><br><span class="line">    <span class="keyword">elif</span> <span class="number">0.2</span> &lt;= sentiments &lt;= <span class="number">0.5</span>:</span><br><span class="line">        feelMood = <span class="string">&quot;ä¸€èˆ¬&quot;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        feelMood = <span class="string">&quot;ä¸ä½³&quot;</span></span><br><span class="line">    <span class="keyword">return</span> feelMood</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># åŠ å…¥dmæ•°æ®åº“</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">intoDm</span>(<span class="params">data, tableName</span>):</span><br><span class="line">    <span class="comment"># åˆ›å»ºurl</span></span><br><span class="line">    conn_url = <span class="string">&#x27;dm+dmPython://SYSDBA:SYSDBA@47.120.9.247:5236/&#x27;</span></span><br><span class="line">    <span class="comment"># åˆ›å»ºEngineå¯¹è±¡</span></span><br><span class="line">    engine = create_engine(conn_url)</span><br><span class="line">    <span class="comment"># åˆ°dm8ä¸­</span></span><br><span class="line">    data.to_sql(name=tableName, con=engine, if_exists=<span class="string">&#x27;append&#x27;</span>, index=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">commentDataFinalIntoDm</span>():</span><br><span class="line">    data_path = os.path.join(os.path.dirname(os.path.abspath(__file__)), <span class="string">&#x27;snownlpDrill/sentiment.marshal&#x27;</span>)</span><br><span class="line">    sentiment.load(data_path)</span><br><span class="line"></span><br><span class="line">conn = connDm()</span><br><span class="line"><span class="comment"># è·å–æ¸¸æ ‡</span></span><br><span class="line">cur = conn.cursor()</span><br><span class="line"><span class="comment"># æŸ¥è¯¢è¯„è®ºè¡¨å…¨éƒ¨æ•°æ®</span></span><br><span class="line">cur.execute(<span class="string">&quot;select * from COMMENT_TEMP&quot;</span>)</span><br><span class="line">comment_list: <span class="built_in">list</span> = cur.fetchall()</span><br><span class="line">comment_df = pd.DataFrame(comment_list,</span><br><span class="line">                          columns=[<span class="string">&quot;SPOT_ID&quot;</span>, <span class="string">&quot;EVALUATION&quot;</span>, <span class="string">&quot;EVALUATION_GRADE&quot;</span>, <span class="string">&quot;EVALUATION_TIME&quot;</span>, <span class="string">&quot;EVALUATION_ID&quot;</span>])</span><br><span class="line"><span class="comment"># å°†EVALUATION_IDä½œä¸ºè¡Œç´¢å¼•</span></span><br><span class="line"><span class="comment"># comment_df.set_index(&#x27;EVALUATION_ID&#x27;, inplace=True)</span></span><br><span class="line"><span class="comment"># æ·»åŠ ä¸¤åˆ—ä¸ºç©ºå€¼ å­˜æ”¾æƒ…ç»ªåˆ†å’Œå¯¹åº”çš„æƒ…ç»ª</span></span><br><span class="line">comment_df[<span class="string">&#x27;FEEL_SCORE&#x27;</span>] = <span class="string">&#x27;&#x27;</span></span><br><span class="line">comment_df[<span class="string">&#x27;FEEL&#x27;</span>] = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># çœä»½åˆ—è¡¨</span></span><br><span class="line">province_list = provinceList()</span><br><span class="line"></span><br><span class="line"><span class="comment"># éå†è¯„è®ºid</span></span><br><span class="line"><span class="keyword">for</span> index <span class="keyword">in</span> <span class="built_in">list</span>(comment_df.index):</span><br><span class="line"></span><br><span class="line">    <span class="comment"># è·å–å¯¹åº”çš„è¯„è®ºidçš„è¯„è®º</span></span><br><span class="line">    comment_values = comment_df[<span class="string">&#x27;EVALUATION&#x27;</span>]</span><br><span class="line">    comment_value = comment_values.loc[index]</span><br><span class="line">    <span class="keyword">if</span> comment_df[<span class="string">&#x27;EVALUATION_TIME&#x27;</span>].loc[index] == <span class="string">&quot;&quot;</span>:</span><br><span class="line">        random_index = random.randrange(<span class="built_in">len</span>(province_list))</span><br><span class="line">        comment_df.iloc[index - <span class="number">1</span>, <span class="number">3</span>] = <span class="built_in">str</span>(radar.random_date(<span class="string">&quot;2020-09-13&quot;</span>, <span class="string">&quot;2023-02-02&quot;</span>).date()) + <span class="string">&quot;IPå±åœ°: &quot;</span> + \</span><br><span class="line">                                        province_list[random_index]</span><br><span class="line">    <span class="comment"># è®¡ç®—å‡ºè¯¥è¯„è®ºçš„æƒ…ç»ªåˆ†å€¼</span></span><br><span class="line">    score = <span class="built_in">round</span>(SnowNLP(comment_value).sentiments, <span class="number">2</span>)</span><br><span class="line">    <span class="comment"># æ·»åŠ åˆ°feelScoreåˆ—</span></span><br><span class="line">    feelScore = <span class="built_in">round</span>(score * <span class="number">5</span>, <span class="number">1</span>)</span><br><span class="line">    comment_df.iloc[index - <span class="number">1</span>, <span class="number">5</span>] = feelScore</span><br><span class="line">    <span class="comment"># è¯„è®ºæƒ…ç»ª</span></span><br><span class="line">    feel = scoreSnow(score)</span><br><span class="line">    comment_df.iloc[index - <span class="number">1</span>, <span class="number">6</span>] = feel</span><br><span class="line">    <span class="keyword">if</span> comment_df[<span class="string">&#x27;EVALUATION_GRADE&#x27;</span>].loc[index] == <span class="string">&quot;&quot;</span>:</span><br><span class="line">        comment_df.iloc[index - <span class="number">1</span>, <span class="number">2</span>] = <span class="built_in">str</span>(<span class="built_in">int</span>(<span class="built_in">round</span>(feelScore, <span class="number">0</span>))) + <span class="string">&quot;åˆ† &quot;</span> + feel</span><br><span class="line">    intoDm(comment_df, <span class="string">&quot;COMMENT_INFO&quot;</span>)</span><br><span class="line">commentDataFinalIntoDm()</span><br></pre></td></tr></table></figure><h3 id="æ•°æ®å¤„ç†æ•ˆæœ">æ•°æ®å¤„ç†æ•ˆæœ</h3><p>â€‹é¢„æµ‹ä¸å‡†çš„æƒ…å†µè¿˜åœ¨è§£å†³ï¼Œä½†ä¸æ˜¯ç°åœ¨çš„é‡ç‚¹ã€‚</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/image-20250820102614241.png" alt="image-20250820102614241"></p><h2 id="BUG-5">BUG</h2><p>â€‹æ²¡æ‰¾åˆ°åŸå› ï¼Œåº”è¯¥æ˜¯è‡ªå·±çš„ä¸­ä½æ•°æ˜¯stringç±»å‹çš„å§å¯èƒ½ï¼Œå› ä¸ºè¿™å—æœ¬æ¥æ˜¯å¯¹sumå­—æ®µç”¨ä¸­ä½æ•°å¡«å……çš„ï¼Œä½†æ˜¯åé¢å‘ç°æ•°æ®éƒ½æ˜¯æœ‰sumçš„ï¼Œå°±ç›´æ¥æ³¨é‡Šäº†ã€‚</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/image-20250820102619588.png" alt="image-20250820102619588"></p><h2 id="æ—¥æ€»ç»“-5">æ—¥æ€»ç»“</h2><blockquote><p>â€‹ä»Šæ—¥ä»»åŠ¡ä¸»è¦æ˜¯ä¼˜åŒ–ï¼Œç„¶åæµ‹è¯•äº†å¤šæ¬¡ï¼Œä»ç©ºè¡¨ç›´æ¥æ‰§è¡Œä¸€æ¬¡sparkä»£ç ä¸€æ¬¡pyä»£ç å°±å°†æ•°æ®å¤„ç†å¥½å¹¶å­˜å…¥dmçš„æ•°æ®åº“ä¸­äº†ã€‚ä»Šå¤©ä¸»è¦æ˜¯æ”¶è·æ˜¯å‘ç°äº†ä¸€ä¸ªå¾ˆå¥½ç”¨çš„èƒ½å¡«å……éšæœºå‚æ•°äº†ç±»ï¼Œpython fakeråº“èƒ½éšæœºç”Ÿæˆå¾ˆå¤šéœ€è¦çš„ä¸ªäººä¿¡æ¯æˆ–è€…ç¼–ç ä¹‹ç±»çš„æŒºå¤šæ•°æ®çš„ï¼Œè€Œä¸”æ ¼å¼å¯ä»¥è°ƒï¼Œè¿˜æ˜¯å¾ˆä¸é”™çš„ã€‚</p></blockquote><h1 id="ä½¿ç”¨spark-submitæäº¤">ä½¿ç”¨spark-submitæäº¤</h1><h2 id="å­¦ä¹ æ—¥æœŸ-6-7">å­¦ä¹ æ—¥æœŸ: 6.7</h2><h2 id="é¡¹ç›®ä»»åŠ¡-6">é¡¹ç›®ä»»åŠ¡</h2><p>â€‹å°†è‡ªå·±ç”µè„‘å†…çš„hadoopå¯åŠ¨ï¼Œç”¨sparkæäº¤å°è¯•æé«˜æ¸…æ´—è¿è¡Œé€Ÿåº¦ã€‚å¤§æ¦‚éœ€è¦1åˆ†é’Ÿä¸€æ¬¡ï¼Œé—®é¢˜å‡ºç°åœ¨è¿‡ç¨‹ä¸­ä½¿ç”¨äº†javaçš„ä»£ç ï¼Œjavaåˆä¸æ”¯æŒåˆ†å¸ƒå¼è®¡ç®—å¹³å°ï¼Œæ‰€ä»¥å¯¼è‡´æ—¶é—´ç”»å¾—æ¯”è¾ƒä¹…ï¼Œè€Œä¸”sparkå¯åŠ¨ä¹Ÿä¼šèŠ±è´¹æ—¶é—´ã€‚</p><p>â€‹ç”µè„‘åˆè£…äº†ä¸€ä¸ªä¼ªåˆ†å¸ƒå¼çš„hadoopï¼ŒèŠ±äº†ä¸€ä¸Šåˆçš„æ—¶é—´ï¼Œä¸‹åˆå°±åœ¨æµ‹è¯•äº†ï¼Œå¤§æ¦‚æ´—å®Œæ ·æ•°æ®ï¼Œåªè¦2åˆ†é’Ÿï¼Œä¸€æ¬¡jaråŒ…ï¼Œä¸€æ¬¡pythonæ‰§è¡Œã€‚å®‰è£…hadoopæ­¥éª¤å°±ä¸å†™äº†ï¼ŒæŒ‚ä¸ªç½‘å€å¥½äº†ï¼Œ<a href="http://t.csdn.cn/SuQmN%EF%BC%8C%E6%89%BEhadoop3.2.2%E8%8A%B1%E8%B4%B9%E4%BA%86%E7%82%B9%E6%97%B6%E9%97%B4%EF%BC%8C%E8%BF%98%E9%9C%80%E8%A6%81%E5%AF%B9%E5%BA%94%E7%89%88%E6%9C%AC%E7%9A%84window.exe">http://t.csdn.cn/SuQmNï¼Œæ‰¾hadoop3.2.2èŠ±è´¹äº†ç‚¹æ—¶é—´ï¼Œè¿˜éœ€è¦å¯¹åº”ç‰ˆæœ¬çš„window.exe</a></p><h2 id="BUG-6">BUG</h2><p>â€‹ä½¿ç”¨spark-submitæäº¤jaråŒ…è¯»å–å‘ç°æœ‰éƒ¨åˆ†ä¹±ç ï¼Œä»”ç»†çœ‹äº†çœ‹éƒ½æ˜¯åœ¨åé¢çš„æ•°æ®ï¼Œå¥½åƒå°±æ˜¯3000æ¡ï¼Œé‚£å°±æ˜¯javaæ´—çš„ï¼Œå»æ‰¾javaé‚£éƒ¨åˆ†ä»£ç çš„æ ¼å¼é—®é¢˜ï¼Œå‘ç°è¯»txtæ–‡ä»¶çš„æ—¶å€™å°±å·²ç»ä¹±ç äº†ï¼Œèµ·åˆè¿˜ä»¥ä¸ºæ˜¯å¯¼å…¥æ•°æ®åº“æ‰ä¹±ç ï¼Œè¿˜ä¿®æ”¹äº†urlç»“æœæ˜¯IOæµçš„é—®é¢˜reader = new InputStreamReader(file, StandardCharsets.UTF_8);è¯»æ–‡ä»¶çš„æ—¶å€™åŠ ç¼–ç æ ¼å¼å°±è¡Œäº†ã€‚</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/image-20250820102631492.png" alt="image-20250820102631492"></p><p>â€‹javaéƒ¨åˆ†çš„æŠ¥é”™ï¼Œä¸€ç›´è¯´æ‰¾ä¸åˆ°city.jsonï¼Œæ‰“å®ŒjaråŒ…ä¹Ÿæ²¡ææ‡‚ä»–è¯»å–æ–‡ä»¶çš„è·¯å¾„ç›¸å¯¹è·¯å¾„åˆ°åº•æ€ä¹ˆå†™ï¼Œç›´æ¥å†™ç»å¯¹è·¯å¾„äº†ï¼Œç­‰æ”¾æœåŠ¡å™¨ä¸­å†æ”¹å¥½äº†ã€‚</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/image-20250820102636725.png" alt="image-20250820102636725"></p><h2 id="æ—¥æ€»ç»“-6">æ—¥æ€»ç»“</h2><blockquote><p>â€‹ä»Šå¤©åˆšæŠŠå¹³å°å‘æ”¾ï¼Œè¿˜å’©æœ‰ç ”ç©¶æ˜ç™½ï¼Œç°æµ‹è¯•è‡ªå·±çš„æ¸…æ´—ä»£ç æ‰“jaråŒ…èƒ½ä¸èƒ½é¡ºåˆ©æ‰§è¡Œï¼Œä¸Šåˆé…ç½®äº†hadoopä»¥åŠsparkçš„ç¯å¢ƒï¼Œä¸‹åˆå¯¹æ‰“å®ŒjaråŒ…ä»¥åï¼Œä¸€äº›è·¯å¾„å’Œç¼–ç è¿™æ ·çš„å°ç»†èŠ‚è¿›è¡Œäº†å¤„ç†ï¼Œç›®å‰æ„Ÿè§‰æœ€ä¸»è¦çš„æ˜¯å¹³å°çš„ä½¿ç”¨ï¼Œæ¸…æ´—è¿™éƒ¨åˆ†å¯¹æ ·æ•°æ®æ˜¯æ²¡ä»€ä¹ˆé—®é¢˜äº†ï¼Œè¿˜å¾—çœ‹hdfsçš„æ•°æ®ï¼Œå¦‚æœç›¸å·®å¾ˆå¤§å°±ç³Ÿç³•äº†ã€‚</p></blockquote><h1 id="æ¸…æ´—txtæ–‡ä»¶å¤¹">æ¸…æ´—txtæ–‡ä»¶å¤¹</h1><h2 id="å­¦ä¹ æ—¥æœŸ-6-8">å­¦ä¹ æ—¥æœŸ: 6.8</h2><h2 id="é¡¹ç›®ä»»åŠ¡-7">é¡¹ç›®ä»»åŠ¡</h2><h3 id="èµ·å› -3">èµ·å› </h3><p>â€‹å› ä¸ºå…³ç³»åˆ°æ¸…æ´—æµ‹è¯•ä»¥åŠé€Ÿåº¦é—®é¢˜ï¼Œä¹‹å‰è‡ªå·±1wæ¡æ•°æ®å°±èŠ±è´¹äº†1åˆ†é’Ÿæ¸…æ´—ï¼Œè¿™ä¸€äº›å¢åŠ åˆ°äº†ç™¾ä¸‡æ¡ï¼Œè‡ªå·±é‚£ç§ä»£ç è‚¯å®šä¸è¡Œäº†å°¤å…¶æ˜¯javaå¤„ç†txté‚£è¾¹ï¼Œä¼°è®¡æ˜¯å†…å­˜éƒ½è¦çˆ†ï¼Œå¾—æ¢æˆpandasäº†ï¼Œä¹‹å‰sparkä»£ç å°±è¦æ¨ç¿»é‡æ–°æäº†ï¼Œè¦çº¯pythonæ¸…æ´—äº†ã€‚</p><h3 id="æ¸…æ´—txt">æ¸…æ´—txt</h3><p>â€‹å› ä¸ºtxtæ˜¯ä¹‹å‰æˆ‘è§‰å¾—æœ€éš¾çš„ï¼Œæ‰€ä»¥å…ˆä½¿ç”¨ä¸€äº›pythonå¯¹txtèƒ½ä¸èƒ½å¾ˆå¥½çš„å¤„ç†ä»¥åŠæ•ˆæœã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> radar</span><br><span class="line"><span class="keyword">from</span> faker <span class="keyword">import</span> Faker</span><br><span class="line"><span class="keyword">from</span> hdfs3 <span class="keyword">import</span> HDFileSystem</span><br><span class="line"><span class="keyword">import</span> glob</span><br><span class="line"><span class="keyword">from</span> snownlp <span class="keyword">import</span> SnowNLP</span><br><span class="line"></span><br><span class="line"><span class="comment">#å¤„ç†è¯„è®º æƒ…ç»ªåŒ–æ‰“åˆ†</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">scoreSnow</span>(<span class="params">sentiments</span>):</span><br><span class="line">    <span class="comment"># sentiments = SnowNLP(comment).sentiments</span></span><br><span class="line">    <span class="keyword">if</span> <span class="number">0.9</span> &lt;= sentiments &lt;= <span class="number">1</span>:</span><br><span class="line">        feelMood = <span class="string">&quot;è¶…æ£’&quot;</span></span><br><span class="line">    <span class="keyword">elif</span> <span class="number">0.8</span> &lt;= sentiments &lt;= <span class="number">0.9</span>:</span><br><span class="line">        feelMood = <span class="string">&quot;æ»¡æ„&quot;</span></span><br><span class="line">    <span class="keyword">elif</span> <span class="number">0.5</span> &lt;= sentiments &lt;= <span class="number">0.8</span>:</span><br><span class="line">        feelMood = <span class="string">&quot;ä¸é”™&quot;</span></span><br><span class="line">    <span class="keyword">elif</span> <span class="number">0.2</span> &lt;= sentiments &lt;= <span class="number">0.5</span>:</span><br><span class="line">        feelMood = <span class="string">&quot;ä¸€èˆ¬&quot;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        feelMood = <span class="string">&quot;ä¸ä½³&quot;</span></span><br><span class="line">    <span class="keyword">return</span> feelMood</span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†æ‰€æœ‰çš„çœä»½ å»æ‰æœ€åçš„çœå’Œå¸‚ é€’å½’æ‰¾åˆ°åªä¸ºçœå’Œç›´è¾–å¸‚çš„åœ°å€</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">provinceRandom</span>() -&gt; <span class="built_in">str</span>:</span><br><span class="line">    f = Faker(<span class="string">&#x27;zh_CN&#x27;</span>)</span><br><span class="line">    province = f.province()</span><br><span class="line">    <span class="keyword">if</span> province.find(<span class="string">&quot;çœ&quot;</span>) != -<span class="number">1</span> <span class="keyword">or</span> province.find(<span class="string">&quot;å¸‚&quot;</span>) != -<span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> province[<span class="number">0</span>:-<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">return</span> provinceRandom()</span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†åœ°å€éƒ½æ”¾å…¥åˆ—è¡¨ï¼Œè¿™æ ·å¡«å……ä¼šå¿«å¾ˆå¤šï¼Œå› ä¸ºé€’å½’ç®—æ³•åªç”¨æ‰§è¡Œåˆ°26ä¸ªéƒ½å–åˆ°å³å¯ã€‚</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">provinceList</span>():</span><br><span class="line">    province_list = []</span><br><span class="line">    <span class="keyword">while</span> <span class="built_in">len</span>(province_list) &lt;= <span class="number">26</span>:</span><br><span class="line">        province = provinceRandom()</span><br><span class="line">        <span class="keyword">if</span> province <span class="keyword">not</span> <span class="keyword">in</span> province_list:</span><br><span class="line">            province_list.append(province)</span><br><span class="line">    <span class="keyword">return</span> province_list</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¯»å–hdfsæ–‡ä»¶</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hdfsFileRead</span>():</span><br><span class="line">    <span class="comment"># åˆ›å»ºä¸€ä¸ª HDFileSystem å¯¹è±¡</span></span><br><span class="line">    hdfs = HDFileSystem(host=<span class="string">&#x27;hadoopb-namenode.damengb-zone.svc&#x27;</span>, port=<span class="number">9000</span>)</span><br><span class="line">    <span class="comment"># è¯»å– HDFS æ–‡ä»¶å¤¹ä¸­çš„æ‰€æœ‰æ–‡ä»¶</span></span><br><span class="line">    file_list = hdfs.ls(<span class="string">&#x27;/data/txt&#x27;</span>)</span><br><span class="line">    hdfsConfig = hdfsFileRead()</span><br><span class="line">    hdfs = hdfsConfig[<span class="number">0</span>]</span><br><span class="line">    file_list = hdfsConfig[<span class="number">1</span>]</span><br><span class="line">    <span class="comment"># è¯»å–æ–‡æœ¬æ–‡ä»¶</span></span><br><span class="line">    <span class="keyword">for</span> f <span class="keyword">in</span> file_list:</span><br><span class="line">        <span class="keyword">with</span> hdfs.<span class="built_in">open</span>(f) <span class="keyword">as</span> file:</span><br><span class="line">            text = file.read()</span><br><span class="line">    <span class="keyword">return</span> hdfs, file_list</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># æœ¬åœ°æµ‹è¯•è¯»å–æ–‡ä»¶</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">LoadFileRead</span>():</span><br><span class="line">    folder_path = <span class="string">r&#x27;/data/txt&#x27;</span></span><br><span class="line">    file_names = os.listdir(folder_path)</span><br><span class="line">    <span class="keyword">return</span> file_names</span><br><span class="line"><span class="comment"># å¤„ç†æ™¯åŒºè¡¨</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">clearSpot</span>():</span><br><span class="line">    spot_df = df[df.columns[<span class="number">0</span>:<span class="number">11</span>]].drop_duplicates()</span><br><span class="line">    spot_df[<span class="string">&#x27;rating&#x27;</span>] = <span class="number">4</span> * spot_df[<span class="string">&#x27;GRADE&#x27;</span>].astype(<span class="built_in">float</span>) + <span class="number">4</span> * spot_df[<span class="string">&#x27;HOT&#x27;</span>].astype(<span class="built_in">float</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment"># ç”¨äºå­˜æ”¾æ¯ä¸ªæ–‡ä»¶æ•°æ®</span></span><br><span class="line">    listDf = []</span><br><span class="line">    <span class="comment"># æ–‡ä»¶å¤¹ä½ç½®</span></span><br><span class="line">    folder_path = <span class="string">r&#x27;../data/txt&#x27;</span></span><br><span class="line">    <span class="comment"># æ‰“ç®—å°†æ¯ä¸ªæ–‡ä»¶éƒ½æŒ‰ç…§åˆ‡å‰²æˆå­—å…¸ï¼Œæœ€åæ”¾åˆ—è¡¨ä¸­å†åˆå¹¶</span></span><br><span class="line">    <span class="keyword">for</span> file_path <span class="keyword">in</span> glob.glob(os.path.join(folder_path, <span class="string">&#x27;*.txt&#x27;</span>)):</span><br><span class="line">        <span class="comment"># è¯»å–æ–‡ä»¶ å­—ç¬¦é›†ä¸ºutf-8 å­˜å…¥text</span></span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(file_path, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            text = f.read()</span><br><span class="line">        <span class="comment"># æ ¹æ®txtæ–‡ä»¶å…³é”®å­—å¤„ç†æˆkey:value</span></span><br><span class="line">        spot = text[text.find(<span class="string">&#x27;[SPOT]&#x27;</span>) + <span class="number">7</span>:text.find(<span class="string">&#x27;[LOCATION]&#x27;</span>)].strip()</span><br><span class="line">        location = text[text.find(<span class="string">&#x27;[LOCATION]&#x27;</span>) + <span class="number">11</span>:text.find(<span class="string">&#x27;[OPENTIME]&#x27;</span>)].strip()</span><br><span class="line">        opentime = text[text.find(<span class="string">&#x27;[OPENTIME]&#x27;</span>) + <span class="number">10</span>:text.find(<span class="string">&#x27;[PHONE]&#x27;</span>)].strip()</span><br><span class="line">        phone = text[text.find(<span class="string">&#x27;[PHONE]&#x27;</span>) + <span class="number">7</span>:text.find(<span class="string">&#x27;[INTRO]&#x27;</span>)].strip()</span><br><span class="line">        intro = text[text.find(<span class="string">&#x27;[INTRO]&#x27;</span>) + <span class="number">7</span>:text.find(<span class="string">&#x27;[GRADE]&#x27;</span>)].strip()</span><br><span class="line">        grade = text[text.find(<span class="string">&#x27;[GRADE]&#x27;</span>) + <span class="number">7</span>:text.find(<span class="string">&#x27;[HOT]&#x27;</span>)].strip()</span><br><span class="line">        hot = text[text.find(<span class="string">&#x27;[HOT]&#x27;</span>) + <span class="number">5</span>:text.find(<span class="string">&#x27;[SUM]&#x27;</span>)].strip()</span><br><span class="line">        sum_ = text[text.find(<span class="string">&#x27;[SUM]&#x27;</span>) + <span class="number">5</span>:text.find(<span class="string">&#x27;[COMMENT]&#x27;</span>)].strip()</span><br><span class="line">        comment = text[text.find(<span class="string">&#x27;[COMMENT]&#x27;</span>) + <span class="number">10</span>:text.find(<span class="string">&#x27;[COMMENT_GRADE]&#x27;</span>)].strip()</span><br><span class="line">        comment_grade = text[text.find(<span class="string">&#x27;[COMMENT_GRADE]&#x27;</span>) + <span class="number">15</span>:text.find(<span class="string">&#x27;[COMMENT_TIME]&#x27;</span>)].strip()</span><br><span class="line">        comment_time = text[text.find(<span class="string">&#x27;[COMMENT_TIME]&#x27;</span>) + <span class="number">14</span>:].strip()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># å°†æ•°æ®è½¬æ¢æˆkey:valueæ ¼å¼</span></span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&#x27;SPOT_NAME&#x27;</span>: spot,</span><br><span class="line">            <span class="string">&#x27;LEVEL&#x27;</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;LOCATION&#x27;</span>: location,</span><br><span class="line">            <span class="string">&#x27;OPENTIME&#x27;</span>: opentime,</span><br><span class="line">            <span class="string">&#x27;PHONE&#x27;</span>: phone,</span><br><span class="line">            <span class="string">&#x27;INTRO&#x27;</span>: intro,</span><br><span class="line">            <span class="string">&#x27;NOTICE&#x27;</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;ST&#x27;</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;GRADE&#x27;</span>: grade,</span><br><span class="line">            <span class="string">&#x27;HOT&#x27;</span>: hot,</span><br><span class="line">            <span class="string">&#x27;QTY&#x27;</span>: sum_,</span><br><span class="line">            <span class="string">&#x27;EVALUATION&#x27;</span>: comment,</span><br><span class="line">            <span class="string">&#x27;EVALUATION_GRADE&#x27;</span>: comment_grade,</span><br><span class="line">            <span class="string">&#x27;EVALUATION_TIME&#x27;</span>: comment_time,</span><br><span class="line">            <span class="string">&#x27;EVALUATION_NAME&#x27;</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;FEEL_SCORE&#x27;</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;FEEL&#x27;</span>: <span class="string">&#x27;&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment"># å­˜å…¥æ•°ç»„</span></span><br><span class="line">        listDf.append(data)</span><br><span class="line">    <span class="comment"># è½¬æ¢æˆdataframe</span></span><br><span class="line">    df = pd.DataFrame(listDf)</span><br><span class="line">    <span class="comment"># ä¸‹é¢ä¸‰è¡Œæ˜¯å°†ä»‹ç»é‚£åˆ—çš„æ•°æ®åˆ‡å‰²æˆä¸‰åˆ— åé¢è¿™éƒ¨åˆ†è€ƒè™‘åˆ°æ™¯åŒºè¡¨å»é‡ä»¥ååœ¨æ‰§è¡Œ</span></span><br><span class="line">    df[<span class="string">&#x27;ST&#x27;</span>] = df[<span class="string">&#x27;INTRO&#x27;</span>].apply(<span class="keyword">lambda</span> x: re.search(<span class="string">r&#x27;æœåŠ¡è®¾æ–½([\s\S]*)&#x27;</span>, x, re.S).group(<span class="number">1</span>))</span><br><span class="line">    df[<span class="string">&#x27;NOTICE&#x27;</span>] = df[<span class="string">&#x27;INTRO&#x27;</span>].apply(<span class="keyword">lambda</span> x: re.search(<span class="string">r&#x27;ä¼˜å¾…æ”¿ç­–\s*(.+?)\s*æœåŠ¡è®¾æ–½&#x27;</span>, x, re.S).group(<span class="number">1</span>))</span><br><span class="line">    df[<span class="string">&#x27;INTRO&#x27;</span>] = df[<span class="string">&#x27;INTRO&#x27;</span>].apply(<span class="keyword">lambda</span> x: re.search(<span class="string">r&#x27;ä»‹ç»\s*(.+?)\s*å…¨æ–‡&#x27;</span>, x, re.S).group(<span class="number">1</span>))</span><br><span class="line">    df[<span class="string">&#x27;SPOT_NAME&#x27;</span>] = df[<span class="string">&#x27;SPOT_NAME&#x27;</span>].apply(<span class="keyword">lambda</span> x: x.replace(<span class="string">&quot;?&quot;</span>, <span class="string">&quot;&quot;</span>))</span><br></pre></td></tr></table></figure><h3 id="ç»“è®º">ç»“è®º</h3><p>â€‹å‘ç°pythonä½¿ç”¨pandasæ•ˆæœå‡ºå¥‡çš„å¥½ï¼Œä¸ä»…é€Ÿåº¦å¿«ï¼Œè€Œä¸”å¯ä»¥ç›´æ¥ä½¿ç”¨ä¸€äº›é¢„æµ‹çš„æ¨¡å‹ï¼Œä¸éœ€è¦scalaé‚£è¾¹æå¥½pythonè¿™é‡Œå†æŠŠè¡¨è¯»å‡ºæ¥å†å¡«å……äº†ã€‚è¯»å–txtåŠ ä¸€äº›å¤„ç†å¤§æ¦‚ä¹Ÿå°±ä¸€ç§’çš„æ—¶é—´ï¼ŒåæœŸå¯¼å…¥dmçš„è¯ï¼Œä¹Ÿå°±æ˜¯ä¸åˆ°ä¸€é¢ã€‚</p><h2 id="BUG-7">BUG</h2><p>â€‹è¯»å–çš„æ—¶å€™ç›´æ¥æŠ¥é”™ï¼Œ ä¸€çœ‹ä¿¡æ¯å°±æ˜¯ç¼–ç çš„é—®é¢˜ï¼Œå»æœäº†ä¸€ä¸‹pythonå¤„ç†æ–‡ä»¶çš„ç¼–ç é—®é¢˜åªè¦åœ¨å¤–å±‚è¯»å–çš„openæ–¹æ³•ä¸­è®¾ç½®encodingå°±å¥½äº†ï¼Œ<em>with</em> open(file_path, â€˜râ€™, encoding=â€œutf-8â€) ã€‚</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/image-20250820102646736.png" alt="image-20250820102646736"></p><h2 id="æ—¥æ€»ç»“-7">æ—¥æ€»ç»“</h2><blockquote><p>â€‹ä»Šå¤©ç®—æ˜¯å¾—åˆ°ä¸ªåæ¶ˆæ¯ï¼ŒåŸºæœ¬ä¸€ä¸‹å­å°†ä¹‹å‰è¾›è¾›è‹¦è‹¦å†™çš„ä»£ç å…¨éƒ¨ä½œåºŸäº†ï¼Œä»¥ä¸ºhdfsä¸Šé¢çš„æ•°æ®è›®å¤§çš„ï¼Œä¸»è¦æ˜¯æ ¼å¼çš„é—®é¢˜ï¼Œä¹Ÿä¸æ‰“ç®—å†å¤´é“å¼ºè¡Œæäº†ï¼Œæœ¬æ¥æ¸…æ´—å°±ä¸åº”è¯¥æ˜¯ä¸‰ä¸ªè¯­è¨€çš„ä½¿ç”¨ï¼Œä¸ä»…æ‹–æ…¢äº†é€Ÿåº¦ï¼Œæ‰§è¡Œèµ·æ¥ä¹Ÿå¾ˆå¥‡æ€ªï¼Œè¦è·‘å¥½å‡ æ¬¡ã€‚é€Ÿåº¦æ–¹é¢æµ‹è¯•éƒ½ä¸æ•¢æµ‹ï¼Œ1wå°±èŠ±è´¹äº†é‚£ä¹ˆé•¿æ—¶é—´ï¼Œè¿™ä¸€ä¸‹å°±æ˜¯ç™¾ä¸‡ï¼Œç›´æ¥æ‰“ç®—æ¢æˆpythonï¼Œå…ˆæµ‹è¯•äº†ä¸€ä¸‹æœ€éš¾çš„txtï¼Œå‘ç°å¤„ç†èµ·æ¥è¿˜æ˜¯å¾ˆç®€å•çš„ï¼Œè™½ç„¶æ–¹æ³•æœ‰ç‚¹ç¬¨ï¼Œä½†æ˜¯å¥½åœ¨txtæ–‡ä»¶æ ¼å¼éƒ½æ˜¯å›ºå®šçš„ï¼Œéƒ½æ‹¿åˆ°äº†å­˜æˆdataframeäº†ï¼Œåé¢æ…¢æ…¢å¤„ç†å¥½å†å¯¼å…¥dmå°±è¡Œäº†ã€‚</p></blockquote><h1 id="æ¸…æ´—csvæ–‡ä»¶å¤¹">æ¸…æ´—csvæ–‡ä»¶å¤¹</h1><h2 id="å­¦ä¹ æ—¥æœŸ-6-9">å­¦ä¹ æ—¥æœŸ: 6.9</h2><h2 id="é¡¹ç›®ä»»åŠ¡-8">é¡¹ç›®ä»»åŠ¡</h2><h3 id="æ¢³ç†æ•°æ®">æ¢³ç†æ•°æ®</h3><p>â€‹æ–°ç»™çš„æ•°æ®ä¸­csvå’Œxlsxçš„å­—æ®µéƒ½æ˜¯æœ‰æ”¹å˜çš„ï¼Œæ‰€æœ‰è¦åˆ†æå¥½å­—æ®µï¼Œå› ä¸ºåç«¯æ¥å£éƒ½å†™å¾ˆå¤šäº†ï¼Œä¸èƒ½å¤§æ”¹ï¼Œä½†æ˜¯æœ‰äº›æä¾›çš„å­—æ®µè¿˜æ˜¯è¦æ·»åŠ çš„ã€‚è®¡åˆ’spotæ™¯åŒºè¡¨14ä¸ªï¼Œè¯„è®ºè¡¨7ä¸ªå‰åæ²¡æœ‰æ”¹å˜å¤šå°‘ï¼Œåé¢çš„dataframeå°±æŒ‰ç…§è¿™ä¸ªæ ¼å¼æ…¢æ…¢å¤„ç†ã€‚çœ‹äº†ä¸€äº›HDFSçš„æ•°æ®å¤§è‡´åˆ†ä¸º4ç§ï¼Œcsvæœ‰ä¸¤ç§ï¼Œå­—æ®µæ˜¯æœ‰äº›è®¸ä¸ä¸€æ ·çš„ï¼Œxlsxåˆä¸€ç§ï¼Œä¹Ÿæ˜¯æœ‰äº›å­—æ®µæœ‰ï¼Œæœ‰äº›æ²¡æœ‰ï¼Œæ²¡æœ‰çš„å­—æ®µå°±é¢„æµ‹å¾—å‡ºï¼Œtxtæ˜¯æœ€å°‘çš„ã€‚æ‰“ç®—å°±æ˜¯èƒ½é¢„æµ‹çš„å°±é¢„æµ‹å¤„ç†å¡«å……ï¼Œä¸€äº›æ²¡å‘é¢„æµ‹åˆç¼ºå¤±äº†ï¼Œè¦ä¹ˆä¸¢å¼ƒï¼Œè¦ä¹ˆä¸æ˜¾ç¤ºã€‚</p><h3 id="æ¸…æ´—csvä»£ç ">æ¸…æ´—csvä»£ç </h3><p>â€‹éƒ½å…ˆæŠŠæ•°æ®å¤„ç†æˆæ‰€æœ‰éœ€è¦çš„å­—æ®µäº†ï¼Œéƒ½å…ˆæ·»åŠ ä¸Š ï¼Œç„¶åé¦–è¦ä»»åŠ¡ï¼Œå…³è”å¥½æ™¯åŒºidï¼Œä¸çŸ¥é“èƒ½ä¸èƒ½group byåˆ†ç»„ï¼Œæ˜å¤©å†ç ”ç©¶ä¸€ä¸‹ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">from</span> faker <span class="keyword">import</span> Faker</span><br><span class="line"></span><br><span class="line">f = Faker(<span class="string">&#x27;zh_CN&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">readCsvToDf</span>(<span class="params">folder_path</span>):</span><br><span class="line">    <span class="comment"># éå†æ–‡ä»¶å¤¹ä¸­æ‰€æœ‰æ–‡ä»¶</span></span><br><span class="line">    all_files = os.listdir(folder_path)</span><br><span class="line">    csv_files = [file <span class="keyword">for</span> file <span class="keyword">in</span> all_files <span class="keyword">if</span> file.endswith(<span class="string">&#x27;.csv&#x27;</span>)]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># åˆå¹¶æ¯ä¸ª CSV æ–‡ä»¶ä¸ºä¸€ä¸ª DataFrameï¼Œå¹¶å°†å®ƒä»¬å­˜å‚¨åœ¨ä¸€ä¸ªåˆ—è¡¨ä¸­</span></span><br><span class="line">    dfs = []</span><br><span class="line">    <span class="keyword">for</span> file <span class="keyword">in</span> csv_files:</span><br><span class="line">        file_path = os.path.join(folder_path, file)</span><br><span class="line">        df = pd.read_csv(file_path)</span><br><span class="line">        dfs.append(df)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å°†æ‰€æœ‰ DataFrame åˆå¹¶ä¸ºä¸€ä¸ª DataFrame</span></span><br><span class="line">    <span class="keyword">return</span> pd.concat(dfs, ignore_index=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯¹æ¢è¡Œç¬¦ä»¥åŠç©ºæ ¼å»é™¤</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test</span>(<span class="params">x</span>):</span><br><span class="line">    stringApply = <span class="string">&#x27;&#x27;</span>.join(<span class="built_in">str</span>(x).split()).strip(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> stringApply</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">clearAllDf</span>(<span class="params">merged_df</span>):</span><br><span class="line">    <span class="comment"># ä¿®æ”¹åˆ—åä»¥åŠæ¢è¡Œå’Œç©ºç™½å­—æ®µå¤„ç†</span></span><br><span class="line">    merged_df.rename(columns=&#123;<span class="string">&#x27;SPOT&#x27;</span>: <span class="string">&#x27;SPOT_NAME&#x27;</span>, <span class="string">&#x27;CO_TIME&#x27;</span>: <span class="string">&#x27;EVALUATION_TIME&#x27;</span>, <span class="string">&#x27;CO_NAME&#x27;</span>: <span class="string">&#x27;EVALUATION_NAME&#x27;</span>,</span><br><span class="line">                              <span class="string">&#x27;COMMENT&#x27;</span>: <span class="string">&#x27;EVALUATION&#x27;</span>&#125;, inplace=<span class="literal">True</span>)</span><br><span class="line">    merged_df_copy = merged_df.applymap(test).drop(columns=[<span class="string">&#x27;TGA&#x27;</span>])</span><br><span class="line">    <span class="comment"># å»é™¤æ™¯åŒºåå¸¦?</span></span><br><span class="line">    merged_df_copy[<span class="string">&#x27;SPOT_NAME&#x27;</span>] = merged_df_copy[<span class="string">&#x27;SPOT_NAME&#x27;</span>].apply(<span class="keyword">lambda</span> x: x.replace(<span class="string">&quot;?&quot;</span>, <span class="string">&quot;&quot;</span>))</span><br><span class="line">    <span class="comment"># æ·»åŠ ç©ºåˆ— åé¢æ™¯åŒºè¡¨éœ€è¦çš„å­—æ®µ</span></span><br><span class="line">    merged_df_copy.insert(<span class="number">9</span>,<span class="string">&#x27;RATING&#x27;</span>,<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    merged_df_copy.insert(<span class="number">9</span>,<span class="string">&#x27;CITY_ID&#x27;</span>,<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    merged_df_copy.insert(<span class="number">9</span>,<span class="string">&#x27;HOT&#x27;</span>,<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> merged_df_copy</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">clearSpotDf</span>(<span class="params">allDf</span>):</span><br><span class="line">    <span class="comment"># æ·»åŠ éœ€è¦åˆ— éšæœºå¡«å……ç”µè¯</span></span><br><span class="line">    allDf.insert(<span class="number">3</span>, <span class="string">&#x27;PHONE&#x27;</span>, [f.phone_number() <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(allDf.iloc[:, <span class="number">0</span>].size)])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment"># csvæ–‡ä»¶å…¶ä¸­ä¸€ä¸ªæ–‡ä»¶å¤¹</span></span><br><span class="line">    folder_qnecsv_path = <span class="string">&quot;../data/csv/qnecsv&quot;</span></span><br><span class="line">    merged_df = readCsvToDf(folder_qnecsv_path)</span><br><span class="line">    allDf = clearAllDf(merged_df)</span><br><span class="line">    <span class="comment"># éœ€è¦å…ˆæŠŠåŸå¸‚çš„dfæ¸…æ´—å‡ºæ¥</span></span><br></pre></td></tr></table></figure><h2 id="BUG-8">BUG</h2><p>åœ¨ä½¿ç”¨<a href="https://so.csdn.net/so/search?q=pandas&amp;spm=1001.2101.3001.7020">pandas</a>çš„æ—¶å€™ï¼Œå‡ºç°å¦‚ä¸‹çš„è­¦å‘Šã€‚è™½ç„¶ä¸ä¼šå½±å“ç¨‹åºçš„æ­£å¸¸è¿è¡Œï¼Œä½†æ˜¯çœ‹ç€å°±å¾ˆçƒ¦ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">A value is trying to be <span class="built_in">set</span> on a copy of a slice from a DataFrame.</span><br><span class="line">Try using .loc[row_indexer,col_indexer] = value instead</span><br></pre></td></tr></table></figure><p>æœç´¢ä»¥åå‘ç°æ˜¯å› ä¸ºæˆ‘çš„dataframeæ˜¯å…¶ä»–dataframeèµ‹å€¼çš„ï¼Œä¹Ÿå°±æ˜¯a = b ,æˆ‘å¯¹aè¿›è¡Œäº†ä¿®æ”¹ï¼Œè¿™æ ·ä¸å¤ªå¥½ï¼Œæœ€å¥½ç›´æ¥å¯¹bè¿›è¡Œä¿®æ”¹ï¼Œè§£å†³æ–¹æ¡ˆæœ‰ä¸‰ä¸ª<br>è§£å†³æ–¹æ¡ˆï¼š</p><ol><li>æ–°å»ºä¸€ä¸ªdataframeï¼Œåœ¨æ–°çš„ä¸Šé¢è¿›è¡Œæ“ä½œã€‚</li><li>åœ¨å¤åˆ¶dataframeçš„æ—¶å€™ï¼Œä½¿ç”¨.copy()ã€‚</li><li>ä½¿ç”¨.locæ¥èµ‹å€¼</li></ol><h2 id="æ—¥æ€»ç»“-8">æ—¥æ€»ç»“</h2><blockquote><p>â€‹ä»Šå¤©æ‰“ç®—å…ˆåˆæ­¥æŠŠæ¯ç§æ–‡ä»¶éƒ½è¯•ç€è¯»æˆdataframeï¼Œå…ˆå°†ä¸€ä¸ªæ–‡ä»¶å¤¹èƒ½æ´—æˆè‡ªå·±éœ€è¦çš„å››ä¸ªè¡¨ï¼Œä¹Ÿå°±æ˜¯å››ä¸ªdataframeï¼Œåé¢æ¢æ–‡ä»¶ä¹Ÿå°±å¤§å·®ä¸å¤§ï¼Œç›®å‰æ€è·¯æ¢³ç†æ¸…é™¤äº†å…ˆå°†idæŒ‚å¥½ï¼Œåé¢è¿˜æ˜¯å¾ˆå®¹æ˜“çš„ï¼Œå› ä¸ºä¹‹å‰å¯¹ç¼ºå¤±å€¼çš„å¡«å……çš„ä»£ç éƒ½åšå¥½äº†ï¼Œåªè¦å†é‡æ–°å¯¹hotå¡«å……ä¸€ä¸‹å°±è¡Œäº†ã€‚ä»sparkçš„æœºå™¨å­¦ä¹ ç®—æ³•æ”¹æˆpandasé¢„æµ‹å³å¯ã€‚</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_province</span>(<span class="params">city_name</span>):</span><br><span class="line">    ak = <span class="string">&#x27;ä½ çš„ç™¾åº¦åœ°å›¾API key&#x27;</span></span><br><span class="line">    url = <span class="string">&#x27;http://api.map.baidu.com/geocoder?address=&#123;&#125;&amp;output=json&amp;ak=&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(city_name, ak)</span><br><span class="line">    res = requests.get(url).json()</span><br><span class="line">    <span class="keyword">if</span> res[<span class="string">&#x27;status&#x27;</span>] == <span class="number">0</span>:</span><br><span class="line">        province = res[<span class="string">&#x27;result&#x27;</span>][<span class="string">&#x27;addressComponent&#x27;</span>][<span class="string">&#x27;province&#x27;</span>]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        province = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">return</span> province</span><br><span class="line"></span><br><span class="line"><span class="comment"># æµ‹è¯•</span></span><br><span class="line">cities = [<span class="string">&#x27;é‡‘åå¸‚&#x27;</span>, <span class="string">&#x27;è‹å·å¸‚&#x27;</span>, <span class="string">&#x27;èˆŸå±±å¸‚&#x27;</span>, <span class="string">&#x27;æ­¦æ±‰å¸‚&#x27;</span>, <span class="string">&#x27;æ¡ä¹¡å¸‚&#x27;</span>, <span class="string">&#x27;æ­å·å¸‚&#x27;</span>, <span class="string">&#x27;æ— é”¡å¸‚&#x27;</span>, <span class="string">&#x27;æ‰¬å·å¸‚&#x27;</span>, <span class="string">&#x27;æ©æ–½å¸‚&#x27;</span>]</span><br><span class="line">province = [get_province(city) <span class="keyword">for</span> city <span class="keyword">in</span> cities]</span><br><span class="line">df = pd.DataFrame(&#123;<span class="string">&#x27;city&#x27;</span>: cities, <span class="string">&#x27;province&#x27;</span>: province&#125;)</span><br><span class="line"><span class="built_in">print</span>(df)</span><br></pre></td></tr></table></figure><h1 id="è¯»å–hdfsæ–‡ä»¶">è¯»å–hdfsæ–‡ä»¶</h1><h2 id="å­¦ä¹ æ—¥æœŸ-6-12">å­¦ä¹ æ—¥æœŸ: 6.12</h2><h2 id="é¡¹ç›®ä»»åŠ¡-9">é¡¹ç›®ä»»åŠ¡</h2><p>â€‹å› ä¸ºè€ƒè™‘åˆ°hdfs3ä½¿ç”¨ä¸äº†ï¼Œæ‰€ä»¥ä½¿ç”¨äº†hdfsè¿™ä¸ªåº“ï¼Œè¿™ä¸ªåº“æ˜¯åŸºäºwebè®¿é—®hdfsçš„ï¼Œåˆè€ƒè™‘åˆ°æœ¬åœ°çš„æ•°æ®è¯»å–åº”è¯¥æ¯”hdfså¿«ä¸Šä¸å°‘ï¼Œæ‰€ä»¥ç¬¬ä¸€æ­¥ç›´æ¥ä¸‹è½½ä¸‹æ¥ã€‚åé¢åªè¦å†™è‡ªå·±æœ¬åœ°è·¯å¾„å¤„ç†æ–‡ä»¶å°±å¥½äº†ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> hdfs <span class="keyword">import</span> Client, InsecureClient</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºå®¢æˆ·ç«¯è¿æ¥hdfs</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;å¯åŠ¨&quot;</span>)</span><br><span class="line">client = InsecureClient(<span class="string">&#x27;http://hadoopb-namenode.damengb-zone.svc:9870&#x27;</span>)</span><br><span class="line"><span class="comment"># # åˆ—å‡ºHDFSä¸Šçš„ç›®å½•</span></span><br><span class="line">hdfs_csv_path = <span class="string">&quot;/data/csv/qnecsv&quot;</span></span><br><span class="line">csv_data_list = client.<span class="built_in">list</span>(hdfs_path=hdfs_csv_path)</span><br><span class="line">local_path = <span class="string">&quot;/home/PyCode/data/hdfscsv/qnecsv&quot;</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(csv_data_list))</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰é€’å½’ä¸‹è½½å‡½æ•°</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">download_folder</span>(<span class="params">client, hdfs_path, local_path</span>):</span><br><span class="line">    <span class="comment"># å¦‚æœHDFSè·¯å¾„æ˜¯æ–‡ä»¶ï¼Œåˆ™ä¸‹è½½åˆ°æœ¬åœ°</span></span><br><span class="line">    <span class="keyword">if</span> client.status(hdfs_path)[<span class="string">&#x27;type&#x27;</span>] == <span class="string">&#x27;FILE&#x27;</span>:</span><br><span class="line">        client.download(hdfs_path, local_path)</span><br><span class="line">    <span class="comment"># å¦‚æœHDFSè·¯å¾„æ˜¯æ–‡ä»¶å¤¹ï¼Œåˆ™é€’å½’ä¸‹è½½å…¶ä¸­çš„å­æ–‡ä»¶å’Œæ–‡ä»¶å¤¹</span></span><br><span class="line">    <span class="keyword">elif</span> client.status(hdfs_path)[<span class="string">&#x27;type&#x27;</span>] == <span class="string">&#x27;DIRECTORY&#x27;</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(local_path):</span><br><span class="line">            os.makedirs(local_path)</span><br><span class="line">        <span class="keyword">for</span> file <span class="keyword">in</span> client.<span class="built_in">list</span>(hdfs_path):</span><br><span class="line">            sub_hdfs_path = hdfs_path + <span class="string">&#x27;/&#x27;</span> + file</span><br><span class="line">            sub_local_path = local_path + <span class="string">&#x27;/&#x27;</span> + file</span><br><span class="line">            download_folder(client, sub_hdfs_path, sub_local_path)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–‡ä»¶æš‚ä¸‹è½½</span></span><br><span class="line">download_folder(client, <span class="string">&quot;/data/csv/qnecsv&quot;</span>, <span class="string">&quot;/home/PyCode/data/hdfscsv/qnecsv&quot;</span>)</span><br><span class="line">download_folder(client, <span class="string">&quot;/data/csv/xccsv&quot;</span>, <span class="string">&quot;/home/PyCode/data/hdfscsv/xccsv&quot;</span>)</span><br><span class="line">download_folder(client, <span class="string">&quot;/data/txt&quot;</span>, <span class="string">&quot;/home/PyCode/data/hdfstxt&quot;</span>)</span><br><span class="line">download_folder(client, <span class="string">&quot;/data/excel&quot;</span>, <span class="string">&quot;/home/PyCode/data/hdfsexcel&quot;</span>)</span><br></pre></td></tr></table></figure><h2 id="BUG-9">BUG</h2><p>â€‹ä½¿ç”¨hdfs3çš„æ—¶å€™ï¼Œä¸€ç›´è¯´æ‰¾ä¸åˆ°libhdfs3.soä¾èµ–ï¼Œä½†æ˜¯è‡ªå·±çš„ç¡®æ˜¯è£…äº†ï¼Œè€Œä¸”ä½¿ç”¨sysæŒ‡å®šäº†éƒ½ï¼Œä½†æ˜¯éƒ½æ²¡ç”¨ï¼Œæä¸€ä¸Šåˆæ²¡è§£å†³ï¼Œæ¢æˆhdfsäº†ã€‚</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/image-20250820102701307.png" alt="image-20250820102701307"></p><h2 id="æ—¥æ€»ç»“-9">æ—¥æ€»ç»“</h2><blockquote><p>â€‹ä»Šå¤©çœŸçš„æäº†åŠå¤©ï¼Œæ²¡æ•²ä»€ä¹ˆä»£ç ï¼Œä»å¹³å°å‘æ”¾è´¦æˆ·ä»¥åï¼Œè¿™ä¸ªå¹³å°ä¸€ç›´æ²¡æ•´æ˜ç™½ï¼Œä»Šå¤©æƒ³ç€å»æŠŠhdfsæ•°æ®æ‹¿ä¸€ä¸‹ï¼Œå½“æˆ‘åœ¨å¹³å°ä¸Špingæä¾›å¥½çš„è¯´hdfså­˜æ”¾çš„ä½ç½®çš„æ—¶å€™å‘ç°æ˜¯å¥½çš„ï¼Œèƒ½pingé€šåº”è¯¥ï¼Œå°±èƒ½æ‹¿ï¼Œç»“æœå‘ç°ä»–é‚£ä¸ª9000ç«¯å£ä¸€ç›´è¯´webä¸¢å¤±ä¹‹ç±»çš„ï¼Œæˆ‘åˆå»æµ‹è¯•è‡ªå·±è™šæ‹Ÿæœºä¸Šé¢çš„hdfsï¼Œå‘ç°èƒ½å–åˆ°ï¼Œæœç´¢è¯´æ˜¯hadoopçš„é…ç½®æ–‡ä»¶éœ€è¦æŸ¥çœ‹ï¼Œä½†æ˜¯æ•°æ®æ˜¯æ¯”èµ›æ–¹æä¾›çš„ï¼Œæˆ‘ä»¬åˆä¸èƒ½æ“ä½œä»–ä»¬çš„æœºå­ï¼Œåé¢å°±è¯•ç€æ¢æ¢å…¶ä»–ç«¯å£ï¼Œç»“æœå°±è¯•å‡ºæ¥äº†ã€‚</p></blockquote><h1 id="ä¼˜åŒ–pandasæ•ˆç‡">ä¼˜åŒ–pandasæ•ˆç‡</h1><h2 id="å­¦ä¹ æ—¥æœŸ-6-13">å­¦ä¹ æ—¥æœŸ: 6.13</h2><h2 id="é¡¹ç›®ä»»åŠ¡-10">é¡¹ç›®ä»»åŠ¡</h2><p>â€‹hdfså–åˆ°ä»¥åå‘ç°æ•°æ®æ˜¯éå¸¸çš„å¤§ï¼Œè€Œä¸”æ¯å½“æˆ‘å¤„ç†æ•°æ®çš„æ—¶å€™ï¼Œå†…å­˜ä¼šè¶…å‡ºï¼Œè€Œä¸”ä¼šè‡ªåŠ¨æŠŠè‡ªå·±æ€æ­»ï¼Œå°±å¿…é¡»è¦ä¼˜åŒ–æ•ˆç‡äº†ï¼Œæ¯•ç«Ÿå¤„ç†è¯„è®ºé‚£è¾¹çš„ä»£ç é›€æ°æ˜¯ä¸å¤ªå¥½ï¼Œæ˜¯ä½¿ç”¨forå¾ªç¯çš„ï¼Œæ•ˆç‡ä¼šä½ç™¾å€ã€‚</p><h3 id="ä¼˜åŒ–ä»¥åçš„ä»£ç ">ä¼˜åŒ–ä»¥åçš„ä»£ç </h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> snownlp <span class="keyword">import</span> SnowNLP</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">clearSpotComment</span>(<span class="params">allInfoDf, province_list</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;è¯„è®ºè¡¨å¼€å§‹å¤„ç†&quot;</span>)</span><br><span class="line">    comment_df = allInfoDf[allInfoDf.columns[<span class="number">12</span>:]].copy()</span><br><span class="line">    comment_df.insert(<span class="number">2</span>, <span class="string">&#x27;EVALUATION_GRADE&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    comment_df[<span class="string">&#x27;FEEL_SCORE&#x27;</span>] = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    comment_df[<span class="string">&#x27;FEEL&#x27;</span>] = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    order = [<span class="string">&#x27;SPOT_ID&#x27;</span>, <span class="string">&#x27;EVALUATION&#x27;</span>, <span class="string">&#x27;EVALUATION_GRADE&#x27;</span>, <span class="string">&#x27;EVALUATION_TIME&#x27;</span>,</span><br><span class="line">             <span class="string">&#x27;EVALUATION_NAME&#x27;</span>, <span class="string">&#x27;FEEL_SCORE&#x27;</span>, <span class="string">&#x27;FEEL&#x27;</span>]</span><br><span class="line">    comment_df = comment_df[order]</span><br><span class="line">    <span class="comment"># æ—¶é—´å¤„ç† è¿™ç»„æ˜¯å¯¹2018/9/16 è¿™ç±»æ²¡-è€Œä¸”ipæ²¡æœ‰çš„æ•°æ®å¤„ç†</span></span><br><span class="line">    comment_df[<span class="string">&#x27;EVALUATION_TIME&#x27;</span>] = comment_df[<span class="string">&#x27;EVALUATION_TIME&#x27;</span>].apply(<span class="keyword">lambda</span> x: x.replace(<span class="string">&quot;/&quot;</span>, <span class="string">&quot;-&quot;</span>))</span><br><span class="line"></span><br><span class="line">    comment_df[<span class="string">&#x27;EVALUATION_TIME&#x27;</span>] = comment_df[<span class="string">&#x27;EVALUATION_TIME&#x27;</span>].apply(<span class="keyword">lambda</span> x: x + <span class="string">&quot; IPå±åœ°: &quot;</span> + np.random.choice(province_list) <span class="keyword">if</span> <span class="string">&quot;IP&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> x <span class="keyword">else</span> x)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">calculate_scores</span>(<span class="params">row</span>):</span><br><span class="line">        <span class="keyword">if</span> row.EVALUATION == <span class="string">&quot;ç”¨æˆ·æœªç‚¹è¯„ã€‚ç³»ç»Ÿé»˜è®¤å¥½è¯„ã€‚&quot;</span>:</span><br><span class="line">            score = <span class="number">1.0</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            score = <span class="built_in">round</span>(SnowNLP(row.EVALUATION).sentiments, <span class="number">2</span>)</span><br><span class="line">        feelScore = <span class="built_in">round</span>(score * <span class="number">5</span>, <span class="number">1</span>)</span><br><span class="line">        <span class="comment"># è¯„è®ºæƒ…ç»ª</span></span><br><span class="line">        feel = scoreSnow(score)</span><br><span class="line">        <span class="keyword">if</span> row.EVALUATION_GRADE == <span class="string">&quot;&quot;</span>:</span><br><span class="line">            row.EVALUATION_GRADE = <span class="built_in">str</span>(<span class="built_in">int</span>(<span class="built_in">round</span>(feelScore, <span class="number">0</span>))) + <span class="string">&quot;åˆ† &quot;</span> + feel</span><br><span class="line"></span><br><span class="line">        row.FEEL_SCORE = feelScore</span><br><span class="line">        row.FEEL = feel</span><br><span class="line">        <span class="keyword">return</span> row</span><br><span class="line"></span><br><span class="line">    comment_df = comment_df.apply(calculate_scores, axis=<span class="number">1</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;è¯„è®ºè¡¨ç»“æŸå¤„ç†&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> comment_df</span><br></pre></td></tr></table></figure><h3 id="æ€»ç»“ä¸€ä¸‹å¦‚ä½•ä¼˜åŒ–pandasæ•ˆç‡ã€‚">æ€»ç»“ä¸€ä¸‹å¦‚ä½•ä¼˜åŒ–pandasæ•ˆç‡ã€‚</h3><h4 id="1-é€‰æ‹©åˆé€‚çš„æ•°æ®ç±»å‹">1. é€‰æ‹©åˆé€‚çš„æ•°æ®ç±»å‹</h4><p>åœ¨æ•°æ®å¤„ç†ä¸­ï¼Œé€‰æ‹©æ­£ç¡®çš„æ•°æ®ç±»å‹æœ‰å¯èƒ½åˆ©ç”¨å†…å­˜ç©ºé—´å¹¶æ”¹å–„æ€§èƒ½ã€‚</p><ul><li><p>å¯¹è±¡ç±»å‹å¯¹äºæ‰€æœ‰ç±»å‹çš„å¯¹è±¡éƒ½æ˜¯ä¸€ç§é€šç”¨æ•°æ®ç±»å‹ã€‚åœ¨ä½ ä¸ç¡®å®šæ•°æ®ç±»å‹ï¼Œæˆ–è€…æ•°æ®ç±»å‹æ··åˆçš„æƒ…å†µä¸‹ï¼ŒPandasä¼šé»˜è®¤é‡‡ç”¨è¿™ç§æ•°æ®ç±»å‹ã€‚ç„¶è€Œï¼Œå¯¹äºå¤§æ•°æ®é›†ï¼Œä½ å¯èƒ½æ›´å¸Œæœ›é€‰æ‹©ä¸€ä¸ªæ›´åŠ å…·ä½“å’Œç´§å‡‘çš„æ•°æ®ç±»å‹ã€‚</p><p>DataFrame[â€˜column_nameâ€™] = DataFrame[â€˜column_nameâ€™].astype(â€˜datatypeâ€™)</p></li></ul><p><strong>ä¾‹å¦‚ï¼š</strong></p><p>DataFrame[â€˜column_nameâ€™] = DataFrame[â€˜column_nameâ€™].astype(â€˜categoryâ€™)</p><ul><li>å¯¹äºæ•°å€¼å‹æ•°æ®ï¼Œå°½é‡ä½¿ç”¨â€™intâ€™ç±»å‹ï¼Œæ ¹æ®æ•°å€¼å¤§å°çš„ä¸åŒï¼Œè¿˜å¯ä»¥é€‰æ‹©â€™int64â€™, â€˜int32â€™, â€˜int16â€™, â€˜int8â€™ã€‚</li><li>å¯¹äºç±»åˆ«å‹æ•°æ®ï¼Œä½¿ç”¨â€™categoryâ€™ç±»å‹å¯ä»¥èŠ‚çœå¤§é‡å†…å­˜ã€‚</li><li>å¯¹äºæ—¶é—´åºåˆ—æ•°æ®ï¼Œä½ å¯ä»¥ä½¿ç”¨Pandasè‡ªå¸¦çš„â€™datetime64[ns]'ç±»å‹ã€‚</li></ul><h4 id="2-åˆ©ç”¨å‘é‡åŒ–æ“ä½œï¼Œå°½å¯èƒ½é¿å…å¾ªç¯">2. åˆ©ç”¨å‘é‡åŒ–æ“ä½œï¼Œå°½å¯èƒ½é¿å…å¾ªç¯</h4><p>Pandasçš„åŸºç¡€åŒ…Numpyï¼Œå¯¹å‘é‡è¿ç®—åšäº†å¤§é‡çš„ä¼˜åŒ–ã€‚å› æ­¤ï¼Œåœ¨ç¼–å†™ä»£ç æ—¶ï¼Œæˆ‘ä»¬å»ºè®®ä½ å°½å¯èƒ½ä½¿ç”¨å‘é‡çš„æ“ä½œï¼Œè€Œä¸æ˜¯ä½¿ç”¨Pythonçš„forå¾ªç¯ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Pythonçš„forå¾ªç¯åšæ³•</span></span><br><span class="line"><span class="keyword">for</span> idx <span class="keyword">in</span> df.index:</span><br><span class="line">    df.loc[idx, <span class="string">&#x27;column_name&#x27;</span>] = df.loc[idx, <span class="string">&#x27;column_name&#x27;</span>] + <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Pandaså‘é‡æ“ä½œä¼˜åŒ–å</span></span><br><span class="line">df[<span class="string">&#x27;column_name&#x27;</span>] = df[<span class="string">&#x27;column_name&#x27;</span>] + <span class="number">1</span></span><br></pre></td></tr></table></figure><h4 id="3-ä½¿ç”¨inplace-å‚æ•°å¯ä»¥é¿å…å¤åˆ¶">3. ä½¿ç”¨inplace å‚æ•°å¯ä»¥é¿å…å¤åˆ¶</h4><p>å¯¹äºä¸€äº›å¯ä»¥æ”¹å˜åŸå§‹DataFrameå¯¹è±¡çš„æ“ä½œï¼Œä¾‹å¦‚:drop, sort_valuesã€‚ å¯ä»¥è®¾ç½®å‚æ•°â€™inplace=Trueâ€™ï¼Œæ¥ä¿è¯æ“ä½œåœ¨åŸæ•°æ®ä¸Šè¿›è¡Œï¼Œé¿å…åˆ›å»ºæ–°çš„å¤åˆ¶å“ã€‚</p><h4 id="4-é¿å…é“¾å¼æ“ä½œ">4. é¿å…é“¾å¼æ“ä½œ</h4><p>å°½é‡é¿å…ä½¿ç”¨é“¾å¼æ“ä½œï¼Œå¦‚df[df[â€˜Aâ€™]&gt;0][â€˜Bâ€™] = 1ï¼Œè¿™æ ·çš„æ“ä½œä¼šè¿”å›DataFrameçš„å‰¯æœ¬è€Œéè§†å›¾ï¼Œå¯¹å‰¯æœ¬çš„æ“ä½œä¸ä¼šåæ˜ åˆ°åŸå§‹æ•°æ®ä¸Šã€‚</p><h4 id="5-ä½¿ç”¨-isin">5. ä½¿ç”¨.isin()</h4><p>å½“æˆ‘ä»¬éœ€è¦ç­›é€‰å‡ºæŸåˆ—ä¸­å±äºæŸä¸ªlisté‡Œçš„å…ƒç´ è¡Œæ—¶ï¼Œä½¿ç”¨.isin()æ˜¯æœ€æœ‰æ•ˆç‡çš„æ–¹å¼ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chosen_ones = df[df.column_name.isin(list_of_values)]</span><br></pre></td></tr></table></figure><h4 id="6-ä½¿ç”¨-loc-at-iat">6. ä½¿ç”¨.loc(), .at(),.iat()</h4><p>å¯¹æ•°æ®çš„è®¿é—®å’Œä¿®æ”¹ï¼Œlocå’Œilocå‡½æ•°é€Ÿåº¦ç›¸å¯¹äºæ™®é€šæ–¹æ³•è¦å¿«ï¼Œat å’Œiatä¸ºè®¿é—®å•ä¸ªå…ƒç´ æä¾›äº†æ›´å¿«çš„æ–¹æ³•ã€‚</p><h4 id="7-å¯¹äºå¤§æ•°æ®é›†ï¼Œä¼˜é€‰fillna-å’Œinterpolate">7. å¯¹äºå¤§æ•°æ®é›†ï¼Œä¼˜é€‰fillna()å’Œinterpolate()</h4><p>å¯¹äºå¤§çš„æ•°æ®é›†ï¼Œä½¿ç”¨fillnaå’Œinterpolateæ¥å¤„ç†ç¼ºå¤±å€¼ä¼šæ¯”ä½¿ç”¨dropnaå¿«å¾ˆå¤šã€‚</p><h2 id="BUG-10">BUG</h2><p>â€‹æ— å›°éš¾bug</p><h2 id="æ—¥æ€»ç»“-10">æ—¥æ€»ç»“</h2><blockquote><p>â€‹å¯¹äºPandasçš„æ€§èƒ½ä¼˜åŒ–ï¼Œ ä¸»è¦çš„æ–¹å‘æ˜¯å‡å°‘å†…å­˜æ¶ˆè€—å’Œå¢åŠ è®¡ç®—æ•ˆç‡ï¼Œé€šè¿‡é€‰æ‹©åˆé€‚çš„æ•°æ®ç±»å‹ï¼Œé¿å…ä¸å¿…è¦çš„å¾ªç¯ï¼Œåˆç†ä½¿ç”¨Pandasæä¾›çš„å‡½æ•°å’Œæ–¹æ³•ï¼Œéƒ½æ˜¯å®ç°ä¼˜åŒ–çš„æœ‰æ•ˆç­–ç•¥ã€‚åœ¨ç¼–å†™ä»£ç å‰ï¼Œæ˜ç¡®äº†è§£æ•°æ®çš„ç±»å‹ï¼Œé€‰æ‹©æœ€ä½³çš„æ•°æ®å¤„ç†æ–¹å¼ï¼Œéƒ½å¯ä»¥å¸®åŠ©ä¼˜åŒ–Pandasçš„æ€§èƒ½ã€‚ä»Šå¤©ä¼˜åŒ–äº†å¾ˆä¹…ï¼Œæ‰å°†æ—¶é—´ç¼©å‡åˆ°èƒ½æˆåŠŸè¿è¡Œã€‚åé¢æµ‹è¯•å¯¼å…¥dmäº†ï¼Œåˆè¦é‡æ–°é…ç½®ç¯å¢ƒã€‚</p></blockquote><h1 id="å¹³å°æµ‹è¯•å¯¼å…¥dm">å¹³å°æµ‹è¯•å¯¼å…¥dm</h1><h2 id="å­¦ä¹ æ—¥æœŸ-6-14">å­¦ä¹ æ—¥æœŸ: 6.14</h2><h2 id="é¡¹ç›®ä»»åŠ¡-11">é¡¹ç›®ä»»åŠ¡</h2><p>æ€»ç»“äº†ä¸€å¥—å¦‚ä½•å°†æ•°æ®å¯¼å…¥dmï¼Œä»å¹³å°å®‰è£…å¼€å§‹ã€‚</p><ul><li><p>é¦–å…ˆå®‰è£…python,æ­¥éª¤å¦‚ä¸‹</p><p><a href="http://t.csdn.cn/ls0Qx">http://t.csdn.cn/ls0Qx</a></p></li><li><p>å®‰è£…dmæ•°æ®åº“ï¼Œå¥½åƒä¸å…¨å®‰è£…ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œæ€•åæœŸéœ€è¦ç”¨åˆ°å°±å…¨å®‰è£…äº†</p><p><a href="http://t.csdn.cn/3ptEe%E5%9F%BA%E6%9C%AC%E5%85%A8%E5%A4%8D%E5%88%B6%E5%B0%B1%E5%8F%AF%E4%BB%A5%E4%BA%86">http://t.csdn.cn/3ptEeåŸºæœ¬å…¨å¤åˆ¶å°±å¯ä»¥äº†</a></p></li><li><p>ç„¶åéœ€è¦å»dmå®‰è£…ç›®å½•driverä¸‹é¢çš„ä¸¤ä¸ªç›®å½•ï¼Œä¸€ä¸ªdmPythonï¼Œä¸€ä¸ªsqlalchemyï¼Œæ‰§è¡Œpython3 set.up install</p><p>ç„¶åå°±èƒ½ä½¿ç”¨äº†ï¼Œå¯¼å…¥çš„æ—¶å€™å¯èƒ½ä¼šæœ‰äº›é—®é¢˜ï¼Œä¸€èˆ¬éƒ½æ˜¯ç¯å¢ƒå˜é‡çš„é—®é¢˜ï¼Œæœä¸€ä¸‹å°±å®Œæ´»äº†ã€‚</p></li></ul><h3 id="å››è¡¨æ•´åˆ">å››è¡¨æ•´åˆ</h3><p>å°†å‡ ä¸ªæ–‡ä»¶å…¨éƒ¨æ•´æˆåŒæ„çš„æ ·å¼ï¼Œè¿™æ ·åé¢åˆ†è¡¨çš„æ—¶å€™ï¼Œä»£ç å°±å…¨éƒ¨éƒ½èƒ½ç”¨äº†ï¼Œä¹Ÿåªç”¨æ‰§è¡Œä¸€éå³å¯ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> glob</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> radar</span><br><span class="line"><span class="keyword">from</span> snownlp <span class="keyword">import</span> SnowNLP</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> arrow</span><br><span class="line"><span class="keyword">from</span> faker <span class="keyword">import</span> Faker</span><br><span class="line"></span><br><span class="line"><span class="comment"># fakeréšæœºå€¼</span></span><br><span class="line">fakerCn = Faker(<span class="string">&#x27;zh_CN&#x27;</span>)</span><br><span class="line"></span><br><span class="line">order = [<span class="string">&#x27;SPOT_NAME&#x27;</span>, <span class="string">&#x27;LEVEL&#x27;</span>, <span class="string">&#x27;LOCATION&#x27;</span>, <span class="string">&#x27;GRADE&#x27;</span>, <span class="string">&#x27;QTY&#x27;</span>, <span class="string">&#x27;INTRO&#x27;</span>, <span class="string">&#x27;OPENTIME&#x27;</span>,</span><br><span class="line">         <span class="string">&#x27;NOTICE&#x27;</span>, <span class="string">&#x27;ST&#x27;</span>, <span class="string">&#x27;HOT&#x27;</span>, <span class="string">&#x27;CITY_ID&#x27;</span>, <span class="string">&#x27;RATING&#x27;</span>, <span class="string">&#x27;SPOT_ID&#x27;</span>,</span><br><span class="line">         <span class="string">&#x27;EVALUATION_NAME&#x27;</span>, <span class="string">&#x27;EVALUATION_TIME&#x27;</span>, <span class="string">&#x27;EVALUATION&#x27;</span>]</span><br><span class="line">dataType = &#123;<span class="string">&#x27;SPOT_NAME&#x27;</span>: <span class="built_in">str</span>, <span class="string">&#x27;LEVEL&#x27;</span>: <span class="built_in">str</span>, <span class="string">&#x27;LOCATION&#x27;</span>: <span class="built_in">str</span>, <span class="string">&#x27;GRADE&#x27;</span>: <span class="built_in">float</span>, <span class="string">&#x27;QTY&#x27;</span>: <span class="built_in">str</span>, <span class="string">&#x27;INTRO&#x27;</span>: <span class="built_in">str</span>, <span class="string">&#x27;OPENTIME&#x27;</span>: <span class="built_in">str</span>,</span><br><span class="line">            <span class="string">&#x27;NOTICE&#x27;</span>: <span class="built_in">str</span>, <span class="string">&#x27;ST&#x27;</span>: <span class="built_in">str</span>, <span class="string">&#x27;HOT&#x27;</span>: <span class="built_in">float</span>, <span class="string">&#x27;CITY_ID&#x27;</span>: <span class="built_in">str</span>, <span class="string">&#x27;RATING&#x27;</span>: <span class="built_in">float</span>, <span class="string">&#x27;SPOT_ID&#x27;</span>: <span class="built_in">str</span>,</span><br><span class="line">            <span class="string">&#x27;EVALUATION_NAME&#x27;</span>: <span class="built_in">str</span>, <span class="string">&#x27;EVALUATION_TIME&#x27;</span>: <span class="built_in">str</span>, <span class="string">&#x27;EVALUATION&#x27;</span>: <span class="built_in">str</span>&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">clearToAllDf</span>(<span class="params">merged_df</span>):</span><br><span class="line">    <span class="comment"># ä¿®æ”¹åˆ—åä»¥åŠæ¢è¡Œå’Œç©ºç™½å­—æ®µå¤„ç†</span></span><br><span class="line">    merged_df_copy = merged_df.copy()</span><br><span class="line">    merged_df_copy = merged_df_copy</span><br><span class="line">    spot_names = merged_df_copy[<span class="string">&#x27;SPOT_NAME&#x27;</span>].unique()</span><br><span class="line">    spot_id_dict = &#123;name: i + <span class="number">1</span> <span class="keyword">for</span> i, name <span class="keyword">in</span> <span class="built_in">enumerate</span>(spot_names)&#125;</span><br><span class="line">    merged_df_copy[<span class="string">&#x27;SPOT_ID&#x27;</span>] = merged_df_copy[<span class="string">&#x27;SPOT_NAME&#x27;</span>].apply(<span class="keyword">lambda</span> x: spot_id_dict[x])</span><br><span class="line">    <span class="keyword">return</span> merged_df_copy</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">csvqne</span>(<span class="params">folder_path</span>):</span><br><span class="line">    <span class="comment"># éå†æ–‡ä»¶å¤¹ä¸­æ‰€æœ‰æ–‡ä»¶</span></span><br><span class="line">    all_files = os.listdir(folder_path)</span><br><span class="line">    <span class="comment"># csv_files = [file for file in all_files if file.endswith(&#x27;.csv&#x27;)]</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># åˆå¹¶æ¯ä¸ª CSV æ–‡ä»¶ä¸ºä¸€ä¸ª DataFrameï¼Œå¹¶å°†å®ƒä»¬å­˜å‚¨åœ¨ä¸€ä¸ªåˆ—è¡¨ä¸­</span></span><br><span class="line">    dfs = []</span><br><span class="line">    <span class="keyword">for</span> file <span class="keyword">in</span> all_files:</span><br><span class="line">        file_path = os.path.join(folder_path, file)</span><br><span class="line">        df = pd.read_csv(file_path)</span><br><span class="line">        <span class="comment"># åˆ é™¤åŒ…å«ç©ºå€¼çš„è¡Œ</span></span><br><span class="line">        df.dropna(subset=[<span class="string">&#x27;COMMENT&#x27;</span>], inplace=<span class="literal">True</span>)</span><br><span class="line">        <span class="comment"># æ·»åŠ åˆ°æ•°ç»„</span></span><br><span class="line">        df.rename(columns=&#123;<span class="string">&#x27;SPOT&#x27;</span>: <span class="string">&#x27;SPOT_NAME&#x27;</span>, <span class="string">&#x27;CO_TIME&#x27;</span>: <span class="string">&#x27;EVALUATION_TIME&#x27;</span>, <span class="string">&#x27;CO_NAME&#x27;</span>: <span class="string">&#x27;EVALUATION_NAME&#x27;</span>,</span><br><span class="line">                           <span class="string">&#x27;COMMENT&#x27;</span>: <span class="string">&#x27;EVALUATION&#x27;</span>&#125;, inplace=<span class="literal">True</span>)</span><br><span class="line">        df = df.drop(columns=[<span class="string">&#x27;TGA&#x27;</span>]).reindex(columns=order)</span><br><span class="line">        df[<span class="string">&#x27;SPOT_NAME&#x27;</span>] = df[<span class="string">&#x27;SPOT_NAME&#x27;</span>].apply(<span class="keyword">lambda</span> x: x.replace(<span class="string">&quot;?&quot;</span>, <span class="string">&quot;&quot;</span>))</span><br><span class="line">        dfs.append(df)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å°†æ‰€æœ‰ DataFrame åˆå¹¶ä¸ºä¸€ä¸ª DataFrame</span></span><br><span class="line">    <span class="comment"># return pd.concat(dfs, ignore_index=True)</span></span><br><span class="line">    <span class="keyword">return</span> dfs</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">csvxc</span>(<span class="params">folder_path</span>):</span><br><span class="line">    all_files = os.listdir(folder_path)</span><br><span class="line">    dfs = []</span><br><span class="line">    <span class="keyword">for</span> file <span class="keyword">in</span> all_files:</span><br><span class="line">        file_path = os.path.join(folder_path, file)</span><br><span class="line">        df = pd.read_csv(file_path)</span><br><span class="line">        <span class="comment"># åˆ é™¤åŒ…å«ç©ºå€¼çš„è¡Œ</span></span><br><span class="line">        df.dropna(subset=[<span class="string">&#x27;COMMENT&#x27;</span>], inplace=<span class="literal">True</span>)</span><br><span class="line">        <span class="comment"># df[&#x27;ST&#x27;] = df[&#x27;INTRO&#x27;].apply(lambda x: re.search(r&#x27;æœåŠ¡è®¾æ–½([\s\S]*)&#x27;, x, re.S).group(1))</span></span><br><span class="line">        <span class="comment"># df[&#x27;NOTICE&#x27;] = df[&#x27;INTRO&#x27;].apply(lambda x: re.search(r&#x27;ä¼˜å¾…æ”¿ç­–\s*(.+?)\s*æœåŠ¡è®¾æ–½&#x27;, x, re.S).group(1))</span></span><br><span class="line">        <span class="comment"># df[&#x27;INTRO&#x27;] = df[&#x27;INTRO&#x27;].apply(lambda x: re.search(r&#x27;ä»‹ç»\s*(.+?)\s*å…¨æ–‡&#x27;, x, re.S).group(1))</span></span><br><span class="line">        df.rename(columns=&#123;<span class="string">&#x27;SPOT&#x27;</span>: <span class="string">&#x27;SPOT_NAME&#x27;</span>, <span class="string">&#x27;CO_TIME&#x27;</span>: <span class="string">&#x27;EVALUATION_TIME&#x27;</span>, <span class="string">&#x27;CO_NAME&#x27;</span>: <span class="string">&#x27;EVALUATION_NAME&#x27;</span>,</span><br><span class="line">                           <span class="string">&#x27;COMMENT&#x27;</span>: <span class="string">&#x27;EVALUATION&#x27;</span>&#125;, inplace=<span class="literal">True</span>)</span><br><span class="line">        df = df.reindex(columns=order)</span><br><span class="line">        df[<span class="string">&#x27;SPOT_NAME&#x27;</span>] = df[<span class="string">&#x27;SPOT_NAME&#x27;</span>].apply(<span class="keyword">lambda</span> x: x.replace(<span class="string">&quot;?&quot;</span>, <span class="string">&quot;&quot;</span>))</span><br><span class="line">        <span class="comment"># æ·»åŠ åˆ°æ•°ç»„</span></span><br><span class="line">        dfs.append(df)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å°†æ‰€æœ‰ DataFrame åˆå¹¶ä¸ºä¸€ä¸ª DataFrame</span></span><br><span class="line">    <span class="keyword">return</span> dfs</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">xlsx</span>(<span class="params">folder_path</span>):</span><br><span class="line">    all_files = os.listdir(folder_path)</span><br><span class="line">    dfs = []</span><br><span class="line">    <span class="keyword">for</span> file <span class="keyword">in</span> all_files:</span><br><span class="line">        file_path = os.path.join(folder_path, file)</span><br><span class="line">        df = pd.read_excel(file_path, engine=<span class="string">&#x27;openpyxl&#x27;</span>)</span><br><span class="line">        <span class="comment"># åˆ é™¤åŒ…å«ç©ºå€¼çš„è¡Œ</span></span><br><span class="line">        df.dropna(subset=[<span class="string">&#x27;COMMENT&#x27;</span>], inplace=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">        df.rename(columns=&#123;<span class="string">&#x27;SPOT&#x27;</span>: <span class="string">&#x27;SPOT_NAME&#x27;</span>, <span class="string">&#x27;CO_TIME&#x27;</span>: <span class="string">&#x27;EVALUATION_TIME&#x27;</span>, <span class="string">&#x27;CO_NAME&#x27;</span>: <span class="string">&#x27;EVALUATION_NAME&#x27;</span>,</span><br><span class="line">                           <span class="string">&#x27;COMMENT&#x27;</span>: <span class="string">&#x27;EVALUATION&#x27;</span>&#125;, inplace=<span class="literal">True</span>)</span><br><span class="line">        df = df.reindex(columns=order)</span><br><span class="line">        df[<span class="string">&#x27;SPOT_NAME&#x27;</span>] = df[<span class="string">&#x27;SPOT_NAME&#x27;</span>].apply(<span class="keyword">lambda</span> x: x.replace(<span class="string">&quot;?&quot;</span>, <span class="string">&quot;&quot;</span>))</span><br><span class="line"></span><br><span class="line">        <span class="comment"># æ·»åŠ åˆ°æ•°ç»„</span></span><br><span class="line">        dfs.append(df)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å°†æ‰€æœ‰ DataFrame åˆå¹¶ä¸ºä¸€ä¸ª DataFrame</span></span><br><span class="line">    <span class="keyword">return</span> dfs</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">txt</span>(<span class="params">folder_path</span>):</span><br><span class="line">    listDf = []</span><br><span class="line">    <span class="comment"># æ–‡ä»¶å¤¹ä½ç½®</span></span><br><span class="line">    <span class="comment"># folder_path = r&#x27;../data/txt&#x27;</span></span><br><span class="line">    <span class="comment"># æ‰“ç®—å°†æ¯ä¸ªæ–‡ä»¶éƒ½æŒ‰ç…§åˆ‡å‰²æˆå­—å…¸ï¼Œæœ€åæ”¾åˆ—è¡¨ä¸­å†åˆå¹¶</span></span><br><span class="line">    <span class="keyword">for</span> file_path <span class="keyword">in</span> glob.glob(os.path.join(folder_path, <span class="string">&#x27;*.txt&#x27;</span>)):</span><br><span class="line">        <span class="comment"># è¯»å–æ–‡ä»¶ å­—ç¬¦é›†ä¸ºutf-8 å­˜å…¥text</span></span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(file_path, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            text = f.read()</span><br><span class="line">        <span class="comment"># æ ¹æ®txtæ–‡ä»¶å…³é”®å­—å¤„ç†æˆkey:value</span></span><br><span class="line">        spot = text[text.find(<span class="string">&#x27;[SPOT]&#x27;</span>) + <span class="number">7</span>:text.find(<span class="string">&#x27;[LOCATION]&#x27;</span>)].strip()</span><br><span class="line">        location = text[text.find(<span class="string">&#x27;[LOCATION]&#x27;</span>) + <span class="number">11</span>:text.find(<span class="string">&#x27;[OPENTIME]&#x27;</span>)].strip()</span><br><span class="line">        opentime = text[text.find(<span class="string">&#x27;[OPENTIME]&#x27;</span>) + <span class="number">10</span>:text.find(<span class="string">&#x27;[PHONE]&#x27;</span>)].strip()</span><br><span class="line">        phone = text[text.find(<span class="string">&#x27;[PHONE]&#x27;</span>) + <span class="number">7</span>:text.find(<span class="string">&#x27;[INTRO]&#x27;</span>)].strip()</span><br><span class="line">        intro = text[text.find(<span class="string">&#x27;[INTRO]&#x27;</span>) + <span class="number">7</span>:text.find(<span class="string">&#x27;[GRADE]&#x27;</span>)].strip()</span><br><span class="line">        grade = text[text.find(<span class="string">&#x27;[GRADE]&#x27;</span>) + <span class="number">7</span>:text.find(<span class="string">&#x27;[HOT]&#x27;</span>)].strip()</span><br><span class="line">        hot = text[text.find(<span class="string">&#x27;[HOT]&#x27;</span>) + <span class="number">5</span>:text.find(<span class="string">&#x27;[SUM]&#x27;</span>)].strip()</span><br><span class="line">        sum_ = text[text.find(<span class="string">&#x27;[SUM]&#x27;</span>) + <span class="number">5</span>:text.find(<span class="string">&#x27;[COMMENT]&#x27;</span>)].strip()</span><br><span class="line">        comment = text[text.find(<span class="string">&#x27;[COMMENT]&#x27;</span>) + <span class="number">10</span>:text.find(<span class="string">&#x27;[COMMENT_GRADE]&#x27;</span>)].strip()</span><br><span class="line">        comment_grade = text[text.find(<span class="string">&#x27;[COMMENT_GRADE]&#x27;</span>) + <span class="number">15</span>:text.find(<span class="string">&#x27;[COMMENT_TIME]&#x27;</span>)].strip()</span><br><span class="line">        comment_time = text[text.find(<span class="string">&#x27;[COMMENT_TIME]&#x27;</span>) + <span class="number">14</span>:].strip()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># å°†æ•°æ®è½¬æ¢æˆkey:valueæ ¼å¼</span></span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&#x27;SPOT_NAME&#x27;</span>: spot,</span><br><span class="line">            <span class="string">&#x27;LEVEL&#x27;</span>: np.nan,</span><br><span class="line">            <span class="string">&#x27;LOCATION&#x27;</span>: location,</span><br><span class="line">            <span class="string">&#x27;OPENTIME&#x27;</span>: opentime,</span><br><span class="line">            <span class="string">&#x27;PHONE&#x27;</span>: phone,</span><br><span class="line">            <span class="string">&#x27;INTRO&#x27;</span>: intro,</span><br><span class="line">            <span class="string">&#x27;NOTICE&#x27;</span>: np.nan,</span><br><span class="line">            <span class="string">&#x27;ST&#x27;</span>: np.nan,</span><br><span class="line">            <span class="string">&#x27;GRADE&#x27;</span>: grade,</span><br><span class="line">            <span class="string">&#x27;HOT&#x27;</span>: hot,</span><br><span class="line">            <span class="string">&#x27;QTY&#x27;</span>: sum_,</span><br><span class="line">            <span class="string">&#x27;EVALUATION&#x27;</span>: comment,</span><br><span class="line">            <span class="string">&#x27;EVALUATION_GRADE&#x27;</span>: comment_grade,</span><br><span class="line">            <span class="string">&#x27;EVALUATION_TIME&#x27;</span>: comment_time,</span><br><span class="line">            <span class="comment"># ç”¨æˆ·åå¡«å……</span></span><br><span class="line">            <span class="string">&#x27;EVALUATION_NAME&#x27;</span>: fakerCn.user_name()</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment"># å­˜å…¥æ•°ç»„</span></span><br><span class="line">        listDf.append(data)</span><br><span class="line">    df = pd.DataFrame(listDf).reindex(columns=order)</span><br><span class="line">    df[<span class="string">&#x27;SPOT_NAME&#x27;</span>] = df[<span class="string">&#x27;SPOT_NAME&#x27;</span>].apply(<span class="keyword">lambda</span> x: x.replace(<span class="string">&quot;?&quot;</span>, <span class="string">&quot;&quot;</span>))</span><br><span class="line">    df[<span class="string">&#x27;ST&#x27;</span>] = df[<span class="string">&#x27;INTRO&#x27;</span>].apply(<span class="keyword">lambda</span> x: re.search(<span class="string">r&#x27;æœåŠ¡è®¾æ–½([\s\S]*)&#x27;</span>, x, re.S).group(<span class="number">1</span>))</span><br><span class="line">    df[<span class="string">&#x27;NOTICE&#x27;</span>] = df[<span class="string">&#x27;INTRO&#x27;</span>].apply(<span class="keyword">lambda</span> x: re.search(<span class="string">r&#x27;ä¼˜å¾…æ”¿ç­–\s*(.+?)\s*æœåŠ¡è®¾æ–½&#x27;</span>, x, re.S).group(<span class="number">1</span>))</span><br><span class="line">    df[<span class="string">&#x27;INTRO&#x27;</span>] = df[<span class="string">&#x27;INTRO&#x27;</span>].apply(<span class="keyword">lambda</span> x: re.search(<span class="string">r&#x27;ä»‹ç»\s*(.+?)\s*å…¨æ–‡&#x27;</span>, x, re.S).group(<span class="number">1</span>))</span><br><span class="line">    <span class="keyword">return</span> df</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dataTopkl</span>():</span><br><span class="line">    csvqne_list = csvqne(<span class="string">&quot;../data/hdfscsv/qnecsv&quot;</span>)</span><br><span class="line">    csvxc_list = csvxc(<span class="string">&quot;../data/hdfscsv/xccsv&quot;</span>)</span><br><span class="line">    excel_list = xlsx(<span class="string">&#x27;../data/hdfsexcel&#x27;</span>)</span><br><span class="line">    txt_list = [txt(<span class="string">r&#x27;../data/hdfstxt&#x27;</span>).astype(dataType)]</span><br><span class="line">    all_list = csvxc_list + csvqne_list + excel_list + txt_list</span><br><span class="line">    all_df = pd.concat(all_list, ignore_index=<span class="literal">True</span>)</span><br><span class="line">    all_df.to_pickle(<span class="string">&#x27;allTemp.pkl&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    a = time.time()</span><br><span class="line">    dataTopkl()</span><br><span class="line">    a1 = time.time()</span><br><span class="line">    finalTime = arrow.get(a1 - a).<span class="built_in">format</span>(<span class="string">&#x27;mmåˆ†:ssç§’:SSSæ¯«ç§’&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;æ‰§è¡Œé€Ÿåº¦&quot;</span>, finalTime)</span><br></pre></td></tr></table></figure><h2 id="BUG-11">BUG</h2><p>â€‹å°†æ•°æ®å¯¼å…¥dmçš„æ—¶å€™ï¼Œå› ä¸ºå¤§è‡´å››ç§æ–‡ä»¶ï¼Œæ ¼å¼éƒ½ä¸å¤ªä¸€æ ·ï¼Œä»‹ç»é‚£å—æœ‰ä¸ªè¡¨æ˜¯åˆ†ä¸‰åˆ—ï¼Œä¸‰åˆ—ç¡®å®æ˜¯æœ€ä¼˜çš„é€‰æ‹©ï¼ŒåŸæœ¬txtæ–‡ä»¶åˆ†æˆä¸‰åˆ—å·²ç»å†™å¥½äº†ï¼Œä½†æ˜¯å‘ç°åœ¨xlsxæ–‡ä»¶æ˜¯ç”¨ä¸äº†çš„ï¼Œå› ä¸ºå¾ˆå¤šéƒ½æ˜¯æ²¡æœ‰è¿™äº›å­—æ®µï¼Œå¯¼è‡´æ— æ³•ä½¿ç”¨ï¼Œä¹Ÿå’©æœ‰å¾ˆå¥½çš„è§£å†³åŠæ³•ï¼Œæš‚å®šé‚£äº›æ— æ³•å¤„ç†çš„ï¼Œå°±å°†å…¶ä»–ä¸¤åˆ—å…ˆä¸ºç©ºäº†ï¼Œåé¢å†æƒ³åŠæ³•ã€‚</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/image-20250820102718211.png" alt="image-20250820102718211"></p><h2 id="æ—¥æ€»ç»“-11">æ—¥æ€»ç»“</h2><blockquote><p>â€‹ä»Šå¤©è¯•å°†æ•°æ®å¯¼å…¥æ•°æ®åº“ï¼Œå®‰è£…dmç‹¬æœ‰çš„ä¾èµ–èŠ±è´¹äº†å¾ˆé•¿ä¸€æ®µæ—¶å€™ï¼Œæ™šä¸Šæ€»ç»“äº†ä¸€ä¸‹æ€ä¹ˆlinuxç³»ç»Ÿé‡è£…ï¼Œæ€•ä»¥åè¿˜ç”¨å¾—åˆ°ï¼Œä»Šå¤©å¤§éƒ¨åˆ†çš„æ—¶å€™éƒ½æ˜¯åœ¨å®‰è£…ä¾èµ–ï¼Œå› ä¸ºè¿™å¹³å°å¯¹å¤–é™æµï¼Œyumå’Œpipéƒ½å¾ˆæ…¢ï¼Œåˆå°†æ€»è¡¨çš„æ•°æ®ç»˜åˆ¶äº†ä¸€ä¸‹ï¼Œæ¢³ç†äº†ä¸€ä¸‹å¯¼å…¥æ­¥éª¤ï¼Œæ‰“ç®—å…ˆå°†è¯„è®ºå¯¼å…¥ï¼Œç„¶åæ˜¯æ®‹ç¼ºçš„spotï¼Œå› ä¸ºå¦‚æœspotæœ‰é—®é¢˜ï¼Œè¯»æ®‹ç¼ºç‰ˆçš„å°±è¡Œäº†ï¼Œè¿™æ ·æ•ˆç‡ä¼šå¿«å¾ˆå¤šï¼Œä¸ç”¨é‡æ–°50wæ¡é‡æ–°å¯¼å…¥ã€‚</p></blockquote><h1 id="æœåŠ¡å™¨é‡è£…-è¯„è®ºè¡¨å¯¼å…¥dm">æœåŠ¡å™¨é‡è£… è¯„è®ºè¡¨å¯¼å…¥dm</h1><h2 id="å­¦ä¹ æ—¥æœŸ-6-15">å­¦ä¹ æ—¥æœŸ: 6.15</h2><h2 id="é¡¹ç›®ä»»åŠ¡-12">é¡¹ç›®ä»»åŠ¡</h2><h3 id="èµ·å› -4">èµ·å› </h3><p>â€‹ä»Šå¤©è·‘è¯„è®ºè¡¨çš„æ—¶å€™å‘ç°å®åœ¨æ˜¯å¤ªæ…¢äº†ï¼Œæ£€æŸ¥topè¿è¡Œè¿›ç¨‹çš„æ—¶å€™å‘ç°ï¼ŒCPUå’Œå†…å­˜éƒ½æ˜¯åœ¨100%çŠ¶æ€ï¼Œåé¢æ£€æŸ¥æœºå™¨å‘ç°ï¼Œæœ€å¤§é™åˆ¶åœ¨äº†1æ ¸ï¼Œé‚£æ€ä¹ˆç©ï¼Œå°±å…ˆæš‚åœäº†ï¼Œä¿®æ”¹æˆäº†8G 4æ ¸ï¼Œä½†æ˜¯é‡æ–°å¯åŠ¨çš„æ—¶å€™ï¼Œå‘ç°å¹³å°é•œåƒåˆæ¸…ç©ºäº†ï¼ŒçœŸå—ä¸äº†ä¸€ç‚¹ï¼ŒåˆèŠ±äº†ä¸€ä¸Šåˆé‡è£…ã€‚</p><h3 id="æœåŠ¡å™¨é‡è£…">æœåŠ¡å™¨é‡è£…</h3><p>æŒ‰ç…§æ˜¨å¤©çš„æ­¥éª¤åŸºæœ¬æ²¡æœ‰é—®é¢˜ï¼Œç‰ˆæœ¬æ¢æˆäº†3.8.8,å®‰è£…ä¾èµ–çš„æ—¶å€™ä¸»è¦pandas1.3.5 å°±è¡Œäº†ã€‚</p><h3 id="è¯„è®ºè¡¨å¯¼å…¥dm">è¯„è®ºè¡¨å¯¼å…¥dm</h3><p>æµ‹è¯•dataframeå¯¼å…¥dmæ²¡æœ‰é—®é¢˜äº†ã€‚ å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå› ä¸ºæ•°æ®é‡æœ‰ç‚¹å¤§ï¼Œto_sqlä¸€æ¬¡è¿›ä¸å»ï¼Œå°±åˆ†æ‰¹å¯¼å…¥äº†ï¼Œå¤§æ¦‚éœ€è¦1åˆ†é’Ÿï¼Œä¸å¦‚ä¸åˆ†æ‰¹ä¼šç›´æ¥æŠ¥é”™</p><p>ä»£ç å¦‚ä¸‹:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> warnings</span><br><span class="line"><span class="keyword">from</span> sqlalchemy <span class="keyword">import</span> create_engine</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> radar</span><br><span class="line"><span class="keyword">from</span> snownlp <span class="keyword">import</span> SnowNLP</span><br><span class="line"><span class="keyword">import</span> arrow</span><br><span class="line"><span class="keyword">from</span> faker <span class="keyword">import</span> Faker</span><br><span class="line"></span><br><span class="line"><span class="comment"># fakeréšæœºå€¼</span></span><br><span class="line">fakerCn = Faker(<span class="string">&#x27;zh_CN&#x27;</span>)</span><br><span class="line"><span class="comment"># å¿½ç•¥è­¦å‘Š</span></span><br><span class="line">warnings.filterwarnings(<span class="string">&quot;ignore&quot;</span>, message=<span class="string">&quot;Could not import the lzma module.&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">scoreSnow</span>(<span class="params">sentiments</span>):</span><br><span class="line">    <span class="comment"># sentiments = SnowNLP(comment).sentiments</span></span><br><span class="line">    <span class="keyword">if</span> <span class="number">0.9</span> &lt;= sentiments &lt;= <span class="number">1</span>:</span><br><span class="line">        feelMood = <span class="string">&quot;è¶…æ£’&quot;</span></span><br><span class="line">    <span class="keyword">elif</span> <span class="number">0.8</span> &lt;= sentiments &lt;= <span class="number">0.9</span>:</span><br><span class="line">        feelMood = <span class="string">&quot;æ»¡æ„&quot;</span></span><br><span class="line">    <span class="keyword">elif</span> <span class="number">0.5</span> &lt;= sentiments &lt;= <span class="number">0.8</span>:</span><br><span class="line">        feelMood = <span class="string">&quot;ä¸é”™&quot;</span></span><br><span class="line">    <span class="keyword">elif</span> <span class="number">0.2</span> &lt;= sentiments &lt;= <span class="number">0.5</span>:</span><br><span class="line">        feelMood = <span class="string">&quot;ä¸€èˆ¬&quot;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        feelMood = <span class="string">&quot;ä¸ä½³&quot;</span></span><br><span class="line">    <span class="keyword">return</span> feelMood</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">clearSpotComment</span>(<span class="params">allInfoDf, province_list</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;è¯„è®ºè¡¨å¼€å§‹å¤„ç†&quot;</span>)</span><br><span class="line">    comment_df = allInfoDf[allInfoDf.columns[<span class="number">12</span>:]].copy()</span><br><span class="line">    comment_df.insert(<span class="number">2</span>, <span class="string">&#x27;EVALUATION_GRADE&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    comment_df[<span class="string">&#x27;FEEL_SCORE&#x27;</span>] = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    comment_df[<span class="string">&#x27;FEEL&#x27;</span>] = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    order = [<span class="string">&#x27;SPOT_ID&#x27;</span>, <span class="string">&#x27;EVALUATION&#x27;</span>, <span class="string">&#x27;EVALUATION_GRADE&#x27;</span>, <span class="string">&#x27;EVALUATION_TIME&#x27;</span>,</span><br><span class="line">             <span class="string">&#x27;EVALUATION_NAME&#x27;</span>, <span class="string">&#x27;FEEL_SCORE&#x27;</span>, <span class="string">&#x27;FEEL&#x27;</span>]</span><br><span class="line">    comment_df = comment_df[order]</span><br><span class="line">    <span class="comment"># æ—¶é—´å¤„ç† è¿™ç»„æ˜¯å¯¹2018/9/16 è¿™ç±»æ²¡-è€Œä¸”ipæ²¡æœ‰çš„æ•°æ®å¤„ç†</span></span><br><span class="line">    comment_df[<span class="string">&#x27;EVALUATION_TIME&#x27;</span>] = comment_df[<span class="string">&#x27;EVALUATION_TIME&#x27;</span>].apply(<span class="keyword">lambda</span> x: x.replace(<span class="string">&quot;/&quot;</span>, <span class="string">&quot;-&quot;</span>))</span><br><span class="line">    comment_df[<span class="string">&#x27;EVALUATION_TIME&#x27;</span>] = comment_df[<span class="string">&#x27;EVALUATION_TIME&#x27;</span>].apply(</span><br><span class="line">        <span class="keyword">lambda</span> x: <span class="built_in">str</span>(radar.random_date(<span class="string">&quot;2020-09-13&quot;</span>, <span class="string">&quot;2023-02-02&quot;</span>).date()) <span class="keyword">if</span> x == <span class="string">&quot;&quot;</span> <span class="keyword">else</span> (</span><br><span class="line">            x + <span class="string">&quot;IPå±åœ°: &quot;</span> + np.random.choice(province_list) <span class="keyword">if</span> <span class="string">&quot;IP&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> x <span class="keyword">else</span> x))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">calculate_scores</span>(<span class="params">row</span>):</span><br><span class="line">        row.EVALUATION = <span class="string">&#x27;&#x27;</span>.join(<span class="built_in">str</span>(row.EVALUATION).split())</span><br><span class="line">        <span class="keyword">if</span> (row.EVALUATION == <span class="string">&quot;ç”¨æˆ·æœªç‚¹è¯„ã€‚ç³»ç»Ÿé»˜è®¤å¥½è¯„ã€‚&quot;</span>) <span class="keyword">or</span> (<span class="built_in">type</span>(row.EVALUATION) != <span class="built_in">str</span>):</span><br><span class="line">            score = <span class="number">1.0</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            score = <span class="built_in">round</span>(SnowNLP(row.EVALUATION).sentiments, <span class="number">2</span>)</span><br><span class="line">        feelScore = <span class="built_in">round</span>(score * <span class="number">5</span>, <span class="number">1</span>)</span><br><span class="line">        <span class="comment"># è¯„è®ºæƒ…ç»ª</span></span><br><span class="line">        feel = scoreSnow(score)</span><br><span class="line">        <span class="keyword">if</span> row.EVALUATION_GRADE == <span class="string">&quot;&quot;</span>:</span><br><span class="line">            row.EVALUATION_GRADE = <span class="built_in">str</span>(<span class="built_in">int</span>(<span class="built_in">round</span>(feelScore, <span class="number">0</span>))) + <span class="string">&quot;åˆ† &quot;</span> + feel</span><br><span class="line"></span><br><span class="line">        row.FEEL_SCORE = feelScore</span><br><span class="line">        row.FEEL = feel</span><br><span class="line">        <span class="keyword">return</span> row</span><br><span class="line"></span><br><span class="line">    comment_df = comment_df.apply(calculate_scores, axis=<span class="number">1</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;è¯„è®ºè¡¨ç»“æŸå¤„ç†&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> comment_df</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">provinceRandom</span>() -&gt; <span class="built_in">str</span>:</span><br><span class="line">    province = fakerCn.province()</span><br><span class="line">    <span class="keyword">if</span> province.find(<span class="string">&quot;çœ&quot;</span>) != -<span class="number">1</span> <span class="keyword">or</span> province.find(<span class="string">&quot;å¸‚&quot;</span>) != -<span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> province[<span class="number">0</span>:-<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">return</span> provinceRandom()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">provinceList</span>():</span><br><span class="line">    province_list = []</span><br><span class="line">    <span class="keyword">while</span> <span class="built_in">len</span>(province_list) &lt;= <span class="number">33</span>:</span><br><span class="line">        province = fakerCn.province()[<span class="number">0</span>:<span class="number">2</span>]</span><br><span class="line">        <span class="keyword">if</span> province <span class="keyword">not</span> <span class="keyword">in</span> province_list:</span><br><span class="line">            province_list.append(province)</span><br><span class="line">    <span class="keyword">return</span> province_list</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">intoDm</span>(<span class="params">data, tableName</span>):</span><br><span class="line">    <span class="comment"># åˆ›å»ºurl</span></span><br><span class="line">    conn_url = <span class="string">&#x27;dm+dmPython://SYSDBA:SYSDBA001@47.120.9.247:5237&#x27;</span></span><br><span class="line">    <span class="comment"># åˆ›å»ºEngineå¯¹è±¡</span></span><br><span class="line">    engine = create_engine(conn_url)</span><br><span class="line">    <span class="comment"># åˆ°dm8ä¸­</span></span><br><span class="line">    data.to_sql(name=tableName, con=engine, if_exists=<span class="string">&#x27;append&#x27;</span>, index=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    a = time.time()</span><br><span class="line">    provinces = provinceList()</span><br><span class="line">    provinces.remove(<span class="string">&quot;é»‘é¾™&quot;</span>)</span><br><span class="line">    provinces.append(<span class="string">&quot;é»‘é¾™æ±Ÿ&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;çœä»½ç­›é€‰å®Œæˆ&quot;</span>)</span><br><span class="line"></span><br><span class="line">    allDf = pd.read_pickle(<span class="string">&#x27;allClearData.pkl&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    comment_temp_df = clearSpotComment(allDf, provinces)</span><br><span class="line">    comment_temp_df.to_pickle(<span class="string">&#x27;commentFinalData.pkl&#x27;</span>)</span><br><span class="line">    path = <span class="string">&#x27;commentFinalData.pkl&#x27;</span></span><br><span class="line">    comment_temp = pd.read_pickle(path)</span><br><span class="line">    <span class="comment"># ä¿®æ”¹objectçš„ç±»å‹</span></span><br><span class="line">    <span class="keyword">for</span> col <span class="keyword">in</span> comment_temp.select_dtypes(include=[<span class="built_in">object</span>]):</span><br><span class="line">        comment_temp[col] = comment_temp[col].astype(<span class="string">&#x27;string&#x27;</span>)</span><br><span class="line">    <span class="comment"># åˆ†æ‰¹å¯¼å…¥1000ä¸€æ¬¡</span></span><br><span class="line">    chunkSize = <span class="number">1000</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(comment_temp), chunkSize):</span><br><span class="line">        data_chunk = comment_temp[i:i + chunkSize]</span><br><span class="line">        intoDm(data_chunk, <span class="string">&#x27;comment_info&#x27;</span>)</span><br><span class="line">    a1 = time.time()</span><br><span class="line">    finalTime = arrow.get(a1 - a).<span class="built_in">format</span>(<span class="string">&#x27;mmåˆ†:ssç§’:SSSæ¯«ç§’&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;æ‰§è¡Œé€Ÿåº¦&quot;</span>, finalTime)</span><br></pre></td></tr></table></figure><h2 id="BUG-12">BUG</h2><p>â€‹ä¹‹å‰pythonä¸€ç›´è«åå…¶å¦™çš„è‡ªå·±åœæ­¢ï¼Œä¸€ç›´æ¨æµ‹æ˜¯å†…å­˜æº¢å‡ºçš„é—®é¢˜ï¼Œä½†æ˜¯æœåŠ¡å™¨ä¸­å†…å­˜æ˜¯æœ‰12Gçš„ï¼Œä¸åº”è¯¥å•Šï¼Œè‡ªå·±ç¨‹åºå†…å­˜æ’‘æ­»ä¹Ÿå°±å ç”¨4ä¸ªGï¼Œåæ¥topæŸ¥çœ‹å®æ—¶è¿è¡Œè¿›ç¨‹çš„æ—¶å€™ï¼Œå‘ç°æœ‰å¾ˆå¤špython3çš„ä»»åŠ¡è¿˜åœ¨è·‘ï¼Œä½†æ˜¯æ²¡æœ‰åœæ­¢ï¼Œå ç”¨äº†å¤§é‡çš„å†…å­˜ï¼Œå¯¼è‡´ä»Šå¤©å†…å­˜éƒ½å´©äº†ï¼Œprintéƒ½ä¸è¡Œã€‚æ€æ­»å°±å¥½äº†ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pkill -9 python3 <span class="comment">#æ€æ­»è¿›ç¨‹</span></span><br><span class="line"><span class="built_in">echo</span> 3 &gt; /proc/sys/vm/drop_caches <span class="comment">#æ¸…é™¤ç¼“å­˜</span></span><br></pre></td></tr></table></figure><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/image-20250820102734570.png" alt="image-20250820102734570"></p><p>è¿›ç¨‹å¦‚ä¸‹</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/image-20250820102740544.png" alt="image-20250820102740544"></p><h2 id="æ—¥æ€»ç»“-12">æ—¥æ€»ç»“</h2><blockquote><p>â€‹ä»Šå¤©èŠ±ç‚¹æ—¶é—´å¤„ç†æ‰äº†æœ€éº»çƒ¦çš„è¯„è®ºè¡¨ï¼Œä¹‹æ‰€ä»¥éº»çƒ¦æ˜¯å› ä¸ºè¯„è®ºè¿™è¾¹éœ€è¦çš„æŠ€æœ¯ç‚¹æ˜¯æœ€å¤šçš„ï¼Œä¸€äº›æ•°æ®çš„å¡«å……éƒ½éœ€è¦ç”¨åˆ°aiï¼Œæ•°æ®æŒ–æ˜ï¼Œè¯­è¨€å¤„ç†ï¼Œè¿›è¡Œç¼ºå¤±å€¼çš„å¡«å……ã€‚è€Œä¸”æ•°æ®é‡æ˜¯æœ€å¤šçš„ï¼Œå› ä¸ºæˆ‘æ˜¯ç­–ç•¥æ˜¯45wæ¡ä¸€èµ·çš„ï¼Œæ‰€ä»¥ä¼šå¯¼è‡´æŒºæ…¢çš„ã€‚æ•ˆæœä¸é”™çš„ï¼Œè¯„è®ºæˆ‘å¤§è‡´åˆ†äº†7ä¸ªå­—æ®µï¼Œæ‰€æœ‰çš„nanç¼ºå¤±å€¼éƒ½å¡«å……äº†ï¼Œè€Œä¸”å¯¹è¯­è¨€æƒ…ç»ªè¿›è¡Œäº†åˆ†æã€‚ä¸å‡ºæ„å¤–æ˜å¤©å°±èƒ½æŠŠhdfsçš„æ–°æ•°æ®ï¼Œæ¸…æ´—å®Œæ¯•äº†ã€‚</p></blockquote><h1 id="æ•°æ®æ¸…æ´—å·¥ä½œå®Œæˆ">æ•°æ®æ¸…æ´—å·¥ä½œå®Œæˆ</h1><h2 id="å­¦ä¹ æ—¥æœŸ-6-16">å­¦ä¹ æ—¥æœŸ: 6.16</h2><h2 id="é¡¹ç›®ä»»åŠ¡-13">é¡¹ç›®ä»»åŠ¡</h2><p>â€‹ç›®å‰æˆ‘åˆ†äº†å››ä¸ªæ–‡ä»¶ï¼Œæ”¹å¤©ä¼šåˆå¹¶æˆä¸€ä¸ªpyæ–‡ä»¶ï¼Œåˆ©ç”¨to_pickleå¤„ç†æˆï¼Œpandaså¤„ç†æœ€å¿«çš„æ–¹å¼ï¼Œè¿™æ ·å°±ä¸ä¼šåœ¨å†…å­˜ä¸­å ç”¨èµ„æºï¼Œè€Œæ˜¯å°†æ•°æ®æ”¾å…¥ç£ç›˜ä¸­ï¼Œä¸ä»…è§£å†³äº†å†…å­˜è¶…å‡ºé—®é¢˜ï¼Œè€Œä¸”ä¼˜åŒ–äº†é€Ÿåº¦ã€‚ä»£ç æ¯”è¾ƒå¤šå°±ä¸æ”¾è¿™ç¯‡ç¬”è®°ä¸­äº†ï¼Œä¼šä¼ åˆ°åšå®¢ä¸­ï¼Œç­‰æ¯”èµ›ç»“æŸå†å…¬å¼€ã€‚</p><h3 id="levelç¼ºå¤±å€¼å¡«å……">levelç¼ºå¤±å€¼å¡«å……</h3><p>ç”¨äº†å›å½’æ¨¡å‹ï¼Œä½†æ˜¯ä¸æ˜¯å¾ˆå‡†ç¡®ï¼Œå¦‚æœä½œä¸º4Aè¿™æ ·çš„æ™¯åŒºè¯„å®šçš„è¯ï¼Œè¿˜æ˜¯ç»°ç»°æœ‰ä½™çš„ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">level_dict = &#123;<span class="string">&#x27;3Aæ™¯åŒº&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;4Aæ™¯åŒº&#x27;</span>: <span class="number">2</span>, <span class="string">&#x27;5Aæ™¯åŒº&#x27;</span>: <span class="number">3</span>&#125;</span><br><span class="line">df[<span class="string">&#x27;LEVEL&#x27;</span>] = df[<span class="string">&#x27;LEVEL&#x27;</span>].<span class="built_in">map</span>(level_dict)</span><br><span class="line"><span class="comment"># å°†ç­‰çº§ç¼ºå¤±çš„å¡«å……ä¸º-1</span></span><br><span class="line">df[<span class="string">&#x27;LEVEL&#x27;</span>].fillna(-<span class="number">1</span>, inplace=<span class="literal">True</span>)</span><br><span class="line"><span class="comment"># åˆ›å»ºLEVELæœ‰ç¼ºå¤±å€¼çš„è¡¨</span></span><br><span class="line">predict_data = df[df[<span class="string">&#x27;LEVEL&#x27;</span>] == -<span class="number">1</span>]</span><br><span class="line"><span class="comment"># æ•°æ®å¢å¼º</span></span><br><span class="line">listData = []</span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    listData.append(df[df[<span class="string">&#x27;LEVEL&#x27;</span>] != -<span class="number">1</span>].sample(frac=<span class="number">0.8</span>))</span><br><span class="line">enhance = pd.concat(listData, ignore_index=<span class="literal">True</span>)</span><br><span class="line"><span class="comment"># åˆ›å»ºçº¿æ€§å›å½’æ¨¡å‹</span></span><br><span class="line">lr = LinearRegression()</span><br><span class="line"><span class="comment"># å»ºç«‹è®­ç»ƒæ•°æ®é›†å’Œæµ‹è¯•æ•°æ®é›† (ä½¿ç”¨çš„æ˜¯80/20åˆ’åˆ†)</span></span><br><span class="line">train_data = enhance.sample(frac=<span class="number">0.8</span>)</span><br><span class="line"><span class="comment"># æŠŠå¤§éƒ¨åˆ†æ•°æ®ç•™ç»™æµ‹è¯•é›†ï¼Œåªä½¿ç”¨ä¸€å°éƒ¨åˆ†ä½œä¸ºè®­ç»ƒé›†</span></span><br><span class="line">test_data = df[df[<span class="string">&#x27;LEVEL&#x27;</span>] != -<span class="number">1</span>]</span><br><span class="line"><span class="comment"># fitæ¨¡å‹</span></span><br><span class="line">lr.fit(train_data[[<span class="string">&#x27;GRADE&#x27;</span>, <span class="string">&#x27;QTY&#x27;</span>,<span class="string">&#x27;HOT&#x27;</span>,<span class="string">&#x27;RATING&#x27;</span>]].values, train_data[<span class="string">&#x27;LEVEL&#x27;</span>].values)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æµ‹è¯•æ¨¡å‹</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;æ¨¡å‹å¾—åˆ†: &#x27;</span>, lr.score(test_data[[<span class="string">&#x27;GRADE&#x27;</span>, <span class="string">&#x27;QTY&#x27;</span>,<span class="string">&#x27;HOT&#x27;</span>,<span class="string">&#x27;RATING&#x27;</span>]].values, test_data[<span class="string">&#x27;LEVEL&#x27;</span>].values))</span><br><span class="line">prediction= lr.predict(predict_data[[<span class="string">&#x27;GRADE&#x27;</span>, <span class="string">&#x27;QTY&#x27;</span>,<span class="string">&#x27;HOT&#x27;</span>,<span class="string">&#x27;RATING&#x27;</span>]].values)</span><br><span class="line">prediction[prediction &gt; <span class="number">3</span>] = <span class="number">3</span></span><br><span class="line">prediction[prediction &lt; <span class="number">1</span>] = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># é¢„æµ‹ç¼ºå¤±çš„æ™¯åŒºç­‰çº§</span></span><br><span class="line">predict_data[<span class="string">&#x27;LEVEL&#x27;</span>] = prediction.<span class="built_in">round</span>(<span class="number">0</span>)</span><br><span class="line">df.update(predict_data)</span><br><span class="line"><span class="comment"># æ™¯åŒºç­‰çº§è¿˜åŸ</span></span><br><span class="line">level_dict = &#123;<span class="number">1</span>:<span class="string">&#x27;3Aæ™¯åŒº&#x27;</span>, <span class="number">2</span>:<span class="string">&#x27;4Aæ™¯åŒº&#x27;</span>, <span class="number">3</span>:<span class="string">&#x27;5Aæ™¯åŒº&#x27;</span>&#125;</span><br><span class="line">df[<span class="string">&#x27;LEVEL&#x27;</span>] = df[<span class="string">&#x27;LEVEL&#x27;</span>].<span class="built_in">map</span>(level_dict)</span><br></pre></td></tr></table></figure><h2 id="BUG-13">BUG</h2><p>â€‹ä¿®æ”¹è¡¨ç±»å‹å°†textæ¢æˆvarcharçš„äº†ä»¥åï¼Œæˆ‘å†å¯¼å…¥spotæ™¯åŒºæ•°æ®ï¼Œå‘ç°æŠ¥é”™äº†ï¼Œä¸€çœ‹å°±æ˜¯stringç±»å‹å¤ªçŸ­äº†ï¼Œå­˜ä¸ä½æ™¯åŒºä»‹ç»é‚£å‡ å—ï¼Œé‚£å‡ å—æ¢æˆäº†textï¼Œå…¶ä»–ä¾æ—§varcharï¼Œå°±æ²¡é—®é¢˜äº†ã€‚</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/image-20250820102754432.png" alt="image-20250820102754432"></p><h2 id="æ—¥æ€»ç»“-13">æ—¥æ€»ç»“</h2><blockquote><p>â€‹ä»Šå¤©æŠŠspotå’Œå…¶ä»–åŸå¸‚è¡¨å’Œçœä»½è¡¨éƒ½é‡æ–°å¯¼å…¥äº†ï¼Œè€Œä¸”å»ºç«‹äº†å¤‡ä»½æ–‡ä»¶ï¼Œé˜²æ­¢æ•°æ®ä¸¢å¤±ï¼Œå› ä¸ºç°åœ¨å·²ç»æ˜¯åœ¨å¹³å°äº†ï¼Œç­‰åé¢æ¸…æ´—çš„æ—¶å€™å¤§æ¦‚åªéœ€è¦20ç§’ã€‚æ˜å¤©è¿˜æ˜¯è¦æ•´ç†ä¸€ä¸‹è‡ªå·±çš„ä»£ç åŒ…ï¼Œæ³¨é‡Šéœ€è¦æ·»åŠ çš„æ·»åŠ ä¸€ä¸‹ï¼Œæ–‡æ¡£æ˜¯éœ€è¦å†™ä»£ç å¦‚ä½•æ¸…æ´—å’Œè¿è¡Œçš„ï¼Œæ‰€ä»¥ä¸ºäº†ä¸ç¹çï¼Œè¿˜æ˜¯éœ€è¦æ•´ç†ä¸€ä¸‹çš„ï¼Œé€Ÿåº¦æ–¹é¢è¯„è®ºé‚£éƒ¨åˆ†å®åœ¨æ˜¯å¤ªå¤§äº†ï¼Œä¹Ÿæ²¡æœ‰å¾ˆå¥½çš„ä¼˜åŒ–æ–¹æ¡ˆï¼Œå°±æš‚å®šå¦‚æ­¤äº†ã€‚å¦‚æœæœ‰ç©ºå†ä¿®æ”¹ä¸€ä¸‹ã€‚</p></blockquote><h1 id="æ™¯åŒºè¯„è®ºæ¥å£ä¿®æ”¹">æ™¯åŒºè¯„è®ºæ¥å£ä¿®æ”¹</h1><h2 id="å­¦ä¹ æ—¥æœŸ-6-19">å­¦ä¹ æ—¥æœŸ: 6.19</h2><h2 id="é¡¹ç›®ä»»åŠ¡-14">é¡¹ç›®ä»»åŠ¡</h2><h3 id="æ·»åŠ æ‰€æœ‰æ™¯åŒºçš„è¯„è®ºæ¥å£">æ·»åŠ æ‰€æœ‰æ™¯åŒºçš„è¯„è®ºæ¥å£</h3><p>â€‹è¿™ä¸ªå…¶å®æŒºç®€å•çš„ï¼Œæ ¹æ®spot_idæŸ¥è¯¢å¯¹åº”æ™¯åŒºçš„æ‰€æœ‰è¯„è®ºå°±è¡Œäº†</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥è¯¢å¯¹åº”æ™¯åŒºçš„æ‰€æœ‰è¯„è®º</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/spot/commentAll/&lt;spot_id&gt;&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">spot_comments_from_id</span>(<span class="params">spot_id</span>):</span><br><span class="line">    data = dmToDfpkuseg.spotAllComment(<span class="built_in">eval</span>(spot_id))</span><br><span class="line">    <span class="keyword">return</span> json.dumps(&#123;<span class="string">&#x27;msg&#x27;</span>: <span class="string">&#x27;æŸ¥è¯¢æˆåŠŸ&#x27;</span>, <span class="string">&#x27;code&#x27;</span>: <span class="number">200</span>, <span class="string">&#x27;data&#x27;</span>: data&#125;, ensure_ascii=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># dmToDfpkusegä»£ç </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">spotAllComment</span>(<span class="params">spot_id</span>):</span><br><span class="line">    cur.execute(<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    select spot_id, evaluation_name,evaluation, evaluation_grade, evaluation_time, feel_score, feel from COMMENT_INFO</span></span><br><span class="line"><span class="string">    where</span></span><br><span class="line"><span class="string">        SPOT_ID=&#123;&#125;</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span>.<span class="built_in">format</span>(spot_id))</span><br><span class="line">    list_test = cur.fetchall()</span><br><span class="line">    df_test = pd.DataFrame(list_test, columns=[<span class="string">&quot;spot_id&quot;</span>,<span class="string">&quot;evaluation_name&quot;</span>, <span class="string">&quot;evaluation&quot;</span>, <span class="string">&quot;evaluation_grade&quot;</span>,</span><br><span class="line">                                               <span class="string">&quot;evaluation_time&quot;</span>, <span class="string">&quot;feel_score&quot;</span>, <span class="string">&quot;feel&quot;</span>])</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">eval</span>(df_test.to_json(orient=<span class="string">&#x27;records&#x27;</span>, force_ascii=<span class="literal">False</span>).replace(<span class="string">&quot;null&quot;</span>, <span class="string">&quot;&#x27;æœªå¡«&#x27;&quot;</span>))</span><br></pre></td></tr></table></figure><h3 id="ä¿®æ”¹æ™¯åŒºæ¥å£">ä¿®æ”¹æ™¯åŒºæ¥å£</h3><p>â€‹å› ä¸ºå¢åŠ äº†å­—æ®µï¼ŒåŠ ä¸Šä¸€äº›ä¸éœ€è¦çš„è¯è¦åŠ åˆ°åœç”¨è¯ä¸­ï¼Œåˆè¿›è¡Œå¤„ç†äº†ä¸€ä¸‹ã€‚æ·»åŠ äº†åœç”¨è¯ï¼Œæ¨¡å‹åˆè®­ç»ƒäº†ä¸€é</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">keyWordFindComment</span>(<span class="params">spot_id, comment_key_word</span>):</span><br><span class="line">    cur.execute(<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    select spot_id, evaluation_name,evaluation, evaluation_grade, evaluation_time, feel_score, feel from COMMENT_INFO</span></span><br><span class="line"><span class="string">    where</span></span><br><span class="line"><span class="string">        SPOT_ID=&#123;&#125;</span></span><br><span class="line"><span class="string">    and</span></span><br><span class="line"><span class="string">        EVALUATION like &#x27;%&#123;&#125;%&#x27;</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span>.<span class="built_in">format</span>(spot_id, comment_key_word))</span><br><span class="line">    list_test = cur.fetchall()</span><br><span class="line">    df_test = pd.DataFrame(list_test, columns=[<span class="string">&quot;spot_id&quot;</span>, <span class="string">&quot;evaluation_name&quot;</span>, <span class="string">&quot;evaluation&quot;</span>, <span class="string">&quot;evaluation_grade&quot;</span>,</span><br><span class="line">                                               <span class="string">&quot;evaluation_time&quot;</span>, <span class="string">&quot;feel_score&quot;</span>, <span class="string">&quot;feel&quot;</span>])</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">eval</span>(df_test.to_json(orient=<span class="string">&#x27;records&#x27;</span>, force_ascii=<span class="literal">False</span>).replace(<span class="string">&quot;null&quot;</span>, <span class="string">&quot;&#x27;æœªå¡«&#x27;&quot;</span>))</span><br></pre></td></tr></table></figure><h2 id="BUG-14">BUG</h2><p>â€‹è·‘pyä»£ç çš„æ—¶å€™ï¼ŒæœåŠ¡å™¨æŠ¥é”™ï¼Œçœ‹èµ·æ¥æ˜¯è¿æ¥çš„é—®é¢˜ï¼Œä¹‹å‰å¥½åƒæ˜¯é‡åˆ°è¿‡ï¼Œç„¶åæˆ‘ç”¨driverå·¥å…·æµ‹è¯•ï¼Œå‘ç°è¿æ¥ä¸ä¸Šæ•°æ®åº“äº†ï¼Œå»æ•°æ®åº“çš„æœåŠ¡å™¨æŸ¥çœ‹ï¼Œå‘ç°æ˜¯æœåŠ¡æ­»äº†ï¼Œå‰å°å¯åŠ¨ä»¥åæŠ¥é”™è§£å†³ã€‚</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/image-20250820102813870.png" alt="image-20250820102813870"></p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/image-20250820102819629.png" alt="image-20250820102819629"></p><h2 id="æ—¥æ€»ç»“-14">æ—¥æ€»ç»“</h2><blockquote><p>â€‹ä»Šå¤©ä¸»è¦æ˜¯å¯¹è¯„è®ºéƒ¨åˆ†æ¥å£çš„ä¿®æ”¹ä»¥åŠæ·»åŠ ï¼Œpythonè·‘ä¸€éflaskæ¥å£çš„ç¡®æœ‰ç‚¹æ…¢ï¼Œæ˜¯å…ˆåŠ è½½å†è°ƒç”¨çš„ï¼Œæ‰€ä»¥å¯åŠ¨pythonçš„æ¥å£æˆ‘å°±éœ€è¦ä¸ƒå…«åˆ†é’Ÿï¼Œä¹Ÿæ˜¯å› ä¸ºæ•°æ®é‡å¤§çš„åŸå› ï¼Œæ²¡æœ‰åšä¼˜åŒ–ï¼Œè°ƒç”¨çš„é€Ÿåº¦è¿˜æ˜¯å¾ˆå¿«çš„ï¼Œæ‰€ä»¥å°±æ²¡æœ‰åšä¼˜åŒ–ï¼Œåˆ†è¯çš„æ•ˆæœè¿˜éœ€è¦æ…¢æ…¢è°ƒæ•´ã€‚</p></blockquote><h1 id="ä»£ç æ•´åˆæ³¨é‡Šæ·»åŠ ">ä»£ç æ•´åˆæ³¨é‡Šæ·»åŠ </h1><h2 id="å­¦ä¹ æ—¥æœŸ-6-20">å­¦ä¹ æ—¥æœŸ: 6.20</h2><h2 id="é¡¹ç›®ä»»åŠ¡-15">é¡¹ç›®ä»»åŠ¡</h2><h3 id="ä»£ç æ•´åˆ">ä»£ç æ•´åˆ</h3><p>â€‹æ•´åˆçš„ç›®å½•å¦‚ä¸‹ï¼Œæ¸…æ´—çš„ä»£ç è¿˜æ˜¯åˆ†ä¸¤éƒ¨æ¥è·‘äº†ï¼Œä¸ç„¶å†…å­˜ä¼šå´©ã€‚å…ˆæ‰§è¡ŒalldataToPkl,å°†æ‰€æœ‰hdfsæ•°æ®ä¿å­˜åˆ°æœ¬åœ°ç„¶åå†åˆæˆä¸€ä¸ªallClearData.pklï¼Œç„¶åallDataClearTableIntoDmå°±æ˜¯å°†æ‰€æœ‰æ•°æ®æ‹†åˆ†æˆå››ä¸ªè¡¨ã€‚</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/image-20250820102836379.png" alt="image-20250820102836379"></p><h3 id="ä»£ç å¦‚ä¸‹-3">ä»£ç å¦‚ä¸‹</h3><p>â€‹å› ä¸ºä»£ç å¾ˆé•¿ï¼Œåšå®¢ä¸­ä¼šä»£ç å±•å¼€æ çš„ï¼Œä¸ºäº†åšå®¢çš„æ˜¾ç¤ºï¼Œå°±ç›´æ¥å°†ä»£ç æ”¾å…¥äº†ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> warnings</span><br><span class="line"><span class="keyword">from</span> sqlalchemy <span class="keyword">import</span> create_engine</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> radar</span><br><span class="line"><span class="keyword">from</span> snownlp <span class="keyword">import</span> SnowNLP, sentiment</span><br><span class="line"><span class="keyword">import</span> arrow</span><br><span class="line"><span class="keyword">from</span> faker <span class="keyword">import</span> Faker</span><br><span class="line"><span class="keyword">from</span> sklearn.linear_model <span class="keyword">import</span> LinearRegression</span><br><span class="line"></span><br><span class="line"><span class="comment"># fakeréšæœºå€¼</span></span><br><span class="line">fakerCn = Faker(<span class="string">&#x27;zh_CN&#x27;</span>)</span><br><span class="line"><span class="comment"># å°†è­¦å‘Šå»é™¤</span></span><br><span class="line">pd.set_option(<span class="string">&#x27;mode.chained_assignment&#x27;</span>, <span class="literal">None</span>)</span><br><span class="line">warnings.filterwarnings(<span class="string">&quot;ignore&quot;</span>, message=<span class="string">&quot;Could not import the lzma module.&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‡å®šä½¿ç”¨æ¨¡å‹</span></span><br><span class="line">sentiment.load(<span class="string">&quot;sentiment.marshal&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯¹äºä¸åŒçš„æƒ…ç»ªè¯„åˆ† åˆ¤æ–­å‡ºæ‰€ç»™è¯„è®º</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">scoreSnow</span>(<span class="params">sentiments</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="number">0.9</span> &lt;= sentiments &lt;= <span class="number">1</span>:</span><br><span class="line">        feelMood = <span class="string">&quot;è¶…æ£’&quot;</span></span><br><span class="line">    <span class="keyword">elif</span> <span class="number">0.8</span> &lt;= sentiments &lt;= <span class="number">0.9</span>:</span><br><span class="line">        feelMood = <span class="string">&quot;æ»¡æ„&quot;</span></span><br><span class="line">    <span class="keyword">elif</span> <span class="number">0.5</span> &lt;= sentiments &lt;= <span class="number">0.8</span>:</span><br><span class="line">        feelMood = <span class="string">&quot;ä¸é”™&quot;</span></span><br><span class="line">    <span class="keyword">elif</span> <span class="number">0.2</span> &lt;= sentiments &lt;= <span class="number">0.5</span>:</span><br><span class="line">        feelMood = <span class="string">&quot;ä¸€èˆ¬&quot;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        feelMood = <span class="string">&quot;ä¸ä½³&quot;</span></span><br><span class="line">    <span class="comment"># è¿”å›è¯„è®ºå­—ç¬¦</span></span><br><span class="line">    <span class="keyword">return</span> feelMood</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">clearSpotComment</span>(<span class="params">allInfoDf, province_list</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;è¯„è®ºè¡¨å¼€å§‹å¤„ç†&quot;</span>)</span><br><span class="line">    <span class="comment"># è¯„è®ºæ‰€éœ€å­—æ®µä¸ºå…¨éƒ¨ä¸­ç´¢å¼•12ä»¥åçš„</span></span><br><span class="line">    comment_df = allInfoDf[allInfoDf.columns[<span class="number">12</span>:]].copy()</span><br><span class="line">    <span class="comment"># æ·»åŠ æ–°å¢å­—æ®µ</span></span><br><span class="line">    comment_df[<span class="string">&#x27;FEEL_SCORE&#x27;</span>] = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    comment_df[<span class="string">&#x27;FEEL&#x27;</span>] = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="comment"># æ’å¥½åº</span></span><br><span class="line">    order = [<span class="string">&#x27;SPOT_ID&#x27;</span>, <span class="string">&#x27;EVALUATION&#x27;</span>, <span class="string">&#x27;EVALUATION_GRADE&#x27;</span>, <span class="string">&#x27;EVALUATION_TIME&#x27;</span>,</span><br><span class="line">             <span class="string">&#x27;EVALUATION_NAME&#x27;</span>, <span class="string">&#x27;FEEL_SCORE&#x27;</span>, <span class="string">&#x27;FEEL&#x27;</span>]</span><br><span class="line">    comment_df = comment_df[order]</span><br><span class="line">    <span class="comment"># æ—¶é—´å¤„ç† è¿™ç»„æ˜¯å¯¹2018/9/16 è¿™ç±»æ²¡-è€Œä¸”ipæ²¡æœ‰çš„æ•°æ®å¤„ç†</span></span><br><span class="line">    comment_df[<span class="string">&#x27;EVALUATION_TIME&#x27;</span>] = comment_df[<span class="string">&#x27;EVALUATION_TIME&#x27;</span>].apply(<span class="keyword">lambda</span> x: x.replace(<span class="string">&quot;/&quot;</span>, <span class="string">&quot;-&quot;</span>))</span><br><span class="line">    <span class="comment"># å¯¹timeå­—æ®µä¸ºç©ºçš„è¿›è¡Œéšæœºå€¼å¡«å……</span></span><br><span class="line">    comment_df[<span class="string">&#x27;EVALUATION_TIME&#x27;</span>] = comment_df[<span class="string">&#x27;EVALUATION_TIME&#x27;</span>].apply(</span><br><span class="line">        <span class="keyword">lambda</span> x: <span class="built_in">str</span>(radar.random_date(<span class="string">&quot;2020-09-13&quot;</span>, <span class="string">&quot;2023-02-02&quot;</span>).date()) <span class="keyword">if</span> x == <span class="string">&quot;&quot;</span> <span class="keyword">else</span> (</span><br><span class="line">            x + <span class="string">&quot;IPå±åœ°: &quot;</span> + np.random.choice(province_list) <span class="keyword">if</span> <span class="string">&quot;IP&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> x <span class="keyword">else</span> x))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># æ·»åŠ feelä»¥åŠfeel_scoreä¸¤åˆ—å¹¶å¯¹gradeä¸ºç©ºçš„è¡Œå¡«å……</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">calculate_scores</span>(<span class="params">row</span>):</span><br><span class="line">        <span class="comment"># å¯¹è¯„è®ºæœ‰æ¢è¡Œç©ºæ ¼çš„å»é™¤</span></span><br><span class="line">        row.EVALUATION = <span class="string">&#x27;&#x27;</span>.join(<span class="built_in">str</span>(row.EVALUATION).split())</span><br><span class="line">        <span class="comment"># æœªç‚¹è¯„çš„é»˜è®¤å¥½è¯„</span></span><br><span class="line">        <span class="keyword">if</span> (row.EVALUATION == <span class="string">&quot;ç”¨æˆ·æœªç‚¹è¯„ã€‚ç³»ç»Ÿé»˜è®¤å¥½è¯„ã€‚&quot;</span>) <span class="keyword">or</span> (<span class="built_in">type</span>(row.EVALUATION) != <span class="built_in">str</span>):</span><br><span class="line">             score = <span class="number">1.0</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># nlpè‡ªç„¶è¯­è¨€å¤„ç†</span></span><br><span class="line">            score = <span class="built_in">round</span>(SnowNLP(row.EVALUATION).sentiments, <span class="number">2</span>)</span><br><span class="line">        <span class="comment"># èµ‹å€¼ æƒé‡å¹³è¡¡</span></span><br><span class="line">        feelScore = <span class="built_in">round</span>(score * <span class="number">5</span>, <span class="number">1</span>)</span><br><span class="line">        <span class="comment"># è¯„è®ºæƒ…ç»ª</span></span><br><span class="line">        feel = scoreSnow(score)</span><br><span class="line">        <span class="comment"># ä¸ºç©ºå¡«å……</span></span><br><span class="line">        <span class="keyword">if</span> pd.isna(row.EVALUATION_GRADE):</span><br><span class="line">            <span class="built_in">print</span>(row.EVALUATION_GRADE)</span><br><span class="line">            row.EVALUATION_GRADE = <span class="built_in">str</span>(<span class="built_in">int</span>(<span class="built_in">round</span>(feelScore, <span class="number">0</span>))) + <span class="string">&quot;åˆ† &quot;</span> + feel</span><br><span class="line">        <span class="comment"># å¡«å……å­—æ®µ</span></span><br><span class="line">        row.FEEL_SCORE = feelScore</span><br><span class="line">        row.FEEL = feel</span><br><span class="line">        <span class="keyword">return</span> row</span><br><span class="line">    <span class="comment"># è¿›è¡Œè‡ªç„¶è¯­è¨€å¤„ç† ä»¥åŠç¼ºå¤±å€¼é¢„æµ‹å¡«å……</span></span><br><span class="line">    comment_df = comment_df.apply(calculate_scores, axis=<span class="number">1</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;è¯„è®ºè¡¨ç»“æŸå¤„ç†&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> comment_df</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">provinceList</span>():</span><br><span class="line">    <span class="comment"># å­˜æ”¾34ä¸ªçœçš„é›†åˆ é›†åˆæ˜¯å”¯ä¸€æ€§</span></span><br><span class="line">    province_set = <span class="built_in">set</span>()</span><br><span class="line">    <span class="comment"># å»é‡å¯¼å…¥</span></span><br><span class="line">    <span class="keyword">while</span> <span class="built_in">len</span>(province_set) &lt;= <span class="number">33</span>:</span><br><span class="line">        province = fakerCn.province()[<span class="number">0</span>:<span class="number">2</span>]</span><br><span class="line">        <span class="comment"># å› ä¸ºä¸¤å­—ï¼Œæ‰€ä»¥é»‘é¾™éœ€è¦ä¿®æ”¹æˆé»‘é¾™æ±Ÿ</span></span><br><span class="line">        <span class="keyword">if</span> province == <span class="string">&quot;é»‘é¾™&quot;</span>:</span><br><span class="line">            province = <span class="string">&quot;é»‘é¾™æ±Ÿ&quot;</span></span><br><span class="line">        province_set.add(province)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">list</span>(province_set)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">intoDm</span>(<span class="params">data, tableName</span>):</span><br><span class="line">    <span class="comment"># åˆ›å»ºurl</span></span><br><span class="line">    conn_url = <span class="string">&#x27;dm+dmPython://SYSDBA:SYSDBA001@47.120.9.36:5236&#x27;</span></span><br><span class="line">    <span class="comment"># åˆ›å»ºEngineå¯¹è±¡</span></span><br><span class="line">    engine = create_engine(conn_url)</span><br><span class="line">    <span class="comment"># åˆ°dm8ä¸­</span></span><br><span class="line">    data.to_sql(name=tableName, con=engine, if_exists=<span class="string">&#x27;append&#x27;</span>, index=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">cityFindProvince</span>(<span class="params">cityName</span>):</span><br><span class="line">    <span class="comment"># å¤„ç†io å¹¶ä½¿ç”¨utf-8å­—ç¬¦</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;../data/city.json&quot;</span>, <span class="string">&quot;r&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        content: <span class="built_in">dict</span> = json.load(f)</span><br><span class="line">    <span class="comment"># province_nameçœä»½å city_dataæ˜¯çœå†…åŸå¸‚æ˜¯list(dict)</span></span><br><span class="line">    <span class="keyword">for</span> province_name, city_name_datas <span class="keyword">in</span> content.items():</span><br><span class="line">        <span class="comment"># éå†listå†…éƒ¨æ•°æ®dict</span></span><br><span class="line">        <span class="keyword">for</span> city_name_data <span class="keyword">in</span> city_name_datas:</span><br><span class="line">            <span class="comment"># å–å­—å…¸çš„é”®å€¼å¯¹</span></span><br><span class="line">            <span class="keyword">for</span> city_name, county_name_list <span class="keyword">in</span> city_name_data.items():</span><br><span class="line">                <span class="comment"># æ‰¾åˆ°å¯¹åº”åŸå¸‚åˆ™è¿”å›</span></span><br><span class="line">                <span class="keyword">if</span> city_name == cityName:</span><br><span class="line">                    <span class="keyword">return</span> province_name</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="comment"># å¦åˆ™åœ¨å¿é‡Œæ‰¾</span></span><br><span class="line">                    <span class="keyword">for</span> county_name <span class="keyword">in</span> county_name_list:</span><br><span class="line">                        <span class="keyword">if</span> county_name == cityName:</span><br><span class="line">                            <span class="keyword">return</span> province_name</span><br><span class="line">    <span class="comment"># æ²¡æ‰¾åˆ°è¿”å›æœªçŸ¥çœ</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;æœªçŸ¥çœ&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">clearSpotProvince</span>(<span class="params">cityWithProvinceDf</span>):</span><br><span class="line">    <span class="comment"># çœä»½åä¸ºåŸå¸‚ååœ¨cityFindProvinceæ–¹æ³•ä¸­æ‰¾</span></span><br><span class="line">    cityWithProvinceDf[<span class="string">&#x27;PROVINCE_NAME&#x27;</span>] = cityWithProvinceDf[<span class="string">&#x27;CITY_NAME&#x27;</span>].apply(cityFindProvince)</span><br><span class="line">    <span class="comment"># çœä»½åå»é‡ æ’å‡ºçœä»½id</span></span><br><span class="line">    province_dict = &#123;name: rank + <span class="number">1</span> <span class="keyword">for</span> rank, name <span class="keyword">in</span> <span class="built_in">enumerate</span>(cityWithProvinceDf[<span class="string">&#x27;PROVINCE_NAME&#x27;</span>].unique())&#125;</span><br><span class="line">    <span class="comment"># çœä»½idå¡«å……</span></span><br><span class="line">    cityWithProvinceDf[<span class="string">&#x27;PROVINCE_ID&#x27;</span>] = cityWithProvinceDf[<span class="string">&#x27;PROVINCE_NAME&#x27;</span>].apply(<span class="keyword">lambda</span> x: province_dict[x])</span><br><span class="line">    <span class="comment"># åˆ›å»ºçœä»½df å­—æ®µä¸ºnameå’Œid</span></span><br><span class="line">    province_temp_df = cityWithProvinceDf.copy()[[<span class="string">&#x27;PROVINCE_NAME&#x27;</span>, <span class="string">&#x27;PROVINCE_ID&#x27;</span>]].drop_duplicates()</span><br><span class="line">    <span class="comment"># åˆ é™¤åŸå¸‚è¡¨ä¸­çœä»½åå­—æ®µ</span></span><br><span class="line">    cityWithProvinceDf.drop(columns=[<span class="string">&#x27;PROVINCE_NAME&#x27;</span>], inplace=<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">return</span> province_temp_df</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">clearSpotDf</span>(<span class="params">allInfoDf</span>):</span><br><span class="line">    <span class="comment"># æ‰€æœ‰ä¿¡æ¯ä»å–æ™¯åŒºç›¸å…³ä¿¡æ¯å¹¶å»é‡</span></span><br><span class="line">    spot_df = allInfoDf[[<span class="string">&#x27;SPOT_NAME&#x27;</span>, <span class="string">&#x27;LEVEL&#x27;</span>, <span class="string">&#x27;LOCATION&#x27;</span>, <span class="string">&#x27;GRADE&#x27;</span>, <span class="string">&#x27;QTY&#x27;</span>, <span class="string">&#x27;INTRO&#x27;</span>, <span class="string">&#x27;OPENTIME&#x27;</span>,</span><br><span class="line">                         <span class="string">&#x27;NOTICE&#x27;</span>, <span class="string">&#x27;ST&#x27;</span>, <span class="string">&#x27;HOT&#x27;</span>, <span class="string">&#x27;CITY_ID&#x27;</span>, <span class="string">&#x27;RATING&#x27;</span>, <span class="string">&#x27;SPOT_ID&#x27;</span>]].drop_duplicates().copy()</span><br><span class="line">    <span class="comment"># æ·»åŠ éœ€è¦åˆ— éšæœºå¡«å……ç”µè¯</span></span><br><span class="line">    spot_df.insert(<span class="number">3</span>, <span class="string">&#x27;PHONE&#x27;</span>, [fakerCn.phone_number() <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(spot_df.iloc[:, <span class="number">0</span>].size)])</span><br><span class="line">    <span class="keyword">return</span> spot_df</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">clearSpotCity</span>(<span class="params">spotWithCityDf</span>):</span><br><span class="line">    <span class="comment"># åŸå¸‚è¡¨å…ˆå°†åŸå¸‚åæ·»åŠ æ™¯åŒºè¡¨</span></span><br><span class="line">    spotWithCityDf[<span class="string">&#x27;CITY_NAME&#x27;</span>] = \</span><br><span class="line">        spotWithCityDf[<span class="string">&#x27;LOCATION&#x27;</span>].<span class="built_in">str</span>.extract(<span class="string">&#x27;([^å¸‚]&#123;2&#125;()+å¸‚)&#x27;</span>)[</span><br><span class="line">            <span class="number">0</span>].fillna(<span class="string">&#x27;æœªçŸ¥å¸‚&#x27;</span>)</span><br><span class="line">    <span class="comment"># æŒ‚ä¸ŠåŸå¸‚id</span></span><br><span class="line">    city_id_dict = &#123;city_name: rank + <span class="number">1</span> <span class="keyword">for</span> rank, city_name <span class="keyword">in</span> <span class="built_in">enumerate</span>(spotWithCityDf[<span class="string">&#x27;CITY_NAME&#x27;</span>].unique())&#125;</span><br><span class="line">    <span class="comment"># è®¾ç½®å”¯ä¸€çš„id</span></span><br><span class="line">    spotWithCityDf[<span class="string">&#x27;CITY_ID&#x27;</span>] = spotWithCityDf[<span class="string">&#x27;CITY_NAME&#x27;</span>].apply(<span class="keyword">lambda</span> x: city_id_dict[x])</span><br><span class="line">    <span class="comment"># å¤åˆ¶å­—æ®µåˆ°åŸå¸‚df å¹¶å»é‡</span></span><br><span class="line">    city_temp_df = spotWithCityDf.copy()[[<span class="string">&#x27;CITY_NAME&#x27;</span>, <span class="string">&#x27;CITY_ID&#x27;</span>]].drop_duplicates()</span><br><span class="line">    <span class="comment"># åˆ é™¤åŸå¸‚å</span></span><br><span class="line">    spotWithCityDf.drop(columns=[<span class="string">&#x27;CITY_NAME&#x27;</span>], inplace=<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">return</span> city_temp_df</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¯¥æ–¹æ³•æ˜¯å¤„ç†ä¸€äº›æ™¯åŒºåç›¸åŒçš„æ™¯åŒºï¼Œä¿ç•™nanå€¼å°‘çš„ï¼Œå¦‚æœnanå€¼ä¸€æ ·å–QTYå¤§çš„</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">keep_row_with_less_missing_values_and_less_qty</span>(<span class="params">group</span>):</span><br><span class="line">    <span class="comment"># è®¡ç®—æ¯è¡Œçš„ç¼ºå¤±å€¼æ•°é‡å’ŒQTYçš„æ•°é‡</span></span><br><span class="line">    missing_values = group.isnull().<span class="built_in">sum</span>(axis=<span class="number">1</span>)</span><br><span class="line">    qty_sum = group[<span class="string">&#x27;QTY&#x27;</span>]</span><br><span class="line">    <span class="comment"># åˆå¹¶ä¸¤ä¸ªSeries</span></span><br><span class="line">    combined = pd.DataFrame(&#123;<span class="string">&#x27;Missing&#x27;</span>: missing_values, <span class="string">&#x27;QTY&#x27;</span>: qty_sum&#125;)</span><br><span class="line">    <span class="comment"># å…ˆå¯¹ç¼ºå¤±å€¼æ•°é‡æ’åºï¼Œæœ‰å¹³å±€çš„è¯å°±æŒ‰ç…§QTYçš„æ’åº</span></span><br><span class="line">    combined_sorted = combined.sort_values(by=[<span class="string">&#x27;Missing&#x27;</span>, <span class="string">&#x27;QTY&#x27;</span>])</span><br><span class="line">    <span class="comment"># è¿”å›æœ€ä½³è¡Œçš„index</span></span><br><span class="line">    <span class="keyword">return</span> group.loc[combined_sorted.index[<span class="number">0</span>]]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">clearSpotFinal</span>(<span class="params">df</span>):</span><br><span class="line">    <span class="comment"># å°è¯•å°†è¯„è®ºæ•°å­—æ®µè½¬æ¢ä¸ºæ•´æ•°</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        df[<span class="string">&#x27;QTY&#x27;</span>] = df[<span class="string">&#x27;QTY&#x27;</span>].<span class="built_in">str</span>[:-<span class="number">3</span>].astype(<span class="built_in">int</span>)</span><br><span class="line">    <span class="keyword">except</span> ValueError:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;è¯„è®ºæ•°å­—æ®µåŒ…å«ä¸€äº›æ— æ³•è½¬æ¢ä¸ºæ•°å­—çš„å€¼ï¼&quot;</span>)</span><br><span class="line">    <span class="comment"># å°†ç¼ºå¤±çš„çƒ­åº¦ï¼ˆnanå€¼ï¼‰èµ‹äºˆä¸€ä¸ªè´Ÿæ•°ï¼Œä»¥ä¾¿äºåé¢å¤„ç†</span></span><br><span class="line">    df[<span class="string">&#x27;HOT&#x27;</span>].fillna(-<span class="number">1</span>, inplace=<span class="literal">True</span>)</span><br><span class="line">    <span class="comment"># å–å‡ºç¼ºå¤±æ•°æ®</span></span><br><span class="line">    predict_data = df[df[<span class="string">&#x27;HOT&#x27;</span>] == -<span class="number">1</span>]</span><br><span class="line">    listData = []</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">        listData.append(df[df[<span class="string">&#x27;HOT&#x27;</span>] != -<span class="number">1</span>].sample(frac=<span class="number">0.8</span>))</span><br><span class="line">    enhance = pd.concat(listData, ignore_index=<span class="literal">True</span>)</span><br><span class="line">    <span class="comment"># åˆ›å»ºçº¿æ€§å›å½’æ¨¡å‹</span></span><br><span class="line">    lr = LinearRegression()</span><br><span class="line">    <span class="comment"># å»ºç«‹è®­ç»ƒæ•°æ®é›†å’Œæµ‹è¯•æ•°æ®é›† (ä½¿ç”¨çš„æ˜¯80/20åˆ’åˆ†)</span></span><br><span class="line">    train_data = enhance.sample(frac=<span class="number">0.8</span>)</span><br><span class="line">    <span class="comment"># æŠŠå¤§éƒ¨åˆ†æ•°æ®ç•™ç»™æµ‹è¯•é›†ï¼Œåªä½¿ç”¨ä¸€å°éƒ¨åˆ†ä½œä¸ºè®­ç»ƒé›†</span></span><br><span class="line">    test_data = df[df[<span class="string">&#x27;HOT&#x27;</span>] != -<span class="number">1</span>]</span><br><span class="line">    <span class="comment"># # fitæ¨¡å‹</span></span><br><span class="line">    lr.fit(train_data[[<span class="string">&#x27;GRADE&#x27;</span>, <span class="string">&#x27;QTY&#x27;</span>]].values, train_data[<span class="string">&#x27;HOT&#x27;</span>].values)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;æ¨¡å‹å¾—åˆ†: &#x27;</span>, lr.score(test_data[[<span class="string">&#x27;GRADE&#x27;</span>, <span class="string">&#x27;QTY&#x27;</span>]].values, test_data[<span class="string">&#x27;HOT&#x27;</span>].values))</span><br><span class="line">    <span class="comment"># æµ‹è¯•æ¨¡å‹</span></span><br><span class="line">    prediction = lr.predict(predict_data[[<span class="string">&#x27;GRADE&#x27;</span>, <span class="string">&#x27;QTY&#x27;</span>]].values)</span><br><span class="line">    prediction[prediction &gt; <span class="number">10</span>] = <span class="number">10</span></span><br><span class="line">    prediction[prediction &lt; <span class="number">0</span>] = <span class="number">0</span></span><br><span class="line">    <span class="comment"># é¢„æµ‹ç¼ºå¤±çš„çƒ­åº¦</span></span><br><span class="line">    predict_data[<span class="string">&#x27;HOT&#x27;</span>] = prediction.<span class="built_in">round</span>(<span class="number">1</span>)</span><br><span class="line">    <span class="comment"># æŠŠé¢„æµ‹ç»“æœå¡«å……å›åŸæ•°æ®é›†</span></span><br><span class="line">    df.update(predict_data)</span><br><span class="line">    <span class="comment"># æ‰¾å‡ºæ‰€æœ‰é‡å¤çš„spot_nameï¼Œæˆ‘ä»¬åªä¿ç•™ç¬¬ä¸€ä¸ªï¼ˆé»˜è®¤æƒ…å†µï¼‰</span></span><br><span class="line">    duplicated_mask = df.duplicated(subset=<span class="string">&#x27;SPOT_NAME&#x27;</span>, keep=<span class="literal">False</span>)</span><br><span class="line">    <span class="comment"># è·å–æ‰€æœ‰é‡å¤çš„è¡Œ</span></span><br><span class="line">    duplicated_rows = df[duplicated_mask]</span><br><span class="line">    <span class="comment"># æ™¯åŒºååˆ†ç»„</span></span><br><span class="line">    new_rows = duplicated_rows.groupby(<span class="string">&#x27;SPOT_NAME&#x27;</span>).apply(keep_row_with_less_missing_values_and_less_qty)</span><br><span class="line">    <span class="comment"># æ‰¾å‡ºä¸é‡å¤çš„è¡Œ</span></span><br><span class="line">    non_duplicated_rows = df[~duplicated_mask]</span><br><span class="line">    <span class="comment"># å°†ä¸¤éƒ¨åˆ†çš„æ•°æ®åˆå¹¶</span></span><br><span class="line">    result = pd.concat([non_duplicated_rows, new_rows])</span><br><span class="line">    <span class="comment"># ç®—å‡ºè¯„è®ºæ•°çš„æœ€å¤§å€¼</span></span><br><span class="line">    max_comment_sum = result[<span class="string">&#x27;QTY&#x27;</span>].<span class="built_in">max</span>()</span><br><span class="line">    <span class="comment"># åŠ æƒåšé»˜è®¤æ¨èæŒ‡æ ‡</span></span><br><span class="line">    result[<span class="string">&#x27;RATING&#x27;</span>] = <span class="built_in">round</span>((result[<span class="string">&#x27;GRADE&#x27;</span>] * <span class="number">6</span>) + (result[<span class="string">&#x27;HOT&#x27;</span>] * <span class="number">4</span>) + (result[<span class="string">&#x27;QTY&#x27;</span>] / max_comment_sum * <span class="number">30</span>), <span class="number">2</span>)</span><br><span class="line">    <span class="comment"># ç¼ºå°‘æ™¯åŒºç­‰çº§çš„è¡¨ XAæ™¯åŒº</span></span><br><span class="line">    result.to_pickle(<span class="string">&#x27;allClearDataSpot.pkl&#x27;</span>)</span><br><span class="line">    <span class="comment"># è¯»å–æ•°æ®</span></span><br><span class="line">    df = pd.read_pickle(<span class="string">&#x27;allClearDataSpot.pkl&#x27;</span>)</span><br><span class="line">    <span class="comment"># å°†LEVELè½¬æ¢ä¸ºæ•°å­—æ ‡ç­¾</span></span><br><span class="line">    level_dict = &#123;<span class="string">&#x27;3Aæ™¯åŒº&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;4Aæ™¯åŒº&#x27;</span>: <span class="number">2</span>, <span class="string">&#x27;5Aæ™¯åŒº&#x27;</span>: <span class="number">3</span>&#125;</span><br><span class="line">    df[<span class="string">&#x27;LEVEL&#x27;</span>] = df[<span class="string">&#x27;LEVEL&#x27;</span>].<span class="built_in">map</span>(level_dict)</span><br><span class="line">    <span class="comment"># å°†ç­‰çº§ç¼ºå¤±çš„å¡«å……ä¸º-1</span></span><br><span class="line">    df[<span class="string">&#x27;LEVEL&#x27;</span>].fillna(-<span class="number">1</span>, inplace=<span class="literal">True</span>)</span><br><span class="line">    <span class="comment"># åˆ›å»ºLEVELæœ‰ç¼ºå¤±å€¼çš„è¡¨</span></span><br><span class="line">    predict_data = df[df[<span class="string">&#x27;LEVEL&#x27;</span>] == -<span class="number">1</span>]</span><br><span class="line">    <span class="comment"># æ•°æ®å¢å¼º</span></span><br><span class="line">    listData = []</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">        listData.append(df[df[<span class="string">&#x27;LEVEL&#x27;</span>] != -<span class="number">1</span>].sample(frac=<span class="number">0.8</span>))</span><br><span class="line">    enhance = pd.concat(listData, ignore_index=<span class="literal">True</span>)</span><br><span class="line">    <span class="comment"># åˆ›å»ºçº¿æ€§å›å½’æ¨¡å‹</span></span><br><span class="line">    lr = LinearRegression()</span><br><span class="line">    <span class="comment"># å»ºç«‹è®­ç»ƒæ•°æ®é›†å’Œæµ‹è¯•æ•°æ®é›† (ä½¿ç”¨çš„æ˜¯80/20åˆ’åˆ†)</span></span><br><span class="line">    train_data = enhance.sample(frac=<span class="number">0.8</span>)</span><br><span class="line">    <span class="comment"># æŠŠå¤§éƒ¨åˆ†æ•°æ®ç•™ç»™æµ‹è¯•é›†ï¼Œåªä½¿ç”¨ä¸€å°éƒ¨åˆ†ä½œä¸ºè®­ç»ƒé›†</span></span><br><span class="line">    test_data = df[df[<span class="string">&#x27;LEVEL&#x27;</span>] != -<span class="number">1</span>]</span><br><span class="line">    <span class="comment"># fitæ¨¡å‹</span></span><br><span class="line">    lr.fit(train_data[[<span class="string">&#x27;GRADE&#x27;</span>, <span class="string">&#x27;QTY&#x27;</span>, <span class="string">&#x27;HOT&#x27;</span>, <span class="string">&#x27;RATING&#x27;</span>]].values, train_data[<span class="string">&#x27;LEVEL&#x27;</span>].values)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;æ¨¡å‹å¾—åˆ†: &#x27;</span>, lr.score(test_data[[<span class="string">&#x27;GRADE&#x27;</span>, <span class="string">&#x27;QTY&#x27;</span>, <span class="string">&#x27;HOT&#x27;</span>, <span class="string">&#x27;RATING&#x27;</span>]].values, test_data[<span class="string">&#x27;LEVEL&#x27;</span>].values))</span><br><span class="line">    <span class="comment"># æµ‹è¯•æ¨¡å‹ ç¼ºå¤±å€¼å¯¼å…¥</span></span><br><span class="line">    prediction = lr.predict(predict_data[[<span class="string">&#x27;GRADE&#x27;</span>, <span class="string">&#x27;QTY&#x27;</span>, <span class="string">&#x27;HOT&#x27;</span>, <span class="string">&#x27;RATING&#x27;</span>]].values)</span><br><span class="line">    prediction[prediction &gt; <span class="number">3</span>] = <span class="number">3</span></span><br><span class="line">    prediction[prediction &lt; <span class="number">1</span>] = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># é¢„æµ‹ç¼ºå¤±çš„æ™¯åŒºç­‰çº§</span></span><br><span class="line">    predict_data[<span class="string">&#x27;LEVEL&#x27;</span>] = prediction.<span class="built_in">round</span>(<span class="number">0</span>)</span><br><span class="line">    df.update(predict_data)</span><br><span class="line">    <span class="comment"># æ™¯åŒºç­‰çº§è¿˜åŸ</span></span><br><span class="line">    level_dict = &#123;<span class="number">1</span>: <span class="string">&#x27;3Aæ™¯åŒº&#x27;</span>, <span class="number">2</span>: <span class="string">&#x27;4Aæ™¯åŒº&#x27;</span>, <span class="number">3</span>: <span class="string">&#x27;5Aæ™¯åŒº&#x27;</span>&#125;</span><br><span class="line">    df[<span class="string">&#x27;LEVEL&#x27;</span>] = df[<span class="string">&#x27;LEVEL&#x27;</span>].<span class="built_in">map</span>(level_dict)</span><br><span class="line">    <span class="comment"># æœ€ç»ˆæˆå“æ™¯åŒºè¡¨</span></span><br><span class="line">    df.to_pickle(<span class="string">&#x27;spotFinalData.pkl&#x27;</span>)</span><br><span class="line">    df[df.select_dtypes(include=[<span class="string">&#x27;object&#x27;</span>]).columns] = df.select_dtypes(include=[<span class="string">&#x27;object&#x27;</span>]).astype(<span class="string">&#x27;string&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    a = time.time()</span><br><span class="line">    <span class="comment"># çœä»½ç»çº¬åº¦è¡¨</span></span><br><span class="line">    province_city = pd.read_csv(<span class="string">&quot;../data/GT_CITYS.csv&quot;</span>,encoding = <span class="string">&#x27;gbk&#x27;</span>)</span><br><span class="line">    intoDm(province_city,<span class="string">&quot;GT_CITYS&quot;</span>)</span><br><span class="line">    <span class="comment"># æ„å»ºå‡ºæ‰€æœ‰çœä»½è¡¨ æ–¹ä¾¿ç»™IPæ·»åŠ çœä»½ä¿¡æ¯</span></span><br><span class="line">    provinces = provinceList()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;çœä»½ç­›é€‰å®Œæˆ&quot;</span>)</span><br><span class="line">    <span class="comment"># è¯»å–å¤„ç†å¥½çš„æ‰€æœ‰è¯„è®ºä¿¡æ¯</span></span><br><span class="line">    allDf = pd.read_pickle(<span class="string">&#x27;allClearData.pkl&#x27;</span>)</span><br><span class="line">    <span class="comment"># å¤„ç†è¯„è®ºè¡¨ å­—æ®µæ·»åŠ ä»¥åŠç¼ºå¤±å€¼å¡«å……</span></span><br><span class="line">    comment_temp_df = clearSpotComment(allDf, provinces)</span><br><span class="line">    <span class="comment"># ä¿å­˜ç£ç›˜</span></span><br><span class="line">    path = <span class="string">&#x27;commentFinalData.pkl&#x27;</span></span><br><span class="line">    comment_temp_df.to_pickle(path)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;å¼€å§‹å¯¼å…¥&quot;</span>)</span><br><span class="line">    <span class="comment"># è¯»å–è¯„è®ºè¡¨</span></span><br><span class="line">    comment_temp = pd.read_pickle(path)</span><br><span class="line">    comment_temp[comment_temp.select_dtypes(include=[<span class="string">&#x27;object&#x27;</span>]).columns] = comment_temp.select_dtypes(include=[<span class="string">&#x27;object&#x27;</span>]).astype(<span class="string">&#x27;string&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># ä¿®æ”¹objectçš„ç±»å‹ è½¬æ¢ä¸ºstring</span></span><br><span class="line">    <span class="keyword">for</span> col <span class="keyword">in</span> comment_temp.select_dtypes(include=[<span class="built_in">object</span>]):</span><br><span class="line">        comment_temp[col] = comment_temp[col].astype(<span class="string">&#x27;string&#x27;</span>)</span><br><span class="line">    <span class="comment"># åˆ†æ‰¹å¯¼å…¥5000ä¸€æ¬¡</span></span><br><span class="line">    chunkSize = <span class="number">5200</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(comment_temp), chunkSize):</span><br><span class="line">        data_chunk = comment_temp[i:i + chunkSize]</span><br><span class="line">        intoDm(data_chunk, <span class="string">&#x27;comment_info&#x27;</span>)</span><br><span class="line">    <span class="comment"># æ¸…æ´—æ™¯åŒºè¡¨ å¹¶ä¿å­˜ç£ç›˜</span></span><br><span class="line">    spot_info = clearSpotDf(allDf)</span><br><span class="line">    spot_info.to_pickle(<span class="string">&#x27;allClearSpot.pkl&#x27;</span>)</span><br><span class="line">    <span class="comment"># æ¸…æ´—åŸå¸‚è¡¨ å¹¶å¯¼å…¥dmæ•°æ®åº“</span></span><br><span class="line">    city_df = clearSpotCity(spot_info)</span><br><span class="line">    intoDm(city_df, <span class="string">&#x27;city_info&#x27;</span>)</span><br><span class="line">    <span class="comment"># æ¸…æ´—çœä»½è¡¨ å¹¶å¯¼å…¥dmæ•°æ®åº“</span></span><br><span class="line">    province_df = clearSpotProvince(city_df)</span><br><span class="line">    intoDm(province_df, <span class="string">&#x27;province_info&#x27;</span>)</span><br><span class="line">    <span class="comment"># æœ€åå¯¹æ™¯åŒºè¡¨çš„å¤„ç†+å¡«å……+é¢„æµ‹</span></span><br><span class="line">    spot_final_info = pd.read_pickle(<span class="string">&#x27;allClearSpot.pkl&#x27;</span>).reset_index().drop(columns=[<span class="string">&#x27;index&#x27;</span>])</span><br><span class="line">    clearSpotFinal(spot_final_info)</span><br><span class="line">    intoDm(spot_final_info, <span class="string">&quot;spot_info&quot;</span>)</span><br><span class="line">    a1 = time.time()</span><br><span class="line">    finalTime = arrow.get(a1 - a).<span class="built_in">format</span>(<span class="string">&#x27;mmåˆ†:ssç§’:SSSæ¯«ç§’&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;æ‰§è¡Œé€Ÿåº¦&quot;</span>, finalTime)</span><br></pre></td></tr></table></figure><h2 id="BUG-15">BUG</h2><p>â€‹æŠ¥å‡ºç¼–ç é”™è¯¯ï¼Œå·²è§£å†³ï¼Œé—®é¢˜ç‚¹åœ¨pycharmç¼–è¯‘å™¨çš„é—®é¢˜ï¼Œæˆ‘åˆšå¼€å§‹æ˜¯ç”¨windowsä¸­çš„pythonè·‘çš„ï¼Œä¸ç®¡æ€æ ·éƒ½ä¼šæŠ¥è¿™ä¸ªé”™è¯¯ï¼Œç„¶åå°±æƒ³åˆ°æ˜¯ä¸æ˜¯ä¹‹å‰ç¼–è¯‘å™¨è®¾ç½®çš„æ—¶å€™utf-8çš„é—®é¢˜ï¼Œå¯¼è‡´æ²¡æ³•å¤„ç†gbkçš„ä¸€äº›æ•°æ®ï¼Œå°±æ¢äº†å¹³å°ä¸­çš„pythonç¼–è¯‘å™¨ï¼Œæœ€åè¿è¡ŒæˆåŠŸäº†ã€‚</p><p><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blognoteImg/image-20250820102855241.png" alt="image-20250820102855241"></p><h2 id="æ—¥æ€»ç»“-15">æ—¥æ€»ç»“</h2><blockquote><p>â€‹ä»Šæ—¥çš„ä»»åŠ¡å°±æ˜¯æ¢³ç†æ¸…æ™°éƒ¨åˆ†ä»¥åŠæ¥å£éƒ¨åˆ†çš„ä»£ç ï¼Œå› ä¸ºè¦æ±‚æ³¨é‡Šéœ€è¦25%ï¼Œä¹‹å‰å…¶å®å·²ç»è¾¾åˆ°äº†ï¼Œå› ä¸ºä»£ç æœ‰äº›éƒ¨åˆ†æ¯”è¾ƒå†—ä½™ï¼Œä¿®æ”¹å°è£…ä¸€ä¸‹ï¼Œæ¥å£nohup æŒ‚è½½ä¸€ä¸‹ï¼Œæ¸…æ´—éœ€è¦ä¸¤æ¬¡ï¼Œçœ‹åé¢æ€§èƒ½ï¼Œå¯ä»¥æ”¾åˆ°ä¸€ä¸ªé‡Œé¢ï¼Œå¤„ç†è¯„è®ºè¡¨å®åœ¨æ˜¯å¤ªæ…¢äº†ï¼Œå•å•è¯„è®ºè¡¨éœ€è¦20åˆ†é’Ÿï¼Œå…¶ä»–åŠ èµ·æ¥ä¸è¶…è¿‡ä¸€åˆ†é’Ÿã€‚åæœŸå†™æ–‡æ¡£çš„æ—¶å€™çœ‹çœ‹èƒ½ä¸èƒ½ä¼˜åŒ–ã€‚</p></blockquote>]]></content>
    
    
    <summary type="html">æ—…ç‰›ç½‘é¡¹ç›®</summary>
    
    
    
    <category term="é¡¹ç›®" scheme="https://u7u7.top/categories/%E9%A1%B9%E7%9B%AE/"/>
    
    
    <category term="Java" scheme="https://u7u7.top/tags/Java/"/>
    
    <category term="Vue" scheme="https://u7u7.top/tags/Vue/"/>
    
    <category term="Scala" scheme="https://u7u7.top/tags/Scala/"/>
    
    <category term="Spark" scheme="https://u7u7.top/tags/Spark/"/>
    
    <category term="SQL" scheme="https://u7u7.top/tags/SQL/"/>
    
    <category term="å¤§æ•°æ®" scheme="https://u7u7.top/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/"/>
    
    <category term="æœˆç¬”è®°" scheme="https://u7u7.top/tags/%E6%9C%88%E7%AC%94%E8%AE%B0/"/>
    
    <category term="Python" scheme="https://u7u7.top/tags/Python/"/>
    
    <category term="AI" scheme="https://u7u7.top/tags/AI/"/>
    
  </entry>
  
  <entry>
    <title>5æœˆæ€»ç»“</title>
    <link href="https://u7u7.top/posts/23conclusion05.html"/>
    <id>https://u7u7.top/posts/23conclusion05.html</id>
    <published>2024-05-29T06:00:25.000Z</published>
    <updated>2024-05-30T06:00:25.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="23å¹´æ€»ç»“5æœˆæ€»ç»“">23å¹´æ€»ç»“5æœˆæ€»ç»“</h1><h2 id="ä¸€ã€çŸ¥è¯†ç‚¹æ±‡æ€»">ä¸€ã€çŸ¥è¯†ç‚¹æ±‡æ€»</h2><h3 id="5-4-5-13">5.4-5.13</h3><ul><li><p><strong>è¿™å‘¨çš„å†…å®¹</strong> ï¼šäº‘æœåŠ¡å™¨ç»´ä¿®ï¼Œä½¿ç”¨scala sparkå°†æä¾›çš„æ•°æ®æ¸…æ´—å…¥dm8æ•°æ®åº“</p><p>ä¸šåŠ¡åˆ†æ åœ°å€åˆ¤æ–­çœä»½ æ·»åŠ çœä»½åœ°å€ è¡¨ä¹‹é—´å…³è”</p></li><li><p><strong>éš¾ç‚¹</strong>ï¼š txtå¯¼å…¥dm8   åŸå¸‚è¡¨äºŒæ¬¡æ›´æ–°(æ·»åŠ çœä»½)</p></li></ul><p>â€‹<strong>ä¸ªäººç†è§£</strong>:</p><ul><li>txtå¯¼å…¥dm8ï¼Œç®—ä¸Šå‘¨æœ«ä¹Ÿæ˜¯èŠ±è´¹äº†æˆ‘ä¸¤å¤©çš„æ—¶é—´ï¼Œèµ·åˆæ˜¯æ‰“ç®—ä½¿ç”¨sparkçš„æ–‡ä»¶è¯»å–ï¼ŒtextFile,ä¸€è¡Œä¸€è¡Œè¯»çš„ï¼Œé—®é¢˜å‡ºç°åœ¨è½¬dataFrameä¸å¤ªå¥½åšåˆ°ï¼Œåªèƒ½å•ç‹¬çš„å–å‡ºkeyå’Œvalueï¼ŒèŠ±è´¹äº†æˆ‘ä¸€å¤©çš„æ—¶é—´ï¼Œæ€è·¯ç†æ¸…æ¥šäº†æ‰“ç®—ç”¨map,æŒ‰ç…§[å’Œ]ï¼Œåˆ‡å‰²æˆä¸€ä¸ªäºŒç»´é›†åˆï¼Œç„¶å å†…å±‚é›†åˆä¸­0æ˜¯keyï¼Œ1æ˜¯valueï¼Œæ€è·¯æ¸…æ™°ä»¥åï¼Œå‘ç°rddä»£ç mapæ“ä½œçš„æ—¶å€™ï¼Œå¦‚æœè¦mapè¿›å»ï¼Œå¤–å±‚çš„rddä¼šå˜æˆä¸€ä¸ªé›†åˆï¼Œè‡ªåŠ¨å°†æ¢è¡Œæˆé›†åˆçš„ä¸€ä¸ªç´¢å¼•å€¼ï¼ŒRDD[String]å¤„ç†çš„è¯ï¼Œæ­£åˆ™å°±ç”¨ä¸äº†äº†ï¼Œå› ä¸ºæ˜¯ä¸€è¡Œçš„ï¼Œé‚£åªèƒ½ç”¨splitæŒ‰ç…§å·¦å³æ‹¬å·åˆ‡å‰²ä¸¤æ¬¡ï¼Œä½†æ˜¯è¿™æ ·æ‹¿å‡ºæ¥çš„keyå’Œvalueä¸æ˜¯åŒæ—¶çš„ï¼Œé‚£ä¹Ÿå°±è¦å°†keyå’Œvalueå­˜é›†åˆï¼Œç„¶åå†è¯•ç€ç›´æ¥valueåŠ å…¥æ•°æ®åº“ï¼Œå§‹ç»ˆæ— æ³•è½¬æˆdfï¼Œsparkç›´æ¥å°†å­—ç¬¦ä¸²ä¼ æ•°æ®åº“ä¹Ÿä¸å¤ªå¥½ã€‚çªç„¶æƒ³åˆ°èƒ½ä¸èƒ½ç”¨javaçš„ioæµï¼Œåé¢ä¹Ÿæ˜¯å®ç°äº†ï¼Œå¦‚æœè€ƒè™‘æ•ˆç‡çš„è¯éœ€è¦æ­£åˆ™å’Œåå°„åŠ ä¸Šå¤šçº¿ç¨‹å’Œå¹¶å‘å¤„ç†ï¼Œä½†å…¶å®æ•°æ®ä¸æ˜¯å¾ˆå¤šï¼Œæˆ‘æœ¬æ¥æ‰“ç®—æµ‹è¯•çš„æ—¶å€™çœ‹é€Ÿåº¦ï¼Œå¦‚æœå¾ˆæ…¢å¯¼éƒ½å¯¼ä¸è¿›å»çš„è¯å°±ç”¨å¤šçº¿ç¨‹å’Œå¹¶å‘ï¼Œæœ€åå…¶å®1åˆ†é’Ÿä¸åˆ°å°±èƒ½å°±åŠ å…¥æ•°æ®åº“ï¼Œä¹Ÿå°±æ²¡æœ‰ä½¿ç”¨threadã€‚</li><li>Javaä½¿ç”¨ioæµï¼Œå°†txtå¯¼å…¥dm8ï¼Œé¦–å…ˆæœ€é‡è¦çš„è‚¯å®šæ˜¯ç”¨javaèƒ½è¿æ¥ä¸Šdm8ï¼Œç†Ÿæ‚‰çš„DriverManager+Connection+Statementèƒ½è½»è€Œæ˜“ä¸¾çš„åšåˆ°ï¼Œç„¶åæ˜¯å¯¹txtæ–‡ä»¶çš„å¤„ç†äº†ï¼Œæ­£åˆ™åŒ¹é…é¦–å…ˆioæµæ˜¯ä¸€è¡Œä¸€è¡Œè¯»å–çš„ï¼Œæ‰€ä»¥åªè¦å†™ä¸ªæ­£åˆ™å°†[]ä¸­çš„å€¼ä½œä¸ºkeyï¼Œåé¢æ‰€æœ‰çš„éƒ½ä¸ºè¯¥keyå¯¹åº”çš„valueï¼ŒçŸ¥é“ ä¸‹ä¸€ä¸ª[]çš„å‡ºç°ï¼Œåˆ©ç”¨åå°„ï¼Œé€šè¿‡key è°ƒç”¨å®ä½“ç±»å¯¹åº”çš„setæ–¹æ³•ï¼Œå°†keyå’Œvalueä½œä¸ºå±æ€§å’Œå€¼ï¼Œä¸€ä¸ªæ–‡ä»¶å°±æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå°†å¯¹è±¡å­˜å…¥æ•°ç»„ï¼Œæœ€åå¾ªç¯æ•°ç»„å–å€¼ï¼Œä½¿ç”¨sqlè¯­å¥insertè¯­å¥+å­—ç¬¦ä¸²å¡«å……å¯¼å…¥å°±è¡Œäº†ã€‚</li><li>åŸå¸‚è¡¨äºŒæ¬¡æ›´æ–°è¿™é‡Œå…¶å®ä¸»è¦çš„éš¾ç‚¹å°±æ˜¯æ ¹æ®åŸå¸‚åæ‰¾åˆ°çœä»½ï¼Œæœ¬æ¥æœ‰ç™¾åº¦åœ°å›¾çš„apiå¯ä»¥ç”¨ï¼Œä½†æ˜¯è€ƒè™‘åˆ°æœåŠ¡å™¨æ˜¯æ²¡æœ‰ç½‘ç»œçš„ï¼Œæ‰€ä»¥å°±å¾—ä¿å­˜åˆ°æœ¬åœ°äº†ï¼Œå°†ä¸­å›½çœå¸‚å¿çš„æ•°æ®æ”¶é›†å¥½ï¼Œæ•°æ®æ˜¯æˆ‘ç›´æ¥çœ‹åˆ°ä¸€ä¸ªjsæ•°æ®æ”¹æˆäº†jsonï¼Œç„¶åå°±æ˜¯å¯¹jsonæ–‡ä»¶çš„è¯»å–ï¼Œå…¶å®ææ¸…æ¥šjsonçš„ç»“æ„ï¼ŒèŠ±ç‚¹æ—¶é—´æ¢³ç†ä¸€ä¸‹ï¼Œè¿˜æ˜¯èƒ½å†™å‡ºæ¥çš„ï¼Œå› ä¸ºæ•°æ®çš„é—®é¢˜ï¼Œæ‰€ä»¥éœ€è¦ç©ºé—´å¤æ‚åº¦ä¸ºO3ï¼Œä¸‰æ¬¡å¾ªç¯åµŒå¥—ï¼ŒåŠ ä¸€äº›å¾ªç¯ä¸­åŠæ—¶breakï¼Œå‡å°‘è¿è¡Œæ—¶é—´ã€‚å®é™…æµ‹è¯•å¤§æ¦‚0.2ç§’èƒ½åæ˜ å‡ºæ¥ã€‚</li></ul><h3 id="5-15-5-19">5.15-5.19</h3><ul><li><p><strong>è¿™å‘¨çš„å­¦ä¹ å†…å®¹</strong> ï¼šåŸå¸‚è¡¨ä¿®æ”¹(çœä»½è¡¨ç‹¬ç«‹)  pythonè½»webæ¡†æ¶flask   æ¨èç®—æ³•  TFç›¸ä¼¼åº¦ TF-IDFæ¨¡å‹</p><p>ç›¸ä¼¼åº¦ç®—æ³• ç”µå½±æ ‡ç­¾å…³é”®å­—æ¡ˆä¾‹</p></li><li><p><strong>éš¾ç‚¹</strong>ï¼šç”µå½±æ ‡ç­¾å…³é”®å­—æ¡ˆä¾‹</p></li></ul><p>â€‹<strong>ä¸ªäººç†è§£</strong>:</p><ul><li>ç›¸ä¼¼åº¦æ¨èç®—æ³•æ¡ˆä¾‹ä¸­çš„é¢„æµ‹éƒ¨åˆ†ï¼Œæ˜¯é€šè¿‡æ¯ä¸ªç”¨æˆ·å¯¹æ¯ä¸ªç”µå½±çš„è¯„åˆ†ï¼Œç„¶åæ¨æµ‹å‡ºç”¨æˆ·å¯¹æ²¡è¯„åˆ†çš„ç”µå½±ä¼šè¯„å¤šå°‘åˆ†ï¼Œä¹Ÿå°±æ˜¯é¢„æµ‹ï¼Œè¿™ç§é¢„æµ‹ä¸»è¦æ˜¯ç”¨äº†çš®å°”é€Šç›¸å…³ç³»æ•°ã€‚è¿™å—åŸºæœ¬å›ä¸€å›ä»£ç å°±èƒ½ä¸¾ä¸€åä¸‰ã€‚</li><li>ç”µå½±å…³é”®å­—æ¡ˆä¾‹ï¼Œè¿™ä¸ªè‡ªå·±æ•²çš„æ—¶å€™æ„Ÿåˆ°äº†åƒåŠ›ï¼Œä¸»è¦éº»çƒ¦çš„ç‚¹åœ¨ç±»å‹è¦è½¬æ¥è½¬å»ï¼Œè½¬çš„è¿‡ç¨‹ä¸­è¿˜éœ€è¦å¯¹æ•°æ®å¤„ç†ï¼Œåˆå› ä¸ºpythonä¸æ˜¯å¼ºç±»å‹çš„ï¼Œä¼šæä¸æ¸…ç°åœ¨çš„æ•°æ®æ˜¯å•¥ç±»çš„ã€‚æ¡ˆä¾‹æ€è·¯:æ ¹æ®æ ‡ç­¾è¡¨å–ç”µå½±idå’Œå¯¹åº”çš„æ ‡ç­¾å…³è”ç”µå½±è¡¨ï¼Œå¾—å‡ºæŸç”µå½±çš„æ ‡ç­¾ä»¥åŠç±»å‹ï¼Œç„¶åæŠŠæ ‡ç­¾ç»Ÿè®¡æˆè¯è¢‹ï¼Œè®­ç»ƒTF-IDFæ¨¡å‹ï¼Œä¹Ÿå°±æ˜¯è®¡ç®—TF-IDFç›¸ä¼¼å€¼ï¼Œå¾—å‡ºæ¯ä¸ªæ ‡ç­¾æ‰€èƒ½å¯¹åº”çš„æœ€ç›¸å…³çš„å‰ç±»å‹ã€‚å†å»ºç«‹ç‰©å“çš„å€’æ’ç´¢å¼•ï¼Œæ ¹æ®tfå€¼å’Œç”¨æˆ·è¡¨ï¼Œæ•´ä¸ªæ¡ˆä¾‹å°±æ˜¯ä¸‰è¡¨ç›¸å…³æ•°æ®è¿æ¥ï¼Œç„¶åå°±èƒ½é€šè¿‡ç”¨æˆ·è§‚çœ‹è¿‡çš„ç”µå½±æ¨èå‡ºå…¶ä»–ç›¸å…³ç”µå½±ï¼Œçœ‹ä»£ç å’Œå®ç°è¿‡ç¨‹æœ‰ç‚¹éš¾æ‡‚ï¼Œæ‰“ç®—åœ¨ä¸­è½¯æ¯æ ¹æ®ç”¨æˆ·æ”¶è—åŠŸèƒ½ä¹Ÿå®ç°ä¸€ä¸ªæ™¯åŒºç›¸å…³æ¨èã€‚</li></ul><h3 id="5-22-5-31">5.22-5.31</h3><ul><li><p><strong>è¿™å‘¨çš„å­¦ä¹ å†…å®¹</strong> ï¼špythonæ“ä½œæ•°æ®åº“ æ™¯åŒºè¯„è®ºé«˜é¢‘è¯ç»Ÿè®¡ è¯„è®ºæƒ…ç»ªåˆ†æ è®­ç»ƒsnownlpæ¨¡å‹  pysparkè¿ç”¨ flaskä½¿ç”¨</p></li><li><p><strong>éš¾ç‚¹</strong>ï¼šé«˜é¢‘è¯ç»Ÿè®¡ï¼Œnlpè‡ªç„¶è¯­è¨€å¤„ç†</p></li></ul><p>â€‹<strong>ä¸ªäººç†è§£</strong>:</p><ul><li>é«˜é¢‘è¯ç»Ÿè®¡è¿™é‡Œï¼Œå°†æ¯ä¸ªè¯„è®ºåˆ†å‰²æˆå•ç‹¬çš„è¯è¯­æˆ–å•è¯ï¼Œå¹¶å°†å®ƒä»¬å­˜å‚¨åœ¨ä¸€ä¸ªåˆ—è¡¨ä¸­ã€‚ä½¿ç”¨äº†Python ä¸­çš„è‡ªç„¶è¯­è¨€å¤„ç†åº“ pkusegè¿›è¡Œåˆ†è¯å¤„ç†ï¼Œåˆ†è¯çš„æ—¶å€™éœ€è¦åŠ å…¥é™¤å»åœç”¨è¯è¿™ä¸ªç¯èŠ‚ï¼Œä¸€ä¸ªtxtæ–‡ä»¶ï¼Œå°†ä¸€äº›å•Šå“¦è¿™ç±»çš„è¯å­˜å…¥ï¼ŒæŠŠé‚£äº›åœ¨æ–‡æœ¬ä¸­å‡ºç°é¢‘ç‡å¾ˆé«˜ä½†æ²¡æœ‰å®é™…æ„ä¹‰çš„è¯è¯­è¿‡æ»¤æ‰ï¼ŒæŒ‰ç…§æ¯ä¸ªè¯è¯­çš„å‡ºç°é¢‘ç‡è¿›è¡Œæ’åºï¼Œä»é«˜åˆ°ä½è¾“å‡ºå‡ºç°é¢‘ç‡æœ€é«˜çš„å‰ N ä¸ªè¯è¯­ã€‚ Pandas åº“ä¸­çš„ Dataframe æ¥å®ç°ã€‚æ€»ç»“æ¥è¯´ï¼Œå¯¹è¯„è®ºè¿›è¡Œé«˜é¢‘è¯ç­›é€‰ä¸»è¦åŒ…æ‹¬åˆ†è¯ã€ç»Ÿè®¡è¯é¢‘ã€å»é™¤åœç”¨è¯å’ŒæŒ‰è¯é¢‘æ’åºç­‰æ­¥éª¤ã€‚éš¾ç‚¹å‡ºç°åœ¨åˆ†è¯çš„æ—¶å€™ï¼Œå› ä¸ºæ²¡æœ‰åŠæ³•è®­ç»ƒæ•°æ®é›†ï¼Œä¹Ÿä¸çŸ¥é“æ€ä¹ˆè®­ç»ƒï¼Œå¯èƒ½è¦ç”¨ç¬¬ä¸‰æ–¹çš„åˆ†è¯æ¨¡å‹ï¼Œæ‰€ä»¥åˆ†å‡ºæ¥çš„è¯ä¹Ÿæœ‰å¾ˆå¤šåè¯ï¼Œæ¯”å¦‚å¤©æ°”ï¼Œé»„é¹¤æ¥¼ï¼Œæ²¡æœ‰å¯¹åº”çš„å½¢å®¹è¯ï¼Œç°åœ¨çš„æ°´å¹³åªèƒ½åšåˆ°è¿™æ ·çš„å¤„ç†ï¼Œç ”ç©¶è¿‡åˆ«äººçš„åˆ†è¯ï¼Œåƒæºç¨‹æ—…æ¸¸è¯„è®ºåŒºä¹Ÿæœ‰ç”¨åˆ†è¯ï¼Œçœ‹è¿‡äº†åŸºæœ¬ä¹Ÿä¸æ€ä¹ˆåˆ†æ¸…ï¼Œä¸Šé¢å†™çš„è¯„è®ºç±»æ˜¯æ™¯åŒºæ–‡åŒ–å¥½ï¼Œä¸‹é¢æœ‰å¾ˆå¤šè¯„è®ºè·Ÿæ–‡åŒ–éƒ½ä¸æ²¾è¾¹ï¼Œç­‰åŸºæœ¬åŠŸèƒ½éƒ½å®ç°äº†å†å›æ¥æ‰¾æ‰¾æœ‰ä»€ä¹ˆæ¯”è¾ƒå¥½çš„ç¬¬ä¸‰æ–¹åº“ä½¿ç”¨ã€‚</li><li>è‡ªç„¶è¯­è¨€è¿™å—çš„è¯åœ¨æˆ‘é¡¹ç›®é‡Œé¢å…¶å®ä¸ç®—æ˜¯éš¾ç‚¹ï¼Œæ›´åƒæ˜¯ä¸€ä¸ªåˆ›æ–°ç‚¹ï¼Œä»£ç æ²¡å¤šå°‘ï¼Œä½†æ˜¯è‡ªç„¶è¯­è¨€å¤„ç†éš¾å°±éš¾åœ¨æƒ³è¦æé«˜è¯†åˆ«ç‡å¤ªéš¾äº†ï¼Œå¸‚é¢ä¸Šå‡ºç°çš„è‡ªç„¶è¯­è¨€å¤„ç†çš„æœ€é«˜å‡†ç¡®åº¦ä¹Ÿå°±ä¸€èˆ¬ï¼Œå‘å±•å‰æ™¯è¿˜æ˜¯å¯ä»¥çš„ï¼Œä½†æ˜¯ä¸æ˜¯æˆ‘è¿™ä¸ªå­¦å†èƒ½å‚ä¸çš„ï¼Œæˆ‘è¿™é‡Œæ˜¯å¯¹ä¸€å¥è¯çš„æƒ…ç»ªåˆ†æï¼Œæ‰¾åˆ°å¯¹æ™¯åŒºå¥½è¯„å’Œå·®è¯„çš„æ•°æ®é›†ï¼Œè¿›è¡Œäº†è®­ç»ƒï¼Œè®­ç»ƒä»¥åå¯¹æ™¯åŒºçš„è¯„è®ºçš„æƒ…ç»ªåˆ†æï¼Œæ˜¯æœ‰å¾ˆå¤§çš„æé«˜ï¼Œä½†æ˜¯è¿˜æ˜¯æœ‰å¾ˆå¤šä¸æ˜¯å¾ˆå‡†ç¡®çš„åœ°æ–¹ï¼Œé¢„ä¼°è¯†åˆ«ç‡å¯èƒ½70%ï¼Œæºç¨‹ç½‘çš„ç”¨æˆ·ç‚¹è¯„ä¼°è®¡ä¹Ÿæ˜¯ç”¨çš„è‡ªç„¶è¯­è¨€å¤„ç†ï¼Œä½†æ˜¯ä¸çŸ¥é“ç”¨çš„ä»€ä¹ˆåº“ï¼Œè¯†åˆ«ç‡ä¹Ÿä¸æ˜¯å¾ˆé«˜ï¼Œè¯„è®ºéƒ½è¯´å¾ˆå·®äº†ï¼Œä¸Šé¢è¿˜æ˜¯5æ˜Ÿã€‚è¿™ä¸€å—è¾¾åˆ°70å·¦å³çš„è¯†åˆ«ç‡æ„Ÿè§‰å·²ç»å¯ä»¥äº†ï¼Œåªè¦ä¼šè¢«çœ‹åˆ°çš„è¯„è®ºåŒºä¸è¦å‡ºç°å¤ªå¤§çš„åå·®å°±è¡Œäº†ã€‚</li></ul><h2 id="äºŒã€è‡ªæˆ‘æ€»ç»“">äºŒã€è‡ªæˆ‘æ€»ç»“</h2><ul><li>æœ¬æœˆæ˜¯ç»“æŸå¤§æ•°æ®çš„ç¬¬ä¸€ä¸ªæœˆï¼Œä¹Ÿæ˜¯å¼€å§‹å¤§æ•°æ®çš„ç¬¬ä¸€ä¸ªæœˆï¼Œä¸­è½¯æ¯çš„è¿™ä¸ªé¡¹ç›®æ»¡æ‰“æ»¡ç®—ä¹Ÿä¸€ä¸ªæœˆäº†ï¼Œä»é€‰é¢˜åˆ°ç°åœ¨ï¼Œä½†æ˜¯åšçš„è¯ï¼Œå¤§æ¦‚æ˜¯åå‡ å·æ‰å¼€å§‹ï¼Œå‰åŠä¸ªæœˆéƒ½æ˜¯æŠŠæ•°æ®æ´—åˆ°æ•°æ®åº“ï¼Œå› ä¸ºæœ‰ç€å¤§æ•°æ®çš„è‰¯å¥½åŸºç¡€ï¼Œæ‰€ä»¥æ´—æ•°æ®é™¤äº†txtæ–‡ä»¶ä»¥å¤–åŸºæœ¬æ²¡ä»€ä¹ˆé—®é¢˜ï¼Œåªè¦è½¬æˆäº†dataframeå°±èƒ½ç›´æ¥å¯¼å…¥dm8ï¼Œdm8å’Œmysqlä¸­çš„sqlè¯­å¥å¤§å·®ä¸å¤§ï¼Œå°±æ˜¯ç±»å‹æœ‰ç‚¹ä¸å¤ªä¸€æ ·ï¼Œä¹Ÿå¥½è§£å†³ã€‚åé¢ä½¿ç”¨pyçš„æ—¶å€™æ‰æ˜¯éš¾ç‚¹ï¼Œå› ä¸ºåŸºæœ¬éƒ½è¦ç”¨AIï¼Œè·Ÿå¤§æ•°æ®å›½èµ›åé¢æŒ–æ˜éƒ¨åˆ†æ˜¯å·®ä¸å¤šçš„ï¼Œè¿™æ®µæ—¶é—´å­¦å®Œä»¥åï¼Œå‘ç°å¤§æ•°æ®å›½èµ›é‚£å—çš„æŒ–æ˜å…¶å®ä¸æ˜¯å¾ˆéš¾ï¼Œå› ä¸ºsparkåº•å±‚ç®—æ³•éƒ½å°è£…å¥½äº†ï¼Œåªè¦æ•°æ®å¤„ç†æˆèƒ½å¥—ç”¨æ¨¡å‹ç®—æ³•çš„æ ¼å¼å°±è¡Œäº†ã€‚åé¢pyè¿˜æ˜¯æœ‰å¾ˆå¤šä»»åŠ¡æ²¡æœ‰åšå®Œçš„ï¼Œæ ¹æ®ç”¨æˆ·æ”¶è—æ¨èæ™¯åŒºï¼Œæ™¯åŒºç›¸å…³åº¦ï¼Œä»¥åŠè¯é¢‘ä¼˜åŒ–ï¼Œè¿˜ä»»é‡è€Œé“è¿œã€‚ä½†æ˜¯æ—¶é—´ä¸æ˜¯å¾ˆå¤šäº†ï¼Œè¦æŠ“ç´§äº†ã€‚ç°åœ¨é¡¹ç›®æœ€å¤§çš„é—®é¢˜æ˜¯æ¨èéƒ¨åˆ†æƒ³åˆ›æ–°éš¾åº¦æœ‰ç‚¹å¤§ï¼Œä»¥åŠå‰ç«¯ç½‘é¡µçš„ç»˜åˆ¶ä¼šä¸ä¼šæ¥ä¸åŠï¼Œå…¶æ¬¡å°±æ˜¯åŠŸèƒ½è¿˜æ²¡åˆ†æå…¨é¢ï¼Œæœ‰äº›é¡µé¢è¿˜æ²¡æœ‰ä¸€ä¸ªå¾ˆå¥½çš„æ„æ€ï¼Œè¡¨å›¾å®ç°çš„å¯è¡Œæ€§(æ¨èéƒ¨åˆ†)ï¼Œæ‰€ä»¥æ‰“ç®—å°½å¿«å°†è‡ªå·±è¿™è¾¹çš„æ•°æ®ä»¥åŠæ¥å£å¤„ç†å¥½ï¼Œå»å¸®å‰ç«¯æ¸²æŸ“ï¼Œç­‰å¹³å°å‘å¸ƒä»¥åï¼Œè¿˜è¦è§£å†³flaskåœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œçš„é—®é¢˜ã€‚</li></ul>]]></content>
    
    
    <summary type="html">æ—…ç‰›ç½‘5æœˆæ€»ç»“</summary>
    
    
    
    <category term="å·¥ä½œæœˆæ€»ç»“" scheme="https://u7u7.top/categories/%E5%B7%A5%E4%BD%9C%E6%9C%88%E6%80%BB%E7%BB%93/"/>
    
    
    <category term="æ€»ç»“" scheme="https://u7u7.top/tags/%E6%80%BB%E7%BB%93/"/>
    
  </entry>
  
</feed>
